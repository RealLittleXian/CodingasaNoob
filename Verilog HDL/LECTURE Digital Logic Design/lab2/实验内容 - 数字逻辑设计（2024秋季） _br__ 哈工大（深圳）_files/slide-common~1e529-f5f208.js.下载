(this.webpackJsonp=this.webpackJsonp||[]).push([["common~1e529","commonAsync~32e631b8"],{"00b54de57b":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("cedf7830be"),i=Object(r.a)("IMessageDomainService")},"00c2fdc893":function(e,t,n){"use strict";t.a=function(e){return"//wenku.docs.qq.com"===e?"//docs.qq.com":e}},"03808c4177":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("cedf7830be"),i=Object(r.a)("INetworkRequestService")},"052105b914":function(e,t,n){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},"077be6c856":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("cedf7830be"),i=Object(r.a)("ITemplateDomainService")},"0d99992889":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.trackDisposable=t.markTracked=t.disableDisposablesTrack=t.enableDisposablesTrack=void 0;var r=n("8e26833a3b"),i=!1,o="__is_disposable_tracked__";t.enableDisposablesTrack=function(){i=!0},t.disableDisposablesTrack=function(){i=!1},t.markTracked=function(e){if(i&&e&&e!==r.DisposableNone)try{e[o]=!0}catch(e){}},t.trackDisposable=function(e){if(!i)return e;e[o]||(e[o]=!1);var t=new Error("Potentially leaked disposable").stack;return setTimeout((function(){e[o]||console.log(t)}),3e3),e}},"10f9b6de11":function(e,t,n){"use strict";n.r(t),n.d(t,"ACCOUNT_TYPE",(function(){return tn})),n.d(t,"ALL_LOCAL_FILES_DB_NAME",(function(){return sn})),n.d(t,"BIND_TYPE",(function(){return rn})),n.d(t,"BaseChangeModel",(function(){return ln})),n.d(t,"DB_NAME",(function(){return cn})),n.d(t,"DB_NAME_TESTENV",(function(){return un})),n.d(t,"DOCUMENT_DATA_TYPE",(function(){return Jt})),n.d(t,"DOCUMENT_POLICY",(function(){return Kt})),n.d(t,"DOCUMENT_RESOURCE_CACHE_STATUS",(function(){return Qt})),n.d(t,"DOCUMENT_STATUS",(function(){return Ht})),n.d(t,"DOCUMENT_TYPE",(function(){return Ft})),n.d(t,"DOCUMENT_TYPE_DESC",(function(){return Vt})),n.d(t,"DOCUMENT_TYPE_DESC_MAP",(function(){return Zt})),n.d(t,"DOCUMENT_TYPE_MAP",(function(){return $t})),n.d(t,"DRIVE_TYPE",(function(){return Xt})),n.d(t,"DocumentData",(function(){return fn})),n.d(t,"DocumentEntity",(function(){return bn})),n.d(t,"DocumentId",(function(){return vn})),n.d(t,"DocumentStatus",(function(){return gn})),n.d(t,"DriveData",(function(){return On})),n.d(t,"LIST_INFO_TYPE",(function(){return zt})),n.d(t,"LIST_TYPE",(function(){return Yt})),n.d(t,"OfflineData",(function(){return wn})),n.d(t,"PadInfo",(function(){return Sn})),n.d(t,"TABLE_NAME",(function(){return en})),n.d(t,"UserInfo",(function(){return xn})),n.d(t,"VipLevel",(function(){return an})),n.d(t,"VipType",(function(){return on}));var r,i,o=n("85d0a7609b"),a=n.n(o),c=(n("c6244f7705"),n("56683198d5"),n("73b854064b"),n("9132715560")),s=n.n(c),u=n("6a364eb35c"),d=n.n(u),l=n("bd29e2df90"),p=n.n(l),f=n("ab5eb40518"),h=n.n(f),b=n("1b4cdd6a36"),_=n.n(b),v=(n("d66c2b8c37"),n("47ca619755"),n("3bf1976a4f"),n("826dc923b3"),n("d7c625d1f2"));!function(e){e.CreateCollection="create-collection",e.DropCollection="drop-collection",e.CreateIndex="create-index",e.DropIndex="drop-index"}(r||(r={})),function(e){e.MoveProperty="move-property",e.DropProperty="drop-property",e.ReplaceProperty="replace-property",e.ClearData="clear-data",e.ReplaceData="replace-data"}(i||(i={}));var y,g={name:"alloy_db_schema_table",indices:[],key:{path:"name"},properties:[]};!function(e){e.Equals="=",e.NotEquals="!=",e.GreaterThan=">",e.GreaterOrEqualThan=">=",e.LessThan="<",e.LessOrEqualThan="<=",e.In="in",e.NotIn="nin"}(y||(y={}));var m,O,j,w,I,S=void 0;function E(e){return"number"==typeof e&&!Number.isNaN(e)||"string"==typeof e||e instanceof Date&&!Number.isNaN(e.getTime())||e instanceof ArrayBuffer||ArrayBuffer.isView(e)||Array.isArray(e)&&e.every(E)}function x(e,t){var n=e;return Array.isArray(t)?t.map((function(e){return n[e]})):n[t]}function C(e,t){return Array.isArray(e)?Array.isArray(t)&&e.length===t.length&&e.every((function(e,n){return C(e,t[n])})):e===t}!function(e){e.OR="or",e.AND="and",e.FILTER="filter",e.NONE="none",e.ALL="all"}(m||(m={})),function(e){e.ENTRIES="entries",e.VALUES="values",e.KEYS="keys",e.COUNT="count"}(O||(O={})),function(e){e.DESCENDING="desc",e.ASCENDING="asc"}(j||(j={})),function(e){e.AutoIncrement="auto-increment"}(w||(w={})),function(e){e.Equals="=",e.GreaterThan=">",e.GreaterOrEqualThan=">=",e.LessThan="<",e.LessOrEqualThan="<="}(I||(I={}));var A,k=function(){function e(){}return e.collectionDiff=function(e,t){if(e.name!==t.name)throw new Error("can not compare collection schema with different name");var n={collection:e.name},r=t.indices.filter((function(t){return!e.indices.some((function(e){return e.name===t.name}))})),i=e.indices.filter((function(e){return!t.indices.some((function(t){return t.name===e.name}))}));return(r.length||i.length)&&(n.index={added:Object(v.__spreadArray)([],Object(v.__read)(r)),deleted:Object(v.__spreadArray)([],Object(v.__read)(i))}),n},e.databaseDiff=function(e,t){var n,r,i=this.getCompareMap(e,t),o={added:[],deleted:[],different:[]};try{for(var a=Object(v.__values)(i.values()),c=a.next();!c.done;c=a.next()){var s=c.value;if(!s.oldValue||s.newValue)if(s.oldValue||!s.newValue){if(s.oldValue&&s.newValue){var u=this.collectionDiff(s.oldValue,s.newValue);if(!u.index)continue;o.different.push(u)}}else o.added.push(s.newValue);else o.deleted.push(s.oldValue)}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},e.getCompareMap=function(e,t){var n,r,i,o,a=new Map;try{for(var c=Object(v.__values)(t.collections),s=c.next();!s.done;s=c.next()){var u=s.value;(p=a.get(u.name)||{}).newValue=u,a.set(u.name,p)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}try{for(var d=Object(v.__values)(e.collections),l=d.next();!l.done;l=d.next()){var p;u=l.value;(p=a.get(u.name)||{}).oldValue=u,a.set(u.name,p)}}catch(e){i={error:e}}finally{try{l&&!l.done&&(o=d.return)&&o.call(d)}finally{if(i)throw i.error}}return a},e}();!function(e){e.READ_ONLY="readonly",e.READ_WRITE="readwrite",e.VERSION_CHANGE="versionchange"}(A||(A={}));var R=function(e){function t(t,n){for(var r=this,i=t,o={cause:n};o.cause&&o.cause instanceof Error;)i=t+"\n\t→ "+n,o=o.cause;return(r=e.call(this,i)||this).cause=n,r.name=r.constructor.name,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(r,r.constructor):r.stack=(new Error).stack,Object.setPrototypeOf(r,r.constructor.prototype),r}return Object(v.__extends)(t,e),t}(Error),D={withDefaultMessage:function(e,t){return function(n){function r(r,i){var o=n.call(this,r||t||"",i)||this;return o.name=e,Object.setPrototypeOf(o,o.constructor.prototype),o}return Object(v.__extends)(r,n),r}(R)},withMessageCreator:function(e,t){return function(n){function r(r,i){var o=n.call(this,t(r),i)||this;return o.name=e,Object.setPrototypeOf(o,o.constructor.prototype),o}return Object(v.__extends)(r,n),r}(R)}},T=(D.withDefaultMessage("AssertionError","the asserted condition is invalid"),D.withMessageCreator("UnimplementedError",(function(e){return e?"called with arguments: "+JSON.stringify(e):"called with nothing"})));var N=function(e){0},M=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(v.__extends)(t,e),t.prototype.isQuotaExceeded=function(){return this.message.includes("QuotaExceededError")},t}(D.withMessageCreator("DatabaseConnectError",(function(e){return"failed to connect to database '"+e+"'."}))),P=D.withMessageCreator("CollectionNotFoundError",(function(e){return"model '"+e+"' is not registered, please register it before use it."})),L=D.withMessageCreator("DataMigrationError",(function(e){return"failed to perform data migration, versionChange: "+e.oldVersion+" -> "+e.newVersion+"."})),U=D.withMessageCreator("IncorrectTransactionModeError",(function(e){return"use error transaction type["+e+"]."})),B=D.withMessageCreator("NoTableInfoError",(function(e){return"'"+e+"' is not a valid model with table info injected, please ensure the model class is decorated by @table(), @field() etc."})),q=D.withDefaultMessage("EmptyTableInfoError","table without any field declare, please define model use [field] decorator."),F=D.withMessageCreator("InvalidWhereInValueError",(function(e){return"there is an error in your where clause of field '"+e.path+"'."+e.op+", the value must be an array."})),V=D.withMessageCreator("UnsupportedWhereOperatorError",(function(e){return"unsupported where operator '"+e+"', current supported operators are >, >=, <, <=, =, !=, in, nin."})),G=D.withDefaultMessage("OrderByKeyError","can not order value that is not Key: 'Key = number | string | Date | BufferSource | Key[]'."),W=D.withMessageCreator("DatabaseInternalError",(function(e){return"there is an internal error of database, reason: "+e+"."})),K=(D.withMessageCreator("QueryJobError",(function(e){return"failed to execute query job, reason: "+e+"."})),D.withMessageCreator("PluginError",(function(e){return'an error has occurred on plugin "'+e.name+'"": '+e.message+"."})),D.withDefaultMessage("TransactionCommitError","failed to commit transaction.")),H=D.withDefaultMessage("UpdateMigrationChangeInfoError","failed to update migration change info"),Q=D.withMessageCreator("ExecuteDataUpgradeError",(function(e){return"failed to execute data upgrade on collection '"+e+"'."})),z=D.withMessageCreator("UnexpectedClosedError",(function(e){return"database "+e+" is unexpectedly closed by browser, this could happen when disk is unavailable or the page is shutdown."})),Y=Symbol.for("TABLE_KEY"),J=function(){function e(){}return e.saveTableInfo=function(e,t){Object.defineProperty(t,Y,{configurable:!0,value:Object(v.__assign)({},e)})},e.getTableInfo=function(e){return e[Y]},e.getFirstTableInfoAlongPrototypeChain=function(e){var t=this.getTableInfo(e),n=Object.assign({},t);return n.properties=new Map(n.properties),n},e.getTableName=function(e){var t=this.getTableInfo(e.prototype);if(!(null==t?void 0:t.tableName))throw new B(e.name);return t.tableName},e.addTablePropertyInfo=function(t,n){var r=e.getOrCreateTableInfo(t);if(r.properties.has(n.name)){var i=r.properties.get(n.name);Object.assign(n,i)}r.properties.set(n.name,n),this.saveTableInfo(r,t)},e.createPropertyInfo=function(e,t){return{name:e,alias:t,isUnionKey:!1}},e.convertTableInfoToSchema=function(e){if(!e.tableName)return null;var t,n=Object(v.__spreadArray)([],Object(v.__read)(e.properties.values())),r=n.filter((function(e){return e.isIndex})).map((function(e){var t,n;return{name:null!==(t=e.alias)&&void 0!==t?t:e.name,path:null!==(n=e.alias)&&void 0!==n?n:e.name,unique:e.isUnique}}));return t=!e.autoIncrement&&e.keyPath?{path:1===e.keyPath.length?e.keyPath[0]:e.keyPath}:{generator:w.AutoIncrement},{properties:n.map((function(e){var t;return null!==(t=e.alias)&&void 0!==t?t:e.name})),indices:r,key:t,name:e.tableName}},e.createDefaultTableInfo=function(){return{tableName:null,autoIncrement:!0,properties:new Map}},e.getOrCreateTableInfo=function(t){if(Object.prototype.hasOwnProperty.call(t,Y))return t[Y];var n=e.createDefaultTableInfo(),r=t[Y];return r&&(n.properties=new Map(Object(v.__spreadArray)(Object(v.__spreadArray)([],Object(v.__read)(r.properties)),Object(v.__read)(n.properties)))),e.saveTableInfo(n,t),n},e}();var X=function(e){return function(t,n){var r=J.createPropertyInfo(n,e);J.addTablePropertyInfo(t,r)}};var $=function(e,t){return function(n){var r=J.getFirstTableInfoAlongPrototypeChain(n.prototype);if(!r)throw new q;r.tableName=e;var i=Object(v.__spreadArray)([],Object(v.__read)(r.properties.values())),o=function(e,t){if(null==e?void 0:e.key)return"string"==typeof e.key?[e.key]:e.key;var n=t.filter((function(e){return e.isPrimaryKey})).map((function(e){var t;return null!==(t=e.alias)&&void 0!==t?t:e.name}));return n.length>0?n:void 0}(t,i);r.keyPath=o,r.autoIncrement=void 0===r.keyPath,J.saveTableInfo(r,n.prototype)}};var Z=function(e){return function(t,n){var r=J.createPropertyInfo(n);r.isIndex=!0,r.isUnique=!!(null==e?void 0:e.unique),J.addTablePropertyInfo(t,r)}};var ee=function(){return function(e,t){var n=J.createPropertyInfo(t);n.isPrimaryKey=!0,J.addTablePropertyInfo(e,n)}};let te=()=>({events:{},emit(e,...t){(this.events[e]||[]).forEach((e=>e(...t)))},on(e,t){return(this.events[e]=this.events[e]||[]).push(t),()=>this.events[e]=(this.events[e]||[]).filter((e=>e!==t))}});var ne,re;!function(e){e.Ready="Ready",e.Fetal="Fetal",e.Closed="Closed",e.Destroyed="Destroyed",e.Error="Error",e.RegisterModel="RegisterModel",e.RegisterPlugin="RegisterPlugin",e.BootstrapStart="BootstrapStart",e.BootstrapEnd="BootstrapEnd",e.SchemaMigrationStart="SchemaMigrationStart",e.SchemaMigrationEnd="SchemaMigrationEnd",e.VersionChange="VersionChange"}(ne||(ne={})),function(e){e.CollectionCreated="CollectionCreated",e.ModelLazyMigrationEnd="ModelLazyMigrationEnd",e.PrepareAutoUpgradeEnd="PrepareAutoUpgradeEnd",e.UpdateMigrationChangeInfo="UpdateMigrationChangeInfoEnd",e.StartTransaction="StartTransaction"}(re||(re={}));var ie,oe=function(){function e(e){var t=this;this.onClosed=function(e){t.eventBus.on(ne.Closed,e)},this.eventBus=e}return e.prototype.onReady=function(e){this.eventBus.on(ne.Ready,e)},e.prototype.onFetal=function(e){this.eventBus.on(ne.Fetal,e)},e.prototype.onError=function(e){this.eventBus.on(ne.Error,e)},e.prototype.onRegisterModel=function(e){this.eventBus.on(ne.RegisterModel,e)},e.prototype.onRegisterPlugin=function(e){this.eventBus.on(ne.RegisterPlugin,e)},e.prototype.onBootstrapStart=function(e){this.eventBus.on(ne.BootstrapStart,e)},e.prototype.onBootstrapEnd=function(e){this.eventBus.on(ne.BootstrapEnd,e)},e.prototype.onSchemaMigrationStart=function(e){this.eventBus.on(ne.SchemaMigrationStart,e)},e.prototype.onSchemaMigrationEnd=function(e){this.eventBus.on(ne.SchemaMigrationEnd,e)},e.prototype.onVersionChange=function(e){this.eventBus.on(ne.VersionChange,e)},e.prototype.emitError=function(e){this.eventBus.emit(ne.Error,e)},e}(),ae=function(){function e(){}return e.revealSchema=function(e){var t=J.getTableInfo(e.prototype);return t?J.convertTableInfoToSchema(t):null},e}(),ce=function(){function e(e){this.models=[],this.eventBus=e}return e.prototype.register=function(e){if(!this.models.includes(e)){var t=this.getSchema(e);this.models.push(e),this.eventBus.emit(ne.RegisterModel,{class:e,schema:t})}},e.prototype.getSchema=function(e){var t=ae.revealSchema(e);if(!t){var n=new B(e.name);throw this.eventBus.emit(ne.Error,n),new B(e.name)}return t},e.prototype.getSchemaAndRegisterModelIfNeed=function(e){return this.register(e),this.getSchema(e)},e}();function se(e){var t,n,r,i=J.getTableInfo(Object.getPrototypeOf(e));if(!i)return e;var o={};try{for(var a=Object(v.__values)(i.properties.values()),c=a.next();!c.done;c=a.next()){var s=c.value;o[null!==(r=s.alias)&&void 0!==r?r:s.name]=e[s.name]}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return o}function ue(e,t){var n,r;if(null==e)return null;var i=J.getTableInfo(t.prototype);if(!i)return e;var o=function(e,t){var n,r,i,o={};try{for(var a=Object(v.__values)(t.properties.values()),c=a.next();!c.done;c=a.next()){var s=c.value,u=null!==(i=s.alias)&&void 0!==i?i:s.name;o[s.name]=e[u]}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o}(e,i),a=new t(o);try{for(var c=Object(v.__values)(Object.keys(o)),s=c.next();!s.done;s=c.next()){var u=s.value;void 0!==o[u]&&(a[u]=o[u])}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}return a}!function(e){e.FILL="fill",e.HYDRATE="hydrate",e.PAGINATE="paginate",e.FILTER="filter",e.SORT="sort",e.SCAN="scan",e.SCAN_ALL="scan-all",e.INDEX_SCAN="index-scan",e.UNION="union",e.DISTINCT="distinct",e.INTERSECT="intersect"}(ie||(ie={}));var de=function(){function e(e,t){this.node=e,this.parent=t,this.context=xe(e)}return e.prototype.perform=function(e){return Object(v.__awaiter)(this,void 0,void 0,(function(){var t,n,r,i,o;return Object(v.__generator)(this,(function(a){try{for(t=Object(v.__values)(this.node.inputs),n=t.next();!n.done;n=t.next())r=n.value,e.push(r)}catch(e){i={error:e}}finally{try{n&&!n.done&&(o=t.return)&&o.call(t)}finally{if(i)throw i.error}}return[2]}))}))},e}(),le=function(){function e(e){this.comparer=e}return e.prototype.has=function(e,t){return-1!==this.getOrder(e,t)},e.prototype.getOrder=function(e,t){for(var n=0,r=e.length;n<r;){var i=n+Math.floor((r-n)/2),o=e[i],a=this.comparer.cmp(t,o);if(0===a)return i;a>0?n=i+1:r=i}return-1},e}(),pe=function(){function e(e,t){this.node=e,this.parent=t,this.context=xe(e)}return e.prototype.perform=function(e){return Object(v.__awaiter)(this,void 0,void 0,(function(){var t,n,r,i,o,a,c,s,u,d,l,p,f,h,b,_,y;return Object(v.__generator)(this,(function(g){t=new le(this.node.comparer);try{for(n=Object(v.__values)(this.context.inputs),r=n.next();!r.done;r=n.next()){i=r.value,o=new Map,a=i.map((function(e){return Object(v.__read)(e,1)[0]})).sort(this.node.comparer.cmp),c=[];try{for(_=void 0,s=Object(v.__values)(i),u=s.next();!u.done;u=s.next())d=u.value,l=Object(v.__read)(d,1),p=l[0],f=t.getOrder(a,p),o.has(f)||(o.set(f,!0),c.push(d))}catch(e){_={error:e}}finally{try{u&&!u.done&&(y=s.return)&&y.call(s)}finally{if(_)throw _.error}}e.push(c)}}catch(e){h={error:e}}finally{try{r&&!r.done&&(b=n.return)&&b.call(n)}finally{if(h)throw h.error}}return[2]}))}))},e}(),fe=Symbol("-∞"),he=Symbol("+∞"),be=function(){function e(e){var t=this;this.contains=function(e,n){var r=t,i=r.cmp,o=r.lowerOf,a=r.upperOf;if(!t.isValid(e))return!1;var c=e.lowerOpen,s=e.upperOpen,u=i(o(e),n),d=i(a(e),n);return 0===u&&!c||u<0&&d>0||0===d&&!s},this.union=function(e){if(e.length<=1)return e;t.sort(e);for(var n=[],r=e[0],i=1;i<e.length;i++){var o=e[i];t.isOverlapped(r,o)?r=t.wrap(r,o):(n.push(r),r=o)}return n.push(r),n},this.intersect=function(e){var n,r;if(e.length<=1)return e;t.sort(e);var i=e[0];try{for(var o=Object(v.__values)(e),a=o.next();!a.done;a=o.next()){var c=a.value;if(!t.isOverlapped(i,c))return[];i=t.overlap(i,c)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return[i]},this.isValid=function(e){var n=t,r=n.cmp,i=n.lowerOf,o=n.upperOf,a=r(i(e),o(e));return a<0||0===a&&!e.lowerOpen&&!e.upperOpen},this.cmp=function(e,n){return e!==fe&&e!==he&&n!==fe&&n!==he?t.comparer.cmp(e,n):e===n?0:e===fe||n===he?-1:1},this.lowerOf=function(e){return void 0===e.lower?fe:e.lower},this.upperOf=function(e){return void 0===e.upper?he:e.upper},this.comparer=e}return e.prototype.isOverlapped=function(e,t){var n,r=this,i=r.cmp,o=r.lowerOf,a=r.upperOf,c=Object(v.__read)([e,t],2),s=c[0],u=c[1],d=i(o(s),o(u));(d>0||0===d&&!s.lowerOpen&&u.lowerOpen)&&(s=(n=Object(v.__read)([u,s],2))[0],u=n[1]);var l=i(a(s),o(u));return l>0||0===l&&!s.upperOpen&&!u.lowerOpen},e.prototype.sort=function(e){var t=this.cmp,n=this.lowerOf;return e.sort((function(e,r){var i=t(n(e),n(r));return 0!==i||e.lowerOpen===r.lowerOpen?i:e.lowerOpen?-1:1}))},e.prototype.wrap=function(e,t){var n=this,r=n.cmp,i=n.lowerOf,o=n.upperOf,a=Object(v.__assign)({},e),c=r(i(e),i(t)),s=r(o(e),o(t));return(c>0||0===c&&!t.lowerOpen)&&(a.lower=t.lower,a.lowerOpen=t.lowerOpen),(s<0||0===s&&!t.upperOpen)&&(a.upper=t.upper,a.upperOpen=t.upperOpen),a},e.prototype.overlap=function(e,t){var n=this,r=n.cmp,i=n.lowerOf,o=n.upperOf,a=Object(v.__assign)({},e),c=r(i(e),i(t)),s=r(o(e),o(t));return(c<0||0===c&&!e.lowerOpen)&&(a.lower=t.lower,a.lowerOpen=t.lowerOpen),(s>0||0===s&&!e.upperOpen)&&(a.upper=t.upper,a.upperOpen=t.upperOpen),a},e}(),_e=function(){function e(e,t){this.node=e,this.parent=t,this.context=xe(e)}return e.prototype.perform=function(e){return Object(v.__awaiter)(this,void 0,void 0,(function(){var t,n,r,i,o,a,c,s,u;return Object(v.__generator)(this,(function(d){for(t=[],n=this.node,r=[t];n;)n.regroup&&(t=[],r.push(t)),t.push(this.createFilter(n)),n=n.nextFilter;i=function(e){var t=Object(v.__read)(e,2)[1];return r.some((function(e){return e.every((function(e){return e(t)}))}))};try{for(o=Object(v.__values)(this.context.inputs),a=o.next();!a.done;a=o.next())c=a.value,e.push(c.filter(i))}catch(e){s={error:e}}finally{try{a&&!a.done&&(u=o.return)&&u.call(o)}finally{if(s)throw s.error}}return[2]}))}))},e.prototype.createFilter=function(e){var t=new be(e.comparer);return function(n){return e.intervals.some((function(r){if(void 0===n)throw new W("can not do filter on non-hydrated data");var i=x(n,e.path);return E(i)&&t.contains(r,i)}))}},e}();var ve=function(){function e(e,t,n){this.node=e,this.parent=t,this.transaction=n,this.context=xe(e)}return e.prototype.perform=function(e){return Object(v.__awaiter)(this,void 0,void 0,(function(){var t,n,r,i,o,a,c,s,u=this;return Object(v.__generator)(this,(function(d){switch(d.label){case 0:t=this.transaction.table(this.node.collectionSchema.name),n=function(n){var r;return Object(v.__generator)(this,(function(i){switch(i.label){case 0:return r=n.filter((function(e){return!function(e){return!!Object(v.__read)(e,2)[1]}(e)})),[4,Promise.all(r.map((function(e,n){var i=Object(v.__read)(e,1)[0];return Object(v.__awaiter)(u,void 0,void 0,(function(){var e;return Object(v.__generator)(this,(function(o){switch(o.label){case 0:return[4,t.get(i)];case 1:return e=o.sent(),r[n][1]=e,[2]}}))}))})))];case 1:return i.sent(),e.push(n),[2]}}))},d.label=1;case 1:d.trys.push([1,6,7,8]),r=Object(v.__values)(this.context.inputs),i=r.next(),d.label=2;case 2:return i.done?[3,5]:(o=i.value,[5,n(o)]);case 3:d.sent(),d.label=4;case 4:return i=r.next(),[3,2];case 5:return[3,8];case 6:return a=d.sent(),c={error:a},[3,8];case 7:try{i&&!i.done&&(s=r.return)&&s.call(r)}finally{if(c)throw c.error}return[7];case 8:return[2]}}))}))},e}(),ye=function(){function e(e,t,n,r){this.lower=e,this.upper=t,this.lowerOpen=n,this.upperOpen=r}return e.getKeyRange=function(e,t){if(void 0!==t){if(!e.isValid(t))throw new Error("invalid key interval");var n=t.lower,r=t.upper,i=t.lowerOpen,o=t.upperOpen;return n===r?n:void 0!==n&&void 0!==r?IDBKeyRange.bound(n,r,i,o):void 0!==n?IDBKeyRange.lowerBound(n,i):IDBKeyRange.upperBound(r,o)}},e}(),ge=function(){function e(e,t){var n=this;this.comparer=t,this.math=new be(t),this.intervals=e.filter((function(e){return n.math.isValid(e)}))}return e.fromWherePredicate=function(t,n){var r,i,o;try{for(var a=Object(v.__values)(Object.keys(t)),c=a.next();!c.done;c=a.next()){var s=c.value,u=t[s];if(void 0!==u){var d=e.fromWhereExp(s,u,n);o=o?o.intersect(d):d}}}catch(e){r={error:e}}finally{try{c&&!c.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return o||this.createFullGroup(n)},e.fromWhereExp=function(t,n,r){var i;if(t===y.In||t===y.NotIn){if(!Array.isArray(n))throw new F({op:t});var o=n;return t===y.In?o.reduce((function(t,n){return t.union(e.fromWhereExp(y.Equals,n,r))}),this.createEmptyGroup(r)):o.reduce((function(t,n,i){var o=e.fromWhereExp(y.NotEquals,n,r);return i?t.intersect(o):o}),this.createFullGroup(r))}switch(t){case y.Equals:i=[new ye(n,n,!1,!1)];break;case y.NotEquals:i=[new ye(void 0,n,!0,!0),new ye(n,void 0,!0,!0)];break;case y.GreaterThan:i=[new ye(n,void 0,!0,!0)];break;case y.GreaterOrEqualThan:i=[new ye(n,void 0,!1,!0)];break;case y.LessThan:i=[new ye(void 0,n,!0,!0)];break;case y.LessOrEqualThan:i=[new ye(void 0,n,!0,!1)];break;default:throw new V(t)}return new e(i,r)},e.prototype.union=function(t){return new e(this.math.union(Object(v.__spreadArray)(Object(v.__spreadArray)([],Object(v.__read)(this.intervals)),Object(v.__read)(t.intervals))),this.comparer)},e.prototype.intersect=function(t){for(var n=this.math,r=n.cmp,i=n.upperOf,o=n.lowerOf,a=n.intersect,c=Object(v.__read)([this.intervals,t.intervals],2),s=c[0],u=c[1],d=Object(v.__read)([0,0],2),l=d[0],p=d[1],f=[];l<s.length;){for(;p<u.length&&r(i(s[l]),o(u[p]))>=0;){var h=a([s[l],u[p]]);f.push.apply(f,Object(v.__spreadArray)([],Object(v.__read)(h))),p+=1}p-=1,l+=1}return new e(f,this.comparer)},e.prototype.contains=function(e){var t=this;return!!this.intervals.find((function(n){return t.math.contains(n,e)}))},e.prototype.isEmpty=function(){return 0===this.intervals.length},e.prototype.isFull=function(){return!!this.intervals.length&&void 0===this.intervals[0].lower&&void 0===this.intervals[0].upper},e.createFullGroup=function(t){return new e([new ye(void 0,void 0,!0,!0)],t)},e.createEmptyGroup=function(t){return new e([],t)},e}(),me=ye,Oe=function(){function e(e,t,n){this.node=e,this.parent=t,this.transaction=n,this.context=xe(e)}return e.prototype.perform=function(e){return Object(v.__awaiter)(this,void 0,void 0,(function(){var t,n,r,i,o;return Object(v.__generator)(this,(function(a){switch(a.label){case 0:return this.node.hydrate?[3,2]:[4,this.scanKeys()];case 1:return t=a.sent(),e.push(t.map((function(e){return[e,void 0]}))),[2];case 2:return(n=this.node.collectionSchema.key.path)?[4,this.scanValues()]:[3,4];case 3:return r=a.sent(),e.push(r.map((function(e){return[x(e,n),e]}))),[2];case 4:return[4,this.scanKeys()];case 5:return i=a.sent(),[4,this.scanValues()];case 6:return o=a.sent(),e.push(i.map((function(e,t){return[e,o[t]]}))),[2]}}))}))},e.prototype.scanKeys=function(){return Object(v.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(v.__generator)(this,(function(n){switch(n.label){case 0:return e=this.getKeyQueries(),t=this.getIndex(),[4,Promise.all(e.map((function(e){return t.getAllKeys(e)})))];case 1:return[2,n.sent().reduce((function(e,t){return e.push.apply(e,Object(v.__spreadArray)([],Object(v.__read)(t))),e}),[])]}}))}))},e.prototype.scanValues=function(){return Object(v.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(v.__generator)(this,(function(n){switch(n.label){case 0:return e=this.getKeyQueries(),t=this.getIndex(),[4,Promise.all(e.map((function(e){return t.getAll(e)})))];case 1:return[2,n.sent().reduce((function(e,t){return e.push.apply(e,Object(v.__spreadArray)([],Object(v.__read)(t))),e}),[])]}}))}))},e.prototype.getKeyQueries=function(){var e=new be(this.node.comparer);return this.node.intervals.map((function(t){return me.getKeyRange(e,t)}))},e.prototype.getIndex=function(){var e=this.node,t=e.collectionSchema,n=e.index;return this.transaction.table(t.name).index(n.name)},e}(),je=function(){function e(e,t){this.node=e,this.parent=t,this.context=xe(e)}return e.prototype.perform=function(e){return Object(v.__awaiter)(this,void 0,void 0,(function(){var t,n,r,i,o,a,c,s,u,d,l,p,f;return Object(v.__generator)(this,(function(h){if(n=(t=this).context,r=t.node,!(i=n.inputs).length)return[2];if(1===i.length)return e.push(i[0]),[2];o=function(e,t){var n=Object(v.__read)(e,1)[0],i=Object(v.__read)(t,1)[0];return r.comparer.cmp(n,i)},a=new le({cmp:o}),c=this.getSmallestPointers(i).slice();try{for(s=Object(v.__values)(i),u=s.next();!u.done;u=s.next())u.value.sort(o)}catch(e){p={error:e}}finally{try{u&&!u.done&&(f=s.return)&&f.call(s)}finally{if(p)throw p.error}}return d=function(e){return i.every((function(t){return a.has(t,e)}))},l=c.filter(d),e.push(l),[2]}))}))},e.prototype.getSmallestPointers=function(e){return e.reduce((function(e,t){return e.length<t.length?e:t}),this.context.inputs[0])},e}(),we=function(){function e(e,t){this.node=e,this.parent=t,this.context=xe(e)}return e.prototype.perform=function(e){return Object(v.__awaiter)(this,void 0,void 0,(function(){var t,n,r,i,o,a,c,s;return Object(v.__generator)(this,(function(u){t=this.node,n=t.offset,r=t.limit;try{for(i=Object(v.__values)(this.context.inputs),o=i.next();!o.done;o=i.next())a=o.value,e.push(a.slice(n,!r||isNaN(r)?void 0:n+r))}catch(e){c={error:e}}finally{try{o&&!o.done&&(s=i.return)&&s.call(i)}finally{if(c)throw c.error}}return[2]}))}))},e}(),Ie=function(){function e(e,t,n){this.node=e,this.parent=t,this.transaction=n,this.context=xe(e)}return e.prototype.perform=function(e){return Object(v.__awaiter)(this,void 0,void 0,(function(){var t,n,r,i,o;return Object(v.__generator)(this,(function(a){switch(a.label){case 0:return this.node.hydrate?[3,2]:[4,this.scanKeys()];case 1:return t=a.sent(),e.push(t.map((function(e){return[e,void 0]}))),[2];case 2:return(n=this.node.collectionSchema.key.path)?[4,this.scanValues()]:[3,4];case 3:return r=a.sent(),e.push(r.map((function(e){return[x(e,n),e]}))),[2];case 4:return[4,this.scanKeys()];case 5:return i=a.sent(),[4,this.scanValues()];case 6:return o=a.sent(),e.push(i.map((function(e,t){return[e,o[t]]}))),[2]}}))}))},e.prototype.scanKeys=function(){return Object(v.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(v.__generator)(this,(function(n){switch(n.label){case 0:return e=this.getKeyQueries(),t=this.getTable(),[4,Promise.all(e.map((function(e){return t.getAllKeys(e)})))];case 1:return[2,n.sent().reduce((function(e,t){return e.push.apply(e,Object(v.__spreadArray)([],Object(v.__read)(t))),e}),[])]}}))}))},e.prototype.scanValues=function(){return Object(v.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(v.__generator)(this,(function(n){switch(n.label){case 0:return e=this.getKeyQueries(),t=this.getTable(),[4,Promise.all(e.map((function(e){return t.getAll(e)})))];case 1:return[2,n.sent().reduce((function(e,t){return e.push.apply(e,Object(v.__spreadArray)([],Object(v.__read)(t))),e}),[])]}}))}))},e.prototype.getKeyQueries=function(){var e=new be(this.node.comparer);return this.node.type===ie.SCAN_ALL?[void 0]:this.node.intervals.map((function(t){return me.getKeyRange(e,t)}))},e.prototype.getTable=function(){var e=this.node.collectionSchema;return this.transaction.table(e.name)},e}(),Se=function(){function e(e,t){this.node=e,this.parent=t,this.context=xe(e)}return e.prototype.perform=function(e){return Object(v.__awaiter)(this,void 0,void 0,(function(){var t,n,r,i,o,a,c,s,u,d=this;return Object(v.__generator)(this,(function(l){t=this.node,n=t.comparer,r=t.path,i=t.order;try{for(o=Object(v.__values)(this.context.inputs),a=o.next();!a.done;a=o.next())(c=a.value).sort((function(e,t){var o=Object(v.__read)(e,2)[1],a=Object(v.__read)(t,2)[1],c=x(o,r),s=x(a,r),u=d.getComparerByType(n,i);if(E(c)&&E(s))return u(c,s);throw new G})),e.push(c)}catch(e){s={error:e}}finally{try{a&&!a.done&&(u=o.return)&&u.call(o)}finally{if(s)throw s.error}}return[2]}))}))},e.prototype.getComparerByType=function(e,t){return t===j.ASCENDING?function(t,n){return e.cmp(t,n)}:function(t,n){return-e.cmp(t,n)}},e}(),Ee=function(){function e(e,t){this.node=e,this.parent=t,this.context=xe(e)}return e.prototype.perform=function(e){return Object(v.__awaiter)(this,void 0,void 0,(function(){return Object(v.__generator)(this,(function(t){return e.push(this.context.inputs.reduce((function(e,t){return e.push.apply(e,Object(v.__spreadArray)([],Object(v.__read)(t))),e}),[])),[2]}))}))},e}();function xe(e){return{total:e.children.length,done:0,inputs:[]}}var Ce=function(){function e(e,t){this.onRequestSuccess=function(){},this.onRequestFailed=function(){},this.request=e,this.transaction=t,this.jobs=new Map}return e.prototype.exec=function(){return Object(v.__awaiter)(this,void 0,void 0,(function(){var e=this;return Object(v.__generator)(this,(function(t){return this.task||(this.task=new Promise((function(t,n){e.onRequestSuccess=function(n){e.reset(),t(n)},e.onRequestFailed=function(t){return Object(v.__awaiter)(e,void 0,void 0,(function(){return Object(v.__generator)(this,(function(e){return this.reset(),n(t),[2]}))}))},e.traverse(e.request.root,(function(t,n){var r=function(e,t,n){var r;return(r={},r[ie.FILL]=function(){return new de(e,t)},r[ie.DISTINCT]=function(){return new pe(e,t)},r[ie.FILTER]=function(){return new _e(e,t)},r[ie.HYDRATE]=function(){return new ve(e,t,n)},r[ie.INDEX_SCAN]=function(){return new Oe(e,t,n)},r[ie.INTERSECT]=function(){return new je(e,t)},r[ie.PAGINATE]=function(){return new we(e,t)},r[ie.SCAN]=function(){return new Ie(e,t,n)},r[ie.SCAN_ALL]=function(){return new Ie(e,t,n)},r[ie.SORT]=function(){return new Se(e,t)},r[ie.UNION]=function(){return new Ee(e,t)},r)[e.type]()}(t,n&&e.jobs.get(n)||null,e.transaction);e.jobs.set(t,r),t.children.length||e.beginJob(r).catch((function(t){e.onRequestFailed(t)}))}))}))),[2,this.task]}))}))},e.prototype.beginJob=function(e){var t;return Object(v.__awaiter)(this,void 0,void 0,(function(){var n,r,i=this;return Object(v.__generator)(this,(function(o){switch(o.label){case 0:n=(null===(t=e.parent)||void 0===t?void 0:t.context.inputs)||[],o.label=1;case 1:return o.trys.push([1,3,,4]),[4,e.perform(n)];case 2:return o.sent(),this.finishJob(e,n).catch((function(e){i.onRequestFailed(e)})),[3,4];case 3:return r=o.sent(),this.onRequestFailed(r),[3,4];case 4:return[2]}}))}))},e.prototype.finishJob=function(e,t){return Object(v.__awaiter)(this,void 0,void 0,(function(){var n,r=this;return Object(v.__generator)(this,(function(i){return e.parent&&((n=e.parent.context).done+=1,n.done===n.total&&this.beginJob(e.parent).catch((function(e){r.onRequestFailed(e)}))),e.node===this.request.root&&this.onRequestSuccess(t),[2]}))}))},e.prototype.reset=function(){this.jobs=new Map,this.task=void 0,this.onRequestSuccess=function(){},this.onRequestFailed=function(){}},e.prototype.traverse=function(e,t,n){var r,i;t(e,n);try{for(var o=Object(v.__values)(e.children),a=o.next();!a.done;a=o.next()){var c=a.value;this.traverse(c,t,e)}}catch(e){r={error:e}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}},e}(),Ae=function(){function e(e){this.comparer=e}return e.prototype.rewrite=function(e){return{offset:e.offset,limit:e.limit,order:e.order&&Object(v.__assign)({},e.order),exp:this.rewriteWhereClauses(e.whereClauses)}},e.prototype.rewriteWhereClauses=function(e){var t,n,r,i,o;if(!e.length)return{type:m.ALL};var a={type:m.OR,exps:[]};try{for(var c=Object(v.__values)(e),s=c.next();!s.done;s=c.next()){var u=s.value,d={type:m.AND,exps:[]};try{for(var l=(r=void 0,Object(v.__values)(Object.entries(u))),p=l.next();!p.done;p=l.next()){var f=Object(v.__read)(p.value,2),h=f[0],b=f[1];if(void 0!==b){var _=E(b)?((o={})[y.Equals]=b,o):b;this.isEmptyPredicate(_)||d.exps.push({type:m.FILTER,predicate:_,path:h,hints:{intervalGroup:ge.fromWherePredicate(_,this.comparer),isKey:!1,indices:[]}})}}}catch(e){r={error:e}}finally{try{p&&!p.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}a.exps.push(d)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}return a},e.prototype.isEmptyPredicate=function(e){return Object.values(e).every((function(e){return void 0===e}))},e}(),ke=function(){function e(e){this.schema=e,this.indicesMap=new Map,this.warmupIndicesMap()}return e.prototype.bind=function(e){return this.bindQueryHints(e.exp),e},e.prototype.bindQueryHints=function(e){var t,n=this,r=e;r.type!==m.AND&&r.type!==m.OR?r.type===m.FILTER&&(r.hints.isKey=this.schema.key&&C(this.schema.key.path,r.path),r.hints.indices=null!==(t=this.indicesMap.get(r.path))&&void 0!==t?t:[]):r.exps.forEach((function(e){return n.bindQueryHints(e)}))},e.prototype.warmupIndicesMap=function(){var e,t,n,r,i;try{for(var o=Object(v.__values)(this.schema.indices.entries()),a=o.next();!a.done;a=o.next()){var c=Object(v.__read)(a.value,2),s=c[0],u=c[1];u.priority=null!==(i=u.priority)&&void 0!==i?i:-(s+1);var d=Array.isArray(u.path)?u.path:[u.path];try{for(var l=(n=void 0,Object(v.__values)(d)),p=l.next();!p.done;p=l.next()){var f=p.value,h=this.indicesMap.get(f)||[];h.push(u),this.indicesMap.set(f,h)}}catch(e){n={error:e}}finally{try{p&&!p.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},e}(),Re=function(){function e(e,t){this.collectionSchema=e,this.comparer=t}return e.prototype.plan=function(e,t){return{root:this.getRootNode(e,t),aggregate:t}},e.prototype.getRootNode=function(e,t){if(e.exp.type===m.NONE)return this.getSkipNode();var n=this.getBaseNode(e.exp);return(t===O.ENTRIES||t===O.VALUES||e.order)&&(n=this.getHydrateNode([n])),e.order&&(n=this.getSortNode(e.order.path,e.order.type,[n])),(e.offset||e.limit!==S)&&(n=this.getPaginateNode(e.offset,e.limit,[n])),n=this.getDistinctNode([n])},e.prototype.getBaseNode=function(e){return e.type===m.ALL?this.getScanAllNode():e.type===m.NONE?this.getSkipNode():e.type===m.FILTER?this.getFilterNode(e):this.getLogicExpNode(e)},e.prototype.getLogicExpNode=function(e){var t,n,r=[];try{for(var i=Object(v.__values)(e.exps),o=i.next();!o.done;o=i.next()){var a=o.value;r.push(a.type===m.FILTER?this.getFilterNode(a):this.getLogicExpNode(a))}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return e.type===m.AND?this.getIntersectNode(r):this.getUnionNode(r)},e.prototype.getFilterNode=function(e){if(!e.path||e.hints.isKey)return this.getScanNode(e.hints.intervalGroup.intervals);var t=e.hints.indices.find((function(t){return C(t.path,e.path)}));return t?this.getIndexScanNode(e.hints.intervalGroup.intervals,t):this.getMemFilterNode(e.hints.intervalGroup.intervals,e.path)},e.prototype.getIntersectNode=function(e){return{type:ie.INTERSECT,comparer:this.comparer,children:e}},e.prototype.getDistinctNode=function(e){return void 0===e&&(e=[]),{type:ie.DISTINCT,comparer:this.comparer,children:e}},e.prototype.getUnionNode=function(e){return void 0===e&&(e=[]),{type:ie.UNION,children:e}},e.prototype.getHydrateNode=function(e){return void 0===e&&(e=[]),{type:ie.HYDRATE,collectionSchema:this.collectionSchema,children:e}},e.prototype.getPaginateNode=function(e,t,n){return void 0===n&&(n=[]),{type:ie.PAGINATE,offset:e,limit:t,children:n}},e.prototype.getSortNode=function(e,t,n){return void 0===n&&(n=[]),{type:ie.SORT,path:e,order:t,comparer:this.comparer,children:n}},e.prototype.getMemFilterNode=function(e,t,n){return{type:ie.FILTER,comparer:this.comparer,path:t,intervals:e,regroup:!1,children:[{type:ie.HYDRATE,collectionSchema:this.collectionSchema,children:n||[this.getScanAllNode()]}]}},e.prototype.getIndexScanNode=function(e,t){return{type:ie.INDEX_SCAN,collectionSchema:this.collectionSchema,index:t,intervals:e,comparer:this.comparer,children:[]}},e.prototype.getScanNode=function(e){return{type:ie.SCAN,collectionSchema:this.collectionSchema,intervals:e,comparer:this.comparer,children:[]}},e.prototype.getScanAllNode=function(){return{type:ie.SCAN_ALL,collectionSchema:this.collectionSchema,comparer:this.comparer,children:[]}},e.prototype.getSkipNode=function(){return{type:ie.FILL,inputs:[[]],children:[]}},e}(),De=function(){function e(){}return e.prototype.eliminate=function(e){var t=e;return t.exp=this.eliminateExp(e.exp),t},e.prototype.eliminateExp=function(e){return e.type===m.AND?this.eliminateAndExp(e):e.type===m.OR?this.eliminateOrExp(e):e.type===m.FILTER?this.eliminateFilterExp(e):e},e.prototype.eliminateAndExp=function(e){var t,n,r={type:m.AND,exps:[]};try{for(var i=Object(v.__values)(e.exps),o=i.next();!o.done;o=i.next()){var a=o.value,c=this.eliminateExp(a);if(c.type===m.NONE)return{type:m.NONE};c.type!==m.ALL&&r.exps.push(c)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r.exps.length?1===r.exps.length?r.exps[0]:r:{type:m.ALL}},e.prototype.eliminateOrExp=function(e){var t,n,r={type:m.OR,exps:[]};try{for(var i=Object(v.__values)(e.exps),o=i.next();!o.done;o=i.next()){var a=o.value,c=this.eliminateExp(a);if(c.type===m.ALL)return{type:m.ALL};c.type!==m.NONE&&r.exps.push(c)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r.exps.length?1===r.exps.length?e.exps[0]:r:{type:m.NONE}},e.prototype.eliminateFilterExp=function(e){return e.hints.intervalGroup.isEmpty()?{type:m.NONE}:e.hints.intervalGroup.isFull()?{type:m.ALL}:e},e}();var Te=function(){var e,t=!1;return function(n,r){if("function"!=typeof n[r])throw new Error("memo() must be decorated on one of function properties of target");Object.defineProperty(n,r,Object(v.__assign)(Object(v.__assign)({},Object.getOwnPropertyDescriptor(n,r)),{value:function(){return t||(e=n[r](),t=!0),e}}))}},Ne=ie.UNION,Me=ie.INTERSECT,Pe=ie.HYDRATE,Le=ie.INDEX_SCAN,Ue=ie.SCAN,Be=ie.SCAN_ALL,qe=ie.FILTER;function Fe(e){return Ve(e.root),e}function Ve(e){var t,n,r=e.children;try{for(var i=Object(v.__values)(r.entries()),o=i.next();!o.done;o=i.next()){var a=Object(v.__read)(o.value,2),c=a[0],s=a[1];if(Ve(s),[Me,Ne].includes(s.type)&&1===s.children.length){var u=s.children[0];r[c]=u}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}function Ge(e){return We(e.root),e}function We(e){var t,n,r,i,o=e.children;try{for(var a=Object(v.__values)(o.entries()),c=a.next();!c.done;c=a.next()){var s=Object(v.__read)(c.value,2),u=s[0],d=s[1];if(We(d),d.type===Pe){var l=!1;try{for(var p=(r=void 0,Object(v.__values)(d.children)),f=p.next();!f.done;f=p.next()){(h=f.value).type!==Ue&&h.type!==Le&&h.type!==Be||(l=!0,h.hydrate=!0)}}catch(e){r={error:e}}finally{try{f&&!f.done&&(i=p.return)&&i.call(p)}finally{if(r)throw r.error}}if(l&&1===d.children.length){var h=d.children[0];o[u]=h}}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}}function Ke(e){return e}function He(e){return Qe(e.root),e}function Qe(e){var t,n;ze(e.children,(function(r){if(Qe(r),r.type!==qe||!r.children.some((function(e){return e.type===Be})))return!0;if(n){var i=r;!function(e,t){var n=e;for(;e.nextFilter;)n=e.nextFilter;n.nextFilter=t}(n,i),i.regroup=e.type===Ne}else t=r;return n=r,!1})),t&&e.children.push(t)}function ze(e,t){for(var n=e,r=0,i=n.length-1;r<=i;){var o=n[r];t(o)?r+=1:(n[r]=n[i],n[i]=o,i-=1)}return n.splice(i+1)}function Ye(e){return Je(e.root),e}function Je(e){var t,n,r=e.children;try{for(var i=Object(v.__values)(r.entries()),o=i.next();!o.done;o=i.next()){var a=Object(v.__read)(o.value,2),c=a[0],s=a[1];if(Je(s),s.type===Me){var u=s.children.find((function(e){var t=e.type;return[Ue,Le].includes(t)}));if(u){var d=ze(s.children,(function(e){return e.type!==qe}));if(d.length){var l={type:Pe,collectionSchema:u.collectionSchema,children:[]};r[c]=tt.apply(void 0,Object(v.__spreadArray)(Object(v.__spreadArray)([],Object(v.__read)(d)),[l,s]))}}}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}function Xe(e){return[O.COUNT,O.KEYS].includes(e.aggregate)||et((function(e){e.type!==Ue&&e.type!==Le||(e.hydrate=!0)}),e.root),e}function $e(e){return et((function(e){var t,n,r,i,o;if(e.type===Me){var a=Number.MIN_SAFE_INTEGER;try{for(var c=Object(v.__values)(e.children),s=c.next();!s.done;s=c.next()){var u=s.value,d=Number.MIN_SAFE_INTEGER;u.type===Ue&&(d=0),u.type===Le&&u.index.priority&&(d=u.index.priority),a=Math.max(a,d)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}var l=e.children;try{for(var p=Object(v.__values)(l.entries()),f=p.next();!f.done;f=p.next()){var h=Object(v.__read)(f.value,2),b=h[0];if((u=h[1]).type===Le)(d=null!==(o=u.index.priority)&&void 0!==o?o:Number.MIN_SAFE_INTEGER)<a&&(l[b]=Ze(u))}}catch(e){r={error:e}}finally{try{f&&!f.done&&(i=p.return)&&i.call(p)}finally{if(r)throw r.error}}}}),e.root),e}function Ze(e){return{path:e.index.path,intervals:e.intervals,comparer:e.comparer,type:ie.FILTER,regroup:!1,children:[{type:ie.SCAN_ALL,collectionSchema:e.collectionSchema,comparer:e.comparer,hydrate:!0,children:[]}]}}function et(e,t,n,r){var i,o;void 0===n&&(n=null),void 0===r&&(r=-1);var a=t.children;try{for(var c=Object(v.__values)(a.entries()),s=c.next();!s.done;s=c.next()){var u=Object(v.__read)(s.value,2),d=u[0];et(e,u[1],t,d)}}catch(e){i={error:e}}finally{try{s&&!s.done&&(o=c.return)&&o.call(c)}finally{if(i)throw i.error}}e(t,n,r)}function tt(){for(var e,t,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i=Object(v.__read)(n),o=i[0],a=i.slice(1),c=o;try{for(var s=Object(v.__values)(a),u=s.next();!u.done;u=s.next()){var d=u.value;c.children=[d],c=d}}catch(t){e={error:t}}finally{try{u&&!u.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}return o}var nt,rt=function(){function e(){}return e.prototype.optimize=function(e){var t=[$e,Ge,He,Fe,Ye,Ke,Fe,Ge,Xe];return this.applyAllRules(t,e)},e.prototype.applyAllRules=function(e,t){return e.reduce((function(e,t){return t(e)}),t)},e}(),it=function(){function e(e){void 0===e&&(e=new Map),this.query={offset:0,limit:void 0,order:void 0,whereClauses:[]},this.aliasMap=e}return e.fromRawQuery=function(t,n){var r,i;void 0===n&&(n=new Map);var o=new e(n),a=t.offset,c=t.limit,s=t.order,u=t.whereClauses;o.setOffset(a),o.setLimit(c),s&&o.setOrderBy(s.path,s.type);try{for(var d=Object(v.__values)(u),l=d.next();!l.done;l=d.next()){var p=l.value;o.addWhereClause(p)}}catch(e){r={error:e}}finally{try{l&&!l.done&&(i=d.return)&&i.call(d)}finally{if(r)throw r.error}}return o},e.prototype.setOffset=function(e){this.query.offset=e},e.prototype.setLimit=function(e){this.query.limit=e},e.prototype.setRange=function(e,t){void 0===e&&(e=0),this.query.offset=e,this.query.limit=t!==S?Math.max(0,t-e):S},e.prototype.setOrderBy=function(e,t){this.query.order={path:e,type:t||j.ASCENDING}},e.prototype.addWhereClause=function(e){var t,n,r;if(this.isValidWhereClause(e)){var i={};try{for(var o=Object(v.__values)(Object.entries(e)),a=o.next();!a.done;a=o.next()){var c=Object(v.__read)(a.value,2),s=c[0],u=c[1];if(void 0!==u)i[null!==(r=this.aliasMap.get(s))&&void 0!==r?r:s]=u}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}this.query.whereClauses.push(i)}},e.prototype.clone=function(t){return void 0===t&&(t=this.aliasMap),e.fromRawQuery(this.query,t)},e.prototype.build=function(){return this.query},e.prototype.isValidWhereClause=function(e){return!!e&&Object.keys(e).length>=0},e}();!function(e){e.DISABLED="disabled",e.ALL="all"}(nt||(nt={}));var ot,at=function(){function e(e,t){this.collectionName=e,this.context=t.context}return e.toggleOptimization=function(t){e.optimization=t?nt.ALL:nt.DISABLED},e.getOptimizationMode=function(){return e.optimization},e.prototype.exec=function(e,t){return Object(v.__awaiter)(this,void 0,void 0,(function(){var n,r,i,o,a,c,s,u;return Object(v.__generator)(this,(function(d){switch(d.label){case 0:return[4,this.context.getTransaction([this.collectionName],A.READ_ONLY)];case 1:return n=d.sent(),[4,this.getModel()];case 2:return r=d.sent(),i=this.getAliasMap(r.class),o=it.fromRawQuery(e,i).build(),(a=n.table(this.collectionName)).supports("query")&&o.whereClauses.length<=1?t!==O.VALUES?[3,4]:[4,a.query(o,t)]:[3,7];case 3:return[2,d.sent().map((function(e){var t;return null!==(t=ue(e,r.class))&&void 0!==t?t:void 0}))];case 4:return t!==O.ENTRIES?[3,6]:[4,a.query(o,t)];case 5:return[2,d.sent().map((function(e){var t,n=Object(v.__read)(e,2);return[n[0],null!==(t=ue(n[1],r.class))&&void 0!==t?t:void 0]}))];case 6:return[2,a.query(o,t)];case 7:return[4,this.getQueryPlan(o,t)];case 8:return c=d.sent(),[4,new Ce(c,n).exec()];case 9:return s=v.__read.apply(void 0,[d.sent(),1]),u=s[0],t===O.COUNT?[2,u.length]:t===O.KEYS?[2,u.map((function(e){return Object(v.__read)(e,1)[0]}))]:t===O.VALUES?[2,u.map((function(e){var t;return null!==(t=ue(Object(v.__read)(e,2)[1],r.class))&&void 0!==t?t:void 0}))]:[2,u.map((function(e){var t,n=Object(v.__read)(e,2);return[n[0],null!==(t=ue(n[1],r.class))&&void 0!==t?t:void 0]}))]}}))}))},e.prototype.conditions=function(e){return this.getRewriter().rewrite(e)},e.prototype.explain=function(e,t){return Object(v.__awaiter)(this,void 0,void 0,(function(){return Object(v.__generator)(this,(function(n){switch(n.label){case 0:return[4,this.getQueryPlan(e,t)];case 1:return[2,n.sent()]}}))}))},e.prototype.getQueryPlan=function(t,n){return Object(v.__awaiter)(this,void 0,void 0,(function(){var r,i,o,a,c,s,u;return Object(v.__generator)(this,(function(d){switch(d.label){case 0:return[4,this.getRewriter()];case 1:return r=d.sent(),[4,this.getEliminator()];case 2:return i=d.sent(),[4,this.getPlanner()];case 3:return o=d.sent(),[4,this.getBinder()];case 4:return a=d.sent(),[4,this.getOptimizer()];case 5:return c=d.sent(),s=r.rewrite(t),s=a.bind(s),s=i.eliminate(s),u=o.plan(s,n),[2,e.optimization===nt.DISABLED?u:c.optimize(u)]}}))}))},e.prototype.getAliasMap=function(e){var t,n,r=new Map,i=J.getTableInfo(e.prototype);if(!i)return r;try{for(var o=Object(v.__values)(i.properties.values()),a=o.next();!a.done;a=o.next()){var c=a.value;c.alias&&r.set(c.name,c.alias)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r},e.prototype.getModel=function(){return Object(v.__awaiter)(this,void 0,void 0,(function(){return Object(v.__generator)(this,(function(e){return[2,this.context.waitForModelRegistered(this.collectionName)]}))}))},e.prototype.getPlanner=function(){return Object(v.__awaiter)(this,void 0,void 0,(function(){var e;return Object(v.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.getModel()];case 1:return e=t.sent(),[2,new Re(e.schema,this.context.comparer)]}}))}))},e.prototype.getRewriter=function(){return new Ae(this.context.comparer)},e.prototype.getEliminator=function(){return new De},e.prototype.getBinder=function(){return Object(v.__awaiter)(this,void 0,void 0,(function(){var e;return Object(v.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.getModel()];case 1:return e=t.sent(),[2,new ke(e.schema)]}}))}))},e.prototype.getOptimizer=function(){return new rt},e.optimization=nt.ALL,Object(v.__decorate)([Te()],e.prototype,"getModel",null),Object(v.__decorate)([Te()],e.prototype,"getPlanner",null),Object(v.__decorate)([Te()],e.prototype,"getRewriter",null),Object(v.__decorate)([Te()],e.prototype,"getEliminator",null),Object(v.__decorate)([Te()],e.prototype,"getBinder",null),Object(v.__decorate)([Te()],e.prototype,"getOptimizer",null),e}(),ct=function(){function e(e,t){this.name=e,this.options=t,this.contextGenerator=t.contextGenerator,this.queryBuilder=new it,this.patch()}return e.toggleOptimization=function(e){return at.toggleOptimization(e)},e.prototype.skip=function(e){return this.queryBuilder.setOffset(e),this},e.prototype.take=function(e){return this.queryBuilder.setLimit(e),this},e.prototype.slice=function(e,t){return this.queryBuilder.setRange(e,t),this},e.prototype.orderBy=function(e,t){return this.queryBuilder.setOrderBy(e,t),this},e.prototype.where=function(e){return this.queryBuilder.addWhereClause(e),this},e.prototype.or=function(e){return this.queryBuilder.addWhereClause(e),this},e.prototype.conditions=function(){var e=this.contextGenerator.spawnContext();return new at(this.name,{context:e}).conditions(this.queryBuilder.build())},e.prototype.clone=function(){var t=new e(this.name,this.options);return t.queryBuilder=this.queryBuilder.clone(),t},e.prototype.explain=function(e){return Object(v.__awaiter)(this,void 0,void 0,(function(){var t;return Object(v.__generator)(this,(function(n){return t=this.contextGenerator.spawnContext(),[2,new at(this.name,{context:t}).explain(this.queryBuilder.build(),e)]}))}))},e.prototype.count=function(){return Object(v.__awaiter)(this,void 0,void 0,(function(){var e,t=this;return Object(v.__generator)(this,(function(n){return[2,(e=this.contextGenerator.spawnContext()).perform((function(){return Object(v.__awaiter)(t,void 0,void 0,(function(){return Object(v.__generator)(this,(function(t){return[2,new at(this.name,{context:e}).exec(this.queryBuilder.build(),O.COUNT)]}))}))}))]}))}))},e.prototype.entries=function(){return Object(v.__awaiter)(this,void 0,void 0,(function(){var e,t=this;return Object(v.__generator)(this,(function(n){return[2,(e=this.contextGenerator.spawnContext()).perform((function(){return Object(v.__awaiter)(t,void 0,void 0,(function(){return Object(v.__generator)(this,(function(t){return[2,new at(this.name,{context:e}).exec(this.queryBuilder.build(),O.ENTRIES)]}))}))}))]}))}))},e.prototype.keys=function(){return Object(v.__awaiter)(this,void 0,void 0,(function(){var e,t=this;return Object(v.__generator)(this,(function(n){return[2,(e=this.contextGenerator.spawnContext()).perform((function(){return Object(v.__awaiter)(t,void 0,void 0,(function(){return Object(v.__generator)(this,(function(t){return[2,new at(this.name,{context:e}).exec(this.queryBuilder.build(),O.KEYS)]}))}))}))]}))}))},e.prototype.values=function(){return Object(v.__awaiter)(this,void 0,void 0,(function(){var e,t=this;return Object(v.__generator)(this,(function(n){return[2,(e=this.contextGenerator.spawnContext()).perform((function(){return Object(v.__awaiter)(t,void 0,void 0,(function(){return Object(v.__generator)(this,(function(t){return[2,new at(this.name,{context:e}).exec(this.queryBuilder.build(),O.VALUES)]}))}))}))]}))}))},e.prototype.first=function(){return Object(v.__awaiter)(this,void 0,void 0,(function(){var e,t=this;return Object(v.__generator)(this,(function(n){return[2,(e=this.contextGenerator.spawnContext()).perform((function(){return Object(v.__awaiter)(t,void 0,void 0,(function(){var t,n;return Object(v.__generator)(this,(function(r){switch(r.label){case 0:return[4,new at(this.name,{context:e}).exec(this.queryBuilder.build(),O.VALUES)];case 1:return t=r.sent(),[2,null!==(n=t[0])&&void 0!==n?n:null]}}))}))}))]}))}))},e.prototype.last=function(){return Object(v.__awaiter)(this,void 0,void 0,(function(){var e,t=this;return Object(v.__generator)(this,(function(n){return[2,(e=this.contextGenerator.spawnContext()).perform((function(){return Object(v.__awaiter)(t,void 0,void 0,(function(){var t,n;return Object(v.__generator)(this,(function(r){switch(r.label){case 0:return[4,new at(this.name,{context:e}).exec(this.queryBuilder.build(),O.VALUES)];case 1:return t=r.sent(),[2,null!==(n=t[t.length-1])&&void 0!==n?n:null]}}))}))}))]}))}))},e.prototype.update=function(e){return Object(v.__awaiter)(this,void 0,void 0,(function(){var t,n,r=this;return Object(v.__generator)(this,(function(i){switch(i.label){case 0:return[4,this.entries()];case 1:return t=i.sent(),[2,(n=this.contextGenerator.spawnContext()).perform((function(){return Object(v.__awaiter)(r,void 0,void 0,(function(){var r,i,o,a,c,s,u,d,l,p,f,h,b;return Object(v.__generator)(this,(function(_){switch(_.label){case 0:return r=[],[4,n.getTransaction([this.name],A.READ_WRITE)];case 1:i=_.sent(),o=i.table(this.name),_.label=2;case 2:_.trys.push([2,8,9,10]),a=Object(v.__values)(t),c=a.next(),_.label=3;case 3:return c.done?[3,7]:(s=Object(v.__read)(c.value,2),u=s[0],d=s[1],[4,o.openCursor(u)]);case 4:return(l=_.sent())?(p=e(d),[4,l.update(se(p))]):[3,6];case 5:_.sent(),r.push(u),_.label=6;case 6:return c=a.next(),[3,3];case 7:return[3,10];case 8:return f=_.sent(),h={error:f},[3,10];case 9:try{c&&!c.done&&(b=a.return)&&b.call(a)}finally{if(h)throw h.error}return[7];case 10:return[2,r]}}))}))}))]}}))}))},e.prototype.clear=function(){return Object(v.__awaiter)(this,void 0,void 0,(function(){var e,t,n=this;return Object(v.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.keys()];case 1:return e=r.sent(),[2,(t=this.contextGenerator.spawnContext()).perform((function(){return Object(v.__awaiter)(n,void 0,void 0,(function(){var n,r,i,o,a,c,s,u,d,l;return Object(v.__generator)(this,(function(p){switch(p.label){case 0:return n=[],[4,t.getTransaction([this.name],A.READ_WRITE)];case 1:return r=p.sent(),(i=r.table(this.name)).supports("bulkDelete")?[4,i.bulkDelete(e)]:[3,3];case 2:return p.sent(),[2,e];case 3:p.trys.push([3,9,10,11]),o=Object(v.__values)(e),a=o.next(),p.label=4;case 4:return a.done?[3,8]:(c=a.value,[4,i.openCursor(c)]);case 5:return(s=p.sent())?[4,s.delete()]:[3,7];case 6:p.sent(),n.push(c),p.label=7;case 7:return a=o.next(),[3,4];case 8:return[3,11];case 9:return u=p.sent(),d={error:u},[3,11];case 10:try{a&&!a.done&&(l=o.return)&&l.call(o)}finally{if(d)throw d.error}return[7];case 11:return[2,n]}}))}))}))]}}))}))},e.prototype.patch=function(){var e=this.options.aspects;e.update.patch(this,"update"),e.clear.patch(this,"clear"),e.count.patch(this,"count"),e.entries.patch(this,"entries"),e.keys.patch(this,"keys"),e.values.patch(this,"values"),e.first.patch(this,"first"),e.last.patch(this,"last"),e.skip.patch(this,"skip"),e.take.patch(this,"take"),e.slice.patch(this,"slice"),e.orderBy.patch(this,"orderBy"),e.where.patch(this,"where"),e.or.patch(this,"or")},e}(),st=function(){function e(e,t){this.name=e,this.aspects=t.aspects,this.contextGenerator=t.contextGenerator,this.unsliced=new ct(e,t),this.patch()}return e.prototype.skip=function(e){return this.unsliced.clone().skip(e)},e.prototype.take=function(e){return this.unsliced.clone().take(e)},e.prototype.slice=function(e,t){return this.unsliced.clone().slice(e,t)},e.prototype.orderBy=function(e,t){return this.unsliced.clone().orderBy(e,t)},e.prototype.where=function(e){return this.unsliced.clone().where(e)},e.prototype.or=function(e){return this.unsliced.clone().or(e)},e.prototype.update=function(e){return this.unsliced.update(e)},e.prototype.clear=function(){return this.unsliced.clear()},e.prototype.count=function(){return this.unsliced.count()},e.prototype.entries=function(){return this.unsliced.entries()},e.prototype.keys=function(){return this.unsliced.keys()},e.prototype.values=function(){return this.unsliced.values()},e.prototype.first=function(){return this.unsliced.first()},e.prototype.last=function(){return this.unsliced.last()},e.prototype.get=function(e){return Object(v.__awaiter)(this,void 0,void 0,(function(){var t,n=this;return Object(v.__generator)(this,(function(r){return[2,(t=this.contextGenerator.spawnContext()).perform((function(){return Object(v.__awaiter)(n,void 0,void 0,(function(){var n,r,i;return Object(v.__generator)(this,(function(o){switch(o.label){case 0:return[4,t.getTransaction([this.name],A.READ_ONLY)];case 1:return n=o.sent(),[4,t.waitForModelRegistered(this.name)];case 2:return r=o.sent(),[4,n.table(this.name).get(e)];case 3:return[2,(i=o.sent())?ue(i,r.class):null]}}))}))}))]}))}))},e.prototype.has=function(e){return Object(v.__awaiter)(this,void 0,void 0,(function(){var t,n=this;return Object(v.__generator)(this,(function(r){return[2,(t=this.contextGenerator.spawnContext()).perform((function(){return Object(v.__awaiter)(n,void 0,void 0,(function(){var n;return Object(v.__generator)(this,(function(r){switch(r.label){case 0:return[4,t.getTransaction([this.name],A.READ_ONLY)];case 1:return n=r.sent(),[4,n.table(this.name).openCursor(e)];case 2:return[2,!!r.sent()]}}))}))}))]}))}))},e.prototype.delete=function(e){return Object(v.__awaiter)(this,void 0,void 0,(function(){var t,n=this;return Object(v.__generator)(this,(function(r){return[2,(t=this.contextGenerator.spawnContext()).perform((function(){return Object(v.__awaiter)(n,void 0,void 0,(function(){var n,r,i;return Object(v.__generator)(this,(function(o){switch(o.label){case 0:return[4,t.getTransaction([this.name],A.READ_WRITE)];case 1:return n=o.sent(),[4,(r=n.table(this.name)).openCursor(e)];case 2:return i=o.sent(),[4,r.delete(e)];case 3:return o.sent(),[2,i?e:null]}}))}))}))]}))}))},e.prototype.insert=function(e){return Object(v.__awaiter)(this,void 0,void 0,(function(){var t,n=this;return Object(v.__generator)(this,(function(r){return[2,(t=this.contextGenerator.spawnContext()).perform((function(){return Object(v.__awaiter)(n,void 0,void 0,(function(){var n;return Object(v.__generator)(this,(function(r){switch(r.label){case 0:return[4,t.getTransaction([this.name],A.READ_WRITE)];case 1:return n=r.sent(),[4,n.table(this.name).insert(se(e))];case 2:return[2,r.sent()]}}))}))}))]}))}))},e.prototype.upsert=function(e){return Object(v.__awaiter)(this,void 0,void 0,(function(){var t,n=this;return Object(v.__generator)(this,(function(r){return[2,(t=this.contextGenerator.spawnContext()).perform((function(){return Object(v.__awaiter)(n,void 0,void 0,(function(){var n;return Object(v.__generator)(this,(function(r){switch(r.label){case 0:return[4,t.getTransaction([this.name],A.READ_WRITE)];case 1:return n=r.sent(),[4,n.table(this.name).upsert(se(e))];case 2:return[2,r.sent()]}}))}))}))]}))}))},e.prototype.bulkInsert=function(e){return Object(v.__awaiter)(this,void 0,void 0,(function(){var t,n=this;return Object(v.__generator)(this,(function(r){return[2,(t=this.contextGenerator.spawnContext()).perform((function(){return Object(v.__awaiter)(n,void 0,void 0,(function(){var n,r,i,o,a,c,s,u,d,l;return Object(v.__generator)(this,(function(p){switch(p.label){case 0:return[4,t.getTransaction([this.name],A.READ_WRITE)];case 1:n=p.sent(),r=[],i=n.table(this.name),p.label=2;case 2:p.trys.push([2,7,8,9]),o=Object(v.__values)(e),a=o.next(),p.label=3;case 3:return a.done?[3,6]:(c=a.value,[4,i.insert(se(c))]);case 4:s=p.sent(),r.push(s),p.label=5;case 5:return a=o.next(),[3,3];case 6:return[3,9];case 7:return u=p.sent(),d={error:u},[3,9];case 8:try{a&&!a.done&&(l=o.return)&&l.call(o)}finally{if(d)throw d.error}return[7];case 9:return[2,r]}}))}))}))]}))}))},e.prototype.bulkUpsert=function(e){return Object(v.__awaiter)(this,void 0,void 0,(function(){var t,n=this;return Object(v.__generator)(this,(function(r){return[2,(t=this.contextGenerator.spawnContext()).perform((function(){return Object(v.__awaiter)(n,void 0,void 0,(function(){var n;return Object(v.__generator)(this,(function(r){switch(r.label){case 0:return[4,t.getTransaction([this.name],A.READ_WRITE)];case 1:return n=r.sent(),[2,n.table(this.name).bulkUpsert(e.map((function(e){return se(e)})))]}}))}))}))]}))}))},e.prototype.conditions=function(){return this.unsliced.conditions()},e.prototype.patch=function(){this.aspects.get.patch(this,"get"),this.aspects.has.patch(this,"has"),this.aspects.delete.patch(this,"delete"),this.aspects.insert.patch(this,"insert"),this.aspects.upsert.patch(this,"upsert"),this.aspects.bulkInsert.patch(this,"bulkInsert"),this.aspects.bulkUpsert.patch(this,"bulkUpsert")},e}(),ut=function(){function e(e,t){this.collectionMap=new Map,this.storage=e,this.eventBus=t}return e.prototype.getCollection=function(e,t){if(this.collectionMap.has(e))return this.collectionMap.get(e);var n=this.createCollection(e,t);return this.collectionMap.set(e,n),this.eventBus.emit(re.CollectionCreated,{collectionName:e,context:t.spawnContext()}),n},e.prototype.createCollection=function(e,t){var n=this.storage.aspects.collection;return new st(e,{contextGenerator:t,aspects:n})},e}(),dt=D.withMessageCreator("UnexpectedModifierError",(function(e){return'unexpected error occurred at the "'+e+'" stage of the plugable function, there may be a bug in your modifiers.'})),lt=D.withMessageCreator("InvalidPatchedFunctionError",(function(e){return'patched target is not a function, patched key is "'+e+'"'}));!function(e){e.before="before",e.around="around",e.return="return",e.throw="throw",e.after="after",e.protect="protect"}(ot||(ot={}));var pt=function(){function e(e){this.modifiers={before:[],around:[],return:[],throw:[],after:[],protect:[]},this.createContext=e}return e.prototype.before=function(e){return this.modifiers.before.push(e),this},e.prototype.around=function(e){return this.modifiers.around.push(e),this},e.prototype.throw=function(e){return this.modifiers.throw.push(e),this},e.prototype.return=function(e){return this.modifiers.return.push(e),this},e.prototype.after=function(e){return this.modifiers.after.push(e),this},e.prototype.protect=function(e){return this.modifiers.protect.push(e),this},e.prototype.patch=function(e,t){Object.defineProperty(e,t,{enumerable:!1,value:this.compile(e,t),writable:!0,configurable:!0})},e.prototype.dirty=function(){return Object.values(this.modifiers).some((function(e){return e.length}))},e.prototype.compile=function(e,t){var n=e[t];if("function"!=typeof n)throw new lt(t);var r=this.invoke.bind(this);return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r(n,this,e)}},e}(),ft=pt,ht=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(v.__extends)(t,e),t.create=function(){return new t((function(){return{}}))},t.withContext=function(e){return new t(e)},t.prototype.invoke=function(e,t,n){var r;if(!this.dirty())return e.call.apply(e,Object(v.__spreadArray)([t],Object(v.__read)(n)));var i=Object.assign(this.createContext(),{args:n,this:t,callee:e,return:void 0,error:void 0});try{this.trigger(ot.before,i,this.modifiers.protect),this.modifiers.around.length?this.trigger(ot.around,i,this.modifiers.protect):i.return=(r=i.callee).call.apply(r,Object(v.__spreadArray)([i.this],Object(v.__read)(i.args))),this.trigger(ot.return,i,this.modifiers.protect)}catch(e){throw this.modifiers.throw.length&&(Object.assign(i,{error:e}),this.trigger(ot.throw,i,this.modifiers.protect)),e}finally{this.trigger(ot.after,i,this.modifiers.protect)}return i.return},t.prototype.trigger=function(e,t,n){var r,i,o,a;try{for(var c=Object(v.__values)(this.modifiers[e]),s=c.next();!s.done;s=c.next()){var u=s.value;try{u.call(t.this,t)}catch(r){if(!n.length){N(new dt(e,r));continue}try{for(var d=(o=void 0,Object(v.__values)(n)),l=d.next();!l.done;l=d.next()){var p=l.value;Object.assign(t,{error:r}),p.call(t.this,t)}}catch(e){o={error:e}}finally{try{l&&!l.done&&(a=d.return)&&a.call(d)}finally{if(o)throw o.error}}}}}catch(e){r={error:e}}finally{try{s&&!s.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}},t}(ft),bt=ht,_t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(v.__extends)(t,e),t.create=function(){return new t((function(){return{}}))},t.withContext=function(e){return new t(e)},t.prototype.invoke=function(e,t,n){var r=this;if(!this.dirty())return e.call.apply(e,Object(v.__spreadArray)([t],Object(v.__read)(n)));var i=Object.assign(this.createContext(),{args:n,this:t,callee:e,return:void 0,error:void 0});return new Promise((function(e,t){Object(v.__awaiter)(r,void 0,void 0,(function(){var e,t,n,r;return Object(v.__generator)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,7,10,12]),[4,this.trigger(ot.before,i,this.modifiers.protect)];case 1:return o.sent(),this.modifiers.around.length?[3,3]:(e=(r=i.callee).call.apply(r,Object(v.__spreadArray)([i.this],Object(v.__read)(i.args))),t=i,[4,e]);case 2:return t.return=o.sent(),[3,5];case 3:return[4,this.trigger(ot.around,i,this.modifiers.protect)];case 4:o.sent(),o.label=5;case 5:return[4,this.trigger(ot.return,i,this.modifiers.protect)];case 6:return o.sent(),[3,12];case 7:return n=o.sent(),Object.assign(i,{error:n}),this.modifiers.throw.length?[4,this.trigger(ot.throw,i,this.modifiers.protect)]:[3,9];case 8:o.sent(),o.label=9;case 9:throw n;case 10:return[4,this.trigger(ot.after,i,this.modifiers.protect)];case 11:return o.sent(),[7];case 12:return[2]}}))})).then((function(){e(i.return)})).catch((function(e){t(e)}))}))},t.prototype.trigger=function(e,t,n){return Object(v.__awaiter)(this,void 0,void 0,(function(){var r,i,o,a,c,s,u,d,l,p,f,h,b;return Object(v.__generator)(this,(function(_){switch(_.label){case 0:_.trys.push([0,15,16,17]),r=Object(v.__values)(this.modifiers[e]),i=r.next(),_.label=1;case 1:if(i.done)return[3,14];o=i.value,_.label=2;case 2:return _.trys.push([2,4,,13]),[4,o.call(t.this,t)];case 3:return _.sent(),[3,13];case 4:if(a=_.sent(),!n.length)return N(new dt(e,a)),[3,13];_.label=5;case 5:_.trys.push([5,10,11,12]),h=void 0,c=Object(v.__values)(n),s=c.next(),_.label=6;case 6:return s.done?[3,9]:(u=s.value,Object.assign(t,{error:a}),[4,u.call(t.this,t)]);case 7:_.sent(),_.label=8;case 8:return s=c.next(),[3,6];case 9:return[3,12];case 10:return d=_.sent(),h={error:d},[3,12];case 11:try{s&&!s.done&&(b=c.return)&&b.call(c)}finally{if(h)throw h.error}return[7];case 12:return[3,13];case 13:return i=r.next(),[3,1];case 14:return[3,17];case 15:return l=_.sent(),p={error:l},[3,17];case 16:try{i&&!i.done&&(f=r.return)&&f.call(r)}finally{if(p)throw p.error}return[7];case 17:return[2]}}))}))},t}(ft),vt=_t;function yt(){return{timings:new Map,counters:new Map,messages:new Map,errors:new Map,flags:new Map,data:new Map}}var gt,mt=function(){function e(e,t){this.storage=e,this.eventBus=t,this.plugins=[]}return e.prototype.add=function(){for(var e,t,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];try{for(var i=Object(v.__values)(n),o=i.next();!o.done;o=i.next()){var a=o.value;this.plugins.push(a),a.register(this.storage),this.eventBus.emit(ne.RegisterPlugin,a)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},e}(),Ot=mt,jt=D.withMessageCreator("UnexpectedOutsideMigrationActionError",(function(e){return e+" outside ensure(callback) is not allowed, please wrap your migration actions inside a ensure callback"})),wt=function(){function e(e,t){this.name=e,this.context=t}return e.create=function(t){return{index:function(n){return new e(n,t)}}},e.prototype.create=function(e){var t=this.context.scope.collection;if(!t)throw new jt("CreateIndex");return this.context.actions.schema.push({type:r.CreateIndex,name:this.name,attributes:Object(v.__assign)({},e),collection:t}),this},e.prototype.drop=function(){var e=this.context.scope.collection;if(!e)throw new jt("DropIndex");this.context.actions.schema.push({type:r.DropIndex,name:this.name,collection:e})},e.prototype.alter=function(e){var t=this.context.scope.collection;if(!t)throw new jt("AlterIndex");return this.context.actions.schema.push({type:r.DropIndex,name:this.name,collection:t},{type:r.CreateIndex,name:this.name,attributes:Object(v.__assign)({},e),collection:t}),this},e.prototype.rename=function(e){var t=this.context.scope.collection;if(!t)throw new jt("RenameIndex");this.context.actions.schema.push({type:r.DropIndex,name:this.name,collection:t},{type:r.CreateIndex,name:e,attributes:{path:""},collection:t})},e.prototype.ensure=function(){throw new T},e}(),It=function(){function e(e,t){this.name=e,this.context=t}return e.create=function(t){return{collection:function(n){return new e(n,t)}}},e.prototype.create=function(e){return this.context.actions.schema.push({type:r.CreateCollection,name:this.name,attributes:Object(v.__assign)({},e)}),this},e.prototype.drop=function(){this.context.actions.schema.push({type:r.DropCollection,name:this.name})},e.prototype.alter=function(e){return this.context.actions.schema.push({type:r.DropCollection,name:this.name},{type:r.CreateCollection,name:this.name,attributes:Object(v.__assign)({},e)}),this},e.prototype.rename=function(e){this.context.actions.schema.push({type:r.DropCollection,name:this.name},{type:r.CreateCollection,name:e,attributes:{key:{generator:w.AutoIncrement},properties:[]}})},e.prototype.ensure=function(e){var t=this.context,n=Object(v.__assign)({},wt.create(t));this.context.scope.collection=this.name,e(n),this.context.scope.collection=null},e}(),St=function(){function e(){this.context={actions:{schema:[],data:[]},scope:{database:null,collection:null}},this.builder=It.create(this.context)}return e.prototype.init=function(e){this.state=e,this.build()},e.prototype.plan=function(){return this.context.actions.schema.length||this.context.actions.data.length?[{schema:{actions:this.context.actions.schema.slice()},data:{actions:this.context.actions.data.slice()}}]:[]},e.prototype.handleDropCollection=function(e){var t,n;try{for(var r=Object(v.__values)(e),i=r.next();!i.done;i=r.next()){var o=i.value;this.builder.collection(o.name).drop()}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},e.prototype.handleCreateCollection=function(e){var t,n,r=function(e){i.builder.collection(e.name).create(e).ensure((function(t){var n,r;try{for(var i=(n=void 0,Object(v.__values)(e.indices)),o=i.next();!o.done;o=i.next()){var a=o.value;t.index(a.name).create(a)}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}))},i=this;try{for(var o=Object(v.__values)(e),a=o.next();!a.done;a=o.next()){r(a.value)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}},e.prototype.handleIndexChange=function(e){var t,n,r=function(e){i.builder.collection(e.collection).ensure((function(t){var n,r,i,o,a,c;try{for(var s=(n=void 0,Object(v.__values)((null===(a=e.index)||void 0===a?void 0:a.added)||[])),u=s.next();!u.done;u=s.next()){var d=u.value;t.index(d.name).create(d)}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}try{for(var l=(i=void 0,Object(v.__values)((null===(c=e.index)||void 0===c?void 0:c.deleted)||[])),p=l.next();!p.done;p=l.next()){d=p.value;t.index(d.name).drop()}}catch(e){i={error:e}}finally{try{p&&!p.done&&(o=l.return)&&o.call(l)}finally{if(i)throw i.error}}}))},i=this;try{for(var o=Object(v.__values)(e),a=o.next();!a.done;a=o.next()){r(a.value)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}},e.prototype.build=function(){if(!this.state)throw new Error("Migration state is undefined, must init before!");var e=this.state.schema,t=e.expect,n=e.actual,r=k.databaseDiff(n,t);this.handleCreateCollection(r.added),this.handleDropCollection(r.deleted),this.handleIndexChange(r.different)},e}(),Et=g.name;!function(e){e.SYSTEM_TABLE="system_table",e.SCAN_EXISTING_TABLE="scan_exists_table"}(gt||(gt={}));var xt=function(){function e(){}return e.hasSystemTable=function(e){return e.tableNames.includes(Et)},e.getDatabaseSchema=function(t,n,r){return Object(v.__awaiter)(this,void 0,void 0,(function(){var i,o,a,c,s;return Object(v.__generator)(this,(function(u){switch(u.label){case 0:return[4,n.openDB(t,{name:t,collections:[g]})];case 1:i=u.sent(),o=!1,u.label=2;case 2:return u.trys.push([2,,10,11]),i.tableNames.length?[3,4]:(i.close(),o=!0,[4,n.deleteDB(t)]);case 3:return u.sent(),[2,{schema:{name:this.name,version:0,collections:[]},from:"scan_exists_table"}];case 4:return this.hasSystemTable(i)?[3,6]:[4,e.getDatabaseSchemaByScanningTableStructure(r.collections.map((function(e){return e.name})),i)];case 5:return[2,{schema:u.sent(),from:"scan_exists_table"}];case 6:return[4,i.transaction([Et],A.READ_ONLY)];case 7:return a=u.sent(),[4,a.table(Et).getAll()];case 8:return c=u.sent()||[],s={name:this.name,version:i.version,collections:Object(v.__spreadArray)(Object(v.__spreadArray)([],Object(v.__read)(c)),[this.getSystemTableSchema()])},[4,a.commit()];case 9:return u.sent(),[2,{schema:s,from:"system_table"}];case 10:return o||i.close(),[7];case 11:return[2]}}))}))},e.getSystemTableSchema=function(){return g},e.updateSchemaChange=function(e,t,n,r){return Object(v.__awaiter)(this,void 0,void 0,(function(){var i,o,a,c,s,u,d,l,p,f,h,b,_,y,g,m,O,j,w,I,S,E,x;return Object(v.__generator)(this,(function(C){switch(C.label){case 0:return i=t.table(Et),r?[4,i.bulkUpsert(n.schema.expect.collections.filter((function(e){return e.name!==Et})))]:[3,2];case 1:return C.sent(),[2];case 2:C.trys.push([2,27,,29]),o=k.databaseDiff(n.schema.actual,n.schema.expect),a=o.added.filter((function(e){return e.name!==Et})),C.label=3;case 3:C.trys.push([3,8,9,10]),c=Object(v.__values)(a),s=c.next(),C.label=4;case 4:return s.done?[3,7]:((p=s.value).dataVersion=e,[4,i.upsert(p)]);case 5:C.sent(),C.label=6;case 6:return s=c.next(),[3,4];case 7:return[3,10];case 8:return u=C.sent(),j={error:u},[3,10];case 9:try{s&&!s.done&&(w=c.return)&&w.call(c)}finally{if(j)throw j.error}return[7];case 10:C.trys.push([10,15,16,17]),d=Object(v.__values)(o.deleted),l=d.next(),C.label=11;case 11:return l.done?[3,14]:(p=l.value,[4,i.delete(p.name)]);case 12:C.sent(),C.label=13;case 13:return l=d.next(),[3,11];case 14:return[3,17];case 15:return f=C.sent(),I={error:f},[3,17];case 16:try{l&&!l.done&&(S=d.return)&&S.call(d)}finally{if(I)throw I.error}return[7];case 17:h=o.different.filter((function(e){return!!e.index})),b=function(e){var t,n,r;return Object(v.__generator)(this,(function(o){switch(o.label){case 0:return[4,i.get(e.collection)];case 1:return t=o.sent(),n=[],r=t.indices.filter((function(t){return!e.index.deleted.some((function(e){return e.name===t.name}))})),n.push.apply(n,Object(v.__spreadArray)([],Object(v.__read)(e.index.added))),n.push.apply(n,Object(v.__spreadArray)([],Object(v.__read)(r))),t.index=n,[4,i.upsert(t)];case 2:return o.sent(),[2]}}))},C.label=18;case 18:C.trys.push([18,23,24,25]),_=Object(v.__values)(h),y=_.next(),C.label=19;case 19:return y.done?[3,22]:(g=y.value,[5,b(g)]);case 20:C.sent(),C.label=21;case 21:return y=_.next(),[3,19];case 22:return[3,25];case 23:return m=C.sent(),E={error:m},[3,25];case 24:try{y&&!y.done&&(x=_.return)&&x.call(_)}finally{if(E)throw E.error}return[7];case 25:return[4,t.commit()];case 26:if(!C.sent())throw new K;return[3,29];case 27:return O=C.sent(),[4,t.rollback()];case 28:throw C.sent(),O;case 29:return[2]}}))}))},e.updateCollectionDataVersion=function(e,t,n){return Object(v.__awaiter)(this,void 0,void 0,(function(){var r,i,o;return Object(v.__generator)(this,(function(a){switch(a.label){case 0:return[4,(r=t.table(Et)).get(J.getTableName(n))];case 1:if(i=a.sent(),o=J.getTableInfo(n.prototype),!i)throw new Error("get target table system info error!");if(!o)throw new B(n.name);return i.dataVersion=e,i.properties=Object(v.__spreadArray)([],Object(v.__read)(o.properties.values())).map((function(e){return e.name})),[4,r.upsert(i)];case 2:return a.sent(),[2]}}))}))},e.getTableDataVersion=function(e,t){return Object(v.__awaiter)(this,void 0,void 0,(function(){return Object(v.__generator)(this,(function(n){switch(n.label){case 0:return[4,t.table(Et).get(e)];case 1:return[2,n.sent().dataVersion]}}))}))},e.getDatabaseSchemaByScanningTableStructure=function(e,t){return Object(v.__awaiter)(this,void 0,void 0,(function(){var n,r,i,o,a,c,s,u,d,l,p,f,h,b,_,y;return Object(v.__generator)(this,(function(g){switch(g.label){case 0:n=t.tableNames.filter((function(t){return e.includes(t)})),r=[],g.label=1;case 1:g.trys.push([1,6,7,8]),i=Object(v.__values)(n),o=i.next(),g.label=2;case 2:return o.done?[3,5]:(a=o.value,[4,t.table(a,A.READ_ONLY)]);case 3:c=g.sent(),s={name:a,key:c.autoIncrement?{generator:w.AutoIncrement}:{path:c.keyPath},indices:[],properties:[]};try{for(_=void 0,u=Object(v.__values)(c.indexNames),d=u.next();!d.done;d=u.next())l=d.value,p=c.index(l),s.indices.push({name:l,path:p.keyPath,unique:p.unique})}catch(e){_={error:e}}finally{try{d&&!d.done&&(y=u.return)&&y.call(u)}finally{if(_)throw _.error}}r.push(s),g.label=4;case 4:return o=i.next(),[3,2];case 5:return[3,8];case 6:return f=g.sent(),h={error:f},[3,8];case 7:try{o&&!o.done&&(b=i.return)&&b.call(i)}finally{if(h)throw h.error}return[7];case 8:return[2,{name:t.name,version:t.version,collections:r}]}}))}))},e}(),Ct=function(){function e(e){this.schemaActionHandlerMap=new Map,this.dataActionHandlerMap=new Map,this.schemaActionHandlerMap.set(r.CreateCollection,this.performCreateCollectionAction.bind(this)),this.schemaActionHandlerMap.set(r.DropCollection,this.performDropCollectionAction.bind(this)),this.schemaActionHandlerMap.set(r.CreateIndex,this.performCreateIndexAction.bind(this)),this.schemaActionHandlerMap.set(r.DropIndex,this.performDropIndexAction.bind(this)),this.dataActionHandlerMap.set(i.DropProperty,this.performDropPropertyAction.bind(this)),this.dataActionHandlerMap.set(i.ClearData,this.performClearDataAction.bind(this)),this.dataActionHandlerMap.set(i.ReplaceData,this.performReplaceDataAction.bind(this)),e.executeDataAction.patch(this,"executeDataAction"),e.executeSchemaAction.patch(this,"executeSchemaAction")}return e.prototype.executeSchemaAction=function(e,t,n){var r=this.schemaActionHandlerMap.get(n.type);if(r){if(t.mode!==A.VERSION_CHANGE)throw new U(n.type);return r(e,t,n)}},e.prototype.executeDataAction=function(e,t,n){return Object(v.__awaiter)(this,void 0,void 0,(function(){var r;return Object(v.__generator)(this,(function(i){return(r=this.dataActionHandlerMap.get(n.type))?[2,r(e,t,n)]:[2]}))}))},e.prototype.performCreateIndexAction=function(e,t,n){t.table(n.collection).createIndex(n.name,n.attributes.path,{unique:n.attributes.unique})},e.prototype.performDropIndexAction=function(e,t,n){t.table(n.collection).deleteIndex(n.name)},e.prototype.performDropCollectionAction=function(e,t,n){e.deleteTable(n.name)},e.prototype.performCreateCollectionAction=function(e,t,n){var r,i;e.createTable(n.name,{keyPath:null===(r=n.attributes.key)||void 0===r?void 0:r.path,autoIncrement:(null===(i=n.attributes.key)||void 0===i?void 0:i.generator)===w.AutoIncrement})},e.prototype.performClearDataAction=function(e,t,n){return Object(v.__awaiter)(this,void 0,void 0,(function(){var e,r;return Object(v.__generator)(this,(function(i){switch(i.label){case 0:return e=t.table(n.collection),n.filter?[3,2]:[4,e.clear()];case 1:return i.sent(),[2];case 2:return[4,e.openCursor()];case 3:r=i.sent(),i.label=4;case 4:return r?n.filter(r.value())?[4,r.delete()]:[3,6]:[3,8];case 5:i.sent(),i.label=6;case 6:return[4,r.next()];case 7:return r=i.sent(),[3,4];case 8:return[2]}}))}))},e.prototype.performDropPropertyAction=function(e,t,n){return Object(v.__awaiter)(this,void 0,void 0,(function(){var e,r;return Object(v.__generator)(this,(function(i){switch(i.label){case 0:return[4,t.table(n.collection).openCursor()];case 1:e=i.sent(),i.label=2;case 2:return e?((r=e.value())[n.path]=void 0,[4,e.update(r)]):[3,5];case 3:return i.sent(),[4,e.next()];case 4:return e=i.sent(),[3,2];case 5:return[2]}}))}))},e.prototype.performReplaceDataAction=function(e,t,n){var r;return Object(v.__awaiter)(this,void 0,void 0,(function(){var e,i;return Object(v.__generator)(this,(function(o){switch(o.label){case 0:return[4,t.table(n.collection).openCursor()];case 1:e=o.sent(),o.label=2;case 2:return e?(i=e.value(),n.filter&&!(null===(r=n.filter)||void 0===r?void 0:r.call(this,i))?[3,4]:[4,e.update(n.replacer(i))]):[3,6];case 3:o.sent(),o.label=4;case 4:return[4,e.next()];case 5:return e=o.sent(),[3,2];case 6:return[2]}}))}))},e}(),At=function(){function e(e){this.collection=e,this.versionActionsMap=new Map}return e.prototype.getVersionActionsMap=function(){return this.versionActionsMap},e.prototype.version=function(e){var t=this,n={update:function(r){return t.pushAction(e,{type:i.ReplaceData,replacer:r,collection:t.collection}),n},delete:function(r){return t.pushAction(e,{filter:r,type:i.ClearData,collection:t.collection}),n}};return n},e.prototype.pushAction=function(e,t){var n=this.versionActionsMap.get(e)||[];n.push(t),this.versionActionsMap.set(e,n)},e}(),kt=function(){function e(e,t,n){this.expectedSchema=e,this.actualSchema=t,this.modelClass=n}return e.prototype.plan=function(){var e=this.actualSchema.dataVersion||0,t=this.expectedSchema.dataVersion||1;if(e===t)return[];var n=[],r=this.getManualMigrationActions(e,t);n.push.apply(n,Object(v.__spreadArray)([],Object(v.__read)(r)));var i=this.getAutoMigrationActions();return n.push.apply(n,Object(v.__spreadArray)([],Object(v.__read)(i))),[{schema:{actions:[]},data:{actions:n}}]},e.prototype.getManualMigrationActions=function(e,t){var n,r,i=new At(J.getTableName(this.modelClass));return null===(r=(n=this.modelClass).onDataUpgrade)||void 0===r||r.call(n,e,t,i),this.getRangeDataAction(e,t,i.getVersionActionsMap())},e.prototype.getAutoMigrationActions=function(){var e,t,n=this,r=[],o=this.actualSchema.properties.filter((function(e){return!n.expectedSchema.properties.includes(e)}));try{for(var a=Object(v.__values)(o),c=a.next();!c.done;c=a.next()){var s=c.value;r.push({type:i.DropProperty,collection:J.getTableName(this.modelClass),path:s})}}catch(t){e={error:t}}finally{try{c&&!c.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return r},e.prototype.getRangeDataAction=function(e,t,n){for(var r=[],i=e;i<=t;i++)r.push.apply(r,Object(v.__spreadArray)([],Object(v.__read)(n.get(i)||[])));return r},e}(),Rt=function(){function e(e){this.migrationManager=e,this.upgradedFlag=new Map}return e.prototype.executeDataUpgrade=function(e,t,n,r){return void 0===r&&(r=function(){}),Object(v.__awaiter)(this,void 0,void 0,(function(){var i,o;return Object(v.__generator)(this,(function(a){switch(a.label){case 0:return i=J.getTableName(e),this.upgradedFlag.get(i)?[2]:(o=this.getCollectionSchema(i,n),this.isNeedExecuteDataUpgrade(o.expect,o.actual)?[4,this.executeUpgrade(i,t,n,o.expect,o.actual,e)]:(this.upgradedFlag.set(i,!0),[2,r()]));case 1:return a.sent(),this.upgradedFlag.set(i,!0),[2,r()]}}))}))},e.prototype.isNeedExecuteDataUpgrade=function(e,t){return!(!(null==t?void 0:t.dataVersion)||e.dataVersion===t.dataVersion)},e.prototype.executeUpgrade=function(e,t,n,r,i,o){return Object(v.__awaiter)(this,void 0,void 0,(function(){var a,c,s,u,d,l;return Object(v.__generator)(this,(function(p){switch(p.label){case 0:return a=new kt(r,i,o),this.migrationManager.use(a),c=this.migrationManager.buildMigration(n),[4,t.transaction([e,xt.getSystemTableSchema().name],A.READ_WRITE)];case 1:s=p.sent(),u=!1,p.label=2;case 2:return p.trys.push([2,6,8,11]),d=n.schema.expect.version||1,[4,xt.getTableDataVersion(J.getTableName(o),s)];case 3:return p.sent()===d?[2]:[4,this.migrationManager.executeDataMigration(t,c,s)];case 4:return p.sent(),[4,xt.updateCollectionDataVersion(d,s,o)];case 5:return p.sent(),[3,11];case 6:return l=p.sent(),u=!0,[4,s.rollback()];case 7:throw p.sent(),new L({oldVersion:i.dataVersion,newVersion:r.dataVersion},l);case 8:return u?[3,10]:[4,s.commit()];case 9:p.sent(),p.label=10;case 10:return[7];case 11:return[2]}}))}))},e.prototype.getCollectionSchema=function(e,t){var n=t.schema,r=n.expect,i=n.actual,o=r.collections.filter((function(t){return t.name===e})),a=i.collections.filter((function(t){return t.name===e}));if(1!==o.length)throw new P(e);return{expect:o[0],actual:a.length?a[0]:void 0}},e}(),Dt=function(){function e(e,t,n){var r=this;this.planner=new St,this.actualDBSchema=null,this.actualDBSchemaFrom=null,this.lazyMigrationProcessor=new Rt(this),this.handleCollectionCreated=function(e){var t=e.collectionName,n=e.context;r.safeExecuteDataUpgrade(n,t)},this.handleStartTransaction=function(e){var t,n,i=e.collectionNames,o=e.context;try{for(var a=Object(v.__values)(i),c=a.next();!c.done;c=a.next()){var s=c.value;r.safeExecuteDataUpgrade(o,s)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},this.eventBus=e,this.eventBus.on(re.CollectionCreated,this.handleCollectionCreated),this.eventBus.on(re.StartTransaction,this.handleStartTransaction),this.schemaProvider=t,this.actionExecutor=new Ct(n.actionExecutor),this.applyAspectPatch(n)}return e.prototype.use=function(e){this.planner=e},e.prototype.prepareAutoUpgradeHandler=function(e,t){return Object(v.__awaiter)(this,void 0,void 0,(function(){var n,r,i,o,a,c=this;return Object(v.__generator)(this,(function(s){switch(s.label){case 0:return n=this.schemaProvider.getDatabaseSchema(),[4,xt.getDatabaseSchema(e,t,n)];case 1:return r=s.sent(),i=r.schema,o=r.from,this.actualDBSchema=i,this.actualDBSchemaFrom=o,this.log("getDatabaseSchema",this.actualDBSchema),a=this.buildMigration({schema:{expect:n,actual:this.actualDBSchema}}),[2,function(e,t,n,r){c.eventBus.emit(ne.SchemaMigrationStart),c.executeSchemaMigration(e,a,r),c.updateMigrationChangeInfo(r).catch((function(e){c.emitError(new H(e))})),c.eventBus.emit(ne.SchemaMigrationEnd)}]}}))}))},e.prototype.buildMigration=function(e){var t,n,r,i,o,a,c=e.schema,s=c.actual,u=c.expect;null===(n=null===(t=this.planner)||void 0===t?void 0:t.init)||void 0===n||n.call(t,e);var d=null!==(r=s.version)&&void 0!==r?r:0,l=null!==(i=u.version)&&void 0!==i?i:1;return null!==(a=null===(o=this.planner)||void 0===o?void 0:o.plan(d,l))&&void 0!==a?a:[]},e.prototype.executeSchemaMigration=function(e,t,n){var r,i,o,a;if(t)try{for(var c=Object(v.__values)(t),s=c.next();!s.done;s=c.next()){var u=s.value;try{for(var d=(o=void 0,Object(v.__values)(u.schema.actions)),l=d.next();!l.done;l=d.next()){var p=l.value;this.actionExecutor.executeSchemaAction(e,n,p)}}catch(e){o={error:e}}finally{try{l&&!l.done&&(a=d.return)&&a.call(d)}finally{if(o)throw o.error}}}}catch(e){r={error:e}}finally{try{s&&!s.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}},e.prototype.executeDataMigration=function(e,t,n){return Object(v.__awaiter)(this,void 0,void 0,(function(){var r,i,o,a,c,s,u,d,l,p,f,h;return Object(v.__generator)(this,(function(b){switch(b.label){case 0:if(!t)return[2];b.label=1;case 1:b.trys.push([1,12,13,14]),r=Object(v.__values)(t),i=r.next(),b.label=2;case 2:if(i.done)return[3,11];o=i.value,b.label=3;case 3:b.trys.push([3,8,9,10]),f=void 0,a=Object(v.__values)(o.data.actions),c=a.next(),b.label=4;case 4:return c.done?[3,7]:(s=c.value,[4,this.actionExecutor.executeDataAction(e,n,s)]);case 5:b.sent(),b.label=6;case 6:return c=a.next(),[3,4];case 7:return[3,10];case 8:return u=b.sent(),f={error:u},[3,10];case 9:try{c&&!c.done&&(h=a.return)&&h.call(a)}finally{if(f)throw f.error}return[7];case 10:return i=r.next(),[3,2];case 11:return[3,14];case 12:return d=b.sent(),l={error:d},[3,14];case 13:try{i&&!i.done&&(p=r.return)&&p.call(r)}finally{if(l)throw l.error}return[7];case 14:return[2]}}))}))},e.prototype.updateMigrationChangeInfo=function(e){var t,n;return Object(v.__awaiter)(this,void 0,void 0,(function(){var r,i;return Object(v.__generator)(this,(function(o){return r=this.schemaProvider.getDatabaseSchema(),i=null!==(t=r.version)&&void 0!==t?t:1,[2,xt.updateSchemaChange(i,e,{schema:{expect:r,actual:null!==(n=this.actualDBSchema)&&void 0!==n?n:{name:r.name,collections:[]}}},"scan_exists_table"===this.actualDBSchemaFrom)]}))}))},e.prototype.log=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n]},e.prototype.executeDataUpgradeIfNeed=function(e,t){var n;return Object(v.__awaiter)(this,void 0,void 0,(function(){var r,i,o=this;return Object(v.__generator)(this,(function(a){switch(a.label){case 0:return this.log("executeDataUpgradeIfNeed",e.name),r=this.schemaProvider.getDatabaseSchema(),i={name:r.name,collections:[]},[4,this.lazyMigrationProcessor.executeDataUpgrade(e,t,{schema:{expect:r,actual:null!==(n=this.actualDBSchema)&&void 0!==n?n:i}},(function(){o.eventBus.emit(re.ModelLazyMigrationEnd,J.getTableName(e))}))];case 1:return a.sent(),[2]}}))}))},e.prototype.safeExecuteDataUpgrade=function(e,t){var n=this;Promise.all([e.waitForModelRegistered(t),e.waitForDBReady()]).then((function(e){var r=Object(v.__read)(e,2),i=r[0],o=r[1];n.executeDataUpgradeIfNeed(i.class,o).catch((function(e){n.emitError(new Q(t,e))}))})).catch((function(){}))},e.prototype.emitError=function(e){this.eventBus.emit(ne.Error,e)},e.prototype.applyAspectPatch=function(e){e.buildMigration.patch(this,"buildMigration"),e.executeDataMigration.patch(this,"executeDataMigration"),e.executeSchemaMigration.patch(this,"executeSchemaMigration"),e.prepareAutoUpgradeHandler.patch(this,"prepareAutoUpgradeHandler"),e.log.patch(this,"log"),e.updateMigrationChangeInfo.patch(this,"updateMigrationChangeInfo")},e}(),Tt=Dt;var Nt=function(){var e;return{lock:function(t){return e||(e=t()),e.finally((function(){e=void 0}))}}},Mt=function(){function e(e,t){var n,r=this;if(this.openingMutex=Nt(),this.closingMutex=Nt(),this.destroyingMutex=Nt(),this.openDatabase=function(){return Object(v.__awaiter)(r,void 0,void 0,(function(){var e=this;return Object(v.__generator)(this,(function(t){return[2,this.openingMutex.lock((function(){return Object(v.__awaiter)(e,void 0,void 0,(function(){var e,t,n,r,i,o,a,c,s,u,d,l=this;return Object(v.__generator)(this,(function(p){switch(p.label){case 0:if(this.db)return[2];e=this.storage,t=e.name,n=e.version,p.label=1;case 1:return p.trys.push([1,8,,9]),this.eventBus.emit(ne.BootstrapStart),r=this.getDatabaseSchema(),[4,this.migrationManager.prepareAutoUpgradeHandler(t,this.engine)];case 2:i=p.sent(),o=function(){l.eventBus.emit(ne.Fetal,new z(t))},p.label=3;case 3:return p.trys.push([3,5,,7]),a=this,[4,this.engine.openDB(t,r,n,{upgrade:i,terminated:o})];case 4:return a.db=p.sent(),[3,7];case 5:if("VersionError"!==(c=p.sent()).name||!this.supportCompatibleOpen)throw c;return s=this,[4,this.engine.openDB(t,r,void 0,{upgrade:i,terminated:o})];case 6:return s.db=p.sent(),[3,7];case 7:return this.db.setVersionChangeListener((function(e,t){l.eventBus.emit(ne.VersionChange,{oldVersion:e,newVersion:t})})),this.eventBus.emit(ne.BootstrapEnd),this.eventBus.emit(ne.Ready,this.db),[3,9];case 8:throw u=p.sent(),this.reset(),d=new M(t,u),this.eventBus.emit(ne.Error,d),this.eventBus.emit(ne.Fetal,d),d;case 9:return[2]}}))}))}))]}))}))},this.handleModelRegistered=function(e){if(!r.schemas.some((function(t){return t.name===e.schema.name}))){var t=e.schema;t.dataVersion=r.storage.version,r.schemas.push(t)}},this.handleFetal=function(){r.reset()},this.storage=e,this.engine=t.engine,this.eventBus=t.eventBus,this.supportCompatibleOpen=t.supportCompatibleOpen,this.engine.setAspects(e.aspects.engine),this.schemas=[xt.getSystemTableSchema()],t.databaseSchema){var i=JSON.parse(t.databaseSchema).collections.map((function(e){return Object(v.__assign)(Object(v.__assign)({},e),{dataVersion:r.storage.version})}));(n=this.schemas).push.apply(n,Object(v.__spreadArray)([],Object(v.__read)(i)))}this.migrationManager=new Tt(this.eventBus,this,e.aspects.migration),this.eventBus.on(ne.RegisterModel,this.handleModelRegistered),this.eventBus.on(ne.Fetal,this.handleFetal)}return e.prototype.getDatabaseEngine=function(){return this.engine},e.prototype.getDatabaseSchema=function(){if(!this.storage.name||!this.storage.version)throw new Error("The database name and version are required for generating dbSchema");return{name:this.storage.name,version:this.storage.version,collections:this.schemas}},e.prototype.closeDatabase=function(){return Object(v.__awaiter)(this,void 0,void 0,(function(){var e=this;return Object(v.__generator)(this,(function(t){return[2,this.closingMutex.lock((function(){return Object(v.__awaiter)(e,void 0,void 0,(function(){return Object(v.__generator)(this,(function(e){switch(e.label){case 0:return this.db?[4,this.db.close()]:[2];case 1:return e.sent(),this.reset(),this.eventBus.emit(ne.Closed),[2]}}))}))}))]}))}))},e.prototype.destroyDatabase=function(){var e=this;return this.destroyingMutex.lock((function(){return Object(v.__awaiter)(e,void 0,void 0,(function(){return Object(v.__generator)(this,(function(e){switch(e.label){case 0:return[4,this.engine.deleteDB(this.storage.name)];case 1:return e.sent(),this.reset(),this.eventBus.emit(ne.Destroyed),[2]}}))}))}))},e.prototype.reset=function(){this.db=void 0},e}();var Pt=function(e){return setTimeout(e)},Lt=function(){function e(e){var t=e.keepActive,n=e.comparer,r=e.channelDB,i=e.channelModel,o=e.channelLazyMigration;this.keepActive=t,this.comparer=n,this.channelDB=r,this.channelModel=i,this.channelLazyMigration=o}return e.fromTransactionManager=function(t,n){return void 0===n&&(n=!1),new e({keepActive:n,comparer:t.comparer,channelDB:t.channelDB,channelModel:t.channelModel,channelLazyMigration:t.channelLazyMigration})},e.prototype.openTransaction=function(e,t){return Object(v.__awaiter)(this,void 0,void 0,(function(){var n=this;return Object(v.__generator)(this,(function(r){return this.transactionPromise=Object(v.__awaiter)(n,void 0,void 0,(function(){var n,r,i=this;return Object(v.__generator)(this,(function(o){switch(o.label){case 0:return[4,Promise.all(e.map((function(e){return i.waitForModelRegistered(e)})))];case 1:return o.sent(),[4,Promise.all(e.map((function(e){return i.waitForMigrationReady(e)})))];case 2:return o.sent(),[4,this.waitForDBReady()];case 3:return n=o.sent(),r=this,[4,n.transaction(e,t)];case 4:return r.transaction=o.sent(),[2,this.transaction]}}))})),[2,this.transactionPromise]}))}))},e.prototype.getTransaction=function(e,t){return Object(v.__awaiter)(this,void 0,void 0,(function(){return Object(v.__generator)(this,(function(n){switch(n.label){case 0:return this.transactionPromise?[3,2]:[4,this.openTransaction(e,t)];case 1:n.sent(),n.label=2;case 2:return[4,this.transactionPromise];case 3:return[2,n.sent()]}}))}))},e.prototype.waitForDBReady=function(){return Object(v.__awaiter)(this,void 0,void 0,(function(){return Object(v.__generator)(this,(function(e){return[2,this.channelDB.pick()]}))}))},e.prototype.waitForModelRegistered=function(e){return Object(v.__awaiter)(this,void 0,void 0,(function(){return Object(v.__generator)(this,(function(t){return[2,this.channelModel.pick(e)]}))}))},e.prototype.waitForMigrationReady=function(e){return Object(v.__awaiter)(this,void 0,void 0,(function(){return Object(v.__generator)(this,(function(t){return[2,this.channelLazyMigration.pick(e)]}))}))},e.prototype.perform=function(e){return this.keepActive?e():this.autoCommitOrRollback(e)},e.prototype.autoCommitOrRollback=function(e){var t,n;return Object(v.__awaiter)(this,void 0,void 0,(function(){var r,i;return Object(v.__generator)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,5]),[4,e()];case 1:return r=o.sent(),[4,null===(t=this.transaction)||void 0===t?void 0:t.commit()];case 2:return o.sent(),[2,r];case 3:return i=o.sent(),[4,null===(n=this.transaction)||void 0===n?void 0:n.rollback()];case 4:throw o.sent(),i;case 5:return[2]}}))}))},e}(),Ut=Symbol("channel");var Bt,qt,Ft,Vt,Gt=function(e){var t;void 0===e&&(e=function(){return Ut});var n=new Map,r=new Map;function i(e,t){var n;null===(n=r.get(e))||void 0===n||n.reject(t),r.delete(e)}function o(e,t){void 0===t&&(t=Ut),r.has(t)?function(e,t){var n;null===(n=r.get(e))||void 0===n||n.resolve(t),r.delete(e)}(t,e):n.set(t,Promise.resolve(e))}return{send:function(n){t||o(n,e(n))},pick:function(e){return void 0===e&&(e=Ut),t?Promise.reject(t):(n.has(e)||n.set(e,new Promise((function(t,n){r.set(e,{resolve:t,reject:n})}))),n.get(e))},open:function(){t=void 0},close:function(e,o){var a,c;void 0===o&&(o=!1),t=e;try{for(var s=Object(v.__values)(r.keys()),u=s.next();!u.done;u=s.next()){i(u.value,e)}}catch(e){a={error:e}}finally{try{u&&!u.done&&(c=s.return)&&c.call(s)}finally{if(a)throw a.error}}o&&(n.clear(),r.clear())}}},Wt=function(){function e(e,t){var n=this;this.handleFetalError=function(e){n.channelDB.close(e,!0),n.channelModel.close(e),n.channelLazyMigration.close(e)},this.eventBus=e,this.channelDB=Gt(),this.channelModel=Gt((function(e){return e.schema.name})),this.channelLazyMigration=Gt((function(e){return e})),this.comparer=t,this.eventBus.on(ne.Fetal,this.handleFetalError),this.eventBus.on(ne.Ready,this.channelDB.send),this.eventBus.on(ne.RegisterModel,this.channelModel.send),this.eventBus.on(re.ModelLazyMigrationEnd,this.channelLazyMigration.send)}return e.prototype.spawnAutoCommitContext=function(){return Lt.fromTransactionManager(this,!1)},e.prototype.spawnKeepAliveContext=function(){return Lt.fromTransactionManager(this,!0)},e.prototype.openChannels=function(){this.channelDB.open(),this.channelModel.open(),this.channelLazyMigration.open()},e}();!function(){function e(e){var t,n=this,r=e.name,i=e.engine,o=e.version,a=void 0===o?1:o,c=e.plugins,s=void 0===c?[]:c,u=e.disableAutoOpen,d=void 0!==u&&u,l=e.databaseSchema,p=e.supportCompatibleOpen,f=void 0!==p&&p;this.aspects={collection:{get:vt.withContext(yt),has:vt.withContext(yt),delete:vt.withContext(yt),insert:vt.withContext(yt),upsert:vt.withContext(yt),bulkInsert:vt.withContext(yt),bulkUpsert:vt.withContext(yt),update:vt.withContext(yt),clear:vt.withContext(yt),count:vt.withContext(yt),entries:vt.withContext(yt),keys:vt.withContext(yt),values:vt.withContext(yt),first:vt.withContext(yt),last:vt.withContext(yt),skip:bt.withContext(yt),take:bt.withContext(yt),slice:bt.withContext(yt),orderBy:bt.withContext(yt),where:bt.withContext(yt),or:bt.withContext(yt)},query:{},model:{},migration:{prepareAutoUpgradeHandler:vt.withContext(yt),buildMigration:bt.withContext(yt),executeDataMigration:vt.withContext(yt),executeSchemaMigration:bt.withContext(yt),updateMigrationChangeInfo:vt.withContext(yt),log:bt.withContext(yt),actionExecutor:{executeSchemaAction:bt.withContext(yt),executeDataAction:vt.withContext(yt)}},engine:{deleteDB:vt.withContext(yt),openDB:vt.withContext(yt),database:{createTable:bt.withContext(yt),deleteTable:bt.withContext(yt),close:bt.withContext(yt),table:vt.withContext(yt),transaction:vt.withContext(yt)},table:{createIndex:vt.withContext(yt),deleteIndex:vt.withContext(yt),delete:vt.withContext(yt),get:vt.withContext(yt),getAll:vt.withContext(yt),getAllKeys:vt.withContext(yt),index:bt.withContext(yt),insert:vt.withContext(yt),query:vt.withContext(yt),openCursor:vt.withContext(yt),upsert:vt.withContext(yt),bulkUpsert:vt.withContext(yt),clear:vt.withContext(yt),bulkDelete:vt.withContext(yt)},index:{get:vt.withContext(yt),getAll:vt.withContext(yt),getAllKeys:vt.withContext(yt),openCursor:vt.withContext(yt)},cursor:{delete:vt.withContext(yt),update:vt.withContext(yt),next:vt.withContext(yt),value:bt.withContext(yt)},transaction:{commit:vt.withContext(yt),rollback:vt.withContext(yt),table:bt.withContext(yt)}}},this.eventBus=te(),this.open=function(){return n.transactionManager.openChannels(),n.databaseManager.openDatabase()},this.close=function(){return n.databaseManager.closeDatabase()},this.destroy=function(){return n.databaseManager.destroyDatabase()},this.register=function(e){n.modelManager.register(e)},this.collection=function(e){var t=n.modelManager.getSchemaAndRegisterModelIfNeed(e);return n.collectionManager.getCollection(t.name,{spawnContext:function(){return n.transactionManager.spawnAutoCommitContext()}})},this.transaction=function(e,t,r){return Object(v.__awaiter)(n,void 0,void 0,(function(){var n,i,o,a=this;return Object(v.__generator)(this,(function(c){switch(c.label){case 0:return n=this.transactionManager,i=e.map((function(e){return a.modelManager.getSchemaAndRegisterModelIfNeed(e).name})),o=n.spawnKeepAliveContext(),this.eventBus.emit(re.StartTransaction,{collectionNames:i,context:o}),[4,o.openTransaction(i,t)];case 1:return c.sent(),[2,o.autoCommitOrRollback((function(){return r(a.createStorageTransaction(o))}))]}}))}))},this.name=r,this.version=a,this.events=new oe(this.eventBus),this.modelManager=new ce(this.eventBus),this.databaseManager=new Mt(this,{engine:i,eventBus:this.eventBus,databaseSchema:l,supportCompatibleOpen:f}),this.pluginManager=new Ot(this,this.eventBus),this.collectionManager=new ut(this,this.eventBus),this.transactionManager=new Wt(this.eventBus,{cmp:this.databaseManager.getDatabaseEngine().cmp}),(t=this.pluginManager).add.apply(t,Object(v.__spreadArray)([],Object(v.__read)(s))),d||Pt((function(){return n.open().catch((function(e){throw e}))}))}e.prototype.createStorageTransaction=function(e){var t=this.modelManager,n=new ut(this,this.eventBus);return{collection:function(r){var i=t.getSchemaAndRegisterModelIfNeed(r);return n.getCollection(i.name,{spawnContext:function(){return e}})}}}}();!function(e){e[e.unknown=-1]="unknown",e[e.doc=0]="doc",e[e.sheet=1]="sheet",e[e.form=2]="form",e[e.folder=3]="folder",e[e.slide=4]="slide",e[e.note=5]="note",e[e.pdf=6]="pdf",e[e.miniProgram=7]="miniProgram",e[e.smartCanvas=8]="smartCanvas",e[e.smartSheet=9]="smartSheet",e[e.unknow=10]="unknow",e[e.resume=11]="resume",e[e.board=12]="board",e[e.drawing=89]="drawing",e[e.mind=90]="mind",e[e.flowchart=91]="flowchart",e[e.file=100]="file",e[e.drive=101]="drive",e[e.sogoSpeech=102]="sogoSpeech",e[e.addon=110]="addon"}(Ft||(Ft={})),function(e){e.doc="doc",e.sheet="sheet",e.form="form",e.slide="slide",e.smartSheet="smartSheet",e.smartCanvas="smartCanvas",e.flowchart="flowchart",e.mind="mind",e.pdf="pdf",e.drive="document"}(Vt||(Vt={}));var Kt,Ht,Qt,zt,Yt,Jt,Xt,$t=(Bt={},a()(Bt,Vt.doc,Ft.doc),a()(Bt,Vt.sheet,Ft.sheet),a()(Bt,Vt.slide,Ft.slide),a()(Bt,Vt.smartSheet,Ft.smartSheet),a()(Bt,Vt.smartCanvas,Ft.smartCanvas),a()(Bt,Vt.flowchart,Ft.flowchart),a()(Bt,Vt.mind,Ft.mind),a()(Bt,Vt.pdf,Ft.pdf),a()(Bt,Vt.drive,Ft.drive),Bt),Zt=(qt={},a()(qt,Ft.doc,Vt.doc),a()(qt,Ft.sheet,Vt.sheet),a()(qt,Ft.slide,Vt.slide),a()(qt,Ft.smartSheet,Vt.smartSheet),a()(qt,Ft.smartCanvas,Vt.smartCanvas),a()(qt,Ft.flowchart,Vt.flowchart),a()(qt,Ft.mind,Vt.mind),a()(qt,Ft.pdf,Vt.pdf),a()(qt,Ft.drive,Vt.drive),qt);!function(e){e[e.private=0]="private",e[e.partialShare=1]="partialShare",e[e.canRead=2]="canRead",e[e.canEdit=3]="canEdit"}(Kt||(Kt={})),function(e){e.new="new",e.local="local",e.deleted="deleted",e.normal="normal"}(Ht||(Ht={})),function(e){e.NONE="none",e.SUCCESS="success",e.FAIL="fail",e.ERROR="error"}(Qt||(Qt={})),function(e){e[e.file=1]="file",e[e.folder=2]="folder"}(zt||(zt={})),function(e){e[e.trash=3]="trash",e[e.share=4]="share",e[e.myDoc=5]="myDoc",e[e.recent=6]="recent",e[e.start=7]="start"}(Yt||(Yt={})),function(e){e.init="init",e.document="document",e.workbook="workbook",e.chunk="chunk",e.accepted="accepted",e.missChange="misschange",e.newChange="newchange",e.committing="commiting",e.waiting="watting",e.queue="queue"}(Jt||(Jt={})),function(e){e.drive="drive",e.attachment="attachment"}(Xt||(Xt={}));var en,tn,nn,rn,on,an,cn="TencentDocs",sn="all-local-files/TencentDocs",un="TencentDocs_TestEnv";function dn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=_()(e);if(t){var i=_()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}!function(e){e.documentStatus="DocumentStatus",e.documentEntities="DocumentEntities",e.newDocumentIds="NewDocumentIds",e.padinfo="PadInfo",e.offlineData="OfflineData",e.documentData="DocumentData",e.Users="Users",e.driveData="DriveData"}(en||(en={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.QQ=1]="QQ",e[e.WX=2]="WX",e[e.WORK=3]="WORK",e[e.EMAIL=4]="EMAIL",e[e.PHONE=8]="PHONE",e[e.WORK_COMBINATION=9]="WORK_COMBINATION",e[e.TOWER=10]="TOWER",e[e.ROBOT=11]="ROBOT",e[e.QFYF=12]="QFYF",e[e.OPEN=13]="OPEN",e[e.MEETING=14]="MEETING"}(tn||(tn={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.WECHAT=4]="WECHAT",e[e.WEWORK=3]="WEWORK"}(nn||(nn={})),function(e){e.BINDING="BINDING",e.UNBIND="UNBIND"}(rn||(rn={})),function(e){e.NORMAL="NORMAL",e.SUPER="SUPER",e.SUPER_PLUS="SUPER_PLUS",e.NONE="NONE",e.EXPIRED="EXPIRED"}(on||(on={})),function(e){e[e.NORMAL=2]="NORMAL",e[e.SUPER=3]="SUPER",e[e.SUPER_PLUS=4]="SUPER_PLUS",e[e.NONE=1]="NONE",e[e.EXPIRED=0]="EXPIRED"}(an||(an={}));var ln=function(e){p()(n,e);var t=dn(n);function n(e){var r,i,o,a,c,u,d;return s()(this,n),(r=t.call(this)).isDefaultChunk=!1,r.uid=e.uid,r.type=e.type,r.data=e.data,r.dataVersion=e.dataVersion,r.docType=e.docType,r.subId=e.subId,r.secretId=e.secretId,r.version=e.version,r.globalPadId=e.globalPadId,r.taskId=null!==(i=e.taskId)&&void 0!==i?i:r.getTaskId(),r.isDefaultChunk=null!==(o=e.isDefaultChunk)&&void 0!==o&&o,r.chunkId=null!==(a=e.chunkId)&&void 0!==a?a:0,r.docStatus=null!==(c=e.docStatus)&&void 0!==c?c:Ht.normal,r.createTimestamp=null!==(u=e.createTimestamp)&&void 0!==u?u:Date.now(),r.lastModifyTimestamp=null!==(d=e.lastModifyTimestamp)&&void 0!==d?d:Date.now(),r.key=r.getKey(),r.subGlobalPadId=e.subGlobalPadId,r.subDocType=e.subDocType,r}return d()(n,[{key:"getTaskId",value:function(){return Math.ceil(2147483648*Math.random())}},{key:"getKey",value:function(){return this.type===Jt.init?"".concat(this.globalPadId,"_").concat(this.subId,"_").concat(this.uid):this.type===Jt.document?"".concat(this.globalPadId,"_").concat(this.uid,"_version_").concat(this.version):this.type===Jt.workbook?"".concat(this.globalPadId,"_").concat(this.subId,"_").concat(this.uid,"_version_").concat(this.version):this.type===Jt.chunk?"".concat(this.globalPadId,"_").concat(this.subId,"_").concat(this.chunkId,"_").concat(this.uid,"_version_").concat(this.version):"".concat(this.globalPadId,"_").concat(this.subId,"_").concat(this.uid,"_taskId_").concat(this.taskId)}}]),n}(ae);function pn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=_()(e);if(t){var i=_()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}Object(v.__decorate)([ee(),Object(v.__metadata)("design:type",String)],ln.prototype,"key",void 0),Object(v.__decorate)([Z(),Object(v.__metadata)("design:type",String)],ln.prototype,"secretId",void 0),Object(v.__decorate)([Z(),Object(v.__metadata)("design:type",String)],ln.prototype,"globalPadId",void 0),Object(v.__decorate)([Z(),Object(v.__metadata)("design:type",String)],ln.prototype,"subGlobalPadId",void 0),Object(v.__decorate)([Z(),Object(v.__metadata)("design:type",Number)],ln.prototype,"subDocType",void 0),Object(v.__decorate)([Z(),Object(v.__metadata)("design:type",Number)],ln.prototype,"version",void 0),Object(v.__decorate)([Z(),Object(v.__metadata)("design:type",String)],ln.prototype,"type",void 0),Object(v.__decorate)([Z(),Object(v.__metadata)("design:type",String)],ln.prototype,"uid",void 0),Object(v.__decorate)([Z(),X("subSheetId"),Object(v.__metadata)("design:type",String)],ln.prototype,"subId",void 0),Object(v.__decorate)([Z(),Object(v.__metadata)("design:type",Number)],ln.prototype,"chunkId",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",Number)],ln.prototype,"taskId",void 0),Object(v.__decorate)([X("_data"),Object(v.__metadata)("design:type",String)],ln.prototype,"data",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",Number)],ln.prototype,"docType",void 0),Object(v.__decorate)([X("padStatus"),Object(v.__metadata)("design:type",String)],ln.prototype,"docStatus",void 0),Object(v.__decorate)([X("createTime"),Object(v.__metadata)("design:type",Number)],ln.prototype,"createTimestamp",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",Number)],ln.prototype,"lastModifyTimestamp",void 0),Object(v.__decorate)([X("dver"),Object(v.__metadata)("design:type",String)],ln.prototype,"dataVersion",void 0),Object(v.__decorate)([X("default"),Object(v.__metadata)("design:type",Object)],ln.prototype,"isDefaultChunk",void 0);var fn=function(e){p()(n,e);var t=pn(n);function n(){return s()(this,n),t.apply(this,arguments)}return d()(n)}(ln);function hn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=_()(e);if(t){var i=_()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}fn=Object(v.__decorate)([$(en.documentData)],fn);var bn=function(e){p()(n,e);var t=hn(n);function n(){return s()(this,n),t.apply(this,arguments)}return d()(n)}(ae);function _n(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=_()(e);if(t){var i=_()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}Object(v.__decorate)([ee(),Object(v.__metadata)("design:type",String)],bn.prototype,"key",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",Object)],bn.prototype,"data",void 0),bn=Object(v.__decorate)([$(en.documentEntities)],bn);var vn=function(e){p()(n,e);var t=_n(n);function n(){var e;return s()(this,n),(e=t.apply(this,arguments)).isCreated=!1,e}return d()(n)}(ae);function yn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=_()(e);if(t){var i=_()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}Object(v.__decorate)([ee(),Object(v.__metadata)("design:type",String)],vn.prototype,"globalPadId",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",String)],vn.prototype,"secretId",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",Number)],vn.prototype,"documentType",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",String)],vn.prototype,"localPadId",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",Object)],vn.prototype,"isCreated",void 0),vn=Object(v.__decorate)([$(en.newDocumentIds)],vn);var gn=function(e){p()(n,e);var t=yn(n);function n(){var e;return s()(this,n),(e=t.apply(this,arguments)).lastSyncTimestamp=0,e}return d()(n)}(ae);function mn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=_()(e);if(t){var i=_()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}Object(v.__decorate)([ee(),Object(v.__metadata)("design:type",String)],gn.prototype,"globalPadId",void 0),Object(v.__decorate)([Z(),Object(v.__metadata)("design:type",String)],gn.prototype,"secretId",void 0),Object(v.__decorate)([Z(),Object(v.__metadata)("design:type",String)],gn.prototype,"uid",void 0),Object(v.__decorate)([X("lastSyncTime"),Object(v.__metadata)("design:type",Object)],gn.prototype,"lastSyncTimestamp",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",Number)],gn.prototype,"lastErrorTimestamp",void 0),gn=Object(v.__decorate)([$(en.documentStatus)],gn);var On=function(e){p()(n,e);var t=mn(n);function n(){return s()(this,n),t.apply(this,arguments)}return d()(n)}(ae);function jn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=_()(e);if(t){var i=_()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}Object(v.__decorate)([ee(),Object(v.__metadata)("design:type",String)],On.prototype,"driveId",void 0),Object(v.__decorate)([Z(),Object(v.__metadata)("design:type",String)],On.prototype,"fileId",void 0),Object(v.__decorate)([Z(),Object(v.__metadata)("design:type",String)],On.prototype,"objKey",void 0),Object(v.__decorate)([Z(),Object(v.__metadata)("design:type",String)],On.prototype,"secretId",void 0),Object(v.__decorate)([Z(),Object(v.__metadata)("design:type",String)],On.prototype,"uid",void 0),Object(v.__decorate)([X("type"),Object(v.__metadata)("design:type",String)],On.prototype,"type",void 0),Object(v.__decorate)([X("lastRequestTime"),Object(v.__metadata)("design:type",Number)],On.prototype,"lastRequestTime",void 0),Object(v.__decorate)([X("fileInfo"),Object(v.__metadata)("design:type",Object)],On.prototype,"fileInfo",void 0),Object(v.__decorate)([X("previewInfo"),Object(v.__metadata)("design:type",Object)],On.prototype,"previewInfo",void 0),On=Object(v.__decorate)([$(en.driveData)],On);var wn=function(e){p()(n,e);var t=jn(n);function n(){return s()(this,n),t.apply(this,arguments)}return d()(n)}(ln);function In(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=_()(e);if(t){var i=_()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}wn=Object(v.__decorate)([$(en.offlineData)],wn);var Sn=function(e){p()(n,e);var t=In(n);function n(){var e;return s()(this,n),(e=t.apply(this,arguments)).addListTimestamp=0,e.attribute=null,e.docPolicy=Kt.private,e.docPrivilege=null,e.folderPolicy=0,e.folderPrivilege=null,e.isManualOffline=!1,e.isOfflineCache=!1,e.hasSnapShot=!1,e.isAddedToMy=0,e.isCollected=0,e.isOwner=1,e.isPinned=0,e.isShortcut=0,e.isUserChangeTitle=!1,e.lastCollectTimestamp=0,e.lastDeleteTimestamp=0,e.parents=[],e.cacheStatus=0,e}return d()(n)}(ae);function En(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=_()(e);if(t){var i=_()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}Object(v.__decorate)([ee(),Object(v.__metadata)("design:type",String)],Sn.prototype,"key",void 0),Object(v.__decorate)([Z(),Object(v.__metadata)("design:type",String)],Sn.prototype,"secretId",void 0),Object(v.__decorate)([Z(),Object(v.__metadata)("design:type",String)],Sn.prototype,"globalPadId",void 0),Object(v.__decorate)([Z(),Object(v.__metadata)("design:type",String)],Sn.prototype,"uid",void 0),Object(v.__decorate)([X("add_list_ts"),Object(v.__metadata)("design:type",Object)],Sn.prototype,"addListTimestamp",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",Object)],Sn.prototype,"attribute",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",Number)],Sn.prototype,"childrenLength",void 0),Object(v.__decorate)([X("client_version"),Object(v.__metadata)("design:type",String)],Sn.prototype,"clientVersion",void 0),Object(v.__decorate)([X("create_ts"),Object(v.__metadata)("design:type",Number)],Sn.prototype,"createTimestamp",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",String)],Sn.prototype,"creator",void 0),Object(v.__decorate)([X("creator_domain"),Object(v.__metadata)("design:type",String)],Sn.prototype,"creatorDomain",void 0),Object(v.__decorate)([X("doc_icon"),Object(v.__metadata)("design:type",String)],Sn.prototype,"icon",void 0),Object(v.__decorate)([X("doc_policy"),Object(v.__metadata)("design:type",Number)],Sn.prototype,"docPolicy",void 0),Object(v.__decorate)([X("doc_privilege"),Object(v.__metadata)("design:type",Object)],Sn.prototype,"docPrivilege",void 0),Object(v.__decorate)([X("doc_thumbnail"),Object(v.__metadata)("design:type",String)],Sn.prototype,"thumbnail",void 0),Object(v.__decorate)([X("doc_type"),Object(v.__metadata)("design:type",Number)],Sn.prototype,"docType",void 0),Object(v.__decorate)([X("doc_type_desc"),Object(v.__metadata)("design:type",String)],Sn.prototype,"docTypeDesc",void 0),Object(v.__decorate)([X("doc_url"),Object(v.__metadata)("design:type",String)],Sn.prototype,"url",void 0),Object(v.__decorate)([X("domain_id"),Object(v.__metadata)("design:type",String)],Sn.prototype,"domainId",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",String)],Sn.prototype,"dver",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",String)],Sn.prototype,"folder",void 0),Object(v.__decorate)([X("folder_id"),Object(v.__metadata)("design:type",String)],Sn.prototype,"folderId",void 0),Object(v.__decorate)([X("folder_policy"),Object(v.__metadata)("design:type",Object)],Sn.prototype,"folderPolicy",void 0),Object(v.__decorate)([X("folder_privilege"),Object(v.__metadata)("design:type",Object)],Sn.prototype,"folderPrivilege",void 0),Object(v.__decorate)([X("isDelete"),Object(v.__metadata)("design:type",Boolean)],Sn.prototype,"isDeleted",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",Object)],Sn.prototype,"isManualOffline",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",Boolean)],Sn.prototype,"isMyCreated",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",Boolean)],Sn.prototype,"isMydoc",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",Object)],Sn.prototype,"isOfflineCache",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",Boolean)],Sn.prototype,"isRencent",void 0),Object(v.__decorate)([X("isShareme"),Object(v.__metadata)("design:type",Boolean)],Sn.prototype,"isShareToMe",void 0),Object(v.__decorate)([X("isSnapShot"),Object(v.__metadata)("design:type",Object)],Sn.prototype,"hasSnapShot",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",Boolean)],Sn.prototype,"isStar",void 0),Object(v.__decorate)([X("is_added_my"),Object(v.__metadata)("design:type",Object)],Sn.prototype,"isAddedToMy",void 0),Object(v.__decorate)([X("is_collected"),Object(v.__metadata)("design:type",Object)],Sn.prototype,"isCollected",void 0),Object(v.__decorate)([X("is_owner"),Object(v.__metadata)("design:type",Object)],Sn.prototype,"isOwner",void 0),Object(v.__decorate)([X("is_pinned"),Object(v.__metadata)("design:type",Object)],Sn.prototype,"isPinned",void 0),Object(v.__decorate)([X("is_shortcut"),Object(v.__metadata)("design:type",Object)],Sn.prototype,"isShortcut",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",Object)],Sn.prototype,"isUserChangeTitle",void 0),Object(v.__decorate)([X("lastSyncTime"),Object(v.__metadata)("design:type",Number)],Sn.prototype,"lastSyncTimestamp",void 0),Object(v.__decorate)([X("last_browse_ts"),Object(v.__metadata)("design:type",Number)],Sn.prototype,"lastBrowseTimestamp",void 0),Object(v.__decorate)([X("last_collect_ts"),Object(v.__metadata)("design:type",Object)],Sn.prototype,"lastCollectTimestamp",void 0),Object(v.__decorate)([X("last_delete_ts"),Object(v.__metadata)("design:type",Object)],Sn.prototype,"lastDeleteTimestamp",void 0),Object(v.__decorate)([X("last_modify_ts"),Object(v.__metadata)("design:type",Number)],Sn.prototype,"lastModifyTimestamp",void 0),Object(v.__decorate)([X("last_modify_nick"),Object(v.__metadata)("design:type",String)],Sn.prototype,"lastModifyNick",void 0),Object(v.__decorate)([X("last_modify_uid"),Object(v.__metadata)("design:type",String)],Sn.prototype,"lastModifyUid",void 0),Object(v.__decorate)([X("last_pinned_ts"),Object(v.__metadata)("design:type",Number)],Sn.prototype,"lastPinnedTimestamp",void 0),Object(v.__decorate)([X("list_info_type"),Object(v.__metadata)("design:type",Number)],Sn.prototype,"listInfoType",void 0),Object(v.__decorate)([X("list_type"),Object(v.__metadata)("design:type",Number)],Sn.prototype,"listType",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",Boolean)],Sn.prototype,"offlineCommiting",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",Boolean)],Sn.prototype,"offlineCommitSuccessd",void 0),Object(v.__decorate)([X("origin_folder_id"),Object(v.__metadata)("design:type",String)],Sn.prototype,"originFolderId",void 0),Object(v.__decorate)([X("owner_nick"),Object(v.__metadata)("design:type",String)],Sn.prototype,"ownerNick",void 0),Object(v.__decorate)([X("owner_uid"),Object(v.__metadata)("design:type",String)],Sn.prototype,"ownerUid",void 0),Object(v.__decorate)([X("pad_id"),Object(v.__metadata)("design:type",String)],Sn.prototype,"padId",void 0),Object(v.__decorate)([X("parent_folder_id"),Object(v.__metadata)("design:type",String)],Sn.prototype,"parentFolderId",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",Array)],Sn.prototype,"parents",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",Number)],Sn.prototype,"privilege",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",String)],Sn.prototype,"status",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",String)],Sn.prototype,"title",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",Number)],Sn.prototype,"type",void 0),Object(v.__decorate)([X("uncommit"),Object(v.__metadata)("design:type",Boolean)],Sn.prototype,"hasLocalChanges",void 0),Object(v.__decorate)([X("doc_sub_type"),Object(v.__metadata)("design:type",Number)],Sn.prototype,"docSubType",void 0),Object(v.__decorate)([X("official_auth_info"),Object(v.__metadata)("design:type",String)],Sn.prototype,"officialAuthInfo",void 0),Object(v.__decorate)([X("personalize_info"),Object(v.__metadata)("design:type",String)],Sn.prototype,"personalizeInfo",void 0),Object(v.__decorate)([X("nativeEngineStatusRecord"),Object(v.__metadata)("design:type",String)],Sn.prototype,"nativeEngineStatusRecord",void 0),Object(v.__decorate)([X("nativeEngineDocPrivilege"),Object(v.__metadata)("design:type",String)],Sn.prototype,"nativeEngineDocPrivilege",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",String)],Sn.prototype,"data",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",String)],Sn.prototype,"ext",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",Boolean)],Sn.prototype,"isOfflineCacheByNative",void 0),Object(v.__decorate)([X("mime_type"),Object(v.__metadata)("design:type",String)],Sn.prototype,"mimeType",void 0),Object(v.__decorate)([X("owner_vip_info"),Object(v.__metadata)("design:type",String)],Sn.prototype,"ownerVipInfo",void 0),Object(v.__decorate)([X("documentResourceCacheStatus"),Object(v.__metadata)("design:type",String)],Sn.prototype,"documentResourceCacheStatus",void 0),Object(v.__decorate)([X("cache_status"),Object(v.__metadata)("design:type",Object)],Sn.prototype,"cacheStatus",void 0),Object(v.__decorate)([X("cache_status_ts"),Object(v.__metadata)("design:type",Number)],Sn.prototype,"cacheStatusTs",void 0),Sn=Object(v.__decorate)([$(en.padinfo)],Sn);var xn=function(e){p()(n,e);var t=En(n);function n(e){var r,i,o,a;return s()(this,n),(r=t.call(this)).docId=e.docId,r.pageType=e.pageType,r.updateTime=e.updateTime,r.tinyId=e.tinyId,r.wedriveUin=e.wedriveUin,r.wedocOpenId=e.wedocOpenId,r.nowUserIndex=null!==(i=e.nowUserIndex)&&void 0!==i?i:"",r.corpId=e.corpId,r.corpName=e.corpName,r.englishName=e.englishName,r.loginType=e.loginType,r.uidSource=e.uidSource,r.uin=e.uin,r.userId=e.userId,r.userName=e.userName,r.userPic=e.userPic,r.settings=e.settings,r.bindUserInfo=null!==(o=e.bindUserInfo)&&void 0!==o?o:{type:rn.UNBIND,userName:"",userPic:"",accountType:tn.UNKNOWN},r.vipUserInfo=null!==(a=e.vipUserInfo)&&void 0!==a?a:{type:on.NONE,vipLevel:an.NONE,beginTime:0,endTime:0},r.key="".concat(r.pageType,"-").concat(r.docId,"-").concat(r.tinyId),r}return d()(n)}(ae);Object(v.__decorate)([ee(),Object(v.__metadata)("design:type",String)],xn.prototype,"key",void 0),Object(v.__decorate)([Z(),Object(v.__metadata)("design:type",String)],xn.prototype,"tinyId",void 0),Object(v.__decorate)([Z(),Object(v.__metadata)("design:type",String)],xn.prototype,"nowUserIndex",void 0),Object(v.__decorate)([Z(),Object(v.__metadata)("design:type",String)],xn.prototype,"docId",void 0),Object(v.__decorate)([Z(),Object(v.__metadata)("design:type",String)],xn.prototype,"pageType",void 0),Object(v.__decorate)([Z(),Object(v.__metadata)("design:type",String)],xn.prototype,"wedriveUin",void 0),Object(v.__decorate)([Z(),Object(v.__metadata)("design:type",String)],xn.prototype,"wedocOpenId",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",String)],xn.prototype,"corpId",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",String)],xn.prototype,"corpName",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",String)],xn.prototype,"englishName",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",Number)],xn.prototype,"loginType",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",String)],xn.prototype,"openId",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",Number)],xn.prototype,"uidSource",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",String)],xn.prototype,"uin",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",String)],xn.prototype,"userId",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",String)],xn.prototype,"userName",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",String)],xn.prototype,"userPic",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",String)],xn.prototype,"updateTime",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",Object)],xn.prototype,"settings",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",Object)],xn.prototype,"bindUserInfo",void 0),Object(v.__decorate)([X(),Object(v.__metadata)("design:type",Object)],xn.prototype,"vipUserInfo",void 0),xn=Object(v.__decorate)([$(en.Users),Object(v.__metadata)("design:paramtypes",[Object])],xn)},"1202d342f1":function(e,t,n){"use strict";(function(e){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}n.d(t,"a",(function(){return L}));var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},i(e,t)};function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var a=function(){return a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},a.apply(this,arguments)};function c(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))}function s(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}}function u(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function d(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var l=function(){function e(e){this.duration=e,this.attempt=0}return e.prototype.next=function(e){throw new Error("Method not implemented.")},e}(),p=function(e){function t(t,n){var r=e.call(this,t)||this;return r.limit=n,r}return o(t,e),t.prototype.next=function(){return void 0===this.limit?this:this.attempt>=this.limit?void 0:(this.attempt+=1,this)},t}(l);new p(0,0);var f,h,b=function(){return!1},_=function(){return!1},v=function(){function e(e,t){void 0===e&&(e=b),void 0===t&&(t=_),this.errorFilter=e,this.resultFilter=t}return e.prototype.invoke=function(e,t){return c(this,void 0,void 0,(function(){var n,r,i;return s(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,e(t)];case 1:return n=o.sent(),this.resultFilter(n)?[2,{value:n}]:[2,{success:n}];case 2:if(r=o.sent(),i=r,!this.errorFilter(i))throw i;return[2,{error:i}];case 3:return[2]}}))}))},e}(),y=function(){function e(e){var t;this.options=e,this.executor=new v(e.errorFilter,e.resultFilter),this.backoffFactory=null!==(t=e.backoffFactory)&&void 0!==t?t:new p(0,e.maxRetry)}return e.prototype.execute=function(e){return c(this,void 0,void 0,(function(){var t,n,r,i,o;return s(this,(function(a){switch(a.label){case 0:t=0,a.label=1;case 1:return n={attempt:t,startTimestamp:Date.now()},[4,this.executor.invoke(e,n)];case 2:return"success"in(r=a.sent())?[2,r.success]:t<this.options.maxRetry?(i={attempt:t+1,result:r},(o=this.backoffFactory.next(i))?[4,(c=o.duration,s=Math.max(c,0),0===s?Promise.resolve():new Promise((function(e){return setTimeout(e,s)})))]:[3,4]):[3,5];case 3:a.sent(),a.label=4;case 4:return[3,6];case 5:if("error"in r)throw r.error;return[2,r.value];case 6:return t++,[3,1];case 7:return[2]}var c,s}))}))},e}(),g=function(e){return Math.max(null!=e?e:0,0)};(function(e){function t(t){var n,r=this;return(r=e.call(this,null!==(n=g(t[0]))&&void 0!==n?n:0)||this).durations=t,r}o(t,e),t.prototype.next=function(){if(!(this.attempt>=this.durations.length))return this.duration=g(this.durations[this.attempt]),this.attempt+=1,this}})(l),function(e){function t(t){var n,r=this;return(r=e.call(this,null!==(n=t({attempt:0}))&&void 0!==n?n:0)||this).generator=t,r}o(t,e),t.prototype.next=function(e){var t=this.generator(e);if(t)return this.duration=t,this}}(l);!function(e){e.aborted="ECONNABORTED",e.network="ERR_NETWORK",e.timeout="ETIMEDOUT",e.badRequest="ERR_BAD_REQUEST",e.badResponse="ERR_BAD_RESPONSE"}(f||(f={})),function(e){e[e.unknown=-1]="unknown",e[e.success=200]="success"}(h||(h={}));function m(e){return{data:e,status:h.success,statusText:"Success"}}function O(e){return{data:[],status:h.unknown,statusText:e}}var j=function(){function e(){this.interceptors=[]}return e.prototype.add=function(e){this.interceptors.push(e)},e.prototype.proceed=function(e){return c(this,void 0,void 0,(function(){var t;return s(this,(function(n){return t=Array.from(this.interceptors),this.fillBuildInInterceptors(t,e),[2,this.dispatch(e,t,0)]}))}))},e.prototype.dispatch=function(e,t,n){var r=this;if(n>=t.length){var i=m([]);return Promise.resolve(i)}return t[n].intercept((function(){return r.dispatch(e,t,n+1)}),e)},e}(),w=function(e){function t(){var t=this||self;return delete e.prototype.__magic__,t}return"object"==typeof globalThis?globalThis:this?t():(e.defineProperty(e.prototype,"__magic__",{configurable:!0,get:t}),__magic__)}(Object),I=function(){function e(){var e,t;this.canUseNativeAndroid=(null===(e=w.mqq)||void 0===e?void 0:e.android)&&(null===(t=w._mqqWebViewJSInterface)||void 0===t?void 0:t.invoke),this.currentSeqId=0,this.reqCallbacks=new Map}return e.prototype.JSApiCallback=function(e){var t=this.reqCallbacks.get(e.callbackId);if(!t)throw new Error("TypeError:[ark-request] the reqCallback of response[".concat(e.callbackId,"] can't found!"));t.callback(e)},e.prototype.invokeNative=function(e,t,n,r){var i,o=null!=n?n:{},a=o.command;if(r){var c=this.createReqSeq();this.reqCallbacks.set(c,{callback:r,command:a,startTime:Date.now()}),o.callbackId=c}this.canUseNativeAndroid?this.invokeNativeAndroid(e,t,o):null===(i=w.mqq)||void 0===i||i.invoke(e,t,o)},e.prototype.invokeNativeAndroid=function(e,t,n){var r,i="jsbridge://".concat(encodeURIComponent(e),"/").concat(encodeURIComponent(t));n&&(i+="?p=".concat(encodeURIComponent(JSON.stringify(n)))),null===(r=w._mqqWebViewJSInterface)||void 0===r||r.invoke(i)},e.prototype.createReqSeq=function(){return this.currentSeqId+=1},e}();w.jsApi||(w.jsApi=new I,w.JSApiCallback||(w.JSApiCallback=w.jsApi.JSApiCallback.bind(w.jsApi)));var S=w.jsApi,E=function(){function e(){}return e.prototype.invoke=function(e){return new Promise((function(t,n){if(!e.namespace)throw new Error("jsapi, namespace is null.");var r=e.params||{},i=e.callback?function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t(m(e))}:void 0;try{S.invokeNative(e.namespace,e.method,r,i),i||t(m([]))}catch(e){n(O("Error:[ark-request] Jsapi invokeNative fail."))}}))},e}();function x(e){return"[object Function]"===Object.prototype.toString.call(e)}var C,A,k=function(e){function t(){var t=this||self;return delete e.prototype.__magic__,t}return"object"==typeof globalThis?globalThis:this?t():(e.defineProperty(e.prototype,"__magic__",{configurable:!0,get:t}),__magic__)}(Object),R=function(){function e(){}return e.prototype.invoke=function(e){return c(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:if(!k.mqq)throw new Error("UnknownError:[ark-request] mqq channel is undefined.");if(!e.namespace)throw new Error("TypeError:[ark-request] mqq invoke has no namespace!");return t=k.mqq[e.namespace],(n=null==t?void 0:t[e.method])&&x(n)?[4,this.innerModuleInvoke(n,e.params,e.callback)]:[3,2];case 1:case 3:return[2,r.sent()];case 2:return[4,this.innerCoreInvoke(k.mqq.invoke,e)]}}))}))},e.prototype.innerModuleInvoke=function(e,t,n){return new Promise((function(r,i){var o=[];t&&o.push(t),n&&o.push((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r(m(e))}));try{e.apply(void 0,d([],u(o),!1)),n||r(m([]))}catch(e){i(O("Error:[ark-request] Mqq invoke module fail."))}}))},e.prototype.innerCoreInvoke=function(e,t){return new Promise((function(n,r){try{e(t.namespace,t.method,t.params,(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];n(m(e))}))}catch(e){r(O("Error:[ark-request] Mqq invoke core[".concat(t.namespace,".").concat(t.method,"] fail.")))}}))},e}();!function(e){e.mqq="mqq",e.jsapi="jsapi"}(A||(A={}));var D={schema:"mqq",channels:(C={},C[A.mqq]=R,C[A.jsapi]=E,C)},T=function(){function e(){}return e.prototype.intercept=function(e,t){return c(this,void 0,void 0,(function(){var e;return s(this,(function(n){switch(n.label){case 0:if(!t.schema)throw Error("TypeError[ark-request]: the schema of request(".concat(t.namespace,".").concat(t.method,") is undefined."));if(!(e=D.channels[t.schema]))throw Error("TypeError[ark-request]: can't match strategy to handle request(".concat(t.schema,".").concat(t.namespace,".").concat(t.method,")."));return[4,(new e).invoke(t)];case 1:return[2,n.sent()]}}))}))},e}(),N=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.fillBuildInInterceptors=function(e){return e.push(new T),e},t}(j),M=function(){function e(e){this.interceptors=e}return e.prototype.invoke=function(e){this.interceptors.proceed(a({schema:D.schema},e)).then((function(t){var n,r,i=t.data;null===(n=e.callback)||void 0===n||n.call.apply(n,d([e],u(i),!1)),e.removeCallback&&(null===(r=e.params)||void 0===r?void 0:r.callbackId)&&S.reqCallbacks.delete(e.params.callbackId)}))},e.prototype.register=function(e,t){if(!x(t))throw new Error("TypeError:[ark-request] The handler[".concat(e,"] to register is not function."));this.getNativeChannel()[this.generateCallbackName(e)]=t},e.prototype.unregister=function(e){this.getNativeChannel()[this.generateCallbackName(e)]=void 0},e.prototype.notify=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=this.getNativeChannel()[this.generateCallbackName(e)];if(!x(r))throw new Error("TypeError:[ark-request] The handler[".concat(e,"] is not function!"));r.apply(void 0,d([],u(t),!1))},e.prototype.generateCallbackName=function(e){return e},e.prototype.getNativeChannel=function(){return window},e}();var P,L=(P=new N,new M(P)),U={maxRetry:3},B=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}},q=Object.prototype.toString;function F(e){return Array.isArray(e)}function V(e){return void 0===e}function G(e){return"[object ArrayBuffer]"===q.call(e)}function W(e){return null!==e&&"object"===r(e)}function K(e){if("[object Object]"!==q.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function H(e){return"[object Function]"===q.call(e)}function Q(e,t){if(null!=e)if("object"!==r(e)&&(e=[e]),F(e))for(var n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(null,e[o],o,e)}var z={isArray:F,isArrayBuffer:G,isBuffer:function(e){return null!==e&&!V(e)&&null!==e.constructor&&!V(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"[object FormData]"===q.call(e)},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&G(e.buffer)},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:W,isPlainObject:K,isUndefined:V,isDate:function(e){return"[object Date]"===q.call(e)},isFile:function(e){return"[object File]"===q.call(e)},isBlob:function(e){return"[object Blob]"===q.call(e)},isFunction:H,isStream:function(e){return W(e)&&H(e.pipe)},isURLSearchParams:function(e){return"[object URLSearchParams]"===q.call(e)},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:Q,merge:function e(){var t={};function n(n,r){K(t[r])&&K(n)?t[r]=e(t[r],n):K(n)?t[r]=e({},n):F(n)?t[r]=n.slice():t[r]=n}for(var r=0,i=arguments.length;r<i;r++)Q(arguments[r],n);return t},extend:function(e,t,n){return Q(t,(function(t,r){e[r]=n&&"function"==typeof t?B(t,n):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}};function Y(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var J=function(e,t,n){if(!t)return e;var r;if(n)r=n(t);else if(z.isURLSearchParams(t))r=t.toString();else{var i=[];z.forEach(t,(function(e,t){null!=e&&(z.isArray(e)?t+="[]":e=[e],z.forEach(e,(function(e){z.isDate(e)?e=e.toISOString():z.isObject(e)&&(e=JSON.stringify(e)),i.push(Y(t)+"="+Y(e))})))})),r=i.join("&")}if(r){var o=e.indexOf("#");-1!==o&&(e=e.slice(0,o)),e+=(-1===e.indexOf("?")?"?":"&")+r}return e};function X(){this.handlers=[]}X.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},X.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},X.prototype.forEach=function(e){z.forEach(this.handlers,(function(t){null!==t&&e(t)}))};var $=X,Z=function(e,t){z.forEach(e,(function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])}))},ee=function(e,t,n,r,i){return e.config=t,n&&(e.code=n),e.request=r,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},e},te={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},ne=function(e,t,n,r,i){var o=new Error(e);return ee(o,t,n,r,i)},re=z.isStandardBrowserEnv()?{write:function(e,t,n,r,i,o){var a=[];a.push(e+"="+encodeURIComponent(t)),z.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),z.isString(r)&&a.push("path="+r),z.isString(i)&&a.push("domain="+i),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},ie=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],oe=z.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function r(e){var r=e;return t&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=r(window.location.href),function(t){var n=z.isString(t)?r(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0};function ae(e){this.message=e}ae.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},ae.prototype.__CANCEL__=!0;var ce=ae,se=function(e){return new Promise((function(t,n){var r,i=e.data,o=e.headers,a=e.responseType;function c(){e.cancelToken&&e.cancelToken.unsubscribe(r),e.signal&&e.signal.removeEventListener("abort",r)}z.isFormData(i)&&delete o["Content-Type"];var s=new XMLHttpRequest;if(e.auth){var u=e.auth.username||"",d=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";o.Authorization="Basic "+btoa(u+":"+d)}var l,p,f=(l=e.baseURL,p=e.url,l&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(p)?function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}(l,p):p);function h(){if(s){var r,i,o,u,d,l="getAllResponseHeaders"in s?(r=s.getAllResponseHeaders(),d={},r?(z.forEach(r.split("\n"),(function(e){if(u=e.indexOf(":"),i=z.trim(e.substr(0,u)).toLowerCase(),o=z.trim(e.substr(u+1)),i){if(d[i]&&ie.indexOf(i)>=0)return;d[i]="set-cookie"===i?(d[i]?d[i]:[]).concat([o]):d[i]?d[i]+", "+o:o}})),d):d):null;!function(e,t,n){var r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(ne("Request failed with status code "+n.status,n.config,null,n.request,n)):e(n)}((function(e){t(e),c()}),(function(e){n(e),c()}),{data:a&&"text"!==a&&"json"!==a?s.response:s.responseText,status:s.status,statusText:s.statusText,headers:l,config:e,request:s}),s=null}}if(s.open(e.method.toUpperCase(),J(f,e.params,e.paramsSerializer),!0),s.timeout=e.timeout,"onloadend"in s?s.onloadend=h:s.onreadystatechange=function(){s&&4===s.readyState&&(0!==s.status||s.responseURL&&0===s.responseURL.indexOf("file:"))&&setTimeout(h)},s.onabort=function(){s&&(n(ne("Request aborted",e,"ECONNABORTED",s)),s=null)},s.onerror=function(){n(ne("Network Error",e,null,s)),s=null},s.ontimeout=function(){var t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",r=e.transitional||te;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(ne(t,e,r.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",s)),s=null},z.isStandardBrowserEnv()){var b=(e.withCredentials||oe(f))&&e.xsrfCookieName?re.read(e.xsrfCookieName):void 0;b&&(o[e.xsrfHeaderName]=b)}"setRequestHeader"in s&&z.forEach(o,(function(e,t){void 0===i&&"content-type"===t.toLowerCase()?delete o[t]:s.setRequestHeader(t,e)})),z.isUndefined(e.withCredentials)||(s.withCredentials=!!e.withCredentials),a&&"json"!==a&&(s.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&s.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&s.upload&&s.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(r=function(e){s&&(n(!e||e&&e.type?new ce("canceled"):e),s.abort(),s=null)},e.cancelToken&&e.cancelToken.subscribe(r),e.signal&&(e.signal.aborted?r():e.signal.addEventListener("abort",r))),i||(i=null),s.send(i)}))},ue={"Content-Type":"application/x-www-form-urlencoded"};function de(e,t){!z.isUndefined(e)&&z.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var le,pe={transitional:te,adapter:(("undefined"!=typeof XMLHttpRequest||void 0!==e&&"[object process]"===Object.prototype.toString.call(e))&&(le=se),le),transformRequest:[function(e,t){return Z(t,"Accept"),Z(t,"Content-Type"),z.isFormData(e)||z.isArrayBuffer(e)||z.isBuffer(e)||z.isStream(e)||z.isFile(e)||z.isBlob(e)?e:z.isArrayBufferView(e)?e.buffer:z.isURLSearchParams(e)?(de(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):z.isObject(e)||t&&"application/json"===t["Content-Type"]?(de(t,"application/json"),function(e,t,n){if(z.isString(e))try{return(t||JSON.parse)(e),z.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional||pe.transitional,n=t&&t.silentJSONParsing,r=t&&t.forcedJSONParsing,i=!n&&"json"===this.responseType;if(i||r&&z.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(i){if("SyntaxError"===e.name)throw ee(e,this,"E_JSON_PARSE");throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};z.forEach(["delete","get","head"],(function(e){pe.headers[e]={}})),z.forEach(["post","put","patch"],(function(e){pe.headers[e]=z.merge(ue)}));var fe=pe,he=function(e,t,n){var r=this||fe;return z.forEach(n,(function(n){e=n.call(r,e,t)})),e},be=function(e){return!(!e||!e.__CANCEL__)};function _e(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new ce("canceled")}var ve=function(e){return _e(e),e.headers=e.headers||{},e.data=he.call(e,e.data,e.headers,e.transformRequest),e.headers=z.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),z.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||fe.adapter)(e).then((function(t){return _e(e),t.data=he.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return be(t)||(_e(e),t&&t.response&&(t.response.data=he.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))},ye=function(e,t){t=t||{};var n={};function r(e,t){return z.isPlainObject(e)&&z.isPlainObject(t)?z.merge(e,t):z.isPlainObject(t)?z.merge({},t):z.isArray(t)?t.slice():t}function i(n){return z.isUndefined(t[n])?z.isUndefined(e[n])?void 0:r(void 0,e[n]):r(e[n],t[n])}function o(e){if(!z.isUndefined(t[e]))return r(void 0,t[e])}function a(n){return z.isUndefined(t[n])?z.isUndefined(e[n])?void 0:r(void 0,e[n]):r(void 0,t[n])}function c(n){return n in t?r(e[n],t[n]):n in e?r(void 0,e[n]):void 0}var s={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:c};return z.forEach(Object.keys(e).concat(Object.keys(t)),(function(e){var t=s[e]||i,r=t(e);z.isUndefined(r)&&t!==c||(n[e]=r)})),n},ge="0.26.1",me=ge,Oe={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){Oe[e]=function(n){return r(n)===e||"a"+(t<1?"n ":" ")+e}}));var je={};Oe.transitional=function(e,t,n){function r(e,t){return"[Axios v"+me+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return function(n,i,o){if(!1===e)throw new Error(r(i," has been removed"+(t?" in "+t:"")));return t&&!je[i]&&(je[i]=!0,console.warn(r(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,i,o)}};var we={assertOptions:function(e,t,n){if("object"!==r(e))throw new TypeError("options must be an object");for(var i=Object.keys(e),o=i.length;o-- >0;){var a=i[o],c=t[a];if(c){var s=e[a],u=void 0===s||c(s,a,e);if(!0!==u)throw new TypeError("option "+a+" must be "+u)}else if(!0!==n)throw Error("Unknown option "+a)}},validators:Oe},Ie=we.validators;function Se(e){this.defaults=e,this.interceptors={request:new $,response:new $}}Se.prototype.request=function(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},(t=ye(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var n=t.transitional;void 0!==n&&we.assertOptions(n,{silentJSONParsing:Ie.transitional(Ie.boolean),forcedJSONParsing:Ie.transitional(Ie.boolean),clarifyTimeoutError:Ie.transitional(Ie.boolean)},!1);var r=[],i=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(i=i&&e.synchronous,r.unshift(e.fulfilled,e.rejected))}));var o,a=[];if(this.interceptors.response.forEach((function(e){a.push(e.fulfilled,e.rejected)})),!i){var c=[ve,void 0];for(Array.prototype.unshift.apply(c,r),c=c.concat(a),o=Promise.resolve(t);c.length;)o=o.then(c.shift(),c.shift());return o}for(var s=t;r.length;){var u=r.shift(),d=r.shift();try{s=u(s)}catch(e){d(e);break}}try{o=ve(s)}catch(e){return Promise.reject(e)}for(;a.length;)o=o.then(a.shift(),a.shift());return o},Se.prototype.getUri=function(e){return e=ye(this.defaults,e),J(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},z.forEach(["delete","get","head","options"],(function(e){Se.prototype[e]=function(t,n){return this.request(ye(n||{},{method:e,url:t,data:(n||{}).data}))}})),z.forEach(["post","put","patch"],(function(e){Se.prototype[e]=function(t,n,r){return this.request(ye(r||{},{method:e,url:t,data:n}))}}));var Ee=Se;function xe(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;this.promise.then((function(e){if(n._listeners){var t,r=n._listeners.length;for(t=0;t<r;t++)n._listeners[t](e);n._listeners=null}})),this.promise.then=function(e){var t,r=new Promise((function(e){n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e){n.reason||(n.reason=new ce(e),t(n.reason))}))}xe.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},xe.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},xe.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},xe.source=function(){var e;return{token:new xe((function(t){e=t})),cancel:e}};var Ce=xe;var Ae=function e(t){var n=new Ee(t),r=B(Ee.prototype.request,n);return z.extend(r,Ee.prototype,n),z.extend(r,n),r.create=function(n){return e(ye(t,n))},r}(fe);Ae.Axios=Ee,Ae.Cancel=ce,Ae.CancelToken=Ce,Ae.isCancel=be,Ae.VERSION=ge,Ae.all=function(e){return Promise.all(e)},Ae.spread=function(e){return function(t){return e.apply(null,t)}},Ae.isAxiosError=function(e){return z.isObject(e)&&!0===e.isAxiosError};var ke=Ae,Re=Ae;ke.default=Re;var De=ke,Te=function(){function e(){}return e.prototype.intercept=function(e,t){return c(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,De.request(t)];case 1:return[2,e.sent()]}}))}))},e}(),Ne=function(e){var t;return null===(t=e.message)||void 0===t?void 0:t.includes("timeout")},Me=function(){function e(){}return e.prototype.intercept=function(e,t){return c(this,void 0,void 0,(function(){var n=this;return s(this,(function(r){return t.maxRetry<=0?[2,e()]:[2,new y(a({maxRetry:U.maxRetry,errorFilter:Ne},t)).execute((function(t){return c(n,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:return[4,e()];case 1:return(n=r.sent()).retryContext=t,[2,n]}}))}))}))]}))}))},e}(),Pe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.fillBuildInInterceptors=function(e,t){var n;return(null!==(n=t.maxRetry)&&void 0!==n?n:U.maxRetry)>0&&e.push(new Me),e.push(new Te),e},t}(j),Le=function(){function e(e,t){this.defaults=e,this.interceptors=t}return e.prototype.get=function(e,t){return this.dispatchRequest("get",e,void 0,t)},e.prototype.post=function(e,t,n){return this.dispatchRequest("post",e,t,n)},e.prototype.request=function(e){return this.interceptors.proceed(a(a({},this.defaults),e))},e.prototype.dispatchRequest=function(e,t,n,r){var i,o=null!=r?r:{},c=null!==(i=o.headers)&&void 0!==i?i:{};return o.contentType&&(c["Content-Type"]=o.contentType),this.interceptors.proceed(a(a(a({},this.defaults),o),{url:t,method:e,headers:c,data:null!=n?n:o.data}))},e}();!function(e){var t=new Pe;new Le(e||U,t)}()}).call(this,n("6c0cbd9268"))},"14208e3877":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r="/pages/list/list?reason=pskey_error"},"15112eddea":function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return i}));var r=n("2513870b1e"),i=function(){function t(){}return t.createClientVarsToDomainProxy=function(e,n,r,i){t.createLevel2PrivilegeProxy(n,i),t.createLevel2AdvPolicyProxy(n,i),t.createLevel1Proxy(e,n,r,i)},t.getProxyHandler=function(e){return{get:function(t,n){return Object.keys(e).includes(n)?e[n]:t[n]},set:function(t,n,r){return Object.keys(e).includes(n)?e[n]=r:t[n]=r,!0}}},t.createLevel1Proxy=function(n,i,o,a){var c=a,s=r.a.getLevel1MapInfo(n,i,o),u=t.getProxyHandler(s);e.clientVars=new Proxy(c,u)},t.createLevel2PrivilegeProxy=function(e,n){var i=n,o=r.a.getLevel2AdvPolicyMapInfo(e),a=t.getProxyHandler(o);i.privilegeAttribute=new Proxy(n.privilegeAttribute||{},a)},t.createLevel2AdvPolicyProxy=function(e,n){var i=n,o=r.a.getLevel2AdvPolicyMapInfo(e),a=t.getProxyHandler(o);i.advPolicy=new Proxy(i.advPolicy,a)},t}()}).call(this,n("5ef37df1a0"))},"16995032fd":function(e,t,n){"use strict";(function(e){var r=n("d7c625d1f2"),i=n("14208e3877"),o=n("da5bb142c9"),a=n("333708e013"),c=n("1add19ffb1"),s=n("03808c4177"),u=n("dd1b838932"),d=n("8b13fcae36"),l=function(t){function n(e,n){var r=t.call(this,n)||this;return r.networkRequestService=e,r.loginRepository=new a.a(e),r}return Object(r.__extends)(n,t),n.prototype.reloadMiniProgramForDesktop=function(){var e,t;null===(t=null===(e=null===window||void 0===window?void 0:window.wx)||void 0===e?void 0:e.miniProgram)||void 0===t||t.reLaunch({url:i.a})},n.prototype.loginDocsInMiniProgram=function(e){var t,n,r,i="/pages/detail/detail?reason=pskey_error&url=".concat(encodeURIComponent(e));Object(u.getQuery)("rtkey")&&(i+="&scene=".concat(Object(u.getQuery)("rtkey"))),null===(r=null===(n=null===(t=window.wx)||void 0===t?void 0:t.miniProgram)||void 0===n?void 0:n.reLaunch)||void 0===r||r.call(n,{url:i})},n.prototype.loginDocsInWework=function(e){if(o.b===o.i){var t="".concat(o.a,"?url=").concat(encodeURIComponent(e)),n="".concat(o.d,"?appid=ww20388f7040b655b7&redirect_uri=").concat(encodeURIComponent(t),"&response_type=code&scope=snsapi_userinfo&state=weworklogin#wechat_redirect");location.replace(n)}},n.prototype.jumpToLoginInWechatWebview=function(e){Object(d.tencentDocOpenUrlForAll)({url:"".concat(o.m,"?url=").concat(encodeURIComponent(e),"&wxonly=1"),replace:!0})},n.prototype.jumpToLoginInWeworkWebview=function(e){var t="".concat(o.d,"?appid=ww20388f7040b655b7&redirect_uri=").concat(encodeURIComponent(e),"&response_type=code&scope=snsapi_userinfo&state=weworklogin#wechat_redirect");Object(d.tencentDocOpenUrlForAll)({url:t,replace:!0})},n.prototype.jumpToLoginInCommonView=function(e){Object(d.tencentDocOpenUrlForAll)({url:"".concat(o.c,"?jump_url=").concat(encodeURIComponent(e)),replace:!0})},n.prototype.timOrQQH5Login=function(){window.mqq?window.mqq.invoke("data","updateLoginInfo",{key:"pskey"},(function(){location.reload()})):e.location.reload()},n=Object(r.__decorate)([Object(r.__param)(0,s.a),Object(r.__metadata)("design:paramtypes",[Object,String])],n)}(c.a);t.a=l}).call(this,n("5ef37df1a0"))},"192278b140":function(e,t,n){"use strict";n.d(t,"a",(function(){return G}));var r=n("d7c625d1f2"),i=n("8a3f853387"),o=n("03808c4177"),a=n("540dabb65d"),c=n("76702c352f"),s=n("6423ed0b81"),u=n("5ac65fff24"),d=function(){function e(e){this.networkRequestService=e}return e.prototype.getAccountList=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n;return Object(r.__generator)(this,(function(r){return n="".concat(u.e,"?xrsf=").concat(Object(s.c)(s.a.xsrf)),e?[2,this.networkRequestService.instance.get(n,{params:{padID:e}})]:t?[2,this.networkRequestService.instance.get(n,{params:{folderID:t}})]:[2,this.networkRequestService.instance.get(n)]}))}))},e.prototype.delAccountForList=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){return t="".concat(u.b,"?xrsf=").concat(Object(s.c)(s.a.xsrf),"&u=").concat(e),[2,this.networkRequestService.instance.get(t)]}))}))},e.prototype.changeSign=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){return t="".concat(u.a,"?xrsf=").concat(Object(s.c)(s.a.xsrf),"&u=").concat(e),[2,this.networkRequestService.instance.get(t,{withCredentials:!0})]}))}))},Object(r.__decorate)([Object(c.b)(),Object(c.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String,String]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"getAccountList",null),Object(r.__decorate)([Object(c.b)(),Object(c.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"delAccountForList",null),Object(r.__decorate)([Object(c.b)(),Object(c.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"changeSign",null),e=Object(r.__decorate)([Object(r.__param)(0,o.a),Object(r.__metadata)("design:paramtypes",[Object])],e)}(),l=n("98c24f707d"),p=function(e){function t(t,n){var r=e.call(this,n)||this;return r.networkRequestService=t,r.accountListRepository=new d(t),r.accountList=[],r}return Object(r.__extends)(t,e),t.prototype.changeSign=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return[4,this.accountListRepository.changeSign(e)];case 1:return[2,0===(null==(t=n.sent().resData)?void 0:t.retcode)]}}))}))},t.prototype.getAccountList=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n,i,o;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.accountListRepository.getAccountList(e,t)];case 1:return n=r.sent().resData,this.accountList=(null===(o=null===(i=null==n?void 0:n.data)||void 0===i?void 0:i.result)||void 0===o?void 0:o.accounts)?n.data.result.accounts:[],[2,this.accountList]}}))}))},t.prototype.delAccountForList=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return[4,this.accountListRepository.delAccountForList(e)];case 1:return t=n.sent().resData,this.updateListAfterDel(e),[2,0===(null==t?void 0:t.retcode)]}}))}))},t.prototype.updateListAfterDel=function(e){this.accountList=this.accountList.filter((function(t){return t.userIndex!==e}))},t=Object(r.__decorate)([Object(r.__param)(0,o.a),Object(r.__metadata)("design:paramtypes",[Object,String])],t)}(l.a),f=p,h=n("5be39fbf8a"),b=n("fb1099018f"),_="".concat(b.h,"/online_docs_cgi/pwd/add"),v="".concat(b.h,"/online_docs_cgi/pwd/del"),y="".concat(b.h,"/online_docs_cgi/pwd/verify"),g="".concat(b.h,"/online_docs_cgi/pwd/reset"),m="".concat(b.h,"/online_docs_cgi/pwd/verify_code_get"),O="".concat(b.h,"/online_docs_cgi/pwd/verify_code_check"),j="".concat(b.h,"/online_docs_cgi/pwd/question_check"),w="".concat(b.h,"/online_docs_cgi/pwd/question_get"),I="".concat(b.h,"/online_docs_cgi/pwd/tips_get"),S="".concat(b.h,"/online_docs_cgi/pwd/token_verify"),E=("".concat(b.h,"/online_docs_cgi/pwd/tips_report"),function(){function e(e){this.networkRequestService=e}return e.prototype.pwdAdd=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){return t=Object(h.d)(Object(r.__assign)({xsrf:Object(s.c)(s.a.xsrf)},e)),[2,this.networkRequestService.instance.post(_,t)]}))}))},e.prototype.pwdDel=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){return t=Object(h.d)(Object(r.__assign)({xsrf:Object(s.c)(s.a.xsrf)},this.changeParam(e))),[2,this.networkRequestService.instance.post(v,t)]}))}))},e.prototype.pwdVerify=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){return t=Object(h.d)(Object(r.__assign)({xsrf:Object(s.c)(s.a.xsrf)},e)),[2,this.networkRequestService.instance.post(y,t)]}))}))},e.prototype.pwdReset=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){return t=Object(h.d)(Object(r.__assign)({xsrf:Object(s.c)(s.a.xsrf)},this.changeParam(e))),[2,this.networkRequestService.instance.post(g,t)]}))}))},e.prototype.pwdVerifyCodeGet=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){return t=Object(h.d)(Object(r.__assign)({xsrf:Object(s.c)(s.a.xsrf)},e)),[2,this.networkRequestService.instance.post(m,t)]}))}))},e.prototype.pwdVerifyCodeCheck=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){return t=Object(h.d)(Object(r.__assign)({xsrf:Object(s.c)(s.a.xsrf)},e)),[2,this.networkRequestService.instance.post(O,t)]}))}))},e.prototype.pwdQuestionCheck=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){return t=Object(h.d)(Object(r.__assign)({xsrf:Object(s.c)(s.a.xsrf)},this.changeParam(e))),[2,this.networkRequestService.instance.post(j,t)]}))}))},e.prototype.pwdQuestionGet=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e;return Object(r.__generator)(this,(function(t){return e=Object(h.d)({xsrf:Object(s.c)(s.a.xsrf)}),[2,this.networkRequestService.instance.post(w,e)]}))}))},e.prototype.pwdTipsGet=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e;return Object(r.__generator)(this,(function(t){return e=Object(h.d)({xsrf:Object(s.c)(s.a.xsrf)}),[2,this.networkRequestService.instance.post(I,e)]}))}))},e.prototype.pwdTokenVerify=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.networkRequestService.instance.post(S,Object(r.__assign)({xsrf:Object(s.c)(s.a.xsrf)},e))]}))}))},e.prototype.changeParam=function(e){return e.question_info?Object(r.__assign)(Object(r.__assign)({},e),{question_info:JSON.stringify(e.question_info)}):e},Object(r.__decorate)([Object(c.b)(),Object(c.c)(),Object(c.e)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"pwdAdd",null),Object(r.__decorate)([Object(c.b)(),Object(c.c)(),Object(c.e)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"pwdDel",null),Object(r.__decorate)([Object(c.b)(),Object(c.c)(),Object(c.e)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"pwdVerify",null),Object(r.__decorate)([Object(c.b)(),Object(c.c)(),Object(c.e)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"pwdReset",null),Object(r.__decorate)([Object(c.b)(),Object(c.c)(),Object(c.e)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"pwdVerifyCodeGet",null),Object(r.__decorate)([Object(c.b)(),Object(c.c)(),Object(c.e)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"pwdVerifyCodeCheck",null),Object(r.__decorate)([Object(c.b)(),Object(c.c)(),Object(c.e)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"pwdQuestionCheck",null),Object(r.__decorate)([Object(c.b)(),Object(c.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"pwdQuestionGet",null),Object(r.__decorate)([Object(c.b)(),Object(c.c)(),Object(c.e)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"pwdTipsGet",null),Object(r.__decorate)([Object(c.b)(),Object(c.c)(),Object(c.e)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"pwdTokenVerify",null),e=Object(r.__decorate)([Object(r.__param)(0,o.a),Object(r.__metadata)("design:paramtypes",[Object])],e)}()),x=function(e){function t(t,n){var r=e.call(this,n)||this;return r.networkRequestService=t,r.phone="",r.isHasPassword=!1,r.pwdQuestionList=[],r.passwordRepository=new E(r.networkRequestService),r}return Object(r.__extends)(t,e),t.prototype.updatePwdTips=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.passwordRepository.pwdTipsGet()];case 1:return e=r.sent().resData,this.isHasPassword=!!(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.hasPwd),this.phone=null!==(i=null===(n=null==e?void 0:e.data)||void 0===n?void 0:n.pwdPhoneNum)&&void 0!==i?i:"",[2]}}))}))},t.prototype.updatePwdQuestionList=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t,n;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.passwordRepository.pwdQuestionGet()];case 1:return e=r.sent().resData,this.pwdQuestionList=null!==(n=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.questionInfo)&&void 0!==n?n:[],[2]}}))}))},t=Object(r.__decorate)([Object(r.__param)(0,o.a),Object(r.__metadata)("design:paramtypes",[Object,String])],t)}(l.a),C=n("c929b8af70"),A=n("66fd263031"),k=n("61cea32eb2"),R=n("8139f7151b"),D=function(e){function t(t){var n=e.call(this)||this;if(n.type=R.h.NONE,n.vipLevel=R.g.NONE,n.beginTime=0,n.endTime=0,n.vip={status:0,beginTime:0,endTime:0,renewalStatus:0},n.svip={status:0,beginTime:0,endTime:0,renewalStatus:0},n.svipPlus={status:0,beginTime:0,endTime:0,renewalStatus:0},n.customInfo={avatarFrame:"",badgeUrl:"",corpVipLevel:R.a.INVALID_CORP_VIP_LEVEL},n.renewal=R.b.NONE,n.cursor={},n.cursorId="",n.alwayShowCursor=!1,!(null==t?void 0:t.result))return n;var r=n.handleVipInfoFromNet(t);return n.jsonObj2Class(r),n}return Object(r.__extends)(t,e),t.prototype.updateVipUserInfo=function(e){if(e.result){var t=this.handleVipInfoFromNet(e);this.jsonObj2Class(t)}},t.prototype.updateEnterpriseVipUserInfo=function(e){if(e){var t=this.handleVipCustomInfoFromNet(e);this.jsonObj2Class({customInfo:t})}},t.prototype.handleVipInfoFromNet=function(e){var t,n=R.h.NONE,r=R.g.NONE,i=R.d.CLOSE,o=e.result.all,a=o.info,c=o.vip,s=o.superVip,u=o.superVipPlus,d=o.decorationConfig,l=0,p=0,f=0;return(null==u?void 0:u.endTime)&&(p=1e3*parseInt(u.endTime,10)),s.endTime&&(l=1e3*parseInt(s.endTime,10)),c.endTime&&(f=1e3*parseInt(c.endTime,10)),a.vipLevel===R.c.SUPER_PLUS?(n=R.h.SUPER_PLUS,r=R.g.SUPER_PLUS,i=R.d.OPEN):a.vipLevel===R.c.SUPER?(n=R.h.SUPER,r=R.g.SUPER,i=R.d.OPEN):a.vipLevel===R.c.NORMAL&&(n=R.h.NORMAL,r=R.g.NORMAL,i=R.d.OPEN),a.expiredStatus===R.e.EXPIRED&&(n=R.h.EXPIRED,r=R.g.EXPIRED,i=R.d.EXPIRED),{vip:{status:i,beginTime:0,endTime:f},svip:{status:s.status,beginTime:0,endTime:l},svipPlus:{status:null==u?void 0:u.status,beginTime:0,endTime:p},type:n,vipLevel:r,beginTime:0,endTime:0,renewal:a.renewalStatus,customInfo:{avatarFrame:a.avatarFrameUrl,badgeUrl:a.badgeUrl,corpVipLevel:a.corpVipLevel},cursor:this.parseCursor(a.cursor),cursorId:a.cursorId,alwayShowCursor:(null===(t=null==d?void 0:d.cursor)||void 0===t?void 0:t.alwaysShowSelfCursor)||!1}},t.prototype.parseCursor=function(e){var t={};try{t=JSON.parse(e)}catch(e){t={}}return t},t.prototype.handleVipCustomInfoFromNet=function(e){var t={avatar_frame_url:"",badge_url:"",corp_vip_level:R.a.INVALID_CORP_VIP_LEVEL};try{t=JSON.parse(e)}catch(e){}var n=t.avatar_frame_url,r=void 0===n?"":n,i=t.badge_url,o=void 0===i?"":i,a=t.corp_vip_level;return{avatarFrame:r,badgeUrl:o,corpVipLevel:void 0===a?R.a.INVALID_CORP_VIP_LEVEL:a}},t}(k.a),T=n("c398fb2896"),N=n("1add19ffb1"),M=n("65e41bd588"),P=n("2b7737cff5"),L=n("c9b8a6765d"),U=function(e){function t(t,n,r){var i=e.call(this,n)||this;return i.networkRequestService=t,i.userInfo=new L.a,i.vipInfo=new D,i.bindUserInfo=new C.a,i.officialInfo=new A.a,i.userInfo=new L.a(r),i.accountListEntity=new f(t,n),i.passwordEntity=new x(t,n),i.accountRepository=new T.a(t),i}return Object(r.__extends)(t,e),t.prototype.completionUserInfo=function(e){e.wechatOfficialAccount&&(this.officialInfo=new A.a(e.wechatOfficialAccount)),this.bindUserInfo=new C.a(e)},t.prototype.completionVipInfo=function(e){this.vipInfo.updateVipUserInfo(e)},t.prototype.updateNowUserIndex=function(e){e&&(window.nowUserIndex=e)},t.prototype.currentLoginAccountBindInfo=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t,n;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.accountRepository.CurrentLoginAccountBindInfo()];case 1:return e=r.sent(),(t=null===(n=e.resData)||void 0===n?void 0:n.data)?[2,t]:[2,{allowBind:!1,allowUnbind:!1,nextAllowBindTime:0,nextAllowUnbindTime:0,autoRenewal:!1}]}}))}))},t.prototype.bindingQQInfo=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,o,a,c,s;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return e=this.userInfo.loginType,t=![M.a.QQ,M.a.WX].includes(e),[4,this.accountRepository.CurrentLoginAccountBindInfo()];case 1:return n=r.sent(),[4,this.accountRepository.BindingAccountInfo(t)];case 2:return i=r.sent(),o=null===(c=n.resData)||void 0===c?void 0:c.data,a=null===(s=i.resData)||void 0===s?void 0:s.data,o&&a?[2,{isCanBind:o.allowBind&&a.allowBind,nextBindTime:Object(P.a)([o.nextAllowBindTime,a.nextAllowBindTime]),qqNickName:a.nick,qqAvatar:a.avatar}]:[2,{isCanBind:!1,nextBindTime:0,qqAvatar:"",qqNickName:""}]}}))}))},t=Object(r.__decorate)([Object(r.__param)(0,o.a),Object(r.__metadata)("design:paramtypes",[Object,String,Object])],t)}(N.a),B=n("b6e58b965b"),q="".concat(b.h,"/api/vipcenter/info/all"),F="".concat(b.h,"/api/personalize/show/tips"),V=function(){function e(e){this.networkRequestService=e}return e.prototype.getPersonalVipInfo=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e;return Object(r.__generator)(this,(function(t){return e=Object(h.d)({xsrf:Object(s.c)(s.a.xsrf)}),[2,this.networkRequestService.instance.post(q,e)]}))}))},e.prototype.getPersonalTipsShow=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){return t=Object(h.d)(Object(r.__assign)(Object(r.__assign)({},e),{xsrf:Object(s.c)(s.a.xsrf)})),[2,this.networkRequestService.instance.post(F,t)]}))}))},Object(r.__decorate)([Object(c.b)(),Object(c.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"getPersonalVipInfo",null),Object(r.__decorate)([Object(c.b)(),Object(c.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"getPersonalTipsShow",null),e=Object(r.__decorate)([Object(r.__param)(0,o.a),Object(r.__metadata)("design:paramtypes",[Object])],e)}(),G=function(){function e(e){this.networkRequestService=e,this.userInfoRepository=new B.a(this.networkRequestService),this.vipInfoRepository=new V(this.networkRequestService)}return e.prototype.init=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){return[2]}))}))},e.prototype.createPersonalEnvAccountAggregateByUserInfoCgi=function(e,t){var n=this.changeFetchDataToBaseDate(e,t);return this.accountAggregate=new U(this.networkRequestService,n.tinyId,n),this.accountAggregate.completionUserInfo(e),!0},e.prototype.createPersonalEnvAccountAggregateByBasicClientVars=function(e){return e?(this.accountAggregate=new U(this.networkRequestService,e.tinyId||i.h,e),!0):(this.accountAggregate=new U(this.networkRequestService,i.h),!1)},e.prototype.updatePersonalEnvAccountAggregate=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,o;return Object(r.__generator)(this,(function(r){return this.updateUserIndex(e),t=null===(o=null===(i=null===(n=this.accountAggregate)||void 0===n?void 0:n.userInfo)||void 0===i?void 0:i.settings)||void 0===o?void 0:o.language,[2,this.createPersonalEnvAccountAggregateForFetch(e,t)]}))}))},e.prototype.completionUserInfo=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e;return Object(r.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.userInfoRepository.getPersonalUserInfo()];case 1:return 0===(null==(e=t.sent().resData)?void 0:e.retcode)?(this.accountAggregate.completionUserInfo(e.data),[2,!0]):[2,!1]}}))}))},e.prototype.updatePersonalNicknameAndAvatar=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return[4,this.userInfoRepository.updatePersonalNicknameAndAvatar(e)];case 1:return 0===(null==(t=n.sent().resData)?void 0:t.retcode)?[2,!0]:[2,!1]}}))}))},e.prototype.getUserVipInfo=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e;return Object(r.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.vipInfoRepository.getPersonalVipInfo()];case 1:return 0===(null==(e=t.sent().resData)?void 0:e.retcode)?(this.accountAggregate.completionVipInfo(e.data),[2,!0]):[2,!1]}}))}))},e.prototype.getTipsStatus=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return[4,this.vipInfoRepository.getPersonalTipsShow(e)];case 1:return 0===(null==(t=n.sent().resData)?void 0:t.retcode)?[2,t.data.result.isShow]:[2,!1]}}))}))},e.prototype.createPersonalEnvAccountAggregateForFetch=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n,i;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.userInfoRepository.getPersonalUserInfo()];case 1:return 0!==(null==(n=r.sent().resData)?void 0:n.retcode)?[3,3]:(i=this.changeFetchDataToBaseDate(n.data,e,t),this.accountAggregate=new U(this.networkRequestService,n.data.tinyid,i),this.accountAggregate.completionUserInfo(n.data),[4,this.getUserVipInfo()]);case 2:return r.sent(),[2,!0];case 3:return[2,!1]}}))}))},e.prototype.changeFetchDataToBaseDate=function(e,t,n){var r=e.corpId,i=e.tinyid,o=e.corpName,a=e.englishName,c=e.loginType,s=e.wxOpenid,u=e.uin,d=e.uidSource,l=e.userId,p=e.avatar,f=e.nick;return{corpId:r,corpName:o,englishName:a,loginType:c,uin:u,uidSource:d,userId:null!=l?l:"p.".concat(i),nowUserIndex:null!=t?t:"",tinyId:i,openId:s,userName:f,userPic:p,settings:{language:null!=n?n:"",toolbarMode:"",vipTheme:""}}},e.prototype.updateUserIndex=function(e){this.accountAggregate.updateNowUserIndex(e)},Object(r.__decorate)([Object(a.a)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"init",null),e=Object(r.__decorate)([Object(r.__param)(0,o.a),Object(r.__metadata)("design:paramtypes",[Object])],e)}()},"1add19ffb1":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("d7c625d1f2"),i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.aggregateVersion=0,t.aggregateIsDeleted=!1,t}return Object(r.__extends)(t,e),t.prototype.version=function(){return this.aggregateVersion},t.prototype.isDeleted=function(){return this.aggregateIsDeleted},t}(n("98c24f707d").a)},"1bf5e44e9b":function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n("d7c625d1f2"),i=n("2e1bb889e5"),o=n("15112eddea"),a=n("536530eec5"),c=n("3c9d61c2e2"),s=function(){function e(e,t,n){this.docMetaDomainService=e,this.authDomainService=t,this.userInfoDomainService=n}return e.prototype.updateDomainWithClientVars=function(e,t){void 0===t&&(t=!1),this.docMetaDomainService.updateWithClientVars(e),this.authDomainService.updateWithClientVars(e),this.userInfoDomainService.updateWithClientVars(e),t&&o.a.createClientVarsToDomainProxy(this.docMetaDomainService,this.authDomainService,this.userInfoDomainService,e)},e.prototype.updateDomainWithRequests=function(e){this.docMetaDomainService.init(e),this.authDomainService.init(e),this.userInfoDomainService.init(e)},e=Object(r.__decorate)([Object(r.__param)(0,a.a),Object(r.__param)(1,i.a),Object(r.__param)(2,c.a),Object(r.__metadata)("design:paramtypes",[Object,Object,Object])],e)}()},"1c3848e586":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("cedf7830be"),i=Object(r.a)("ILikeDomainService")},"1cc181d9f8":function(e,t,n){"use strict";function r(e){this.message=e}r.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},r.prototype.__CANCEL__=!0,e.exports=r},"2223a5a8ca":function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n("d7c625d1f2"),i=n("536530eec5"),o=n("3c9d61c2e2"),a=n("540dabb65d"),c=function(){function e(e,t){this.docMetaDomain=e,this.userInfoDomain=t}return e.prototype.init=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return console.log("EnterpriseLikeDomainService ~ init ~ do nothing",e),[2]}))}))},Object(r.__decorate)([Object(a.a)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"init",null),e=Object(r.__decorate)([Object(r.__param)(0,i.a),Object(r.__param)(1,o.a),Object(r.__metadata)("design:paramtypes",[Object,Object])],e)}()},"22b96304bb":function(e,t,n){"use strict";var r=n("94b54f38ee");e.exports=function(e,t){r.forEach(e,(function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])}))}},"239887fb93":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tryToMarkDispose=t.tryToDispose=t.toDisposable=t.combinedDisposable=t.dispose=t.isDisposable=void 0;var r=n("697ecdc674"),i=n("0d99992889");function o(e){return"function"==typeof e.dispose&&(0===e.dispose.length||1===e.dispose.length)}function a(e,t){if(Array.isArray(e)){var n=t||r.DisposeTrace.traceRoot("disposables");return e.forEach((function(e){e&&(i.markTracked(e),e.dispose(n))})),n.stop(),[]}if(e){var o=t||r.DisposeTrace.traceRoot("disposables");return i.markTracked(e),e.dispose(o),o.stop(),e}}t.isDisposable=o,t.dispose=a,t.combinedDisposable=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.forEach(i.markTracked),i.trackDisposable({dispose:function(t){return a(e,t)}})},t.toDisposable=function(e,t){void 0===t&&(t="");var n=i.trackDisposable({dispose:function(t){i.markTracked(n),e(t)},disposableId:t});return n},t.tryToDispose=function(e,t){e&&o(e)&&e.dispose(t)},t.tryToMarkDispose=function(e){o(e)&&i.markTracked(e)}},"2513870b1e":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(){function e(){}return e.getLevel1MapInfo=function(e,t,n){return{domainId:e.docMetaEntity.padInfo.domainId,padId:e.docMetaEntity.padInfo.padId,type:e.docMetaEntity.padInfo.type,padType:e.docMetaEntity.padInfo.padType,shareLink:e.docMetaEntity.padInfo.shareLink,docStatus:e.docMetaEntity.padInfo.docStatus,globalPadId:e.docMetaEntity.padInfo.globalPadId,lastModifyUser:e.docMetaEntity.padInfo.lastModifyUser,lastModifyTime:e.docMetaEntity.padInfo.lastModifyTime,metaCreateTime:e.docMetaEntity.createInfo.metaCreateTime,creatorId:e.docMetaEntity.createInfo.creatorId,creatorNick:e.docMetaEntity.createInfo.creatorNick,creatorDomain:e.docMetaEntity.createInfo.creatorDomain,isCreator:e.docMetaEntity.createInfo.isCreator,ownerId:e.docMetaEntity.ownerInfo.ownerId,ownerNick:e.docMetaEntity.ownerInfo.ownerNick,ownerAppid:e.docMetaEntity.ownerInfo.ownerAppid,officialAuthInfo:e.docMetaEntity.ownerInfo.officialAuthInfo,padTitle:e.docMetaEntity.titleInfo.title,title:e.docMetaEntity.titleInfo.title,isUserChangeTitle:e.docMetaEntity.titleInfo.isUserChangeTitle,rightFlag:t.authAggregate.authInfoEntity.selfRole,isOwner:t.authAggregate.authInfoEntity.isOwner,tinyid:n.userInfoAggregate.userInfo.tinyid,userName:n.userInfoAggregate.userInfo.nick,userPic:n.userInfoAggregate.userInfo.avatar,userType:n.userInfoAggregate.userInfo.loginType,userId:n.userInfoAggregate.userInfo.uid,uin:n.userInfoAggregate.userInfo.uin}},e.getLevel2PrivilegeMapInfo=function(e){var t=e.authAggregate.authInfoEntity.selfDocPrivilege;return{can_copy:t.canCopy,can_print:t.canPrint,can_history:t.canHistory,can_read:t.canRead,can_edit_title:t.canEditTitle,can_search:t.canSearch,can_add_user:t.canAddUser,can_view_image:t.canViewImage,can_edit:t.canEdit,can_share:t.canShare,can_comment:t.canComment,can_about:t.canAbout,can_spit_slot:t.canSpitSlot,can_watermark:t.canWatermark,can_translate:t.canTranslate,can_link_exp:t.canLinkExp,can_copy_doc:t.canCopyDoc}},e.getLevel2AdvPolicyMapInfo=function(e){var t=e.authAggregate.authInfoEntity.selfDocAdvancedPrivilege;return{reader_can_comment:t.readerCanComment,view_forbid_copy_print:t.viewForbidCopyPrint,writer_can_comment:t.writerCanComment}},e}()},"2c8ead4d96":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("cedf7830be"),i=Object(r.a)("IAccountDomainService")},"2e1bb889e5":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("cedf7830be"),i=Object(r.a)("IAuthDomainService")},"31996f4bca":function(e,t,n){"use strict";n.d(t,"a",(function(){return I}));var r=n("d7c625d1f2"),i=n("fb1099018f"),o="".concat(i.b,"mention/mention_add"),a="".concat(i.b,"mention/mention_del"),c="".concat(i.b,"mention/get_doc_mention_list"),s="".concat(i.b,"mention/get_my_mention_list"),u="".concat(i.b,"mention/mention_read_report"),d=n("03808c4177"),l=n("5be39fbf8a"),p=n("536530eec5"),f=n("6423ed0b81"),h=function(){function e(e,t){this.docMetaDomainService=e,this.networkRequestService=t}return e.prototype.getDocMentionList=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return e=Object(l.d)({globalPadId:this.globalPadId,xsrf:Object(f.c)(f.a.xsrf)}),t="".concat(c),[4,this.networkRequestService.instance.post(t,e)];case 1:return[2,n.sent()]}}))}))},e.prototype.getMyMentionList=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return e=Object(l.d)({globalPadId:this.globalPadId,xsrf:Object(f.c)(f.a.xsrf)}),t="".concat(s),[4,this.networkRequestService.instance.post(t,e)];case 1:return[2,n.sent()]}}))}))},e.prototype.deleteMention=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return t=Object(l.d)({globalPadId:this.globalPadId,mentions:JSON.stringify(e),xsrf:Object(f.c)(f.a.xsrf)}),n="".concat(a),[4,this.networkRequestService.instance.post(n,t)];case 1:return[2,r.sent()]}}))}))},e.prototype.addMention=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n,i;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return n=Object(l.d)({globalPadId:this.globalPadId,mentions:JSON.stringify(e),vfwebqq:t,xsrf:Object(f.c)(f.a.xsrf)}),i="".concat(o),[4,this.networkRequestService.instance.post(i,n)];case 1:return[2,r.sent()]}}))}))},e.prototype.mentionReadReport=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return t=Object(l.d)({globalPadId:this.globalPadId,mentions:JSON.stringify(e),xsrf:Object(f.c)(f.a.xsrf)}),n="".concat(u),[4,this.networkRequestService.instance.post(n,t)];case 1:return[2,r.sent()]}}))}))},Object.defineProperty(e.prototype,"globalPadId",{get:function(){var e=this.docMetaDomainService.docMetaEntity.padInfo.padId,t=this.docMetaDomainService.docMetaEntity.padInfo.domainId;return Object(l.f)(t,e)},enumerable:!1,configurable:!0}),e=Object(r.__decorate)([Object(r.__param)(0,p.a),Object(r.__param)(1,d.a),Object(r.__metadata)("design:paramtypes",[Object,Object])],e)}(),b=n("61cea32eb2"),_=function(e){function t(t){var n=e.call(this)||this;return n.anchorId="",n.mentionId="",n.mentionType=0,n.notify=0,n.read=!1,n.targetId="",n.sender={},n.mentionedUser={},n.jsonObj2Class(t),n}return Object(r.__extends)(t,e),t}(b.a),v=function(e){function t(t){var n=e.call(this)||this;return n.anchorId="",n.mentionId="",n.mentionType=0,n.notify=0,n.targetId="",n.read=!1,n.mentionFrom={},n.mentionTo={},n.jsonObj2Class(t),n}return Object(r.__extends)(t,e),t}(b.a),y=n("1add19ffb1"),g=n("76702c352f"),m=n("9ab1857893"),O="mentions",j=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.docMetaDomainService=n,i.networkRequestService=r,i.atMeUserList=[],i.atUserList=[],i.onAtUserListUpdatedEmitter=new m.Emitter,i.onAtMeUserListUpdatedEmitter=new m.Emitter,i.onAtUserListUpdated=i.onAtUserListUpdatedEmitter.event,i.onAtMeUserListUpdated=i.onAtMeUserListUpdatedEmitter.event,i.atMessageRepository=new h(n,r),i}return Object(r.__extends)(t,e),t.prototype.getDocMentionList=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){switch(e.label){case 0:return[4,this.atMessageRepository.getDocMentionList()];case 1:return[2,e.sent()]}}))}))},t.prototype.getMyMentionList=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){switch(e.label){case 0:return[4,this.atMessageRepository.getMyMentionList()];case 1:return[2,e.sent()]}}))}))},t.prototype.addMention=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return t=Object(l.i)(),[4,this.atMessageRepository.addMention(e,t)];case 1:return[2,n.sent()]}}))}))},t.prototype.deleteMention=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.atMessageRepository.deleteMention(e)];case 1:return[2,t.sent()]}}))}))},t.prototype.clearMentionMarks=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.atMessageRepository.mentionReadReport(e)];case 1:return[2,t.sent()]}}))}))},Object(r.__decorate)([Object(g.g)(_.prototype.constructor,"atUserList","result",O),Object(g.b)(),Object(g.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[]),Object(r.__metadata)("design:returntype",Promise)],t.prototype,"getDocMentionList",null),Object(r.__decorate)([Object(g.f)(v.prototype.constructor,"atMeUserList",O),Object(g.b)(),Object(g.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[]),Object(r.__metadata)("design:returntype",Promise)],t.prototype,"getMyMentionList",null),Object(r.__decorate)([Object(g.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Array]),Object(r.__metadata)("design:returntype",Promise)],t.prototype,"addMention",null),Object(r.__decorate)([Object(g.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Array]),Object(r.__metadata)("design:returntype",Promise)],t.prototype,"deleteMention",null),Object(r.__decorate)([Object(g.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Array]),Object(r.__metadata)("design:returntype",Promise)],t.prototype,"clearMentionMarks",null),t=Object(r.__decorate)([Object(r.__param)(1,p.a),Object(r.__param)(2,d.a),Object(r.__metadata)("design:paramtypes",[String,Object,Object])],t)}(y.a),w=n("540dabb65d"),I=function(){function e(e,t){this.docMetaDomainService=e,this.networkRequest=t,this.atMessageAggregate=new j("mainAtMessageAggregate",e,t)}return e.prototype.init=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.docMetaDomainService.init(e)];case 1:return t.sent(),[2]}}))}))},Object(r.__decorate)([Object(w.a)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"init",null),e=Object(r.__decorate)([Object(r.__param)(0,p.a),Object(r.__param)(1,d.a),Object(r.__metadata)("design:paramtypes",[Object,Object])],e)}()},"31a899c9f3":function(e,t){e.exports={version:"0.26.1"}},"333708e013":function(e,t,n){"use strict";var r,i,o,a=n("d7c625d1f2"),c=n("76702c352f"),s=n("03808c4177"),u=n("6423ed0b81"),d=n("6fa7b8d7bc"),l=n("fb1099018f"),p=n("00c2fdc893"),f="".concat(Object(p.a)(l.h),"/v2/cgi-bin/online_docs/polling"),h="".concat(l.a,"polling/key/create"),b="".concat(l.h,"/cgi-bin/online_docs/wxqrcode"),_=("".concat(l.c,"user_info"),"".concat(l.h,"/api/user/qq/login")),v="".concat(Object(p.a)(l.h),"/api/user/oauth/qq/login"),y="".concat(l.a,"work_weixin/login"),g="".concat(l.h,"/api/user/login/wxqrcode");!function(e){e.none="",e.login="login"}(r||(r={})),function(e){e[e.none=0]="none",e[e.request=1]="request"}(i||(i={})),function(e){e[e.WECHAT_LOGIN_CASE_DEFAULT=0]="WECHAT_LOGIN_CASE_DEFAULT",e[e.WECHAT_LOGIN_CASE_H5=1]="WECHAT_LOGIN_CASE_H5"}(o||(o={}));var m="x-u",O="userIndex",j=function(){function e(e){this.networkRequestService=e}return e.prototype.pollingKeyCreate=function(e){return Object(a.__awaiter)(this,void 0,void 0,(function(){var t;return Object(a.__generator)(this,(function(n){return t="".concat(h,"?ac=").concat(e),[2,this.networkRequestService.instance.post(t,{xsrf:Object(u.c)(u.a.xsrf)})]}))}))},e.prototype.getWeChatLogInQRURI=function(){return Object(a.__awaiter)(this,arguments,void 0,(function(e){var t;return void 0===e&&(e=o.WECHAT_LOGIN_CASE_DEFAULT),Object(a.__generator)(this,(function(n){return t=Object(d.a)(g,{case:e}),[2,this.networkRequestService.instance.get(t)]}))}))},e.prototype.getWeChatLogInQRCodeURI=function(){return Object(a.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(a.__generator)(this,(function(n){return e={ac:"login",ts:Date.now(),page:encodeURIComponent("pages/landingpage/landingpage"),checkKey:"1",xsrf:"".concat(Object(u.c)(u.a.xsrf))},t=Object(d.a)(b,e),[2,this.networkRequestService.instance.get(t)]}))}))},e.prototype.updateWeChatLoginQRCodeStatus=function(e,t){return Object(a.__awaiter)(this,void 0,void 0,(function(){var n,r;return Object(a.__generator)(this,(function(i){return n=Object(a.__assign)({CheckKey:e,u:"login"},t),r=Object(d.a)(f,n),[2,this.networkRequestService.instance.post(r,void 0,{withCredentials:!0})]}))}))},e.prototype.updateEnterpriseWeChatLoginQRCodeStatus=function(e){return Object(a.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(a.__generator)(this,(function(r){return t={CheckKey:e},n=Object(d.a)(f,t),[2,this.networkRequestService.instance.post(n,void 0,{withCredentials:!0})]}))}))},e.prototype.checkQQLogin=function(){return Object(a.__awaiter)(this,void 0,void 0,(function(){var e;return Object(a.__generator)(this,(function(t){return e="".concat(_,"?u=login"),[2,this.networkRequestService.instance.post(e,{xsrf:Object(u.c)(u.a.xsrf)})]}))}))},e.prototype.checkQQOAuthLogin=function(e,t){return Object(a.__awaiter)(this,void 0,void 0,(function(){var n,r;return Object(a.__generator)(this,(function(i){return n=Object(a.__assign)({state:"state",xsrf:Object(u.c)(u.a.xsrf)||"",code:e},t),r=Object(d.a)(v,n),[2,this.networkRequestService.instance.get(r,{withCredentials:!0})]}))}))},e.prototype.weworkLogin=function(){return Object(a.__awaiter)(this,void 0,void 0,(function(){var e;return Object(a.__generator)(this,(function(t){return e="".concat(y,"?u=login"),[2,this.networkRequestService.instance.post(e,{xsrf:Object(u.c)(u.a.xsrf)})]}))}))},Object(a.__decorate)([Object(c.b)(),Object(c.c)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",[String]),Object(a.__metadata)("design:returntype",Promise)],e.prototype,"pollingKeyCreate",null),Object(a.__decorate)([Object(c.b)(),Object(c.c)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",[Object]),Object(a.__metadata)("design:returntype",Promise)],e.prototype,"getWeChatLogInQRURI",null),Object(a.__decorate)([Object(c.b)(),Object(c.c)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",[]),Object(a.__metadata)("design:returntype",Promise)],e.prototype,"getWeChatLogInQRCodeURI",null),Object(a.__decorate)([Object(c.b)(),Object(c.c)(),Object(c.h)(m,O),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",[String,Object]),Object(a.__metadata)("design:returntype",Promise)],e.prototype,"updateWeChatLoginQRCodeStatus",null),Object(a.__decorate)([Object(c.b)(),Object(c.c)(),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",[String]),Object(a.__metadata)("design:returntype",Promise)],e.prototype,"updateEnterpriseWeChatLoginQRCodeStatus",null),Object(a.__decorate)([Object(c.b)(),Object(c.c)(),Object(c.h)(m,O),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",[]),Object(a.__metadata)("design:returntype",Promise)],e.prototype,"checkQQLogin",null),Object(a.__decorate)([Object(c.b)(),Object(c.c)(),Object(c.h)(m,O),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",[String,Object]),Object(a.__metadata)("design:returntype",Promise)],e.prototype,"checkQQOAuthLogin",null),Object(a.__decorate)([Object(c.b)(),Object(c.c)(),Object(c.h)(m,O),Object(a.__metadata)("design:type",Function),Object(a.__metadata)("design:paramtypes",[]),Object(a.__metadata)("design:returntype",Promise)],e.prototype,"weworkLogin",null),e=Object(a.__decorate)([Object(a.__param)(0,s.a),Object(a.__metadata)("design:paramtypes",[Object])],e)}();t.a=j},"33b33312c5":function(e,t,n){"use strict";n.d(t,"a",(function(){return ee}));var r,i=n("d7c625d1f2"),o=n("540dabb65d"),a=n("da5bb142c9"),c=n("9ab1857893");!function(e){e.ON="ON",e.OFF="OFF"}(r||(r={}));var s,u=function(){function e(e){this.emitter=new c.Emitter,this.listenersArray=[],this.messageCheckFn=e,this.initEmitterEvent(),this.msgHandler=this.messageCallback.bind(this)}return e.prototype.connect=function(){this.connectState!==r.ON&&(this.connectState=r.ON,window.addEventListener("message",this.msgHandler))},e.prototype.setIframeDom=function(e,t){this.iframeDom=e,this.targetOrigin=t},e.prototype.send=function(e){var t;this.iframeDom&&(null===(t=this.iframeDom.contentWindow)||void 0===t||t.postMessage(e,"*"))},e.prototype.receive=function(e){this.listenersArray.includes(e)||this.listenersArray.push(e)},e.prototype.dispose=function(){window.removeEventListener("message",this.msgHandler),this.connectState=r.OFF,this.listenersArray=[]},e.prototype.messageCallback=function(e){var t=!0;this.messageCheckFn&&(t=this.messageCheckFn(e)),t&&this.emitter.fire(e)},e.prototype.initEmitterEvent=function(){var e=this;this.emitter.event((function(t){e.listenersArray.forEach((function(e){"function"==typeof e&&e(t)}))}))},e}(),d=a.h,l="ALREADY_IFRAME_GET_ACCOUNT_LIST_FROM_B",p="GET_ACCOUNT_LIST_FROM_B",f="DELETE_ACCOUNT_LIST_FROM_B",h="SUCCESS_GET_ACCOUNT_LIST_FROM_B",b="SUCCESS_DELETE_ACCOUNT_LIST_FROM_B",_=a.f,v="iframe-to-manage-account-list",y=function(){function e(){this.getAccountMessage=new u(this.getAccountMessageCheckFn),this.iframeMountMessage=new u(this.getIframeMountMessageCheckFn),this.deleteAccountMessage=new u(this.getDeleteAccountMessageCheckFn)}return e.prototype.connect=function(){this.getAccountMessage.connect(),this.iframeMountMessage.connect(),this.deleteAccountMessage.connect()},e.prototype.dispose=function(){this.getAccountMessage.dispose(),this.iframeMountMessage.dispose(),this.deleteAccountMessage.dispose()},e.prototype.createGetAccountListIframe=function(e){var t=this;this.getAccountListIframeDom=this.createMessageIframe((function(n,r){r?(t.getAccountMessage.setIframeDom(n,d),t.deleteAccountMessage.setIframeDom(n,d)):null==e||e()}))},e.prototype.sendAccountListMessage=function(){this.getAccountMessage.send({eventFromCDomain:p})},e.prototype.sendDeleteAccountMessage=function(e){this.deleteAccountMessage.send({eventFromCDomain:f,cookie:e})},e.prototype.getAccountListMessage=function(e){this.getAccountMessage.receive(e)},e.prototype.getIframeMountMessage=function(e){this.iframeMountMessage.receive(e)},e.prototype.getDeleteAccountMessage=function(e){this.deleteAccountMessage.receive(e)},e.prototype.createMessageIframe=function(e){if(document.getElementById(v))return e(document.getElementById(v),!1),document.getElementById(v);var t=document.createElement("iframe");return t.src=_,t.id=v,t.style.visibility="hidden",t.style.width="0px",t.style.height="0px",document.body.appendChild(t),e(t,!0),t},e.prototype.getAccountMessageCheckFn=function(e){var t=e.data;return e.origin===d&&t.eventFromBDomain===h},e.prototype.getIframeMountMessageCheckFn=function(e){var t=e.data;return e.origin===d&&t.eventFromBDomain===l},e.prototype.getDeleteAccountMessageCheckFn=function(e){var t=e.data;return e.origin===d&&t.eventFromBDomain===b},e}(),g="IFRAME_ALREADY",m="GET_LOGINED_ACCOUNT",O="WILL_CHANGE_LOGINED_ACCOUNT",j="DELETE_LOGINED_ACCOUNT",w=a.l,I=a.j,S="iframe-to-manage-account-list",E=function(){function e(){this.getAccountMessage=new u(this.getAccountMessageCheckFn),this.iframeMountMessage=new u(this.getIframeMountMessageCheckFn),this.deleteAccountMessage=new u(this.getDeleteAccountMessageCheckFn)}return e.prototype.connect=function(){this.getAccountMessage.connect(),this.iframeMountMessage.connect(),this.deleteAccountMessage.connect()},e.prototype.dispose=function(){this.getAccountMessage.dispose(),this.iframeMountMessage.dispose(),this.deleteAccountMessage.dispose()},e.prototype.createGetAccountListIframe=function(e){var t=this;this.createMessageIframe((function(n,r){r?(t.getAccountMessage.setIframeDom(n,w),t.deleteAccountMessage.setIframeDom(n,w)):null==e||e()}))},e.prototype.sendAccountListMessage=function(){this.getAccountMessage.send({event:m})},e.prototype.sendDeleteAccountMessage=function(e){this.deleteAccountMessage.send({event:j,uid:e})},e.prototype.getAccountListMessage=function(e){this.getAccountMessage.receive(e)},e.prototype.getDeleteAccountMessage=function(e){this.deleteAccountMessage.receive(e)},e.prototype.getIframeMountMessage=function(e){this.iframeMountMessage.receive(e)},e.prototype.getAccountMessageCheckFn=function(e){return e.data.event===O},e.prototype.getIframeMountMessageCheckFn=function(e){return e.data.event===g},e.prototype.getDeleteAccountMessageCheckFn=function(e){return e.data.event===O},e.prototype.createMessageIframe=function(e){if(document.getElementById(S))return e(document.getElementById(S),!1),document.getElementById(S);var t=document.createElement("iframe");return t.src=I,t.id=S,t.style.visibility="hidden",t.style.width="0px",t.style.height="0px",document.body.appendChild(t),e(t,!0),t},e}(),x="ALREADY_JUMP_B_IFRAME",C="B_PAGE_SET_COOKIE",A="SUCCESS_SET_COOKIE",k=a.h,R=a.g,D="iframe-to-b-set-cookie",T=function(){function e(){this.iframeMountMessage=new u(this.getIframeMountMessageCheckFn),this.switchAccountMessage=new u(this.getSwitchAccountMessageCheckFn)}return e.prototype.connect=function(){this.iframeMountMessage.connect(),this.switchAccountMessage.connect()},e.prototype.dispose=function(){this.iframeMountMessage.dispose(),this.switchAccountMessage.dispose()},e.prototype.createSwitchEnterpriseAccount=function(e){var t=this;this.switchAccountDom=this.createMessageIframe((function(n,r){r?t.switchAccountMessage.setIframeDom(n,k):null==e||e()}))},e.prototype.getIframeMountMessage=function(e){this.iframeMountMessage.receive(e)},e.prototype.getSwitchAccountMessage=function(e){this.switchAccountMessage.receive(e)},e.prototype.sendSwitchAccountMessage=function(e){this.switchAccountMessage.send({event:C,cookie:e,fromDomain:"B_DOMAIN"})},e.prototype.createMessageIframe=function(e){document.getElementById(D)&&e(document.getElementById(D),!1);var t=document.createElement("iframe");return t.src=R,t.id=D,t.style.visibility="hidden",t.style.width="0px",t.style.height="0px",document.body.appendChild(t),e(t,!0),t},e.prototype.getIframeMountMessageCheckFn=function(e){var t=e.data;return e.origin===k&&t.event===x},e.prototype.getSwitchAccountMessageCheckFn=function(e){var t=e.data;return e.origin===k&&t.event===A},e}(),N="ALREADY_JUMP_C_IFRAME",M="C_PAGE_SET_COOKIE",P="SUCCESS_SET_COOKIE",L="EXPIRED_COOKIE",U=[a.l],B=a.l,q=a.k,F="iframe-to-c-set-cookie",V=function(){function e(){this.iframeMountMessage=new u(this.getIframeMountMessageCheckFn),this.switchAccountMessage=new u(this.getSwitchAccountMessageCheckFn)}return e.prototype.connect=function(){this.iframeMountMessage.connect(),this.switchAccountMessage.connect()},e.prototype.dispose=function(){this.iframeMountMessage.dispose(),this.switchAccountMessage.dispose()},e.prototype.createSwitchEnterpriseAccount=function(e){var t=this;this.createMessageIframe((function(n,r){r?t.switchAccountMessage.setIframeDom(n,B):null==e||e()}))},e.prototype.getIframeMountMessage=function(e){this.iframeMountMessage.receive(e)},e.prototype.sendSwitchAccountMessage=function(e){this.switchAccountMessage.send({event:M,cookie:e,fromDomain:"C_DOMAIN"})},e.prototype.getSwitchAccountMessage=function(e){this.switchAccountMessage.receive(e)},e.prototype.createMessageIframe=function(e){document.getElementById(F)&&e(document.getElementById(F),!1);var t=document.createElement("iframe");return t.src=q,t.id=F,t.style.visibility="hidden",t.style.width="0px",t.style.height="0px",document.body.appendChild(t),e(t,!0),t},e.prototype.getIframeMountMessageCheckFn=function(e){var t=e.data,n=e.origin;return U.indexOf(n)>-1&&t.event===N},e.prototype.getSwitchAccountMessageCheckFn=function(e){var t=e.data,n=e.origin;return U.indexOf(n)>-1&&(t.event===P||t.event===L)},e}();!function(e){e.ON="ON",e.OFF="OFF"}(s||(s={}));var G,W=function(){function e(e,t){this.emitter=new c.Emitter,this.listenersArray=[],window.BroadcastChannel&&(this.channel=new window.BroadcastChannel(e)),this.messageCheckFn=t}return e.prototype.connect=function(){var e=this;this.connectState!==s.ON&&(this.connectState=s.ON,this.emitter.event((function(t){e.listenersArray.forEach((function(e){"function"==typeof e&&e(t)}))})),this.channel.onmessage=this.messageCallback.bind(this))},e.prototype.send=function(e){var t;null===(t=this.channel)||void 0===t||t.postMessage(e)},e.prototype.receive=function(e){this.listenersArray.includes(e)||this.listenersArray.push(e)},e.prototype.dispose=function(){var e;null===(e=this.channel)||void 0===e||e.close()},e.prototype.messageCallback=function(e){var t=!0;this.messageCheckFn&&(t=this.messageCheckFn(e)),t&&this.emitter.fire(e)},e}(),K=n("834b03d62c"),H=function(){function e(){this.logoutMessage=new W("docMessageCenterChannel",this.logoutMessageCheckFn),this.key="".concat(Math.floor(1e9*Math.random()),"_").concat(+new Date)}return e.prototype.connect=function(){this.logoutMessage.connect()},e.prototype.getLogoutMessage=function(e){this.logoutMessage.receive(e)},e.prototype.sendLogoutMessage=function(e){this.logoutMessage.send({key:this.key,type:K.a.LOGOUT,userIndex:e})},e.prototype.logoutMessageCheckFn=function(e){return e.data.key!==this.key},e}();!function(e){e.QFYF_SUCCESS="login qfyf success",e.QQ_LOGIN_SUCCESS="login qq success",e.QQ_OAUTH_LOGIN_SUCCESS="login qq oauth success",e.QQ_BING_SUCCESS="bind qq success",e.QQ_IFRAME_MOUNT="mount qq iframe success"}(G||(G={}));var Q=a.i,z=function(){function e(){this.getQQLoginMessage=new u(this.getQQLoginMessageCheckFn)}return e.prototype.connect=function(){this.getQQLoginMessage.connect()},e.prototype.dispose=function(){this.getQQLoginMessage.dispose(),this.qqIframeMountListener=void 0},e.prototype.getQQLoginSuccessMessage=function(e){this.getQQLoginMessage.receive(e)},e.prototype.getQQIframeMessage=function(e){this.qqIframeMountListener=e},e.prototype.createQQLoginIframe=function(e,t){var n=this,r=document.createElement("iframe");return r.src=t,r.frameBorder="0",r.scrolling="auto",r.width="100%",r.height="100%",r.id="login_frame",r.name="login_frame",r.onload=function(){var e;null===(e=n.qqIframeMountListener)||void 0===e||e.call(n,new MessageEvent(G.QQ_IFRAME_MOUNT))},e.appendChild(r),r},e.prototype.getQQLoginMessageCheckFn=function(e){var t=e.data;return!(!e.origin.indexOf(Q)||!(t===G.QQ_LOGIN_SUCCESS||"string"==typeof t&&t.startsWith(G.QQ_OAUTH_LOGIN_SUCCESS)))},e}(),Y=function(){this.qqLoginMessage=new z},J=a.i,X=a.e,$=function(){function e(){this.envType="person",this.getWeworkLoginMessage=new u(this.getWeworkLoginMessageCheckFn)}return e.prototype.connect=function(e){e&&(this.envType=e),this.getWeworkLoginMessage.connect()},e.prototype.dispose=function(){this.weworkIframeMountListener=void 0,this.getWeworkLoginMessage.dispose()},e.prototype.getWeworkLoginSuccessMessage=function(e){this.getWeworkLoginMessage.receive(e)},e.prototype.getWeworkIframeMessage=function(e){this.weworkIframeMountListener=e},e.prototype.createWeworkLoginIframe=function(e,t){var n=this,r=document.createElement("iframe");return r.src=t,r.frameBorder="0",r.scrolling="auto",r.width="100%",r.height="100%",r.id="login_frame",r.name="login_frame",r.onload=function(){var e;null===(e=n.weworkIframeMountListener)||void 0===e||e.call(n,new MessageEvent("IFRAME_DOM_MOUNTED"))},e.appendChild(r),r},e.prototype.getWeworkLoginMessageCheckFn=function(e){var t=e.data,n=e.origin,r="person"===this.envType?J:X;return!(!n.indexOf(r)||"string"!=typeof t||!t.includes("login wework success"))},e}(),Z=function(){this.weworkLoginMessage=new $},ee=function(){function e(){this.getEnterpriseAccountListMessage=new y,this.switchEnterpriseAccountMessage=new T,this.getPersonAccountListMessage=new E,this.switchPersonAccountMessage=new V,this.qqMessage=new Y,this.weworkMessage=new Z,this.logoutMessage=new H}return e.prototype.init=function(){return Object(i.__awaiter)(this,void 0,void 0,(function(){return Object(i.__generator)(this,(function(e){return[2]}))}))},Object(i.__decorate)([Object(o.a)(),Object(i.__metadata)("design:type",Function),Object(i.__metadata)("design:paramtypes",[]),Object(i.__metadata)("design:returntype",Promise)],e.prototype,"init",null),e}()},"389ef8f989":function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i}));var r=function(){try{var e=localStorage.getItem("person-account-wedriveUin-tinyid-map")||"{}";return JSON.parse(e)}catch(e){return console.error(e),{}}},i=function(e){var t=e.wedriveUin,n=e.tinyid;try{var r=localStorage.getItem("person-account-wedriveUin-tinyid-map")||"{}",i=JSON.parse(r);i[t]=n,localStorage.setItem("person-account-wedriveUin-tinyid-map",i)}catch(e){console.error(e)}}},"39a4b3c3c1":function(e,t,n){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},"39cb95f88d":function(e,t,n){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},"3bf31b711a":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("cedf7830be"),i=Object(r.a)("IDomainUpdater")},"3c9d61c2e2":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("cedf7830be"),i=Object(r.a)("IUserInfoDomainService")},"424dfc5646":function(e,t,n){"use strict";n.d(t,"a",(function(){return j}));var r,i=n("d7c625d1f2"),o=n("76702c352f"),a=n("5bfdce0c9d"),c=n("536530eec5"),s=n("540dabb65d"),u=function(){function e(e){this.fileDescRepo=e}return e.prototype.init=function(e){Object.assign(this,e)},e.prototype.fetchFileDesc=function(e){return Object(i.__awaiter)(this,void 0,void 0,(function(){return Object(i.__generator)(this,(function(t){return[2,this.fileDescRepo.fetchFileDesc(e)]}))}))},e.prototype.getFormattedFileSize=function(){var e=this.accurateSize;if(0===Number(e))return"0 B";var t=Math.floor(Math.log(e)/Math.log(1024));return"".concat(parseFloat((e/Math.pow(1024,t)).toPrecision(3))," ").concat(["B","KB","MB","GB","TB","PB","EB","ZB","YB"][t])},e}(),d=n("5cc83026a5"),l=((r={})[d.a.UNKNOWN]=/jpg|jpeg|bmp|gif|png|webp|avi|mp4|mkv|mov|webm|opus|flv|hls|ts|dash|mp3|aac|flac|wav|amr/,r[d.a.DOC]=/doc|dot|wps|wpt|docx|dotx|docm|dotm/,r[d.a.SHEET]=/xls|xlt|xlsx|xltx|csv|xlsb|xlsm|xltm|et|ett|ets/,r[d.a.TEXT]=/lrc|c|cpp|h|asm|s|java|asp|bat|bas|prg|cmd|rtf|txt|log|xml|htm|html/,r[d.a.SLIDE]=/pptx|ppt|pot|potx|pps|ppsx|dps|dpt|pptm|potm|ppsm/,r),p=/(doc|docx|xls|xlsx|txt|csv|ppt|pptx)$/i,f=function(){function e(e){this.fileMetaRepo=e}return e.prototype.init=function(e){Object.assign(this,e)},e.prototype.initWithFileInfoRsp=function(e){var t=e.mimeType,n=e.fileMeta;Object.assign(this,Object(i.__assign)(Object(i.__assign)({},n),{mimeType:t,icon:n.iconUrl}))},e.prototype.fetchPreviewInfo=function(){return Object(i.__awaiter)(this,arguments,void 0,(function(e){return void 0===e&&(e={}),Object(i.__generator)(this,(function(t){return[2,this.fileMetaRepo.fetchPreviewInfo({fileId:this.fileId,addBrowseRecord:(null==e?void 0:e.addBrowseRecord)||!1,previewAttribute:Object(i.__assign)({srcType:this.ext},e.previewAttribute)})]}))}))},e.prototype.fetchPreviewQuery=function(e){return Object(i.__awaiter)(this,void 0,void 0,(function(){return Object(i.__generator)(this,(function(t){return[2,this.fileMetaRepo.fetchPreviewQuery({fileId:this.fileId,shouldRetry:e})]}))}))},e.prototype.fetchDownloadInfo=function(e){return Object(i.__awaiter)(this,void 0,void 0,(function(){return Object(i.__generator)(this,(function(t){return[2,this.fileMetaRepo.fetchDownloadInfo(e)]}))}))},e.prototype.fetchCopyInfo=function(e){return Object(i.__awaiter)(this,void 0,void 0,(function(){return Object(i.__generator)(this,(function(t){return[2,this.fileMetaRepo.fetchCopyInfo(e)]}))}))},e.prototype.getDrivePadType=function(){for(var e=this.cosInfo,t=0,n=Object.keys(l);t<n.length;t++){var r=n[t],i=l[r];if((null==e?void 0:e.driveExt)&&i.test(e.driveExt))return r}return d.a.DOC},e.prototype.canBeConvertedToOnlineDocs=function(){var e=this.ext;return p.test(e)},e.prototype.getFormattedFileSize=function(){var e=this.size;if(0===Number(e))return"0 B";var t=Math.floor(Math.log(e)/Math.log(1024));return"".concat(parseFloat((e/Math.pow(1024,t)).toPrecision(3))," ").concat(["B","KB","MB","GB","TB","PB","EB","ZB","YB"][t])},e}(),h=n("5be39fbf8a"),b=n("b512c0eccb"),_=n("a52ab4297c"),v=n.n(_),y=function(){function e(){}return e.prototype.fetchFileDesc=function(e){return Object(i.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(i.__generator)(this,(function(r){switch(r.label){case 0:return t={xsrf:Object(h.j)()},n=v.a.stringify(t),[4,b.networkRequest.post("".concat("/v2/drive/file/desc","?").concat(n),{file_id:e})];case 1:return[2,r.sent()]}}))}))},Object(i.__decorate)([Object(o.c)(),Object(i.__metadata)("design:type",Function),Object(i.__metadata)("design:paramtypes",[String]),Object(i.__metadata)("design:returntype",Promise)],e.prototype,"fetchFileDesc",null),e}(),g=n("6423ed0b81"),m=function(){function e(){}return e.prototype.fetchPreviewInfo=function(e){return Object(i.__awaiter)(this,void 0,void 0,(function(){var t,n,r,o,a,c,s,u,d,l,p,f,h,_;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:return t=e.fileId,n=e.addBrowseRecord,r=void 0===n||n,o=e.previewAttribute,a=o.srcType,c=o.dstType,s=o.page,u=o.sheet,d=o.showComment,l=o.quality,p=o.scale,f={xsrf:Object(g.c)(g.a.xsrf)},h=v.a.stringify(f),_={file_id:t,add_browse_record:r,preview_attr:{page:s,sheet:u,quality:l,scale:p,src_type:a,ddst_type:c,show_comment:d}},[4,b.networkRequest.post("".concat("/v2/drive/docsPreviewURL","?").concat(h),_)];case 1:return[2,i.sent()]}}))}))},e.prototype.fetchPreviewQuery=function(e){return Object(i.__awaiter)(this,void 0,void 0,(function(){var t,n,r,o,a;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:return t=e.fileId,n=e.shouldRetry,r={xsrf:Object(g.c)(g.a.xsrf)},o=v.a.stringify(r),a={file_id:t},n&&(a.should_retry=!0),[4,b.networkRequest.post("".concat("/v2/drive/preview/query","?").concat(o),a)];case 1:return[2,i.sent()]}}))}))},e.prototype.fetchDownloadInfo=function(e){return Object(i.__awaiter)(this,void 0,void 0,(function(){var t,n,r;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:return t={xsrf:Object(g.c)(g.a.xsrf)},n=v.a.stringify(t),r={file_id:e},[4,b.networkRequest.post("".concat("/v2/drive/downloadURL","?").concat(n),r)];case 1:return[2,i.sent()]}}))}))},e.prototype.fetchCopyInfo=function(e){return Object(i.__awaiter)(this,void 0,void 0,(function(){var t,n,r;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:return t={xsrf:Object(g.c)(g.a.xsrf)},n=v.a.stringify(t),r={file_id:e},[4,b.networkRequest.post("".concat("/v2/file/clone","?").concat(n),r)];case 1:return[2,i.sent()]}}))}))},Object(i.__decorate)([Object(o.c)(),Object(i.__metadata)("design:type",Function),Object(i.__metadata)("design:paramtypes",[Object]),Object(i.__metadata)("design:returntype",Promise)],e.prototype,"fetchPreviewInfo",null),Object(i.__decorate)([Object(o.c)(),Object(i.__metadata)("design:type",Function),Object(i.__metadata)("design:paramtypes",[String]),Object(i.__metadata)("design:returntype",Promise)],e.prototype,"fetchDownloadInfo",null),Object(i.__decorate)([Object(o.c)(),Object(i.__metadata)("design:type",Function),Object(i.__metadata)("design:paramtypes",[String]),Object(i.__metadata)("design:returntype",Promise)],e.prototype,"fetchCopyInfo",null),e}(),O=function(){function e(){}return e.prototype.postImportFile=function(t){return Object(i.__awaiter)(this,void 0,void 0,(function(){var n,r;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:return n=Object(h.e)({folder_id:t.folderId,operation_id:t.operationId,cos_file_key:t.cosFileKey,drive_file_id:t.driveFileId,password:t.password,appid:t.appid,filename:t.filename,verify_token:t.verifyToken,async:t.async,platform:t.platform,preview:t.preview,delete_drive_file:t.deleteDriveFile,bind_scene:t.bindScene,scene_type:t.sceneType,scene_id:t.sceneId,scene_file_id:t.sceneFileId,appSource:t.appSource,createSource:t.createSource}),r="".concat(e.cgiPaths.IMPORT_FILE,"?xsrf=").concat(Object(g.c)(g.a.xsrf)),[4,b.networkRequest.post(r,n)];case 1:return[2,i.sent()]}}))}))},e.prototype.queryImportProgress=function(t){return Object(i.__awaiter)(this,void 0,void 0,(function(){var n,r;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:return n=Object(h.m)(t),r="".concat(e.cgiPaths.QUERY_IMPORT_PROGRESS,"?xsrf=").concat(Object(g.c)(g.a.xsrf)),[4,b.networkRequest.post(r,n)];case 1:return[2,i.sent()]}}))}))},e.cgiPaths={IMPORT_FILE:"/v1/import/file",QUERY_IMPORT_PROGRESS:"/v1/import/queryImportProgress"},Object(i.__decorate)([Object(o.c)(),Object(i.__metadata)("design:type",Function),Object(i.__metadata)("design:paramtypes",[Object]),Object(i.__metadata)("design:returntype",Promise)],e.prototype,"postImportFile",null),e}(),j=function(){function e(e){this.docMetaDomain=e,this.fileDescRepo=new y,this.fileMetaRepo=new m,this.fileOperationRepo=new O,this.fileDescEntity=new u(this.fileDescRepo),this.fileMetaEntity=new f(this.fileMetaRepo),window.basicClientVars&&this.initWithBasicClientVars(window.basicClientVars)}return e.prototype.init=function(e){return Object(i.__awaiter)(this,void 0,void 0,(function(){var t,n,r,o,c;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:return t=e.docId,n=e.addRecent,Object(a.a)(t)?[4,this.docMetaDomain.init(e)]:[2];case 1:return i.sent(),[4,this.docMetaDomain.docMetaEntity.fetchFileInfo(t,n)];case 2:return 0===(null==(r=i.sent().resData)?void 0:r.retcode)&&(null===(o=null==r?void 0:r.data)||void 0===o?void 0:o.result)&&(this.fileMetaEntity.initWithFileInfoRsp(r.data.result),this.initFileDescEntity(null===(c=r.data.result.fileMeta)||void 0===c?void 0:c.fileId)),[2]}}))}))},e.prototype.initFileDescEntity=function(e){return Object(i.__awaiter)(this,void 0,void 0,(function(){var t,n,r;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:return e?[4,this.fileDescEntity.fetchFileDesc(e)]:[2];case 1:return t=i.sent().resData,(null===(r=null===(n=null==t?void 0:t.data)||void 0===n?void 0:n.result)||void 0===r?void 0:r.size)&&this.fileDescEntity.init({accurateSize:t.data.result.size}),[2]}}))}))},e.prototype.initWithBasicClientVars=function(e){var t,n,r,i;(null===(t=null==e?void 0:e.docInfo)||void 0===t?void 0:t.cosInfo)&&(this.fileMetaEntity.ext=null===(r=null===(n=null==e?void 0:e.docInfo)||void 0===n?void 0:n.cosInfo)||void 0===r?void 0:r.driveExt,this.fileMetaEntity.cosInfo=null===(i=null==e?void 0:e.docInfo)||void 0===i?void 0:i.cosInfo)},Object(i.__decorate)([Object(s.a)(),Object(i.__metadata)("design:type",Function),Object(i.__metadata)("design:paramtypes",[Object]),Object(i.__metadata)("design:returntype",Promise)],e.prototype,"init",null),Object(i.__decorate)([Object(o.m)(),Object(i.__metadata)("design:type",Function),Object(i.__metadata)("design:paramtypes",[Object]),Object(i.__metadata)("design:returntype",void 0)],e.prototype,"initWithBasicClientVars",null),e=Object(i.__decorate)([Object(i.__param)(0,c.a),Object(i.__metadata)("design:paramtypes",[Object])],e)}()},"430ba8ff3a":function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var r=n("d7c625d1f2"),i=n("1add19ffb1"),o=n("76702c352f"),a=n("5be39fbf8a"),c=n("fb1099018f"),s="".concat(c.h,"/wedoc/notifyscope"),u="".concat(c.h,"/wedoc/editnotify"),d=n("b512c0eccb"),l=function(){function e(){}return e.prototype.getNotifyType=function(e){var t=Object(a.d)(Object(r.__assign)({},e));return d.networkRequest.post(s,t)},e.prototype.setNotifyType=function(e){var t=Object(a.d)(Object(r.__assign)({},e));return d.networkRequest.post(s,t)},e.prototype.editnotify=function(e){var t=Object(a.d)(Object(r.__assign)({},e));return d.networkRequest.post(u,t)},e}(),p=function(e){function t(t){var n=e.call(this)||this;return n.notifyType=0,n.jsonObj2Class(t),n}return Object(r.__extends)(t,e),t}(n("61cea32eb2").a),f=n("9ab1857893"),h="mOnNotifyInfoDidUpdated",b="notifyInfo",_=function(e){function t(t){var n=e.call(this,t)||this;return n.mOnNotifyInfoDidUpdated=new f.Emitter,n.notifyScopeRepository=new l,n.onNotifyInfoDidUpdated=n.mOnNotifyInfoDidUpdated.event,n}return Object(r.__extends)(t,e),t.prototype.getNotifyType=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.notifyScopeRepository.getNotifyType(e)]}))}))},t.prototype.setNotifyType=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.notifyScopeRepository.setNotifyType(e)]}))}))},t.prototype.editnotify=function(e){return this.notifyScopeRepository.editnotify(e)},t.prototype.setNotifyTypeWithParams=function(e){!e||e.length<1||(this.notifyInfo=new p({notifyType:e[0].notifyType}))},Object(r.__decorate)([Object(o.d)(h,b),Object(o.i)(p.prototype.constructor,b),Object(o.b)(),Object(o.j)(),Object(o.c)(),Object(o.e)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],t.prototype,"getNotifyType",null),Object(r.__decorate)([Object(o.d)(h,b),Object(o.l)("setNotifyTypeWithParams"),Object(o.j)(),Object(o.c)(),Object(o.e)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],t.prototype,"setNotifyType",null),Object(r.__decorate)([Object(o.b)(),Object(o.j)(),Object(o.c)(),Object(o.e)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],t.prototype,"editnotify",null),t}(i.a),v=n("540dabb65d"),y=function(){function e(){this.notifyScopeAggregate=new _("mainINotifyScope")}return e.prototype.init=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){return[2]}))}))},Object(r.__decorate)([Object(v.a)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"init",null),e}()},"446c52c6f2":function(e,t,n){"use strict";var r=n("94b54f38ee");function i(){this.handlers=[]}i.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},i.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},i.prototype.forEach=function(e){r.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=i},"4498e7a6fb":function(e,t,n){"use strict";var r=n("94b54f38ee");e.exports=function(e,t){t=t||{};var n={};function i(e,t){return r.isPlainObject(e)&&r.isPlainObject(t)?r.merge(e,t):r.isPlainObject(t)?r.merge({},t):r.isArray(t)?t.slice():t}function o(n){return r.isUndefined(t[n])?r.isUndefined(e[n])?void 0:i(void 0,e[n]):i(e[n],t[n])}function a(e){if(!r.isUndefined(t[e]))return i(void 0,t[e])}function c(n){return r.isUndefined(t[n])?r.isUndefined(e[n])?void 0:i(void 0,e[n]):i(void 0,t[n])}function s(n){return n in t?i(e[n],t[n]):n in e?i(void 0,e[n]):void 0}var u={url:a,method:a,data:a,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:s};return r.forEach(Object.keys(e).concat(Object.keys(t)),(function(e){var t=u[e]||o,i=t(e);r.isUndefined(i)&&t!==s||(n[e]=i)})),n}},"45a0f5d2da":function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return y})),n.d(t,"c",(function(){return m})),n.d(t,"d",(function(){return v}));var r=n("60322051d8"),i=n("bf5972907e"),o=n("d04e49d648"),a=n("631a333237"),c=n("f28d742651"),s=n("cc55475c1f"),u=function(e,t){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},u(e,t)};function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}u(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var l=function(){return l=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},l.apply(this,arguments)};function p(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))}function f(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}}var h;var b;!function(e){e[e.indexDB=1]="indexDB",e[e.nativeDB=2]="nativeDB"}(b||(b={}));var _=((h={})[b.indexDB]=c.a,h[b.nativeDB]=s.a,h),v=function(){function e(e){var t;void 0===e&&(e={type:b.indexDB,disableAutoOpen:!0}),this.config=e;var n=_[e.type];this.storage=new o.c({name:null!==(t=e.databaseName)&&void 0!==t?t:r.a,version:4,engine:new n,databaseSchema:'{"name":"unknown","collections":[{"name":"DocumentData","key":{"path":"key"},"indices":[{"name":"secretId","path":"secretId","unique":false},{"name":"globalPadId","path":"globalPadId","unique":false},{"name":"version","path":"version","unique":false},{"name":"type","path":"type","unique":false},{"name":"uid","path":"uid","unique":false},{"name":"subId","path":"subSheetId","unique":false},{"name":"chunkId","path":"chunkId","unique":false}],"properties":["key","secretId","globalPadId","version","type","uid","subId","chunkId","taskId","data","docType","docStatus","createTimestamp","lastModifyTimestamp","dataVersion","isDefaultChunk","subGlobalPadId","subDocType"]},{"name":"DocumentEntities","key":{"path":"key"},"indices":[],"properties":["key","data"]},{"name":"NewDocumentIds","key":{"path":"globalPadId"},"indices":[],"properties":["globalPadId","secretId","documentType","localPadId","isCreated"]},{"name":"DocumentStatus","key":{"path":"globalPadId"},"indices":[{"name":"secretId","path":"secretId","unique":false},{"name":"uid","path":"uid","unique":false}],"properties":["globalPadId","secretId","uid","lastSyncTimestamp","lastErrorTimestamp"]},{"name":"OfflineData","key":{"path":"key"},"indices":[{"name":"secretId","path":"secretId","unique":false},{"name":"globalPadId","path":"globalPadId","unique":false},{"name":"version","path":"version","unique":false},{"name":"type","path":"type","unique":false},{"name":"uid","path":"uid","unique":false},{"name":"subId","path":"subSheetId","unique":false},{"name":"chunkId","path":"chunkId","unique":false}],"properties":["key","secretId","globalPadId","version","type","uid","subId","chunkId","taskId","data","docType","docStatus","createTimestamp","lastModifyTimestamp","dataVersion","isDefaultChunk","subGlobalPadId","subDocType"]},{"name":"PadInfo","key":{"path":"key"},"indices":[{"name":"secretId","path":"secretId","unique":false},{"name":"globalPadId","path":"globalPadId","unique":false},{"name":"uid","path":"uid","unique":false}],"properties":["key","secretId","globalPadId","uid","addListTimestamp","attribute","childrenLength","clientVersion","createTimestamp","creator","creatorDomain","icon","docPolicy","docPrivilege","thumbnail","docType","docTypeDesc","url","domainId","dver","folder","folderId","folderPolicy","folderPrivilege","isDeleted","isManualOffline","isMyCreated","isMydoc","isOfflineCache","isRencent","isShareToMe","hasSnapShot","isStar","isAddedToMy","isCollected","isOwner","isPinned","isShortcut","isUserChangeTitle","lastSyncTimestamp","lastBrowseTimestamp","lastCollectTimestamp","lastDeleteTimestamp","lastModifyTimestamp","lastModifyNick","lastModifyUid","lastPinnedTimestamp","listInfoType","listType","offlineCommiting","offlineCommitSuccessd","originFolderId","ownerNick","ownerUid","padId","parentFolderId","parents","privilege","status","title","type","hasLocalChanges","docSubType","officialAuthInfo","personalizeInfo","nativeEngineStatusRecord","nativeEngineDocPrivilege","data","ext","isOfflineCacheByNative","mimeType","ownerVipInfo"]},{"name":"Users","key":{"path":"key"},"indices":[{"name":"tinyId","path":"tinyId","unique":false},{"name":"nowUserIndex","path":"nowUserIndex","unique":false},{"name":"docId","path":"docId","unique":false},{"name":"pageType","path":"pageType","unique":false},{"name":"wedriveUin","path":"wedriveUin","unique":false},{"name":"wedocOpenId","path":"wedocOpenId","unique":false}],"properties":["key","tinyId","nowUserIndex","docId","pageType","wedriveUin","wedocOpenId","corpId","corpName","englishName","loginType","openId","uidSource","uin","userId","userName","userPic","updateTime","settings","bindUserInfo","vipUserInfo"]}]}',disableAutoOpen:e.disableAutoOpen,plugins:this.getPlugins(e),supportCompatibleOpen:!0})}return e.prototype.dispose=function(){this.storage.close()},e.prototype.init=function(){return p(this,void 0,void 0,(function(){var e=this;return f(this,(function(t){return[2,new Promise((function(t){var n,r=setTimeout((function(){var n,r;null===(r=null===(n=e.config.logger)||void 0===n?void 0:n.error)||void 0===r||r.call(n,"dababase init timeout."),t(!1)}),null!==(n=e.config.timeout)&&void 0!==n?n:15e3);e.storage.open().then((function(){t(!0),clearTimeout(r)})).catch((function(){t(!1),clearTimeout(r)}))}))]}))}))},e.prototype.getPlugins=function(e){var t,n=[];if(e.logger){var r=new i.a({logger:e.logger,disabled:!!e.disabled,verbose:!!e.verbose});n.push(r)}return e.monitorReporter&&n.push((t=e.monitorReporter,new a.a({onEvent:function(e){t.report("storageActionResultAndCost",{action:e.action,module:e.module,retCode:e.actionExecuteState,cost:e.cost,time:e.time.getTime(),errorMsg:e.errorMsg})}}))),n},e}(),y="TencentDocsBackup",g=(function(e){function t(t){void 0===t&&(t={type:b.indexDB,disableAutoOpen:!0});var n=e.call(this,t)||this;return n.config=t,n}d(t,e)}(v),function(){function e(e){this.collection=e}return e.prototype.getChanges=function(e,t){return p(this,void 0,void 0,(function(){var n;return f(this,(function(r){return n=this.collection.where({uid:e.uid,secretId:e.secretId,subGlobalPadId:e.subGlobalPadId,type:{in:e.types},docType:e.docType,dataVersion:e.dataVersion,subId:{in:e.subId?(new Array).concat(e.subId):void 0},chunkId:{in:e.chunkId?(new Array).concat(e.chunkId):void 0},version:{">=":null==t?void 0:t.startVersion,"<=":null==t?void 0:t.endVersion}}),(null==t?void 0:t.orderPath)&&n.orderBy(t.orderPath,t.sortOrder),(null==t?void 0:t.limit)&&n.take(t.limit),[2,n.values()]}))}))},e.prototype.upsertChanges=function(e){return p(this,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return[4,this.collection.bulkUpsert(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.deleteChanges=function(e){return p(this,void 0,void 0,(function(){var t,n,r,i,o,a;return f(this,(function(c){switch(c.label){case 0:return t=e.uid,n=e.secretId,r=e.globalPadId,i=e.types,o=e.taskIds,a=e.subGlobalPadId,[4,this.collection.where({uid:t,secretId:n,globalPadId:r,subGlobalPadId:a,type:{in:i},taskId:{in:o},version:{">":e.startVersion||Number.MIN_SAFE_INTEGER,"<":e.endVersion||Number.MAX_SAFE_INTEGER}}).clear()];case 1:return c.sent(),[2]}}))}))},e}()),m=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}d(t,e)}(g),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return d(t,e),t}(g));(function(){function e(e){this.collection=e}e.prototype.popDocumentId=function(e){return p(this,void 0,void 0,(function(){var t,n,r;return f(this,(function(i){switch(i.label){case 0:return[4,this.collection.where({documentType:e}).first()];case 1:return(t=i.sent())?(n=t.globalPadId,[4,this.collection.delete(n)]):[2,null];case 2:return r=i.sent(),n!==r?[2,null]:[2,t]}}))}))},e.prototype.upsertDocumentIds=function(e){return p(this,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return[4,this.collection.bulkUpsert(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.countDocumentIds=function(e){return p(this,void 0,void 0,(function(){return f(this,(function(t){return[2,this.collection.where({documentType:e}).count()]}))}))},e.prototype.deleteDocumentIds=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,this.collection.clear()];case 1:return e.sent(),[2]}}))}))}})(),function(){function e(e){this.collection=e}e.prototype.getStatus=function(e,t){return p(this,void 0,void 0,(function(){return f(this,(function(n){switch(n.label){case 0:return[4,this.collection.where({secretId:t,uid:e}).first()];case 1:return[2,n.sent()]}}))}))},e.prototype.upsertStatus=function(e){return p(this,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return[4,this.collection.upsert(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.deleteStatus=function(e,t){return p(this,void 0,void 0,(function(){return f(this,(function(n){switch(n.label){case 0:return[4,this.collection.where({secretId:t,uid:e}).clear()];case 1:return n.sent(),[2]}}))}))}}(),function(){function e(e){this.collection=e}e.prototype.getEntity=function(e){return p(this,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return[4,this.collection.get(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.upsertEntities=function(e){return p(this,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return[4,this.collection.bulkUpsert(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.deleteEntity=function(e){return p(this,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return[4,this.collection.delete(e)];case 1:return t.sent(),[2]}}))}))}}(),function(){function e(e){this.collection=e}e.prototype.getPadInfo=function(e,t){return p(this,void 0,void 0,(function(){var n;return f(this,(function(r){switch(r.label){case 0:return[4,this.getPadInfos({uid:e,secretId:t})];case 1:return 0===(n=r.sent()).length?[2,null]:[2,n.shift()]}}))}))},e.prototype.getPadInfos=function(e){return p(this,void 0,void 0,(function(){return f(this,(function(t){return[2,this.collection.where({uid:e.uid,secretId:{in:e.secretId?(new Array).concat(e.secretId):void 0}}).values()]}))}))},e.prototype.upsertPadInfo=function(e){return p(this,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return[4,this.collection.upsert(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.updateField=function(e,t,n){return p(this,void 0,void 0,(function(){var r;return f(this,(function(i){switch(i.label){case 0:return[4,this.collection.where({uid:e,secretId:t}).first()];case 1:return(r=i.sent())?(Object.assign(r,n),[4,this.collection.upsert(r)]):[2];case 2:return i.sent(),[2]}}))}))},e.prototype.deletePadInfo=function(e,t){return p(this,void 0,void 0,(function(){return f(this,(function(n){switch(n.label){case 0:return[4,this.collection.where({uid:e,secretId:t}).clear()];case 1:return n.sent(),[2]}}))}))}}(),function(){function e(e){this.collection=e}e.prototype.getUserInfoByNowUserIndex=function(e){return p(this,void 0,void 0,(function(){var t;return f(this,(function(n){switch(n.label){case 0:return[4,this.collection.where({nowUserIndex:e}).last()];case 1:return(t=n.sent())?[2,t]:[4,this.getUserInfoLastByAll()];case 2:return[2,n.sent()]}}))}))},e.prototype.getUserInfoByDocInfo=function(e,t){return p(this,void 0,void 0,(function(){var n;return f(this,(function(r){switch(r.label){case 0:return[4,this.collection.where({pageType:e,docId:t}).last()];case 1:return(n=r.sent())?[2,n]:[4,this.getUserInfoLastByAll()];case 2:return[2,r.sent()]}}))}))},e.prototype.addUserInfo=function(e){return p(this,void 0,void 0,(function(){var t;return f(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.collection.get(e.key)];case 1:return t=n.sent(),this.collection.upsert(l(l({},t),e)),[2,!0];case 2:return n.sent(),[2,!1];case 3:return[2]}}))}))},e.prototype.updateUserInfo=function(e,t){return p(this,void 0,void 0,(function(){var n,r;return f(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),[4,this.collection.where(e).values()];case 1:return(n=i.sent()).length?(r=n.map((function(e){return l(l({},e),t)})),[4,this.collection.bulkUpsert(r)]):[2,!1];case 2:return i.sent(),[2,!0];case 3:return i.sent(),[2,!1];case 4:return[2]}}))}))},e.prototype.getUserInfoLastByAll=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,this.collection.last()];case 1:return[2,e.sent()]}}))}))}}()},"47575f3348":function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n("d7c625d1f2"),i=n("61cea32eb2"),o=n("5be39fbf8a"),a=function(e){function t(t){var n=e.call(this)||this;return n.docStatus=0,n.domainId="",n.padId="",n.padType="",n.type=0,n.shareLink="",n.lastModifyTime=0,n.lastModifyUser="",n.relative=[],n.jsonObj2Class(t),n}return Object(r.__extends)(t,e),Object.defineProperty(t.prototype,"globalPadId",{get:function(){return Object(o.f)(this.domainId,this.padId)},enumerable:!1,configurable:!0}),t}(i.a)},"488b683127":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("cedf7830be"),i=Object(r.a)("ILoginDomainService")},"4a49840677":function(e,t,n){"use strict";var r=n("94b54f38ee");e.exports=r.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function i(e){var r=e;return t&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=i(window.location.href),function(t){var n=r.isString(t)?i(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0}},"4b146817ca":function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return a}));var r=n("624cdb524f");function i(e){return e.retcode||e.code||0}function o(e){return e.msg||e.message||e.retmsg||""}function a(e,t){var n;void 0===t&&(t=!0);var a=e.error,c=e.data;if(a)return{error:a,resData:null};var s={data:t&&c?Object(r.a)(c):c,retcode:i(c),msg:o(c),cgicode:null!==(n=c.cgicode)&&void 0!==n?n:0};return delete c.msg,delete c.message,delete c.retcode,delete c.code,delete c.cgicode,delete c.ret,{resData:s}}},"4bae7615ca":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isCancellationToken=t.CancellationTokenState=void 0;var r=function(){function e(){}return e.None=Object.freeze({isCancellationRequested:!1}),e.Cancelled=Object.freeze({isCancellationRequested:!0}),e}();t.CancellationTokenState=r,t.isCancellationToken=function(e){return e===r.None||e===r.Cancelled||!(!e||"object"!=typeof e)&&"boolean"==typeof e.isCancellationRequested}},"4c53fae0e6":function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var r=n("d7c625d1f2"),i=n("76702c352f"),o=n("5bfdce0c9d"),a=n("a3e804d4e7"),c=n("5bdead0cb8"),s=n("a4cdaf353f"),u=n("47575f3348"),d=n("b9d0dec2ff"),l=n("8a4c0c1d32"),p=n("bc0f24c59d"),f=n("540dabb65d"),h=function(){function e(){this.isInitedByBasicClientVars=!1,this.docMetaEntity=new a.a("MainDocMetaEntity"),(null===window||void 0===window?void 0:window.basicClientVars)&&this.initWithBasicClientVars(window.basicClientVars)}return e.prototype.updateWithClientVars=function(e){this.isInitedByBasicClientVars||(this.docMetaEntity.createInfo=new c.a(Object(r.__assign)(Object(r.__assign)({},e),{createTime:e.metaCreateTime})),this.docMetaEntity.ownerInfo=new s.a(e),this.docMetaEntity.padInfo=new u.a(e),this.docMetaEntity.titleInfo=new l.a(e),this.docMetaEntity.userAuthInfo=new p.a(e))},e.prototype.init=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,a,s,d,f,h,b,_;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return t=e.docId,n=e.addRecent,Object(o.a)(t)?[4,this.docMetaEntity.fetchFileInfo(t,n)]:[2];case 1:return i=r.sent(),a=null!==(_=null===(b=null===(h=i.resData)||void 0===h?void 0:h.data)||void 0===b?void 0:b.result)&&void 0!==_?_:{},s=a.docInfo,d=a.fileMeta,f=a.privilege,this.docMetaEntity.createInfo=new c.a({isCreator:null==s?void 0:s.isCreator,creatorDomain:null==s?void 0:s.domainId,creatorId:null==d?void 0:d.creator,creatorCorpId:"",creatorCorpName:""}),this.docMetaEntity.padInfo=new u.a({domainId:null==s?void 0:s.domainId,padId:null==d?void 0:d.fileId,padType:null==s?void 0:s.padType,relative:[],docStatus:null==s?void 0:s.docStatus}),this.docMetaEntity.titleInfo=new l.a({title:null==d?void 0:d.name,isUserChangeTitle:null==d?void 0:d.userChangeFilename}),this.docMetaEntity.userAuthInfo=new p.a({isCreator:null==s?void 0:s.isCreator,isOwner:null==s?void 0:s.isOwner,isAdmin:null==f?void 0:f.attribute.isAdmin}),[2]}}))}))},e.prototype.initWithBasicClientVars=function(e){this.updateCreateInfoByBasicClientVars(e),this.updateOwnerAndAuthInfoByBasicClientVars(e),this.updatePadInfoByBasicClientVars(e),this.updateTitleInfoByBasicClientVars(e),this.updateCollaborationInfoByBasicClientVars(e),this.updatePersonalizeInfoByBasicClientVars(e),this.isInitedByBasicClientVars=!0},e.prototype.updatePersonalizeInfoByBasicClientVars=function(e){var t;this.docMetaEntity.personalizeInfo=new d.a(null===(t=e.docInfo)||void 0===t?void 0:t.personalizeInfo)},e.prototype.updateCollaborationInfoByBasicClientVars=function(e){var t;this.docMetaEntity.collaborationFlag=null===(t=e.docInfo)||void 0===t?void 0:t.collaborationFlag},e.prototype.updateCreateInfoByBasicClientVars=function(e){var t,n,r,i,o,a,s,u,d,l,p,f,h;this.docMetaEntity.createInfo=new c.a({isCreator:null===(t=e.docInfo)||void 0===t?void 0:t.isOwner,creatorDomain:null===(r=null===(n=e.docInfo)||void 0===n?void 0:n.padInfo)||void 0===r?void 0:r.domainId,creatorNick:null===(o=null===(i=e.docInfo)||void 0===i?void 0:i.createInfo)||void 0===o?void 0:o.creatorNick,createTime:null===(s=null===(a=e.docInfo)||void 0===a?void 0:a.createInfo)||void 0===s?void 0:s.createTime,creatorId:null===(d=null===(u=e.docInfo)||void 0===u?void 0:u.createInfo)||void 0===d?void 0:d.creatorId,creatorCorpId:null===(p=null===(l=e.docInfo)||void 0===l?void 0:l.createInfo)||void 0===p?void 0:p.creatorCorpId,creatorCorpName:null===(h=null===(f=e.docInfo)||void 0===f?void 0:f.createInfo)||void 0===h?void 0:h.creatorCorpName})},e.prototype.updateOwnerAndAuthInfoByBasicClientVars=function(e){var t,n,r,i,o;this.docMetaEntity.ownerInfo=new s.a(null===(t=e.docInfo)||void 0===t?void 0:t.ownerInfo),this.docMetaEntity.userAuthInfo=new p.a({isCreator:null===(n=e.docInfo)||void 0===n?void 0:n.isOwner,isOwner:null===(r=e.docInfo)||void 0===r?void 0:r.isOwner,isAdmin:null===(i=e.docInfo)||void 0===i?void 0:i.isAdmin,isViewer:1===(null===(o=e.authInfo)||void 0===o?void 0:o.privilegeFlag)})},e.prototype.updatePadInfoByBasicClientVars=function(e){var t,n,r,i,o,a,c,s,d,l,p,f;this.docMetaEntity.padInfo=new u.a({domainId:null===(n=null===(t=e.docInfo)||void 0===t?void 0:t.padInfo)||void 0===n?void 0:n.domainId,padId:null===(i=null===(r=e.docInfo)||void 0===r?void 0:r.padInfo)||void 0===i?void 0:i.padId,padType:null===(a=null===(o=e.docInfo)||void 0===o?void 0:o.padInfo)||void 0===a?void 0:a.padType,relative:null===(s=null===(c=e.docInfo)||void 0===c?void 0:c.padInfo)||void 0===s?void 0:s.relative,docStatus:null===(d=e.docInfo)||void 0===d?void 0:d.docStatus,shareLink:null===(l=e.docInfo)||void 0===l?void 0:l.shareLink,lastModifyTime:null===(p=e.docInfo)||void 0===p?void 0:p.lastModifyTime,lastModifyUser:null===(f=e.docInfo)||void 0===f?void 0:f.lastModifyUser})},e.prototype.updateTitleInfoByBasicClientVars=function(e){var t,n,r;this.docMetaEntity.titleInfo=new l.a({title:null===(n=null===(t=e.docInfo)||void 0===t?void 0:t.padInfo)||void 0===n?void 0:n.padTitle,isUserChangeTitle:null===(r=e.docInfo)||void 0===r?void 0:r.isUserChangeTitle})},Object(r.__decorate)([Object(f.a)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"init",null),Object(r.__decorate)([Object(i.m)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",void 0)],e.prototype,"initWithBasicClientVars",null),e}()},"523f223693":function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var r=n("d7c625d1f2"),i=n("76702c352f"),o=n("b40f27bf29"),a=n("03808c4177"),c=n("5be39fbf8a"),s=n("fb1099018f"),u="".concat(s.c,"folder_list"),d="".concat(s.c,"folder_new"),l="".concat(s.c,"doc_addmy"),p=n("6423ed0b81"),f=function(){function e(e){this.networkRequestService=e}return e.prototype.folderList=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){return t=Object(c.d)(Object(r.__assign)(Object(r.__assign)({},e),{xsrf:Object(p.c)(p.a.xsrf)})),[2,this.networkRequestService.instance.post(u,t)]}))}))},e.prototype.newFolder=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){return t=Object(c.d)(Object(r.__assign)(Object(r.__assign)({},e),{xsrf:Object(p.c)(p.a.xsrf)})),[2,this.networkRequestService.instance.post(d,t)]}))}))},e.prototype.addToMyFolder=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){return t=Object(c.d)(Object(r.__assign)(Object(r.__assign)({},e),{xsrf:Object(p.c)(p.a.xsrf)})),[2,this.networkRequestService.instance.post(l,t)]}))}))},e=Object(r.__decorate)([Object(r.__param)(0,a.a),Object(r.__metadata)("design:paramtypes",[Object])],e)}(),h=n("540dabb65d"),b=function(){function e(){this.folderRepository=new f(new o.a)}return e.prototype.init=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){return[2]}))}))},e.prototype.folderList=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.folderRepository.folderList(e)]}))}))},e.prototype.newFolder=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.folderRepository.newFolder(e)]}))}))},e.prototype.addToMyFolder=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.folderRepository.addToMyFolder(e)]}))}))},Object(r.__decorate)([Object(h.a)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"init",null),Object(r.__decorate)([Object(i.b)(),Object(i.c)(),Object(i.e)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"folderList",null),Object(r.__decorate)([Object(i.b)(),Object(i.c)(),Object(i.e)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"newFolder",null),Object(r.__decorate)([Object(i.b)(),Object(i.c)(),Object(i.e)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"addToMyFolder",null),e}()},"52878e0097":function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e[e.UNAUTHED=0]="UNAUTHED",e[e.ENTERPRISE=1]="ENTERPRISE",e[e.ENTERPRISE_MEDIA=2]="ENTERPRISE_MEDIA",e[e.GOVERNMENT=3]="GOVERNMENT",e[e.NON_PROFIT_ORGANIZATION=4]="NON_PROFIT_ORGANIZATION",e[e.PRIVATE_NON_ENTERPRISE=5]="PRIVATE_NON_ENTERPRISE",e[e.FOR_PROFIT_ORGANIZATION=6]="FOR_PROFIT_ORGANIZATION",e[e.SOCIAL_GROUPS=8]="SOCIAL_GROUPS",e[e.BUSINESS_MEDIA=9]="BUSINESS_MEDIA",e[e.BUSINESS_UNIT=11]="BUSINESS_UNIT",e[e.INDIVIDUAL_INDUSTRIAL_AND_COMMERCIAL_HOUSEHOLDS=12]="INDIVIDUAL_INDUSTRIAL_AND_COMMERCIAL_HOUSEHOLDS",e[e.OVERSEAS_COMPANIES=13]="OVERSEAS_COMPANIES"}(r||(r={}))},"52bbb6cc53":function(e,t,n){"use strict";var r,i;n.d(t,"f",(function(){return r})),n.d(t,"a",(function(){return i})),n.d(t,"c",(function(){return a})),n.d(t,"k",(function(){return o})),n.d(t,"j",(function(){return p})),n.d(t,"e",(function(){return c})),n.d(t,"d",(function(){return s})),n.d(t,"h",(function(){return u})),n.d(t,"b",(function(){return d})),n.d(t,"n",(function(){return f})),n.d(t,"m",(function(){return h})),n.d(t,"l",(function(){return b})),n.d(t,"g",(function(){return y})),n.d(t,"i",(function(){return _})),function(e){e.CreateCollection="create-collection",e.DropCollection="drop-collection",e.CreateIndex="create-index",e.DropIndex="drop-index"}(r||(r={})),function(e){e.MoveProperty="move-property",e.DropProperty="drop-property",e.ReplaceProperty="replace-property",e.ClearData="clear-data",e.ReplaceData="replace-data"}(i||(i={}));var o,a={name:"alloy_db_schema_table",indices:[],key:{path:"name"},properties:[]};!function(e){e.Equals="=",e.NotEquals="!=",e.GreaterThan=">",e.GreaterOrEqualThan=">=",e.LessThan="<",e.LessOrEqualThan="<=",e.In="in",e.NotIn="nin"}(o||(o={}));var c,s,u,d,l,p=void 0;function f(e){return"number"==typeof e&&!Number.isNaN(e)||"string"==typeof e||e instanceof Date&&!Number.isNaN(e.getTime())||e instanceof ArrayBuffer||ArrayBuffer.isView(e)||Array.isArray(e)&&e.every(f)}function h(e,t){var n=e;return Array.isArray(t)?t.map((function(e){return n[e]})):n[t]}function b(e,t){return Array.isArray(e)?Array.isArray(t)&&e.length===t.length&&e.every((function(e,n){return b(e,t[n])})):e===t}!function(e){e.OR="or",e.AND="and",e.FILTER="filter",e.NONE="none",e.ALL="all"}(c||(c={})),function(e){e.ENTRIES="entries",e.VALUES="values",e.KEYS="keys",e.COUNT="count"}(s||(s={})),function(e){e.DESCENDING="desc",e.ASCENDING="asc"}(u||(u={})),function(e){e.AutoIncrement="auto-increment"}(d||(d={})),function(e){e.Equals="=",e.GreaterThan=">",e.GreaterOrEqualThan=">=",e.LessThan="<",e.LessOrEqualThan="<="}(l||(l={}));var _,v=n("d7c625d1f2"),y=function(){function e(){}return e.collectionDiff=function(e,t){if(e.name!==t.name)throw new Error("can not compare collection schema with different name");var n={collection:e.name},r=t.indices.filter((function(t){return!e.indices.some((function(e){return e.name===t.name}))})),i=e.indices.filter((function(e){return!t.indices.some((function(t){return t.name===e.name}))}));return(r.length||i.length)&&(n.index={added:Object(v.__spreadArray)([],Object(v.__read)(r)),deleted:Object(v.__spreadArray)([],Object(v.__read)(i))}),n},e.databaseDiff=function(e,t){var n,r,i=this.getCompareMap(e,t),o={added:[],deleted:[],different:[]};try{for(var a=Object(v.__values)(i.values()),c=a.next();!c.done;c=a.next()){var s=c.value;if(!s.oldValue||s.newValue)if(s.oldValue||!s.newValue){if(s.oldValue&&s.newValue){var u=this.collectionDiff(s.oldValue,s.newValue);if(!u.index)continue;o.different.push(u)}}else o.added.push(s.newValue);else o.deleted.push(s.oldValue)}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},e.getCompareMap=function(e,t){var n,r,i,o,a=new Map;try{for(var c=Object(v.__values)(t.collections),s=c.next();!s.done;s=c.next()){var u=s.value;(p=a.get(u.name)||{}).newValue=u,a.set(u.name,p)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}try{for(var d=Object(v.__values)(e.collections),l=d.next();!l.done;l=d.next()){var p;u=l.value;(p=a.get(u.name)||{}).oldValue=u,a.set(u.name,p)}}catch(e){i={error:e}}finally{try{l&&!l.done&&(o=d.return)&&o.call(d)}finally{if(i)throw i.error}}return a},e}();!function(e){e.READ_ONLY="readonly",e.READ_WRITE="readwrite",e.VERSION_CHANGE="versionchange"}(_||(_={}))},"533c8fd00a":function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},r(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},a=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0}),t.mixinRootDisposable=t.mixinDisposable=t.Disposable=t.RootDisposable=void 0;var c=n("697ecdc674"),s=n("0d99992889"),u=n("ff6b6fad8b"),d=function(){function e(){this.disposedStore=new u.DisposableStore}return e.prototype.dispose=function(e){this.disposedStore.dispose(e)},e.prototype._register=function(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this.disposedStore.add(e)},e}(),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.dispose=function(t){var n=t,r=!1;if(!n){var i=this.constructor.name;n=c.DisposeTrace.traceRoot(i),r=!0}e.prototype.dispose.call(this,n),r&&n.stop()},t.prototype._register=function(t){return e.prototype._register.call(this,t)},t}(d);t.RootDisposable=l;var p=function(e){function t(){var t=e.call(this)||this;return s.trackDisposable(t),t}return i(t,e),t.prototype.dispose=function(t){s.markTracked(this),e.prototype.dispose.call(this,t)},t}(d);t.Disposable=p,t.mixinDisposable=function(e){return function(e){function t(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=e.apply(this,a(t))||this;return r.disposedStore=new u.DisposableStore,s.trackDisposable(r),r}return i(t,e),t.prototype.dispose=function(e){s.markTracked(this),this.disposedStore.dispose(e)},t.prototype._register=function(e){return this.disposedStore.add(e)},t}(e)},t.mixinRootDisposable=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.disposedStore=new u.DisposableStore,t}return i(t,e),t.prototype.dispose=function(e){s.markTracked(this);var t=e,n=!1;if(!t){var r=this.constructor.name;t=c.DisposeTrace.traceRoot(r),n=!0}this.disposedStore.dispose(t),n&&t.stop()},t.prototype._register=function(e){return this.disposedStore.add(e)},t}(e)}},"536530eec5":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("cedf7830be"),i=Object(r.a)("IDocMetaDomainService")},"540dabb65d":function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n("d7c625d1f2"),i=function(e){return"".concat(String(e),"__locked")},o=function(e){return"".concat(String(e),"__result")};function a(){return function(e,t,n){var a=n.value,c=i(t),s=o(t);n.value=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this[c]||(this[s]=a.call.apply(a,Object(r.__spreadArray)([this],Object(r.__read)(e),!1)),this[c]=!0),this[s]}}}},"58bffcf462":function(e,t,n){"use strict";(function(t){var r=n("94b54f38ee"),i=n("22b96304bb"),o=n("fa25e7cd6c"),a=n("744ee0b6cd"),c={"Content-Type":"application/x-www-form-urlencoded"};function s(e,t){!r.isUndefined(e)&&r.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var u,d={transitional:a,adapter:(("undefined"!=typeof XMLHttpRequest||void 0!==t&&"[object process]"===Object.prototype.toString.call(t))&&(u=n("6dc82740da")),u),transformRequest:[function(e,t){return i(t,"Accept"),i(t,"Content-Type"),r.isFormData(e)||r.isArrayBuffer(e)||r.isBuffer(e)||r.isStream(e)||r.isFile(e)||r.isBlob(e)?e:r.isArrayBufferView(e)?e.buffer:r.isURLSearchParams(e)?(s(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):r.isObject(e)||t&&"application/json"===t["Content-Type"]?(s(t,"application/json"),function(e,t,n){if(r.isString(e))try{return(t||JSON.parse)(e),r.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional||d.transitional,n=t&&t.silentJSONParsing,i=t&&t.forcedJSONParsing,a=!n&&"json"===this.responseType;if(a||i&&r.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(a){if("SyntaxError"===e.name)throw o(e,this,"E_JSON_PARSE");throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};r.forEach(["delete","get","head"],(function(e){d.headers[e]={}})),r.forEach(["post","put","patch"],(function(e){d.headers[e]=r.merge(c)})),e.exports=d}).call(this,n("6c0cbd9268"))},"5ac65fff24":function(e,t,n){"use strict";n.d(t,"e",(function(){return o})),n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return c})),n.d(t,"d",(function(){return s})),n.d(t,"a",(function(){return u}));var r=n("00c2fdc893"),i=n("fb1099018f"),o=("".concat(i.a,"account-list"),"/session/api/multiacc/account_list"),a="".concat(i.h,"/session/logout"),c="".concat(i.h,"/disklogin/session_list"),s="".concat(i.h,"/sdc/getusermarkname"),u="".concat(Object(r.a)(i.h),"/session/api/multiacc/change-sig")},"5bdead0cb8":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("d7c625d1f2"),i=function(e){function t(t){var n=e.call(this)||this;return n.creatorId="",n.createTime=0,n.creatorNick="",n.creatorDomain="",n.isCreator=!1,n.creatorCorpId="",n.creatorCorpName="",n.jsonObj2Class(t),n}return Object(r.__extends)(t,e),t}(n("61cea32eb2").a)},"5be39fbf8a":function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"n",(function(){return s})),n.d(t,"k",(function(){return u})),n.d(t,"b",(function(){return d})),n.d(t,"c",(function(){return l})),n.d(t,"g",(function(){return p})),n.d(t,"h",(function(){return f})),n.d(t,"i",(function(){return h})),n.d(t,"d",(function(){return b})),n.d(t,"e",(function(){return _})),n.d(t,"m",(function(){return v})),n.d(t,"f",(function(){return y})),n.d(t,"j",(function(){return g})),n.d(t,"l",(function(){return m}));var r=n("6423ed0b81"),i="p_lskey",o="p_skey",a="vfwebqq";function c(e){return 0===e.length?e:(e[0].toLowerCase()+e.substr(1)).replace(/([A-Z])/g,(function(e){return"_".concat(e.toLowerCase())}))}function s(e){for(var t=e.split("_"),n="",r=0;r<t.length;r++){var i=t[r];i.length>0&&(n+=0===r?i:i="".concat(i[0].toUpperCase()).concat(i.substring(1)))}return n}function u(e){return!!e&&(0===e.retcode&&0===e.cgicode)}function d(e){return e||""}function l(e){return e||0}function p(){return Object(r.b)(i)}function f(){return Object(r.b)(o)}function h(){return Object(r.b)(a)||""}function b(e){var t=new FormData;return Object.keys(e).forEach((function(n){t.append(n,e[n])})),t}function _(e){var t=new FormData;return Object.keys(e).forEach((function(n){void 0!==e[n]&&t.append(n,e[n])})),t}function v(e){var t=new URLSearchParams;return Object.keys(e).forEach((function(n){void 0!==e[n]&&t.append(n,e[n])})),t}function y(e,t){return["0",""].includes(e)?t:"".concat(e,"$").concat(t)}var g=function(){return Object(r.b)("TOK")};function m(e,t){void 0===t&&(t=void 0);try{return JSON.parse(e)}catch(e){return t}}},"5bfdce0c9d":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(e){return function(e){return/^[ABCD][a-zA-Z0-9]+$/.test(e)}(e)||function(e){return/^((w2|w3|e2|e3|s3|p3|c2|c3|m3|f3)_)[-\w]+$/.test(e)}(e)}},"5cc83026a5":function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e.DOC="drive-doc",e.SHEET="drive-sheet",e.TEXT="drive-text",e.SLIDE="drive-slide",e.PDF="drive-pdf",e.UNKNOWN="drive-unknown"}(r||(r={}))},"60322051d8":function(e,t,n){"use strict";n.d(t,"a",(function(){return y})),n.d(t,"b",(function(){return S}));var r,i,o,a,c=n("d04e49d648");!function(e){e[e.unknown=-1]="unknown",e[e.doc=0]="doc",e[e.sheet=1]="sheet",e[e.slide=4]="slide",e[e.smartSheet=5]="smartSheet",e[e.smartCanvas=6]="smartCanvas",e[e.flowchart=7]="flowchart",e[e.mind=8]="mind",e[e.pdf=9]="pdf"}(o||(o={})),function(e){e.doc="doc",e.sheet="sheet",e.form="form",e.slide="slide",e.smartSheet="smartSheet",e.smartCanvas="smartCanvas",e.flowchart="flowchart",e.mind="mind",e.pdf="pdf"}(a||(a={}));var s,u,d,l,p;(r={})[a.doc]=o.doc,r[a.sheet]=o.sheet,r[a.slide]=o.slide,r[a.smartSheet]=o.smartSheet,r[a.smartCanvas]=o.smartCanvas,r[a.flowchart]=o.flowchart,r[a.mind]=o.mind,r[a.pdf]=o.pdf,(i={})[o.doc]=a.doc,i[o.sheet]=a.sheet,i[o.slide]=a.slide,i[o.smartSheet]=a.smartSheet,i[o.smartCanvas]=a.smartCanvas,i[o.flowchart]=a.flowchart,i[o.mind]=a.mind,i[o.pdf]=a.pdf;!function(e){e[e.private=0]="private",e[e.partialShare=1]="partialShare",e[e.canRead=2]="canRead",e[e.canEdit=3]="canEdit"}(s||(s={})),function(e){e.new="new",e.local="local",e.deleted="deleted",e.normal="normal"}(u||(u={})),function(e){e[e.file=1]="file",e[e.folder=2]="folder"}(d||(d={})),function(e){e[e.trash=3]="trash",e[e.share=4]="share",e[e.myDoc=5]="myDoc",e[e.recent=6]="recent",e[e.start=7]="start"}(l||(l={})),function(e){e.init="init",e.document="document",e.workbook="workbook",e.chunk="chunk",e.accepted="accepted",e.missChange="misschange",e.newChange="newchange",e.committing="commiting",e.waiting="watting",e.queue="queue"}(p||(p={}));var f,h,b,_,v,y="TencentDocs";function g(e){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g(e)}!function(e){e.documentStatus="DocumentStatus",e.documentEntities="DocumentEntities",e.newDocumentIds="NewDocumentIds",e.padinfo="PadInfo",e.offlineData="OfflineData",e.documentData="DocumentData",e.Users="Users"}(f||(f={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.QQ=1]="QQ",e[e.WX=2]="WX",e[e.WORK=3]="WORK",e[e.EMAIL=4]="EMAIL",e[e.PHONE=8]="PHONE",e[e.WORK_COMBINATION=9]="WORK_COMBINATION",e[e.TOWER=10]="TOWER",e[e.ROBOT=11]="ROBOT",e[e.QFYF=12]="QFYF",e[e.OPEN=13]="OPEN",e[e.MEETING=14]="MEETING"}(h||(h={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.WECHAT=4]="WECHAT",e[e.WEWORK=3]="WEWORK"}(b||(b={})),function(e){e.BINDING="BINDING",e.UNBIND="UNBIND"}(_||(_={})),function(e){e.NORMAL="NORMAL",e.SUPER="SUPER",e.NONE="NONE",e.EXPIRED="EXPIRED"}(v||(v={}));var m=function(e,t){return m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},m(e,t)};function O(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}m(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function j(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":g(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}function w(e,t){if("object"===("undefined"==typeof Reflect?"undefined":g(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}var I=function(e){function t(t){var n,r,i,o,a,c,s=this;return(s=e.call(this)||this).isDefaultChunk=!1,s.uid=t.uid,s.type=t.type,s.data=t.data,s.dataVersion=t.dataVersion,s.docType=t.docType,s.subId=t.subId,s.secretId=t.secretId,s.version=t.version,s.globalPadId=t.globalPadId,s.taskId=null!==(n=t.taskId)&&void 0!==n?n:s.getTaskId(),s.isDefaultChunk=null!==(r=t.isDefaultChunk)&&void 0!==r&&r,s.chunkId=null!==(i=t.chunkId)&&void 0!==i?i:0,s.docStatus=null!==(o=t.docStatus)&&void 0!==o?o:u.normal,s.createTimestamp=null!==(a=t.createTimestamp)&&void 0!==a?a:Date.now(),s.lastModifyTimestamp=null!==(c=t.lastModifyTimestamp)&&void 0!==c?c:Date.now(),s.key=s.getKey(),s.subGlobalPadId=t.subGlobalPadId,s.subDocType=t.subDocType,s}return O(t,e),t.prototype.getTaskId=function(){return Math.ceil(2147483648*Math.random())},t.prototype.getKey=function(){return this.type===p.init?"".concat(this.globalPadId,"_").concat(this.subId,"_").concat(this.uid):this.type===p.document?"".concat(this.globalPadId,"_").concat(this.uid,"_version_").concat(this.version):this.type===p.workbook?"".concat(this.globalPadId,"_").concat(this.subId,"_").concat(this.uid,"_version_").concat(this.version):this.type===p.chunk?"".concat(this.globalPadId,"_").concat(this.subId,"_").concat(this.chunkId,"_").concat(this.uid,"_version_").concat(this.version):"".concat(this.globalPadId,"_").concat(this.subId,"_").concat(this.uid,"_taskId_").concat(this.taskId)},j([Object(c.f)(),w("design:type",String)],t.prototype,"key",void 0),j([Object(c.e)(),w("design:type",String)],t.prototype,"secretId",void 0),j([Object(c.e)(),w("design:type",String)],t.prototype,"globalPadId",void 0),j([Object(c.e)(),w("design:type",Number)],t.prototype,"version",void 0),j([Object(c.e)(),w("design:type",String)],t.prototype,"type",void 0),j([Object(c.e)(),w("design:type",String)],t.prototype,"uid",void 0),j([Object(c.e)(),Object(c.d)("subSheetId"),w("design:type",String)],t.prototype,"subId",void 0),j([Object(c.e)(),w("design:type",Number)],t.prototype,"chunkId",void 0),j([Object(c.d)(),w("design:type",Number)],t.prototype,"taskId",void 0),j([Object(c.d)("_data"),w("design:type",String)],t.prototype,"data",void 0),j([Object(c.d)(),w("design:type",Number)],t.prototype,"docType",void 0),j([Object(c.d)("padStatus"),w("design:type",String)],t.prototype,"docStatus",void 0),j([Object(c.d)("createTime"),w("design:type",Number)],t.prototype,"createTimestamp",void 0),j([Object(c.d)(),w("design:type",Number)],t.prototype,"lastModifyTimestamp",void 0),j([Object(c.d)("dver"),w("design:type",String)],t.prototype,"dataVersion",void 0),j([Object(c.d)("default"),w("design:type",Object)],t.prototype,"isDefaultChunk",void 0),j([Object(c.d)(),w("design:type",String)],t.prototype,"subGlobalPadId",void 0),j([Object(c.d)(),w("design:type",Number)],t.prototype,"subDocType",void 0),t}(c.a),S=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.addListTimestamp=0,t.attribute=null,t.docPolicy=s.private,t.docPrivilege=null,t.folderPolicy=0,t.folderPrivilege=null,t.isManualOffline=!1,t.isOfflineCache=!1,t.hasSnapShot=!1,t.isAddedToMy=0,t.isCollected=0,t.isOwner=1,t.isPinned=0,t.isShortcut=0,t.isUserChangeTitle=!1,t.lastCollectTimestamp=0,t.lastDeleteTimestamp=0,t.parents=[],t}O(t,e),j([Object(c.f)(),w("design:type",String)],t.prototype,"key",void 0),j([Object(c.e)(),w("design:type",String)],t.prototype,"secretId",void 0),j([Object(c.e)(),w("design:type",String)],t.prototype,"globalPadId",void 0),j([Object(c.e)(),w("design:type",String)],t.prototype,"uid",void 0),j([Object(c.d)("add_list_ts"),w("design:type",Object)],t.prototype,"addListTimestamp",void 0),j([Object(c.d)(),w("design:type",Object)],t.prototype,"attribute",void 0),j([Object(c.d)(),w("design:type",Number)],t.prototype,"childrenLength",void 0),j([Object(c.d)("client_version"),w("design:type",String)],t.prototype,"clientVersion",void 0),j([Object(c.d)("create_ts"),w("design:type",Number)],t.prototype,"createTimestamp",void 0),j([Object(c.d)(),w("design:type",String)],t.prototype,"creator",void 0),j([Object(c.d)("creator_domain"),w("design:type",String)],t.prototype,"creatorDomain",void 0),j([Object(c.d)("doc_icon"),w("design:type",String)],t.prototype,"icon",void 0),j([Object(c.d)("doc_policy"),w("design:type",Number)],t.prototype,"docPolicy",void 0),j([Object(c.d)("doc_privilege"),w("design:type",Object)],t.prototype,"docPrivilege",void 0),j([Object(c.d)("doc_thumbnail"),w("design:type",String)],t.prototype,"thumbnail",void 0),j([Object(c.d)("doc_type"),w("design:type",Number)],t.prototype,"docType",void 0),j([Object(c.d)("doc_type_desc"),w("design:type",String)],t.prototype,"docTypeDesc",void 0),j([Object(c.d)("doc_url"),w("design:type",String)],t.prototype,"url",void 0),j([Object(c.d)("domain_id"),w("design:type",String)],t.prototype,"domainId",void 0),j([Object(c.d)(),w("design:type",String)],t.prototype,"dver",void 0),j([Object(c.d)(),w("design:type",String)],t.prototype,"folder",void 0),j([Object(c.d)("folder_id"),w("design:type",String)],t.prototype,"folderId",void 0),j([Object(c.d)("folder_policy"),w("design:type",Object)],t.prototype,"folderPolicy",void 0),j([Object(c.d)("folder_privilege"),w("design:type",Object)],t.prototype,"folderPrivilege",void 0),j([Object(c.d)("isDelete"),w("design:type",Boolean)],t.prototype,"isDeleted",void 0),j([Object(c.d)(),w("design:type",Object)],t.prototype,"isManualOffline",void 0),j([Object(c.d)(),w("design:type",Boolean)],t.prototype,"isMyCreated",void 0),j([Object(c.d)(),w("design:type",Boolean)],t.prototype,"isMydoc",void 0),j([Object(c.d)(),w("design:type",Object)],t.prototype,"isOfflineCache",void 0),j([Object(c.d)(),w("design:type",Boolean)],t.prototype,"isRencent",void 0),j([Object(c.d)("isShareme"),w("design:type",Boolean)],t.prototype,"isShareToMe",void 0),j([Object(c.d)("isSnapShot"),w("design:type",Object)],t.prototype,"hasSnapShot",void 0),j([Object(c.d)(),w("design:type",Boolean)],t.prototype,"isStar",void 0),j([Object(c.d)("is_added_my"),w("design:type",Object)],t.prototype,"isAddedToMy",void 0),j([Object(c.d)("is_collected"),w("design:type",Object)],t.prototype,"isCollected",void 0),j([Object(c.d)("is_owner"),w("design:type",Object)],t.prototype,"isOwner",void 0),j([Object(c.d)("is_pinned"),w("design:type",Object)],t.prototype,"isPinned",void 0),j([Object(c.d)("is_shortcut"),w("design:type",Object)],t.prototype,"isShortcut",void 0),j([Object(c.d)(),w("design:type",Object)],t.prototype,"isUserChangeTitle",void 0),j([Object(c.d)("lastSyncTime"),w("design:type",Number)],t.prototype,"lastSyncTimestamp",void 0),j([Object(c.d)("last_browse_ts"),w("design:type",Number)],t.prototype,"lastBrowseTimestamp",void 0),j([Object(c.d)("last_collect_ts"),w("design:type",Object)],t.prototype,"lastCollectTimestamp",void 0),j([Object(c.d)("last_delete_ts"),w("design:type",Object)],t.prototype,"lastDeleteTimestamp",void 0),j([Object(c.d)("last_modify_ts"),w("design:type",Number)],t.prototype,"lastModifyTimestamp",void 0),j([Object(c.d)("last_modify_nick"),w("design:type",String)],t.prototype,"lastModifyNick",void 0),j([Object(c.d)("last_modify_uid"),w("design:type",String)],t.prototype,"lastModifyUid",void 0),j([Object(c.d)("last_pinned_ts"),w("design:type",Number)],t.prototype,"lastPinnedTimestamp",void 0),j([Object(c.d)("list_info_type"),w("design:type",Number)],t.prototype,"listInfoType",void 0),j([Object(c.d)("list_type"),w("design:type",Number)],t.prototype,"listType",void 0),j([Object(c.d)(),w("design:type",Boolean)],t.prototype,"offlineCommiting",void 0),j([Object(c.d)(),w("design:type",Boolean)],t.prototype,"offlineCommitSuccessd",void 0),j([Object(c.d)("origin_folder_id"),w("design:type",String)],t.prototype,"originFolderId",void 0),j([Object(c.d)("owner_nick"),w("design:type",String)],t.prototype,"ownerNick",void 0),j([Object(c.d)("owner_uid"),w("design:type",String)],t.prototype,"ownerUid",void 0),j([Object(c.d)("pad_id"),w("design:type",String)],t.prototype,"padId",void 0),j([Object(c.d)("parent_folder_id"),w("design:type",String)],t.prototype,"parentFolderId",void 0),j([Object(c.d)(),w("design:type",Array)],t.prototype,"parents",void 0),j([Object(c.d)(),w("design:type",Number)],t.prototype,"privilege",void 0),j([Object(c.d)(),w("design:type",String)],t.prototype,"status",void 0),j([Object(c.d)(),w("design:type",String)],t.prototype,"title",void 0),j([Object(c.d)(),w("design:type",Number)],t.prototype,"type",void 0),j([Object(c.d)("uncommit"),w("design:type",Boolean)],t.prototype,"hasLocalChanges",void 0),j([Object(c.d)("doc_sub_type"),w("design:type",Number)],t.prototype,"docSubType",void 0),j([Object(c.d)("official_auth_info"),w("design:type",String)],t.prototype,"officialAuthInfo",void 0),j([Object(c.d)("personalize_info"),w("design:type",String)],t.prototype,"personalizeInfo",void 0),j([Object(c.d)("nativeEngineStatusRecord"),w("design:type",String)],t.prototype,"nativeEngineStatusRecord",void 0),j([Object(c.d)("nativeEngineDocPrivilege"),w("design:type",String)],t.prototype,"nativeEngineDocPrivilege",void 0),j([Object(c.d)(),w("design:type",String)],t.prototype,"data",void 0),j([Object(c.d)(),w("design:type",String)],t.prototype,"ext",void 0),j([Object(c.d)(),w("design:type",Boolean)],t.prototype,"isOfflineCacheByNative",void 0),j([Object(c.d)("mime_type"),w("design:type",String)],t.prototype,"mimeType",void 0),j([Object(c.d)("owner_vip_info"),w("design:type",String)],t.prototype,"ownerVipInfo",void 0),t=j([Object(c.g)(f.padinfo)],t)}(c.a),function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isCreated=!1,t}O(t,e),j([Object(c.f)(),w("design:type",String)],t.prototype,"globalPadId",void 0),j([Object(c.d)(),w("design:type",String)],t.prototype,"secretId",void 0),j([Object(c.d)(),w("design:type",Number)],t.prototype,"documentType",void 0),j([Object(c.d)(),w("design:type",String)],t.prototype,"localPadId",void 0),j([Object(c.d)(),w("design:type",Object)],t.prototype,"isCreated",void 0),t=j([Object(c.g)(f.newDocumentIds)],t)}(c.a),function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lastSyncTimestamp=0,t}O(t,e),j([Object(c.f)(),w("design:type",String)],t.prototype,"globalPadId",void 0),j([Object(c.e)(),w("design:type",String)],t.prototype,"secretId",void 0),j([Object(c.e)(),w("design:type",String)],t.prototype,"uid",void 0),j([Object(c.d)("lastSyncTime"),w("design:type",Object)],t.prototype,"lastSyncTimestamp",void 0),j([Object(c.d)(),w("design:type",Number)],t.prototype,"lastErrorTimestamp",void 0),t=j([Object(c.g)(f.documentStatus)],t)}(c.a),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}O(t,e),j([Object(c.f)(),w("design:type",String)],t.prototype,"key",void 0),j([Object(c.d)(),w("design:type",Object)],t.prototype,"data",void 0),t=j([Object(c.g)(f.documentEntities)],t)}(c.a),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}O(t,e),t=j([Object(c.g)(f.documentData)],t)}(I),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t=j([Object(c.g)(f.offlineData)],t)}(I));!function(e){function t(t){var n,r,i,o=this;return(o=e.call(this)||this).docId=t.docId,o.pageType=t.pageType,o.updateTime=t.updateTime,o.tinyId=t.tinyId,o.wedriveUin=t.wedriveUin,o.wedocOpenId=t.wedocOpenId,o.nowUserIndex=null!==(n=t.nowUserIndex)&&void 0!==n?n:"",o.corpId=t.corpId,o.corpName=t.corpName,o.englishName=t.englishName,o.loginType=t.loginType,o.uidSource=t.uidSource,o.uin=t.uin,o.userId=t.userId,o.userName=t.userName,o.userPic=t.userPic,o.settings=t.settings,o.bindUserInfo=null!==(r=t.bindUserInfo)&&void 0!==r?r:{type:_.UNBIND,userName:"",userPic:"",accountType:h.UNKNOWN},o.vipUserInfo=null!==(i=t.vipUserInfo)&&void 0!==i?i:{type:v.NONE,beginTime:0,endTime:0},o.key="".concat(o.pageType,"-").concat(o.docId,"-").concat(o.tinyId),o}O(t,e),j([Object(c.f)(),w("design:type",String)],t.prototype,"key",void 0),j([Object(c.e)(),w("design:type",String)],t.prototype,"tinyId",void 0),j([Object(c.e)(),w("design:type",String)],t.prototype,"nowUserIndex",void 0),j([Object(c.e)(),w("design:type",String)],t.prototype,"docId",void 0),j([Object(c.e)(),w("design:type",String)],t.prototype,"pageType",void 0),j([Object(c.e)(),w("design:type",String)],t.prototype,"wedriveUin",void 0),j([Object(c.e)(),w("design:type",String)],t.prototype,"wedocOpenId",void 0),j([Object(c.d)(),w("design:type",String)],t.prototype,"corpId",void 0),j([Object(c.d)(),w("design:type",String)],t.prototype,"corpName",void 0),j([Object(c.d)(),w("design:type",String)],t.prototype,"englishName",void 0),j([Object(c.d)(),w("design:type",Number)],t.prototype,"loginType",void 0),j([Object(c.d)(),w("design:type",String)],t.prototype,"openId",void 0),j([Object(c.d)(),w("design:type",Number)],t.prototype,"uidSource",void 0),j([Object(c.d)(),w("design:type",String)],t.prototype,"uin",void 0),j([Object(c.d)(),w("design:type",String)],t.prototype,"userId",void 0),j([Object(c.d)(),w("design:type",String)],t.prototype,"userName",void 0),j([Object(c.d)(),w("design:type",String)],t.prototype,"userPic",void 0),j([Object(c.d)(),w("design:type",String)],t.prototype,"updateTime",void 0),j([Object(c.d)(),w("design:type",Object)],t.prototype,"settings",void 0),j([Object(c.d)(),w("design:type",Object)],t.prototype,"bindUserInfo",void 0),j([Object(c.d)(),w("design:type",Object)],t.prototype,"vipUserInfo",void 0),t=j([Object(c.g)(f.Users),w("design:paramtypes",[Object])],t)}(c.a)},"61cea32eb2":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("d7c625d1f2"),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(r.__extends)(t,e),t.prototype.jsonObj=function(){return this.class2JsonObj()},t.prototype.equals=function(e){for(var n=0,r=Object.keys(this);n<r.length;n++){var i=r[n];if(this[i]instanceof t){if(!this[i].equals(e[i]))return!1}else if(this[i]!==e[i])return!1}return!0},t.prototype.clone=function(){var e=Reflect.getPrototypeOf(this);return Reflect.construct(e.constructor,[this.jsonObj()])},t}(n("b6b7caa0aa").a)},"624cdb524f":function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"d",(function(){return o})),n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return c}));var r=n("a6ef31917d");function i(e,t){return null!==e&&Object.prototype.hasOwnProperty.call(e,t)}function o(e){if(!e||!Object(r.isObject)(e))return e;var t={};return Object.keys(e).forEach((function(n){var r,i=(r=n).length<1?r:(r[0].toLowerCase()+r.substr(1)).replace(/([A-Z])/g,(function(e){return"_".concat(e.toLowerCase())}));if(Object.prototype.hasOwnProperty.call(e,n))if(Array.isArray(e[n])){var a=e[n],c=[];a.forEach((function(e){var t=o(e);c.push(t)})),t[i]=c}else e[n]instanceof Object?t[i]=o(e[n]):t[i]=e[n]})),t}function a(e){if(!e||!Object(r.isObject)(e))return e;var t={};return Object.keys(e).forEach((function(n){var r=function(e){for(var t=e.split("_"),n="",r=0;r<t.length;r++){var i=t[r];i.length>0&&(n+=0===r?i:i="".concat(i[0].toUpperCase()).concat(i.substring(1)))}return n}(n);if(Object.prototype.hasOwnProperty.call(e,n))if(Array.isArray(e[n])){var i=e[n],o=[];i.forEach((function(e){var t=a(e);o.push(t)})),t[r]=o}else e[n]instanceof Object?t[r]=a(e[n]):t[r]=e[n]})),t}function c(e,t,n){Object.getOwnPropertyNames(t).forEach((function(n){var r=Object.getOwnPropertyDescriptor(t,n);r&&"constructor"!==n&&Object.defineProperty(e,n,r)})),Object.getOwnPropertyNames(n.prototype).forEach((function(t){"constructor"!==t&&(e[t]=n.prototype[t])}))}},"6423ed0b81":function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return c})),n.d(t,"c",(function(){return s}));var r,i=n("70eedf593c"),o=n("624cdb524f"),a=(n("a6ef31917d"),"document");function c(e){if(!Object(o.b)(i.a,a))return null;var t=new RegExp("(?:^|;+|\\s+)".concat(e,"=([^;]*)")),n=document.cookie.match(t);return(n?n[1]:null)||null}function s(e){return c(e)}!function(e){e.xsrf="TOK",e.devRouteId="dev_route_id",e.devOaName="dev_oa_name",e.fd="fd",e.envId="env_id",e.sid="SID",e.sids="SID_S",e.uid="uid",e.uidKey="uid_key",e.uin="uin",e.loginTime="loginTime",e.hasBeenLogin="has_been_login",e.adtag="adtag",e.plUin="p_luin",e.pUin="p_uin",e.pSkey="p_skey",e.plSkey="p_lskey"}(r||(r={}))},"64973f262b":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("cedf7830be"),i=Object(r.a)("IEnterpriseAccountDomainService")},"65e41bd588":function(e,t,n){"use strict";var r,i;n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.QQ=1]="QQ",e[e.WX=2]="WX",e[e.WORK=3]="WORK",e[e.EMAIL=4]="EMAIL",e[e.PHONE=8]="PHONE",e[e.WORK_COMBINATION=9]="WORK_COMBINATION",e[e.TOWER=10]="TOWER",e[e.ROBOT=11]="ROBOT",e[e.QFYF=12]="QFYF",e[e.OPEN=13]="OPEN",e[e.MEETING=14]="MEETING"}(r||(r={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.WECHAT=4]="WECHAT",e[e.WEWORK=3]="WEWORK"}(i||(i={}))},"66fd263031":function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n("d7c625d1f2"),i=n("61cea32eb2"),o=n("52878e0097"),a=function(e){function t(t){var n=e.call(this)||this;return n.avatar="",n.nick="",n.introduction="",n.type=0,n.principal="",n.credential="",n.isOfficialAccount=!1,t&&(n.setOfficialAccountStatus(t),n.jsonObj2Class(t)),n}return Object(r.__extends)(t,e),t.prototype.setOfficialAccountStatus=function(e){this.isOfficialAccount=e.type!==o.a.UNAUTHED},t}(i.a)},"67b3031e50":function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n("d7c625d1f2"),i=n("16995032fd"),o=n("03808c4177"),a=n("540dabb65d"),c=function(){function e(e){this.networkRequestService=e}return e.prototype.createLoginAggregate=function(e){this.loginAggregate=new i.a(this.networkRequestService,e)},e.prototype.init=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){return[2]}))}))},Object(r.__decorate)([Object(a.a)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"init",null),e=Object(r.__decorate)([Object(r.__param)(0,o.a),Object(r.__metadata)("design:paramtypes",[Object])],e)}()},"697ecdc674":function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},r(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a};Object.defineProperty(t,"__esModule",{value:!0}),t.DisposeTrace=t.disableDisposeTrace=t.enableDisposeTrace=void 0;var c=!1;t.enableDisposeTrace=function(){c=!0},t.disableDisposeTrace=function(){c=!1};var s=function(){function e(e){this.name=e,this._dep=[]}return e.traceRoot=function(t){return c?new e(t):e._None},e.prototype.branch=function(t){var n=new e(t);return this._dep.push([t,n]),n},e.prototype.stop=function(){var e=["dispose "+this.name,""+function e(t,n){var r,i,c=[],s=new Array(t+1).join("\t");try{for(var u=o(n._dep),d=u.next();!d.done;d=u.next()){var l=a(d.value,2),p=l[0],f=l[1];if(f){c.push(s+"dispose -> "+p);var h=e(t+1,f);h&&c.push(h)}else c.push(s+"dispose -> "+p)}}catch(e){r={error:e}}finally{try{d&&!d.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}return c.join("\n")}(1,this)];console.log(e.join("\n"))},e._None=new(function(e){function t(){return e.call(this,null)||this}return i(t,e),t.prototype.stop=function(){},t.prototype.branch=function(){return this},t}(e)),e}();t.DisposeTrace=s},"6c5644ca25":function(e,t,n){"use strict";n.d(t,"a",(function(){return T}));var r,i=n("d7c625d1f2"),o=n("03808c4177"),a=n("65e41bd588"),c=n("540dabb65d"),s=n("389ef8f989"),u=n("8b932bcade"),d=n("c929b8af70"),l=n("66fd263031"),p=n("c398fb2896"),f=n("1add19ffb1"),h=n("9a4c21e153"),b=n("76702c352f"),_=n("6423ed0b81"),v=n("6fa7b8d7bc"),y=n("d861d3fe93"),g=n("5ac65fff24"),m=((r={})[h.c.WECHAT]=h.b.WECHAT,r[h.c.WEWORK]=h.b.WEWORK,r),O=function(){return!!Object(_.b)("wedoc_sid")},j=function(e){var t,n=O()?void 0:e.sid,r=void 0,o=void 0,a=void 0;return t=e.type===h.c.WECHAT||O()?e.uid:e.uin,O()&&(r=e.sid,o=e.openid,a=t),Object(i.__assign)(Object(i.__assign)({},e),{corpName:e.corp_name,uid:t,uType:m[e.type],nick:e.name,nickName:e.nick_name,wedriveUin:t,fromDomain:h.a.B_DOMAIN,cookie:{wedriveSid:n,wedocSid:r,wedocOpenid:o,tdocUid:a,uType:m[e.type],uid:"",uidKey:"",userIndex:"",SID:"",isMultiLogin:!0}})},w=function(){function e(e){this.networkRequestService=e}return e.prototype.getEnterpriseAccountList=function(){return Object(i.__awaiter)(this,void 0,void 0,(function(){var e,t,n,r,o,a;return Object(i.__generator)(this,(function(c){switch(c.label){case 0:return e=Object(v.a)(g.c,{xrsf:"".concat(Object(_.c)(_.a.xsrf)),get_acct:"true"}),[4,this.networkRequestService.instance.get(e)];case 1:return t=c.sent(),n=function(e){void 0===e&&(e="{}");var t=e.replace(/"uin":(\d+)/g,'"uin":"$1"').replace(/"uid":(\d+)/g,'"uid":"$1"');return JSON.parse(t)}(null===(a=t.request)||void 0===a?void 0:a.responseText),r=n.body,o=n.head,[2,Object(i.__assign)(Object(i.__assign)({},t),{data:{data:(u=r.session,d=Object(s.a)(),u.map((function(e){return e.type!==h.c.WECHAT||e.uid||(e.uid=d[e.uin]),e})).filter((function(e){return e.uid}))).map(j),retcode:o.ret,msg:o.msg}})]}var u,d}))}))},e.prototype.getUserMarkNameListByUids=function(e){return Object(i.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(i.__generator)(this,(function(r){switch(r.label){case 0:return t=Object(v.a)(g.d,{xrsf:"".concat(Object(_.c)(_.a.xsrf)),uids:"[".concat(e.join(","),"]")}),[4,this.networkRequestService.instance.get(t)];case 1:return n=r.sent(),[2,Object(i.__assign)(Object(i.__assign)({},n),{data:{data:n.data.result.rsp,retcode:n.data.retcode,msg:n.data.msg}})]}}))}))},e.prototype.delEnterpriseAccountForList=function(e){return Object(i.__awaiter)(this,void 0,void 0,(function(){var t;return Object(i.__generator)(this,(function(n){return t=Object(v.a)(y.d,{xrsf:"".concat(Object(_.c)(_.a.xsrf)),sid:e}),[2,this.networkRequestService.instance.get(t)]}))}))},Object(i.__decorate)([Object(b.b)(),Object(b.c)(),Object(i.__metadata)("design:type",Function),Object(i.__metadata)("design:paramtypes",[]),Object(i.__metadata)("design:returntype",Promise)],e.prototype,"getEnterpriseAccountList",null),Object(i.__decorate)([Object(b.b)(),Object(b.c)(),Object(i.__metadata)("design:type",Function),Object(i.__metadata)("design:paramtypes",[Array]),Object(i.__metadata)("design:returntype",Promise)],e.prototype,"getUserMarkNameListByUids",null),Object(i.__decorate)([Object(b.b)(),Object(b.c)(),Object(i.__metadata)("design:type",Function),Object(i.__metadata)("design:paramtypes",[String]),Object(i.__metadata)("design:returntype",Promise)],e.prototype,"delEnterpriseAccountForList",null),e=Object(i.__decorate)([Object(i.__param)(0,o.a),Object(i.__metadata)("design:paramtypes",[Object])],e)}(),I=function(e){function t(t,n){var r=e.call(this,n)||this;return r.networkRequestService=t,r.enterpriseAccountListRepository=new w(t),r.enterpriseAccountList=[],r}return Object(i.__extends)(t,e),t.prototype.getEnterpiseAccountList=function(){return Object(i.__awaiter)(this,void 0,void 0,(function(){var e;return Object(i.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.enterpriseAccountListRepository.getEnterpriseAccountList()];case 1:return e=t.sent().resData,this.enterpriseAccountList=(null==e?void 0:e.data.data)?e.data.data:[],[2,this.enterpriseAccountList]}}))}))},t.prototype.getUserMarkNameListByUids=function(e){return Object(i.__awaiter)(this,void 0,void 0,(function(){var t;return Object(i.__generator)(this,(function(n){switch(n.label){case 0:return[4,this.enterpriseAccountListRepository.getUserMarkNameListByUids(e)];case 1:return t=n.sent().resData,this.userMarkNameList=(null==t?void 0:t.data.data)?t.data.data:[],[2,this.userMarkNameList]}}))}))},t.prototype.delEnterpriseAccountForList=function(e){return Object(i.__awaiter)(this,void 0,void 0,(function(){return Object(i.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.enterpriseAccountListRepository.delEnterpriseAccountForList(e)];case 1:return t.sent(),this.updateEntrepriseAccountListAfterDel(e),[2,!0]}}))}))},t.prototype.updateEntrepriseAccountListAfterDel=function(e){this.enterpriseAccountList=this.enterpriseAccountList.filter((function(t){return t.cookie.wedocSid!==e&&t.cookie.wedriveSid!==e}))},t=Object(i.__decorate)([Object(i.__param)(0,o.a),Object(i.__metadata)("design:paramtypes",[Object,String])],t)}(n("98c24f707d").a),S=I,E=n("c9b8a6765d"),x=n("61cea32eb2"),C=n("8139f7151b"),A=function(e){function t(t){var n=e.call(this)||this;if(n.type=C.h.NONE,n.vipLevel=C.g.NONE,n.beginTime=0,n.endTime=0,n.customInfo={avatarFrame:"",badgeUrl:"",corpVipLevel:C.a.INVALID_CORP_VIP_LEVEL},!t)return n;var r=n.createEmptyVip();return n.jsonObj2Class(r),n}return Object(i.__extends)(t,e),t.prototype.updateVipUserInfo=function(e){if(e){var t=this.handleVipCustomInfoFromNet(e);this.jsonObj2Class({customInfo:t})}},t.prototype.createEmptyVip=function(){return{type:C.h.NONE,beginTime:0,endTime:0}},t.prototype.handleVipCustomInfoFromNet=function(e){var t={avatar_frame_url:"",badge_url:"",corp_vip_level:C.a.INVALID_CORP_VIP_LEVEL};try{t=JSON.parse(e)}catch(e){}var n=t.avatar_frame_url,r=void 0===n?"":n,i=t.badge_url,o=void 0===i?"":i,a=t.corp_vip_level;return{avatarFrame:r,badgeUrl:o,corpVipLevel:void 0===a?C.a.INVALID_CORP_VIP_LEVEL:a}},t}(x.a),k=function(e){function t(t,n,r){var i=e.call(this,n)||this;return i.networkRequestService=t,i.vipInfo=new A,i.bindUserInfo=new d.a,i.officialInfo=new l.a,i.enterpriseAccountListEntity=new S(t,n),i.userInfo=new E.a(r),i.accountRepository=new p.a(t),i}return Object(i.__extends)(t,e),t.prototype.completionUserInfo=function(e){e.vipInfo&&(this.vipInfo=new A),e.vip&&this.vipInfo.updateVipUserInfo(e.vip),e.wechatOfficialAccount&&(this.officialInfo=new l.a(e.wechatOfficialAccount)),this.bindUserInfo=new d.a(e)},t=Object(i.__decorate)([Object(i.__param)(0,o.a),Object(i.__metadata)("design:paramtypes",[Object,String,Object])],t)}(f.a),R=n("8a3f853387"),D=n("b6e58b965b"),T=function(){function e(e){var t=this;this.networkRequestService=e,this.updateBLocalStoragePersionTinyid=function(e){return Object(i.__awaiter)(t,void 0,void 0,(function(){var t,n,r;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:return e.loginType===a.a.WX&&e.tinyid?[4,this.accountAggregate.enterpriseAccountListEntity.getUserMarkNameListByUids([e.tinyid])]:[3,2];case 1:t=i.sent(),(n=null===(r=t[0])||void 0===r?void 0:r.wedriveUin)&&Object(s.b)({wedriveUin:n,tinyid:e.tinyid}),i.label=2;case 2:return[2]}}))}))},this.userInfoRepository=new D.a(this.networkRequestService)}return e.prototype.init=function(){return Object(i.__awaiter)(this,void 0,void 0,(function(){return Object(i.__generator)(this,(function(e){return[2]}))}))},e.prototype.createEnterpriseEnvAccountAggregateByBasicClientVars=function(e){return e?(this.accountAggregate=new k(this.networkRequestService,e.tinyId||R.h,this.changeBasicClientVarsToBaseData(e)),!0):(this.accountAggregate=new k(this.networkRequestService,R.h),!1)},e.prototype.completionUserInfo=function(){return Object(i.__awaiter)(this,void 0,void 0,(function(){var e;return Object(i.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.userInfoRepository.getEnterpriseUserInfo()];case 1:return(e=t.sent())?(this.accountAggregate.completionUserInfo(e),[2,!0]):[2,!1]}}))}))},e.prototype.createEnterpriseEnvAccountAggregateByUserInfoCgi=function(e){var t=this.changeFetchDataToBaseData(e);this.accountAggregate=new k(this.networkRequestService,t.tinyId,t)},e.prototype.changeBasicClientVarsToBaseData=function(e){return Object(i.__assign)({},e)},e.prototype.changeFetchDataToBaseData=function(e,t){this.updateBLocalStoragePersionTinyid(e);var n=e.corpId,r=e.tinyid,i=e.corpName,o=e.englishName,a=e.loginType,c=e.wxOpenid,s=e.uin,d=e.uidSource,l=e.userId,p=e.avatar,f=e.nick,h=u.a.get(e.uid)||u.a.get(e.xid||"");return{corpId:n,corpName:i,englishName:o,loginType:a,uin:s,uidSource:d,userId:l,tinyId:r,openId:c,userName:f,userPic:p,wedriveUin:(null==h?void 0:h.uid)||e.uid,nowUserIndex:"",settings:{language:null!=t?t:"",toolbarMode:"",vipTheme:""},wedocOpenId:e.openid}},Object(i.__decorate)([Object(c.a)(),Object(i.__metadata)("design:type",Function),Object(i.__metadata)("design:paramtypes",[]),Object(i.__metadata)("design:returntype",Promise)],e.prototype,"init",null),e=Object(i.__decorate)([Object(i.__param)(0,o.a),Object(i.__metadata)("design:paramtypes",[Object])],e)}()},"6daf052090":function(e,t,n){"use strict";n.d(t,"a",(function(){return E}));var r=n("d7c625d1f2"),i=n("76702c352f"),o=n("1add19ffb1"),a=n("98c24f707d"),c=function(e){function t(t){var n=e.call(this)||this;return n.beginTime=0,n.endTime=0,n.isVip=!1,n.oldVip=!1,n.vipLevel=0,n.user={},n.recycleLimit={},n.collaborateLimit={},n.expansion={},n.superVip={},t.super_vip=t.super,n.jsonObj2Class(t),n}return Object(r.__extends)(t,e),t}(n("61cea32eb2").a),s=n("65e41bd588"),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.avatar="",t.qqAvatar="",t.wxAvatar="",t.nick="",t.qqNick="",t.wxNick="",t.corpId="",t.corpName="",t.domain="",t.domainId="",t.dbEmail="",t.email="",t.tinyid="",t.toid="",t.userId="",t.uid="",t.wxOpenid="",t.uidSource=0,t.uin="",t.login=!1,t.loginTime=0,t.loginType=s.a.UNKNOWN,t.xu="",t.vipInfo=new c({}),t.vip="",t.userPic="",t}return Object(r.__extends)(t,e),t}(a.a),d=n("da5bb142c9"),l=n("fb1099018f"),p="".concat(l.c,"user_info"),f="".concat(l.c,"vip_all"),h="".concat(l.c,"user_flag"),b="".concat(l.c,"user_info/check"),_=n("b512c0eccb"),v=n("6423ed0b81"),y=n("6fa7b8d7bc"),g=n("8b932bcade"),m=function(){function e(){}return e.prototype.getUserInfo=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n,i;return Object(r.__generator)(this,(function(o){return Object(d.n)()?[2,new Promise((function(e){g.a.getUserInfo().then((function(t){e({data:t,status:200,statusText:""})}))}))]:(n={get_vip_info:e},t&&(n=Object(r.__assign)(Object(r.__assign)({},n),{u:t})),i=Object(y.a)(p,n),[2,_.networkRequest.post(i,{xsrf:Object(v.c)(v.a.xsrf)})])}))}))},e.prototype.getVipInfo=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e;return Object(r.__generator)(this,(function(t){return e=Object(y.a)(f,{xsrf:"".concat(Object(v.c)(v.a.xsrf))}),[2,_.networkRequest.post(e)]}))}))},e.prototype.getUserFlag=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){return t=Object(y.a)(h,{xsrf:"".concat(Object(v.c)(v.a.xsrf)),type:e}),[2,_.networkRequest.post(t)]}))}))},e.prototype.userInfoCheck=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e;return Object(r.__generator)(this,(function(t){return e=Object(y.a)(b,{xsrf:"".concat(Object(v.c)(v.a.xsrf))}),[2,_.networkRequest.post(e)]}))}))},e}(),O=n("9ab1857893"),j="userInfo",w=function(e){function t(t){var n=e.call(this,t)||this;return n.userInfo=new u("mainUserInfo"),n.mOnUserInfoDidUpdated=new O.Emitter,n.userInfoRepository=new m,n.onUserInfoDidUpdated=n.mOnUserInfoDidUpdated.event,n}return Object(r.__extends)(t,e),t.prototype.fetchUserInfo=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(n){return[2,this.userInfoRepository.getUserInfo(e,t)]}))}))},t.prototype.fetchVipInfo=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){return this.vipInfo=[],[2,this.userInfoRepository.getVipInfo()]}))}))},t.prototype.fetchUserFlag=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.userInfoRepository.getUserFlag(e)]}))}))},t.prototype.userInfoCheck=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){return[2,this.userInfoRepository.userInfoCheck()]}))}))},Object(r.__decorate)([Object(i.d)("mOnUserInfoDidUpdated",j),Object(i.i)(u.prototype.constructor,j),Object(i.a)(),Object(i.c)(),Object(i.h)("x-u","xu"),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Number,String]),Object(r.__metadata)("design:returntype",Promise)],t.prototype,"fetchUserInfo",null),Object(r.__decorate)([Object(i.f)(c.prototype.constructor,"vipInfo","vip_info"),Object(i.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[]),Object(r.__metadata)("design:returntype",Promise)],t.prototype,"fetchVipInfo",null),Object(r.__decorate)([Object(i.b)(),Object(i.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Number]),Object(r.__metadata)("design:returntype",Promise)],t.prototype,"fetchUserFlag",null),Object(r.__decorate)([Object(i.b)(),Object(i.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[]),Object(r.__metadata)("design:returntype",Promise)],t.prototype,"userInfoCheck",null),t}(o.a),I=n("540dabb65d"),S=n("624cdb524f"),E=function(){function e(){this.userInfoAggregate=new w("mainUserInfoAggregate"),this.isInitedByBasicClientVars=!1,Object(S.c)(this,this.userInfoAggregate,w),window.basicClientVars&&this.initWithBasicClientVars(window.basicClientVars)}return e.prototype.init=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n,i;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return t=e.u,[4,this.userInfoAggregate.fetchUserInfo(1,t)];case 1:return n=r.sent().resData,(i=null==n?void 0:n.data)?(this.userInfoAggregate.userInfo.initWithJsonObj({avatar:i.userPic,nick:i.nick,corpId:i.corpId,corpName:i.corpName,domain:i.domain,domainId:i.domainId,loginType:i.loginType,login:i.login,uin:i.uin,uidSource:i.uidSource,wxOpenid:i.wxOpenid,tinyid:i.tinyid,userId:""===i.userId?"p.".concat(i.tinyid):i.userId}),[2]):[2]}}))}))},e.prototype.updateWithClientVars=function(e){this.isInitedByBasicClientVars||this.userInfoAggregate.userInfo.initWithJsonObj({avatar:e.userPic,tinyid:e.tinyid,nick:e.userName,loginType:e.userType,userId:e.userId,uin:e.uin})},e.prototype.initWithBasicClientVars=function(e){this.userInfoAggregate.userInfo.initWithJsonObj({corpId:e.userInfo.corpId,corpName:e.userInfo.corpName,loginType:e.userInfo.loginType,login:!!e.userInfo.tinyId,uin:e.userInfo.uin,uidSource:e.userInfo.uidSource,wxOpenid:e.userInfo.openId,tinyid:e.userInfo.tinyId,userId:e.userInfo.userId,avatar:e.userInfo.userPic,nick:e.userInfo.userName}),this.isInitedByBasicClientVars=!0},Object(r.__decorate)([Object(I.a)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"init",null),Object(r.__decorate)([Object(i.m)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",void 0)],e.prototype,"initWithBasicClientVars",null),e}()},"6dc82740da":function(e,t,n){"use strict";var r=n("94b54f38ee"),i=n("8e87c39c39"),o=n("bf3ff0c91e"),a=n("ac1e2b0319"),c=n("9e41b0871b"),s=n("9ae390a68c"),u=n("4a49840677"),d=n("f9f6cd81c2"),l=n("744ee0b6cd"),p=n("1cc181d9f8");e.exports=function(e){return new Promise((function(t,n){var f,h=e.data,b=e.headers,_=e.responseType;function v(){e.cancelToken&&e.cancelToken.unsubscribe(f),e.signal&&e.signal.removeEventListener("abort",f)}r.isFormData(h)&&delete b["Content-Type"];var y=new XMLHttpRequest;if(e.auth){var g=e.auth.username||"",m=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";b.Authorization="Basic "+btoa(g+":"+m)}var O=c(e.baseURL,e.url);function j(){if(y){var r="getAllResponseHeaders"in y?s(y.getAllResponseHeaders()):null,o={data:_&&"text"!==_&&"json"!==_?y.response:y.responseText,status:y.status,statusText:y.statusText,headers:r,config:e,request:y};i((function(e){t(e),v()}),(function(e){n(e),v()}),o),y=null}}if(y.open(e.method.toUpperCase(),a(O,e.params,e.paramsSerializer),!0),y.timeout=e.timeout,"onloadend"in y?y.onloadend=j:y.onreadystatechange=function(){y&&4===y.readyState&&(0!==y.status||y.responseURL&&0===y.responseURL.indexOf("file:"))&&setTimeout(j)},y.onabort=function(){y&&(n(d("Request aborted",e,"ECONNABORTED",y)),y=null)},y.onerror=function(){n(d("Network Error",e,null,y)),y=null},y.ontimeout=function(){var t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",r=e.transitional||l;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(d(t,e,r.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",y)),y=null},r.isStandardBrowserEnv()){var w=(e.withCredentials||u(O))&&e.xsrfCookieName?o.read(e.xsrfCookieName):void 0;w&&(b[e.xsrfHeaderName]=w)}"setRequestHeader"in y&&r.forEach(b,(function(e,t){void 0===h&&"content-type"===t.toLowerCase()?delete b[t]:y.setRequestHeader(t,e)})),r.isUndefined(e.withCredentials)||(y.withCredentials=!!e.withCredentials),_&&"json"!==_&&(y.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&y.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&y.upload&&y.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(f=function(e){y&&(n(!e||e&&e.type?new p("canceled"):e),y.abort(),y=null)},e.cancelToken&&e.cancelToken.subscribe(f),e.signal&&(e.signal.aborted?f():e.signal.addEventListener("abort",f))),h||(h=null),y.send(h)}))}},"6fa7b8d7bc":function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r="#",i="?",o="&";function a(e,t){if(e.includes(i)){var n=e;return Object.keys(t).map((function(e){n=function(e,t,n){var r=e.split(i),a=r[1].split(o),c=!0,s=new Map;a.forEach((function(e){var t=e.split("=");s.set(t[0],t[1])})),a.some((function(e){0===e.indexOf("".concat(t,"="))&&(s.set(t,n),c=!1)})),c&&s.set(t,n);var u=[];return s.forEach((function(e,t){var n="".concat(t,"=").concat(e);u.push(n)})),r[1]=u.join(o),r.join(i)}(n,e,t[e])})),n}var r=Object.keys(t).map((function(e){return"".concat(e,"=").concat(t[e])})).join(o);return"".concat(e,"?").concat(r)}function c(e,t){if(Object.keys(t).length<1)return e;if(e.includes(r)){var n=e.split(r);return n[0]=a(n[0],t),n.join(r)}return a(e,t)}},"70eedf593c":function(e,t,n){"use strict";(function(e){var n={};function r(){return"undefined"!=typeof window}function i(){return void 0!==e}var o=r()?window:i()?e:r||"undefined"==typeof self?(i()&&e.describe,n):self;t.a=o}).call(this,n("5ef37df1a0"))},"725707fbbc":function(e,t,n){"use strict";n.r(t),n.d(t,"SortOrder",(function(){return h.a})),n.d(t,"DBEngineType",(function(){return J})),n.d(t,"DB_NAME_BACKUP",(function(){return ee})),n.d(t,"DocumentDataStorage",(function(){return ie})),n.d(t,"DocumentEntityStorage",(function(){return se})),n.d(t,"DocumentIdStorage",(function(){return ae})),n.d(t,"DocumentStatusStorage",(function(){return ce})),n.d(t,"DriveDataStorage",(function(){return le})),n.d(t,"OfflineDataStorage",(function(){return oe})),n.d(t,"PadInfoStorage",(function(){return ue})),n.d(t,"StorageBackupManager",(function(){return te})),n.d(t,"StorageManager",(function(){return $})),n.d(t,"UserInfoStorage",(function(){return de}));var r,i=n("9132715560"),o=n.n(i),a=n("6a364eb35c"),c=n.n(a),s=n("3ef2352f0b"),u=n.n(s),d=(n("c6244f7705"),n("081c8cafea"),n("6c6f26abf4"),n("d7c625d1f2")),l=n("10f9b6de11"),p=n("52bbb6cc53"),f=n("9c60cb7ff5"),h=n("c564d09b70");!function(e){e.pending="[PENDING]",e.success="[SUCCESS]",e.failure="[FAILURE]",e.slow="[SLOW]"}(r||(r={}));var b,_,v,y=Symbol("begin"),g=function(e,t){return e+"/"+t},m=function(e,t){return"["+e+"."+t+"]"},O=function(e){var t=Array.isArray(e)?e:Object.keys(e).filter((function(t){return void 0!==e[t]})).map((function(t){return t+"="+e[t]}));return t.length?Object(d.__spreadArray)(["args:"],Object(d.__read)(t)):[]},j=function(e){return"[-* "+e+"]"},w=function(){function e(e){var t=this,n=void 0===e?{logger:console,verbose:!1,disabled:!1,prefix:""}:e,i=n.logger,o=void 0===i?console:i,a=n.disabled,c=void 0!==a&&a,s=n.verbose,u=void 0!==s&&s,l=n.prefix,f=void 0===l?"":l;this.name="LoggerPlugin",this.formatQueryConditionsExp=function(e){if(e.type===p.e.AND||e.type===p.e.OR){if(!e.exps.length)return;return e.exps.map(t.formatQueryConditionsExp).filter(Boolean).map((function(t){return e.type===p.e.OR&&e.exps.length>1?"("+t+")":t})).join(e.type===p.e.AND?" AND ":" OR ")}return e.type===p.e.FILTER?t.formatPredicate(e.path,e.predicate):e.type},this.formatPredicate=function(e,t){return Object.keys(t).filter((function(e){return void 0!==t[e]})).map((function(n){return e+" "+n+" "+JSON.stringify(t[n])})).join(" AND ")},this.logMethodBegin=function(e,n,i,o){var a;e.timings.set(y,new Date),(a=t.logger).info.apply(a,Object(d.__spreadArray)([t.prefix,r.pending,m(n,i)],Object(d.__read)(O(o))))},this.logMethodEnd=function(e,n,i,o,a){var c,s,u,l,p=e.timings.get(y)||new Date,f=m(n,i),h=Date.now()-p.getTime(),b="cost="+h+"ms",_=h>=500;a.error?(c=t.logger).error.apply(c,Object(d.__spreadArray)([t.prefix,r.failure,m(n,i),b,null===(u=a.error)||void 0===u?void 0:u.message,null===(l=a.error)||void 0===l?void 0:l.stack],Object(d.__read)(O(o)))):(s=t.logger)[_?"warn":"info"].apply(s,Object(d.__spreadArray)(Object(d.__spreadArray)(Object(d.__spreadArray)(Object(d.__spreadArray)([t.prefix,r.success],Object(d.__read)(_?[r.slow]:[])),[f,b]),Object(d.__read)(O(o))),["result:",a.data]))},this.logger=o,this.disabled=c,this.verbose=u,this.prefix=f}return e.prototype.register=function(e){this.disabled||(this.prefix=this.prefix||"["+e.name+"]",this.hookPrimaryKeyQueries(e),this.hookConditionQueries(e),this.hookDataManipulationQueries(e),this.hookEvents(e),this.hookMigration(e),this.verbose&&this.hookEngine(e))},e.prototype.dispose=function(e){throw new f.b({storage:e})},e.prototype.hookMigration=function(e){var t=this,n=function(e,n,r){void 0===r&&(r="migration"),e.before((function(e){t.logMethodBegin(e,r,n,e.args)})).after((function(e){t.logMethodEnd(e,r,n,e.args,{data:e.return,error:e.error})}))};n(e.aspects.migration.buildMigration,"buildMigration"),n(e.aspects.migration.executeDataMigration,"executeDataMigration"),n(e.aspects.migration.executeSchemaMigration,"executeSchemaMigration"),n(e.aspects.migration.updateMigrationChangeInfo,"updateMigrationChangeInfo"),n(e.aspects.migration.prepareAutoUpgradeHandler,"prepareAutoUpgradeHandler"),n(e.aspects.migration.log,"innerLog"),n(e.aspects.migration.actionExecutor.executeSchemaAction,"executeSchemaAction"),n(e.aspects.migration.actionExecutor.executeDataAction,"executeDataAction")},e.prototype.hookEngine=function(e){var t=this,n=function(e,n,r){e.before((function(e){t.logMethodBegin(e,n,r,e.args)})).after((function(e){t.logMethodEnd(e,n,r,e.args,{data:e.return,error:e.error})}))},r=e.aspects.engine;n(r.openDB,"engine","openDB"),n(r.deleteDB,"engine","deleteDB"),this.hookEngineDatabase(r.database,n),this.hookEngineTable(r.table,n),this.hookEngineTransaction(r.transaction,n),this.hookEngineIndex(r.index,n),this.hookEngineCursor(r.cursor,n)},e.prototype.hookEngineDatabase=function(e,t){var n=g("engine","database");t(e.close,n,"close"),t(e.table,n,"table"),t(e.transaction,n,"transaction"),t(e.createTable,n,"createTable"),t(e.deleteTable,n,"deleteTable")},e.prototype.hookEngineTransaction=function(e,t){var n=g("engine","transaction");t(e.commit,n,"commit"),t(e.rollback,n,"rollback"),t(e.table,n,"table")},e.prototype.hookEngineIndex=function(e,t){var n=g("engine","index");t(e.get,n,"get"),t(e.getAll,n,"getAll"),t(e.getAllKeys,n,"getAllKeys"),t(e.openCursor,n,"openCursor")},e.prototype.hookEngineCursor=function(e,t){var n=g("engine","cursor");t(e.delete,n,"delete"),t(e.update,n,"update"),t(e.next,n,"next"),t(e.value,n,"value")},e.prototype.hookEngineTable=function(e,t){var n=g("engine","table");t(e.clear,n,"clear"),t(e.get,n,"get"),t(e.delete,n,"delete"),t(e.getAll,n,"getAll"),t(e.getAllKeys,n,"getAllKeys"),t(e.index,n,"index"),t(e.insert,n,"insert"),t(e.upsert,n,"upsert"),t(e.createIndex,n,"createIndex"),t(e.deleteIndex,n,"deleteIndex"),t(e.openCursor,n,"openCursor"),t(e.query,n,"query"),t(e.bulkDelete,n,"bulkDelete"),t(e.bulkUpsert,n,"bulkUpsert")},e.prototype.hookPrimaryKeyQueries=function(e){var t=this,n=function(e,n){e.before((function(e){t.logMethodBegin(e,e.this.name,n,{key:e.args[0]})})).after((function(e){t.logMethodEnd(e,e.this.name,n,{key:e.args[0]},{data:e.return,error:e.error})}))};n(e.aspects.collection.get,"get"),n(e.aspects.collection.has,"has"),n(e.aspects.collection.delete,"delete")},e.prototype.hookConditionQueries=function(e){var t=this,n=function(e,n){e.before((function(e){t.logMethodBegin(e,e.this.name,n,t.formatQueryConditions(e.this.conditions()))})).after((function(e){t.logMethodEnd(e,e.this.name,n,t.formatQueryConditions(e.this.conditions()),{data:e.return,error:e.error})}))};n(e.aspects.collection.count,"count"),n(e.aspects.collection.entries,"entries"),n(e.aspects.collection.keys,"keys"),n(e.aspects.collection.values,"values"),n(e.aspects.collection.first,"first"),n(e.aspects.collection.last,"last"),n(e.aspects.collection.clear,"clear"),n(e.aspects.collection.update,"update")},e.prototype.hookDataManipulationQueries=function(e){var t=this,n=function(e,n){e.before((function(e){t.logMethodBegin(e,e.this.name,n,e.args)})).after((function(e){t.logMethodEnd(e,e.this.name,n,e.args,{data:e.return,error:e.error})}))};n(e.aspects.collection.insert,"insert"),n(e.aspects.collection.upsert,"upsert"),n(e.aspects.collection.bulkInsert,"bulkInsert"),n(e.aspects.collection.bulkUpsert,"bulkUpsert")},e.prototype.hookEvents=function(e){var t,n=this,r=(t=Date.now(),function(){var e=Date.now(),n="+"+(e-t)+"ms";return t=e,n});e.events.onBootstrapStart((function(){n.logger.info(n.prefix,j(h.b.BootstrapStart),r())})),e.events.onBootstrapEnd((function(){n.logger.info(n.prefix,j(h.b.BootstrapEnd),r())})),e.events.onSchemaMigrationStart((function(){n.logger.info(n.prefix,j(h.b.SchemaMigrationStart),r())})),e.events.onSchemaMigrationEnd((function(){n.logger.info(n.prefix,j(h.b.SchemaMigrationEnd),r())})),e.events.onRegisterModel((function(e){var t,i=e.schema;return(t=n.logger).info.apply(t,Object(d.__spreadArray)(Object(d.__spreadArray)([n.prefix,j(h.b.RegisterModel)],Object(d.__read)(O({schema:JSON.stringify(i)}))),[r()]))})),e.events.onRegisterPlugin((function(e){var t,i=e.name;return(t=n.logger).info.apply(t,Object(d.__spreadArray)(Object(d.__spreadArray)([n.prefix,j(h.b.RegisterPlugin)],Object(d.__read)(O({name:i}))),[r()]))})),e.events.onReady((function(e){var t,i=e.version,o=e.tableNames;return(t=n.logger).info.apply(t,Object(d.__spreadArray)(Object(d.__spreadArray)([n.prefix,j(h.b.Ready)],Object(d.__read)(O({version:i,collections:Array.from(o)}))),[r()]))}))},e.prototype.formatQueryConditions=function(e){var t=e.offset,n=e.limit,r=e.order,i=e.exp;return{OFFSET:t||void 0,LIMIT:n,ORDER_BY:r&&"("+r.path+" "+r.type+")",WHERE:"("+this.formatQueryConditionsExp(i)+")"}},e}(),I=w;!function(e){e.storage="storage",e.collection="collection",e.query="query",e.migration="migration",e.engine="engine"}(b||(b={})),function(e){e.tableGetAll="table#getAll",e.tableGetAllKeys="table#getAllKeys",e.tableGet="table#get",e.tableInsert="table#insert",e.tableUpsert="table#upsert",e.tableDelete="table#delete",e.tableClear="table#clear",e.tableBulkUpsert="table#bulkUpsert",e.tableBulkDelete="table#bulkDelete",e.tableQuery="table#query",e.tableCreateIndex="table#createIndex",e.tableDeleteIndex="table#deleteIndex",e.indexGet="index#get",e.indexGetAll="index#getAll",e.indexGetAllKeys="index#getAllKeys",e.cursorNext="cursor#next",e.cursorValue="cursor#value",e.cursorUpdate="cursor#update",e.cursorDelete="cursor#delete",e.transactionCommit="transaction#commit",e.transactionRollback="transaction#rollback",e.databaseClose="database#close",e.databaseCreateTable="database#createTable",e.databaseDeleteTable="database#deleteTable",e.engineOpenDB="engine#openDB",e.engineDeleteDB="engine#deleteDB"}(_||(_={})),function(e){e[e.success=0]="success",e[e.fail=1]="fail"}(v||(v={}));var S=function(){function e(e,t){this.module=b.engine,this.actionExecuteState=0,this.status=0,this.time=new Date,this.action=e,this.cost=t}return e.prototype.markError=function(e){this.errorMsg=e.message,this.actionExecuteState=1,this.status=1},e}(),E=function(){function e(e,t){this.module=b.collection,this.status=0,this.actionExecuteState=0,this.write={count:0},this.read={count:0},this.delete={count:0},this.fail={count:0,reasons:[]},this.time=new Date,this.action=e,this.cost=t}return e.prototype.increment=function(e,t){void 0===t&&(t=1),this[e].count+=t},e.prototype.error=function(e){this.actionExecuteState=1,this.status=1,this.increment("fail"),this.fail.reasons.push(e.name)},e}(),x=Symbol("begin");function C(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e}var A=function(){function e(e){var t=this,n=void 0===e?{}:e,r=n.disabled,i=void 0!==r&&r,o=n.onEvent,a=n.onCollectionEvent,c=n.onEngineEvent;this.name="MonitorPlugin",this.begin=function(e){e.timings.set(x,new Date)},this.reportReadEvent=function(e,n){t.reportCollectionEvent(e,n,(function(r){return Object(d.__awaiter)(t,void 0,void 0,(function(){var t,i;return Object(d.__generator)(this,(function(o){switch(o.label){case 0:return e.return?[4,e.return]:[3,2];case 1:t=o.sent(),i="has"===n?!t:null===t,r.increment("read",i?0:1),o.label=2;case 2:return[2]}}))}))}))},this.reportBatchReadEvent=function(e,n){t.reportCollectionEvent(e,n,(function(n){return Object(d.__awaiter)(t,void 0,void 0,(function(){var t,r,i;return Object(d.__generator)(this,(function(o){switch(o.label){case 0:return e.return?(r=(t=n).increment,i=["read"],[4,e.return]):[3,2];case 1:r.apply(t,i.concat([o.sent().length])),o.label=2;case 2:return[2]}}))}))}))},this.reportWriteEvent=function(e,n){t.reportCollectionEvent(e,n,(function(n){return Object(d.__awaiter)(t,void 0,void 0,(function(){var t,r,i;return Object(d.__generator)(this,(function(o){switch(o.label){case 0:return e.return?(r=(t=n).increment,i=["write"],[4,e.return]):[3,2];case 1:r.apply(t,i.concat([null===o.sent()?0:1])),o.label=2;case 2:return[2]}}))}))}))},this.reportBatchWriteEvent=function(e,n){t.reportCollectionEvent(e,n,(function(n){return Object(d.__awaiter)(t,void 0,void 0,(function(){var t,r,i;return Object(d.__generator)(this,(function(o){switch(o.label){case 0:return e.return?(r=(t=n).increment,i=["write"],[4,e.return]):[3,2];case 1:r.apply(t,i.concat([o.sent().length])),o.label=2;case 2:return[2]}}))}))}))},this.reportDeleteEvent=function(e,n){t.reportCollectionEvent(e,n,(function(n){return Object(d.__awaiter)(t,void 0,void 0,(function(){var t,r,i;return Object(d.__generator)(this,(function(o){switch(o.label){case 0:return e.return?(r=(t=n).increment,i=["delete"],[4,e.return]):[3,2];case 1:r.apply(t,i.concat([null===o.sent()?0:1])),o.label=2;case 2:return[2]}}))}))}))},this.reportBatchDeleteEvent=function(e,n){t.reportCollectionEvent(e,n,(function(n){return Object(d.__awaiter)(t,void 0,void 0,(function(){var t,r,i;return Object(d.__generator)(this,(function(o){switch(o.label){case 0:return e.return?(r=(t=n).increment,i=["delete"],[4,e.return]):[3,2];case 1:r.apply(t,i.concat([o.sent().length])),o.label=2;case 2:return[2]}}))}))}))},this.disabled=i,this.onEvent=o,this.onCollectionEvent=a,this.onEngineEvent=c}return e.prototype.register=function(e){var t,n,r,i,o,a,c,s,u=this;if(!this.disabled){var l=e.aspects,p=l.collection,f=l.engine,h=function(e){p[e].before(b.begin).after((function(t){return u.reportReadEvent(t,e)}))},b=this;try{for(var v=Object(d.__values)(C("get","has","first","last")),y=v.next();!y.done;y=v.next()){h(y.value)}}catch(e){t={error:e}}finally{try{y&&!y.done&&(n=v.return)&&n.call(v)}finally{if(t)throw t.error}}var g=function(e){p[e].before(m.begin).after((function(t){return u.reportBatchReadEvent(t,e)}))},m=this;try{for(var O=Object(d.__values)(C("entries","keys","values","update")),j=O.next();!j.done;j=O.next()){g(j.value)}}catch(e){r={error:e}}finally{try{j&&!j.done&&(i=O.return)&&i.call(O)}finally{if(r)throw r.error}}var w=function(e){p[e].before(I.begin).after((function(t){return u.reportWriteEvent(t,e)}))},I=this;try{for(var S=Object(d.__values)(C("upsert","insert")),E=S.next();!E.done;E=S.next()){w(E.value)}}catch(e){o={error:e}}finally{try{E&&!E.done&&(a=S.return)&&a.call(S)}finally{if(o)throw o.error}}var x=function(e){p[e].before(A.begin).after((function(t){return u.reportBatchWriteEvent(t,e)}))},A=this;try{for(var k=Object(d.__values)(C("bulkUpsert","bulkInsert","update")),R=k.next();!R.done;R=k.next()){x(R.value)}}catch(e){c={error:e}}finally{try{R&&!R.done&&(s=k.return)&&s.call(k)}finally{if(c)throw c.error}}p.delete.before(this.begin).after((function(e){return u.reportDeleteEvent(e,"delete")})),p.clear.before(this.begin).after((function(e){return u.reportBatchDeleteEvent(e,"clear")})),f.openDB.before(this.begin).after((function(e){return u.reportEngineEvent(e,_.engineOpenDB)})),f.deleteDB.before(this.begin).after((function(e){return u.reportEngineEvent(e,_.engineDeleteDB)}));var D=f.database,T=f.table,N=f.transaction,M=f.index,P=f.cursor;D.close.before(this.begin).after((function(e){return u.reportEngineEvent(e,_.databaseClose)})),D.createTable.before(this.begin).after((function(e){return u.reportEngineEvent(e,_.databaseCreateTable)})),D.deleteTable.before(this.begin).after((function(e){return u.reportEngineEvent(e,_.databaseDeleteTable)})),T.get.before(this.begin).after((function(e){return u.reportEngineEvent(e,_.tableGet)})),T.getAll.before(this.begin).after((function(e){return u.reportEngineEvent(e,_.tableGetAll)})),T.getAllKeys.before(this.begin).after((function(e){return u.reportEngineEvent(e,_.tableGetAllKeys)})),T.insert.before(this.begin).after((function(e){return u.reportEngineEvent(e,_.tableInsert)})),T.upsert.before(this.begin).after((function(e){return u.reportEngineEvent(e,_.tableUpsert)})),T.delete.before(this.begin).after((function(e){return u.reportEngineEvent(e,_.tableDelete)})),T.clear.before(this.begin).after((function(e){return u.reportEngineEvent(e,_.tableClear)})),T.bulkDelete.before(this.begin).after((function(e){return u.reportEngineEvent(e,_.tableBulkDelete)})),T.bulkUpsert.before(this.begin).after((function(e){return u.reportEngineEvent(e,_.tableBulkUpsert)})),T.query.before(this.begin).after((function(e){return u.reportEngineEvent(e,_.tableQuery)})),T.createIndex.before(this.begin).after((function(e){return u.reportEngineEvent(e,_.tableCreateIndex)})),T.deleteIndex.before(this.begin).after((function(e){return u.reportEngineEvent(e,_.tableDeleteIndex)})),N.commit.before(this.begin).after((function(e){return u.reportEngineEvent(e,_.transactionCommit)})),N.rollback.before(this.begin).after((function(e){return u.reportEngineEvent(e,_.transactionRollback)})),M.get.before(this.begin).after((function(e){return u.reportEngineEvent(e,_.indexGet)})),M.getAll.before(this.begin).after((function(e){return u.reportEngineEvent(e,_.indexGetAll)})),M.getAllKeys.before(this.begin).after((function(e){return u.reportEngineEvent(e,_.indexGetAllKeys)})),P.delete.before(this.begin).after((function(e){return u.reportEngineEvent(e,_.cursorDelete)})),P.update.before(this.begin).after((function(e){return u.reportEngineEvent(e,_.cursorUpdate)})),P.next.before(this.begin).after((function(e){return u.reportEngineEvent(e,_.cursorNext)})),P.value.before(this.begin).after((function(e){return u.reportEngineEvent(e,_.cursorValue)}))}},e.prototype.dispose=function(e){throw new f.b({storage:e})},e.prototype.reportEngineEvent=function(e,t){var n,r,i=e.timings.get(x)||new Date,o=Date.now()-i.getTime(),a=new S(t,o);e.error&&a.markError(e.error),null===(n=this.onEvent)||void 0===n||n.call(this,a),null===(r=this.onEngineEvent)||void 0===r||r.call(this,a)},e.prototype.reportCollectionEvent=function(e,t,n){var r,i;return Object(d.__awaiter)(this,void 0,void 0,(function(){var o,a,c;return Object(d.__generator)(this,(function(s){switch(s.label){case 0:return o=e.timings.get(x)||new Date,a=Date.now()-o.getTime(),c=new E(t,a),e.error?(c.error(e.error),[3,3]):[3,1];case 1:return[4,n(c,e)];case 2:s.sent(),s.label=3;case 3:return null===(r=this.onEvent)||void 0===r||r.call(this,c),null===(i=this.onCollectionEvent)||void 0===i||i.call(this,c),[2]}}))}))},e}(),k=n("85d0a7609b"),R=n.n(k),D=n("9fb5ff8c6f"),T=function(){function e(e,t,n,r){var i,o=this;this.mode=e,this.proxyCursor=t,this.direction=n,this.engineAspects=r,this.delete=void 0,this.update=void 0,e!==p.i.READ_ONLY&&(this.delete=function(){return o.getProxyCursorWithMode().delete()},this.update=function(e){return o.getProxyCursorWithMode().update(e)}),(null===(i=this.engineAspects)||void 0===i?void 0:i.cursor)&&this.applyAspectPatch()}return e.prototype[Symbol.asyncIterator]=function(){return new N(this)},e.prototype.next=function(){return Object(d.__awaiter)(this,void 0,void 0,(function(){var e;return Object(d.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.proxyCursor.continue()];case 1:return(e=t.sent())?(this.proxyCursor=e,[2,this]):[2,null]}}))}))},e.prototype.value=function(){return this.proxyCursor.value},e.prototype.getProxyCursorWithMode=function(){return this.proxyCursor},e.prototype.applyAspectPatch=function(){var e,t=null===(e=this.engineAspects)||void 0===e?void 0:e.cursor;if(this.mode!==p.i.READ_ONLY){null==t||t.delete.patch(this,"delete"),null==t||t.update.patch(this,"update")}null==t||t.next.patch(this,"next"),null==t||t.value.patch(this,"value")},e}(),N=function(){function e(e){this.currentCursor=e}return e.prototype[Symbol.asyncIterator]=function(){return this},e.prototype.next=function(){return Object(d.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(d.__generator)(this,(function(n){switch(n.label){case 0:return this.currentCursor?(e=this.currentCursor.value(),t=this,[4,this.currentCursor.next()]):[2,{value:void 0,done:!0}];case 1:return t.currentCursor=n.sent(),[2,{value:e,done:!1}]}}))}))},e}(),M=function(){function e(e,t,n,r){this.table=e,this.proxyIndex=t,this.mode=n,this.engineAspects=r,this.name=t.name,this.keyPath=t.keyPath,this.unique=t.unique,(null==r?void 0:r.index)&&this.applyAspectPatch()}return e.prototype.getAll=function(e){return this.proxyIndex.getAll(e)},e.prototype.getAllKeys=function(e,t){return this.proxyIndex.getAllKeys(e,t)},e.prototype.get=function(e){return this.proxyIndex.get(e)},e.prototype.openCursor=function(e,t){return Object(d.__awaiter)(this,void 0,void 0,(function(){var n;return Object(d.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.proxyIndex.openCursor(e,t)];case 1:return(n=r.sent())?[2,new T(this.mode,n,null!=t?t:"next")]:[2,null]}}))}))},e.prototype.applyAspectPatch=function(){var e,t=null===(e=this.engineAspects)||void 0===e?void 0:e.index,n=this;null==t||t.get.patch(n,"get"),null==t||t.getAll.patch(n,"getAll"),null==t||t.getAllKeys.patch(n,"getAllKeys"),null==t||t.openCursor.patch(n,"openCursor")},e}(),P=function(){function e(e,t,n,r){this.mode=e,this.objectStore=t,this.engineAspects=n,this.transaction=r,this.createIndex=void 0,this.delete=void 0,this.bulkDelete=void 0,this.clear=void 0,this.insert=void 0,this.upsert=void 0,this.deleteIndex=void 0,this.bulkUpsert=void 0,this.keyPath=t.keyPath,this.autoIncrement=t.autoIncrement,this.tableName=t.name,this.indexNames=Object(d.__spreadArray)([],Object(d.__read)(t.indexNames)),this.initWriteFun(e),(null==n?void 0:n.table)&&this.applyAspectPatch()}return e.prototype.query=function(){throw new Error("query Method is not support for IDB.")},e.prototype.supports=function(e){return!["query","bulkDelete"].includes(e)},e.prototype.index=function(e){var t=this.objectStore.index(e);return new M(this,t,this.mode,this.engineAspects)},e.prototype.getAll=function(e){return this.objectStore.getAll(e)},e.prototype.getAllKeys=function(e,t){return this.objectStore.getAllKeys(e,t)},e.prototype.get=function(e){var t;return null!==(t=this.objectStore.get(e))&&void 0!==t?t:null},e.prototype.openCursor=function(e,t){return Object(d.__awaiter)(this,void 0,void 0,(function(){var n;return Object(d.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.objectStore.openCursor(e,t)];case 1:return(n=r.sent())?[2,new T(this.mode,n,null!=t?t:"next")]:[2,null]}}))}))},e.prototype.initWriteFun=function(e){var t=this;e===p.i.VERSION_CHANGE&&(this.createIndex=this.createIndexFun,this.deleteIndex=function(e){return t.getProxyObjectStoreWithMode().deleteIndex(e)}),e!==p.i.READ_ONLY&&(this.delete=function(e){return t.getProxyObjectStoreWithMode().delete(e)},this.bulkDelete=function(e){throw new Error("bulkDelete Method is not support for IDB.")},this.clear=function(){return t.getProxyObjectStoreWithMode().clear()},this.insert=function(e){return t.getProxyObjectStoreWithMode().add(e)},this.upsert=function(e){return t.getProxyObjectStoreWithMode().put(e)},this.bulkUpsert=function(e){var n=t.getProxyObjectStoreWithMode(),r=e.reduce((function(e,t){return e.push(n.put(t)),e}),[]);return Promise.all(r)})},e.prototype.createIndexFun=function(e,t,n){var r=this.getProxyObjectStoreWithMode();return new M(this,r.createIndex(e,t,n),this.mode)},e.prototype.getProxyObjectStoreWithMode=function(){return this.objectStore},e.prototype.applyAspectPatch=function(){var e,t=null===(e=this.engineAspects)||void 0===e?void 0:e.table;if(this.mode===p.i.READ_ONLY)return null==t||t.get.patch(this,"get"),null==t||t.getAll.patch(this,"getAll"),null==t||t.getAllKeys.patch(this,"getAllKeys"),null==t||t.index.patch(this,"index"),void(null==t||t.openCursor.patch(this,"openCursor"));this.mode===p.i.VERSION_CHANGE&&(null==t||t.createIndex.patch(this,"createIndex"),null==t||t.deleteIndex.patch(this,"deleteIndex")),null==t||t.delete.patch(this,"delete"),null==t||t.insert.patch(this,"insert"),null==t||t.upsert.patch(this,"upsert"),null==t||t.bulkUpsert.patch(this,"bulkUpsert"),null==t||t.clear.patch(this,"clear")},e}(),L=function(){function e(e,t){this.proxyTransaction=e,this.engineAspects=t,this.tables=e.objectStoreNames,this.mode=e.mode,(null==t?void 0:t.transaction)&&this.applyAspectPatch()}return e.prototype.table=function(e){var t=this.proxyTransaction.objectStore(e);return new P(this.mode,t,this.engineAspects,this)},e.prototype.commit=function(){return Object(d.__awaiter)(this,void 0,void 0,(function(){return Object(d.__generator)(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.proxyTransaction.done];case 1:return e.sent(),[3,3];case 2:return e.sent(),[2,!1];case 3:return[2,!0]}}))}))},e.prototype.rollback=function(){return Object(d.__awaiter)(this,void 0,void 0,(function(){return Object(d.__generator)(this,(function(e){switch(e.label){case 0:return e.trys.push([0,1,,6]),this.proxyTransaction.abort(),[3,6];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,4,,5]),[4,this.proxyTransaction.done];case 3:return e.sent(),[3,5];case 4:return e.sent(),[2,!0];case 5:return[2,!1];case 6:return[2,!0]}}))}))},e.prototype.applyAspectPatch=function(){var e,t=null===(e=this.engineAspects)||void 0===e?void 0:e.transaction,n=this;null==t||t.commit.patch(n,"commit"),null==t||t.rollback.patch(n,"rollback"),null==t||t.table.patch(n,"table")},e}(),U=function(){function e(e,t){this.idbDatabase=e,this.engineAspect=t,this.name=e.name,this.version=e.version,this.tableNames=Object(d.__spreadArray)([],Object(d.__read)(e.objectStoreNames)),this.engineAspect&&this.applyAspectPatch()}return e.prototype.setVersionChangeListener=function(e){this.idbDatabase.addEventListener("versionchange",(function(t){e(t.oldVersion,t.newVersion)}))},e.prototype.close=function(){this.idbDatabase.close()},e.prototype.createTable=function(e,t){var n=this.idbDatabase.createObjectStore(e,t);return new P(p.i.VERSION_CHANGE,n)},e.prototype.deleteTable=function(e){this.idbDatabase.deleteObjectStore(e)},e.prototype.transaction=function(e,t){return Object(d.__awaiter)(this,void 0,void 0,(function(){var n;return Object(d.__generator)(this,(function(r){return n=this.idbDatabase.transaction(e,t),[2,new L(n,this.engineAspect)]}))}))},e.prototype.table=function(e,t){return Object(d.__awaiter)(this,void 0,void 0,(function(){var n,r,i;return Object(d.__generator)(this,(function(o){return n=this.idbDatabase.transaction([e],t),r=new L(n),i=n.objectStore(e),[2,new P(t,i,this.engineAspect,r)]}))}))},e.prototype.applyAspectPatch=function(){var e,t=null===(e=this.engineAspect)||void 0===e?void 0:e.database;null==t||t.deleteTable.patch(this,"deleteTable"),null==t||t.createTable.patch(this,"createTable"),null==t||t.transaction.patch(this,"transaction"),null==t||t.table.patch(this,"table"),null==t||t.close.patch(this,"close")},e}();var B,q=function(e,t){var n=typeof e,r=typeof t;if(isNaN(e)||isNaN(t))return indexedDB.cmp(e,t);if(n===r){if("number"===n||"bigint"===n)return e-t;if("string"===n)return function(e,t){return e<t?-1:+(e>t)}(e,t)}return e instanceof Date&&t instanceof Date?e.getTime()-t.getTime():indexedDB.cmp(e,t)},F=f.a.withDefaultMessage("IndexedDB is missing in global context. Consider using `indexeddbshim` for better compatibility or `fake-indexeddb` in your test environment."),V=function(){function e(){if("undefined"==typeof indexedDB)throw new F;this.cmp=q}return e.prototype.deleteDB=function(e){return Object(d.__awaiter)(this,void 0,void 0,(function(){return Object(d.__generator)(this,(function(t){return[2,D.a(e)]}))}))},e.prototype.setAspects=function(e){this.engineAspects=e,this.engineAspects.openDB.patch(this,"openDB"),this.engineAspects.deleteDB.patch(this,"deleteDB")},e.prototype.openDB=function(e,t,n,r){return Object(d.__awaiter)(this,void 0,void 0,(function(){var t,i=this;return Object(d.__generator)(this,(function(o){switch(o.label){case 0:return[4,D.b(e,n,{upgrade:function(e,t,n,o){var a;null===(a=null==r?void 0:r.upgrade)||void 0===a||a.call(r,new U(e,i.engineAspects),t,n,new L(o))},blocked:function(){var e;return null===(e=null==r?void 0:r.blocked)||void 0===e?void 0:e.call(r)},blocking:function(){var e;return null===(e=null==r?void 0:r.blocking)||void 0===e?void 0:e.call(r)},terminated:function(){var e;return null===(e=null==r?void 0:r.terminated)||void 0===e?void 0:e.call(r)}})];case 1:return t=o.sent(),[2,new U(t,this.engineAspects)]}}))}))},e}(),G=n("cc55475c1f"),W=(n("56683198d5"),n("73b854064b"),n("bd29e2df90")),K=n.n(W),H=n("ab5eb40518"),Q=n.n(H),z=n("1b4cdd6a36"),Y=n.n(z);n("3bf1976a4f"),n("8e7cce0ada"),n("2a6f332b5e"),n("ef3480511c"),n("826dc923b3"),n("ef51bf4fed"),n("af802ec74b"),n("6e20b6a7d8");var J;!function(e){e[e.indexDB=1]="indexDB",e[e.nativeDB=2]="nativeDB"}(J||(J={}));var X=(B={},R()(B,J.indexDB,V),R()(B,J.nativeDB,G.a),B),$=function(){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{type:J.indexDB,disableAutoOpen:!0};o()(this,e),this.config=n;var r=X[n.type];this.storage=new h.c({name:null!==(t=n.databaseName)&&void 0!==t?t:l.DB_NAME,version:5,engine:new r,databaseSchema:'{"name":"unknown","collections":[{"name":"DocumentData","key":{"path":"key"},"indices":[{"name":"secretId","path":"secretId","unique":false},{"name":"globalPadId","path":"globalPadId","unique":false},{"name":"subGlobalPadId","path":"subGlobalPadId","unique":false},{"name":"subDocType","path":"subDocType","unique":false},{"name":"version","path":"version","unique":false},{"name":"type","path":"type","unique":false},{"name":"uid","path":"uid","unique":false},{"name":"subId","path":"subSheetId","unique":false},{"name":"chunkId","path":"chunkId","unique":false}],"properties":["key","secretId","globalPadId","subGlobalPadId","subDocType","version","type","uid","subId","chunkId","taskId","data","docType","docStatus","createTimestamp","lastModifyTimestamp","dataVersion","isDefaultChunk"]},{"name":"DocumentEntities","key":{"path":"key"},"indices":[],"properties":["key","data"]},{"name":"NewDocumentIds","key":{"path":"globalPadId"},"indices":[],"properties":["globalPadId","secretId","documentType","localPadId","isCreated"]},{"name":"DocumentStatus","key":{"path":"globalPadId"},"indices":[{"name":"secretId","path":"secretId","unique":false},{"name":"uid","path":"uid","unique":false}],"properties":["globalPadId","secretId","uid","lastSyncTimestamp","lastErrorTimestamp"]},{"name":"DriveData","key":{"path":"driveId"},"indices":[{"name":"fileId","path":"fileId","unique":false},{"name":"objKey","path":"objKey","unique":false},{"name":"secretId","path":"secretId","unique":false},{"name":"uid","path":"uid","unique":false}],"properties":["driveId","fileId","objKey","secretId","uid","type","lastRequestTime","fileInfo","previewInfo"]},{"name":"OfflineData","key":{"path":"key"},"indices":[{"name":"secretId","path":"secretId","unique":false},{"name":"globalPadId","path":"globalPadId","unique":false},{"name":"subGlobalPadId","path":"subGlobalPadId","unique":false},{"name":"subDocType","path":"subDocType","unique":false},{"name":"version","path":"version","unique":false},{"name":"type","path":"type","unique":false},{"name":"uid","path":"uid","unique":false},{"name":"subId","path":"subSheetId","unique":false},{"name":"chunkId","path":"chunkId","unique":false}],"properties":["key","secretId","globalPadId","subGlobalPadId","subDocType","version","type","uid","subId","chunkId","taskId","data","docType","docStatus","createTimestamp","lastModifyTimestamp","dataVersion","isDefaultChunk"]},{"name":"PadInfo","key":{"path":"key"},"indices":[{"name":"secretId","path":"secretId","unique":false},{"name":"globalPadId","path":"globalPadId","unique":false},{"name":"uid","path":"uid","unique":false}],"properties":["key","secretId","globalPadId","uid","addListTimestamp","attribute","childrenLength","clientVersion","createTimestamp","creator","creatorDomain","icon","docPolicy","docPrivilege","thumbnail","docType","docTypeDesc","url","domainId","dver","folder","folderId","folderPolicy","folderPrivilege","isDeleted","isManualOffline","isMyCreated","isMydoc","isOfflineCache","isRencent","isShareToMe","hasSnapShot","isStar","isAddedToMy","isCollected","isOwner","isPinned","isShortcut","isUserChangeTitle","lastSyncTimestamp","lastBrowseTimestamp","lastCollectTimestamp","lastDeleteTimestamp","lastModifyTimestamp","lastModifyNick","lastModifyUid","lastPinnedTimestamp","listInfoType","listType","offlineCommiting","offlineCommitSuccessd","originFolderId","ownerNick","ownerUid","padId","parentFolderId","parents","privilege","status","title","type","hasLocalChanges","docSubType","officialAuthInfo","personalizeInfo","nativeEngineStatusRecord","nativeEngineDocPrivilege","data","ext","isOfflineCacheByNative","mimeType","ownerVipInfo","documentResourceCacheStatus","cacheStatus","cacheStatusTs"]},{"name":"Users","key":{"path":"key"},"indices":[{"name":"tinyId","path":"tinyId","unique":false},{"name":"nowUserIndex","path":"nowUserIndex","unique":false},{"name":"docId","path":"docId","unique":false},{"name":"pageType","path":"pageType","unique":false},{"name":"wedriveUin","path":"wedriveUin","unique":false},{"name":"wedocOpenId","path":"wedocOpenId","unique":false}],"properties":["key","tinyId","nowUserIndex","docId","pageType","wedriveUin","wedocOpenId","corpId","corpName","englishName","loginType","openId","uidSource","uin","userId","userName","userPic","updateTime","settings","bindUserInfo","vipUserInfo"]}]}',disableAutoOpen:n.disableAutoOpen,plugins:this.getPlugins(n),supportCompatibleOpen:!0})}return c()(e,[{key:"dispose",value:function(){this.storage.close()}},{key:"init",value:function(){return Object(d.__awaiter)(this,void 0,void 0,u.a.mark((function e(){var t=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var n,r=setTimeout((function(){var n,r;null===(r=null===(n=t.config.logger)||void 0===n?void 0:n.error)||void 0===r||r.call(n,"dababase init timeout."),e(!1)}),null!==(n=t.config.timeout)&&void 0!==n?n:15e3);t.storage.open().then((function(){e(!0),clearTimeout(r)})).catch((function(){e(!1),clearTimeout(r)}))})));case 1:case"end":return e.stop()}}),e)})))}},{key:"getPlugins",value:function(e){var t,n=[];if(e.logger){var r=new I({logger:e.logger,disabled:!!e.disabled,verbose:!!e.verbose});n.push(r)}return e.monitorReporter&&n.push((t=e.monitorReporter,new A({onEvent:function(e){t.report("storageActionResultAndCost",{action:e.action,module:e.module,retCode:e.actionExecuteState,cost:e.cost,time:e.time.getTime(),errorMsg:e.errorMsg})}}))),n}}]),e}();function Z(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Y()(e);if(t){var i=Y()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Q()(this,n)}}var ee="TencentDocsBackup",te=function(e){K()(n,e);var t=Z(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{type:J.indexDB,disableAutoOpen:!0};return o()(this,n),(e=t.call(this,r)).config=r,e}return c()(n)}($);function ne(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Y()(e);if(t){var i=Y()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Q()(this,n)}}var re=function(){function e(t){o()(this,e),this.collection=t}return c()(e,[{key:"getChanges",value:function(e,t){return Object(d.__awaiter)(this,void 0,void 0,u.a.mark((function n(){var r;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=this.collection.where({uid:e.uid,secretId:e.secretId,subGlobalPadId:e.subGlobalPadId,subDocType:{in:e.subDocType},type:{in:e.types},docType:e.docType,dataVersion:e.dataVersion,subId:{in:e.subId?(new Array).concat(e.subId):void 0},chunkId:{in:e.chunkId?(new Array).concat(e.chunkId):void 0},version:{">=":null==t?void 0:t.startVersion,"<=":null==t?void 0:t.endVersion}}),(null==t?void 0:t.orderPath)&&r.orderBy(t.orderPath,t.sortOrder),(null==t?void 0:t.limit)&&r.take(t.limit),n.abrupt("return",r.values());case 4:case"end":return n.stop()}}),n,this)})))}},{key:"upsertChanges",value:function(e){return Object(d.__awaiter)(this,void 0,void 0,u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.collection.bulkUpsert(e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"deleteChanges",value:function(e){return Object(d.__awaiter)(this,void 0,void 0,u.a.mark((function t(){var n,r,i,o,a,c,s;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.uid,r=e.secretId,i=e.globalPadId,o=e.types,a=e.taskIds,c=e.subGlobalPadId,s=e.subDocType,t.next=3,this.collection.where({uid:n,secretId:r,globalPadId:i,subGlobalPadId:c,subDocType:{in:s},type:{in:o},taskId:{in:a},version:{">":e.startVersion||Number.MIN_SAFE_INTEGER,"<":e.endVersion||Number.MAX_SAFE_INTEGER}}).clear();case 3:case"end":return t.stop()}}),t,this)})))}}]),e}(),ie=function(e){K()(n,e);var t=ne(n);function n(){return o()(this,n),t.apply(this,arguments)}return c()(n)}(re),oe=function(e){K()(n,e);var t=ne(n);function n(){return o()(this,n),t.apply(this,arguments)}return c()(n)}(re),ae=function(){function e(t){o()(this,e),this.collection=t}return c()(e,[{key:"popDocumentId",value:function(e){return Object(d.__awaiter)(this,void 0,void 0,u.a.mark((function t(){var n,r,i;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.collection.where({documentType:e}).first();case 2:if(n=t.sent){t.next=5;break}return t.abrupt("return",null);case 5:return r=n.globalPadId,t.next=8,this.collection.delete(r);case 8:if(i=t.sent,r===i){t.next=11;break}return t.abrupt("return",null);case 11:return t.abrupt("return",n);case 12:case"end":return t.stop()}}),t,this)})))}},{key:"upsertDocumentIds",value:function(e){return Object(d.__awaiter)(this,void 0,void 0,u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.collection.bulkUpsert(e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"countDocumentIds",value:function(e){return Object(d.__awaiter)(this,void 0,void 0,u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.collection.where({documentType:e}).count());case 1:case"end":return t.stop()}}),t,this)})))}},{key:"deleteDocumentIds",value:function(){return Object(d.__awaiter)(this,void 0,void 0,u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.collection.clear();case 2:case"end":return e.stop()}}),e,this)})))}}]),e}(),ce=function(){function e(t){o()(this,e),this.collection=t}return c()(e,[{key:"getStatus",value:function(e,t){return Object(d.__awaiter)(this,void 0,void 0,u.a.mark((function n(){var r;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.collection.where({secretId:t,uid:e}).first();case 2:return r=n.sent,n.abrupt("return",r);case 4:case"end":return n.stop()}}),n,this)})))}},{key:"upsertStatus",value:function(e){return Object(d.__awaiter)(this,void 0,void 0,u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.collection.upsert(e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"deleteStatus",value:function(e,t){return Object(d.__awaiter)(this,void 0,void 0,u.a.mark((function n(){return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.collection.where({secretId:t,uid:e}).clear();case 2:case"end":return n.stop()}}),n,this)})))}}]),e}(),se=function(){function e(t){o()(this,e),this.collection=t}return c()(e,[{key:"getEntity",value:function(e){return Object(d.__awaiter)(this,void 0,void 0,u.a.mark((function t(){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.collection.get(e);case 2:return n=t.sent,t.abrupt("return",n);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"upsertEntities",value:function(e){return Object(d.__awaiter)(this,void 0,void 0,u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.collection.bulkUpsert(e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"deleteEntity",value:function(e){return Object(d.__awaiter)(this,void 0,void 0,u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.collection.delete(e);case 2:case"end":return t.stop()}}),t,this)})))}}]),e}(),ue=function(){function e(t){o()(this,e),this.collection=t}return c()(e,[{key:"getPadInfo",value:function(e,t){return Object(d.__awaiter)(this,void 0,void 0,u.a.mark((function n(){var r;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.getPadInfos({uid:e,secretId:t});case 2:if(0!==(r=n.sent).length){n.next=5;break}return n.abrupt("return",null);case 5:return n.abrupt("return",r.shift());case 6:case"end":return n.stop()}}),n,this)})))}},{key:"getPadInfos",value:function(e){return Object(d.__awaiter)(this,void 0,void 0,u.a.mark((function t(){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.collection.where({uid:e.uid,secretId:{in:e.secretId?(new Array).concat(e.secretId):void 0}}),t.abrupt("return",n.values());case 2:case"end":return t.stop()}}),t,this)})))}},{key:"upsertPadInfo",value:function(e){return Object(d.__awaiter)(this,void 0,void 0,u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.collection.upsert(e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"updateField",value:function(e,t,n){return Object(d.__awaiter)(this,void 0,void 0,u.a.mark((function r(){var i;return u.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.collection.where({uid:e,secretId:t}).first();case 2:if(i=r.sent){r.next=5;break}return r.abrupt("return");case 5:return Object.assign(i,n),r.next=8,this.collection.upsert(i);case 8:case"end":return r.stop()}}),r,this)})))}},{key:"deletePadInfo",value:function(e,t){return Object(d.__awaiter)(this,void 0,void 0,u.a.mark((function n(){return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.collection.where({uid:e,secretId:t}).clear();case 2:case"end":return n.stop()}}),n,this)})))}}]),e}(),de=function(){function e(t){o()(this,e),this.collection=t}return c()(e,[{key:"getUserInfoByTinyId",value:function(e){return Object(d.__awaiter)(this,void 0,void 0,u.a.mark((function t(){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.collection.where({tinyId:e}).last();case 2:if(!(n=t.sent)){t.next=5;break}return t.abrupt("return",n);case 5:return t.abrupt("return",null);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"getUserInfoByNowUserIndex",value:function(e){return Object(d.__awaiter)(this,void 0,void 0,u.a.mark((function t(){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.collection.where({nowUserIndex:e}).last();case 2:if(!(n=t.sent)){t.next=5;break}return t.abrupt("return",n);case 5:return t.abrupt("return",this.getUserInfoLastByAll());case 6:case"end":return t.stop()}}),t,this)})))}},{key:"getUserInfoByDocInfo",value:function(e,t){return Object(d.__awaiter)(this,void 0,void 0,u.a.mark((function n(){var r;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.collection.where({pageType:e,docId:t}).last();case 2:if(!(r=n.sent)){n.next=5;break}return n.abrupt("return",r);case 5:return n.abrupt("return",this.getUserInfoLastByAll());case 6:case"end":return n.stop()}}),n,this)})))}},{key:"addUserInfo",value:function(e){return Object(d.__awaiter)(this,void 0,void 0,u.a.mark((function t(){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.collection.get(e.key);case 3:return n=t.sent,this.collection.upsert(Object.assign(Object.assign({},n),e)),t.abrupt("return",!0);case 8:return t.prev=8,t.t0=t.catch(0),t.abrupt("return",!1);case 11:case"end":return t.stop()}}),t,this,[[0,8]])})))}},{key:"updateUserInfo",value:function(e,t){return Object(d.__awaiter)(this,void 0,void 0,u.a.mark((function n(){var r,i;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,this.collection.where(e).values();case 3:if(0!==(r=n.sent).length){n.next=6;break}return n.abrupt("return",!1);case 6:return i=r.map((function(e){return Object.assign(Object.assign({},e),t)})),n.next=9,this.collection.bulkUpsert(i);case 9:return n.abrupt("return",!0);case 12:return n.prev=12,n.t0=n.catch(0),n.abrupt("return",!1);case 15:case"end":return n.stop()}}),n,this,[[0,12]])})))}},{key:"getUserInfoLastByAll",value:function(){return Object(d.__awaiter)(this,void 0,void 0,u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.collection.last();case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})))}}]),e}(),le=function(){function e(t){o()(this,e),this.collection=t}return c()(e,[{key:"getDriveData",value:function(e){return Object(d.__awaiter)(this,void 0,void 0,u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.collection.where(Object.assign({},e)).first());case 1:case"end":return t.stop()}}),t,this)})))}},{key:"getDriveDatas",value:function(e){return Object(d.__awaiter)(this,void 0,void 0,u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.collection.where(Object.assign({},e)).values());case 1:case"end":return t.stop()}}),t,this)})))}},{key:"insertDriveDatas",value:function(e){return Object(d.__awaiter)(this,void 0,void 0,u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.collection.bulkUpsert(e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"deleteDriveDatas",value:function(e){return Object(d.__awaiter)(this,void 0,void 0,u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.collection.where(Object.assign({},e)).clear();case 2:case"end":return t.stop()}}),t,this)})))}}]),e}()},"729f9b497f":function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e[e.docStatusNormal=0]="docStatusNormal",e[e.docStatusDelete=1]="docStatusDelete",e[e.docStatusTrash=2]="docStatusTrash",e[e.docStatusHidden=3]="docStatusHidden",e[e.docStatusTrans=4]="docStatusTrans",e[e.docStatusImport=5]="docStatusImport",e[e.docStatusChecking=6]="docStatusChecking",e[e.docStatusForbidden=7]="docStatusForbidden",e[e.docStatusImportFailed=8]="docStatusImportFailed",e[e.docStatusCopy=9]="docStatusCopy",e[e.docStatusCopyFailed=10]="docStatusCopyFailed",e[e.docStatusPrepare=11]="docStatusPrepare",e[e.docStatusHiddenUntilModify=12]="docStatusHiddenUntilModify",e[e.docStatusFileUploading=13]="docStatusFileUploading"}(r||(r={}))},"744ee0b6cd":function(e,t,n){"use strict";e.exports={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1}},"754d878ec7":function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e.BINDING="BINDING",e.UNBIND="UNBIND"}(r||(r={}))},"76702c352f":function(e,t,n){"use strict";n.d(t,"c",(function(){return d})),n.d(t,"k",(function(){return l})),n.d(t,"h",(function(){return p})),n.d(t,"d",(function(){return h})),n.d(t,"a",(function(){return b})),n.d(t,"i",(function(){return _})),n.d(t,"f",(function(){return v})),n.d(t,"g",(function(){return y})),n.d(t,"b",(function(){return g})),n.d(t,"e",(function(){return m})),n.d(t,"j",(function(){return O})),n.d(t,"l",(function(){return j})),n.d(t,"m",(function(){return w}));var r=n("d7c625d1f2"),i=n("61cea32eb2"),o=n("624cdb524f"),a=n("ddb86d0a26"),c=n("4b146817ca"),s=n("5be39fbf8a"),u=new a.a("domain").use("console");function d(){return function(e,t,n){var i=n.value;n.value=function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return Object(r.__awaiter)(this,void 0,void 0,(function(){var o,a,s,d;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,i.apply(this,n)];case 1:return o=r.sent().data,a={data:o,retcode:Object(c.b)(o),msg:Object(c.a)(o),cgicode:null!==(d=o.cgicode)&&void 0!==d?d:0},delete o.msg,delete o.message,delete o.retmsg,delete o.retcode,delete o.code,delete o.cgicode,delete o.ret,[2,{resData:a}];case 2:return s=r.sent(),u.error("".concat(e.constructor.name,"|").concat(t,"|").concat(s)),[2,{error:s,resData:{}}];case 3:return[2]}}))}))}}}function l(){return function(e,t,n){var i=n.value;n.value=function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return Object(r.__awaiter)(this,void 0,void 0,(function(){var o;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,i.apply(this,n)];case 1:return[2,{data:r.sent().data}];case 2:return o=r.sent(),u.error("".concat(e.constructor.name,"|").concat(t,"|").concat(o)),[2,{error:o,data:{}}];case 3:return[2]}}))}))}}}function p(e,t){return function(n,i,o){u.debug("praseHeaderKey2DataHandler|".concat(n.constructor.name,"|").concat(i,"|").concat(e));var a=o.value;o.value=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return Object(r.__awaiter)(this,void 0,void 0,(function(){var i,o,c;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,a.apply(this,n)];case 1:return i=r.sent(),o=i.data,c=i.headers,o&&c&&c[e]&&(o[t]=c[e]),[2,i]}}))}))}}}function f(e,t){return e.prototype instanceof i.a?Reflect.construct(e,[t]):Reflect.construct(e,["mainEntity"]).initWithJsonObj(t)}function h(e,t){return function(n,i,o){u.debug("fireEvent|".concat(n.constructor.name,"|").concat(i));var a=o.value;o.value=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return Object(r.__awaiter)(this,void 0,void 0,(function(){var i,o;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,a.apply(this,n)];case 1:return(i=r.sent()).resData&&Object(s.k)(i.resData)&&((o={})[t]=this[t],this[e].fire(o)),[2,i]}}))}))}}}function b(){return function(e,t,n){u.debug("changeSuperVipData|".concat(e.constructor.name,"|").concat(t));var i=n.value;n.value=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n,o,a,c,s;return Object(r.__generator)(this,(function(u){switch(u.label){case 0:return[4,i.apply(this,e)];case 1:return(t=u.sent()).error?[2,t]:((n=null!==(s=null===(c=null===(a=t.resData)||void 0===a?void 0:a.data)||void 0===c?void 0:c.vip_info)&&void 0!==s?s:{}).super_vip=null==n?void 0:n.super,(o=Object(r.__assign)({},t.resData)).data.vip_info=n,[2,{resData:o}])}}))}))}}}function _(e,t){return function(n,o,a){u.debug("parseObjectData|".concat(n.constructor.name,"|").concat(o));var c=a.value;a.value=function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return Object(r.__awaiter)(this,void 0,void 0,(function(){var o;return Object(r.__generator)(this,(function(a){switch(a.label){case 0:return[4,c.apply(this,n)];case 1:return(o=a.sent()).error?[2,o]:(this.aggregateVersion=this.aggregateVersion+1,e.prototype instanceof i.a?this[t]=f(e,o.resData.data):this[t].initWithJsonObj(o.resData.data),[2,{resData:Object(r.__assign)(Object(r.__assign)({},o.resData),{data:this[t]})}])}}))}))}}}function v(e,t,n){return function(i,o,a){u.debug("parseArrayData|".concat(i.constructor.name,"|").concat(o));var c=a.value;a.value=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return Object(r.__awaiter)(this,void 0,void 0,(function(){var o,a=this;return Object(r.__generator)(this,(function(s){switch(s.label){case 0:return[4,c.apply(this,i)];case 1:return(o=s.sent()).error?[2,o]:(this.aggregateVersion=this.aggregateVersion+1,(o.resData.data[n]||[]).forEach((function(n){a[t].push(f(e,n))})),[2,{resData:Object(r.__assign)(Object(r.__assign)({},o.resData),{data:this[t]})}])}}))}))}}}function y(e,t,n,i){return function(o,a,c){u.debug("parseArrayDataInObject|".concat(o.constructor.name,"|").concat(a));var s=c.value;c.value=function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];return Object(r.__awaiter)(this,void 0,void 0,(function(){var a,c,u,d=this;return Object(r.__generator)(this,(function(l){switch(l.label){case 0:return[4,s.apply(this,o)];case 1:return(a=l.sent()).error?[2,a]:(this.aggregateVersion=this.aggregateVersion+1,null==(c=(null===(u=a.resData.data[n])||void 0===u?void 0:u[i])||[])||c.forEach((function(n){d[t].push(f(e,n))})),[2,{resData:Object(r.__assign)(Object(r.__assign)({},a.resData),{data:this[t]})}])}}))}))}}}function g(){return function(e,t,n){u.debug("dataFieldNamingHandler|".concat(e.constructor.name,"|").concat(t));var i=n.value;n.value=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,i.apply(this,e)];case 1:return t=r.sent(),(null===(n=t.resData)||void 0===n?void 0:n.data)&&(t.resData.data=Object(o.a)(t.resData.data)),[2,t]}}))}))}}}function m(){return function(e,t,n){u.debug("paramsFieldNamingHandler|".concat(e.constructor.name,"|").concat(t));var i=n.value;n.value=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return e.length?[3,2]:[4,i.apply(this,[])];case 1:case 3:return[2,n.sent()];case 2:return t=[Object(o.d)(e[0])],[4,i.apply(this,t)]}}))}))}}}function O(){return function(e,t,n){u.debug("parseResBody|".concat(e.constructor.name,"|").concat(t));var i=n.value;n.value=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return[4,i.apply(this,e)];case 1:return(t=n.sent()).error?[2,t]:[2,{resData:Object(r.__assign)(Object(r.__assign)({},t.resData),{data:Object(r.__assign)({},t.resData.data.body)})}]}}))}))}}}function j(e){return function(t,n,i){u.debug("parseResBody|".concat(t.constructor.name,"|").concat(n));var o=i.value;i.value=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Object(r.__awaiter)(this,void 0,void 0,(function(){var n;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,o.apply(this,t)];case 1:return(n=r.sent()).error||this[e](t),[2,n]}}))}))}}}function w(e){return function(t,n,r){u.debug("parseResBody|".concat(t.constructor.name,"|").concat(n));var i=r.value;return r.value=function(){for(var r,o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];try{r=i.apply(this,o)}catch(i){u.error("tryCatchHandler caught error from ".concat(t.constructor.name,"|").concat(n,". Error detail: ").concat(i)),r=e}return r||void 0},r}}u.level="OFF"},"7785f226c3":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("cedf7830be"),i=Object(r.a)("INotifyScopeDomainService")},"7f96884de1":function(e,t,n){"use strict";n.d(t,"a",(function(){return E}));var r=n("d7c625d1f2"),i=n("1add19ffb1"),o=n("76702c352f"),a=n("5be39fbf8a");function c(e){return e.includes(".")?e.split(".")[1]:e}function s(e){return!!e&&!!e.startsWith("p.")}var u=n("fb1099018f"),d="".concat(u.h,"/sdc/getusermarkname"),l="".concat(u.h,"/api/personalize/anonymous/set"),p="".concat(u.h,"/api/personalize/anonymous/vip/get"),f=n("536530eec5"),h=n("b512c0eccb"),b=n("a6ef31917d"),_=function(){function e(e){this.docMetaDomain=e}return e.prototype.getUserMarkName=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n,i,o;return Object(r.__generator)(this,(function(c){return n=this.getFormattedUidsString(e),i=Object(r.__assign)(Object(r.__assign)({},t),{localPadId:this.docMetaDomain.docMetaEntity.padInfo.padId,domainId:this.docMetaDomain.docMetaEntity.padInfo.domainId,uids:n}),o={xsrf:Object(a.j)()},[2,h.networkRequest.post(d,i,{params:o})]}))}))},e.prototype.setPersonalizeAnonymous=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n,i;return Object(r.__generator)(this,(function(r){return n={status:e,file_id:t||this.docMetaDomain.docMetaEntity.padInfo.padId},i={xsrf:Object(a.j)()},[2,h.networkRequest.post(l,n,{params:i})]}))}))},e.prototype.getPersonalizeAnonymous=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(r.__generator)(this,(function(r){return t={file_id:e||this.docMetaDomain.docMetaEntity.padInfo.padId},n={xsrf:Object(a.j)()},[2,h.networkRequest.post(p,t,{params:n})]}))}))},e.prototype.getFormattedUidsString=function(e){return Object(b.isArray)(e)?"[".concat(e.toString(),"]"):"[".concat(e,"]")},e=Object(r.__decorate)([Object(r.__param)(0,f.a),Object(r.__metadata)("design:paramtypes",[Object])],e)}(),v=n("9431135ba7"),y=n("61cea32eb2"),g=n("10f9b6de11"),m=function(e){function t(t){var n=e.call(this)||this;return n.userType=1,n.vipInfo=new v.a({}),n.sessionType=0,n.uuid="",n.status="",n.colorId="",n.corpName="",n.userPic="",n.markName="",n.uin="",n.userId="",n.uidSource=g.ACCOUNT_TYPE.UNKNOWN,n.jsonObj2Class(t),n}return Object(r.__extends)(t,e),t}(y.a),O=n("3c9d61c2e2"),j=n("9ab1857893"),w=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.docMetaDomain=n,i.userInfoDomain=r,i.collaborateList=[],i.currentMemCount=0,i.collabAllInfoList=[],i.throttleInterval=0,i.maxCollabListLengthLimit=999,i.collabRecordList=[],i.collaboratesCacheMap=new Map,i.onCollabAllInfoListUpdatedEmitter=new j.Emitter,i.onUserComeInEmitter=new j.Emitter,i.onUserLeaveEmitter=new j.Emitter,i.onCommercializeMessageEmitter=new j.Emitter,i.needRequestUserIds=new Set,i.onCollabAllInfoListUpdated=i.onCollabAllInfoListUpdatedEmitter.event,i.onUserComeIn=i.onUserComeInEmitter.event,i.onUserLeave=i.onUserLeaveEmitter.event,i.onCommercializeMessage=i.onCommercializeMessageEmitter.event,i.collaborateRepository=new _(n),i}var n;return Object(r.__extends)(t,e),n=t,t.prototype.handleUserComeIn=function(e){var t,n=this;null===(t=e.notices)||void 0===t||t.forEach((function(e){n.appendNoticeTo(e)})),this.currentMemCount=this.collaborateList.length,this.onUserComeInEmitter.fire(e),this.processUserEnter(e)},t.prototype.handleUserLeave=function(e){var t,n=this;null===(t=e.notices)||void 0===t||t.forEach((function(e){n.collaborateList=n.collaborateList.filter((function(t){return t.userId!==e.userId}))})),this.currentMemCount=this.collaborateList.length,this.onUserLeaveEmitter.fire(e),this.processUserLeave(e)},t.prototype.getUserMarkName=function(e){return Object(r.__awaiter)(this,arguments,void 0,(function(e,t,n){var i,o,a,c,u,d,l,p,f;return void 0===t&&(t=!1),Object(r.__generator)(this,(function(r){switch(r.label){case 0:return t?[4,this.collaborateRepository.getUserMarkName(e,n)]:[3,2];case 1:return i=r.sent(),this.setUserMarkItemToCache(i),[2,i];case 2:return o=this.getUserMarkItemFromCache(e),a=o.unCachedUserIds,c=o.cachedResults,0===a.length?[2,{data:{cgicode:0,retcode:0,result:{rsp:c}},status:200,statusText:""}]:s(this.userInfoDomain.userInfoAggregate.userInfo.userId)?[4,this.collaborateRepository.getUserMarkName(a,n)]:[2,{data:{cgicode:0,retcode:0,result:{rsp:[]}},status:200,statusText:""}];case 3:return u=r.sent(),this.setUserMarkItemToCache(u),(null===(f=null===(p=null==u?void 0:u.data)||void 0===p?void 0:p.result)||void 0===f?void 0:f.rsp)&&(d=u.data.result.rsp,l=void 0===d?[]:d,u.data.result.rsp=l.concat(c)),[2,u]}}))}))},t.prototype.setPersonalizeAnonymous=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return[4,this.collaborateRepository.setPersonalizeAnonymous(e,t)];case 1:return[2,n.sent()]}}))}))},t.prototype.getPersonalizeAnonymous=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.collaborateRepository.getPersonalizeAnonymous(e)];case 1:return[2,t.sent()]}}))}))},t.prototype.handleCommerIcilizeMessage=function(e){this.onCommercializeMessageEmitter.fire(e)},Object.defineProperty(t.prototype,"maxCollabListLimit",{get:function(){return this.maxCollabListLengthLimit?this.maxCollabListLengthLimit:1/0},enumerable:!1,configurable:!0}),t.prototype.appendNoticeTo=function(e){this.collaborateList.find((function(t){return t.userId===e.userId}))||this.collaborateList.push(e)},t.prototype.createCollaborateItemObject=function(e,t){var n;return Object(r.__assign)(Object(r.__assign)(Object(r.__assign)({},e),e.userId?null:{userId:null!==(n=e.reqUid)&&void 0!==n?n:""}),{userType:t?1:2})},t.prototype.fillVipInfoWithRecordInfo=function(e,t){if(t)return e;var n=this.collabRecordList.find((function(t){return t.userId===e.userId}));return n?Object(r.__assign)(Object(r.__assign)({},e),{vipInfo:null==n?void 0:n.vipInfo}):e},t.prototype.checkAdd2CollaborateList=function(e,t){var n=this.createCollaborateItemObject(e,t);n=this.fillVipInfoWithRecordInfo(n,t),!this.collabAllInfoList.find((function(e){return e.userId===n.userId}))&&this.collabAllInfoList.length<this.maxCollabListLimit&&this.collabAllInfoList.push(new m(n))},t.prototype.processUserEnter=function(e){var t=this,n=!1;null==e||e.notices.forEach((function(e){var i=c(e.userId),o={uid:i,userId:i,sessionType:e.sessionType,uuid:e.uuId,vipInfo:Object(a.l)(e.vipInfo,{})};if(t.collabRecordList.push(o),!s(t.userInfoDomain.userInfoAggregate.userInfo.userId))return t.checkAdd2CollaborateList(o,!0),void(n=!0);if(!t.collabAllInfoList.find((function(e){return e.userId===i}))){if(!s(e.userId))return t.checkAdd2CollaborateList(o,!0),void(n=!0);if(t.collaboratesCacheMap.has(i)){var u=t.collaboratesCacheMap.get(i),d=Object(a.l)(e.vipInfo,{}),l=Object(r.__assign)(Object(r.__assign)({},u),{vipInfo:d});return t.checkAdd2CollaborateList(l,!1),void(n=!0)}t.needRequestUserIds.add(i)}})),n&&this.onCollabAllInfoListUpdatedEmitter.fire({collabAllInfoList:this.collabAllInfoList}),s(this.userInfoDomain.userInfoAggregate.userInfo.userId)&&this.throttleGetUserMarkname()},t.prototype.throttleGetUserMarkname=function(){var e=this;if(!this.throttleTimer){this.innerGetUserMarkName();var t=this.throttleInterval||6e4;this.throttleTimer=setInterval((function(){e.innerGetUserMarkName()}),t)}},t.prototype.processUserLeave=function(e){var t=this;null==e||e.notices.forEach((function(e){var n=c(e.userId);t.popFormCollabRecordList(n),t.collabRecordList.filter((function(e){return e.userId===n})).length>0||(t.collabAllInfoList=t.collabAllInfoList.filter((function(e){return e.userId!==n})),s(e.userId)&&t.needRequestUserIds.delete(n))})),this.onCollabAllInfoListUpdatedEmitter.fire({collabAllInfoList:this.collabAllInfoList})},t.prototype.innerGetUserMarkName=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t,i,o,a=this;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:if(0===this.needRequestUserIds.size)return[2];r.label=1;case 1:return r.trys.push([1,3,,4]),e=Array.from(this.needRequestUserIds).join(","),[4,this.collaborateRepository.getUserMarkName(e)];case 2:if(t=r.sent(),0===(null===(o=null==t?void 0:t.data)||void 0===o?void 0:o.retcode)){if(!(i=t.data.result.rsp))return[2];i.forEach((function(e){a.needRequestUserIds.has(e.reqUid)&&(a.needRequestUserIds.delete(e.reqUid),a.checkAdd2CollaborateList(e,!1)),a.collaboratesCacheMap.set(e.reqUid,e)})),this.onCollabAllInfoListUpdatedEmitter.fire({collabAllInfoList:this.collabAllInfoList})}return[3,4];case 3:return r.sent(),n.logger.error("handleUserComeIn request error"),[3,4];case 4:return[2]}}))}))},t.prototype.popFormCollabRecordList=function(e){for(var t=0;t<this.collabRecordList.length;t++)if(this.collabRecordList[t].userId===e)return void this.collabRecordList.splice(t,1)},t.prototype.setUserMarkItemToCache=function(e){var t,n,r,i,o=this;0===(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.retcode)&&(null!==(i=null===(r=null===(n=null==e?void 0:e.data)||void 0===n?void 0:n.result)||void 0===r?void 0:r.rsp)&&void 0!==i?i:[]).forEach((function(e){(null==e?void 0:e.reqUid)&&o.collaboratesCacheMap.set(e.reqUid,e)}))},t.prototype.getSingleUserMarkItemFromCache=function(e){var t=this.collaboratesCacheMap.get(e);return t?{unCachedUserIds:[],cachedResults:[t]}:{unCachedUserIds:[e],cachedResults:[]}},t.prototype.getUserMarkItemFromCache=function(e){var t=this,n=[],r=[];return(Object(b.isArray)(e)?e:[e]).forEach((function(e){var i=t.getSingleUserMarkItemFromCache(e),o=i.cachedResults,a=i.unCachedUserIds;n=n.concat(a),r=r.concat(o)})),{unCachedUserIds:n,cachedResults:r}},Object(r.__decorate)([Object(o.b)(),Object(o.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object,Object,Object]),Object(r.__metadata)("design:returntype",Promise)],t.prototype,"getUserMarkName",null),Object(r.__decorate)([Object(o.b)(),Object(o.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Number,String]),Object(r.__metadata)("design:returntype",Promise)],t.prototype,"setPersonalizeAnonymous",null),Object(r.__decorate)([Object(o.b)(),Object(o.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String]),Object(r.__metadata)("design:returntype",Promise)],t.prototype,"getPersonalizeAnonymous",null),t=n=Object(r.__decorate)([Object(r.__param)(1,f.a),Object(r.__param)(2,O.a),Object(r.__metadata)("design:paramtypes",[String,Object,Object])],t)}(i.a),I=n("540dabb65d"),S=n("624cdb524f"),E=function(){function e(e,t){this.docMetaDomainService=e,this.userInfoDomainService=t,this.collaborateAggregate=new w("mainUserInfoAggregate",this.docMetaDomainService,this.userInfoDomainService),Object(S.c)(this,this.collaborateAggregate,w)}return e.prototype.init=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.docMetaDomainService.init(e)];case 1:return t.sent(),[2]}}))}))},Object(r.__decorate)([Object(I.a)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"init",null),e=Object(r.__decorate)([Object(r.__param)(0,f.a),Object(r.__param)(1,O.a),Object(r.__metadata)("design:paramtypes",[Object,Object])],e)}()},"804db59c17":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("cedf7830be"),i=Object(r.a)("IFolderDomainService")},"8139f7151b":function(e,t,n){"use strict";var r,i,o,a,c,s,u,d;n.d(t,"f",(function(){return r})),n.d(t,"d",(function(){return i})),n.d(t,"e",(function(){return o})),n.d(t,"h",(function(){return a})),n.d(t,"g",(function(){return c})),n.d(t,"a",(function(){return s})),n.d(t,"c",(function(){return u})),n.d(t,"b",(function(){return d})),function(e){e[e.NOT_YET=1]="NOT_YET",e[e.USING=2]="USING",e[e.EXPIRED=3]="EXPIRED"}(r||(r={})),function(e){e[e.NO_STATUS=0]="NO_STATUS",e[e.CLOSE=1]="CLOSE",e[e.OPEN=2]="OPEN",e[e.EXPIRED=3]="EXPIRED"}(i||(i={})),function(e){e[e.EXPIRED=1]="EXPIRED",e[e.SUPER_VIP_EXPIRED=2]="SUPER_VIP_EXPIRED"}(o||(o={})),function(e){e.NORMAL="NORMAL",e.SUPER="SUPER",e.SUPER_PLUS="SUPER_PLUS",e.NONE="NONE",e.EXPIRED="EXPIRED"}(a||(a={})),function(e){e[e.NORMAL=2]="NORMAL",e[e.SUPER=3]="SUPER",e[e.SUPER_PLUS=4]="SUPER_PLUS",e[e.NONE=1]="NONE",e[e.EXPIRED=0]="EXPIRED"}(c||(c={})),function(e){e[e.INVALID_CORP_VIP_LEVEL=0]="INVALID_CORP_VIP_LEVEL",e[e.CORP_VIP_LEVEL_BASIC=1]="CORP_VIP_LEVEL_BASIC",e[e.CORP_VIP_LEVEL_PRO=2]="CORP_VIP_LEVEL_PRO"}(s||(s={})),function(e){e[e.NONE=1]="NONE",e[e.NORMAL=2]="NORMAL",e[e.SUPER=3]="SUPER",e[e.SUPER_PLUS=4]="SUPER_PLUS"}(u||(u={})),function(e){e[e.NONE=0]="NONE",e[e.AUTO_RENEWAL=1]="AUTO_RENEWAL",e[e.CLOSED=2]="CLOSED"}(d||(d={}))},"8216980c74":function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var r=n("d7c625d1f2"),i=n("76702c352f"),o=n("5bfdce0c9d"),a=n("a3e804d4e7"),c=n("5bdead0cb8"),s=n("a4cdaf353f"),u=n("47575f3348"),d=n("b9d0dec2ff"),l=n("8a4c0c1d32"),p=n("bc0f24c59d"),f=n("b512c0eccb"),h=n("540dabb65d"),b=function(){function e(){this.isInitedByBasicClientVars=!1,this.docMetaEntity=new a.a("MainDocMetaEntity"),(null===window||void 0===window?void 0:window.basicClientVars)&&this.initWithBasicClientVars(window.basicClientVars)}return e.prototype.updateWithClientVars=function(e){this.isInitedByBasicClientVars||(this.docMetaEntity.createInfo=new c.a(Object(r.__assign)(Object(r.__assign)({},e),{createTime:e.metaCreateTime})),this.docMetaEntity.ownerInfo=new s.a(e),this.docMetaEntity.padInfo=new u.a(e),this.docMetaEntity.titleInfo=new l.a(e),this.docMetaEntity.userAuthInfo=new p.a(e))},e.prototype.init=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){return t=e.docId,!Object(o.a)(t)||this.isInitedByBasicClientVars?[2]:[2,this.updateWithPreload(t)]}))}))},e.prototype.updateWithPreload=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,o,a,c;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,f.networkRequest.get("/cgi/gateway/preload?command=1&id=".concat(e))];case 1:if(t=r.sent(),!(null===(o=null===(i=null==t?void 0:t.data)||void 0===i?void 0:i.data)||void 0===o?void 0:o.clientVars)||"object"!=typeof(null===(c=null===(a=null==t?void 0:t.data)||void 0===a?void 0:a.data)||void 0===c?void 0:c.clientVars))throw console.error(t),new Error("get /cgi/gateway/preload failed");return this.initWithBasicClientVars(t.data.data.clientVars),[3,3];case 2:return n=r.sent(),console.error("updateWithPreload failed",n),[3,3];case 3:return[2]}}))}))},e.prototype.initWithBasicClientVars=function(e){this.updateCreateInfoByBasicClientVars(e),this.updateOwnerAndAuthInfoByBasicClientVars(e),this.updatePadInfoByBasicClientVars(e),this.updateTitleInfoByBasicClientVars(e),this.updateCollaborationInfoByBasicClientVars(e),this.updatePersonalizeInfoByBasicClientVars(e),this.isInitedByBasicClientVars=!0},e.prototype.updatePersonalizeInfoByBasicClientVars=function(e){var t;this.docMetaEntity.personalizeInfo=new d.a(null===(t=e.docInfo)||void 0===t?void 0:t.personalizeInfo)},e.prototype.updateCollaborationInfoByBasicClientVars=function(e){var t;this.docMetaEntity.collaborationFlag=null===(t=e.docInfo)||void 0===t?void 0:t.collaborationFlag},e.prototype.updateCreateInfoByBasicClientVars=function(e){var t,n,r,i,o,a,s,u,d,l,p,f,h;this.docMetaEntity.createInfo=new c.a({isCreator:null===(t=e.docInfo)||void 0===t?void 0:t.isOwner,creatorDomain:null===(r=null===(n=e.docInfo)||void 0===n?void 0:n.padInfo)||void 0===r?void 0:r.domainId,creatorNick:null===(o=null===(i=e.docInfo)||void 0===i?void 0:i.createInfo)||void 0===o?void 0:o.creatorNick,createTime:null===(s=null===(a=e.docInfo)||void 0===a?void 0:a.createInfo)||void 0===s?void 0:s.createTime,creatorId:null===(d=null===(u=e.docInfo)||void 0===u?void 0:u.createInfo)||void 0===d?void 0:d.creatorId,creatorCorpId:null===(p=null===(l=e.docInfo)||void 0===l?void 0:l.createInfo)||void 0===p?void 0:p.creatorCorpId,creatorCorpName:null===(h=null===(f=e.docInfo)||void 0===f?void 0:f.createInfo)||void 0===h?void 0:h.creatorCorpName})},e.prototype.updateOwnerAndAuthInfoByBasicClientVars=function(e){var t,n,r,i,o;this.docMetaEntity.ownerInfo=new s.a(null===(t=e.docInfo)||void 0===t?void 0:t.ownerInfo),this.docMetaEntity.userAuthInfo=new p.a({isCreator:null===(n=e.docInfo)||void 0===n?void 0:n.isOwner,isOwner:null===(r=e.docInfo)||void 0===r?void 0:r.isOwner,isAdmin:null===(i=e.docInfo)||void 0===i?void 0:i.isAdmin,isViewer:1===(null===(o=e.authInfo)||void 0===o?void 0:o.privilegeFlag)})},e.prototype.updatePadInfoByBasicClientVars=function(e){var t,n,r,i,o,a,c,s,d,l,p,f;this.docMetaEntity.padInfo=new u.a({domainId:null===(n=null===(t=e.docInfo)||void 0===t?void 0:t.padInfo)||void 0===n?void 0:n.domainId,padId:null===(i=null===(r=e.docInfo)||void 0===r?void 0:r.padInfo)||void 0===i?void 0:i.padId,padType:null===(a=null===(o=e.docInfo)||void 0===o?void 0:o.padInfo)||void 0===a?void 0:a.padType,relative:null===(s=null===(c=e.docInfo)||void 0===c?void 0:c.padInfo)||void 0===s?void 0:s.relative,docStatus:null===(d=e.docInfo)||void 0===d?void 0:d.docStatus,shareLink:null===(l=e.docInfo)||void 0===l?void 0:l.shareLink,lastModifyTime:null===(p=e.docInfo)||void 0===p?void 0:p.lastModifyTime,lastModifyUser:null===(f=e.docInfo)||void 0===f?void 0:f.lastModifyUser})},e.prototype.updateTitleInfoByBasicClientVars=function(e){var t,n,r;this.docMetaEntity.titleInfo=new l.a({title:null===(n=null===(t=e.docInfo)||void 0===t?void 0:t.padInfo)||void 0===n?void 0:n.padTitle,isUserChangeTitle:null===(r=e.docInfo)||void 0===r?void 0:r.isUserChangeTitle})},Object(r.__decorate)([Object(h.a)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"init",null),Object(r.__decorate)([Object(i.m)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",void 0)],e.prototype,"initWithBasicClientVars",null),e}()},"834b03d62c":function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e.LOGOUT="logout",e.SWITCH="switch",e.LOGIN="login"}(r||(r={}))},"875795a3a0":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("cedf7830be"),i=Object(r.a)("IShareDomainService")},"8a3f853387":function(e,t,n){"use strict";n.d(t,"h",(function(){return a}));var r=n("754d878ec7");n.d(t,"a",(function(){return r.a}));var i=n("8139f7151b");n.d(t,"b",(function(){return i.a})),n.d(t,"c",(function(){return i.b})),n.d(t,"d",(function(){return i.c})),n.d(t,"e",(function(){return i.d})),n.d(t,"f",(function(){return i.e})),n.d(t,"g",(function(){return i.f})),n.d(t,"i",(function(){return i.g})),n.d(t,"j",(function(){return i.h}));var o=n("52878e0097");n.d(t,"k",(function(){return o.a}));var a="100000000000000000"},"8a4c0c1d32":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("d7c625d1f2"),i=function(e){function t(t){var n=e.call(this)||this;return n.title="",n.isUserChangeTitle=!1,n.jsonObj2Class(t),n}return Object(r.__extends)(t,e),t}(n("61cea32eb2").a)},"8ac5678f09":function(e,t,n){"use strict";var r=n("94b54f38ee"),i=n("58bffcf462");e.exports=function(e,t,n){var o=this||i;return r.forEach(n,(function(n){e=n.call(o,e,t)})),e}},"8e26833a3b":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisposableNone=void 0,t.DisposableNone=Object.freeze({dispose:function(){}})},"8e87c39c39":function(e,t,n){"use strict";var r=n("f9f6cd81c2");e.exports=function(e,t,n){var i=n.config.validateStatus;n.status&&i&&!i(n.status)?t(r("Request failed with status code "+n.status,n.config,null,n.request,n)):e(n)}},"9431135ba7":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("d7c625d1f2"),i=function(e){function t(t){var n=e.call(this)||this;return n.vipLevel=1,n.avatarFrameUrl="",n.renewalStatus=0,n.jsonObj2Class(t),n}return Object(r.__extends)(t,e),t}(n("61cea32eb2").a)},"94b54f38ee":function(e,t,n){"use strict";var r=n("d3e4db71be"),i=Object.prototype.toString;function o(e){return Array.isArray(e)}function a(e){return void 0===e}function c(e){return"[object ArrayBuffer]"===i.call(e)}function s(e){return null!==e&&"object"==typeof e}function u(e){if("[object Object]"!==i.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function d(e){return"[object Function]"===i.call(e)}function l(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),o(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}e.exports={isArray:o,isArrayBuffer:c,isBuffer:function(e){return null!==e&&!a(e)&&null!==e.constructor&&!a(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"[object FormData]"===i.call(e)},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&c(e.buffer)},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:s,isPlainObject:u,isUndefined:a,isDate:function(e){return"[object Date]"===i.call(e)},isFile:function(e){return"[object File]"===i.call(e)},isBlob:function(e){return"[object Blob]"===i.call(e)},isFunction:d,isStream:function(e){return s(e)&&d(e.pipe)},isURLSearchParams:function(e){return"[object URLSearchParams]"===i.call(e)},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:l,merge:function e(){var t={};function n(n,r){u(t[r])&&u(n)?t[r]=e(t[r],n):u(n)?t[r]=e({},n):o(n)?t[r]=n.slice():t[r]=n}for(var r=0,i=arguments.length;r<i;r++)l(arguments[r],n);return t},extend:function(e,t,n){return l(t,(function(t,i){e[i]=n&&"function"==typeof t?r(t,n):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}}},"98c24f707d":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("d7c625d1f2"),i=function(e){function t(t){var n=e.call(this)||this;return n.id=t,n}return Object(r.__extends)(t,e),t.prototype.initWithJsonObj=function(e){this.jsonObj2Class(e)},t.prototype.jsonObj=function(){return this.class2JsonObj()},t.prototype.getIdentity=function(){return this.id},t.prototype.equals=function(e){return null!==e&&(this===e||this.getIdentity()===e.getIdentity())},t}(n("b6b7caa0aa").a)},"99d670dcab":function(e,t,n){"use strict";n.d(t,"a",(function(){return R}));var r=n("d7c625d1f2"),i=n("03808c4177"),o=n("536530eec5"),a=n("1add19ffb1"),c=n("76702c352f"),s=n("98c24f707d"),u=n("61cea32eb2"),d=function(e){function t(t){var n=e.call(this)||this;return n.dataType=0,n.domainId="",n.localPadId="",n.padTitle="",n.padType="",n.padUrl="",n.page="",n.jsonObj2Class(t),n}return Object(r.__extends)(t,e),t}(u.a),l=function(e){function t(t){var n=e.call(this)||this;return n.avatar="",n.nick="",n.uid="",n.jsonObj2Class(t),n}return Object(r.__extends)(t,e),t}(u.a),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.notifyUserInfo=new l({}),t.notifyPadInfo=new d({}),t.aRightFlag=0,t.bRightFlag=0,t.nRightFlag=0,t.rightFlag=0,t.denyCount=0,t.flag=0,t.id="",t.op="",t.pass=0,t.sendDate=0,t.subject="",t.type=0,t}return Object(r.__extends)(t,e),t.prototype.initWithJsonObj=function(e){e?(this.aRightFlag=e.aRightFlag,this.bRightFlag=e.bRightFlag,this.nRightFlag=e.nRightFlag,this.rightFlag=e.rightFlag,this.denyCount=e.denyCount,this.flag=e.flag,this.pass=e.pass,this.sendDate=e.send_date,this.type=e.type,this.id=e.id,this.op=e.op,this.subject=e.subject,this.notifyPadInfo=new d(e),this.notifyUserInfo=new l(e)):t.logger.debug("params erroro: initWithJsonObj")},t}(s.a),f=n("fb1099018f"),h="".concat(f.c,"notify_getnum"),b="".concat(f.c,"notify_list"),_="".concat(f.c,"auth_set"),v="".concat(f.c,"auth_apply/check"),y="".concat(f.c,"notify_delete"),g="".concat(f.c,"transowner_accept"),m="".concat(f.c,"transowner_reject"),O=n("b512c0eccb"),j=n("6423ed0b81"),w=n("6fa7b8d7bc"),I=function(){function e(e){this.networkRequestService=e}return e.prototype.notifyGetNum=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(r.__generator)(this,(function(n){return e={xsrf:"".concat(Object(j.c)(j.a.xsrf))},t=Object(w.a)(h,e),[2,O.networkRequest.get(t)]}))}))},e.prototype.notifyList=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(r.__generator)(this,(function(r){return e?(t=Object(w.a)(b,{xsrf:"".concat(Object(j.c)(j.a.xsrf)),start:e}),[2,O.networkRequest.get(t)]):(n=Object(w.a)(b,{xsrf:"".concat(Object(j.c)(j.a.xsrf))}),[2,O.networkRequest.get(n)])}))}))},e.prototype.currentDocNotifyList=function(e,t,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var i,o;return Object(r.__generator)(this,(function(r){return n?(o={xsrf:"".concat(Object(j.c)(j.a.xsrf)),domainId:e,localPadId:t,start:n},i=Object(w.a)(b,o)):(o={xsrf:"".concat(Object(j.c)(j.a.xsrf)),domainId:e,localPadId:t},i=Object(w.a)(b,o)),[2,O.networkRequest.get(i)]}))}))},e.prototype.authSet=function(e,t,n,i){return Object(r.__awaiter)(this,void 0,void 0,(function(){var o,a;return Object(r.__generator)(this,(function(r){return o={xsrf:Object(j.c)(j.a.xsrf),domainId:e,localPadId:t,notifyId:n,setInfo:i},a="".concat(_),[2,O.networkRequest.post(a,o)]}))}))},e.prototype.authApplyCheck=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n,i;return Object(r.__generator)(this,(function(r){return n={xsrf:"".concat(Object(j.c)(j.a.xsrf)),domainId:e,localPadId:t},i=Object(w.a)(v,n),[2,O.networkRequest.get(i)]}))}))},e.prototype.notifyDelete=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(r.__generator)(this,(function(r){return t={id:e,xsrf:"".concat(Object(j.c)(j.a.xsrf))},n=Object(w.a)(y,t),[2,O.networkRequest.get(n)]}))}))},e.prototype.transownerAccept=function(e,t,n,i){return Object(r.__awaiter)(this,void 0,void 0,(function(){var o,a;return Object(r.__generator)(this,(function(r){return o={xsrf:Object(j.c)(j.a.xsrf),domainId:e,localPadId:t,notifyId:n,setInfo:i},a="".concat(g),[2,O.networkRequest.post(a,o)]}))}))},e.prototype.transownerReject=function(e,t,n,i){return Object(r.__awaiter)(this,void 0,void 0,(function(){var o,a;return Object(r.__generator)(this,(function(r){return o={xsrf:Object(j.c)(j.a.xsrf),domainId:e,localPadId:t,notifyId:n,setInfo:i},a="".concat(m),[2,O.networkRequest.post(a,o)]}))}))},e=Object(r.__decorate)([Object(r.__param)(0,i.a),Object(r.__metadata)("design:paramtypes",[Object])],e)}(),S=n("9ab1857893"),E=function(e){function t(t){var n=e.call(this)||this;return n.unreadSumCount=0,n.hasPolicyNotify=0,n.jsonObj2Class(t),n}return Object(r.__extends)(t,e),t}(u.a),x="unreadInfo",C="list",A=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.docMetaDomainService=n,i.networkRequest=r,i.unreadInfo=new E({}),i.notifysAll=[],i.notifysCurrent=[],i.mOnNotifyUnreadInfoDidUpdated=new S.Emitter,i.onNotifyUnreadInfoDidUpdated=i.mOnNotifyUnreadInfoDidUpdated.event,i.notificationRepository=new I(r),i}return Object(r.__extends)(t,e),t.prototype.notifyGetNum=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){return[2,this.notificationRepository.notifyGetNum()]}))}))},t.prototype.notifyList=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return e||(this.notifysAll=[]),[2,this.notificationRepository.notifyList(e)]}))}))},t.prototype.currentDocNotifyList=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return e||(this.notifysCurrent=[]),[2,this.notificationRepository.currentDocNotifyList(this.docMetaDomainService.docMetaEntity.padInfo.domainId,this.docMetaDomainService.docMetaEntity.padInfo.padId,e)]}))}))},t.prototype.authSet=function(e,t,n,i){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(r){return[2,this.notificationRepository.authSet(e,t,n,i)]}))}))},t.prototype.authApplyCheck=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(n){return[2,this.notificationRepository.authApplyCheck(e,t)]}))}))},t.prototype.notifyDelete=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.notificationRepository.notifyDelete(e)]}))}))},t.prototype.transownerAccept=function(e,t,n,i){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(r){return[2,this.notificationRepository.transownerAccept(e,t,n,i)]}))}))},t.prototype.transownerReject=function(e,t,n,i){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(r){return[2,this.notificationRepository.transownerReject(e,t,n,i)]}))}))},t.prototype.clearUnreadInfo=function(){this.unreadInfo=new E({}),this.mOnNotifyUnreadInfoDidUpdated.fire({unreadInfo:this.unreadInfo})},Object(r.__decorate)([Object(c.d)("mOnNotifyUnreadInfoDidUpdated",x),Object(c.i)(E.prototype.constructor,x),Object(c.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[]),Object(r.__metadata)("design:returntype",Promise)],t.prototype,"notifyGetNum",null),Object(r.__decorate)([Object(c.f)(p.prototype.constructor,"notifysAll",C),Object(c.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String]),Object(r.__metadata)("design:returntype",Promise)],t.prototype,"notifyList",null),Object(r.__decorate)([Object(c.f)(p.prototype.constructor,"notifysCurrent",C),Object(c.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String]),Object(r.__metadata)("design:returntype",Promise)],t.prototype,"currentDocNotifyList",null),Object(r.__decorate)([Object(c.b)(),Object(c.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String,String,String,Object]),Object(r.__metadata)("design:returntype",Promise)],t.prototype,"authSet",null),Object(r.__decorate)([Object(c.b)(),Object(c.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String,String]),Object(r.__metadata)("design:returntype",Promise)],t.prototype,"authApplyCheck",null),Object(r.__decorate)([Object(c.b)(),Object(c.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String]),Object(r.__metadata)("design:returntype",Promise)],t.prototype,"notifyDelete",null),Object(r.__decorate)([Object(c.b)(),Object(c.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String,String,String,Object]),Object(r.__metadata)("design:returntype",Promise)],t.prototype,"transownerAccept",null),Object(r.__decorate)([Object(c.b)(),Object(c.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String,String,String,Object]),Object(r.__metadata)("design:returntype",Promise)],t.prototype,"transownerReject",null),t=Object(r.__decorate)([Object(r.__param)(1,o.a),Object(r.__param)(2,i.a),Object(r.__metadata)("design:paramtypes",[String,Object,Object])],t)}(a.a),k=n("540dabb65d"),R=function(){function e(e,t){this.docMetaDomainService=e,this.networkRequest=t,this.notificationAggregate=new A("mainUserInfoAggregate",e,t)}return e.prototype.init=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.docMetaDomainService.init(e)];case 1:return t.sent(),[2]}}))}))},Object(r.__decorate)([Object(k.a)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"init",null),e=Object(r.__decorate)([Object(r.__param)(0,o.a),Object(r.__param)(1,i.a),Object(r.__metadata)("design:paramtypes",[Object,Object])],e)}()},"9a4c21e153":function(e,t,n){"use strict";var r,i,o;n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),function(e){e.C_DOMAIN="C_DOMAIN",e.B_DOMAIN="B_DOMAIN"}(r||(r={})),function(e){e.WECHAT="wx",e.WEWORK="ww",e.QQ="qq"}(i||(i={})),function(e){e[e.WEWORK=2]="WEWORK",e[e.WECHAT=1]="WECHAT"}(o||(o={}))},"9ab1857893":function(e,t,n){"use strict";n.r(t),n.d(t,"Emitter",(function(){return c}));var r=n("d7c625d1f2"),i=n("c7db5dbe42"),o=function(){function e(t){this.element=t,this.next=e.Undefined,this.prev=e.Undefined}return e.Undefined=new e(void 0),e}(),a=function(){function e(){this.first=o.Undefined,this.last=o.Undefined,this.mSize=0}return Object.defineProperty(e.prototype,"size",{get:function(){return this.mSize},enumerable:!1,configurable:!0}),e.prototype.isEmpty=function(){return this.first===o.Undefined},e.prototype.clear=function(){this.first=o.Undefined,this.last=o.Undefined,this.mSize=0},e.prototype.unshift=function(e){return this.insert(e,!1)},e.prototype.push=function(e){return this.insert(e,!0)},e.prototype.shift=function(){if(this.first!==o.Undefined){var e=this.first.element;return this.remove(this.first),e}},e.prototype.pop=function(){if(this.last!==o.Undefined){var e=this.last.element;return this.remove(this.last),e}},e.prototype[Symbol.iterator]=function(){var e;return Object(r.__generator)(this,(function(t){switch(t.label){case 0:e=this.first,t.label=1;case 1:return e===o.Undefined?[3,3]:[4,e.element];case 2:return t.sent(),e=e.next,[3,1];case 3:return[2]}}))},e.prototype.insert=function(e,t){var n=this,r=new o(e);if(this.first===o.Undefined)this.first=r,this.last=r;else if(t){var i=this.last;this.last=r,r.prev=i,i.next=r}else{var a=this.first;this.first=r,r.next=a,a.prev=r}this.mSize+=1;var c=!1;return function(){c||(c=!0,n.remove(r))}},e.prototype.remove=function(e){if(e.prev!==o.Undefined&&e.next!==o.Undefined){var t=e.prev;t.next=e.next,e.next.prev=t,e.next=o.Undefined,e.prev=o.Undefined}else e.prev===o.Undefined&&e.next===o.Undefined?(this.first=o.Undefined,this.last=o.Undefined):e.next===o.Undefined?(this.last=this.last.prev,this.last.next=o.Undefined,e.prev=o.Undefined):e.prev===o.Undefined&&(this.first=this.first.next,this.first.prev=o.Undefined,e.next=o.Undefined);this.mSize-=1},e}(),c=function(){function e(e){this.disposed=!1,this.options=e}return Object.defineProperty(e.prototype,"event",{get:function(){var e=this;return this.mEvent||(this.mEvent=function(t,n,r){var o,c,s;e.listeners||(e.listeners=new a);var u=e.listeners.isEmpty();u&&(null===(o=e.options)||void 0===o?void 0:o.onFirstListenerAdd)&&e.options.onFirstListenerAdd(e);var d=e.listeners.push(n?[t,n]:t);u&&(null===(c=e.options)||void 0===c?void 0:c.onFirstListenerDidAdd)&&e.options.onFirstListenerDidAdd(e),(null===(s=e.options)||void 0===s?void 0:s.onListenerDidAdd)&&e.options.onListenerDidAdd(e,t,n);var l={dispose:function(){var t;e.disposed||(d(),(null===(t=e.options)||void 0===t?void 0:t.onLastListenerRemove)&&(e.listeners&&!e.listeners.isEmpty()||e.options.onLastListenerRemove(e)));Object(i.markTracked)(l)},disposableId:"event"};return Array.isArray(r)&&r.push(l),Object(i.trackDisposable)(l),l}),this.mEvent},enumerable:!1,configurable:!0}),e.prototype.fire=function(e){var t,n;if(this.listeners){this.deliveryQueue||(this.deliveryQueue=new a);try{for(var i=Object(r.__values)(this.listeners),o=i.next();!o.done;o=i.next()){var c=o.value;this.deliveryQueue.push([c,e])}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}for(;this.deliveryQueue.size>0;){var s=Object(r.__read)(this.deliveryQueue.shift(),2),u=(c=s[0],s[1]);try{"function"==typeof c?c.call(void 0,u):c[0].call(c[1],u)}catch(e){console.error(e)}}}},e.prototype.dispose=function(){this.listeners&&this.listeners.clear(),this.deliveryQueue&&this.deliveryQueue.clear(),this.disposed=!0},e}()},"9ae390a68c":function(e,t,n){"use strict";var r=n("94b54f38ee"),i=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,n,o,a={};return e?(r.forEach(e.split("\n"),(function(e){if(o=e.indexOf(":"),t=r.trim(e.substr(0,o)).toLowerCase(),n=r.trim(e.substr(o+1)),t){if(a[t]&&i.indexOf(t)>=0)return;a[t]="set-cookie"===t?(a[t]?a[t]:[]).concat([n]):a[t]?a[t]+", "+n:n}})),a):a}},"9c60cb7ff5":function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return c}));var r=n("d7c625d1f2"),i=function(e){function t(t,n){for(var r=this,i=t,o={cause:n};o.cause&&o.cause instanceof Error;)i=t+"\n\t→ "+n,o=o.cause;return(r=e.call(this,i)||this).cause=n,r.name=r.constructor.name,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(r,r.constructor):r.stack=(new Error).stack,Object.setPrototypeOf(r,r.constructor.prototype),r}return Object(r.__extends)(t,e),t}(Error),o={withDefaultMessage:function(e,t){return function(n){function i(r,i){var o=n.call(this,r||t||"",i)||this;return o.name=e,Object.setPrototypeOf(o,o.constructor.prototype),o}return Object(r.__extends)(i,n),i}(i)},withMessageCreator:function(e,t){return function(n){function i(r,i){var o=n.call(this,t(r),i)||this;return o.name=e,Object.setPrototypeOf(o,o.constructor.prototype),o}return Object(r.__extends)(i,n),i}(i)}},a=(o.withDefaultMessage("AssertionError","the asserted condition is invalid"),o.withMessageCreator("UnimplementedError",(function(e){return e?"called with arguments: "+JSON.stringify(e):"called with nothing"})));var c=function(e){0}},"9cc8fbe3ef":function(e,t,n){e.exports=n("c5371f6846")},"9e41b0871b":function(e,t,n){"use strict";var r=n("eec87fff73"),i=n("39a4b3c3c1");e.exports=function(e,t){return e&&!r(t)?i(e,t):t}},a3e804d4e7:function(e,t,n){"use strict";var r=n("d7c625d1f2"),i=n("4b146817ca"),o=n("9431135ba7"),a=n("98c24f707d"),c=n("76702c352f"),s=n("5be39fbf8a"),u=n("b512c0eccb"),d=n("6423ed0b81"),l=n("6fa7b8d7bc"),p=n("a52ab4297c"),f=n.n(p),h=n("fb1099018f"),b="".concat(h.h,"/cgi-bin/online_docs/doc_changetitle"),_="".concat(h.h,"/cgi-bin/online_docs/doc_collect"),v="".concat(h.h,"/cgi-bin/online_docs/doc_getcollect"),y="".concat(h.h,"/cgi-bin/online_docs/doc_info"),g="".concat(h.h,"/dop-api/drive/data/get"),m="".concat(h.h,"/cgi/gateway/preload"),O=function(){function e(){}return e.prototype.updateTitle=function(e,t,n,i){return Object(r.__awaiter)(this,void 0,void 0,(function(){var o,a;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return o={pad_id:i,domain_id:n,xsrf:"".concat(Object(d.c)(d.a.xsrf)),version:2,auto_change:t?1:0,title:encodeURIComponent(e)},a=Object(l.a)(b,o),[4,u.networkRequest.post(a)];case 1:return[2,r.sent()]}}))}))},e.prototype.fetchCollectedState=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n,i;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return n={domain_id:e,pad_id:t,xsrf:"".concat(Object(d.c)(d.a.xsrf)),t:(new Date).getTime()},i=Object(l.a)(v,n),[4,u.networkRequest.get(i)];case 1:return[2,r.sent()]}}))}))},e.prototype.changeCollectedState=function(e,t,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var i,o;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return i=Object(s.d)({domain_id:e,pad_id:t,is_cancel:n?0:1,xsrf:"".concat(Object(d.c)(d.a.xsrf))}),o={contentType:"application/x-www-form-urlencoded"},[4,u.networkRequest.post(_,i,o)];case 1:return[2,r.sent()]}}))}))},e.prototype.fetchDocInfo=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n,i;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return n={domainId:e,localPadId:t,xsrf:"".concat(Object(d.c)(d.a.xsrf))},i=Object(l.a)(y,n),[4,u.networkRequest.get(i)];case 1:return[2,r.sent()]}}))}))},e.prototype.fetchDocMetaInfoData=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return t={id:e,xsrf:"".concat(Object(d.c)(d.a.xsrf))},n=Object(l.a)(g,t),[4,u.networkRequest.get(n)];case 1:return[2,r.sent()]}}))}))},e.prototype.fetchFileInfo=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n,i,o;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return n={xsrf:Object(d.c)(d.a.xsrf)},i=f.a.stringify(n),o={file_id:e,add_recent:t},[4,u.networkRequest.post("".concat("/v2/drive/fileInfo","?").concat(i),o)];case 1:return[2,r.sent()]}}))}))},e.prototype.updateOfficialAuthInfo=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n,i;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return n={id:e,type:t,command:1,xsrf:"".concat(Object(d.c)(d.a.xsrf))},i=Object(l.a)(m,n),[4,u.networkRequest.get(i)];case 1:return[2,r.sent()]}}))}))},e.prototype.getOwnerVipInfo=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return n={file_id:e,get_all:t},[4,u.networkRequest.post("/api/personalize/owner/viplevel",n)];case 1:return[2,r.sent()]}}))}))},Object(r.__decorate)([Object(c.k)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String,Boolean]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"getOwnerVipInfo",null),e}(),j=n("a4cdaf353f"),w=n("47575f3348"),I=n("8a4c0c1d32"),S=n("9ab1857893"),E=n("5bdead0cb8"),x=n("729f9b497f"),C=n("bc0f24c59d"),A=12e3,k=12e3,R=function(e){function t(t){var n=e.call(this,t)||this;return n.createInfo=new E.a({}),n.padInfo=new w.a({}),n.ownerInfo=new j.a({}),n.userAuthInfo=new C.a({}),n.titleInfo=new I.a({}),n.onTitleDidChangeEmitter=new S.Emitter,n.onhandleNoticeDeletedEmitter=new S.Emitter,n.onDocStatusChangedEmitter=new S.Emitter,n.onOfficialAuthInfoChangeEmitter=new S.Emitter,n.docMetaRepository=new O,n.onTitleDidChange=n.onTitleDidChangeEmitter.event,n.onhandleNoticeDeleted=n.onhandleNoticeDeletedEmitter.event,n.onDocStatusChanged=n.onDocStatusChangedEmitter.event,n.onOfficialAuthInfoChange=n.onOfficialAuthInfoChangeEmitter.event,n}return Object(r.__extends)(t,e),t.prototype.updateTitle=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n,i,o;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.docMetaRepository.updateTitle(e,t,null===(i=this.padInfo)||void 0===i?void 0:i.domainId,null===(o=this.padInfo)||void 0===o?void 0:o.padId)];case 1:return n=r.sent(),parseInt(n.data.retcode,10)!==A&&parseInt(n.data.cgicode,10)!==k&&this.titleInfo&&(this.titleInfo.title=e,this.onTitleDidChangeEmitter.fire({newTitle:e})),[2,n]}}))}))},t.prototype.handleNoticeDeleted=function(){this.padInfo.docStatus=x.a.docStatusDelete,this.onhandleNoticeDeletedEmitter.fire(void 0)},t.prototype.handleNoticeTitleChanged=function(e){this.titleInfo.title=e,this.onTitleDidChangeEmitter.fire({newTitle:e})},t.prototype.updateOfficialAuthInfo=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n,i;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.docMetaRepository.updateOfficialAuthInfo(e,null===(i=this.padInfo)||void 0===i?void 0:i.padType)];case 1:return t=r.sent(),n=t.data.data.clientVars.docInfo.ownerInfo.officialAuthInfo,this.ownerInfo.officialAuthInfo=n,this.onOfficialAuthInfoChangeEmitter.fire({officialAuthInfo:n}),[2,t]}}))}))},t.prototype.changeDocStatus=function(e){this.padInfo.docStatus=e,e===x.a.docStatusDelete&&this.onhandleNoticeDeletedEmitter.fire(void 0),this.onDocStatusChangedEmitter.fire(void 0)},t.prototype.fetchCollectedState=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(r.__generator)(this,(function(n){return[2,this.docMetaRepository.fetchCollectedState(null===(e=this.padInfo)||void 0===e?void 0:e.domainId,null===(t=this.padInfo)||void 0===t?void 0:t.padId)]}))}))},t.prototype.changeCollectedState=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(r.__generator)(this,(function(r){return[2,this.docMetaRepository.changeCollectedState(null===(t=this.padInfo)||void 0===t?void 0:t.domainId,null===(n=this.padInfo)||void 0===n?void 0:n.padId,e)]}))}))},t.prototype.fetchDocMetaInfoData=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.docMetaRepository.fetchDocMetaInfoData(e)]}))}))},t.prototype.fetchFileInfo=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(n){return[2,this.docMetaRepository.fetchFileInfo(e,t)]}))}))},t.prototype.getOwnerVipInfo=function(e){return Object(r.__awaiter)(this,arguments,void 0,(function(e,t){var n,a,c,u,d,l;return void 0===t&&(t=!1),Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.docMetaRepository.getOwnerVipInfo(e,t)];case 1:return n=r.sent(),(a=Object(i.c)(n,!0)).resData&&(c=a.resData.data.result||{},u=c.vipLevel,d=c.vipInfo,l=Object(s.l)(d,{}),this.ownerInfo.vipLevel=u,this.ownerInfo.vipInfo=new o.a(l)),[2,a]}}))}))},Object(r.__decorate)([Object(c.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String,Boolean]),Object(r.__metadata)("design:returntype",Promise)],t.prototype,"updateTitle",null),Object(r.__decorate)([Object(c.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String]),Object(r.__metadata)("design:returntype",Promise)],t.prototype,"updateOfficialAuthInfo",null),Object(r.__decorate)([Object(c.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[]),Object(r.__metadata)("design:returntype",Promise)],t.prototype,"fetchCollectedState",null),Object(r.__decorate)([Object(c.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Boolean]),Object(r.__metadata)("design:returntype",Promise)],t.prototype,"changeCollectedState",null),Object(r.__decorate)([Object(c.b)(),Object(c.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String]),Object(r.__metadata)("design:returntype",Promise)],t.prototype,"fetchDocMetaInfoData",null),Object(r.__decorate)([Object(c.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String,Boolean]),Object(r.__metadata)("design:returntype",Promise)],t.prototype,"fetchFileInfo",null),t}(a.a);t.a=R},a4cdaf353f:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n("d7c625d1f2"),i=n("9431135ba7"),o=function(e){function t(t){var n=e.call(this)||this;return n.ownerId="",n.ownerAppid="",n.ownerNick="",n.ownerAvatar="",n.officialAuthInfo={avatar:"",credential:"",introduction:"",nick:"",principal:""},n.vipLevel=1,n.vipInfo=new i.a({}),n.jsonObj2Class(t),n}return Object(r.__extends)(t,e),t}(n("61cea32eb2").a)},a4d5c68b5c:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("cedf7830be"),i=Object(r.a)("IAtMessageDomainService")},a6ef31917d:function(e,t,n){"use strict";function r(e,t){return Object.prototype.toString.call(t)==="[object ".concat(e,"]")}function i(e){return r("Boolean",e)}function o(e){return r("Number",e)}function a(e){return r("String",e)}function c(e){return r("Function",e)}function s(e){return r("Array",e)}function u(e){return r("Date",e)}function d(e){return r("RegExp",e)}function l(e){return r("Object",e)}function p(e){return r("Error",e)}n.r(t),n.d(t,"isType",(function(){return r})),n.d(t,"isBoolean",(function(){return i})),n.d(t,"isNumber",(function(){return o})),n.d(t,"isString",(function(){return a})),n.d(t,"isFunction",(function(){return c})),n.d(t,"isArray",(function(){return s})),n.d(t,"isDate",(function(){return u})),n.d(t,"isRegExp",(function(){return d})),n.d(t,"isObject",(function(){return l})),n.d(t,"isError",(function(){return p}))},a7f251464e:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("cedf7830be"),i=Object(r.a)("ICollaborateDomainService")},aba7e081cb:function(e,t,n){"use strict";n.r(t),n.d(t,"ClientResourceLock",(function(){return m})),n.d(t,"LockMode",(function(){return x})),n.d(t,"LockStrategy",(function(){return E})),n.d(t,"WebResourceLock",(function(){return A}));n("56683198d5"),n("73b854064b");var r=n("9132715560"),i=n.n(r),o=n("6a364eb35c"),a=n.n(o),c=n("bd29e2df90"),s=n.n(c),u=n("ab5eb40518"),d=n.n(u),l=n("1b4cdd6a36"),p=n.n(l),f=(n("d66c2b8c37"),n("47ca619755"),n("c6244f7705"),n("081c8cafea"),n("4a871f4295"),n("e8b2c0f5e8"),n("3bf1976a4f"),n("3ef2352f0b")),h=n.n(f),b=n("d7c625d1f2"),_=n("b512c0eccb"),v=(n("af802ec74b"),n("ef51bf4fed"),n("826dc923b3"),n("8e7cce0ada"),n("29f8c5f672"),n("85d48ef22b"),n("2a6f332b5e"),n("6c6f26abf4"),n("c14c4f06d8"),n("e235bb9b7e"),n("b1e2246d82"),function(e,t){void 0!==e&&(this.error=e),void 0!==t&&(this.data=t)}),y=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"exclusive";i()(this,e),this.id=this.getId();var r=Object.assign(Object.assign({},this.getDefaultConfig()),t);this.mode=n,this.strategy=r.strategy,this.period=r.period,this.autoRenewal=r.autoRenewal}return a()(e,[{key:"getId",value:function(){var e=new Date,t="".concat(e.toLocaleDateString(),"-").concat(e.getHours(),":").concat(e.getMinutes(),":").concat(e.getSeconds(),":").concat(e.getMilliseconds());return"".concat(t,"-").concat(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER))}}]),e}();function g(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p()(e);if(t){var i=p()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d()(this,n)}}var m=function(e){s()(n,e);var t=g(n);function n(){return i()(this,n),t.apply(this,arguments)}return a()(n,[{key:"lock",value:function(e,t){return Object(b.__awaiter)(this,void 0,void 0,h.a.mark((function n(){return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if("exclusive"!==this.mode){n.next=4;break}return n.next=3,this.lockExclusive(e,t);case 3:case 6:return n.abrupt("return",n.sent);case 4:return n.next=6,this.lockShared(e,t);case 7:case"end":return n.stop()}}),n,this)})))}},{key:"detectKey",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,h.a.mark((function t(){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("exclusive"!==this.mode){t.next=4;break}return t.next=3,this.detectExclusiveKey(e);case 3:case 6:return t.abrupt("return",t.sent);case 4:return t.next=6,this.detectSharedKey(e);case 7:case"end":return t.stop()}}),t,this)})))}},{key:"release",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,h.a.mark((function t(){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("exclusive"!==this.mode){t.next=4;break}return t.next=3,this.releaseExclusiveKey(e);case 3:case 6:return t.abrupt("return",t.sent);case 4:return t.next=6,this.releaseSharedKey(e);case 7:case"end":return t.stop()}}),t,this)})))}},{key:"getDefaultConfig",value:function(){return{strategy:0,period:-1,autoRenewal:!0}}},{key:"lockExclusive",value:function(e,t){return Object(b.__awaiter)(this,void 0,void 0,h.a.mark((function n(){var r,i,o,a=this;return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r={tabId:this.id,expire:-1===this.period?-1:Date.now()+this.period,optional:t},i={command:"lock",key:e,item:r},n.next=4,new Promise((function(e){a.invokeNative(i,e)}));case 4:if(!(o=n.sent).error){n.next=7;break}return n.abrupt("return",{isSuccess:!1,data:o.data});case 7:if(o.data.id!==this.id){n.next=9;break}return n.abrupt("return",{isSuccess:!0,data:o.data});case 9:return n.abrupt("return",{isSuccess:!1,data:o.data});case 10:case"end":return n.stop()}}),n,this)})))}},{key:"lockShared",value:function(e,t){return Object(b.__awaiter)(this,void 0,void 0,h.a.mark((function n(){return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:throw new Error("method not implemented with ".concat(e," ").concat(t));case 1:case"end":return n.stop()}}),n)})))}},{key:"detectExclusiveKey",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,h.a.mark((function t(){var n,r,i,o=this;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={command:"detectKey",key:e},t.next=3,new Promise((function(e){o.invokeNative(n,e)}));case 3:if(r=t.sent,i=new v(void 0,r.result),!r.err_code){t.next=8;break}return i.error=new Error("".concat(r.err_code)),t.abrupt("return",i);case 8:return t.abrupt("return",i);case 9:case"end":return t.stop()}}),t)})))}},{key:"detectSharedKey",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,h.a.mark((function t(){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:throw new Error("method not implemented with ".concat(e));case 1:case"end":return t.stop()}}),t)})))}},{key:"releaseExclusiveKey",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,h.a.mark((function t(){var n,r=this;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={command:"release",key:e},t.next=3,new Promise((function(e){r.invokeNative(n,e)}));case 3:if(!t.sent.error){t.next=6;break}return t.abrupt("return",!1);case 6:return t.abrupt("return",!0);case 7:case"end":return t.stop()}}),t)})))}},{key:"releaseSharedKey",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,h.a.mark((function t(){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:throw new Error("method not implemented with ".concat(e));case 1:case"end":return t.stop()}}),t)})))}},{key:"wrapResult",value:function(e){var t;if((null===(t=e.result)||void 0===t?void 0:t.tabId)&&(e.result.id=e.result.tabId,delete e.result.tabId),e.err_msg||e.err_code){var n=new Error(e.err_msg||e.err_code);return new v(n,e.result)}return new v(void 0,e.result||{})}},{key:"invokeNative",value:function(e,t){var n,r=this;(null===(n=null===window||void 0===window?void 0:window.tdocs)||void 0===n?void 0:n.getClientMutexLock)?window.tdocs.getClientMutexLock(e).then((function(e){var n=e;e.result||(n={result:e}),t(r.wrapResult(n))})):_.nativeRequest.invoke({schema:"jsapi",namespace:"docx",method:"clientMutexLock",params:e,callback:function(e){t(r.wrapResult(e))}})}}]),n}(y);function O(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p()(e);if(t){var i=p()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d()(this,n)}}var j=function(e){s()(n,e);var t=O(n);function n(){var e;return i()(this,n),(e=t.apply(this,arguments)).renewalHandler=new Map,e}return a()(n,[{key:"getDefaultConfig",value:function(){return{strategy:0,period:3e5,autoRenewal:!0}}},{key:"lock",value:function(e,t){return Object(b.__awaiter)(this,void 0,void 0,h.a.mark((function n(){return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if("exclusive"!==this.mode){n.next=4;break}return n.next=3,this.lockExclusive(e,t);case 3:case 6:return n.abrupt("return",n.sent);case 4:return n.next=6,this.lockShared(e,t);case 7:case"end":return n.stop()}}),n,this)})))}},{key:"detectKey",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,h.a.mark((function t(){var n,r,i,o;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.getYKey(e),r=new v(void 0,void 0),(i=localStorage.getItem(n))&&(o=JSON.parse(i)).expire>Date.now()&&(r.data=o),t.abrupt("return",r);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"release",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,h.a.mark((function t(){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("exclusive"!==this.mode){t.next=4;break}return t.next=3,this.releaseExclusiveLock(e);case 3:case 6:return t.abrupt("return",t.sent);case 4:return t.next=6,this.releaseSharedLock(e);case 7:case"end":return t.stop()}}),t,this)})))}},{key:"lockExclusive",value:function(e,t){return Object(b.__awaiter)(this,void 0,void 0,h.a.mark((function n(){var r,i=this;return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,new Promise((function(n,r){i.tryToLockKey(e,t,n,r)})).then((function(t){return i.autoRenewal&&i.renewal(e,i.period),{isSuccess:!0,data:t}}),(function(t){var n=i.getXKey(e);return localStorage.getItem(n)===i.id&&localStorage.removeItem(n),{isSuccess:!1,data:t}}));case 2:return r=n.sent,n.abrupt("return",r);case 4:case"end":return n.stop()}}),n)})))}},{key:"lockShared",value:function(e,t){return Object(b.__awaiter)(this,void 0,void 0,h.a.mark((function n(){return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:throw new Error("method not implemented with ".concat(e," ").concat(t," "));case 1:case"end":return n.stop()}}),n)})))}},{key:"releaseExclusiveLock",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,h.a.mark((function t(){var n,r,i,o;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.getXKey(e),r=this.getYKey(e),i=localStorage.getItem(r)){t.next=5;break}return t.abrupt("return",!1);case 5:if(JSON.parse(i).id!==this.id){t.next=12;break}return localStorage.removeItem(r),localStorage.getItem(n)===this.id&&localStorage.removeItem(n),(o=this.renewalHandler.get(e))&&(clearTimeout(o),this.renewalHandler.delete(e)),t.abrupt("return",!0);case 12:return t.abrupt("return",!1);case 13:case"end":return t.stop()}}),t,this)})))}},{key:"releaseSharedLock",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,h.a.mark((function t(){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:throw new Error("method not implemented with ".concat(e));case 1:case"end":return t.stop()}}),t)})))}},{key:"renewal",value:function(e,t){var n=this,r=this.renewalHandler.get(e);r&&clearTimeout(r);var i=setTimeout((function(){var r=n.getYKey(e),i=localStorage.getItem(r);if(i){var o=JSON.parse(i);if(o.id===n.id){var a=Object.assign(Object.assign({},o),{expire:Date.now()+n.period});localStorage.setItem(n.getYKey(e),JSON.stringify(a)),n.renewal(e,t)}}}),.85*t);return this.renewalHandler.set(e,i),i}},{key:"getXKey",value:function(e){return"".concat(n.PREFIX_LOCK_X,"_").concat(e)}},{key:"getYKey",value:function(e){return"".concat(n.PREFIX_LOCK_Y,"_").concat(e)}},{key:"tryToLockKey",value:function(e,t,n,r){var i=this.getXKey(e),o=this.getYKey(e);localStorage.setItem(i,this.id);var a=localStorage.getItem(o);if(a&&JSON.parse(a).expire>Date.now())return void this.handleDetectLockFail(e,t,n,r);var c={id:this.id,expire:Date.now()+this.period,optional:t};localStorage.setItem(o,JSON.stringify(c)),localStorage.getItem(i)===this.id?n(c):this.delayDetect(e,t,n,r)}},{key:"delayDetect",value:function(e,t,n,r){var i=this,o=this.getYKey(e),a=localStorage.getItem(o),c=JSON.parse(a||"{}");setTimeout((function(){a&&c.id===i.id&&c.expire>Date.now()?n(c):i.handleDetectLockFail(e,t,n,r)}))}},{key:"handleDetectLockFail",value:function(e,t,n,r){var i=this,o=this.getYKey(e),a=localStorage.getItem(o),c=JSON.parse(a||"{}");0!==this.strategy?setTimeout((function(){return i.tryToLockKey(e,t,n,r)}),200):r(c)}}]),n}(y);function w(){return!!window.localStorage}function I(){return!!navigator.locks}function S(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p()(e);if(t){var i=p()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d()(this,n)}}j.PREFIX_LOCK_X="prefix_lock_x",j.PREFIX_LOCK_Y="prefix_lock_y";var E,x,C=function(e){s()(n,e);var t=S(n);function n(){var e;return i()(this,n),(e=t.apply(this,arguments)).releaseLockHandlerMap=new Map,e.lockManager=navigator.locks,e}return a()(n,[{key:"lock",value:function(e,t){var n=this;return new Promise((function(r){var i={isSuccess:!1,data:{id:n.id,expire:-1,optional:t}};n.lockManager.request(e,{ifAvailable:!0,mode:n.mode},(function(t){if(!t)return r(i),Promise.resolve();if(w())try{localStorage.setItem(e,JSON.stringify(i))}catch(e){}return i.isSuccess=!0,r(i),n.keepLock(e)}))}))}},{key:"release",value:function(e){if(!this.releaseLockHandlerMap.has(e))return Promise.resolve(!1);this.releaseLockHandlerMap.get(e)(),this.releaseLockHandlerMap.delete(e);try{localStorage.removeItem(e)}catch(e){}return Promise.resolve(!0)}},{key:"detectKey",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,h.a.mark((function t(){var n,r,i,o,a,c;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.lockManager.query();case 2:if(n=t.sent,r=n.held.some((function(t){return t.name===e})),i=!!this.releaseLockHandlerMap.has(e),o=new v(void 0,void 0),r&&!i){t.next=8;break}return t.abrupt("return",o);case 8:if(a={id:"",expire:-1,optional:{}},w())try{c=localStorage.getItem(e),a=JSON.parse(c)}catch(e){}return o.data=a,t.abrupt("return",o);case 12:case"end":return t.stop()}}),t,this)})))}},{key:"getDefaultConfig",value:function(){return{strategy:0,period:-1,autoRenewal:!1}}},{key:"keepLock",value:function(e){var t=this;return new Promise((function(n){var r;null===(r=t.releaseLockHandlerMap.get(e))||void 0===r||r(),t.releaseLockHandlerMap.set(e,n)}))}}]),n}(y),A=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"exclusive";if(i()(this,e),!w()&&!I())throw new Error("当前环境不支持使用锁机制");this.resourceLock=I()?new C(t,n):new j(t,n)}return a()(e,[{key:"lock",value:function(e,t){return Object(b.__awaiter)(this,void 0,void 0,h.a.mark((function n(){return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.resourceLock.lock(e,t);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n,this)})))}},{key:"release",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,h.a.mark((function t(){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.resourceLock.release(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"detectKey",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,h.a.mark((function t(){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.resourceLock.detectKey(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"getDefaultConfig",value:function(){return this.resourceLock.getDefaultConfig()}}]),e}();!function(e){e[e.ONCE=0]="ONCE",e[e.RETRY=1]="RETRY"}(E||(E={})),function(e){e.EXCLUSIVE="exclusive",e.SHARED="shared"}(x||(x={}))},ac1e2b0319:function(e,t,n){"use strict";var r=n("94b54f38ee");function i(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,n){if(!t)return e;var o;if(n)o=n(t);else if(r.isURLSearchParams(t))o=t.toString();else{var a=[];r.forEach(t,(function(e,t){null!=e&&(r.isArray(e)?t+="[]":e=[e],r.forEach(e,(function(e){r.isDate(e)?e=e.toISOString():r.isObject(e)&&(e=JSON.stringify(e)),a.push(i(t)+"="+i(e))})))})),o=a.join("&")}if(o){var c=e.indexOf("#");-1!==c&&(e=e.slice(0,c)),e+=(-1===e.indexOf("?")?"?":"&")+o}return e}},ad26985843:function(e,t,n){"use strict";var r=n("94b54f38ee");e.exports=function(e){return r.isObject(e)&&!0===e.isAxiosError}},ad36c1a004:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("cedf7830be"),i=Object(r.a)("INotificationDomainService")},b40f27bf29:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("b512c0eccb"),i=function(){this.instance=r.networkRequest}},b512c0eccb:function(e,t,n){"use strict";n.r(t),n.d(t,"BaseBackoff",(function(){return G})),n.d(t,"ConstantBackoff",(function(){return K})),n.d(t,"CustomBackoff",(function(){return oe})),n.d(t,"IterableBackoff",(function(){return se})),n.d(t,"REQUEST_ERROR_CODE",(function(){return r})),n.d(t,"RetryPolicy",(function(){return J})),n.d(t,"createNativeRequestInstance",(function(){return B})),n.d(t,"createNetworkRequestInstance",(function(){return ne})),n.d(t,"default",(function(){return ue})),n.d(t,"nativeRequest",(function(){return q})),n.d(t,"networkRequest",(function(){return re}));n("c6244f7705"),n("56683198d5"),n("73b854064b");var r,i,o=n("9132715560"),a=n.n(o),c=n("6a364eb35c"),s=n.n(c),u=n("bd29e2df90"),d=n.n(u),l=n("ab5eb40518"),p=n.n(l),f=n("1b4cdd6a36"),h=n.n(f),b=n("3ef2352f0b"),_=n.n(b),v=(n("8aebbf296a"),n("85d48ef22b"),n("081c8cafea"),n("d7c625d1f2")),y=(n("4a871f4295"),n("e8b2c0f5e8"),n("3bf1976a4f"),n("85d0a7609b")),g=n.n(y),m=(n("7b8243a880"),n("8e7cce0ada"),n("29f8c5f672"),n("2a6f332b5e"),n("d66c2b8c37"),n("47ca619755"),n("c14c4f06d8"),n("229fddc286"),n("7a5536c9bf")),O=n.n(m),j=(n("af802ec74b"),n("9cc8fbe3ef")),w=n.n(j);n("b8217400dc"),n("e6f68cdf2e"),n("6c6f26abf4");!function(e){e.aborted="ECONNABORTED",e.network="ERR_NETWORK",e.timeout="ETIMEDOUT",e.badRequest="ERR_BAD_REQUEST",e.badResponse="ERR_BAD_RESPONSE"}(r||(r={})),function(e){e[e.unknown=-1]="unknown",e[e.success=200]="success"}(i||(i={}));function I(e){return{data:e,status:i.success,statusText:"Success"}}function S(e){return{data:[],status:i.unknown,statusText:e}}var E=function(){function e(){a()(this,e),this.interceptors=[]}return s()(e,[{key:"add",value:function(e){this.interceptors.push(e)}},{key:"proceed",value:function(e){return Object(v.__awaiter)(this,void 0,void 0,_.a.mark((function t(){var n;return _.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Array.from(this.interceptors),this.fillBuildInInterceptors(n,e),t.abrupt("return",this.dispatch(e,n,0));case 3:case"end":return t.stop()}}),t,this)})))}},{key:"dispatch",value:function(e,t,n){var r=this;if(n>=t.length){var i=I([]);return Promise.resolve(i)}return t[n].intercept((function(){return r.dispatch(e,t,n+1)}),e)}}]),e}(),x=function(){function e(){var t,n;a()(this,e),this.canUseNativeAndroid=(null===(t=globalThis.mqq)||void 0===t?void 0:t.android)&&(null===(n=globalThis._mqqWebViewJSInterface)||void 0===n?void 0:n.invoke),this.currentSeqId=0,this.reqCallbacks=new Map}return s()(e,[{key:"JSApiCallback",value:function(e){var t=this.reqCallbacks.get(e.callbackId);if(!t)throw new Error("TypeError:[ark-request] the reqCallback of response[".concat(e.callbackId,"] can't found!"));t.callback(e)}},{key:"invokeNative",value:function(e,t,n,r){var i,o=null!=n?n:{},a=o.command;if(r){var c=this.createReqSeq();this.reqCallbacks.set(c,{callback:r,command:a,startTime:Date.now()}),o.callbackId=c}this.canUseNativeAndroid?this.invokeNativeAndroid(e,t,o):null===(i=globalThis.mqq)||void 0===i||i.invoke(e,t,o)}},{key:"invokeNativeAndroid",value:function(e,t,n){var r,i="jsbridge://".concat(encodeURIComponent(e),"/").concat(encodeURIComponent(t));n&&(i+="?p=".concat(encodeURIComponent(JSON.stringify(n)))),null===(r=globalThis._mqqWebViewJSInterface)||void 0===r||r.invoke(i)}},{key:"createReqSeq",value:function(){return this.currentSeqId+=1}}]),e}();globalThis.jsApi||(globalThis.jsApi=new x,globalThis.JSApiCallback||(globalThis.JSApiCallback=globalThis.jsApi.JSApiCallback.bind(globalThis.jsApi)));var C=globalThis.jsApi,A=function(){function e(){a()(this,e)}return s()(e,[{key:"invoke",value:function(e){return new Promise((function(t,n){if(!e.namespace)throw new Error("jsapi, namespace is null.");var r=e.params||{},i=e.callback?function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];t(I(n))}:void 0;try{C.invokeNative(e.namespace,e.method,r,i),i||t(I([]))}catch(e){n(S("Error:[ark-request] Jsapi invokeNative fail."))}}))}}]),e}();function k(e){return"[object Function]"===Object.prototype.toString.call(e)}var R,D,T=function(){function e(){a()(this,e)}return s()(e,[{key:"invoke",value:function(e){return Object(v.__awaiter)(this,void 0,void 0,_.a.mark((function t(){var n,r;return _.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(globalThis.mqq){t.next=2;break}throw new Error("UnknownError:[ark-request] mqq channel is undefined.");case 2:if(e.namespace){t.next=4;break}throw new Error("TypeError:[ark-request] mqq invoke has no namespace!");case 4:if(n=globalThis.mqq[e.namespace],!(r=null==n?void 0:n[e.method])||!k(r)){t.next=10;break}return t.next=9,this.innerModuleInvoke(r,e.params,e.callback);case 9:case 12:return t.abrupt("return",t.sent);case 10:return t.next=12,this.innerCoreInvoke(globalThis.mqq.invoke,e);case 13:case"end":return t.stop()}}),t,this)})))}},{key:"innerModuleInvoke",value:function(e,t,n){return new Promise((function(r,i){var o=[];t&&o.push(t),n&&o.push((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r(I(t))}));try{e.apply(void 0,o),n||r(I([]))}catch(e){i(S("Error:[ark-request] Mqq invoke module fail."))}}))}},{key:"innerCoreInvoke",value:function(e,t){return new Promise((function(n,r){try{e(t.namespace,t.method,t.params,(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];n(I(t))}))}catch(e){r(S("Error:[ark-request] Mqq invoke core[".concat(t.namespace,".").concat(t.method,"] fail.")))}}))}}]),e}();!function(e){e.mqq="mqq",e.jsapi="jsapi"}(D||(D={}));var N={schema:"mqq",channels:(R={},g()(R,D.mqq,T),g()(R,D.jsapi,A),R)},M=function(){function e(){a()(this,e)}return s()(e,[{key:"intercept",value:function(e,t){return Object(v.__awaiter)(this,void 0,void 0,_.a.mark((function e(){var n;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.schema){e.next=2;break}throw Error("TypeError[ark-request]: the schema of request(".concat(t.namespace,".").concat(t.method,") is undefined."));case 2:if(n=N.channels[t.schema]){e.next=5;break}throw Error("TypeError[ark-request]: can't match strategy to handle request(".concat(t.schema,".").concat(t.namespace,".").concat(t.method,")."));case 5:return e.next=7,(new n).invoke(t);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})))}}]),e}();function P(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h()(e);if(t){var i=h()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}var L=function(e){d()(n,e);var t=P(n);function n(){return a()(this,n),t.apply(this,arguments)}return s()(n,[{key:"fillBuildInInterceptors",value:function(e){return e.push(new M),e}}]),n}(E),U=function(){function e(t){a()(this,e),this.interceptors=t}return s()(e,[{key:"invoke",value:function(e){this.interceptors.proceed(Object.assign({schema:N.schema},e)).then((function(t){var n,r,i,o=t.data;null===(r=e.callback)||void 0===r||(n=r).call.apply(n,[e].concat(O()(o))),e.removeCallback&&(null===(i=e.params)||void 0===i?void 0:i.callbackId)&&C.reqCallbacks.delete(e.params.callbackId)}))}},{key:"register",value:function(e,t){if(!k(t))throw new Error("TypeError:[ark-request] The handler[".concat(e,"] to register is not function."));this.getNativeChannel()[this.generateCallbackName(e)]=t}},{key:"unregister",value:function(e){this.getNativeChannel()[this.generateCallbackName(e)]=void 0}},{key:"notify",value:function(e){var t=this.getNativeChannel()[this.generateCallbackName(e)];if(!k(t))throw new Error("TypeError:[ark-request] The handler[".concat(e,"] is not function!"));for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.apply(void 0,r)}},{key:"generateCallbackName",value:function(e){return e}},{key:"getNativeChannel",value:function(){return window}}]),e}();function B(){var e=new L;return new U(e)}var q=B(),F={maxRetry:3},V=function(){function e(){a()(this,e)}return s()(e,[{key:"intercept",value:function(e,t){return Object(v.__awaiter)(this,void 0,void 0,_.a.mark((function e(){return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.a.request(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))}}]),e}(),G=function(){function e(t){a()(this,e),this.duration=t,this.attempt=0}return s()(e,[{key:"next",value:function(e){throw new Error("Method not implemented.")}}]),e}();function W(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h()(e);if(t){var i=h()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}var K=function(e){d()(n,e);var t=W(n);function n(e,r){var i;return a()(this,n),(i=t.call(this,e)).limit=r,i}return s()(n,[{key:"next",value:function(){return void 0===this.limit?this:this.attempt>=this.limit?void 0:(this.attempt+=1,this)}}]),n}(G);new K(0,0);var H=function(){return!1},Q=function(){return!1},z=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:H,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Q;a()(this,e),this.errorFilter=t,this.resultFilter=n}return s()(e,[{key:"invoke",value:function(e,t){return Object(v.__awaiter)(this,void 0,void 0,_.a.mark((function n(){var r,i;return _.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e(t);case 3:if(r=n.sent,this.resultFilter(r)){n.next=6;break}return n.abrupt("return",{success:r});case 6:return n.abrupt("return",{value:r});case 9:if(n.prev=9,n.t0=n.catch(0),i=n.t0,this.errorFilter(i)){n.next=15;break}throw i;case 15:return n.abrupt("return",{error:i});case 16:case"end":return n.stop()}}),n,this,[[0,9]])})))}}]),e}(),Y=function(e){var t=Math.max(e,0);return 0===t?Promise.resolve():new Promise((function(e){return setTimeout(e,t)}))},J=function(){function e(t){var n;a()(this,e),this.options=t,this.executor=new z(t.errorFilter,t.resultFilter),this.backoffFactory=null!==(n=t.backoffFactory)&&void 0!==n?n:new K(0,t.maxRetry)}return s()(e,[{key:"execute",value:function(e){return Object(v.__awaiter)(this,void 0,void 0,_.a.mark((function t(){var n,r,i,o,a;return _.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=0;case 1:return r={attempt:n,startTimestamp:Date.now()},t.next=4,this.executor.invoke(e,r);case 4:if(!("success"in(i=t.sent))){t.next=7;break}return t.abrupt("return",i.success);case 7:if(!(n<this.options.maxRetry)){t.next=14;break}if(o={attempt:n+1,result:i},!(a=this.backoffFactory.next(o))){t.next=13;break}return t.next=13,Y(a.duration);case 13:return t.abrupt("continue",17);case 14:if(!("error"in i)){t.next=16;break}throw i.error;case 16:return t.abrupt("return",i.value);case 17:n++,t.next=1;break;case 20:case"end":return t.stop()}}),t,this)})))}}]),e}(),X=function(e){var t;return null===(t=e.message)||void 0===t?void 0:t.includes("timeout")},$=function(){function e(){a()(this,e)}return s()(e,[{key:"intercept",value:function(e,t){return Object(v.__awaiter)(this,void 0,void 0,_.a.mark((function n(){var r,i=this;return _.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(t.maxRetry<=0)){n.next=2;break}return n.abrupt("return",e());case 2:return r=new J(Object.assign({maxRetry:F.maxRetry,errorFilter:X},t)),n.abrupt("return",r.execute((function(t){return Object(v.__awaiter)(i,void 0,void 0,_.a.mark((function n(){var r;return _.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e();case 2:return(r=n.sent).retryContext=t,n.abrupt("return",r);case 5:case"end":return n.stop()}}),n)})))})));case 4:case"end":return n.stop()}}),n)})))}}]),e}();function Z(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h()(e);if(t){var i=h()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}var ee=function(e){d()(n,e);var t=Z(n);function n(){return a()(this,n),t.apply(this,arguments)}return s()(n,[{key:"fillBuildInInterceptors",value:function(e,t){var n;return(null!==(n=t.maxRetry)&&void 0!==n?n:F.maxRetry)>0&&e.push(new $),e.push(new V),e}}]),n}(E),te=function(){function e(t,n){a()(this,e),this.defaults=t,this.interceptors=n}return s()(e,[{key:"get",value:function(e,t){return this.dispatchRequest("get",e,void 0,t)}},{key:"post",value:function(e,t,n){return this.dispatchRequest("post",e,t,n)}},{key:"request",value:function(e){return this.interceptors.proceed(Object.assign(Object.assign({},this.defaults),e))}},{key:"dispatchRequest",value:function(e,t,n,r){var i,o=null!=r?r:{},a=null!==(i=o.headers)&&void 0!==i?i:{};return o.contentType&&(a["Content-Type"]=o.contentType),this.interceptors.proceed(Object.assign(Object.assign(Object.assign({},this.defaults),o),{url:t,method:e,headers:a,data:null!=n?n:o.data}))}}]),e}();function ne(e){var t=new ee;return new te(e||F,t)}var re=ne();function ie(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h()(e);if(t){var i=h()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}var oe=function(e){d()(n,e);var t=ie(n);function n(e){var r,i;return a()(this,n),(r=t.call(this,null!==(i=e({attempt:0}))&&void 0!==i?i:0)).generator=e,r}return s()(n,[{key:"next",value:function(e){var t=this.generator(e);if(t)return this.duration=t,this}}]),n}(G);function ae(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h()(e);if(t){var i=h()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}var ce=function(e){return Math.max(null!=e?e:0,0)},se=function(e){d()(n,e);var t=ae(n);function n(e){var r,i;return a()(this,n),(r=t.call(this,null!==(i=ce(e[0]))&&void 0!==i?i:0)).durations=e,r}return s()(n,[{key:"next",value:function(){if(!(this.attempt>=this.durations.length))return this.duration=ce(this.durations[this.attempt]),this.attempt+=1,this}}]),n}(G),ue={}},b6b7caa0aa:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n("5be39fbf8a"),i=n("ddb86d0a26"),o=function(){function e(){}return e.prototype.jsonObj2Class=function(t,n){var i=this;t?Object.keys(t).forEach((function(o){var a=o;n||(a=Object(r.n)(o)),Object.prototype.hasOwnProperty.call(i,a)&&(i[a]instanceof e?i[a].jsonObj2Class(t[o]):i[a]=t[o])})):e.logger.debug("params erroro: jsonObj2Class")},e.prototype.class2JsonObj=function(t){var n=this,i={};return Object.keys(this).forEach((function(o){if("id"!==o){var a=o;t||(a=Object(r.a)(o)),n[o]instanceof e&&(i[a]=n[o].class2JsonObj(t)),i[a]=n[o]}})),i},e.logger=new i.a("DDBase").use("console"),e}()},b6e58b965b:function(e,t,n){"use strict";var r=n("d7c625d1f2"),i=n("76702c352f"),o=n("03808c4177"),a=n("5be39fbf8a"),c=n("6423ed0b81"),s=n("624cdb524f"),u=n("6fa7b8d7bc"),d=n("8b932bcade"),l=n("fb1099018f"),p="".concat(l.c,"user_info"),f="".concat(l.h,"/api/userinfo/set"),h="".concat(l.h,"/doc/info"),b=function(){function e(e){this.networkRequestService=e}return e.prototype.getPersonalUserInfo=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(r.__generator)(this,(function(n){return e=Object(c.c)(c.a.xsrf),t="".concat(p,"?xsrf=").concat(e,"&get_vip_info=1"),[2,this.networkRequestService.instance.get(t)]}))}))},e.prototype.updatePersonalNicknameAndAvatar=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n,i;return Object(r.__generator)(this,(function(r){return t=e.nick,n=e.avatar,i=Object(a.d)({nick:t,avatar:n}),[2,this.networkRequestService.instance.post(f,i)]}))}))},e.prototype.getEnterpriseUserInfo=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e;return Object(r.__generator)(this,(function(t){switch(t.label){case 0:return[4,d.a.getUserInfo()];case 1:return e=t.sent(),[2,Object(s.a)(e)]}}))}))},e.prototype.getEnterpriseDocInfo=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(r.__generator)(this,(function(i){return this.enterpriseDocInfoPromise&&!e||(t=Object(u.a)(h,{xrsf:"".concat(Object(c.c)(c.a.xsrf)),func:4}),n=this.networkRequestService.instance.get(t).then((function(e){return Object(r.__assign)(Object(r.__assign)({},e),{data:Object(r.__assign)(Object(r.__assign)({},e.data),{retcode:e.data.head.ret,msg:e.data.head.msg})})})),this.enterpriseDocInfoPromise=n),[2,this.enterpriseDocInfoPromise]}))}))},Object(r.__decorate)([Object(i.b)(),Object(i.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"getPersonalUserInfo",null),Object(r.__decorate)([Object(i.b)(),Object(i.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"updatePersonalNicknameAndAvatar",null),Object(r.__decorate)([Object(i.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Boolean]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"getEnterpriseDocInfo",null),e=Object(r.__decorate)([Object(r.__param)(0,o.a),Object(r.__metadata)("design:paramtypes",[Object])],e)}();t.a=b},b7cba4397b:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=n("d7a2286b24").default.getInstance()},b8775a3aa8:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("cedf7830be"),i=Object(r.a)("IFileDomainService")},b9d0dec2ff:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("d7c625d1f2"),i=function(e){function t(t){var n=e.call(this)||this;return n.background={},n.mode=0,n.titleColor={},n.isExpire=!1,n.jsonObj2Class(t),n}return Object(r.__extends)(t,e),t}(n("61cea32eb2").a)},baa9fada98:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CancellationTokenSource=void 0;var r=n("4bae7615ca"),i=function(){function e(){this.isCancelled=!1}return e.prototype.cancel=function(){this.isCancelled||(this.isCancelled=!0)},Object.defineProperty(e.prototype,"isCancellationRequested",{get:function(){return this.isCancelled},enumerable:!1,configurable:!0}),e}(),o=function(){function e(){this.innertoken=void 0}return Object.defineProperty(e.prototype,"token",{get:function(){return this.innertoken||(this.innertoken=new i),this.innertoken},enumerable:!1,configurable:!0}),e.prototype.cancel=function(){this.innertoken?this.innertoken instanceof i&&this.innertoken.cancel():this.innertoken=r.CancellationTokenState.Cancelled},e.prototype.dispose=function(){this.cancel()},e}();t.CancellationTokenSource=o},bc0f24c59d:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("d7c625d1f2"),i=function(e){function t(t){var n=e.call(this)||this;return n.isCreator=!1,n.isAdmin=!1,n.isOwner=!1,n.isViewer=!1,n.jsonObj2Class(t),n}return Object(r.__extends)(t,e),t}(n("61cea32eb2").a)},bf3ff0c91e:function(e,t,n){"use strict";var r=n("94b54f38ee");e.exports=r.isStandardBrowserEnv()?{write:function(e,t,n,i,o,a){var c=[];c.push(e+"="+encodeURIComponent(t)),r.isNumber(n)&&c.push("expires="+new Date(n).toGMTString()),r.isString(i)&&c.push("path="+i),r.isString(o)&&c.push("domain="+o),!0===a&&c.push("secure"),document.cookie=c.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},c33f52ea47:function(e,t,n){"use strict";var r,i,o;n.d(t,"a",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return o})),function(e){e[e.DEFAULT=0]="DEFAULT",e[e.SHOW=1]="SHOW",e[e.HIDE=2]="HIDE"}(r||(r={})),function(e){e[e.SELF=0]="SELF",e[e.COOPERATION=1]="COOPERATION",e[e.VIEWABLE=2]="VIEWABLE",e[e.EDITABLE=3]="EDITABLE"}(i||(i={})),function(e){e[e.deny=0]="deny",e[e.whitelist=1]="whitelist",e[e.allOnlyRead=2]="allOnlyRead",e[e.allOnlyWrite=3]="allOnlyWrite",e[e.allOnlyExecute=4]="allOnlyExecute",e[e.invalidPolicy=999]="invalidPolicy"}(o||(o={}))},c398fb2896:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n("d7c625d1f2"),i=n("76702c352f"),o=n("03808c4177"),a=n("5be39fbf8a"),c=n("65e41bd588"),s=n("6423ed0b81"),u=n("6fa7b8d7bc"),d=n("d861d3fe93"),l=function(){function e(e){this.networkRequestService=e}return e.prototype.logout=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){return t=Object(u.a)(d.g,Object(r.__assign)({xrsf:"".concat(Object(s.c)(s.a.xsrf))},e&&{u:e})),[2,this.networkRequestService.instance.get(t)]}))}))},e.prototype.wecomLogoutForBDomain=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){return t=Object(u.a)(d.d,{xrsf:"".concat(Object(s.c)(s.a.xsrf)),sid:e}),[2,this.networkRequestService.instance.get(t)]}))}))},e.prototype.wecomLogoutForCDomain=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){return t=Object(u.a)(d.e,{xrsf:"".concat(Object(s.c)(s.a.xsrf)),vid:e}),[2,this.networkRequestService.instance.get(t)]}))}))},e.prototype.unbindUserInfo=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){return t=Object(a.d)({type:e,xsrf:Object(s.c)(s.a.xsrf)}),[2,this.networkRequestService.instance.post(d.b,t)]}))}))},e.prototype.bindUserInfo=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e;return Object(r.__generator)(this,(function(t){return e=Object(a.d)({bindType:c.a.QQ,p_luin:Object(s.b)("p_luin"),p_uin:Object(s.b)("p_uin"),p_skey:Object(s.b)("p_skey"),p_lskey:Object(s.b)("p_lskey"),xsrf:Object(s.c)(s.a.xsrf)}),[2,this.networkRequestService.instance.post(d.a,e)]}))}))},e.prototype.CurrentLoginAccountBindInfo=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){return[2,this.networkRequestService.instance.get(d.f)]}))}))},e.prototype.BindingAccountInfo=function(){return Object(r.__awaiter)(this,arguments,void 0,(function(e){var t,n;return void 0===e&&(e=!1),Object(r.__generator)(this,(function(i){return t=Object(r.__assign)({},e?{uflag:"qqsig"}:null),n=Object(u.a)(d.c,t),[2,this.networkRequestService.instance.get(n)]}))}))},e.prototype.getBindWxQrCode=function(e){var t="".concat(d.k,"?xsrf=").concat(Object(s.c)(s.a.xsrf),"&page=").concat(encodeURIComponent("pages/bindwx/bindwx"),"&ac=bind&ts=").concat(Date.now(),"&u=").concat(e,"&checkKey=1");return this.networkRequestService.instance.get(t)},e.prototype.getBindProcess=function(e){var t="".concat(d.h,"?CheckKey=").concat(e);return this.networkRequestService.instance.post(t)},e.prototype.getPersonalUserInfo=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(r.__generator)(this,(function(n){return e=Object(s.c)(s.a.xsrf),t="".concat(d.j,"?xsrf=").concat(e,"&get_vip_info=1"),[2,this.networkRequestService.instance.get(t)]}))}))},e.prototype.getCertificationGrey=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){return[2,this.networkRequestService.instance.get(d.i)]}))}))},Object(r.__decorate)([Object(i.b)(),Object(i.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"logout",null),Object(r.__decorate)([Object(i.b)(),Object(i.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"wecomLogoutForBDomain",null),Object(r.__decorate)([Object(i.b)(),Object(i.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"wecomLogoutForCDomain",null),Object(r.__decorate)([Object(i.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Number]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"unbindUserInfo",null),Object(r.__decorate)([Object(i.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"bindUserInfo",null),Object(r.__decorate)([Object(i.b)(),Object(i.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"CurrentLoginAccountBindInfo",null),Object(r.__decorate)([Object(i.b)(),Object(i.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"BindingAccountInfo",null),Object(r.__decorate)([Object(i.b)(),Object(i.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"getBindWxQrCode",null),Object(r.__decorate)([Object(i.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"getBindProcess",null),Object(r.__decorate)([Object(i.b)(),Object(i.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"getPersonalUserInfo",null),Object(r.__decorate)([Object(i.b)(),Object(i.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"getCertificationGrey",null),e=Object(r.__decorate)([Object(r.__param)(0,o.a),Object(r.__metadata)("design:paramtypes",[Object])],e)}()},c5371f6846:function(e,t,n){"use strict";var r=n("94b54f38ee"),i=n("d3e4db71be"),o=n("e9fad8bcaf"),a=n("4498e7a6fb");var c=function e(t){var n=new o(t),c=i(o.prototype.request,n);return r.extend(c,o.prototype,n),r.extend(c,n),c.create=function(n){return e(a(t,n))},c}(n("58bffcf462"));c.Axios=o,c.Cancel=n("1cc181d9f8"),c.CancelToken=n("f42cbfcd9d"),c.isCancel=n("052105b914"),c.VERSION=n("31a899c9f3").version,c.all=function(e){return Promise.all(e)},c.spread=n("39cb95f88d"),c.isAxiosError=n("ad26985843"),e.exports=c,e.exports.default=c},c564d09b70:function(e,t,n){"use strict";n.d(t,"a",(function(){return i.h})),n.d(t,"b",(function(){return j}));var r=n("d7c625d1f2"),i=n("52bbb6cc53"),o=n("9c60cb7ff5"),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(r.__extends)(t,e),t.prototype.isQuotaExceeded=function(){return this.message.includes("QuotaExceededError")},t}(o.a.withMessageCreator("DatabaseConnectError",(function(e){return"failed to connect to database '"+e+"'."}))),c=o.a.withMessageCreator("CollectionNotFoundError",(function(e){return"model '"+e+"' is not registered, please register it before use it."})),s=o.a.withMessageCreator("DataMigrationError",(function(e){return"failed to perform data migration, versionChange: "+e.oldVersion+" -> "+e.newVersion+"."})),u=o.a.withMessageCreator("IncorrectTransactionModeError",(function(e){return"use error transaction type["+e+"]."})),d=o.a.withMessageCreator("NoTableInfoError",(function(e){return"'"+e+"' is not a valid model with table info injected, please ensure the model class is decorated by @table(), @field() etc."})),l=(o.a.withDefaultMessage("EmptyTableInfoError","table without any field declare, please define model use [field] decorator."),o.a.withMessageCreator("InvalidWhereInValueError",(function(e){return"there is an error in your where clause of field '"+e.path+"'."+e.op+", the value must be an array."}))),p=o.a.withMessageCreator("UnsupportedWhereOperatorError",(function(e){return"unsupported where operator '"+e+"', current supported operators are >, >=, <, <=, =, !=, in, nin."})),f=o.a.withDefaultMessage("OrderByKeyError","can not order value that is not Key: 'Key = number | string | Date | BufferSource | Key[]'."),h=o.a.withMessageCreator("DatabaseInternalError",(function(e){return"there is an internal error of database, reason: "+e+"."})),b=(o.a.withMessageCreator("QueryJobError",(function(e){return"failed to execute query job, reason: "+e+"."})),o.a.withMessageCreator("PluginError",(function(e){return'an error has occurred on plugin "'+e.name+'"": '+e.message+"."})),o.a.withDefaultMessage("TransactionCommitError","failed to commit transaction.")),_=o.a.withDefaultMessage("UpdateMigrationChangeInfoError","failed to update migration change info"),v=o.a.withMessageCreator("ExecuteDataUpgradeError",(function(e){return"failed to execute data upgrade on collection '"+e+"'."})),y=o.a.withMessageCreator("UnexpectedClosedError",(function(e){return"database "+e+" is unexpectedly closed by browser, this could happen when disk is unavailable or the page is shutdown."})),g=Symbol.for("TABLE_KEY"),m=function(){function e(){}return e.saveTableInfo=function(e,t){Object.defineProperty(t,g,{configurable:!0,value:Object(r.__assign)({},e)})},e.getTableInfo=function(e){return e[g]},e.getFirstTableInfoAlongPrototypeChain=function(e){var t=this.getTableInfo(e),n=Object.assign({},t);return n.properties=new Map(n.properties),n},e.getTableName=function(e){var t=this.getTableInfo(e.prototype);if(!(null==t?void 0:t.tableName))throw new d(e.name);return t.tableName},e.addTablePropertyInfo=function(t,n){var r=e.getOrCreateTableInfo(t);if(r.properties.has(n.name)){var i=r.properties.get(n.name);Object.assign(n,i)}r.properties.set(n.name,n),this.saveTableInfo(r,t)},e.createPropertyInfo=function(e,t){return{name:e,alias:t,isUnionKey:!1}},e.convertTableInfoToSchema=function(e){if(!e.tableName)return null;var t,n=Object(r.__spreadArray)([],Object(r.__read)(e.properties.values())),o=n.filter((function(e){return e.isIndex})).map((function(e){var t,n;return{name:null!==(t=e.alias)&&void 0!==t?t:e.name,path:null!==(n=e.alias)&&void 0!==n?n:e.name,unique:e.isUnique}}));return t=!e.autoIncrement&&e.keyPath?{path:1===e.keyPath.length?e.keyPath[0]:e.keyPath}:{generator:i.b.AutoIncrement},{properties:n.map((function(e){var t;return null!==(t=e.alias)&&void 0!==t?t:e.name})),indices:o,key:t,name:e.tableName}},e.createDefaultTableInfo=function(){return{tableName:null,autoIncrement:!0,properties:new Map}},e.getOrCreateTableInfo=function(t){if(Object.prototype.hasOwnProperty.call(t,g))return t[g];var n=e.createDefaultTableInfo(),i=t[g];return i&&(n.properties=new Map(Object(r.__spreadArray)(Object(r.__spreadArray)([],Object(r.__read)(i.properties)),Object(r.__read)(n.properties)))),e.saveTableInfo(n,t),n},e}();let O=()=>({events:{},emit(e,...t){(this.events[e]||[]).forEach((e=>e(...t)))},on(e,t){return(this.events[e]=this.events[e]||[]).push(t),()=>this.events[e]=(this.events[e]||[]).filter((e=>e!==t))}});var j,w;!function(e){e.Ready="Ready",e.Fetal="Fetal",e.Closed="Closed",e.Destroyed="Destroyed",e.Error="Error",e.RegisterModel="RegisterModel",e.RegisterPlugin="RegisterPlugin",e.BootstrapStart="BootstrapStart",e.BootstrapEnd="BootstrapEnd",e.SchemaMigrationStart="SchemaMigrationStart",e.SchemaMigrationEnd="SchemaMigrationEnd",e.VersionChange="VersionChange"}(j||(j={})),function(e){e.CollectionCreated="CollectionCreated",e.ModelLazyMigrationEnd="ModelLazyMigrationEnd",e.PrepareAutoUpgradeEnd="PrepareAutoUpgradeEnd",e.UpdateMigrationChangeInfo="UpdateMigrationChangeInfoEnd",e.StartTransaction="StartTransaction"}(w||(w={}));var I,S=function(){function e(e){var t=this;this.onClosed=function(e){t.eventBus.on(j.Closed,e)},this.eventBus=e}return e.prototype.onReady=function(e){this.eventBus.on(j.Ready,e)},e.prototype.onFetal=function(e){this.eventBus.on(j.Fetal,e)},e.prototype.onError=function(e){this.eventBus.on(j.Error,e)},e.prototype.onRegisterModel=function(e){this.eventBus.on(j.RegisterModel,e)},e.prototype.onRegisterPlugin=function(e){this.eventBus.on(j.RegisterPlugin,e)},e.prototype.onBootstrapStart=function(e){this.eventBus.on(j.BootstrapStart,e)},e.prototype.onBootstrapEnd=function(e){this.eventBus.on(j.BootstrapEnd,e)},e.prototype.onSchemaMigrationStart=function(e){this.eventBus.on(j.SchemaMigrationStart,e)},e.prototype.onSchemaMigrationEnd=function(e){this.eventBus.on(j.SchemaMigrationEnd,e)},e.prototype.onVersionChange=function(e){this.eventBus.on(j.VersionChange,e)},e.prototype.emitError=function(e){this.eventBus.emit(j.Error,e)},e}(),E=function(){function e(){}return e.revealSchema=function(e){var t=m.getTableInfo(e.prototype);return t?m.convertTableInfoToSchema(t):null},e}(),x=function(){function e(e){this.models=[],this.eventBus=e}return e.prototype.register=function(e){if(!this.models.includes(e)){var t=this.getSchema(e);this.models.push(e),this.eventBus.emit(j.RegisterModel,{class:e,schema:t})}},e.prototype.getSchema=function(e){var t=E.revealSchema(e);if(!t){var n=new d(e.name);throw this.eventBus.emit(j.Error,n),new d(e.name)}return t},e.prototype.getSchemaAndRegisterModelIfNeed=function(e){return this.register(e),this.getSchema(e)},e}();function C(e){var t,n,i,o=m.getTableInfo(Object.getPrototypeOf(e));if(!o)return e;var a={};try{for(var c=Object(r.__values)(o.properties.values()),s=c.next();!s.done;s=c.next()){var u=s.value;a[null!==(i=u.alias)&&void 0!==i?i:u.name]=e[u.name]}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}return a}function A(e,t){var n,i;if(null==e)return null;var o=m.getTableInfo(t.prototype);if(!o)return e;var a=function(e,t){var n,i,o,a={};try{for(var c=Object(r.__values)(t.properties.values()),s=c.next();!s.done;s=c.next()){var u=s.value,d=null!==(o=u.alias)&&void 0!==o?o:u.name;a[u.name]=e[d]}}catch(e){n={error:e}}finally{try{s&&!s.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}return a}(e,o),c=new t(a);try{for(var s=Object(r.__values)(Object.keys(a)),u=s.next();!u.done;u=s.next()){var d=u.value;void 0!==a[d]&&(c[d]=a[d])}}catch(e){n={error:e}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}return c}!function(e){e.FILL="fill",e.HYDRATE="hydrate",e.PAGINATE="paginate",e.FILTER="filter",e.SORT="sort",e.SCAN="scan",e.SCAN_ALL="scan-all",e.INDEX_SCAN="index-scan",e.UNION="union",e.DISTINCT="distinct",e.INTERSECT="intersect"}(I||(I={}));var k=function(){function e(e,t){this.node=e,this.parent=t,this.context=Q(e)}return e.prototype.perform=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,o,a;return Object(r.__generator)(this,(function(c){try{for(t=Object(r.__values)(this.node.inputs),n=t.next();!n.done;n=t.next())i=n.value,e.push(i)}catch(e){o={error:e}}finally{try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(o)throw o.error}}return[2]}))}))},e}(),R=function(){function e(e){this.comparer=e}return e.prototype.has=function(e,t){return-1!==this.getOrder(e,t)},e.prototype.getOrder=function(e,t){for(var n=0,r=e.length;n<r;){var i=n+Math.floor((r-n)/2),o=e[i],a=this.comparer.cmp(t,o);if(0===a)return i;a>0?n=i+1:r=i}return-1},e}(),D=function(){function e(e,t){this.node=e,this.parent=t,this.context=Q(e)}return e.prototype.perform=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,o,a,c,s,u,d,l,p,f,h,b,_,v,y;return Object(r.__generator)(this,(function(g){t=new R(this.node.comparer);try{for(n=Object(r.__values)(this.context.inputs),i=n.next();!i.done;i=n.next()){o=i.value,a=new Map,c=o.map((function(e){return Object(r.__read)(e,1)[0]})).sort(this.node.comparer.cmp),s=[];try{for(v=void 0,u=Object(r.__values)(o),d=u.next();!d.done;d=u.next())l=d.value,p=Object(r.__read)(l,1),f=p[0],h=t.getOrder(c,f),a.has(h)||(a.set(h,!0),s.push(l))}catch(e){v={error:e}}finally{try{d&&!d.done&&(y=u.return)&&y.call(u)}finally{if(v)throw v.error}}e.push(s)}}catch(e){b={error:e}}finally{try{i&&!i.done&&(_=n.return)&&_.call(n)}finally{if(b)throw b.error}}return[2]}))}))},e}(),T=Symbol("-∞"),N=Symbol("+∞"),M=function(){function e(e){var t=this;this.contains=function(e,n){var r=t,i=r.cmp,o=r.lowerOf,a=r.upperOf;if(!t.isValid(e))return!1;var c=e.lowerOpen,s=e.upperOpen,u=i(o(e),n),d=i(a(e),n);return 0===u&&!c||u<0&&d>0||0===d&&!s},this.union=function(e){if(e.length<=1)return e;t.sort(e);for(var n=[],r=e[0],i=1;i<e.length;i++){var o=e[i];t.isOverlapped(r,o)?r=t.wrap(r,o):(n.push(r),r=o)}return n.push(r),n},this.intersect=function(e){var n,i;if(e.length<=1)return e;t.sort(e);var o=e[0];try{for(var a=Object(r.__values)(e),c=a.next();!c.done;c=a.next()){var s=c.value;if(!t.isOverlapped(o,s))return[];o=t.overlap(o,s)}}catch(e){n={error:e}}finally{try{c&&!c.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return[o]},this.isValid=function(e){var n=t,r=n.cmp,i=n.lowerOf,o=n.upperOf,a=r(i(e),o(e));return a<0||0===a&&!e.lowerOpen&&!e.upperOpen},this.cmp=function(e,n){return e!==T&&e!==N&&n!==T&&n!==N?t.comparer.cmp(e,n):e===n?0:e===T||n===N?-1:1},this.lowerOf=function(e){return void 0===e.lower?T:e.lower},this.upperOf=function(e){return void 0===e.upper?N:e.upper},this.comparer=e}return e.prototype.isOverlapped=function(e,t){var n,i=this,o=i.cmp,a=i.lowerOf,c=i.upperOf,s=Object(r.__read)([e,t],2),u=s[0],d=s[1],l=o(a(u),a(d));(l>0||0===l&&!u.lowerOpen&&d.lowerOpen)&&(u=(n=Object(r.__read)([d,u],2))[0],d=n[1]);var p=o(c(u),a(d));return p>0||0===p&&!u.upperOpen&&!d.lowerOpen},e.prototype.sort=function(e){var t=this.cmp,n=this.lowerOf;return e.sort((function(e,r){var i=t(n(e),n(r));return 0!==i||e.lowerOpen===r.lowerOpen?i:e.lowerOpen?-1:1}))},e.prototype.wrap=function(e,t){var n=this,i=n.cmp,o=n.lowerOf,a=n.upperOf,c=Object(r.__assign)({},e),s=i(o(e),o(t)),u=i(a(e),a(t));return(s>0||0===s&&!t.lowerOpen)&&(c.lower=t.lower,c.lowerOpen=t.lowerOpen),(u<0||0===u&&!t.upperOpen)&&(c.upper=t.upper,c.upperOpen=t.upperOpen),c},e.prototype.overlap=function(e,t){var n=this,i=n.cmp,o=n.lowerOf,a=n.upperOf,c=Object(r.__assign)({},e),s=i(o(e),o(t)),u=i(a(e),a(t));return(s<0||0===s&&!e.lowerOpen)&&(c.lower=t.lower,c.lowerOpen=t.lowerOpen),(u>0||0===u&&!e.upperOpen)&&(c.upper=t.upper,c.upperOpen=t.upperOpen),c},e}(),P=function(){function e(e,t){this.node=e,this.parent=t,this.context=Q(e)}return e.prototype.perform=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,o,a,c,s,u,d;return Object(r.__generator)(this,(function(l){for(t=[],n=this.node,i=[t];n;)n.regroup&&(t=[],i.push(t)),t.push(this.createFilter(n)),n=n.nextFilter;o=function(e){var t=Object(r.__read)(e,2)[1];return i.some((function(e){return e.every((function(e){return e(t)}))}))};try{for(a=Object(r.__values)(this.context.inputs),c=a.next();!c.done;c=a.next())s=c.value,e.push(s.filter(o))}catch(e){u={error:e}}finally{try{c&&!c.done&&(d=a.return)&&d.call(a)}finally{if(u)throw u.error}}return[2]}))}))},e.prototype.createFilter=function(e){var t=new M(e.comparer);return function(n){return e.intervals.some((function(r){if(void 0===n)throw new h("can not do filter on non-hydrated data");var o=Object(i.m)(n,e.path);return Object(i.n)(o)&&t.contains(r,o)}))}},e}();var L=function(){function e(e,t,n){this.node=e,this.parent=t,this.transaction=n,this.context=Q(e)}return e.prototype.perform=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,o,a,c,s,u,d=this;return Object(r.__generator)(this,(function(l){switch(l.label){case 0:t=this.transaction.table(this.node.collectionSchema.name),n=function(n){var i;return Object(r.__generator)(this,(function(o){switch(o.label){case 0:return i=n.filter((function(e){return!function(e){return!!Object(r.__read)(e,2)[1]}(e)})),[4,Promise.all(i.map((function(e,n){var o=Object(r.__read)(e,1)[0];return Object(r.__awaiter)(d,void 0,void 0,(function(){var e;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,t.get(o)];case 1:return e=r.sent(),i[n][1]=e,[2]}}))}))})))];case 1:return o.sent(),e.push(n),[2]}}))},l.label=1;case 1:l.trys.push([1,6,7,8]),i=Object(r.__values)(this.context.inputs),o=i.next(),l.label=2;case 2:return o.done?[3,5]:(a=o.value,[5,n(a)]);case 3:l.sent(),l.label=4;case 4:return o=i.next(),[3,2];case 5:return[3,8];case 6:return c=l.sent(),s={error:c},[3,8];case 7:try{o&&!o.done&&(u=i.return)&&u.call(i)}finally{if(s)throw s.error}return[7];case 8:return[2]}}))}))},e}(),U=function(){function e(e,t,n,r){this.lower=e,this.upper=t,this.lowerOpen=n,this.upperOpen=r}return e.getKeyRange=function(e,t){if(void 0!==t){if(!e.isValid(t))throw new Error("invalid key interval");var n=t.lower,r=t.upper,i=t.lowerOpen,o=t.upperOpen;return n===r?n:void 0!==n&&void 0!==r?IDBKeyRange.bound(n,r,i,o):void 0!==n?IDBKeyRange.lowerBound(n,i):IDBKeyRange.upperBound(r,o)}},e}(),B=function(){function e(e,t){var n=this;this.comparer=t,this.math=new M(t),this.intervals=e.filter((function(e){return n.math.isValid(e)}))}return e.fromWherePredicate=function(t,n){var i,o,a;try{for(var c=Object(r.__values)(Object.keys(t)),s=c.next();!s.done;s=c.next()){var u=s.value,d=t[u];if(void 0!==d){var l=e.fromWhereExp(u,d,n);a=a?a.intersect(l):l}}}catch(e){i={error:e}}finally{try{s&&!s.done&&(o=c.return)&&o.call(c)}finally{if(i)throw i.error}}return a||this.createFullGroup(n)},e.fromWhereExp=function(t,n,r){var o;if(t===i.k.In||t===i.k.NotIn){if(!Array.isArray(n))throw new l({op:t});var a=n;return t===i.k.In?a.reduce((function(t,n){return t.union(e.fromWhereExp(i.k.Equals,n,r))}),this.createEmptyGroup(r)):a.reduce((function(t,n,o){var a=e.fromWhereExp(i.k.NotEquals,n,r);return o?t.intersect(a):a}),this.createFullGroup(r))}switch(t){case i.k.Equals:o=[new U(n,n,!1,!1)];break;case i.k.NotEquals:o=[new U(void 0,n,!0,!0),new U(n,void 0,!0,!0)];break;case i.k.GreaterThan:o=[new U(n,void 0,!0,!0)];break;case i.k.GreaterOrEqualThan:o=[new U(n,void 0,!1,!0)];break;case i.k.LessThan:o=[new U(void 0,n,!0,!0)];break;case i.k.LessOrEqualThan:o=[new U(void 0,n,!0,!1)];break;default:throw new p(t)}return new e(o,r)},e.prototype.union=function(t){return new e(this.math.union(Object(r.__spreadArray)(Object(r.__spreadArray)([],Object(r.__read)(this.intervals)),Object(r.__read)(t.intervals))),this.comparer)},e.prototype.intersect=function(t){for(var n=this.math,i=n.cmp,o=n.upperOf,a=n.lowerOf,c=n.intersect,s=Object(r.__read)([this.intervals,t.intervals],2),u=s[0],d=s[1],l=Object(r.__read)([0,0],2),p=l[0],f=l[1],h=[];p<u.length;){for(;f<d.length&&i(o(u[p]),a(d[f]))>=0;){var b=c([u[p],d[f]]);h.push.apply(h,Object(r.__spreadArray)([],Object(r.__read)(b))),f+=1}f-=1,p+=1}return new e(h,this.comparer)},e.prototype.contains=function(e){var t=this;return!!this.intervals.find((function(n){return t.math.contains(n,e)}))},e.prototype.isEmpty=function(){return 0===this.intervals.length},e.prototype.isFull=function(){return!!this.intervals.length&&void 0===this.intervals[0].lower&&void 0===this.intervals[0].upper},e.createFullGroup=function(t){return new e([new U(void 0,void 0,!0,!0)],t)},e.createEmptyGroup=function(t){return new e([],t)},e}(),q=U,F=function(){function e(e,t,n){this.node=e,this.parent=t,this.transaction=n,this.context=Q(e)}return e.prototype.perform=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n,o,a,c;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return this.node.hydrate?[3,2]:[4,this.scanKeys()];case 1:return t=r.sent(),e.push(t.map((function(e){return[e,void 0]}))),[2];case 2:return(n=this.node.collectionSchema.key.path)?[4,this.scanValues()]:[3,4];case 3:return o=r.sent(),e.push(o.map((function(e){return[Object(i.m)(e,n),e]}))),[2];case 4:return[4,this.scanKeys()];case 5:return a=r.sent(),[4,this.scanValues()];case 6:return c=r.sent(),e.push(a.map((function(e,t){return[e,c[t]]}))),[2]}}))}))},e.prototype.scanKeys=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return e=this.getKeyQueries(),t=this.getIndex(),[4,Promise.all(e.map((function(e){return t.getAllKeys(e)})))];case 1:return[2,n.sent().reduce((function(e,t){return e.push.apply(e,Object(r.__spreadArray)([],Object(r.__read)(t))),e}),[])]}}))}))},e.prototype.scanValues=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return e=this.getKeyQueries(),t=this.getIndex(),[4,Promise.all(e.map((function(e){return t.getAll(e)})))];case 1:return[2,n.sent().reduce((function(e,t){return e.push.apply(e,Object(r.__spreadArray)([],Object(r.__read)(t))),e}),[])]}}))}))},e.prototype.getKeyQueries=function(){var e=new M(this.node.comparer);return this.node.intervals.map((function(t){return q.getKeyRange(e,t)}))},e.prototype.getIndex=function(){var e=this.node,t=e.collectionSchema,n=e.index;return this.transaction.table(t.name).index(n.name)},e}(),V=function(){function e(e,t){this.node=e,this.parent=t,this.context=Q(e)}return e.prototype.perform=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,o,a,c,s,u,d,l,p,f,h;return Object(r.__generator)(this,(function(b){if(n=(t=this).context,i=t.node,!(o=n.inputs).length)return[2];if(1===o.length)return e.push(o[0]),[2];a=function(e,t){var n=Object(r.__read)(e,1)[0],o=Object(r.__read)(t,1)[0];return i.comparer.cmp(n,o)},c=new R({cmp:a}),s=this.getSmallestPointers(o).slice();try{for(u=Object(r.__values)(o),d=u.next();!d.done;d=u.next())d.value.sort(a)}catch(e){f={error:e}}finally{try{d&&!d.done&&(h=u.return)&&h.call(u)}finally{if(f)throw f.error}}return l=function(e){return o.every((function(t){return c.has(t,e)}))},p=s.filter(l),e.push(p),[2]}))}))},e.prototype.getSmallestPointers=function(e){return e.reduce((function(e,t){return e.length<t.length?e:t}),this.context.inputs[0])},e}(),G=function(){function e(e,t){this.node=e,this.parent=t,this.context=Q(e)}return e.prototype.perform=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,o,a,c,s,u;return Object(r.__generator)(this,(function(d){t=this.node,n=t.offset,i=t.limit;try{for(o=Object(r.__values)(this.context.inputs),a=o.next();!a.done;a=o.next())c=a.value,e.push(c.slice(n,!i||isNaN(i)?void 0:n+i))}catch(e){s={error:e}}finally{try{a&&!a.done&&(u=o.return)&&u.call(o)}finally{if(s)throw s.error}}return[2]}))}))},e}(),W=function(){function e(e,t,n){this.node=e,this.parent=t,this.transaction=n,this.context=Q(e)}return e.prototype.perform=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n,o,a,c;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return this.node.hydrate?[3,2]:[4,this.scanKeys()];case 1:return t=r.sent(),e.push(t.map((function(e){return[e,void 0]}))),[2];case 2:return(n=this.node.collectionSchema.key.path)?[4,this.scanValues()]:[3,4];case 3:return o=r.sent(),e.push(o.map((function(e){return[Object(i.m)(e,n),e]}))),[2];case 4:return[4,this.scanKeys()];case 5:return a=r.sent(),[4,this.scanValues()];case 6:return c=r.sent(),e.push(a.map((function(e,t){return[e,c[t]]}))),[2]}}))}))},e.prototype.scanKeys=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return e=this.getKeyQueries(),t=this.getTable(),[4,Promise.all(e.map((function(e){return t.getAllKeys(e)})))];case 1:return[2,n.sent().reduce((function(e,t){return e.push.apply(e,Object(r.__spreadArray)([],Object(r.__read)(t))),e}),[])]}}))}))},e.prototype.scanValues=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return e=this.getKeyQueries(),t=this.getTable(),[4,Promise.all(e.map((function(e){return t.getAll(e)})))];case 1:return[2,n.sent().reduce((function(e,t){return e.push.apply(e,Object(r.__spreadArray)([],Object(r.__read)(t))),e}),[])]}}))}))},e.prototype.getKeyQueries=function(){var e=new M(this.node.comparer);return this.node.type===I.SCAN_ALL?[void 0]:this.node.intervals.map((function(t){return q.getKeyRange(e,t)}))},e.prototype.getTable=function(){var e=this.node.collectionSchema;return this.transaction.table(e.name)},e}(),K=function(){function e(e,t){this.node=e,this.parent=t,this.context=Q(e)}return e.prototype.perform=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n,o,a,c,s,u,d,l,p=this;return Object(r.__generator)(this,(function(h){t=this.node,n=t.comparer,o=t.path,a=t.order;try{for(c=Object(r.__values)(this.context.inputs),s=c.next();!s.done;s=c.next())(u=s.value).sort((function(e,t){var c=Object(r.__read)(e,2)[1],s=Object(r.__read)(t,2)[1],u=Object(i.m)(c,o),d=Object(i.m)(s,o),l=p.getComparerByType(n,a);if(Object(i.n)(u)&&Object(i.n)(d))return l(u,d);throw new f})),e.push(u)}catch(e){d={error:e}}finally{try{s&&!s.done&&(l=c.return)&&l.call(c)}finally{if(d)throw d.error}}return[2]}))}))},e.prototype.getComparerByType=function(e,t){return t===i.h.ASCENDING?function(t,n){return e.cmp(t,n)}:function(t,n){return-e.cmp(t,n)}},e}(),H=function(){function e(e,t){this.node=e,this.parent=t,this.context=Q(e)}return e.prototype.perform=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return e.push(this.context.inputs.reduce((function(e,t){return e.push.apply(e,Object(r.__spreadArray)([],Object(r.__read)(t))),e}),[])),[2]}))}))},e}();function Q(e){return{total:e.children.length,done:0,inputs:[]}}var z=function(){function e(e,t){this.onRequestSuccess=function(){},this.onRequestFailed=function(){},this.request=e,this.transaction=t,this.jobs=new Map}return e.prototype.exec=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e=this;return Object(r.__generator)(this,(function(t){return this.task||(this.task=new Promise((function(t,n){e.onRequestSuccess=function(n){e.reset(),t(n)},e.onRequestFailed=function(t){return Object(r.__awaiter)(e,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){return this.reset(),n(t),[2]}))}))},e.traverse(e.request.root,(function(t,n){var r=function(e,t,n){var r;return(r={},r[I.FILL]=function(){return new k(e,t)},r[I.DISTINCT]=function(){return new D(e,t)},r[I.FILTER]=function(){return new P(e,t)},r[I.HYDRATE]=function(){return new L(e,t,n)},r[I.INDEX_SCAN]=function(){return new F(e,t,n)},r[I.INTERSECT]=function(){return new V(e,t)},r[I.PAGINATE]=function(){return new G(e,t)},r[I.SCAN]=function(){return new W(e,t,n)},r[I.SCAN_ALL]=function(){return new W(e,t,n)},r[I.SORT]=function(){return new K(e,t)},r[I.UNION]=function(){return new H(e,t)},r)[e.type]()}(t,n&&e.jobs.get(n)||null,e.transaction);e.jobs.set(t,r),t.children.length||e.beginJob(r).catch((function(t){e.onRequestFailed(t)}))}))}))),[2,this.task]}))}))},e.prototype.beginJob=function(e){var t;return Object(r.__awaiter)(this,void 0,void 0,(function(){var n,i,o=this;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:n=(null===(t=e.parent)||void 0===t?void 0:t.context.inputs)||[],r.label=1;case 1:return r.trys.push([1,3,,4]),[4,e.perform(n)];case 2:return r.sent(),this.finishJob(e,n).catch((function(e){o.onRequestFailed(e)})),[3,4];case 3:return i=r.sent(),this.onRequestFailed(i),[3,4];case 4:return[2]}}))}))},e.prototype.finishJob=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n,i=this;return Object(r.__generator)(this,(function(r){return e.parent&&((n=e.parent.context).done+=1,n.done===n.total&&this.beginJob(e.parent).catch((function(e){i.onRequestFailed(e)}))),e.node===this.request.root&&this.onRequestSuccess(t),[2]}))}))},e.prototype.reset=function(){this.jobs=new Map,this.task=void 0,this.onRequestSuccess=function(){},this.onRequestFailed=function(){}},e.prototype.traverse=function(e,t,n){var i,o;t(e,n);try{for(var a=Object(r.__values)(e.children),c=a.next();!c.done;c=a.next()){var s=c.value;this.traverse(s,t,e)}}catch(e){i={error:e}}finally{try{c&&!c.done&&(o=a.return)&&o.call(a)}finally{if(i)throw i.error}}},e}(),Y=function(){function e(e){this.comparer=e}return e.prototype.rewrite=function(e){return{offset:e.offset,limit:e.limit,order:e.order&&Object(r.__assign)({},e.order),exp:this.rewriteWhereClauses(e.whereClauses)}},e.prototype.rewriteWhereClauses=function(e){var t,n,o,a,c;if(!e.length)return{type:i.e.ALL};var s={type:i.e.OR,exps:[]};try{for(var u=Object(r.__values)(e),d=u.next();!d.done;d=u.next()){var l=d.value,p={type:i.e.AND,exps:[]};try{for(var f=(o=void 0,Object(r.__values)(Object.entries(l))),h=f.next();!h.done;h=f.next()){var b=Object(r.__read)(h.value,2),_=b[0],v=b[1];if(void 0!==v){var y=Object(i.n)(v)?((c={})[i.k.Equals]=v,c):v;this.isEmptyPredicate(y)||p.exps.push({type:i.e.FILTER,predicate:y,path:_,hints:{intervalGroup:B.fromWherePredicate(y,this.comparer),isKey:!1,indices:[]}})}}}catch(e){o={error:e}}finally{try{h&&!h.done&&(a=f.return)&&a.call(f)}finally{if(o)throw o.error}}s.exps.push(p)}}catch(e){t={error:e}}finally{try{d&&!d.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}return s},e.prototype.isEmptyPredicate=function(e){return Object.values(e).every((function(e){return void 0===e}))},e}(),J=function(){function e(e){this.schema=e,this.indicesMap=new Map,this.warmupIndicesMap()}return e.prototype.bind=function(e){return this.bindQueryHints(e.exp),e},e.prototype.bindQueryHints=function(e){var t,n=this,r=e;r.type!==i.e.AND&&r.type!==i.e.OR?r.type===i.e.FILTER&&(r.hints.isKey=this.schema.key&&Object(i.l)(this.schema.key.path,r.path),r.hints.indices=null!==(t=this.indicesMap.get(r.path))&&void 0!==t?t:[]):r.exps.forEach((function(e){return n.bindQueryHints(e)}))},e.prototype.warmupIndicesMap=function(){var e,t,n,i,o;try{for(var a=Object(r.__values)(this.schema.indices.entries()),c=a.next();!c.done;c=a.next()){var s=Object(r.__read)(c.value,2),u=s[0],d=s[1];d.priority=null!==(o=d.priority)&&void 0!==o?o:-(u+1);var l=Array.isArray(d.path)?d.path:[d.path];try{for(var p=(n=void 0,Object(r.__values)(l)),f=p.next();!f.done;f=p.next()){var h=f.value,b=this.indicesMap.get(h)||[];b.push(d),this.indicesMap.set(h,b)}}catch(e){n={error:e}}finally{try{f&&!f.done&&(i=p.return)&&i.call(p)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{c&&!c.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}},e}(),X=function(){function e(e,t){this.collectionSchema=e,this.comparer=t}return e.prototype.plan=function(e,t){return{root:this.getRootNode(e,t),aggregate:t}},e.prototype.getRootNode=function(e,t){if(e.exp.type===i.e.NONE)return this.getSkipNode();var n=this.getBaseNode(e.exp);return(t===i.d.ENTRIES||t===i.d.VALUES||e.order)&&(n=this.getHydrateNode([n])),e.order&&(n=this.getSortNode(e.order.path,e.order.type,[n])),(e.offset||e.limit!==i.j)&&(n=this.getPaginateNode(e.offset,e.limit,[n])),n=this.getDistinctNode([n])},e.prototype.getBaseNode=function(e){return e.type===i.e.ALL?this.getScanAllNode():e.type===i.e.NONE?this.getSkipNode():e.type===i.e.FILTER?this.getFilterNode(e):this.getLogicExpNode(e)},e.prototype.getLogicExpNode=function(e){var t,n,o=[];try{for(var a=Object(r.__values)(e.exps),c=a.next();!c.done;c=a.next()){var s=c.value;o.push(s.type===i.e.FILTER?this.getFilterNode(s):this.getLogicExpNode(s))}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return e.type===i.e.AND?this.getIntersectNode(o):this.getUnionNode(o)},e.prototype.getFilterNode=function(e){if(!e.path||e.hints.isKey)return this.getScanNode(e.hints.intervalGroup.intervals);var t=e.hints.indices.find((function(t){return Object(i.l)(t.path,e.path)}));return t?this.getIndexScanNode(e.hints.intervalGroup.intervals,t):this.getMemFilterNode(e.hints.intervalGroup.intervals,e.path)},e.prototype.getIntersectNode=function(e){return{type:I.INTERSECT,comparer:this.comparer,children:e}},e.prototype.getDistinctNode=function(e){return void 0===e&&(e=[]),{type:I.DISTINCT,comparer:this.comparer,children:e}},e.prototype.getUnionNode=function(e){return void 0===e&&(e=[]),{type:I.UNION,children:e}},e.prototype.getHydrateNode=function(e){return void 0===e&&(e=[]),{type:I.HYDRATE,collectionSchema:this.collectionSchema,children:e}},e.prototype.getPaginateNode=function(e,t,n){return void 0===n&&(n=[]),{type:I.PAGINATE,offset:e,limit:t,children:n}},e.prototype.getSortNode=function(e,t,n){return void 0===n&&(n=[]),{type:I.SORT,path:e,order:t,comparer:this.comparer,children:n}},e.prototype.getMemFilterNode=function(e,t,n){return{type:I.FILTER,comparer:this.comparer,path:t,intervals:e,regroup:!1,children:[{type:I.HYDRATE,collectionSchema:this.collectionSchema,children:n||[this.getScanAllNode()]}]}},e.prototype.getIndexScanNode=function(e,t){return{type:I.INDEX_SCAN,collectionSchema:this.collectionSchema,index:t,intervals:e,comparer:this.comparer,children:[]}},e.prototype.getScanNode=function(e){return{type:I.SCAN,collectionSchema:this.collectionSchema,intervals:e,comparer:this.comparer,children:[]}},e.prototype.getScanAllNode=function(){return{type:I.SCAN_ALL,collectionSchema:this.collectionSchema,comparer:this.comparer,children:[]}},e.prototype.getSkipNode=function(){return{type:I.FILL,inputs:[[]],children:[]}},e}(),$=function(){function e(){}return e.prototype.eliminate=function(e){var t=e;return t.exp=this.eliminateExp(e.exp),t},e.prototype.eliminateExp=function(e){return e.type===i.e.AND?this.eliminateAndExp(e):e.type===i.e.OR?this.eliminateOrExp(e):e.type===i.e.FILTER?this.eliminateFilterExp(e):e},e.prototype.eliminateAndExp=function(e){var t,n,o={type:i.e.AND,exps:[]};try{for(var a=Object(r.__values)(e.exps),c=a.next();!c.done;c=a.next()){var s=c.value,u=this.eliminateExp(s);if(u.type===i.e.NONE)return{type:i.e.NONE};u.type!==i.e.ALL&&o.exps.push(u)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return o.exps.length?1===o.exps.length?o.exps[0]:o:{type:i.e.ALL}},e.prototype.eliminateOrExp=function(e){var t,n,o={type:i.e.OR,exps:[]};try{for(var a=Object(r.__values)(e.exps),c=a.next();!c.done;c=a.next()){var s=c.value,u=this.eliminateExp(s);if(u.type===i.e.ALL)return{type:i.e.ALL};u.type!==i.e.NONE&&o.exps.push(u)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return o.exps.length?1===o.exps.length?e.exps[0]:o:{type:i.e.NONE}},e.prototype.eliminateFilterExp=function(e){return e.hints.intervalGroup.isEmpty()?{type:i.e.NONE}:e.hints.intervalGroup.isFull()?{type:i.e.ALL}:e},e}();var Z=function(){var e,t=!1;return function(n,i){if("function"!=typeof n[i])throw new Error("memo() must be decorated on one of function properties of target");Object.defineProperty(n,i,Object(r.__assign)(Object(r.__assign)({},Object.getOwnPropertyDescriptor(n,i)),{value:function(){return t||(e=n[i](),t=!0),e}}))}},ee=I.UNION,te=I.INTERSECT,ne=I.HYDRATE,re=I.INDEX_SCAN,ie=I.SCAN,oe=I.SCAN_ALL,ae=I.FILTER;function ce(e){return se(e.root),e}function se(e){var t,n,i=e.children;try{for(var o=Object(r.__values)(i.entries()),a=o.next();!a.done;a=o.next()){var c=Object(r.__read)(a.value,2),s=c[0],u=c[1];if(se(u),[te,ee].includes(u.type)&&1===u.children.length){var d=u.children[0];i[s]=d}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}}function ue(e){return de(e.root),e}function de(e){var t,n,i,o,a=e.children;try{for(var c=Object(r.__values)(a.entries()),s=c.next();!s.done;s=c.next()){var u=Object(r.__read)(s.value,2),d=u[0],l=u[1];if(de(l),l.type===ne){var p=!1;try{for(var f=(i=void 0,Object(r.__values)(l.children)),h=f.next();!h.done;h=f.next()){(b=h.value).type!==ie&&b.type!==re&&b.type!==oe||(p=!0,b.hydrate=!0)}}catch(e){i={error:e}}finally{try{h&&!h.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}if(p&&1===l.children.length){var b=l.children[0];a[d]=b}}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}}function le(e){return e}function pe(e){return fe(e.root),e}function fe(e){var t,n;he(e.children,(function(r){if(fe(r),r.type!==ae||!r.children.some((function(e){return e.type===oe})))return!0;if(n){var i=r;!function(e,t){var n=e;for(;e.nextFilter;)n=e.nextFilter;n.nextFilter=t}(n,i),i.regroup=e.type===ee}else t=r;return n=r,!1})),t&&e.children.push(t)}function he(e,t){for(var n=e,r=0,i=n.length-1;r<=i;){var o=n[r];t(o)?r+=1:(n[r]=n[i],n[i]=o,i-=1)}return n.splice(i+1)}function be(e){return _e(e.root),e}function _e(e){var t,n,i=e.children;try{for(var o=Object(r.__values)(i.entries()),a=o.next();!a.done;a=o.next()){var c=Object(r.__read)(a.value,2),s=c[0],u=c[1];if(_e(u),u.type===te){var d=u.children.find((function(e){var t=e.type;return[ie,re].includes(t)}));if(d){var l=he(u.children,(function(e){return e.type!==ae}));if(l.length){var p={type:ne,collectionSchema:d.collectionSchema,children:[]};i[s]=Oe.apply(void 0,Object(r.__spreadArray)(Object(r.__spreadArray)([],Object(r.__read)(l)),[p,u]))}}}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}}function ve(e){return[i.d.COUNT,i.d.KEYS].includes(e.aggregate)||me((function(e){e.type!==ie&&e.type!==re||(e.hydrate=!0)}),e.root),e}function ye(e){return me((function(e){var t,n,i,o,a;if(e.type===te){var c=Number.MIN_SAFE_INTEGER;try{for(var s=Object(r.__values)(e.children),u=s.next();!u.done;u=s.next()){var d=u.value,l=Number.MIN_SAFE_INTEGER;d.type===ie&&(l=0),d.type===re&&d.index.priority&&(l=d.index.priority),c=Math.max(c,l)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}var p=e.children;try{for(var f=Object(r.__values)(p.entries()),h=f.next();!h.done;h=f.next()){var b=Object(r.__read)(h.value,2),_=b[0];if((d=b[1]).type===re)(l=null!==(a=d.index.priority)&&void 0!==a?a:Number.MIN_SAFE_INTEGER)<c&&(p[_]=ge(d))}}catch(e){i={error:e}}finally{try{h&&!h.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}}}),e.root),e}function ge(e){return{path:e.index.path,intervals:e.intervals,comparer:e.comparer,type:I.FILTER,regroup:!1,children:[{type:I.SCAN_ALL,collectionSchema:e.collectionSchema,comparer:e.comparer,hydrate:!0,children:[]}]}}function me(e,t,n,i){var o,a;void 0===n&&(n=null),void 0===i&&(i=-1);var c=t.children;try{for(var s=Object(r.__values)(c.entries()),u=s.next();!u.done;u=s.next()){var d=Object(r.__read)(u.value,2),l=d[0];me(e,d[1],t,l)}}catch(e){o={error:e}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(o)throw o.error}}e(t,n,i)}function Oe(){for(var e,t,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var o=Object(r.__read)(n),a=o[0],c=o.slice(1),s=a;try{for(var u=Object(r.__values)(c),d=u.next();!d.done;d=u.next()){var l=d.value;s.children=[l],s=l}}catch(t){e={error:t}}finally{try{d&&!d.done&&(t=u.return)&&t.call(u)}finally{if(e)throw e.error}}return a}var je,we=function(){function e(){}return e.prototype.optimize=function(e){var t=[ye,ue,pe,ce,be,le,ce,ue,ve];return this.applyAllRules(t,e)},e.prototype.applyAllRules=function(e,t){return e.reduce((function(e,t){return t(e)}),t)},e}(),Ie=function(){function e(e){void 0===e&&(e=new Map),this.query={offset:0,limit:void 0,order:void 0,whereClauses:[]},this.aliasMap=e}return e.fromRawQuery=function(t,n){var i,o;void 0===n&&(n=new Map);var a=new e(n),c=t.offset,s=t.limit,u=t.order,d=t.whereClauses;a.setOffset(c),a.setLimit(s),u&&a.setOrderBy(u.path,u.type);try{for(var l=Object(r.__values)(d),p=l.next();!p.done;p=l.next()){var f=p.value;a.addWhereClause(f)}}catch(e){i={error:e}}finally{try{p&&!p.done&&(o=l.return)&&o.call(l)}finally{if(i)throw i.error}}return a},e.prototype.setOffset=function(e){this.query.offset=e},e.prototype.setLimit=function(e){this.query.limit=e},e.prototype.setRange=function(e,t){void 0===e&&(e=0),this.query.offset=e,this.query.limit=t!==i.j?Math.max(0,t-e):i.j},e.prototype.setOrderBy=function(e,t){this.query.order={path:e,type:t||i.h.ASCENDING}},e.prototype.addWhereClause=function(e){var t,n,i;if(this.isValidWhereClause(e)){var o={};try{for(var a=Object(r.__values)(Object.entries(e)),c=a.next();!c.done;c=a.next()){var s=Object(r.__read)(c.value,2),u=s[0],d=s[1];if(void 0!==d)o[null!==(i=this.aliasMap.get(u))&&void 0!==i?i:u]=d}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}this.query.whereClauses.push(o)}},e.prototype.clone=function(t){return void 0===t&&(t=this.aliasMap),e.fromRawQuery(this.query,t)},e.prototype.build=function(){return this.query},e.prototype.isValidWhereClause=function(e){return!!e&&Object.keys(e).length>=0},e}();!function(e){e.DISABLED="disabled",e.ALL="all"}(je||(je={}));var Se,Ee=function(){function e(e,t){this.collectionName=e,this.context=t.context}return e.toggleOptimization=function(t){e.optimization=t?je.ALL:je.DISABLED},e.getOptimizationMode=function(){return e.optimization},e.prototype.exec=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n,o,a,c,s,u,d,l;return Object(r.__generator)(this,(function(p){switch(p.label){case 0:return[4,this.context.getTransaction([this.collectionName],i.i.READ_ONLY)];case 1:return n=p.sent(),[4,this.getModel()];case 2:return o=p.sent(),a=this.getAliasMap(o.class),c=Ie.fromRawQuery(e,a).build(),(s=n.table(this.collectionName)).supports("query")&&c.whereClauses.length<=1?t!==i.d.VALUES?[3,4]:[4,s.query(c,t)]:[3,7];case 3:return[2,p.sent().map((function(e){var t;return null!==(t=A(e,o.class))&&void 0!==t?t:void 0}))];case 4:return t!==i.d.ENTRIES?[3,6]:[4,s.query(c,t)];case 5:return[2,p.sent().map((function(e){var t,n=Object(r.__read)(e,2);return[n[0],null!==(t=A(n[1],o.class))&&void 0!==t?t:void 0]}))];case 6:return[2,s.query(c,t)];case 7:return[4,this.getQueryPlan(c,t)];case 8:return u=p.sent(),[4,new z(u,n).exec()];case 9:return d=r.__read.apply(void 0,[p.sent(),1]),l=d[0],t===i.d.COUNT?[2,l.length]:t===i.d.KEYS?[2,l.map((function(e){return Object(r.__read)(e,1)[0]}))]:t===i.d.VALUES?[2,l.map((function(e){var t;return null!==(t=A(Object(r.__read)(e,2)[1],o.class))&&void 0!==t?t:void 0}))]:[2,l.map((function(e){var t,n=Object(r.__read)(e,2);return[n[0],null!==(t=A(n[1],o.class))&&void 0!==t?t:void 0]}))]}}))}))},e.prototype.conditions=function(e){return this.getRewriter().rewrite(e)},e.prototype.explain=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return[4,this.getQueryPlan(e,t)];case 1:return[2,n.sent()]}}))}))},e.prototype.getQueryPlan=function(t,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var i,o,a,c,s,u,d;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.getRewriter()];case 1:return i=r.sent(),[4,this.getEliminator()];case 2:return o=r.sent(),[4,this.getPlanner()];case 3:return a=r.sent(),[4,this.getBinder()];case 4:return c=r.sent(),[4,this.getOptimizer()];case 5:return s=r.sent(),u=i.rewrite(t),u=c.bind(u),u=o.eliminate(u),d=a.plan(u,n),[2,e.optimization===je.DISABLED?d:s.optimize(d)]}}))}))},e.prototype.getAliasMap=function(e){var t,n,i=new Map,o=m.getTableInfo(e.prototype);if(!o)return i;try{for(var a=Object(r.__values)(o.properties.values()),c=a.next();!c.done;c=a.next()){var s=c.value;s.alias&&i.set(s.name,s.alias)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return i},e.prototype.getModel=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){return[2,this.context.waitForModelRegistered(this.collectionName)]}))}))},e.prototype.getPlanner=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e;return Object(r.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.getModel()];case 1:return e=t.sent(),[2,new X(e.schema,this.context.comparer)]}}))}))},e.prototype.getRewriter=function(){return new Y(this.context.comparer)},e.prototype.getEliminator=function(){return new $},e.prototype.getBinder=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e;return Object(r.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.getModel()];case 1:return e=t.sent(),[2,new J(e.schema)]}}))}))},e.prototype.getOptimizer=function(){return new we},e.optimization=je.ALL,Object(r.__decorate)([Z()],e.prototype,"getModel",null),Object(r.__decorate)([Z()],e.prototype,"getPlanner",null),Object(r.__decorate)([Z()],e.prototype,"getRewriter",null),Object(r.__decorate)([Z()],e.prototype,"getEliminator",null),Object(r.__decorate)([Z()],e.prototype,"getBinder",null),Object(r.__decorate)([Z()],e.prototype,"getOptimizer",null),e}(),xe=function(){function e(e,t){this.name=e,this.options=t,this.contextGenerator=t.contextGenerator,this.queryBuilder=new Ie,this.patch()}return e.toggleOptimization=function(e){return Ee.toggleOptimization(e)},e.prototype.skip=function(e){return this.queryBuilder.setOffset(e),this},e.prototype.take=function(e){return this.queryBuilder.setLimit(e),this},e.prototype.slice=function(e,t){return this.queryBuilder.setRange(e,t),this},e.prototype.orderBy=function(e,t){return this.queryBuilder.setOrderBy(e,t),this},e.prototype.where=function(e){return this.queryBuilder.addWhereClause(e),this},e.prototype.or=function(e){return this.queryBuilder.addWhereClause(e),this},e.prototype.conditions=function(){var e=this.contextGenerator.spawnContext();return new Ee(this.name,{context:e}).conditions(this.queryBuilder.build())},e.prototype.clone=function(){var t=new e(this.name,this.options);return t.queryBuilder=this.queryBuilder.clone(),t},e.prototype.explain=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){return t=this.contextGenerator.spawnContext(),[2,new Ee(this.name,{context:t}).explain(this.queryBuilder.build(),e)]}))}))},e.prototype.count=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t=this;return Object(r.__generator)(this,(function(n){return[2,(e=this.contextGenerator.spawnContext()).perform((function(){return Object(r.__awaiter)(t,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,new Ee(this.name,{context:e}).exec(this.queryBuilder.build(),i.d.COUNT)]}))}))}))]}))}))},e.prototype.entries=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t=this;return Object(r.__generator)(this,(function(n){return[2,(e=this.contextGenerator.spawnContext()).perform((function(){return Object(r.__awaiter)(t,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,new Ee(this.name,{context:e}).exec(this.queryBuilder.build(),i.d.ENTRIES)]}))}))}))]}))}))},e.prototype.keys=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t=this;return Object(r.__generator)(this,(function(n){return[2,(e=this.contextGenerator.spawnContext()).perform((function(){return Object(r.__awaiter)(t,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,new Ee(this.name,{context:e}).exec(this.queryBuilder.build(),i.d.KEYS)]}))}))}))]}))}))},e.prototype.values=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t=this;return Object(r.__generator)(this,(function(n){return[2,(e=this.contextGenerator.spawnContext()).perform((function(){return Object(r.__awaiter)(t,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,new Ee(this.name,{context:e}).exec(this.queryBuilder.build(),i.d.VALUES)]}))}))}))]}))}))},e.prototype.first=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t=this;return Object(r.__generator)(this,(function(n){return[2,(e=this.contextGenerator.spawnContext()).perform((function(){return Object(r.__awaiter)(t,void 0,void 0,(function(){var t,n;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,new Ee(this.name,{context:e}).exec(this.queryBuilder.build(),i.d.VALUES)];case 1:return t=r.sent(),[2,null!==(n=t[0])&&void 0!==n?n:null]}}))}))}))]}))}))},e.prototype.last=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t=this;return Object(r.__generator)(this,(function(n){return[2,(e=this.contextGenerator.spawnContext()).perform((function(){return Object(r.__awaiter)(t,void 0,void 0,(function(){var t,n;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,new Ee(this.name,{context:e}).exec(this.queryBuilder.build(),i.d.VALUES)];case 1:return t=r.sent(),[2,null!==(n=t[t.length-1])&&void 0!==n?n:null]}}))}))}))]}))}))},e.prototype.update=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n,o=this;return Object(r.__generator)(this,(function(a){switch(a.label){case 0:return[4,this.entries()];case 1:return t=a.sent(),[2,(n=this.contextGenerator.spawnContext()).perform((function(){return Object(r.__awaiter)(o,void 0,void 0,(function(){var o,a,c,s,u,d,l,p,f,h,b,_,v;return Object(r.__generator)(this,(function(y){switch(y.label){case 0:return o=[],[4,n.getTransaction([this.name],i.i.READ_WRITE)];case 1:a=y.sent(),c=a.table(this.name),y.label=2;case 2:y.trys.push([2,8,9,10]),s=Object(r.__values)(t),u=s.next(),y.label=3;case 3:return u.done?[3,7]:(d=Object(r.__read)(u.value,2),l=d[0],p=d[1],[4,c.openCursor(l)]);case 4:return(f=y.sent())?(h=e(p),[4,f.update(C(h))]):[3,6];case 5:y.sent(),o.push(l),y.label=6;case 6:return u=s.next(),[3,3];case 7:return[3,10];case 8:return b=y.sent(),_={error:b},[3,10];case 9:try{u&&!u.done&&(v=s.return)&&v.call(s)}finally{if(_)throw _.error}return[7];case 10:return[2,o]}}))}))}))]}}))}))},e.prototype.clear=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t,n=this;return Object(r.__generator)(this,(function(o){switch(o.label){case 0:return[4,this.keys()];case 1:return e=o.sent(),[2,(t=this.contextGenerator.spawnContext()).perform((function(){return Object(r.__awaiter)(n,void 0,void 0,(function(){var n,o,a,c,s,u,d,l,p,f;return Object(r.__generator)(this,(function(h){switch(h.label){case 0:return n=[],[4,t.getTransaction([this.name],i.i.READ_WRITE)];case 1:return o=h.sent(),(a=o.table(this.name)).supports("bulkDelete")?[4,a.bulkDelete(e)]:[3,3];case 2:return h.sent(),[2,e];case 3:h.trys.push([3,9,10,11]),c=Object(r.__values)(e),s=c.next(),h.label=4;case 4:return s.done?[3,8]:(u=s.value,[4,a.openCursor(u)]);case 5:return(d=h.sent())?[4,d.delete()]:[3,7];case 6:h.sent(),n.push(u),h.label=7;case 7:return s=c.next(),[3,4];case 8:return[3,11];case 9:return l=h.sent(),p={error:l},[3,11];case 10:try{s&&!s.done&&(f=c.return)&&f.call(c)}finally{if(p)throw p.error}return[7];case 11:return[2,n]}}))}))}))]}}))}))},e.prototype.patch=function(){var e=this.options.aspects;e.update.patch(this,"update"),e.clear.patch(this,"clear"),e.count.patch(this,"count"),e.entries.patch(this,"entries"),e.keys.patch(this,"keys"),e.values.patch(this,"values"),e.first.patch(this,"first"),e.last.patch(this,"last"),e.skip.patch(this,"skip"),e.take.patch(this,"take"),e.slice.patch(this,"slice"),e.orderBy.patch(this,"orderBy"),e.where.patch(this,"where"),e.or.patch(this,"or")},e}(),Ce=function(){function e(e,t){this.name=e,this.aspects=t.aspects,this.contextGenerator=t.contextGenerator,this.unsliced=new xe(e,t),this.patch()}return e.prototype.skip=function(e){return this.unsliced.clone().skip(e)},e.prototype.take=function(e){return this.unsliced.clone().take(e)},e.prototype.slice=function(e,t){return this.unsliced.clone().slice(e,t)},e.prototype.orderBy=function(e,t){return this.unsliced.clone().orderBy(e,t)},e.prototype.where=function(e){return this.unsliced.clone().where(e)},e.prototype.or=function(e){return this.unsliced.clone().or(e)},e.prototype.update=function(e){return this.unsliced.update(e)},e.prototype.clear=function(){return this.unsliced.clear()},e.prototype.count=function(){return this.unsliced.count()},e.prototype.entries=function(){return this.unsliced.entries()},e.prototype.keys=function(){return this.unsliced.keys()},e.prototype.values=function(){return this.unsliced.values()},e.prototype.first=function(){return this.unsliced.first()},e.prototype.last=function(){return this.unsliced.last()},e.prototype.get=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n=this;return Object(r.__generator)(this,(function(o){return[2,(t=this.contextGenerator.spawnContext()).perform((function(){return Object(r.__awaiter)(n,void 0,void 0,(function(){var n,o,a;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,t.getTransaction([this.name],i.i.READ_ONLY)];case 1:return n=r.sent(),[4,t.waitForModelRegistered(this.name)];case 2:return o=r.sent(),[4,n.table(this.name).get(e)];case 3:return[2,(a=r.sent())?A(a,o.class):null]}}))}))}))]}))}))},e.prototype.has=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n=this;return Object(r.__generator)(this,(function(o){return[2,(t=this.contextGenerator.spawnContext()).perform((function(){return Object(r.__awaiter)(n,void 0,void 0,(function(){var n;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,t.getTransaction([this.name],i.i.READ_ONLY)];case 1:return n=r.sent(),[4,n.table(this.name).openCursor(e)];case 2:return[2,!!r.sent()]}}))}))}))]}))}))},e.prototype.delete=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n=this;return Object(r.__generator)(this,(function(o){return[2,(t=this.contextGenerator.spawnContext()).perform((function(){return Object(r.__awaiter)(n,void 0,void 0,(function(){var n,o,a;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,t.getTransaction([this.name],i.i.READ_WRITE)];case 1:return n=r.sent(),[4,(o=n.table(this.name)).openCursor(e)];case 2:return a=r.sent(),[4,o.delete(e)];case 3:return r.sent(),[2,a?e:null]}}))}))}))]}))}))},e.prototype.insert=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n=this;return Object(r.__generator)(this,(function(o){return[2,(t=this.contextGenerator.spawnContext()).perform((function(){return Object(r.__awaiter)(n,void 0,void 0,(function(){var n;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,t.getTransaction([this.name],i.i.READ_WRITE)];case 1:return n=r.sent(),[4,n.table(this.name).insert(C(e))];case 2:return[2,r.sent()]}}))}))}))]}))}))},e.prototype.upsert=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n=this;return Object(r.__generator)(this,(function(o){return[2,(t=this.contextGenerator.spawnContext()).perform((function(){return Object(r.__awaiter)(n,void 0,void 0,(function(){var n;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,t.getTransaction([this.name],i.i.READ_WRITE)];case 1:return n=r.sent(),[4,n.table(this.name).upsert(C(e))];case 2:return[2,r.sent()]}}))}))}))]}))}))},e.prototype.bulkInsert=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n=this;return Object(r.__generator)(this,(function(o){return[2,(t=this.contextGenerator.spawnContext()).perform((function(){return Object(r.__awaiter)(n,void 0,void 0,(function(){var n,o,a,c,s,u,d,l,p,f;return Object(r.__generator)(this,(function(h){switch(h.label){case 0:return[4,t.getTransaction([this.name],i.i.READ_WRITE)];case 1:n=h.sent(),o=[],a=n.table(this.name),h.label=2;case 2:h.trys.push([2,7,8,9]),c=Object(r.__values)(e),s=c.next(),h.label=3;case 3:return s.done?[3,6]:(u=s.value,[4,a.insert(C(u))]);case 4:d=h.sent(),o.push(d),h.label=5;case 5:return s=c.next(),[3,3];case 6:return[3,9];case 7:return l=h.sent(),p={error:l},[3,9];case 8:try{s&&!s.done&&(f=c.return)&&f.call(c)}finally{if(p)throw p.error}return[7];case 9:return[2,o]}}))}))}))]}))}))},e.prototype.bulkUpsert=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n=this;return Object(r.__generator)(this,(function(o){return[2,(t=this.contextGenerator.spawnContext()).perform((function(){return Object(r.__awaiter)(n,void 0,void 0,(function(){var n;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,t.getTransaction([this.name],i.i.READ_WRITE)];case 1:return n=r.sent(),[2,n.table(this.name).bulkUpsert(e.map((function(e){return C(e)})))]}}))}))}))]}))}))},e.prototype.conditions=function(){return this.unsliced.conditions()},e.prototype.patch=function(){this.aspects.get.patch(this,"get"),this.aspects.has.patch(this,"has"),this.aspects.delete.patch(this,"delete"),this.aspects.insert.patch(this,"insert"),this.aspects.upsert.patch(this,"upsert"),this.aspects.bulkInsert.patch(this,"bulkInsert"),this.aspects.bulkUpsert.patch(this,"bulkUpsert")},e}(),Ae=function(){function e(e,t){this.collectionMap=new Map,this.storage=e,this.eventBus=t}return e.prototype.getCollection=function(e,t){if(this.collectionMap.has(e))return this.collectionMap.get(e);var n=this.createCollection(e,t);return this.collectionMap.set(e,n),this.eventBus.emit(w.CollectionCreated,{collectionName:e,context:t.spawnContext()}),n},e.prototype.createCollection=function(e,t){var n=this.storage.aspects.collection;return new Ce(e,{contextGenerator:t,aspects:n})},e}(),ke=o.a.withMessageCreator("UnexpectedModifierError",(function(e){return'unexpected error occurred at the "'+e+'" stage of the plugable function, there may be a bug in your modifiers.'})),Re=o.a.withMessageCreator("InvalidPatchedFunctionError",(function(e){return'patched target is not a function, patched key is "'+e+'"'}));!function(e){e.before="before",e.around="around",e.return="return",e.throw="throw",e.after="after",e.protect="protect"}(Se||(Se={}));var De=function(){function e(e){this.modifiers={before:[],around:[],return:[],throw:[],after:[],protect:[]},this.createContext=e}return e.prototype.before=function(e){return this.modifiers.before.push(e),this},e.prototype.around=function(e){return this.modifiers.around.push(e),this},e.prototype.throw=function(e){return this.modifiers.throw.push(e),this},e.prototype.return=function(e){return this.modifiers.return.push(e),this},e.prototype.after=function(e){return this.modifiers.after.push(e),this},e.prototype.protect=function(e){return this.modifiers.protect.push(e),this},e.prototype.patch=function(e,t){Object.defineProperty(e,t,{enumerable:!1,value:this.compile(e,t),writable:!0,configurable:!0})},e.prototype.dirty=function(){return Object.values(this.modifiers).some((function(e){return e.length}))},e.prototype.compile=function(e,t){var n=e[t];if("function"!=typeof n)throw new Re(t);var r=this.invoke.bind(this);return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r(n,this,e)}},e}(),Te=De,Ne=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(r.__extends)(t,e),t.create=function(){return new t((function(){return{}}))},t.withContext=function(e){return new t(e)},t.prototype.invoke=function(e,t,n){var i;if(!this.dirty())return e.call.apply(e,Object(r.__spreadArray)([t],Object(r.__read)(n)));var o=Object.assign(this.createContext(),{args:n,this:t,callee:e,return:void 0,error:void 0});try{this.trigger(Se.before,o,this.modifiers.protect),this.modifiers.around.length?this.trigger(Se.around,o,this.modifiers.protect):o.return=(i=o.callee).call.apply(i,Object(r.__spreadArray)([o.this],Object(r.__read)(o.args))),this.trigger(Se.return,o,this.modifiers.protect)}catch(e){throw this.modifiers.throw.length&&(Object.assign(o,{error:e}),this.trigger(Se.throw,o,this.modifiers.protect)),e}finally{this.trigger(Se.after,o,this.modifiers.protect)}return o.return},t.prototype.trigger=function(e,t,n){var i,a,c,s;try{for(var u=Object(r.__values)(this.modifiers[e]),d=u.next();!d.done;d=u.next()){var l=d.value;try{l.call(t.this,t)}catch(i){if(!n.length){Object(o.c)(new ke(e,i));continue}try{for(var p=(c=void 0,Object(r.__values)(n)),f=p.next();!f.done;f=p.next()){var h=f.value;Object.assign(t,{error:i}),h.call(t.this,t)}}catch(e){c={error:e}}finally{try{f&&!f.done&&(s=p.return)&&s.call(p)}finally{if(c)throw c.error}}}}}catch(e){i={error:e}}finally{try{d&&!d.done&&(a=u.return)&&a.call(u)}finally{if(i)throw i.error}}},t}(Te),Me=Ne,Pe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(r.__extends)(t,e),t.create=function(){return new t((function(){return{}}))},t.withContext=function(e){return new t(e)},t.prototype.invoke=function(e,t,n){var i=this;if(!this.dirty())return e.call.apply(e,Object(r.__spreadArray)([t],Object(r.__read)(n)));var o=Object.assign(this.createContext(),{args:n,this:t,callee:e,return:void 0,error:void 0});return new Promise((function(e,t){Object(r.__awaiter)(i,void 0,void 0,(function(){var e,t,n,i;return Object(r.__generator)(this,(function(a){switch(a.label){case 0:return a.trys.push([0,7,10,12]),[4,this.trigger(Se.before,o,this.modifiers.protect)];case 1:return a.sent(),this.modifiers.around.length?[3,3]:(e=(i=o.callee).call.apply(i,Object(r.__spreadArray)([o.this],Object(r.__read)(o.args))),t=o,[4,e]);case 2:return t.return=a.sent(),[3,5];case 3:return[4,this.trigger(Se.around,o,this.modifiers.protect)];case 4:a.sent(),a.label=5;case 5:return[4,this.trigger(Se.return,o,this.modifiers.protect)];case 6:return a.sent(),[3,12];case 7:return n=a.sent(),Object.assign(o,{error:n}),this.modifiers.throw.length?[4,this.trigger(Se.throw,o,this.modifiers.protect)]:[3,9];case 8:a.sent(),a.label=9;case 9:throw n;case 10:return[4,this.trigger(Se.after,o,this.modifiers.protect)];case 11:return a.sent(),[7];case 12:return[2]}}))})).then((function(){e(o.return)})).catch((function(e){t(e)}))}))},t.prototype.trigger=function(e,t,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var i,a,c,s,u,d,l,p,f,h,b,_,v;return Object(r.__generator)(this,(function(y){switch(y.label){case 0:y.trys.push([0,15,16,17]),i=Object(r.__values)(this.modifiers[e]),a=i.next(),y.label=1;case 1:if(a.done)return[3,14];c=a.value,y.label=2;case 2:return y.trys.push([2,4,,13]),[4,c.call(t.this,t)];case 3:return y.sent(),[3,13];case 4:if(s=y.sent(),!n.length)return Object(o.c)(new ke(e,s)),[3,13];y.label=5;case 5:y.trys.push([5,10,11,12]),_=void 0,u=Object(r.__values)(n),d=u.next(),y.label=6;case 6:return d.done?[3,9]:(l=d.value,Object.assign(t,{error:s}),[4,l.call(t.this,t)]);case 7:y.sent(),y.label=8;case 8:return d=u.next(),[3,6];case 9:return[3,12];case 10:return p=y.sent(),_={error:p},[3,12];case 11:try{d&&!d.done&&(v=u.return)&&v.call(u)}finally{if(_)throw _.error}return[7];case 12:return[3,13];case 13:return a=i.next(),[3,1];case 14:return[3,17];case 15:return f=y.sent(),h={error:f},[3,17];case 16:try{a&&!a.done&&(b=i.return)&&b.call(i)}finally{if(h)throw h.error}return[7];case 17:return[2]}}))}))},t}(Te),Le=Pe;function Ue(){return{timings:new Map,counters:new Map,messages:new Map,errors:new Map,flags:new Map,data:new Map}}var Be,qe=function(){function e(e,t){this.storage=e,this.eventBus=t,this.plugins=[]}return e.prototype.add=function(){for(var e,t,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];try{for(var o=Object(r.__values)(n),a=o.next();!a.done;a=o.next()){var c=a.value;this.plugins.push(c),c.register(this.storage),this.eventBus.emit(j.RegisterPlugin,c)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},e}(),Fe=qe,Ve=o.a.withMessageCreator("UnexpectedOutsideMigrationActionError",(function(e){return e+" outside ensure(callback) is not allowed, please wrap your migration actions inside a ensure callback"})),Ge=function(){function e(e,t){this.name=e,this.context=t}return e.create=function(t){return{index:function(n){return new e(n,t)}}},e.prototype.create=function(e){var t=this.context.scope.collection;if(!t)throw new Ve("CreateIndex");return this.context.actions.schema.push({type:i.f.CreateIndex,name:this.name,attributes:Object(r.__assign)({},e),collection:t}),this},e.prototype.drop=function(){var e=this.context.scope.collection;if(!e)throw new Ve("DropIndex");this.context.actions.schema.push({type:i.f.DropIndex,name:this.name,collection:e})},e.prototype.alter=function(e){var t=this.context.scope.collection;if(!t)throw new Ve("AlterIndex");return this.context.actions.schema.push({type:i.f.DropIndex,name:this.name,collection:t},{type:i.f.CreateIndex,name:this.name,attributes:Object(r.__assign)({},e),collection:t}),this},e.prototype.rename=function(e){var t=this.context.scope.collection;if(!t)throw new Ve("RenameIndex");this.context.actions.schema.push({type:i.f.DropIndex,name:this.name,collection:t},{type:i.f.CreateIndex,name:e,attributes:{path:""},collection:t})},e.prototype.ensure=function(){throw new o.b},e}(),We=function(){function e(e,t){this.name=e,this.context=t}return e.create=function(t){return{collection:function(n){return new e(n,t)}}},e.prototype.create=function(e){return this.context.actions.schema.push({type:i.f.CreateCollection,name:this.name,attributes:Object(r.__assign)({},e)}),this},e.prototype.drop=function(){this.context.actions.schema.push({type:i.f.DropCollection,name:this.name})},e.prototype.alter=function(e){return this.context.actions.schema.push({type:i.f.DropCollection,name:this.name},{type:i.f.CreateCollection,name:this.name,attributes:Object(r.__assign)({},e)}),this},e.prototype.rename=function(e){this.context.actions.schema.push({type:i.f.DropCollection,name:this.name},{type:i.f.CreateCollection,name:e,attributes:{key:{generator:i.b.AutoIncrement},properties:[]}})},e.prototype.ensure=function(e){var t=this.context,n=Object(r.__assign)({},Ge.create(t));this.context.scope.collection=this.name,e(n),this.context.scope.collection=null},e}(),Ke=function(){function e(){this.context={actions:{schema:[],data:[]},scope:{database:null,collection:null}},this.builder=We.create(this.context)}return e.prototype.init=function(e){this.state=e,this.build()},e.prototype.plan=function(){return this.context.actions.schema.length||this.context.actions.data.length?[{schema:{actions:this.context.actions.schema.slice()},data:{actions:this.context.actions.data.slice()}}]:[]},e.prototype.handleDropCollection=function(e){var t,n;try{for(var i=Object(r.__values)(e),o=i.next();!o.done;o=i.next()){var a=o.value;this.builder.collection(a.name).drop()}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},e.prototype.handleCreateCollection=function(e){var t,n,i=function(e){o.builder.collection(e.name).create(e).ensure((function(t){var n,i;try{for(var o=(n=void 0,Object(r.__values)(e.indices)),a=o.next();!a.done;a=o.next()){var c=a.value;t.index(c.name).create(c)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}}))},o=this;try{for(var a=Object(r.__values)(e),c=a.next();!c.done;c=a.next()){i(c.value)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},e.prototype.handleIndexChange=function(e){var t,n,i=function(e){o.builder.collection(e.collection).ensure((function(t){var n,i,o,a,c,s;try{for(var u=(n=void 0,Object(r.__values)((null===(c=e.index)||void 0===c?void 0:c.added)||[])),d=u.next();!d.done;d=u.next()){var l=d.value;t.index(l.name).create(l)}}catch(e){n={error:e}}finally{try{d&&!d.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}try{for(var p=(o=void 0,Object(r.__values)((null===(s=e.index)||void 0===s?void 0:s.deleted)||[])),f=p.next();!f.done;f=p.next()){l=f.value;t.index(l.name).drop()}}catch(e){o={error:e}}finally{try{f&&!f.done&&(a=p.return)&&a.call(p)}finally{if(o)throw o.error}}}))},o=this;try{for(var a=Object(r.__values)(e),c=a.next();!c.done;c=a.next()){i(c.value)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},e.prototype.build=function(){if(!this.state)throw new Error("Migration state is undefined, must init before!");var e=this.state.schema,t=e.expect,n=e.actual,r=i.g.databaseDiff(n,t);this.handleCreateCollection(r.added),this.handleDropCollection(r.deleted),this.handleIndexChange(r.different)},e}(),He=i.c.name;!function(e){e.SYSTEM_TABLE="system_table",e.SCAN_EXISTING_TABLE="scan_exists_table"}(Be||(Be={}));var Qe=function(){function e(){}return e.hasSystemTable=function(e){return e.tableNames.includes(He)},e.getDatabaseSchema=function(t,n,o){return Object(r.__awaiter)(this,void 0,void 0,(function(){var a,c,s,u,d;return Object(r.__generator)(this,(function(l){switch(l.label){case 0:return[4,n.openDB(t,{name:t,collections:[i.c]})];case 1:a=l.sent(),c=!1,l.label=2;case 2:return l.trys.push([2,,10,11]),a.tableNames.length?[3,4]:(a.close(),c=!0,[4,n.deleteDB(t)]);case 3:return l.sent(),[2,{schema:{name:this.name,version:0,collections:[]},from:"scan_exists_table"}];case 4:return this.hasSystemTable(a)?[3,6]:[4,e.getDatabaseSchemaByScanningTableStructure(o.collections.map((function(e){return e.name})),a)];case 5:return[2,{schema:l.sent(),from:"scan_exists_table"}];case 6:return[4,a.transaction([He],i.i.READ_ONLY)];case 7:return s=l.sent(),[4,s.table(He).getAll()];case 8:return u=l.sent()||[],d={name:this.name,version:a.version,collections:Object(r.__spreadArray)(Object(r.__spreadArray)([],Object(r.__read)(u)),[this.getSystemTableSchema()])},[4,s.commit()];case 9:return l.sent(),[2,{schema:d,from:"system_table"}];case 10:return c||a.close(),[7];case 11:return[2]}}))}))},e.getSystemTableSchema=function(){return i.c},e.updateSchemaChange=function(e,t,n,o){return Object(r.__awaiter)(this,void 0,void 0,(function(){var a,c,s,u,d,l,p,f,h,_,v,y,g,m,O,j,w,I,S,E,x,C,A;return Object(r.__generator)(this,(function(k){switch(k.label){case 0:return a=t.table(He),o?[4,a.bulkUpsert(n.schema.expect.collections.filter((function(e){return e.name!==He})))]:[3,2];case 1:return k.sent(),[2];case 2:k.trys.push([2,27,,29]),c=i.g.databaseDiff(n.schema.actual,n.schema.expect),s=c.added.filter((function(e){return e.name!==He})),k.label=3;case 3:k.trys.push([3,8,9,10]),u=Object(r.__values)(s),d=u.next(),k.label=4;case 4:return d.done?[3,7]:((h=d.value).dataVersion=e,[4,a.upsert(h)]);case 5:k.sent(),k.label=6;case 6:return d=u.next(),[3,4];case 7:return[3,10];case 8:return l=k.sent(),I={error:l},[3,10];case 9:try{d&&!d.done&&(S=u.return)&&S.call(u)}finally{if(I)throw I.error}return[7];case 10:k.trys.push([10,15,16,17]),p=Object(r.__values)(c.deleted),f=p.next(),k.label=11;case 11:return f.done?[3,14]:(h=f.value,[4,a.delete(h.name)]);case 12:k.sent(),k.label=13;case 13:return f=p.next(),[3,11];case 14:return[3,17];case 15:return _=k.sent(),E={error:_},[3,17];case 16:try{f&&!f.done&&(x=p.return)&&x.call(p)}finally{if(E)throw E.error}return[7];case 17:v=c.different.filter((function(e){return!!e.index})),y=function(e){var t,n,i;return Object(r.__generator)(this,(function(o){switch(o.label){case 0:return[4,a.get(e.collection)];case 1:return t=o.sent(),n=[],i=t.indices.filter((function(t){return!e.index.deleted.some((function(e){return e.name===t.name}))})),n.push.apply(n,Object(r.__spreadArray)([],Object(r.__read)(e.index.added))),n.push.apply(n,Object(r.__spreadArray)([],Object(r.__read)(i))),t.index=n,[4,a.upsert(t)];case 2:return o.sent(),[2]}}))},k.label=18;case 18:k.trys.push([18,23,24,25]),g=Object(r.__values)(v),m=g.next(),k.label=19;case 19:return m.done?[3,22]:(O=m.value,[5,y(O)]);case 20:k.sent(),k.label=21;case 21:return m=g.next(),[3,19];case 22:return[3,25];case 23:return j=k.sent(),C={error:j},[3,25];case 24:try{m&&!m.done&&(A=g.return)&&A.call(g)}finally{if(C)throw C.error}return[7];case 25:return[4,t.commit()];case 26:if(!k.sent())throw new b;return[3,29];case 27:return w=k.sent(),[4,t.rollback()];case 28:throw k.sent(),w;case 29:return[2]}}))}))},e.updateCollectionDataVersion=function(e,t,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var i,o,a;return Object(r.__generator)(this,(function(c){switch(c.label){case 0:return[4,(i=t.table(He)).get(m.getTableName(n))];case 1:if(o=c.sent(),a=m.getTableInfo(n.prototype),!o)throw new Error("get target table system info error!");if(!a)throw new d(n.name);return o.dataVersion=e,o.properties=Object(r.__spreadArray)([],Object(r.__read)(a.properties.values())).map((function(e){return e.name})),[4,i.upsert(o)];case 2:return c.sent(),[2]}}))}))},e.getTableDataVersion=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return[4,t.table(He).get(e)];case 1:return[2,n.sent().dataVersion]}}))}))},e.getDatabaseSchemaByScanningTableStructure=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n,o,a,c,s,u,d,l,p,f,h,b,_,v,y,g;return Object(r.__generator)(this,(function(m){switch(m.label){case 0:n=t.tableNames.filter((function(t){return e.includes(t)})),o=[],m.label=1;case 1:m.trys.push([1,6,7,8]),a=Object(r.__values)(n),c=a.next(),m.label=2;case 2:return c.done?[3,5]:(s=c.value,[4,t.table(s,i.i.READ_ONLY)]);case 3:u=m.sent(),d={name:s,key:u.autoIncrement?{generator:i.b.AutoIncrement}:{path:u.keyPath},indices:[],properties:[]};try{for(y=void 0,l=Object(r.__values)(u.indexNames),p=l.next();!p.done;p=l.next())f=p.value,h=u.index(f),d.indices.push({name:f,path:h.keyPath,unique:h.unique})}catch(e){y={error:e}}finally{try{p&&!p.done&&(g=l.return)&&g.call(l)}finally{if(y)throw y.error}}o.push(d),m.label=4;case 4:return c=a.next(),[3,2];case 5:return[3,8];case 6:return b=m.sent(),_={error:b},[3,8];case 7:try{c&&!c.done&&(v=a.return)&&v.call(a)}finally{if(_)throw _.error}return[7];case 8:return[2,{name:t.name,version:t.version,collections:o}]}}))}))},e}(),ze=function(){function e(e){this.schemaActionHandlerMap=new Map,this.dataActionHandlerMap=new Map,this.schemaActionHandlerMap.set(i.f.CreateCollection,this.performCreateCollectionAction.bind(this)),this.schemaActionHandlerMap.set(i.f.DropCollection,this.performDropCollectionAction.bind(this)),this.schemaActionHandlerMap.set(i.f.CreateIndex,this.performCreateIndexAction.bind(this)),this.schemaActionHandlerMap.set(i.f.DropIndex,this.performDropIndexAction.bind(this)),this.dataActionHandlerMap.set(i.a.DropProperty,this.performDropPropertyAction.bind(this)),this.dataActionHandlerMap.set(i.a.ClearData,this.performClearDataAction.bind(this)),this.dataActionHandlerMap.set(i.a.ReplaceData,this.performReplaceDataAction.bind(this)),e.executeDataAction.patch(this,"executeDataAction"),e.executeSchemaAction.patch(this,"executeSchemaAction")}return e.prototype.executeSchemaAction=function(e,t,n){var r=this.schemaActionHandlerMap.get(n.type);if(r){if(t.mode!==i.i.VERSION_CHANGE)throw new u(n.type);return r(e,t,n)}},e.prototype.executeDataAction=function(e,t,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var i;return Object(r.__generator)(this,(function(r){return(i=this.dataActionHandlerMap.get(n.type))?[2,i(e,t,n)]:[2]}))}))},e.prototype.performCreateIndexAction=function(e,t,n){t.table(n.collection).createIndex(n.name,n.attributes.path,{unique:n.attributes.unique})},e.prototype.performDropIndexAction=function(e,t,n){t.table(n.collection).deleteIndex(n.name)},e.prototype.performDropCollectionAction=function(e,t,n){e.deleteTable(n.name)},e.prototype.performCreateCollectionAction=function(e,t,n){var r,o;e.createTable(n.name,{keyPath:null===(r=n.attributes.key)||void 0===r?void 0:r.path,autoIncrement:(null===(o=n.attributes.key)||void 0===o?void 0:o.generator)===i.b.AutoIncrement})},e.prototype.performClearDataAction=function(e,t,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,i;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return e=t.table(n.collection),n.filter?[3,2]:[4,e.clear()];case 1:return r.sent(),[2];case 2:return[4,e.openCursor()];case 3:i=r.sent(),r.label=4;case 4:return i?n.filter(i.value())?[4,i.delete()]:[3,6]:[3,8];case 5:r.sent(),r.label=6;case 6:return[4,i.next()];case 7:return i=r.sent(),[3,4];case 8:return[2]}}))}))},e.prototype.performDropPropertyAction=function(e,t,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,i;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,t.table(n.collection).openCursor()];case 1:e=r.sent(),r.label=2;case 2:return e?((i=e.value())[n.path]=void 0,[4,e.update(i)]):[3,5];case 3:return r.sent(),[4,e.next()];case 4:return e=r.sent(),[3,2];case 5:return[2]}}))}))},e.prototype.performReplaceDataAction=function(e,t,n){var i;return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,o;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,t.table(n.collection).openCursor()];case 1:e=r.sent(),r.label=2;case 2:return e?(o=e.value(),n.filter&&!(null===(i=n.filter)||void 0===i?void 0:i.call(this,o))?[3,4]:[4,e.update(n.replacer(o))]):[3,6];case 3:r.sent(),r.label=4;case 4:return[4,e.next()];case 5:return e=r.sent(),[3,2];case 6:return[2]}}))}))},e}(),Ye=function(){function e(e){this.collection=e,this.versionActionsMap=new Map}return e.prototype.getVersionActionsMap=function(){return this.versionActionsMap},e.prototype.version=function(e){var t=this,n={update:function(r){return t.pushAction(e,{type:i.a.ReplaceData,replacer:r,collection:t.collection}),n},delete:function(r){return t.pushAction(e,{filter:r,type:i.a.ClearData,collection:t.collection}),n}};return n},e.prototype.pushAction=function(e,t){var n=this.versionActionsMap.get(e)||[];n.push(t),this.versionActionsMap.set(e,n)},e}(),Je=function(){function e(e,t,n){this.expectedSchema=e,this.actualSchema=t,this.modelClass=n}return e.prototype.plan=function(){var e=this.actualSchema.dataVersion||0,t=this.expectedSchema.dataVersion||1;if(e===t)return[];var n=[],i=this.getManualMigrationActions(e,t);n.push.apply(n,Object(r.__spreadArray)([],Object(r.__read)(i)));var o=this.getAutoMigrationActions();return n.push.apply(n,Object(r.__spreadArray)([],Object(r.__read)(o))),[{schema:{actions:[]},data:{actions:n}}]},e.prototype.getManualMigrationActions=function(e,t){var n,r,i=new Ye(m.getTableName(this.modelClass));return null===(r=(n=this.modelClass).onDataUpgrade)||void 0===r||r.call(n,e,t,i),this.getRangeDataAction(e,t,i.getVersionActionsMap())},e.prototype.getAutoMigrationActions=function(){var e,t,n=this,o=[],a=this.actualSchema.properties.filter((function(e){return!n.expectedSchema.properties.includes(e)}));try{for(var c=Object(r.__values)(a),s=c.next();!s.done;s=c.next()){var u=s.value;o.push({type:i.a.DropProperty,collection:m.getTableName(this.modelClass),path:u})}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=c.return)&&t.call(c)}finally{if(e)throw e.error}}return o},e.prototype.getRangeDataAction=function(e,t,n){for(var i=[],o=e;o<=t;o++)i.push.apply(i,Object(r.__spreadArray)([],Object(r.__read)(n.get(o)||[])));return i},e}(),Xe=function(){function e(e){this.migrationManager=e,this.upgradedFlag=new Map}return e.prototype.executeDataUpgrade=function(e,t,n,i){return void 0===i&&(i=function(){}),Object(r.__awaiter)(this,void 0,void 0,(function(){var o,a;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return o=m.getTableName(e),this.upgradedFlag.get(o)?[2]:(a=this.getCollectionSchema(o,n),this.isNeedExecuteDataUpgrade(a.expect,a.actual)?[4,this.executeUpgrade(o,t,n,a.expect,a.actual,e)]:(this.upgradedFlag.set(o,!0),[2,i()]));case 1:return r.sent(),this.upgradedFlag.set(o,!0),[2,i()]}}))}))},e.prototype.isNeedExecuteDataUpgrade=function(e,t){return!(!(null==t?void 0:t.dataVersion)||e.dataVersion===t.dataVersion)},e.prototype.executeUpgrade=function(e,t,n,o,a,c){return Object(r.__awaiter)(this,void 0,void 0,(function(){var u,d,l,p,f,h;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return u=new Je(o,a,c),this.migrationManager.use(u),d=this.migrationManager.buildMigration(n),[4,t.transaction([e,Qe.getSystemTableSchema().name],i.i.READ_WRITE)];case 1:l=r.sent(),p=!1,r.label=2;case 2:return r.trys.push([2,6,8,11]),f=n.schema.expect.version||1,[4,Qe.getTableDataVersion(m.getTableName(c),l)];case 3:return r.sent()===f?[2]:[4,this.migrationManager.executeDataMigration(t,d,l)];case 4:return r.sent(),[4,Qe.updateCollectionDataVersion(f,l,c)];case 5:return r.sent(),[3,11];case 6:return h=r.sent(),p=!0,[4,l.rollback()];case 7:throw r.sent(),new s({oldVersion:a.dataVersion,newVersion:o.dataVersion},h);case 8:return p?[3,10]:[4,l.commit()];case 9:r.sent(),r.label=10;case 10:return[7];case 11:return[2]}}))}))},e.prototype.getCollectionSchema=function(e,t){var n=t.schema,r=n.expect,i=n.actual,o=r.collections.filter((function(t){return t.name===e})),a=i.collections.filter((function(t){return t.name===e}));if(1!==o.length)throw new c(e);return{expect:o[0],actual:a.length?a[0]:void 0}},e}(),$e=function(){function e(e,t,n){var i=this;this.planner=new Ke,this.actualDBSchema=null,this.actualDBSchemaFrom=null,this.lazyMigrationProcessor=new Xe(this),this.handleCollectionCreated=function(e){var t=e.collectionName,n=e.context;i.safeExecuteDataUpgrade(n,t)},this.handleStartTransaction=function(e){var t,n,o=e.collectionNames,a=e.context;try{for(var c=Object(r.__values)(o),s=c.next();!s.done;s=c.next()){var u=s.value;i.safeExecuteDataUpgrade(a,u)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}},this.eventBus=e,this.eventBus.on(w.CollectionCreated,this.handleCollectionCreated),this.eventBus.on(w.StartTransaction,this.handleStartTransaction),this.schemaProvider=t,this.actionExecutor=new ze(n.actionExecutor),this.applyAspectPatch(n)}return e.prototype.use=function(e){this.planner=e},e.prototype.prepareAutoUpgradeHandler=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n,i,o,a,c,s=this;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return n=this.schemaProvider.getDatabaseSchema(),[4,Qe.getDatabaseSchema(e,t,n)];case 1:return i=r.sent(),o=i.schema,a=i.from,this.actualDBSchema=o,this.actualDBSchemaFrom=a,this.log("getDatabaseSchema",this.actualDBSchema),c=this.buildMigration({schema:{expect:n,actual:this.actualDBSchema}}),[2,function(e,t,n,r){s.eventBus.emit(j.SchemaMigrationStart),s.executeSchemaMigration(e,c,r),s.updateMigrationChangeInfo(r).catch((function(e){s.emitError(new _(e))})),s.eventBus.emit(j.SchemaMigrationEnd)}]}}))}))},e.prototype.buildMigration=function(e){var t,n,r,i,o,a,c=e.schema,s=c.actual,u=c.expect;null===(n=null===(t=this.planner)||void 0===t?void 0:t.init)||void 0===n||n.call(t,e);var d=null!==(r=s.version)&&void 0!==r?r:0,l=null!==(i=u.version)&&void 0!==i?i:1;return null!==(a=null===(o=this.planner)||void 0===o?void 0:o.plan(d,l))&&void 0!==a?a:[]},e.prototype.executeSchemaMigration=function(e,t,n){var i,o,a,c;if(t)try{for(var s=Object(r.__values)(t),u=s.next();!u.done;u=s.next()){var d=u.value;try{for(var l=(a=void 0,Object(r.__values)(d.schema.actions)),p=l.next();!p.done;p=l.next()){var f=p.value;this.actionExecutor.executeSchemaAction(e,n,f)}}catch(e){a={error:e}}finally{try{p&&!p.done&&(c=l.return)&&c.call(l)}finally{if(a)throw a.error}}}}catch(e){i={error:e}}finally{try{u&&!u.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}},e.prototype.executeDataMigration=function(e,t,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var i,o,a,c,s,u,d,l,p,f,h,b;return Object(r.__generator)(this,(function(_){switch(_.label){case 0:if(!t)return[2];_.label=1;case 1:_.trys.push([1,12,13,14]),i=Object(r.__values)(t),o=i.next(),_.label=2;case 2:if(o.done)return[3,11];a=o.value,_.label=3;case 3:_.trys.push([3,8,9,10]),h=void 0,c=Object(r.__values)(a.data.actions),s=c.next(),_.label=4;case 4:return s.done?[3,7]:(u=s.value,[4,this.actionExecutor.executeDataAction(e,n,u)]);case 5:_.sent(),_.label=6;case 6:return s=c.next(),[3,4];case 7:return[3,10];case 8:return d=_.sent(),h={error:d},[3,10];case 9:try{s&&!s.done&&(b=c.return)&&b.call(c)}finally{if(h)throw h.error}return[7];case 10:return o=i.next(),[3,2];case 11:return[3,14];case 12:return l=_.sent(),p={error:l},[3,14];case 13:try{o&&!o.done&&(f=i.return)&&f.call(i)}finally{if(p)throw p.error}return[7];case 14:return[2]}}))}))},e.prototype.updateMigrationChangeInfo=function(e){var t,n;return Object(r.__awaiter)(this,void 0,void 0,(function(){var i,o;return Object(r.__generator)(this,(function(r){return i=this.schemaProvider.getDatabaseSchema(),o=null!==(t=i.version)&&void 0!==t?t:1,[2,Qe.updateSchemaChange(o,e,{schema:{expect:i,actual:null!==(n=this.actualDBSchema)&&void 0!==n?n:{name:i.name,collections:[]}}},"scan_exists_table"===this.actualDBSchemaFrom)]}))}))},e.prototype.log=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n]},e.prototype.executeDataUpgradeIfNeed=function(e,t){var n;return Object(r.__awaiter)(this,void 0,void 0,(function(){var i,o,a=this;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return this.log("executeDataUpgradeIfNeed",e.name),i=this.schemaProvider.getDatabaseSchema(),o={name:i.name,collections:[]},[4,this.lazyMigrationProcessor.executeDataUpgrade(e,t,{schema:{expect:i,actual:null!==(n=this.actualDBSchema)&&void 0!==n?n:o}},(function(){a.eventBus.emit(w.ModelLazyMigrationEnd,m.getTableName(e))}))];case 1:return r.sent(),[2]}}))}))},e.prototype.safeExecuteDataUpgrade=function(e,t){var n=this;Promise.all([e.waitForModelRegistered(t),e.waitForDBReady()]).then((function(e){var i=Object(r.__read)(e,2),o=i[0],a=i[1];n.executeDataUpgradeIfNeed(o.class,a).catch((function(e){n.emitError(new v(t,e))}))})).catch((function(){}))},e.prototype.emitError=function(e){this.eventBus.emit(j.Error,e)},e.prototype.applyAspectPatch=function(e){e.buildMigration.patch(this,"buildMigration"),e.executeDataMigration.patch(this,"executeDataMigration"),e.executeSchemaMigration.patch(this,"executeSchemaMigration"),e.prepareAutoUpgradeHandler.patch(this,"prepareAutoUpgradeHandler"),e.log.patch(this,"log"),e.updateMigrationChangeInfo.patch(this,"updateMigrationChangeInfo")},e}(),Ze=$e;var et=function(){var e;return{lock:function(t){return e||(e=t()),e.finally((function(){e=void 0}))}}},tt=function(){function e(e,t){var n,i=this;if(this.openingMutex=et(),this.closingMutex=et(),this.destroyingMutex=et(),this.openDatabase=function(){return Object(r.__awaiter)(i,void 0,void 0,(function(){var e=this;return Object(r.__generator)(this,(function(t){return[2,this.openingMutex.lock((function(){return Object(r.__awaiter)(e,void 0,void 0,(function(){var e,t,n,i,o,c,s,u,d,l,p,f=this;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:if(this.db)return[2];e=this.storage,t=e.name,n=e.version,r.label=1;case 1:return r.trys.push([1,8,,9]),this.eventBus.emit(j.BootstrapStart),i=this.getDatabaseSchema(),[4,this.migrationManager.prepareAutoUpgradeHandler(t,this.engine)];case 2:o=r.sent(),c=function(){f.eventBus.emit(j.Fetal,new y(t))},r.label=3;case 3:return r.trys.push([3,5,,7]),s=this,[4,this.engine.openDB(t,i,n,{upgrade:o,terminated:c})];case 4:return s.db=r.sent(),[3,7];case 5:if("VersionError"!==(u=r.sent()).name||!this.supportCompatibleOpen)throw u;return d=this,[4,this.engine.openDB(t,i,void 0,{upgrade:o,terminated:c})];case 6:return d.db=r.sent(),[3,7];case 7:return this.db.setVersionChangeListener((function(e,t){f.eventBus.emit(j.VersionChange,{oldVersion:e,newVersion:t})})),this.eventBus.emit(j.BootstrapEnd),this.eventBus.emit(j.Ready,this.db),[3,9];case 8:throw l=r.sent(),this.reset(),p=new a(t,l),this.eventBus.emit(j.Error,p),this.eventBus.emit(j.Fetal,p),p;case 9:return[2]}}))}))}))]}))}))},this.handleModelRegistered=function(e){if(!i.schemas.some((function(t){return t.name===e.schema.name}))){var t=e.schema;t.dataVersion=i.storage.version,i.schemas.push(t)}},this.handleFetal=function(){i.reset()},this.storage=e,this.engine=t.engine,this.eventBus=t.eventBus,this.supportCompatibleOpen=t.supportCompatibleOpen,this.engine.setAspects(e.aspects.engine),this.schemas=[Qe.getSystemTableSchema()],t.databaseSchema){var o=JSON.parse(t.databaseSchema).collections.map((function(e){return Object(r.__assign)(Object(r.__assign)({},e),{dataVersion:i.storage.version})}));(n=this.schemas).push.apply(n,Object(r.__spreadArray)([],Object(r.__read)(o)))}this.migrationManager=new Ze(this.eventBus,this,e.aspects.migration),this.eventBus.on(j.RegisterModel,this.handleModelRegistered),this.eventBus.on(j.Fetal,this.handleFetal)}return e.prototype.getDatabaseEngine=function(){return this.engine},e.prototype.getDatabaseSchema=function(){if(!this.storage.name||!this.storage.version)throw new Error("The database name and version are required for generating dbSchema");return{name:this.storage.name,version:this.storage.version,collections:this.schemas}},e.prototype.closeDatabase=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e=this;return Object(r.__generator)(this,(function(t){return[2,this.closingMutex.lock((function(){return Object(r.__awaiter)(e,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){switch(e.label){case 0:return this.db?[4,this.db.close()]:[2];case 1:return e.sent(),this.reset(),this.eventBus.emit(j.Closed),[2]}}))}))}))]}))}))},e.prototype.destroyDatabase=function(){var e=this;return this.destroyingMutex.lock((function(){return Object(r.__awaiter)(e,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){switch(e.label){case 0:return[4,this.engine.deleteDB(this.storage.name)];case 1:return e.sent(),this.reset(),this.eventBus.emit(j.Destroyed),[2]}}))}))}))},e.prototype.reset=function(){this.db=void 0},e}();var nt=function(e){return setTimeout(e)},rt=function(){function e(e){var t=e.keepActive,n=e.comparer,r=e.channelDB,i=e.channelModel,o=e.channelLazyMigration;this.keepActive=t,this.comparer=n,this.channelDB=r,this.channelModel=i,this.channelLazyMigration=o}return e.fromTransactionManager=function(t,n){return void 0===n&&(n=!1),new e({keepActive:n,comparer:t.comparer,channelDB:t.channelDB,channelModel:t.channelModel,channelLazyMigration:t.channelLazyMigration})},e.prototype.openTransaction=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n=this;return Object(r.__generator)(this,(function(i){return this.transactionPromise=Object(r.__awaiter)(n,void 0,void 0,(function(){var n,i,o=this;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,Promise.all(e.map((function(e){return o.waitForModelRegistered(e)})))];case 1:return r.sent(),[4,Promise.all(e.map((function(e){return o.waitForMigrationReady(e)})))];case 2:return r.sent(),[4,this.waitForDBReady()];case 3:return n=r.sent(),i=this,[4,n.transaction(e,t)];case 4:return i.transaction=r.sent(),[2,this.transaction]}}))})),[2,this.transactionPromise]}))}))},e.prototype.getTransaction=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return this.transactionPromise?[3,2]:[4,this.openTransaction(e,t)];case 1:n.sent(),n.label=2;case 2:return[4,this.transactionPromise];case 3:return[2,n.sent()]}}))}))},e.prototype.waitForDBReady=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){return[2,this.channelDB.pick()]}))}))},e.prototype.waitForModelRegistered=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.channelModel.pick(e)]}))}))},e.prototype.waitForMigrationReady=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.channelLazyMigration.pick(e)]}))}))},e.prototype.perform=function(e){return this.keepActive?e():this.autoCommitOrRollback(e)},e.prototype.autoCommitOrRollback=function(e){var t,n;return Object(r.__awaiter)(this,void 0,void 0,(function(){var i,o;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,5]),[4,e()];case 1:return i=r.sent(),[4,null===(t=this.transaction)||void 0===t?void 0:t.commit()];case 2:return r.sent(),[2,i];case 3:return o=r.sent(),[4,null===(n=this.transaction)||void 0===n?void 0:n.rollback()];case 4:throw r.sent(),o;case 5:return[2]}}))}))},e}(),it=Symbol("channel");var ot=function(e){var t;void 0===e&&(e=function(){return it});var n=new Map,i=new Map;function o(e,t){var n;null===(n=i.get(e))||void 0===n||n.reject(t),i.delete(e)}function a(e,t){void 0===t&&(t=it),i.has(t)?function(e,t){var n;null===(n=i.get(e))||void 0===n||n.resolve(t),i.delete(e)}(t,e):n.set(t,Promise.resolve(e))}return{send:function(n){t||a(n,e(n))},pick:function(e){return void 0===e&&(e=it),t?Promise.reject(t):(n.has(e)||n.set(e,new Promise((function(t,n){i.set(e,{resolve:t,reject:n})}))),n.get(e))},open:function(){t=void 0},close:function(e,a){var c,s;void 0===a&&(a=!1),t=e;try{for(var u=Object(r.__values)(i.keys()),d=u.next();!d.done;d=u.next()){o(d.value,e)}}catch(e){c={error:e}}finally{try{d&&!d.done&&(s=u.return)&&s.call(u)}finally{if(c)throw c.error}}a&&(n.clear(),i.clear())}}},at=function(){function e(e,t){var n=this;this.handleFetalError=function(e){n.channelDB.close(e,!0),n.channelModel.close(e),n.channelLazyMigration.close(e)},this.eventBus=e,this.channelDB=ot(),this.channelModel=ot((function(e){return e.schema.name})),this.channelLazyMigration=ot((function(e){return e})),this.comparer=t,this.eventBus.on(j.Fetal,this.handleFetalError),this.eventBus.on(j.Ready,this.channelDB.send),this.eventBus.on(j.RegisterModel,this.channelModel.send),this.eventBus.on(w.ModelLazyMigrationEnd,this.channelLazyMigration.send)}return e.prototype.spawnAutoCommitContext=function(){return rt.fromTransactionManager(this,!1)},e.prototype.spawnKeepAliveContext=function(){return rt.fromTransactionManager(this,!0)},e.prototype.openChannels=function(){this.channelDB.open(),this.channelModel.open(),this.channelLazyMigration.open()},e}(),ct=function(){function e(e){var t,n=this,i=e.name,o=e.engine,a=e.version,c=void 0===a?1:a,s=e.plugins,u=void 0===s?[]:s,d=e.disableAutoOpen,l=void 0!==d&&d,p=e.databaseSchema,f=e.supportCompatibleOpen,h=void 0!==f&&f;this.aspects={collection:{get:Le.withContext(Ue),has:Le.withContext(Ue),delete:Le.withContext(Ue),insert:Le.withContext(Ue),upsert:Le.withContext(Ue),bulkInsert:Le.withContext(Ue),bulkUpsert:Le.withContext(Ue),update:Le.withContext(Ue),clear:Le.withContext(Ue),count:Le.withContext(Ue),entries:Le.withContext(Ue),keys:Le.withContext(Ue),values:Le.withContext(Ue),first:Le.withContext(Ue),last:Le.withContext(Ue),skip:Me.withContext(Ue),take:Me.withContext(Ue),slice:Me.withContext(Ue),orderBy:Me.withContext(Ue),where:Me.withContext(Ue),or:Me.withContext(Ue)},query:{},model:{},migration:{prepareAutoUpgradeHandler:Le.withContext(Ue),buildMigration:Me.withContext(Ue),executeDataMigration:Le.withContext(Ue),executeSchemaMigration:Me.withContext(Ue),updateMigrationChangeInfo:Le.withContext(Ue),log:Me.withContext(Ue),actionExecutor:{executeSchemaAction:Me.withContext(Ue),executeDataAction:Le.withContext(Ue)}},engine:{deleteDB:Le.withContext(Ue),openDB:Le.withContext(Ue),database:{createTable:Me.withContext(Ue),deleteTable:Me.withContext(Ue),close:Me.withContext(Ue),table:Le.withContext(Ue),transaction:Le.withContext(Ue)},table:{createIndex:Le.withContext(Ue),deleteIndex:Le.withContext(Ue),delete:Le.withContext(Ue),get:Le.withContext(Ue),getAll:Le.withContext(Ue),getAllKeys:Le.withContext(Ue),index:Me.withContext(Ue),insert:Le.withContext(Ue),query:Le.withContext(Ue),openCursor:Le.withContext(Ue),upsert:Le.withContext(Ue),bulkUpsert:Le.withContext(Ue),clear:Le.withContext(Ue),bulkDelete:Le.withContext(Ue)},index:{get:Le.withContext(Ue),getAll:Le.withContext(Ue),getAllKeys:Le.withContext(Ue),openCursor:Le.withContext(Ue)},cursor:{delete:Le.withContext(Ue),update:Le.withContext(Ue),next:Le.withContext(Ue),value:Me.withContext(Ue)},transaction:{commit:Le.withContext(Ue),rollback:Le.withContext(Ue),table:Me.withContext(Ue)}}},this.eventBus=O(),this.open=function(){return n.transactionManager.openChannels(),n.databaseManager.openDatabase()},this.close=function(){return n.databaseManager.closeDatabase()},this.destroy=function(){return n.databaseManager.destroyDatabase()},this.register=function(e){n.modelManager.register(e)},this.collection=function(e){var t=n.modelManager.getSchemaAndRegisterModelIfNeed(e);return n.collectionManager.getCollection(t.name,{spawnContext:function(){return n.transactionManager.spawnAutoCommitContext()}})},this.transaction=function(e,t,i){return Object(r.__awaiter)(n,void 0,void 0,(function(){var n,o,a,c=this;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return n=this.transactionManager,o=e.map((function(e){return c.modelManager.getSchemaAndRegisterModelIfNeed(e).name})),a=n.spawnKeepAliveContext(),this.eventBus.emit(w.StartTransaction,{collectionNames:o,context:a}),[4,a.openTransaction(o,t)];case 1:return r.sent(),[2,a.autoCommitOrRollback((function(){return i(c.createStorageTransaction(a))}))]}}))}))},this.name=i,this.version=c,this.events=new S(this.eventBus),this.modelManager=new x(this.eventBus),this.databaseManager=new tt(this,{engine:o,eventBus:this.eventBus,databaseSchema:p,supportCompatibleOpen:h}),this.pluginManager=new Fe(this,this.eventBus),this.collectionManager=new Ae(this,this.eventBus),this.transactionManager=new at(this.eventBus,{cmp:this.databaseManager.getDatabaseEngine().cmp}),(t=this.pluginManager).add.apply(t,Object(r.__spreadArray)([],Object(r.__read)(u))),l||nt((function(){return n.open().catch((function(e){throw e}))}))}return e.prototype.createStorageTransaction=function(e){var t=this.modelManager,n=new Ae(this,this.eventBus);return{collection:function(r){var i=t.getSchemaAndRegisterModelIfNeed(r);return n.getCollection(i.name,{spawnContext:function(){return e}})}}},e}();t.c=ct},c7db5dbe42:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("533c8fd00a");Object.defineProperty(t,"Disposable",{enumerable:!0,get:function(){return r.Disposable}}),Object.defineProperty(t,"RootDisposable",{enumerable:!0,get:function(){return r.RootDisposable}}),Object.defineProperty(t,"mixinDisposable",{enumerable:!0,get:function(){return r.mixinDisposable}}),Object.defineProperty(t,"mixinRootDisposable",{enumerable:!0,get:function(){return r.mixinRootDisposable}});var i=n("8e26833a3b");Object.defineProperty(t,"DisposableNone",{enumerable:!0,get:function(){return i.DisposableNone}});var o=n("0d99992889");Object.defineProperty(t,"markTracked",{enumerable:!0,get:function(){return o.markTracked}}),Object.defineProperty(t,"trackDisposable",{enumerable:!0,get:function(){return o.trackDisposable}}),Object.defineProperty(t,"enableDisposablesTrack",{enumerable:!0,get:function(){return o.enableDisposablesTrack}}),Object.defineProperty(t,"disableDisposablesTrack",{enumerable:!0,get:function(){return o.disableDisposablesTrack}});var a=n("697ecdc674");Object.defineProperty(t,"DisposeTrace",{enumerable:!0,get:function(){return a.DisposeTrace}}),Object.defineProperty(t,"enableDisposeTrace",{enumerable:!0,get:function(){return a.enableDisposeTrace}}),Object.defineProperty(t,"disableDisposeTrace",{enumerable:!0,get:function(){return a.disableDisposeTrace}});var c=n("239887fb93");Object.defineProperty(t,"toDisposable",{enumerable:!0,get:function(){return c.toDisposable}}),Object.defineProperty(t,"isDisposable",{enumerable:!0,get:function(){return c.isDisposable}}),Object.defineProperty(t,"dispose",{enumerable:!0,get:function(){return c.dispose}}),Object.defineProperty(t,"combinedDisposable",{enumerable:!0,get:function(){return c.combinedDisposable}}),Object.defineProperty(t,"tryToDispose",{enumerable:!0,get:function(){return c.tryToDispose}}),Object.defineProperty(t,"tryToMarkDispose",{enumerable:!0,get:function(){return c.tryToMarkDispose}});var s=n("ff6b6fad8b");Object.defineProperty(t,"DisposableStore",{enumerable:!0,get:function(){return s.DisposableStore}});var u=n("baa9fada98");Object.defineProperty(t,"CancellationTokenSource",{enumerable:!0,get:function(){return u.CancellationTokenSource}})},c89632fe6d:function(e,t,n){"use strict";var r=n("31a899c9f3").version,i={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){i[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));var o={};i.transitional=function(e,t,n){function i(e,t){return"[Axios v"+r+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return function(n,r,a){if(!1===e)throw new Error(i(r," has been removed"+(t?" in "+t:"")));return t&&!o[r]&&(o[r]=!0,console.warn(i(r," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,r,a)}},e.exports={assertOptions:function(e,t,n){if("object"!=typeof e)throw new TypeError("options must be an object");for(var r=Object.keys(e),i=r.length;i-- >0;){var o=r[i],a=t[o];if(a){var c=e[o],s=void 0===c||a(c,o,e);if(!0!==s)throw new TypeError("option "+o+" must be "+s)}else if(!0!==n)throw Error("Unknown option "+o)}},validators:i}},c8f0004d6a:function(e,t,n){"use strict";n.r(t),n.d(t,"DELETE_ACCOUNT_FOR_LIST_STATE",(function(){return r})),n.d(t,"IBindQQStatus",(function(){return i})),n.d(t,"IPermissionLevel",(function(){return o})),n.d(t,"QrQQLoginStatus",(function(){return a})),n.d(t,"IQrWechatLoginStatus",(function(){return c})),n.d(t,"IWechatLoginCase",(function(){return s})),n.d(t,"QRCodeStatus",(function(){return u})),n.d(t,"IQrWecomLoginStatus",(function(){return d})),n.d(t,"ACCOUNT_TYPE",(function(){return l})),n.d(t,"LOGINTYPE",(function(){return p})),n.d(t,"COLLECT_CANCEL_FLAG",(function(){return f})),n.d(t,"CREATE_SOURCE_TYPE",(function(){return h})),n.d(t,"CREATE_DOC_TYPE",(function(){return b})),n.d(t,"CREATE_HUMTRANS_FALG",(function(){return _})),n.d(t,"FOLDER_LIST_TYPE",(function(){return v})),n.d(t,"GET_RECOMMEND_FLAG",(function(){return y})),n.d(t,"EVipLevel",(function(){return g})),n.d(t,"ERenewalStatus",(function(){return m})),n.d(t,"RETCODE",(function(){return O})),n.d(t,"BASE_CGICODE",(function(){return j})),n.d(t,"CorpVipLevel",(function(){return w})),n.d(t,"DOCUMENT_PRIVILEGE",(function(){return I})),n.d(t,"CORP_POLICY",(function(){return S})),n.d(t,"COMMENT_BOX_STATUS",(function(){return E})),n.d(t,"POLICY",(function(){return x})),n.d(t,"USER_TYPE",(function(){return C})),n.d(t,"PersonalizeAnonymousStatus",(function(){return A})),n.d(t,"AUTH_ROLE",(function(){return k})),n.d(t,"officialType",(function(){return R})),n.d(t,"DrivePadType",(function(){return D})),n.d(t,"NotifyTypeFunc",(function(){return T})),n.d(t,"NotifyType",(function(){return N})),n.d(t,"BIND_TYPE",(function(){return M})),n.d(t,"NOT_LOGIN_TINYID",(function(){return P})),n.d(t,"CAN_EXTERNAL_APPLY",(function(){return L})),n.d(t,"DOC_STATUS",(function(){return U})),n.d(t,"ICollaborationFlag",(function(){return B})),n.d(t,"PaymentRequirementType",(function(){return q})),n.d(t,"IVipSuperStatus",(function(){return F})),n.d(t,"EVipStatus",(function(){return V})),n.d(t,"ExpiredStatus",(function(){return G})),n.d(t,"VipType",(function(){return W})),n.d(t,"VipLevel",(function(){return K})),n.d(t,"EUserVipType",(function(){return H})),n.d(t,"EUserRenewalStatus",(function(){return Q})),n.d(t,"EventTarget",(function(){return z})),n.d(t,"EventType",(function(){return Y})),n.d(t,"LoadType",(function(){return J}));var r=function(e){return e.SUCCESS="SUCCESS",e.MAIN_SUCCESS_SECOND_FAIL="MAIN_SUCCESS_SECOND_FAIL",e.MAIN_FAIL_SECOND_SUCCESS="MAIN_FAIL_SECOND_SUCCESS",e.FAIL="FAIL",e.NOT_EXIST="NOT_EXIST",e}({}),i=function(e){return e.BIND_CGI_SUCCESS="BIND_CGI_SUCCESS",e.CHECK_KEY_IS_READY="CHECK_KEY_IS_READY",e.BIND_POLLING_RUNNING="BIND_POLLING_RUNNING",e.BIND_POLLING_FINISH="BIND_POLLING_FINISH",e.BIND_TIMEOUT="BIND_TIMEOUT",e.ERROR="ERROR",e}({}),o=function(e){return e[e.CAN_NOT_VIEW=0]="CAN_NOT_VIEW",e[e.CAN_VIEW=1]="CAN_VIEW",e}({}),a=function(e){return e.IFRAME_MESSAGE_CONNECTED="IFRAME_MESSAGE_CONNECTED",e.IFRAME_DOM_MOUNTED="IFRAME_DOM_MOUNTED",e.USER_HAS_CONFIRMED="USER_HAS_CONFIRMED",e.LOGIN_SUCCESS="LOGIN_SUCCESS",e.ERROR="ERROR",e}({}),c=function(e){return e.CODE_IS_READY="CODE_IS_READY",e.USER_HAS_SCANNED="USER_HAS_SCANNED",e.CODE_WAS_EXPIRED="CODE_WAS_EXPIRED",e.LOGIN_SUCCESS="LOGIN_SUCCESS",e.ERROR="ERROR",e}({}),s=function(e){return e[e.WECHAT_LOGIN_CASE_DEFAULT=0]="WECHAT_LOGIN_CASE_DEFAULT",e[e.WECHAT_LOGIN_CASE_H5=1]="WECHAT_LOGIN_CASE_H5",e}({}),u=function(e){return e.CODE_IS_READY="CODE_IS_READY",e.USER_HAS_SCANNED="USER_HAS_SCANNED",e.CODE_WAS_EXPIRED="CODE_WAS_EXPIRED",e.USER_HAS_CONFIRMED="USER_HAS_CONFIRMED",e.ERROR="ERROR",e}({}),d=function(e){return e.IFRAME_MESSAGE_CONNECTED="IFRAME_MESSAGE_CONNECTED",e.IFRAME_DOM_MOUNTED="IFRAME_DOM_MOUNTED",e.USER_HAS_CONFIRMED="USER_HAS_CONFIRMED",e.GOT_CHANGE_KEY="GOT_CHANGE_KEY",e.LOGIN_SUCCESS="LOGIN_SUCCESS",e.ERROR="ERROR",e}({}),l=function(e){return e[e.UNKNOWN=0]="UNKNOWN",e[e.QQ=1]="QQ",e[e.WX=2]="WX",e[e.WORK=3]="WORK",e[e.EMAIL=4]="EMAIL",e[e.PHONE=8]="PHONE",e[e.WORK_COMBINATION=9]="WORK_COMBINATION",e[e.TOWER=10]="TOWER",e[e.ROBOT=11]="ROBOT",e[e.QFYF=12]="QFYF",e[e.OPEN=13]="OPEN",e[e.MEETING=14]="MEETING",e}({}),p=function(e){return e[e.UNKNOWN=0]="UNKNOWN",e[e.WECHAT=4]="WECHAT",e[e.WEWORK=3]="WEWORK",e}({}),f={COLLECT:0,CANCEL:1},h={BLANK:1,TEMPLATE:2,COPY:4},b={DOC:0,EXCEL:1,PPT:2,FORM:3},_={NONE:0,HUMTRANS:1},v={NONE:0,DEFAULT:5},y={MOBILE:0,PC:1},g={Inactive:1,NormalVip:2,SuperVip:3},m={Inactive:0,Active:1,CloseAfterActive:2},O={SUCCESS:0,NO_PERMISSION:10003},j={SUCCESS:0},w=function(e){return e[e.INVALID_CORP_VIP_LEVEL=0]="INVALID_CORP_VIP_LEVEL",e[e.CORP_VIP_LEVEL_BASIC=1]="CORP_VIP_LEVEL_BASIC",e[e.CORP_VIP_LEVEL_PRO=2]="CORP_VIP_LEVEL_PRO",e}({}),I=function(e){return e[e.deny=0]="deny",e[e.whitelist=1]="whitelist",e[e.allOnlyRead=2]="allOnlyRead",e[e.allOnlyWrite=3]="allOnlyWrite",e[e.allOnlyExecute=4]="allOnlyExecute",e[e.invalidPolicy=999]="invalidPolicy",e}({}),S={DENY:0,WHITELIST:1,ALL_ONLY_READ:2,ALL_ONLY_WRITE:3,ALL_ONLY_EXECUTE:4},E={DEFAULT:0,SHOW:1,HIDE:2},x={SELF:0,COOPERATION:1,VIEWABLE:2,EDITABLE:3},C={Guest:1,Person:2},A=function(e){return e[e.NONE=0]="NONE",e[e.OPEN=1]="OPEN",e[e.CLOSED=2]="CLOSED",e}({}),k=function(e){return e[e.noPrivilege=0]="noPrivilege",e[e.reader=1]="reader",e[e.editor=2]="editor",e[e.filler=3]="filler",e[e.executor=4]="executor",e[e.externUser=10]="externUser",e[e.administrator=1024]="administrator",e[e.owner=2048]="owner",e}({}),R=function(e){return e[e.UNAUTHED=0]="UNAUTHED",e[e.ENTERPRISE=1]="ENTERPRISE",e[e.ENTERPRISE_MEDIA=2]="ENTERPRISE_MEDIA",e[e.GOVERNMENT=3]="GOVERNMENT",e[e.NON_PROFIT_ORGANIZATION=4]="NON_PROFIT_ORGANIZATION",e[e.PRIVATE_NON_ENTERPRISE=5]="PRIVATE_NON_ENTERPRISE",e[e.FOR_PROFIT_ORGANIZATION=6]="FOR_PROFIT_ORGANIZATION",e[e.SOCIAL_GROUPS=8]="SOCIAL_GROUPS",e[e.BUSINESS_MEDIA=9]="BUSINESS_MEDIA",e[e.BUSINESS_UNIT=11]="BUSINESS_UNIT",e[e.INDIVIDUAL_INDUSTRIAL_AND_COMMERCIAL_HOUSEHOLDS=12]="INDIVIDUAL_INDUSTRIAL_AND_COMMERCIAL_HOUSEHOLDS",e[e.OVERSEAS_COMPANIES=13]="OVERSEAS_COMPANIES",e}({}),D=function(e){return e.DOC="drive-doc",e.SHEET="drive-sheet",e.TEXT="drive-text",e.SLIDE="drive-slide",e.PDF="drive-pdf",e.UNKNOWN="drive-unknown",e}({}),T={set:1,get:2},N={none:0,allNotify:1,relatedToMe:2},M=function(e){return e.BINDING="BINDING",e.UNBIND="UNBIND",e}({}),P="100000000000000000",L={INVALID_NUM:0,CAN_APPLY:1,CANT_APPLY:2},U=function(e){return e[e.docStatusNormal=0]="docStatusNormal",e[e.docStatusDelete=1]="docStatusDelete",e[e.docStatusTrash=2]="docStatusTrash",e[e.docStatusHidden=3]="docStatusHidden",e[e.docStatusTrans=4]="docStatusTrans",e[e.docStatusImport=5]="docStatusImport",e[e.docStatusChecking=6]="docStatusChecking",e[e.docStatusForbidden=7]="docStatusForbidden",e[e.docStatusImportFailed=8]="docStatusImportFailed",e[e.docStatusCopy=9]="docStatusCopy",e[e.docStatusCopyFailed=10]="docStatusCopyFailed",e[e.docStatusPrepare=11]="docStatusPrepare",e[e.docStatusHiddenUntilModify=12]="docStatusHiddenUntilModify",e[e.docStatusFileUploading=13]="docStatusFileUploading",e}({}),B=function(e){return e[e.NOT_IN_COLLABORATION=0]="NOT_IN_COLLABORATION",e[e.IN_COLLABORATION=1]="IN_COLLABORATION",e[e.IN_SAFEFOLDER=2]="IN_SAFEFOLDER",e}({}),q=function(e){return e[e.Invalid=0]="Invalid",e[e.Free=1]="Free",e[e.SuperVIP=2]="SuperVIP",e}({}),F=function(e){return e[e.NOT_YET=1]="NOT_YET",e[e.USING=2]="USING",e[e.EXPIRED=3]="EXPIRED",e}({}),V=function(e){return e[e.NO_STATUS=0]="NO_STATUS",e[e.CLOSE=1]="CLOSE",e[e.OPEN=2]="OPEN",e[e.EXPIRED=3]="EXPIRED",e}({}),G=function(e){return e[e.EXPIRED=1]="EXPIRED",e[e.SUPER_VIP_EXPIRED=2]="SUPER_VIP_EXPIRED",e}({}),W=function(e){return e.NORMAL="NORMAL",e.SUPER="SUPER",e.SUPER_PLUS="SUPER_PLUS",e.NONE="NONE",e.EXPIRED="EXPIRED",e}({}),K=function(e){return e[e.NORMAL=2]="NORMAL",e[e.SUPER=3]="SUPER",e[e.SUPER_PLUS=4]="SUPER_PLUS",e[e.NONE=1]="NONE",e[e.EXPIRED=0]="EXPIRED",e}({}),H=function(e){return e[e.NONE=1]="NONE",e[e.NORMAL=2]="NORMAL",e[e.SUPER=3]="SUPER",e[e.SUPER_PLUS=4]="SUPER_PLUS",e}({}),Q=function(e){return e[e.NONE=0]="NONE",e[e.AUTO_RENEWAL=1]="AUTO_RENEWAL",e[e.CLOSED=2]="CLOSED",e}({}),z=function(e){return e[e.WINDOW=0]="WINDOW",e[e.DOCUMENT=1]="DOCUMENT",e[e.DOCUMENT_BODY=2]="DOCUMENT_BODY",e}({}),Y=function(e){return e.RESIZE="resize",e.MOUSE_DOWN="mousedown",e.MOUSE_MOVE="mousemove",e.MOUSE_UP="mouseup",e.KEY_UP="keyup",e.KEY_DOWN="keydown",e.CLICK="click",e.TOUCH_START="touchstart",e.TOUCH_MOVE="touchmove",e.TOUCH_END="touchend",e.POP_STATE="popState",e.VISIBILITY_CHANGE="visibilitychange",e.ONLINE="online",e.OFFLINE="offline",e.MESSAGE="message",e.CUSTOM="custom",e}({}),J=function(e){return e[e.IDLE=1]="IDLE",e[e.ON_DEMAND=3]="ON_DEMAND",e[e.EAGER=7]="EAGER",e}({})},c929b8af70:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n("d7c625d1f2"),i=n("61cea32eb2"),o=n("65e41bd588"),a=n("754d878ec7"),c=function(e){function t(t){var n=e.call(this)||this;if(n.type=a.a.UNBIND,n.userName="",n.userPic="",n.accountType=o.a.UNKNOWN,t){n.loginType=t.loginType;var r=n.handleBindUserInfo(t);n.jsonObj2Class(r)}return n}return Object(r.__extends)(t,e),t.prototype.handleBindUserInfo=function(e){var t=e.wxAvatar,n=e.wxNick,r=e.qqAvatar,i=e.qqNick;return e.wxOpenid&&this.loginType!==o.a.WX?{type:a.a.BINDING,userName:n,userPic:t,accountType:o.a.WX}:r&&this.loginType!==o.a.QQ?{type:a.a.BINDING,userName:i,userPic:r,accountType:o.a.QQ}:{type:a.a.UNBIND,userName:"",userPic:"",accountType:o.a.UNKNOWN}},t}(i.a)},c9b8a6765d:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n("d7c625d1f2"),i=n("61cea32eb2"),o=n("65e41bd588"),a=n("8a3f853387"),c=function(e){function t(t){var n=e.call(this)||this;return n.wedocOpenId="",n.wedriveUin="",n.corpId="",n.corpName="",n.englishName="",n.loginType=o.a.UNKNOWN,n.nowUserIndex="",n.openId="",n.tinyId=a.h,n.uidSource=o.a.UNKNOWN,n.uin="",n.userId="",n.userName="",n.userPic="",n.settings={language:"",toolbarMode:"",vipTheme:""},t?t.tinyId?(n.jsonObj2Class(t),n):(n.jsonObj2Class(Object(r.__assign)(Object(r.__assign)({},t),{tinyId:a.h})),n):n}return Object(r.__extends)(t,e),t}(i.a)},cedf7830be:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));class r{static hasMetadata(e,t){return!!t[e]}static getDepsMetadata(e,t){return t[e]}static setDepsMetadata(e,t,n){n[e]=t}static getMethodMetadata(e,t){return t[e]}static setMethodMetadata(e,t,n){n[e]=t}}function i(e){return"function"==typeof e?"function"==typeof e.toLegacyString?e.toLegacyString():e.name:String(e)}const o="Metadata must be applied to the parameters of a class constructor",a=(...e)=>`Metadata key was used more than once for parameter of class ${e[0]} in position ${e[1]}, already has metadata: [${e[2]}], newly add metadata: [${e[3]}]`,c=(...e)=>`@ServiceName decorator [${e[0]}] can only be used to decorate constructor parameter`;const s="di:ctor_deps";class u{static has(e){return this.serviceIdsMap.has(e)}static get(e){return this.serviceIdsMap.get(e)}static set(e,t){this.serviceIdsMap.set(e,t)}}function d(e){if(u.has(e))return u.get(e);const t=function(e,n,u){if(3!==arguments.length)throw new Error(c(n));!function(e,t,n,c,s){if(void 0!==n&&"number"==typeof s)throw new Error(o);const u=s.toString(),d=r.getDepsMetadata(e,t)||{},l=d[u];if(void 0!==(null==l?void 0:l[0])&&(null==l?void 0:l[0])!==c)throw new Error(a(t.name,u,i(l[0]),i(c)));l&&l[1]&&!l[1].serviceIdentifier?(l[0]=c,l[1].serviceIdentifier=c):void 0===l&&(d[u]=[c,{serviceIdentifier:c}],r.setDepsMetadata(e,d,t))}(s,e,void 0,t,u)};return t.toLegacyString=()=>e,u.set(e,t),t}u.serviceIdsMap=new Map},d3e4db71be:function(e,t,n){"use strict";e.exports=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}}},d6ca30ad13:function(e,t,n){"use strict";n.d(t,"a",(function(){return P}));var r=n("d7c625d1f2"),i=n("c33f52ea47"),o=n("f4e7deaab4"),a=n("fb1099018f"),c="".concat(a.h,"/dop-api/drive/data/get"),s="".concat(a.c,"auth_info/get"),u="".concat(a.c,"auth_info/set"),d="".concat(a.c,"auth_exp/get"),l="".concat(a.c,"auth_exp/set"),p="".concat(a.c,"auth_getconf"),f="".concat(a.h,"/v2/privilege/corpshare/docownerget"),h="".concat(a.h,"/v2/privilege/corpshare/docownerset"),b="".concat(a.h,"/v2/privilege/set_user"),_=n("03808c4177"),v=n("5be39fbf8a"),y=n("536530eec5"),g=n("6423ed0b81"),m=n("6fa7b8d7bc"),O=function(){function e(e,t){this.docMetaDomainService=e,this.networkRequestService=t}return e.prototype.fetchAuthInfoData=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return t={id:e,xsrf:"".concat(Object(g.c)(g.a.xsrf))},n=Object(m.a)(c,t),[4,this.networkRequestService.instance.get(n)];case 1:return[2,r.sent()]}}))}))},e.prototype.fetchAuthInfo=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return e={localPadId:this.docMetaDomainService.docMetaEntity.padInfo.padId,domain:this.docMetaDomainService.docMetaEntity.padInfo.domainId,type:1,ver:2,xsrf:"".concat(Object(g.c)(g.a.xsrf))},t=Object(m.a)(s,e),[4,this.networkRequestService.instance.post(t)];case 1:return[2,n.sent()]}}))}))},e.prototype.changeAuthInfo=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,o,a,c;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return t=e.corpId,n=e.data,i=e.message,o=e.dataType,a={localPadId:this.docMetaDomainService.docMetaEntity.padInfo.padId,domain:this.docMetaDomainService.docMetaEntity.padInfo.domainId,corp_id:Object(v.b)(t),data:Object(v.b)(n),message:Object(v.b)(i),dataType:Object(v.c)(o),type:1,ver:2,xsrf:"".concat(Object(g.c)(g.a.xsrf))},c=Object(m.a)(u,a),[4,this.networkRequestService.instance.post(c)];case 1:return[2,r.sent()]}}))}))},e.prototype.fetchAuthExpTime=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return e={domainId:this.docMetaDomainService.docMetaEntity.padInfo.domainId,localPadId:this.docMetaDomainService.docMetaEntity.padInfo.padId,xsrf:"".concat(Object(g.c)(g.a.xsrf)),type:1,ver:2},t=Object(m.a)(d,e),[4,this.networkRequestService.instance.get(t)];case 1:return[2,n.sent()]}}))}))},e.prototype.changeAuthExpTime=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return t=Object(v.d)({domainId:this.docMetaDomainService.docMetaEntity.padInfo.domainId,localPadId:this.docMetaDomainService.docMetaEntity.padInfo.padId,setTime:parseInt(e,10),xsrf:"".concat(Object(g.c)(g.a.xsrf))}),n={contentType:"application/x-www-form-urlencoded"},[4,this.networkRequestService.instance.post(l,t,n)];case 1:return[2,r.sent()]}}))}))},e.prototype.fetchFolderAuth=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return t={folderId:e,type:1,ver:2,xsrf:"".concat(Object(g.c)(g.a.xsrf))},n=Object(m.a)(s,t),[4,this.networkRequestService.instance.post(n)];case 1:return[2,r.sent()]}}))}))},e.prototype.changeFolderAuth=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,o,a,c,s;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return t=e.folderId,n=e.corpId,i=e.message,o=e.data,a=e.clear,c={folderId:t,corp_id:Object(v.b)(n),data:Object(v.b)(o),message:Object(v.b)(i),clear:Object(v.c)(a),type:1,ver:2,xsrf:"".concat(Object(g.c)(g.a.xsrf))},s=Object(m.a)(u,c),[4,this.networkRequestService.instance.post(s)];case 1:return[2,r.sent()]}}))}))},e.prototype.fetchAuthConfig=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return e={domainId:this.docMetaDomainService.docMetaEntity.padInfo.domainId,localPadId:this.docMetaDomainService.docMetaEntity.padInfo.padId,xsrf:"".concat(Object(g.c)(g.a.xsrf))},t=Object(m.a)(p,e),[4,this.networkRequestService.instance.post(t)];case 1:return[2,n.sent()]}}))}))},e=Object(r.__decorate)([Object(r.__param)(0,y.a),Object(r.__param)(1,_.a),Object(r.__metadata)("design:paramtypes",[Object,Object])],e)}(),j=n("61cea32eb2"),w=function(e){function t(t){var n=e.call(this)||this;return n.expTime=0,n.remainTime=0,n.setTime=0,n.startTime=0,n.jsonObj2Class(t),n}return Object(r.__extends)(t,e),t}(j.a),I=n("76702c352f"),S=n("9ab1857893"),E=function(e){function t(t){var n=e.call(this)||this;return n.readerCanComment=!1,n.viewForbidCopyPrint=!1,n.writerCanComment=!1,n.jsonObj2Class(t),n}return Object(r.__extends)(t,e),t}(j.a),x=function(e){function t(t){var n=e.call(this)||this;return n.canAbout=!1,n.canAddUser=!1,n.canAnnotate=!1,n.canComment=!1,n.canCopy=!1,n.canCopyDoc=!1,n.canEdit=!1,n.canEditTitle=!1,n.canHistory=!1,n.canLinkExp=!1,n.canPrint=!1,n.canRead=!1,n.canSearch=!1,n.canShare=!1,n.canSpitSlot=!1,n.canTranslate=!1,n.canViewImage=!1,n.canWatermark=!1,n.isPrivilegeExpired=!1,n.canApplyEdit=!1,n.isAuth=!1,n.canPublish=!1,n.canSetRange=!1,n.canEditTab=!1,n.canExport=!1,n.canSaveTemplate=!1,n.canEditCollab=!1,n.canViewCollab=!1,n.canInviteMember=!1,n.isAdmin=!1,n.canViewPrivSetting=!1,n.canEditPrivSetting=!1,n.canSetInternalAccess=!1,n.canSetExternalAccess=!1,n.canSetSecuritySetting=!1,n.canInviteSpecialDepts=!1,n.canSearchUser=!1,n.canFilterUser=!1,n.canForbidViewerComment=!1,n.canForbidViewerCopyDoc=!1,n.canTransfer=!1,n.canSetEnterRule=!1,n.canDelete=!1,n.canCreateFile=!1,n.canCreateFolder=!1,n.canFill=!1,n.canViewBrowsingHistory=!1,n.canSetRangePrivilege=!1,n.canExit=!1,n.canDeleteAbsolutely=!1,n.canRestore=!1,n.canMove=!1,n.canEditForm=!1,n.canCopyOut=!1,n.canRestoreInherit=!1,n.canCollect=!1,n.canQuickAccess=!1,n.canSearchDoc=!1,n.canOffline=!1,n.canApplyPermission=!1,n.jsonObj2Class(t),n}return Object(r.__extends)(t,e),Object.defineProperty(t.prototype,"canFeedback",{get:function(){return this.canSpitSlot},enumerable:!1,configurable:!0}),t}(j.a),C=function(){function e(e,t){this.docMetaDomainService=e,this.networkRequestService=t,this.selfRole=o.a.noPrivilege,this.isOwner=!1,this.selfDocPrivilege=new x({}),this.selfDocAdvancedPrivilege=new E({}),this.documentPrivilege=i.b.deny,this.memberList=[],this.onAuthChangedEmitter=new S.Emitter,this.onAuthExpTimeChangedEmitter=new S.Emitter,this.onSelfPrivilegeChangedEmitter=new S.Emitter,this.authRepository=new O(e,t),this.onAuthChanged=this.onAuthChangedEmitter.event,this.onAuthExpTimeChanged=this.onAuthExpTimeChangedEmitter.event,this.onSelfPrivilegeChanged=this.onSelfPrivilegeChangedEmitter.event}return e.prototype.fetchAuthExpTime=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){return[2,this.authRepository.fetchAuthExpTime()]}))}))},e.prototype.changeAuthExpTime=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.authRepository.changeAuthExpTime(e)]}))}))},e.prototype.fetchAuthInfo=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){return[2,this.authRepository.fetchAuthInfo()]}))}))},e.prototype.changeAuthInfo=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.authRepository.changeAuthInfo(e)]}))}))},e.prototype.fetchAuthInfoData=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.authRepository.fetchAuthInfoData(e)]}))}))},e.prototype.fetchFolderAuth=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.authRepository.fetchFolderAuth(e)]}))}))},e.prototype.changeFolderAuth=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.authRepository.changeFolderAuth(e)]}))}))},e.prototype.fetchAuthConfig=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){return[2,this.authRepository.fetchAuthConfig()]}))}))},e.prototype.onReceiveMessageFromServer=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return[4,this.notifyRightChange(e)];case 1:return n.sent(),this.checkSelfPrivilege(t),[2]}}))}))},e.prototype.handleForDifferentActions=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return t=e.seq,1!==e.action?[3,4]:e?void 0!==(n=e)[t]?[3,2]:[4,this.handleAuthChange()]:[3,3];case 1:return r.sent(),[3,3];case 2:delete n[t],r.label=3;case 3:return[3,7];case 4:return 2!==e.action?[3,5]:[3,7];case 5:return[4,this.handleExpInfoChange(e)];case 6:r.sent(),r.label=7;case 7:return[2]}}))}))},e.prototype.handleAuthChange=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return this.isOwner?[4,this.fetchAuthInfo()]:[2];case 1:return 0===(e=n.sent()).resData.cgicode&&0===e.resData.retcode&&(t=e.resData.data,this.documentPrivilege=t.policy,this.memberList=t.memberList,this.onAuthChangedEmitter.fire({newDocumentPrivilege:this.documentPrivilege})),[2]}}))}))},e.prototype.handleExpInfoChange=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(r.__generator)(this,(function(r){return this.checkExpTimeParams(e)&&(t=e.exptime-e.starttime)&&t>0&&(n=new w({expTime:e.exptime,remainTime:t,setTime:t,startTime:e.starttime}),this.onAuthExpTimeChangedEmitter.fire({newExpTime:n})),[2]}))}))},e.prototype.checkExpTimeParams=function(e){return"undefined"!==e.exptime&&"undefined"!==e.settime&&"undefined"!==e.starttime},e.prototype.checkSelfPrivilege=function(e){var t=this;e.sendMessage({cmd:"GET_PRIVILEGE",taskId:void 0,data:JSON.stringify({}),onsend:function(e,n,r,i){if(t.checkGetPrivilegeResult(i)){var o=i.response.onpost.privilege_attribute;t.checkDocPrivilegeChange(o)&&(t.selfDocPrivilege.canEdit=o.can_edit,t.selfDocPrivilege.canRead=o.can_read,t.selfDocPrivilege.canComment=o.can_comment,t.selfDocPrivilege.canCopy=o.can_copy,t.selfDocPrivilege.canEditTitle=o.can_edit_title,t.onSelfPrivilegeChangedEmitter.fire({newSelfPrivilege:t.selfDocPrivilege}))}},onError:function(){}})},e.prototype.checkGetPrivilegeResult=function(e){var t,n;return 0===e.errCode&&0===(null===(n=null===(t=e.response)||void 0===t?void 0:t.onpost)||void 0===n?void 0:n.result)},e.prototype.checkDocPrivilegeChange=function(e){return this.selfDocPrivilege.canEdit!==e.can_edit||this.selfDocPrivilege.canRead!==e.can_read||this.selfDocPrivilege.canComment!==e.can_comment||this.selfDocPrivilege.canCopy!==e.can_copy||this.selfDocPrivilege.canEditTitle!==e.can_edit_title},e.prototype.notifyRightChange=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return!e||""!==e.payload&&null!==e.payload?[3,2]:[4,this.handleAuthChange()];case 1:case 3:return n.sent(),[2];case 2:return null===(t=Object(v.l)(decodeURIComponent(e.payload),decodeURIComponent(e.payload)))?[2]:[4,this.handleForDifferentActions(t)]}}))}))},Object(r.__decorate)([Object(I.b)(),Object(I.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"fetchAuthExpTime",null),Object(r.__decorate)([Object(I.b)(),Object(I.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"changeAuthExpTime",null),Object(r.__decorate)([Object(I.b)(),Object(I.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"fetchAuthInfo",null),Object(r.__decorate)([Object(I.b)(),Object(I.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"changeAuthInfo",null),Object(r.__decorate)([Object(I.b)(),Object(I.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"fetchAuthInfoData",null),Object(r.__decorate)([Object(I.b)(),Object(I.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"fetchFolderAuth",null),Object(r.__decorate)([Object(I.b)(),Object(I.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"changeFolderAuth",null),Object(r.__decorate)([Object(I.b)(),Object(I.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"fetchAuthConfig",null),e=Object(r.__decorate)([Object(r.__param)(0,y.a),Object(r.__param)(1,_.a),Object(r.__metadata)("design:paramtypes",[Object,Object])],e)}(),A=function(){function e(e,t){this.docMetaDomainService=e,this.networkRequestService=t}return e.prototype.setUserAuth=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n,i;return Object(r.__generator)(this,(function(o){switch(o.label){case 0:return t=Object(g.c)(g.a.xsrf)||"",n=Object(r.__assign)({xsrf:t},e),i=Object(m.a)(b,{xsrf:t}),[4,this.networkRequestService.instance.post(i,n)];case 1:return[2,o.sent()]}}))}))},e=Object(r.__decorate)([Object(r.__param)(0,y.a),Object(r.__param)(1,_.a),Object(r.__metadata)("design:paramtypes",[Object,Object])],e)}(),k=function(){function e(e,t){this.docMetaDomainService=e,this.networkRequestService=t,this.collabAuthRepository=new A(e,t)}return e.prototype.setCollabUserAuth=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.collabAuthRepository.setUserAuth(e)];case 1:return[2,t.sent()]}}))}))},Object(r.__decorate)([Object(I.b)(),Object(I.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"setCollabUserAuth",null),e=Object(r.__decorate)([Object(r.__param)(0,y.a),Object(r.__param)(1,_.a),Object(r.__metadata)("design:paramtypes",[Object,Object])],e)}(),R=function(){function e(e,t){this.docMetaDomainService=e,this.networkRequestService=t}return e.prototype.changeCorpShareAuthInfo=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,o,a,c;return Object(r.__generator)(this,(function(s){switch(s.label){case 0:return t=e.uid,n=e.corpId,i=e.isOpen,o=e.canExternalApply,a=e.docCorpSharePolicy,c={user_info:{uid:t,corp_id:n},doc_id:this.docMetaDomainService.docMetaEntity.padInfo.padId,is_open:i,can_external_apply:o,uint32_policy:Math.round(Number(a||2)),xsrf:Object(g.c)(g.a.xsrf)},[4,this.networkRequestService.instance.post(h,Object(r.__assign)({},c))];case 1:return[2,s.sent()]}}))}))},e.prototype.fetchCorpShareAuthInfo=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n;return Object(r.__generator)(this,(function(i){switch(i.label){case 0:return n={user_info:{uid:e,corp_id:t},doc_id:this.docMetaDomainService.docMetaEntity.padInfo.padId,xsrf:Object(g.c)(g.a.xsrf)},[4,this.networkRequestService.instance.post(f,Object(r.__assign)({},n))];case 1:return[2,i.sent()]}}))}))},e=Object(r.__decorate)([Object(r.__param)(0,y.a),Object(r.__param)(1,_.a),Object(r.__metadata)("design:paramtypes",[Object,Object])],e)}(),D=function(){function e(e,t){this.docMetaDomainService=e,this.networkRequestService=t,this.corpShareAuthRepository=new R(e,t)}return e.prototype.fetchCorpShareAuthInfo=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return[4,this.corpShareAuthRepository.fetchCorpShareAuthInfo(e,t)];case 1:return[2,n.sent()]}}))}))},e.prototype.changeCorpShareAuthInfo=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.corpShareAuthRepository.changeCorpShareAuthInfo(e)];case 1:return[2,t.sent()]}}))}))},Object(r.__decorate)([Object(I.b)(),Object(I.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String,String]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"fetchCorpShareAuthInfo",null),Object(r.__decorate)([Object(I.b)(),Object(I.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"changeCorpShareAuthInfo",null),e=Object(r.__decorate)([Object(r.__param)(0,y.a),Object(r.__param)(1,_.a),Object(r.__metadata)("design:paramtypes",[Object,Object])],e)}(),T=function(){function e(e,t){this.docMetaDomainService=e,this.networkRequestService=t,this.authInfoEntity=new C(e,t),this.corpShareAuthInfoEntity=new D(e,t),this.collabAuthInfoEntity=new k(e,t)}return e=Object(r.__decorate)([Object(r.__param)(0,y.a),Object(r.__param)(1,_.a),Object(r.__metadata)("design:paramtypes",[Object,Object])],e)}(),N=n("540dabb65d"),M=n("f6a0938af8");var P=function(){function e(e,t){this.docMetaDomainService=e,this.networkRequestService=t,this.isInitedByBasicClientVars=!1,this.authAggregate=new T(e,t),window.basicClientVars&&this.initWithBasicClientVars(window.basicClientVars)}return e.prototype.updateWithClientVars=function(e){if(!this.isInitedByBasicClientVars){var t=function(e){return Object(r.__assign)({},Object(M.a)(e.privilegeAttribute))}(e);this.authAggregate.authInfoEntity.selfDocPrivilege=new x(t),this.authAggregate.authInfoEntity.isOwner=e.isOwner,this.authAggregate.authInfoEntity.selfRole=e.rightFlag,this.authAggregate.authInfoEntity.documentPrivilege=e.policy,this.authAggregate.authInfoEntity.selfDocAdvancedPrivilege=new E({readerCanComment:e.advPolicy.reader_can_comment,viewForbidCopyPrint:e.advPolicy.view_forbid_copy_print,writerCanComment:e.advPolicy.writer_can_comment})}},e.prototype.init=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,o,a,c,s,u;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return t=e.docId,[4,this.authAggregate.authInfoEntity.fetchAuthInfoData(t)];case 1:return n=r.sent().resData,i=null==n?void 0:n.data.data,o=i.privilegeAttribute,a=i.advPolicy,this.authAggregate.authInfoEntity.isOwner=null!==(c=i.isOwner)&&void 0!==c&&c,this.authAggregate.authInfoEntity.selfRole=null!==(s=i.rightFlag)&&void 0!==s?s:0,this.authAggregate.authInfoEntity.documentPrivilege=null!==(u=i.policy)&&void 0!==u?u:0,this.authAggregate.authInfoEntity.selfDocPrivilege=new x({canAbout:null==o?void 0:o.canAbout,canAddUser:null==o?void 0:o.canAddUser,canAnnotate:null==o?void 0:o.canAnnotate,canComment:null==o?void 0:o.canComment,canCopy:null==o?void 0:o.canCopy,canCopyDoc:null==o?void 0:o.canCopyDoc,canEdit:null==o?void 0:o.canEdit,canEditTitle:null==o?void 0:o.canEditTitle,canHistory:null==o?void 0:o.canHistory,canLinkExp:null==o?void 0:o.canLinkExp,canPrint:null==o?void 0:o.canPrint,canRead:null==o?void 0:o.canRead,canSearch:null==o?void 0:o.canSearch,canShare:null==o?void 0:o.canShare,canSpitSlot:null==o?void 0:o.canSpitSlot,canFeedback:null==o?void 0:o.canSpitSlot,canTranslate:null==o?void 0:o.canTranslate,canViewImage:null==o?void 0:o.canViewImage,canWatermark:null==o?void 0:o.canWatermark,isPrivilegeExpired:!!i.privilegeExpire}),this.authAggregate.authInfoEntity.selfDocAdvancedPrivilege=new E({readerCanComment:null==a?void 0:a.reader_can_comment,viewForbidCopyPrint:null==a?void 0:a.view_forbid_copy_print,writerCanComment:null==a?void 0:a.writer_can_comment}),[2]}}))}))},e.prototype.initWithBasicClientVars=function(e){var t,n,i,o,a,c,s,u,d,l,p,f,h,b,_,v,y=function(e){var t,n;return Object(r.__assign)(Object(r.__assign)({},null===(t=e.authInfo)||void 0===t?void 0:t.attribute),{isPrivilegeExpired:!!(null===(n=e.authInfo)||void 0===n?void 0:n.privilegeExpire)})}(e);this.authAggregate.authInfoEntity.isOwner=null!==(n=null===(t=e.docInfo)||void 0===t?void 0:t.isOwner)&&void 0!==n&&n,this.authAggregate.authInfoEntity.selfRole=null!==(o=null===(i=e.authInfo)||void 0===i?void 0:i.privilegeFlag)&&void 0!==o?o:0,this.authAggregate.authInfoEntity.documentPrivilege=null!==(s=null===(c=null===(a=e.authInfo)||void 0===a?void 0:a.privilegeInfo)||void 0===c?void 0:c.uint32Policy)&&void 0!==s?s:0,this.authAggregate.authInfoEntity.selfDocPrivilege=new x(y),this.authAggregate.authInfoEntity.selfDocAdvancedPrivilege=new E({readerCanComment:null===(l=null===(d=null===(u=e.authInfo)||void 0===u?void 0:u.privilegeInfo)||void 0===d?void 0:d.advPolicy)||void 0===l?void 0:l.readerCanComment,viewForbidCopyPrint:null===(h=null===(f=null===(p=e.authInfo)||void 0===p?void 0:p.privilegeInfo)||void 0===f?void 0:f.advPolicy)||void 0===h?void 0:h.viewForbidCopyPrint,writerCanComment:null===(v=null===(_=null===(b=e.authInfo)||void 0===b?void 0:b.privilegeInfo)||void 0===_?void 0:_.advPolicy)||void 0===v?void 0:v.writerCanComment}),this.isInitedByBasicClientVars=!0},Object(r.__decorate)([Object(N.a)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"init",null),Object(r.__decorate)([Object(I.m)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",void 0)],e.prototype,"initWithBasicClientVars",null),e=Object(r.__decorate)([Object(r.__param)(0,y.a),Object(r.__param)(1,_.a),Object(r.__metadata)("design:paramtypes",[Object,Object])],e)}()},d861d3fe93:function(e,t,n){"use strict";n.d(t,"g",(function(){return i})),n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return a})),n.d(t,"h",(function(){return c})),n.d(t,"k",(function(){return s})),n.d(t,"d",(function(){return u})),n.d(t,"e",(function(){return d})),n.d(t,"j",(function(){return l})),n.d(t,"f",(function(){return p})),n.d(t,"c",(function(){return f})),n.d(t,"i",(function(){return h}));var r=n("fb1099018f"),i="".concat(r.h,"/session/logout"),o="".concat(r.c,"user_unbind"),a="".concat(r.c,"user_bind"),c="".concat(r.h,"/v2/cgi-bin/online_docs/polling"),s="".concat(r.h,"/cgi-bin/online_docs/wxqrcode"),u=("".concat(r.i,"/session/logout"),"".concat(r.i,"/disklogin/logout")),d="".concat(r.g,"/session/logout"),l="".concat(r.c,"user_info"),p="".concat(r.c,"bind/permission/uid"),f="".concat(r.c,"bind/permission/uin"),h="".concat(r.h,"/v2/user/wechat/auth/switch")},da5bb142c9:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"m",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"i",(function(){return c})),n.d(t,"e",(function(){return s})),n.d(t,"a",(function(){return u})),n.d(t,"d",(function(){return d})),n.d(t,"h",(function(){return l})),n.d(t,"f",(function(){return p})),n.d(t,"g",(function(){return f})),n.d(t,"l",(function(){return h})),n.d(t,"j",(function(){return b})),n.d(t,"k",(function(){return _})),n.d(t,"n",(function(){return v}));var r=n("b7cba4397b").a.getConfig('npm["@tencent/ark-domain"]'),i=window.location.host,o=(null==r?void 0:r.WECHAT_WEBVIEW_LOGIN)||"https://docs.qq.com/scenario/h5auth.html",a=(null==r?void 0:r.LOGIN_PAGE_URL)||"https://docs.qq.com/login.html",c=(null==r?void 0:r.TOC_HOST)||"docs.qq.com",s=(null==r?void 0:r.TOB_HOST)||"doc.weixin.qq.com",u=(null==r?void 0:r.DOCS_WW_LOGIN)||"https://docs.qq.com/scenario/ww-login.html",d=(null==r?void 0:r.OPEN_WEIXIN_AUTHORIZE)||"https://open.weixin.qq.com/connect/oauth2/authorize",l=(null==r?void 0:r.TOB_TARGET_ORIGIN)||"https://doc.weixin.qq.com",p=(null==r?void 0:r.TOB_IFRAME_URL_ACCOUNT_LIST)||"https://doc.weixin.qq.com/tim/docs/components/IfameManageAccountListToC.html",f=(null==r?void 0:r.TOB_IFRAME_URL_SET_COOKIE)||"https://doc.weixin.qq.com/scenario/iframe-to-b-set-cookie.html",h=(null==r?void 0:r.TOC_TARGET_ORIGIN)||"https://docs.qq.com",b=(null==r?void 0:r.TOC_IFRAME_URL_ACCOUNT_LIST)||"https://docs.qq.com/components/feature/IframeToManageAccountList.html",_=(null==r?void 0:r.TOC_IFRAME_URL_SET_COOKIE)||"https://docs.qq.com/scenario/iframe-to-c-set-cookie.html",v=function(){return location.host===s}},dd1b838932:function(e,t,n){"use strict";n.r(t),n.d(t,"getHash",(function(){return c})),n.d(t,"getHost",(function(){return s})),n.d(t,"getHostname",(function(){return u})),n.d(t,"getPathname",(function(){return d})),n.d(t,"getOrigin",(function(){return l})),n.d(t,"getProtocol",(function(){return p})),n.d(t,"getSearch",(function(){return f})),n.d(t,"getPort",(function(){return h})),n.d(t,"getHref",(function(){return b})),n.d(t,"getQuery",(function(){return _})),n.d(t,"getU",(function(){return v}));var r=n("70eedf593c"),i=n("624cdb524f"),o="location",a="u";function c(){return Object(i.b)(r.a,o)?location.hash:""}function s(){return Object(i.b)(r.a,o)?location.host:""}function u(){return Object(i.b)(r.a,o)?location.hostname:""}function d(){return Object(i.b)(r.a,o)?location.pathname:""}function l(){return Object(i.b)(r.a,o)?location.origin:""}function p(){return Object(i.b)(r.a,o)?location.protocol:""}function f(){return Object(i.b)(r.a,o)?location.search:""}function h(){return Object(i.b)(r.a,o)?location.port:""}function b(){return Object(i.b)(r.a,o)?location.href:""}function _(e,t){if(void 0===t&&(t={shouldDecodeURI:!1}),!Object(i.b)(r.a,o))return"";var n=new RegExp("(\\?|&)".concat(e,"=([^&]*)(#|&|$)")),a=((null==t?void 0:t.shouldDecodeURI)?decodeURIComponent(f()):f()).match(n);return a?decodeURIComponent(a[2]):""}function v(){return _(a)}},de6faa8732:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var r=n("d7c625d1f2"),i=n("76702c352f"),o=n("b40f27bf29"),a=n("03808c4177"),c=n("5be39fbf8a"),s=n("6423ed0b81"),u=n("fb1099018f"),d="".concat(u.h,"/cgi-bin/template/mytemplate_add"),l="".concat(u.h,"/cgi-bin/template/template_detail"),p="".concat(u.h,"/ep/api/settipflag"),f=function(){function e(e){this.networkRequestService=e}return e.prototype.addToMyTemplate=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){return t=Object(c.d)(Object(r.__assign)(Object(r.__assign)({},e),{xsrf:Object(s.c)(s.a.xsrf)})),[2,this.networkRequestService.instance.post(d,t)]}))}))},e.prototype.templateDetail=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){return t=Object(c.d)(Object(r.__assign)(Object(r.__assign)({},e),{template_type:3,xsrf:Object(s.c)(s.a.xsrf)})),[2,this.networkRequestService.instance.post(l,t)]}))}))},e.prototype.setTipFlag=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){return t=Object(c.d)({globalPadId:e,type:37,flag:1,xsrf:Object(s.c)(s.a.xsrf)}),[2,this.networkRequestService.instance.post(p,t)]}))}))},e=Object(r.__decorate)([Object(r.__param)(0,a.a),Object(r.__metadata)("design:paramtypes",[Object])],e)}(),h=n("540dabb65d"),b=function(){function e(){this.templateRepository=new f(new o.a)}return e.prototype.init=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){return[2]}))}))},e.prototype.addToMyTemplate=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.templateRepository.addToMyTemplate(e)]}))}))},e.prototype.templateDetail=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.templateRepository.templateDetail(e)]}))}))},e.prototype.setTipFlag=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.templateRepository.setTipFlag(e)]}))}))},Object(r.__decorate)([Object(h.a)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"init",null),Object(r.__decorate)([Object(i.b)(),Object(i.c)(),Object(i.e)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"addToMyTemplate",null),Object(r.__decorate)([Object(i.b)(),Object(i.c)(),Object(i.e)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"templateDetail",null),Object(r.__decorate)([Object(i.b)(),Object(i.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"setTipFlag",null),e}()},e0b256019d:function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));var r=n("d7c625d1f2"),i=n("76702c352f"),o=n("b40f27bf29"),a=n("03808c4177"),c=n("5be39fbf8a"),s=n("fb1099018f"),u="".concat(s.c,"doc_collect"),d="".concat(s.c,"doc_getcollect"),l="".concat(s.c,"createdoc_new"),p="".concat(s.c,"doc_recover"),f="".concat(s.c,"doc_humtrans"),h="".concat(s.b,"can/move"),b=n("6423ed0b81"),_=n("6fa7b8d7bc"),v=function(){function e(e){this.networkRequestService=e}return e.prototype.collect=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){return t=Object(c.d)(Object(r.__assign)(Object(r.__assign)({},e),{xsrf:Object(b.c)(b.a.xsrf)})),[2,this.networkRequestService.instance.post(u,t)]}))}))},e.prototype.getDocCollect=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(r.__generator)(this,(function(i){return t=Object(r.__assign)(Object(r.__assign)({},e),{xsrf:"".concat(Object(b.c)(b.a.xsrf))}),n=Object(_.a)(d,t),[2,this.networkRequestService.instance.get(n)]}))}))},e.prototype.createDoc=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){return t=Object(c.d)(Object(r.__assign)(Object(r.__assign)({},e),{xsrf:Object(b.c)(b.a.xsrf)})),[2,this.networkRequestService.instance.post(l,t)]}))}))},e.prototype.recover=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){return t=Object(c.d)(Object(r.__assign)(Object(r.__assign)({},e),{xsrf:Object(b.c)(b.a.xsrf)})),[2,this.networkRequestService.instance.post(p,t)]}))}))},e.prototype.docHumtrans=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){return t=Object(c.d)(Object(r.__assign)(Object(r.__assign)({},e),{xsrf:Object(b.c)(b.a.xsrf)})),[2,this.networkRequestService.instance.post(f,t)]}))}))},e.prototype.canMove=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(r.__generator)(this,(function(i){return t=Object(r.__assign)(Object(r.__assign)({},e),{xsrf:"".concat(Object(b.c)(b.a.xsrf))}),n=Object(_.a)(h,t),[2,this.networkRequestService.instance.get(n)]}))}))},e=Object(r.__decorate)([Object(r.__param)(0,a.a),Object(r.__metadata)("design:paramtypes",[Object])],e)}(),y=n("540dabb65d"),g=function(){function e(){this.fileRepository=new v(new o.a)}return e.prototype.init=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){return[2]}))}))},e.prototype.collect=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.fileRepository.collect(e)]}))}))},e.prototype.getDocCollect=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.fileRepository.getDocCollect(e)]}))}))},e.prototype.createDoc=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.fileRepository.createDoc(e)]}))}))},e.prototype.recover=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.fileRepository.recover(e)]}))}))},e.prototype.docHumtrans=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.fileRepository.docHumtrans(e)]}))}))},e.prototype.canMove=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.fileRepository.canMove(e)]}))}))},Object(r.__decorate)([Object(y.a)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"init",null),Object(r.__decorate)([Object(i.b)(),Object(i.c)(),Object(i.e)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"collect",null),Object(r.__decorate)([Object(i.b)(),Object(i.c)(),Object(i.e)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"getDocCollect",null),Object(r.__decorate)([Object(i.b)(),Object(i.c)(),Object(i.e)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"createDoc",null),Object(r.__decorate)([Object(i.b)(),Object(i.c)(),Object(i.e)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"recover",null),Object(r.__decorate)([Object(i.b)(),Object(i.c)(),Object(i.e)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"docHumtrans",null),Object(r.__decorate)([Object(i.b)(),Object(i.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"canMove",null),e}()},e80cda9f13:function(e,t,n){"use strict";n.d(t,"a",(function(){return re}));var r=n("d7c625d1f2"),i=n("03808c4177"),o=n("536530eec5"),a=n("76702c352f"),c=n("fb1099018f"),s="".concat(c.c,"user_recent"),u="".concat(c.c,"auth_sendmsg"),d="".concat(c.h,"/cgi-go/common-notify/view"),l="".concat(c.c,"browser_list"),p="".concat(c.h,"/v2/privilege/wxsharelink/save"),f="".concat(c.h,"/v2/privilege/wxsharelink/get"),h="".concat(c.h,"/v2/privilege/wxsharelink/recall"),b="".concat(c.c,"wxqrcode"),_="".concat(c.c,"qq_import/setTips"),v="".concat(c.h,"/cgi-bin/online_docs/share_doc"),y="".concat(c.c,"auth_info/update"),g="".concat(c.h,"/sdc/friends"),m="".concat(c.h,"/sdc/gmembers"),O="".concat(c.h,"/sdc/dmembers"),j="".concat(c.h,"/v2/group/getinfo"),w="".concat(c.h,"/v2/sdc/friendchat"),I="".concat(c.h,"/v2/util/qq/auth/check"),S="".concat(c.h,"/enterprise/v1/cig/departments"),E="".concat(c.h,"/enterprise/v1/cig/search-user"),x="".concat(c.c,"group_list"),C="".concat(c.c,"group_members"),A="".concat(c.c,"group_modify"),k="".concat(c.c,"group_deletemember"),R="".concat(c.c,"group_remove"),D="".concat(c.c,"group_addmember"),T="".concat(c.c,"group_create"),N="".concat(c.c,"group_info"),M="".concat(c.c,"group_quit"),P="".concat(c.c,"group_checker"),L="".concat(c.c,"group_addkey"),U="".concat(c.c,"group_activate"),B=function(){function e(e,t){this.docMetaDomainService=e,this.networkRequestService=t}return e.prototype.fetchGroupList=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n;return Object(r.__generator)(this,(function(i){return n={start:e,limit:t,t:(new Date).getTime()},[2,this.networkRequestService.instance.post(x,Object(r.__assign)({},n))]}))}))},e.prototype.fetchGroupMembers=function(e,t,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var i;return Object(r.__generator)(this,(function(o){return i={group_id:e,start:t,limit:n,t:(new Date).getTime()},[2,this.networkRequestService.instance.post(C,Object(r.__assign)({},i))]}))}))},e.prototype.modifyGroup=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n;return Object(r.__generator)(this,(function(i){return n={group_id:e,group_name:t},[2,this.networkRequestService.instance.post(A,Object(r.__assign)({},n))]}))}))},e.prototype.deleteGroupMember=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n;return Object(r.__generator)(this,(function(i){return n={group_id:e,mem_list:[t]},[2,this.networkRequestService.instance.post(k,Object(r.__assign)({},n))]}))}))},e.prototype.removeGroup=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){return t={group_id:e},[2,this.networkRequestService.instance.post(R,Object(r.__assign)({},t))]}))}))},e.prototype.addGroupMember=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n;return Object(r.__generator)(this,(function(i){return n={group_id:e,mem_list:JSON.stringify(t)},[2,this.networkRequestService.instance.post(D,Object(r.__assign)({},n))]}))}))},e.prototype.createGroup=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n;return Object(r.__generator)(this,(function(i){return n={group_name:e,is_temp:t},[2,this.networkRequestService.instance.post(T,Object(r.__assign)({},n))]}))}))},e.prototype.fetchGroupInfo=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){return t={group_id:e,get_key:false},[2,this.networkRequestService.instance.post(N,Object(r.__assign)({},t))]}))}))},e.prototype.quitGroup=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){return t={group_id:e},[2,this.networkRequestService.instance.post(M,Object(r.__assign)({},t))]}))}))},e.prototype.checkCreateGroup=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e;return Object(r.__generator)(this,(function(t){return e={},[2,this.networkRequestService.instance.post(P,Object(r.__assign)({},e))]}))}))},e.prototype.addKeyToGroup=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n;return Object(r.__generator)(this,(function(i){return n={group_id:e,share_key:t},[2,this.networkRequestService.instance.post(L,Object(r.__assign)({},n))]}))}))},e.prototype.activateGroup=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){return t={group_id:e},[2,this.networkRequestService.instance.post(U,Object(r.__assign)({},t))]}))}))},e=Object(r.__decorate)([Object(r.__param)(0,o.a),Object(r.__param)(1,i.a),Object(r.__metadata)("design:paramtypes",[Object,Object])],e)}(),q=function(){function e(e,t){this.docMetaDomainService=e,this.networkRequest=t,this.groupShareRepository=new B(e,t)}return e.prototype.fetchGroupList=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(n){return[2,this.groupShareRepository.fetchGroupList(e,t)]}))}))},e.prototype.fetchGroupMembers=function(e,t,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(r){return[2,this.groupShareRepository.fetchGroupMembers(e,t,n)]}))}))},e.prototype.modifyGroup=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(n){return[2,this.groupShareRepository.modifyGroup(e,t)]}))}))},e.prototype.deleteGroupMember=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(n){return[2,this.groupShareRepository.deleteGroupMember(e,t)]}))}))},e.prototype.removeGroup=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.groupShareRepository.removeGroup(e)]}))}))},e.prototype.addGroupMember=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(n){return[2,this.groupShareRepository.addGroupMember(e,t)]}))}))},e.prototype.createGroup=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(n){return[2,this.groupShareRepository.createGroup(e,t)]}))}))},e.prototype.fetchGroupInfo=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.groupShareRepository.fetchGroupInfo(e)]}))}))},e.prototype.quitGroup=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.groupShareRepository.quitGroup(e)]}))}))},e.prototype.checkCreateGroup=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){return[2,this.groupShareRepository.checkCreateGroup()]}))}))},e.prototype.addKeyToGroup=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(n){return[2,this.groupShareRepository.addKeyToGroup(e,t)]}))}))},e.prototype.activateGroup=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.groupShareRepository.activateGroup(e)]}))}))},Object(r.__decorate)([Object(a.b)(),Object(a.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Number,Number]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"fetchGroupList",null),Object(r.__decorate)([Object(a.b)(),Object(a.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String,Number,Number]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"fetchGroupMembers",null),Object(r.__decorate)([Object(a.b)(),Object(a.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String,String]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"modifyGroup",null),Object(r.__decorate)([Object(a.b)(),Object(a.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String,String]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"deleteGroupMember",null),Object(r.__decorate)([Object(a.b)(),Object(a.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"removeGroup",null),Object(r.__decorate)([Object(a.b)(),Object(a.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String,Array]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"addGroupMember",null),Object(r.__decorate)([Object(a.b)(),Object(a.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String,Boolean]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"createGroup",null),Object(r.__decorate)([Object(a.b)(),Object(a.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"fetchGroupInfo",null),Object(r.__decorate)([Object(a.b)(),Object(a.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"quitGroup",null),Object(r.__decorate)([Object(a.b)(),Object(a.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"checkCreateGroup",null),Object(r.__decorate)([Object(a.b)(),Object(a.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String,String]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"addKeyToGroup",null),Object(r.__decorate)([Object(a.b)(),Object(a.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"activateGroup",null),e=Object(r.__decorate)([Object(r.__param)(0,o.a),Object(r.__param)(1,i.a),Object(r.__metadata)("design:paramtypes",[Object,Object])],e)}(),F=n("6423ed0b81"),V=n("6fa7b8d7bc"),G=function(){function e(e,t){this.docMetaDomainService=e,this.networkRequestService=t}return e.prototype.fetchOrganizationalStructureList=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n,i;return Object(r.__generator)(this,(function(r){return n={deptID:t,corpID:e,t:(new Date).getTime(),xsrf:"".concat(Object(F.c)(F.a.xsrf))},i=Object(V.a)(S,n),[2,this.networkRequestService.instance.get(i)]}))}))},e.prototype.searchQFYFUser=function(e,t,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var i,o;return Object(r.__generator)(this,(function(r){return i={corpid:e,pos:n,num:20,word:t,xsrf:"".concat(Object(F.c)(F.a.xsrf)),t:(new Date).getTime()},o=Object(V.a)(E,i),[2,this.networkRequestService.instance.get(o)]}))}))},e=Object(r.__decorate)([Object(r.__param)(0,o.a),Object(r.__param)(1,i.a),Object(r.__metadata)("design:paramtypes",[Object,Object])],e)}(),W=function(){function e(e,t){this.docMetaDomainService=e,this.networkRequest=t,this.qfyfShareRepository=new G(e,t)}return e.prototype.fetchOrganizationalStructureList=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(n){return[2,this.qfyfShareRepository.fetchOrganizationalStructureList(e,t)]}))}))},e.prototype.searchQFYFUser=function(e,t,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(r){return[2,this.qfyfShareRepository.searchQFYFUser(e,t,n)]}))}))},Object(r.__decorate)([Object(a.b)(),Object(a.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String,String]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"fetchOrganizationalStructureList",null),Object(r.__decorate)([Object(a.b)(),Object(a.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String,String,String]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"searchQFYFUser",null),e=Object(r.__decorate)([Object(r.__param)(0,o.a),Object(r.__param)(1,i.a),Object(r.__metadata)("design:paramtypes",[Object,Object])],e)}(),K=n("5be39fbf8a"),H=n("3c9d61c2e2"),Q=function(){function e(e,t,n){this.docMetaDomainService=e,this.networkRequestService=t,this.userInfoDomainService=n}return e.prototype.checkIfCanShare=function(){return Object(r.__awaiter)(this,arguments,void 0,(function(e){var t,n,i,o;return void 0===e&&(e=!1),Object(r.__generator)(this,(function(a){return t=Object(K.d)({padId:this.docMetaDomainService.docMetaEntity.padInfo.padId,xsrf:Object(F.c)(F.a.xsrf)}),n={contentType:"application/x-www-form-urlencoded"},i=Object(r.__assign)({},e?{uflag:"qqsig"}:null),o=Object(V.a)(y,i),[2,this.networkRequestService.instance.post(o,t,n)]}))}))},e.prototype.setTipsAfterImport=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,o;return Object(r.__generator)(this,(function(a){return t=e.fileMd5,n=e.guestUid,i=e.guestUidType,o={file_md5:t,guest_uid:n,guest_uid_type:i,tips_showed_fl:1},[2,this.networkRequestService.instance.post(_,Object(r.__assign)({},o))]}))}))},e.prototype.shareToQQOrTIM=function(e){return Object(r.__awaiter)(this,arguments,void 0,(function(e,t){var n,i,o,a;return void 0===t&&(t=!1),Object(r.__generator)(this,(function(c){return n=Object(K.d)({padid:this.docMetaDomainService.docMetaEntity.padInfo.padId,domainid:this.docMetaDomainService.docMetaEntity.padInfo.domainId,uins:JSON.stringify(e),xsrf:Object(F.c)(F.a.xsrf)}),i={contentType:"application/x-www-form-urlencoded"},o=Object(r.__assign)({},t?{uflag:"qqsig"}:null),a=Object(V.a)(v,o),[2,this.networkRequestService.instance.post(a,n,i)]}))}))},e.prototype.fetchFriendsInfo=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(r.__generator)(this,(function(n){return e={t:(new Date).getTime(),xsrf:"".concat(Object(F.c)(F.a.xsrf))},t=Object(V.a)(g,e),[2,this.networkRequestService.instance.get(t)]}))}))},e.prototype.fetchGroupMember=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(r.__generator)(this,(function(r){return t={dstuin:e,t:(new Date).getTime(),xsrf:"".concat(Object(F.c)(F.a.xsrf))},n=Object(V.a)(m,t),[2,this.networkRequestService.instance.get(n)]}))}))},e.prototype.fetchDiscussGroupMember=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(r.__generator)(this,(function(r){return t={dstuin:e,t:(new Date).getTime(),xsrf:"".concat(Object(F.c)(F.a.xsrf))},n=Object(V.a)(O,t),[2,this.networkRequestService.instance.get(n)]}))}))},e.prototype.checkSkeyAuth=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e;return Object(r.__generator)(this,(function(t){return e={uin:this.userInfoDomainService.userInfoAggregate.userInfo.uin,p_lskey:Object(K.g)()||"",p_skey:Object(K.h)()||""},[2,this.networkRequestService.instance.post(I,Object(r.__assign)({},e))]}))}))},e.prototype.fetchGroupInfo=function(e){var t={groupCode:e,xsrf:"".concat(Object(F.c)(F.a.xsrf))};return this.networkRequestService.instance.post(j,Object(r.__assign)({},t))},e.prototype.fetchFriendInfo=function(e){var t={uin:"".concat(e),xsrf:"".concat(Object(F.c)(F.a.xsrf))};return this.networkRequestService.instance.post(w,Object(r.__assign)({},t))},e=Object(r.__decorate)([Object(r.__param)(0,o.a),Object(r.__param)(1,i.a),Object(r.__param)(2,H.a),Object(r.__metadata)("design:paramtypes",[Object,Object,Object])],e)}(),z=Q,Y=n("65e41bd588"),J=function(){function e(e,t,n){this.docMetaDomainService=e,this.networkRequest=t,this.userInfoDomainService=n,this.qqShareRepository=new z(e,t,n)}return e.prototype.checkIfCanShare=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(r.__generator)(this,(function(n){return e=this.userInfoDomainService.userInfoAggregate.userInfo.loginType,t=![Y.a.QQ,Y.a.WX].includes(e),[2,this.qqShareRepository.checkIfCanShare(t)]}))}))},e.prototype.setTipsAfterImport=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.qqShareRepository.setTipsAfterImport(e)]}))}))},e.prototype.shareToQQOrTIM=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(r.__generator)(this,(function(r){return t=this.userInfoDomainService.userInfoAggregate.userInfo.loginType,n=![Y.a.QQ,Y.a.WX].includes(t),[2,this.qqShareRepository.shareToQQOrTIM(e,n)]}))}))},e.prototype.fetchFriendsInfo=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){return[2,this.qqShareRepository.fetchFriendsInfo()]}))}))},e.prototype.fetchGroupMember=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.qqShareRepository.fetchGroupMember(e)]}))}))},e.prototype.fetchDiscussGroupMember=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.qqShareRepository.fetchDiscussGroupMember(e)]}))}))},e.prototype.checkSkeyAuth=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){return[2,this.qqShareRepository.checkSkeyAuth()]}))}))},e.prototype.fetchGroupInfo=function(e){return this.qqShareRepository.fetchGroupInfo(e)},e.prototype.fetchFriendInfo=function(e){return this.qqShareRepository.fetchFriendInfo(e)},Object(r.__decorate)([Object(a.b)(),Object(a.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"checkIfCanShare",null),Object(r.__decorate)([Object(a.b)(),Object(a.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"setTipsAfterImport",null),Object(r.__decorate)([Object(a.b)(),Object(a.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Array]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"shareToQQOrTIM",null),Object(r.__decorate)([Object(a.b)(),Object(a.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"fetchFriendsInfo",null),Object(r.__decorate)([Object(a.b)(),Object(a.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"fetchGroupMember",null),Object(r.__decorate)([Object(a.b)(),Object(a.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"fetchDiscussGroupMember",null),Object(r.__decorate)([Object(a.b)(),Object(a.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"checkSkeyAuth",null),Object(r.__decorate)([Object(a.b)(),Object(a.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"fetchGroupInfo",null),Object(r.__decorate)([Object(a.b)(),Object(a.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"fetchFriendInfo",null),e=Object(r.__decorate)([Object(r.__param)(0,o.a),Object(r.__param)(1,i.a),Object(r.__param)(2,H.a),Object(r.__metadata)("design:paramtypes",[Object,Object,Object])],e)}(),X=function(){function e(e,t){this.docMetaDomainService=e,this.networkRequestService=t}return e.prototype.fetchRecentUserInfo=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(r.__generator)(this,(function(n){return e={padId:this.docMetaDomainService.docMetaEntity.padInfo.padId,domain:this.docMetaDomainService.docMetaEntity.padInfo.domainId,xsrf:"".concat(Object(F.c)(F.a.xsrf))},t=Object(V.a)(s,e),[2,this.networkRequestService.instance.post(t)]}))}))},e.prototype.sendDocToMember=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n;return Object(r.__generator)(this,(function(i){return n={padId:this.docMetaDomainService.docMetaEntity.padInfo.padId,domainId:this.docMetaDomainService.docMetaEntity.padInfo.domainId,addmemlist:JSON.stringify(e),corpid:Object(K.b)(t),xsrf:Object(F.c)(F.a.xsrf)},[2,this.networkRequestService.instance.post(u,Object(r.__assign)({},n))]}))}))},e.prototype.exportToPC=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e;return Object(r.__generator)(this,(function(t){return e={padId:this.docMetaDomainService.docMetaEntity.padInfo.padId,xsrf:Object(F.c)(F.a.xsrf)},[2,this.networkRequestService.instance.post(d,Object(r.__assign)({},e))]}))}))},e.prototype.fetchBrowserList=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n,i;return Object(r.__generator)(this,(function(r){return n={domain_id:this.docMetaDomainService.docMetaEntity.padInfo.domainId,pad_id:this.docMetaDomainService.docMetaEntity.padInfo.padId,start:e,limit:t,xsrf:"".concat(Object(F.c)(F.a.xsrf)),t:(new Date).getTime()},i=Object(V.a)(l,n),[2,this.networkRequestService.instance.get(i)]}))}))},e=Object(r.__decorate)([Object(r.__param)(0,o.a),Object(r.__param)(1,i.a),Object(r.__metadata)("design:paramtypes",[Object,Object])],e)}(),$=function(){function e(e,t){this.docMetaDomainService=e,this.networkRequest=t,this.shareRepository=new X(e,t)}return e.prototype.sendDocToMember=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(n){return[2,this.shareRepository.sendDocToMember(e,t)]}))}))},e.prototype.fetchRecentUserInfo=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){return[2,this.shareRepository.fetchRecentUserInfo()]}))}))},e.prototype.exportToPC=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){return[2,this.shareRepository.exportToPC()]}))}))},e.prototype.fetchBrowserList=function(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(n){return[2,this.shareRepository.fetchBrowserList(e,t)]}))}))},Object(r.__decorate)([Object(a.b)(),Object(a.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Array,String]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"sendDocToMember",null),Object(r.__decorate)([Object(a.b)(),Object(a.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"fetchRecentUserInfo",null),Object(r.__decorate)([Object(a.b)(),Object(a.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"exportToPC",null),Object(r.__decorate)([Object(a.b)(),Object(a.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Number,Number]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"fetchBrowserList",null),e=Object(r.__decorate)([Object(r.__param)(0,o.a),Object(r.__param)(1,i.a),Object(r.__metadata)("design:paramtypes",[Object,Object])],e)}(),Z=function(){function e(e,t){this.docMetaDomainService=e,this.networkRequestService=t}return e.prototype.addWxShareLinkCount=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){return t={doc_id:this.docMetaDomainService.docMetaEntity.padInfo.padId,token:e},[2,this.networkRequestService.instance.post(p,Object(r.__assign)({},t))]}))}))},e.prototype.fetchWxShareLinkCount=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e;return Object(r.__generator)(this,(function(t){return e={doc_id:this.docMetaDomainService.docMetaEntity.padInfo.padId},[2,this.networkRequestService.instance.post(f,Object(r.__assign)({},e))]}))}))},e.prototype.wxShare=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,o;return Object(r.__generator)(this,(function(a){return t=e.groupId,n=e.shareLink,i=e.policy,o={groupId:Object(K.b)(t),domainId:this.docMetaDomainService.docMetaEntity.padInfo.domainId,padId:this.docMetaDomainService.docMetaEntity.padInfo.padId,page:"h5",right_flag:2,type:1,param:encodeURIComponent(n),ac:"share",policy:i,xsrf:Object(F.c)(F.a.xsrf)},[2,this.networkRequestService.instance.post(b,Object(r.__assign)({},o))]}))}))},e.prototype.stopWxShare=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e;return Object(r.__generator)(this,(function(t){return e={doc_id:this.docMetaDomainService.docMetaEntity.padInfo.padId},[2,this.networkRequestService.instance.post(h,Object(r.__assign)({},e))]}))}))},e=Object(r.__decorate)([Object(r.__param)(0,o.a),Object(r.__param)(1,i.a),Object(r.__metadata)("design:paramtypes",[Object,Object])],e)}(),ee=function(){function e(e,t){this.docMetaDomainService=e,this.networkRequest=t,this.weChatShareRepository=new Z(e,t)}return e.prototype.fetchWxShareLinkCount=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){return[2,this.weChatShareRepository.fetchWxShareLinkCount()]}))}))},e.prototype.stopWxShare=function(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){return[2,this.weChatShareRepository.stopWxShare()]}))}))},e.prototype.addWxShareLinkCount=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.weChatShareRepository.addWxShareLinkCount(e)]}))}))},e.prototype.wxShare=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,this.weChatShareRepository.wxShare(e)]}))}))},Object(r.__decorate)([Object(a.b)(),Object(a.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"fetchWxShareLinkCount",null),Object(r.__decorate)([Object(a.b)(),Object(a.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"stopWxShare",null),Object(r.__decorate)([Object(a.b)(),Object(a.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[String]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"addWxShareLinkCount",null),Object(r.__decorate)([Object(a.b)(),Object(a.c)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"wxShare",null),e=Object(r.__decorate)([Object(r.__param)(0,o.a),Object(r.__param)(1,i.a),Object(r.__metadata)("design:paramtypes",[Object,Object])],e)}(),te=function(){function e(e,t,n){this.docMetaDomainService=e,this.networkRequestService=t,this.userInfoDomainService=n,this.shareEntity=new $(e,t),this.groupShareEntity=new q(e,t),this.qqShareEntity=new J(e,t,n),this.weChatShareEntity=new ee(e,t),this.qfyfShareEntity=new W(e,t)}return e=Object(r.__decorate)([Object(r.__param)(0,o.a),Object(r.__param)(1,i.a),Object(r.__param)(2,H.a),Object(r.__metadata)("design:paramtypes",[Object,Object,Object])],e)}(),ne=n("540dabb65d"),re=function(){function e(e,t,n){this.docMetaDomainService=e,this.networkRequest=t,this.userInfoDomainService=n,this.shareAggregate=new te(e,t,n)}return e.prototype.init=function(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){switch(t.label){case 0:return[4,Promise.all([this.docMetaDomainService.init(e),this.userInfoDomainService.init(e)])];case 1:return t.sent(),[2]}}))}))},Object(r.__decorate)([Object(ne.a)(),Object(r.__metadata)("design:type",Function),Object(r.__metadata)("design:paramtypes",[Object]),Object(r.__metadata)("design:returntype",Promise)],e.prototype,"init",null),e=Object(r.__decorate)([Object(r.__param)(0,o.a),Object(r.__param)(1,i.a),Object(r.__param)(2,H.a),Object(r.__metadata)("design:paramtypes",[Object,Object,Object])],e)}()},e9fad8bcaf:function(e,t,n){"use strict";var r=n("94b54f38ee"),i=n("ac1e2b0319"),o=n("446c52c6f2"),a=n("f8cdcb88e2"),c=n("4498e7a6fb"),s=n("c89632fe6d"),u=s.validators;function d(e){this.defaults=e,this.interceptors={request:new o,response:new o}}d.prototype.request=function(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},(t=c(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var n=t.transitional;void 0!==n&&s.assertOptions(n,{silentJSONParsing:u.transitional(u.boolean),forcedJSONParsing:u.transitional(u.boolean),clarifyTimeoutError:u.transitional(u.boolean)},!1);var r=[],i=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(i=i&&e.synchronous,r.unshift(e.fulfilled,e.rejected))}));var o,d=[];if(this.interceptors.response.forEach((function(e){d.push(e.fulfilled,e.rejected)})),!i){var l=[a,void 0];for(Array.prototype.unshift.apply(l,r),l=l.concat(d),o=Promise.resolve(t);l.length;)o=o.then(l.shift(),l.shift());return o}for(var p=t;r.length;){var f=r.shift(),h=r.shift();try{p=f(p)}catch(e){h(e);break}}try{o=a(p)}catch(e){return Promise.reject(e)}for(;d.length;)o=o.then(d.shift(),d.shift());return o},d.prototype.getUri=function(e){return e=c(this.defaults,e),i(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},r.forEach(["delete","get","head","options"],(function(e){d.prototype[e]=function(t,n){return this.request(c(n||{},{method:e,url:t,data:(n||{}).data}))}})),r.forEach(["post","put","patch"],(function(e){d.prototype[e]=function(t,n,r){return this.request(c(r||{},{method:e,url:t,data:n}))}})),e.exports=d},eec87fff73:function(e,t,n){"use strict";e.exports=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}},f3360fb665:function(e,t,n){"use strict";n.d(t,"a",(function(){return E}));var r,i,o,a,c,s,u=n("d7c625d1f2"),d=n("2c8ead4d96"),l=n("536530eec5"),p=n("3c9d61c2e2"),f=n("10f9b6de11"),h=n("540dabb65d"),b=n("dd1b838932"),_=n("9ab1857893"),v=n("b512c0eccb"),y=n("6423ed0b81"),g=n("f37f38404e"),m=n("4f3b15d017");!function(e){e.NO_VIP_USER="novip_user",e.VIP_USER="vip_user",e.SUPER_VIP_USER="svip_user",e.SUPER_VIP_PLUS_USER="svip_plus"}(r||(r={})),function(e){e.OPERATION_NAME="doc_vip_like",e.MODULE="switch"}(i||(i={})),function(e){e.ON="on",e.OFF="off"}(o||(o={})),function(e){e.PC_TITLEBAR="pc_titlebar",e.MOBILE_TITLEBAR="mobile_titlebar"}(a||(a={})),function(e){e.DOC_VIP_LIKE_SWITCH_ON="doc_vip_like-switch-on",e.DOC_VIP_LIKE_SWITCH_OFF="doc_vip_like-switch-off"}(c||(c={})),function(e){e[e.VIP_OFF=1]="VIP_OFF",e[e.VIP_ON=2]="VIP_ON"}(s||(s={}));var O=new m.UserAgent,j=function(e){return"".concat(e).concat(~e.indexOf("?")?"&":"?","xsrf=").concat(Object(y.c)(y.a.xsrf))},w=function(){function e(e,t,n){this.docMetaDomain=e,this.userInfoDomainService=t,this.accountDomainService=n}return e.prototype.like=function(e,t){return Object(u.__awaiter)(this,void 0,void 0,(function(){var n;return Object(u.__generator)(this,(function(r){return n={file_id:e,icon_id:t},[2,v.networkRequest.post(j("/cgi-bin/like/like"),n)]}))}))},e.prototype.getLikeIconList=function(e){return Object(u.__awaiter)(this,void 0,void 0,(function(){var t;return Object(u.__generator)(this,(function(n){return t={offset:0,limit:100},e&&(t={offset:0,limit:100,file_id:e}),[2,v.networkRequest.post(j("/cgi-bin/like/icon/list"),t)]}))}))},e.prototype.setLikeEnable=function(e,t){return Object(u.__awaiter)(this,void 0,void 0,(function(){var n,d,l,p,f,h;return Object(u.__generator)(this,(function(u){return n=this.accountDomainService.accountAggregate.vipInfo,d=n.vip,l=n.svip,p=n.svipPlus,f=p.status===s.VIP_ON?r.SUPER_VIP_PLUS_USER:l.status===s.VIP_ON?r.SUPER_VIP_USER:d.status===s.VIP_ON?r.VIP_USER:r.NO_VIP_USER,Object(g.a)({opername:i.OPERATION_NAME,module:i.MODULE,action:t?o.ON:o.OFF,eventcode:t?c.DOC_VIP_LIKE_SWITCH_ON:c.DOC_VIP_LIKE_SWITCH_OFF,ver5:f,ver8:O.isPC?a.PC_TITLEBAR:a.MOBILE_TITLEBAR}),h={enable:t,file_id:e},[2,v.networkRequest.post(j("/cgi-bin/like/enable/set"),h)]}))}))},e.prototype.isBanned=function(e){return Object(u.__awaiter)(this,void 0,void 0,(function(){var t;return Object(u.__generator)(this,(function(n){return t={file_id:e},[2,v.networkRequest.post(j("/cgi-bin/like/disabled"),t)]}))}))},e.prototype.getLikeRecordCount=function(e){return Object(u.__awaiter)(this,void 0,void 0,(function(){var t;return Object(u.__generator)(this,(function(n){return t={file_id:e},[2,v.networkRequest.post(j("/cgi-bin/like/record/count"),t)]}))}))},e.prototype.getLikeRecordList=function(e,t,n){return Object(u.__awaiter)(this,void 0,void 0,(function(){var r;return Object(u.__generator)(this,(function(i){return r={file_id:e,start_record_id:t,limit:n,is_desc:!0},[2,v.networkRequest.post(j("/cgi-bin/like/record/list"),r)]}))}))},e=Object(u.__decorate)([Object(u.__param)(0,l.a),Object(u.__param)(1,p.a),Object(u.__param)(2,d.a),Object(u.__metadata)("design:paramtypes",[Object,Object,Object])],e)}(),I=function(){function e(){}return e.prototype.getOwnerVipLevel=function(e){return Object(u.__awaiter)(this,void 0,void 0,(function(){return Object(u.__generator)(this,(function(t){return[2,v.networkRequest.post("/api/personalize/owner/viplevel",{file_id:e})]}))}))},e}(),S=function(){function e(e,t,n){this.docMetaDomain=e,this.userInfoDomain=t,this.accountDomainService=n,this.likeRepo=new w(e,t,n),this.ownerVipRepo=new I,this.onLikeDataChangedEmitter=new _.Emitter,this.onLikeDataChangedEvent=this.onLikeDataChangedEmitter.event}return e.prototype.init=function(e){this.fileId=e.fileId,this.ownerId=e.ownerId,this.tinyId=e.tinyId},e.prototype.initWithBasicClientVars=function(e){var t,n,r,i,o,a,c;this.fileId=null!==(r=null===(n=null===(t=e.docInfo)||void 0===t?void 0:t.padInfo)||void 0===n?void 0:n.padId)&&void 0!==r?r:"",this.ownerId=null!==(a=null===(o=null===(i=e.docInfo)||void 0===i?void 0:i.ownerInfo)||void 0===o?void 0:o.ownerId)&&void 0!==a?a:"",this.tinyId=null!==(c=e.userInfo.tinyId)&&void 0!==c?c:""},Object.defineProperty(e.prototype,"onLikeDataChanged",{get:function(){return this.onLikeDataChangedEvent},enumerable:!1,configurable:!0}),e.prototype.like=function(e){return Object(u.__awaiter)(this,void 0,void 0,(function(){return Object(u.__generator)(this,(function(t){return[2,this.likeRepo.like(this.fileId,e)]}))}))},e.prototype.getLikeIconList=function(e){return Object(u.__awaiter)(this,void 0,void 0,(function(){return Object(u.__generator)(this,(function(t){return[2,this.likeRepo.getLikeIconList(e)]}))}))},e.prototype.getLikeRecordCount=function(){return Object(u.__awaiter)(this,void 0,void 0,(function(){return Object(u.__generator)(this,(function(e){return[2,this.likeRepo.getLikeRecordCount(this.fileId)]}))}))},e.prototype.getLikeRecordList=function(){return Object(u.__awaiter)(this,arguments,void 0,(function(e,t){return void 0===e&&(e=-1),void 0===t&&(t=50),Object(u.__generator)(this,(function(n){switch(n.label){case 0:return[4,this.likeRepo.getLikeRecordList(this.fileId,e,t)];case 1:return[2,n.sent()]}}))}))},e.prototype.handleRealTimeLikeMessage=function(e){return Object(u.__awaiter)(this,void 0,void 0,(function(){var t=this;return Object(u.__generator)(this,(function(n){return e.forEach((function(e){return Object(u.__awaiter)(t,void 0,void 0,(function(){var t,n,r;return Object(u.__generator)(this,(function(i){return t=e.body.notice,n=t.type,r=t.payload,"like"!==n?[2,console.error("unknown like domain ws message type:",n)]:(this.onLikeDataChangedEmitter.fire({newCount:r.count,newRecord:JSON.parse(r.like_record)}),[2])}))}))})),[2]}))}))},e.prototype.setLikeEnable=function(e){return Object(u.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(u.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.likeRepo.setLikeEnable(this.fileId,e)];case 1:if(t=r.sent(),0!==(null===(n=t.data)||void 0===n?void 0:n.retcode))throw Error("/cgi-bin/like/enable/set Request failed");return[2,t.data.result]}}))}))},e.prototype.isLikeEnable=function(e){return Object(u.__awaiter)(this,void 0,void 0,(function(){return Object(u.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.isBannedByFile()];case 1:return t.sent()?[2,!1]:this.isInOwnerIdTailHash(e)?[2,!0]:[2,this.isVipDoc()]}}))}))},e.prototype.isBannedByFile=function(){return Object(u.__awaiter)(this,void 0,void 0,(function(){var e,t,n;return Object(u.__generator)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.likeRepo.isBanned(this.fileId)];case 1:return e=r.sent(),[2,null!==(n=null===(t=e.data.result)||void 0===t?void 0:t.is_disabled)&&void 0!==n&&n];case 2:return r.sent(),[2,!0];case 3:return[2]}}))}))},e.prototype.isVipDoc=function(){return Object(u.__awaiter)(this,void 0,void 0,(function(){var e,t,n;return Object(u.__generator)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.ownerVipRepo.getOwnerVipLevel(this.fileId)];case 1:return e=r.sent(),(null===(t=e.data.result)||void 0===t?void 0:t.vip_level)?[2,(null===(n=e.data.result)||void 0===n?void 0:n.vip_level)>1]:[3,3];case 2:return r.sent(),[3,3];case 3:return[2,!1]}}))}))},e.prototype.isInOwnerIdTailHash=function(e){return!(!e||!this.ownerId)&&parseInt(this.ownerId.slice(-2),10)%100<e},e=Object(u.__decorate)([Object(u.__param)(0,l.a),Object(u.__param)(1,p.a),Object(u.__param)(2,d.a),Object(u.__metadata)("design:paramtypes",[Object,Object,Object])],e)}(),E=function(){function e(e,t,n){var r;if(this.docMetaDomain=e,this.userInfoDomain=t,this.accountDomainService=n,this.likeEntity=new S(e,t,n),window.basicClientVars)this.likeEntity.initWithBasicClientVars(window.basicClientVars);else{var i=null!==(r=location.pathname.split("/"))&&void 0!==r?r:[],o=i[1],a=i[2];if(void 0!==f.DOCUMENT_TYPE_MAP[o]&&a){var c={docId:a,u:Object(b.getQuery)("u")};this.init(c)}}}return e.prototype.init=function(e){return Object(u.__awaiter)(this,void 0,void 0,(function(){return Object(u.__generator)(this,(function(t){switch(t.label){case 0:return[4,Promise.all([this.docMetaDomain.init(e),this.userInfoDomain.init(e)])];case 1:return t.sent(),this.likeEntity.init({fileId:this.docMetaDomain.docMetaEntity.padInfo.padId,ownerId:this.docMetaDomain.docMetaEntity.ownerInfo.ownerId,tinyId:this.userInfoDomain.userInfoAggregate.userInfo.tinyid}),[2]}}))}))},Object(u.__decorate)([Object(h.a)(),Object(u.__metadata)("design:type",Function),Object(u.__metadata)("design:paramtypes",[Object]),Object(u.__metadata)("design:returntype",Promise)],e.prototype,"init",null),e=Object(u.__decorate)([Object(u.__param)(0,l.a),Object(u.__param)(1,p.a),Object(u.__param)(2,d.a),Object(u.__metadata)("design:paramtypes",[Object,Object,Object])],e)}()},f37f38404e:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("570b26a0fa"),i=function(e){var t=e;Object(r.tdwSingle)(t)}},f42cbfcd9d:function(e,t,n){"use strict";var r=n("1cc181d9f8");function i(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;this.promise.then((function(e){if(n._listeners){var t,r=n._listeners.length;for(t=0;t<r;t++)n._listeners[t](e);n._listeners=null}})),this.promise.then=function(e){var t,r=new Promise((function(e){n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e){n.reason||(n.reason=new r(e),t(n.reason))}))}i.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},i.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},i.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},i.source=function(){var e;return{token:new i((function(t){e=t})),cancel:e}},e.exports=i},f4e7deaab4:function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e[e.noPrivilege=0]="noPrivilege",e[e.reader=1]="reader",e[e.editor=2]="editor",e[e.filler=3]="filler",e[e.executor=4]="executor",e[e.externUser=10]="externUser",e[e.administrator=1024]="administrator",e[e.owner=2048]="owner"}(r||(r={}))},f8cdcb88e2:function(e,t,n){"use strict";var r=n("94b54f38ee"),i=n("8ac5678f09"),o=n("052105b914"),a=n("58bffcf462"),c=n("1cc181d9f8");function s(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new c("canceled")}e.exports=function(e){return s(e),e.headers=e.headers||{},e.data=i.call(e,e.data,e.headers,e.transformRequest),e.headers=r.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),r.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||a.adapter)(e).then((function(t){return s(e),t.data=i.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return o(t)||(s(e),t&&t.response&&(t.response.data=i.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},f9f6cd81c2:function(e,t,n){"use strict";var r=n("fa25e7cd6c");e.exports=function(e,t,n,i,o){var a=new Error(e);return r(a,t,n,i,o)}},fa25e7cd6c:function(e,t,n){"use strict";e.exports=function(e,t,n,r,i){return e.config=t,n&&(e.code=n),e.request=r,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},e}},fb1099018f:function(e,t,n){"use strict";n.d(t,"h",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return s})),n.d(t,"e",(function(){return u})),n.d(t,"f",(function(){return d})),n.d(t,"d",(function(){return l})),n.d(t,"i",(function(){return p})),n.d(t,"g",(function(){return f}));var r=n("da5bb142c9"),i=n("dd1b838932"),o="//".concat(Object(i.getHost)()),a="".concat(o,"/cgi-bin/online_docs/"),c="".concat(o,"/cgi-bin/api/"),s="".concat(o,"/cgi-go/"),u="".concat(o,"/v2/"),d="".concat(o,"/v3/"),l="".concat(o,"/cgi-go/"),p="//".concat(r.e),f="//".concat(r.i)},fc82775981:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("cedf7830be"),i=Object(r.a)("IFileInfoDomainService")},ff6b6fad8b:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisposableStore=void 0;var r=n("697ecdc674"),i=n("0d99992889"),o=function(){function e(){this.toDisposeSet=new Set,this.isDisposeState=!1}return e.prototype.dispose=function(e){if(!this.isDisposeState)if(i.markTracked(this),this.isDisposeState=!0,e)this.clear(e);else{var t=r.DisposeTrace.traceRoot(this.constructor.name);this.clear(t),t.stop()}},e.prototype.clear=function(e){this.toDisposeSet.forEach((function(t){var n=t.disposableId||t.constructor.name;t.dispose(null==e?void 0:e.branch(n))})),this.toDisposeSet.clear()},e.prototype.add=function(t){if(!t)return t;if(t===this)throw new Error("Cannot register a disposable on itself!");return i.markTracked(t),this.isDisposeState?e.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this.toDisposeSet.add(t),t},e.DISABLE_DISPOSED_WARNING=!1,e}();t.DisposableStore=o}}]);
//# sourceMappingURL=slide-common~1e529-f5f208.js.map