(this.webpackJsonp=this.webpackJsonp||[]).push([["common~4e144","commonAsync~0c3a6025"],{"0368aca230":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n("6064ce49c9");Object.defineProperty(t,"Disposable",{enumerable:!0,get:function(){return o.Disposable}}),Object.defineProperty(t,"RootDisposable",{enumerable:!0,get:function(){return o.RootDisposable}}),Object.defineProperty(t,"mixinDisposable",{enumerable:!0,get:function(){return o.mixinDisposable}}),Object.defineProperty(t,"mixinRootDisposable",{enumerable:!0,get:function(){return o.mixinRootDisposable}});var r=n("513019d975");Object.defineProperty(t,"DisposableNone",{enumerable:!0,get:function(){return r.DisposableNone}});var i=n("6bb936b136");Object.defineProperty(t,"markTracked",{enumerable:!0,get:function(){return i.markTracked}}),Object.defineProperty(t,"trackDisposable",{enumerable:!0,get:function(){return i.trackDisposable}}),Object.defineProperty(t,"enableDisposablesTrack",{enumerable:!0,get:function(){return i.enableDisposablesTrack}}),Object.defineProperty(t,"disableDisposablesTrack",{enumerable:!0,get:function(){return i.disableDisposablesTrack}});var s=n("6cac31cea5");Object.defineProperty(t,"DisposeTrace",{enumerable:!0,get:function(){return s.DisposeTrace}}),Object.defineProperty(t,"enableDisposeTrace",{enumerable:!0,get:function(){return s.enableDisposeTrace}}),Object.defineProperty(t,"disableDisposeTrace",{enumerable:!0,get:function(){return s.disableDisposeTrace}});var a=n("bc0c4da4ca");Object.defineProperty(t,"toDisposable",{enumerable:!0,get:function(){return a.toDisposable}}),Object.defineProperty(t,"isDisposable",{enumerable:!0,get:function(){return a.isDisposable}}),Object.defineProperty(t,"dispose",{enumerable:!0,get:function(){return a.dispose}}),Object.defineProperty(t,"combinedDisposable",{enumerable:!0,get:function(){return a.combinedDisposable}}),Object.defineProperty(t,"tryToDispose",{enumerable:!0,get:function(){return a.tryToDispose}}),Object.defineProperty(t,"tryToMarkDispose",{enumerable:!0,get:function(){return a.tryToMarkDispose}});var c=n("88476f9607");Object.defineProperty(t,"DisposableStore",{enumerable:!0,get:function(){return c.DisposableStore}});var u=n("dfdd551bdc");Object.defineProperty(t,"CancellationTokenSource",{enumerable:!0,get:function(){return u.CancellationTokenSource}})},"06223329e1":function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},o(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.RequestBackOff=void 0;var i=n("b512c0eccb"),s=function(e){function t(){return e.call(this,0)||this}return r(t,e),t.prototype.next=function(e){var t=e.result,n=e.attempt;if(t&&"error"in t)return t.error.code===i.REQUEST_ERROR_CODE.timeout?(this.duration=0,this):(this.duration=1e3*Math.min(2*n,30),this)},t}(i.BaseBackoff);t.RequestBackOff=s},"08e718accf":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tryToMarkDispose=t.tryToDispose=t.toDisposable=t.combinedDisposable=t.dispose=t.isDisposable=void 0;var o=n("95b75d217e"),r=n("8838f60498");function i(e){return"function"==typeof e.dispose&&(0===e.dispose.length||1===e.dispose.length)}function s(e,t){if(Array.isArray(e)){var n=t||o.DisposeTrace.traceRoot("disposables");return e.forEach((function(e){e&&(r.markTracked(e),e.dispose(n))})),n.stop(),[]}if(e){var i=t||o.DisposeTrace.traceRoot("disposables");return r.markTracked(e),e.dispose(i),i.stop(),e}}t.isDisposable=i,t.dispose=s,t.combinedDisposable=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.forEach(r.markTracked),r.trackDisposable({dispose:function(t){return s(e,t)}})},t.toDisposable=function(e,t){void 0===t&&(t="");var n=r.trackDisposable({dispose:function(t){r.markTracked(n),e(t)},disposableId:t});return n},t.tryToDispose=function(e,t){e&&i(e)&&e.dispose(t)},t.tryToMarkDispose=function(e){i(e)&&r.markTracked(e)}},"094a0886cb":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QUIT_TYPE=void 0,function(e){e.INACTIVE="INACTIVE",e.LOGIN_INVALIDATE="LOGIN_INVALIDATE",e.LOGIN_FORBIDDEN="LOGIN_FORBIDDEN"}(t.QUIT_TYPE||(t.QUIT_TYPE={}))},"09eb40a269":function(e,t){for(var n=[],o=0;o<256;++o)n[o]=(o+256).toString(16).substr(1);e.exports=function(e,t){var o=t||0,r=n;return[r[e[o++]],r[e[o++]],r[e[o++]],r[e[o++]],"-",r[e[o++]],r[e[o++]],"-",r[e[o++]],r[e[o++]],"-",r[e[o++]],r[e[o++]],"-",r[e[o++]],r[e[o++]],r[e[o++]],r[e[o++]],r[e[o++]],r[e[o++]]].join("")}},"0a9f420ed3":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReceiverClient=void 0;var o=n("cdda668c2b"),r=n("49835f837f"),i=n("193c542c4e"),s=function(){function e(e){this.dependency=e,this.position=0,this.onceOpen=!1}return e.prototype.establishConnection=function(e){var t=this;try{!this.onceOpen&&this.checkConnectTimeoutTimer(),this.xmlHttpRequest=new XMLHttpRequest,this.position=0,this.xmlHttpRequest.onreadystatechange=function(){t.xmlHttpRequest.readyState===XMLHttpRequest.LOADING?(t.clearConnectTimoutTimer(!0),t.chunkParse(t.xmlHttpRequest.responseText)):t.xmlHttpRequest.readyState===XMLHttpRequest.DONE&&(t.clearConnectTimoutTimer(!0),t.closeConnection())},this.xmlHttpRequest.open("get",e),this.xmlHttpRequest.setRequestHeader("content-type","application/json"),this.xmlHttpRequest.send(),this.xmlHttpRequest.onerror=function(){o.ConnectionLog.info("bind/get onerror"),t.dependency.receive()}}catch(e){o.ConnectionLog.error("ReceiverClient XMLHttpRequest Error, error.message:"+(null==e?void 0:e.message)+",error.stack:"+(null==e?void 0:e.stack)),this.dependency.receive()}},e.prototype.abortConnection=function(){var e;null===(e=this.xmlHttpRequest)||void 0===e||e.abort()},e.prototype.chunkParse=function(e){for(var t=this.position,n=e.indexOf(r.DELIMITER,t);n>-1;){var o=e.substring(t,n);if(o&&(this.dependency.handleResponse(o),o.indexOf("connection closed")>-1))return void(this.position=0);t=n+r.DELIMITER.length,n=e.indexOf(r.DELIMITER,t)}this.position=t},e.prototype.closeConnection=function(){this.xmlHttpRequest.status!==XMLHttpRequest.UNSENT&&(this.xmlHttpRequest.status<200||this.xmlHttpRequest.status>=400?(o.ConnectionLog.info("closeConnection: "+this.xmlHttpRequest),this.dependency.receive()):this.chunkParse(this.xmlHttpRequest.responseText))},e.prototype.checkConnectTimeoutTimer=function(){var e=this;this.clearConnectTimoutTimer(!1),this.connectTimeoutTimer=setTimeout((function(){o.ConnectionLog.error("bind/get 12s 仍未收到回包"),e.dependency.disconnect({errCode:i.RoomErrorCode.BIG_COLLAB_CONNECT_TIMEOUT,shutDown:!0})}),12e3)},e.prototype.clearConnectTimoutTimer=function(e){e&&!this.onceOpen&&(this.onceOpen=!0),this.connectTimeoutTimer&&(window.clearTimeout(this.connectTimeoutTimer),this.connectTimeoutTimer=void 0)},e}();t.ReceiverClient=s},"0b588a7d4e":function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i}));var o=n("a282565e4f");class r{constructor(e,t){this.instance=e,this.descriptor=t}}class i extends Error{constructor(e){super(o.q),this.message=e.toString()}}},"0bbff1c330":function(e,t,n){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.DOCUMENT_TYPE=void 0,function(e){e.DOC="doc",e.SHEET="sheet",e.FORM="form",e.SLIDE="slide",e.SMARTSHEET="smartSheet",e.SMARTCANVAS="smartCanvas",e.FLOWCHART="flowchart",e.MIND="mind",e.PDF="pdf"}(o||(o={})),t.DOCUMENT_TYPE=o},"0d2ffd3bdb":function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"DependentServiceCombinder",(function(){return St})),n.d(t,"EventTarget",(function(){return lt})),n.d(t,"EventType",(function(){return pt})),n.d(t,"ExtensionConfigManager",(function(){return At})),n.d(t,"ExtensionEvent",(function(){return bt})),n.d(t,"ExtensionManager",(function(){return dt})),n.d(t,"ExtensionService",(function(){return kt})),n.d(t,"FCModule",(function(){return zt})),n.d(t,"IDependentServiceCombinder",(function(){return Ot})),n.d(t,"IExtensionConfigManager",(function(){return Tt})),n.d(t,"IExtensionEvent",(function(){return Ct})),n.d(t,"IExtensionManager",(function(){return ht})),n.d(t,"IExtensionService",(function(){return Nt})),n.d(t,"LoadType",(function(){return xe})),n.d(t,"ScriptLoaderAdapter",(function(){return Yt})),n.d(t,"createExtensionService",(function(){return Kt})),n.d(t,"initInstantiationService",(function(){return Vt})),n.d(t,"injectExtensionServiceToCollection",(function(){return Ht})),n.d(t,"patchScriptLoader",(function(){return Jt})),n.d(t,"registerExtensionService",(function(){return Gt}));n("d66c2b8c37"),n("47ca619755"),n("4f9dd793db");var o=n("9132715560"),r=n.n(o),i=n("6a364eb35c"),s=n.n(i),a=(n("b1e2246d82"),n("b8217400dc"),n("e6f68cdf2e"),n("3bf1976a4f"),n("fdb955876a"),n("c6244f7705"),n("8ee19818c4"),n("e8b2c0f5e8"),n("bd80bf2d0f"),n("3ef2352f0b")),c=n.n(a),u=n("d7c625d1f2"),d=(n("56683198d5"),n("73b854064b"),n("bd29e2df90")),l=n.n(d),p=n("ab5eb40518"),h=n.n(p),f=n("1b4cdd6a36"),v=n.n(f),g=n("0112351fbe"),m=n.n(g),E=(n("4a871f4295"),n("0cf3719522")),y=n.n(E),_=(n("081c8cafea"),n("3dc8f33382"),n("550d5dfc66")),b=n("4f04e6c8a0"),C=n("d5bac86374"),R=n("d63229afdc"),S=n("a73d724fe4"),O=(n("9617b3921c"),n("580f342750"),n("0368aca230")),T=(n("de37db1287"),n("8e7cce0ada"),n("85d48ef22b"),n("2a6f332b5e"),n("a84962d637"),n("f45588a8ad"),n("29f8c5f672"),n("1bab7b5fb7"),n("34cd92f77a"),n("c9a7ecac4d"),n("85d0a7609b")),k=n.n(T),I=(n("8fa580e5fd"),n("963f2eaace"),n("cb4ea8a0c0")),w=n("b7cba4397b"),M=(n("fce3077cdf"),n("229fddc286"),n("c78a4443e5")),D=n("536530eec5"),A=n("3c9d61c2e2"),N=n("2e1bb889e5"),L=n("b8775a3aa8"),x=n("1c3848e586"),P=n("804db59c17"),U=n("077be6c856"),j=n("2c8ead4d96"),B=n("488b683127"),F=n("ad36c1a004"),W=n("875795a3a0"),K=n("00b54de57b"),G=n("a7f251464e"),H=n("7785f226c3"),V=n("a4d5c68b5c"),q=n("fc82775981"),Q=n("3bf31b711a"),Y=n("1bf5e44e9b"),X=n("03808c4177"),J=n("b40f27bf29"),z=n("d6ca30ad13"),$=n("99d670dcab"),Z=n("e80cda9f13"),ee=n("7f96884de1"),te=n("192278b140"),ne=n("64973f262b"),oe=n("6c5644ca25"),re=n("8216980c74"),ie=n("4c53fae0e6"),se=n("6daf052090"),ae=n("e0b256019d"),ce=n("424dfc5646"),ue=n("523f223693"),de=n("de6faa8732"),le=n("67b3031e50"),pe=n("33b33312c5"),he=n("430ba8ff3a"),fe=n("31996f4bca"),ve=n("2223a5a8ca"),ge=n("f3360fb665"),me=n("b512c0eccb"),Ee=n("14502724a6"),ye=n.n(Ee),_e=(n("7b8243a880"),n("433247001a"),n("2dea9e08f0"),n("5cd40edab3"),n("759492dad9"),n("570b26a0fa")),be=n("5fc26b30d4"),Ce=n.n(be),Re=(n("75563bc376"),n("0acdc5834b"),n("af802ec74b"),n("6e20b6a7d8"),n("8eec1e4a03")),Se=n.n(Re);n("6c6f26abf4");if("performance"in window||(window.performance={}),Date.now=Date.now||function(){return Date.now()},!("now"in window.performance)){var Oe=Date.now();performance.timing&&performance.timing.navigationStart&&(Oe=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-Oe}}function Te(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=v()(e);if(t){var r=v()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return h()(this,n)}}var ke=function(e){l()(n,e);var t=Te(n);function n(e){r()(this,n);var o="(Extension Error) ".concat(e);return t.call(this,o)}return s()(n)}(m()(Error)),Ie="ark_extension_function_cost",we="ark_extension_function_error",Me="ark_extension_load_cost",De="ark_extension_load_fail",Ae=function(){function e(){r()(this,e)}return s()(e,null,[{key:"loadCost",value:function(e){var t=new CustomEvent(Me,{detail:e});window.dispatchEvent(t)}},{key:"functionCallCost",value:function(e){var t=new CustomEvent(Ie,{detail:e});window.dispatchEvent(t)}},{key:"functionCallError",value:function(e){var t=new CustomEvent(we,{detail:e});window.dispatchEvent(t)}},{key:"loadFail",value:function(e){var t=new CustomEvent(De,{detail:e});window.dispatchEvent(t)}}]),e}();function Ne(e,t,n){return"object"!==y()(e)?e:new Proxy(e,{get:function(e,o){var r=e[o];return r instanceof Function?function(){for(var e=performance.now(),i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];var c=r.call.apply(r,[this].concat(s));return c instanceof Promise&&(c.finally((function(){var r=performance.now()-e;Ae.functionCallCost({module:t,function:o,cost:r,url:n,start:e})})),c.catch((function(r){var i=performance.now()-e;Ae.functionCallError({module:t,function:o,cost:i,url:n,error:r,start:e})}))),c}:r}})}var Le,xe,Pe,Ue=Object(b.a)("IMetadataLoader"),je=function(){function e(t){this.element=t,this.next=e.Undefined,this.prev=e.Undefined}return e.Undefined=new e(void 0),e}(),Be=function(){function e(){this.first=je.Undefined,this.last=je.Undefined,this.mSize=0}return Object.defineProperty(e.prototype,"size",{get:function(){return this.mSize},enumerable:!1,configurable:!0}),e.prototype.isEmpty=function(){return this.first===je.Undefined},e.prototype.clear=function(){this.first=je.Undefined,this.last=je.Undefined,this.mSize=0},e.prototype.unshift=function(e){return this.insert(e,!1)},e.prototype.push=function(e){return this.insert(e,!0)},e.prototype.shift=function(){if(this.first!==je.Undefined){var e=this.first.element;return this.remove(this.first),e}},e.prototype.pop=function(){if(this.last!==je.Undefined){var e=this.last.element;return this.remove(this.last),e}},e.prototype[Symbol.iterator]=function(){var e;return Object(u.__generator)(this,(function(t){switch(t.label){case 0:e=this.first,t.label=1;case 1:return e===je.Undefined?[3,3]:[4,e.element];case 2:return t.sent(),e=e.next,[3,1];case 3:return[2]}}))},e.prototype.insert=function(e,t){var n=this,o=new je(e);if(this.first===je.Undefined)this.first=o,this.last=o;else if(t){var r=this.last;this.last=o,o.prev=r,r.next=o}else{var i=this.first;this.first=o,o.next=i,i.prev=o}this.mSize+=1;var s=!1;return function(){s||(s=!0,n.remove(o))}},e.prototype.remove=function(e){if(e.prev!==je.Undefined&&e.next!==je.Undefined){var t=e.prev;t.next=e.next,e.next.prev=t,e.next=je.Undefined,e.prev=je.Undefined}else e.prev===je.Undefined&&e.next===je.Undefined?(this.first=je.Undefined,this.last=je.Undefined):e.next===je.Undefined?(this.last=this.last.prev,this.last.next=je.Undefined,e.prev=je.Undefined):e.prev===je.Undefined&&(this.first=this.first.next,this.first.prev=je.Undefined,e.next=je.Undefined);this.mSize-=1},e}(),Fe=function(){function e(e){this.disposed=!1,this.options=e}return Object.defineProperty(e.prototype,"event",{get:function(){var e=this;return this.mEvent||(this.mEvent=function(t,n,o){var r,i,s;e.listeners||(e.listeners=new Be);var a=e.listeners.isEmpty();a&&(null===(r=e.options)||void 0===r?void 0:r.onFirstListenerAdd)&&e.options.onFirstListenerAdd(e);var c=e.listeners.push(n?[t,n]:t);a&&(null===(i=e.options)||void 0===i?void 0:i.onFirstListenerDidAdd)&&e.options.onFirstListenerDidAdd(e),(null===(s=e.options)||void 0===s?void 0:s.onListenerDidAdd)&&e.options.onListenerDidAdd(e,t,n);var u={dispose:function(){var t;e.disposed||(c(),(null===(t=e.options)||void 0===t?void 0:t.onLastListenerRemove)&&(e.listeners&&!e.listeners.isEmpty()||e.options.onLastListenerRemove(e)));Object(O.markTracked)(u)},disposableId:"event"};return Array.isArray(o)&&o.push(u),Object(O.trackDisposable)(u),u}),this.mEvent},enumerable:!1,configurable:!0}),e.prototype.fire=function(e){var t,n;if(this.listeners){this.deliveryQueue||(this.deliveryQueue=new Be);try{for(var o=Object(u.__values)(this.listeners),r=o.next();!r.done;r=o.next()){var i=r.value;this.deliveryQueue.push([i,e])}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}for(;this.deliveryQueue.size>0;){var s=Object(u.__read)(this.deliveryQueue.shift(),2),a=(i=s[0],s[1]);try{"function"==typeof i?i.call(void 0,a):i[0].call(i[1],a)}catch(e){console.error(e)}}}},e.prototype.dispose=function(){this.listeners&&this.listeners.clear(),this.deliveryQueue&&this.deliveryQueue.clear(),this.disposed=!0},e}();!function(e){e.LOADING="LOADING",e.LOADED="LOADED",e.ERROR="ERROR"}(Le||(Le={})),function(e){e[e.IDLE=1]="IDLE",e[e.ON_DEMAND=3]="ON_DEMAND",e[e.EAGER=7]="EAGER"}(xe||(xe={})),function(e){e.WAITING="waiting",e.LOADING="loading",e.ERROR="error",e.SUCCESS="success"}(Pe||(Pe={}));var We=function(){function t(){r()(this,t),this.loadCache=new Map,this.retryCountMap=new Map}return s()(t,[{key:"loadScript",value:function(e,t,n,o){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function r(){var i;return c.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=this.loadCache.get(t)){r.next=7;break}return this.setRetryCount(e,n),r.next=5,this.defferedLoadModule(e,t,o);case 5:i=r.sent,this.loadCache.set(t,i);case 7:return r.abrupt("return",i);case 8:case"end":return r.stop()}}),r,this)})))}},{key:"setRetryCount",value:function(e,t){this.retryCountMap.set(e,t)}},{key:"defferedLoadModule",value:function(e,t,n){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function o(){var r=this;return c.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",new Promise((function(o,i){var s={entryName:e,scriptUrl:t,isCss:n,curRetryCount:1,succCallback:o,failedCallback:i};r.loadInBrowser(s)})));case 1:case"end":return o.stop()}}),o)})))}},{key:"loadInBrowser",value:function(t){var n=this,o=t.entryName,r=t.scriptUrl,i=t.isCss,s=t.curRetryCount,a=t.succCallback,c=t.failedCallback,u=performance.now(),d=(i?this.buildLinkTag:this.buildScriptTag)(r,(function(){var t=performance.now()-u;Ae.loadCost({module:o,url:r,cost:t,start:u});var n=e[o];(null==n?void 0:n.default)?a(n.default):a(null!=n?n:{})}),(function(){var e=n.retryCountMap.get(o)||0,t=performance.now()-u;if(Ae.loadFail({module:o,url:r,info:"retryCount:".concat(e),cost:t,start:u}),s>e)c("failed to load module [".concat(o,"] after [").concat(s-1,"] retry times."));else{d.parentElement&&document.head.removeChild(d);var l={entryName:o,scriptUrl:r,isCss:i,curRetryCount:s+1,succCallback:a,failedCallback:c};n.loadInBrowser(l)}}));document.head.appendChild(d)}},{key:"buildLinkTag",value:function(e,t,n){var o=document.createElement("link");return o.rel="stylesheet",o.href=e,o.onload=t,o.onerror=n,o}},{key:"buildScriptTag",value:function(e,t,n){var o=document.createElement("script");o.type="text/javascript",o.src=e,o.async=!1;var r=window.location.protocol;return"http:"!==r&&"https:"!==r||(o.crossOrigin="anonymous"),o.onload=t,o.onerror=n,o}}]),t}(),Ke=new We,Ge=function(){function e(t,n,o){var i,s;r()(this,e),this.hookEmitter=new Fe,this.loadState=Pe.WAITING,this.entryName=t,this.resourceUrl=n,this.options=o,this.retryTimes=null!==(i=null==o?void 0:o.retryTimes)&&void 0!==i?i:e.defaultRetryTimes,this.isCss=null!==(s=null==o?void 0:o.isCss)&&void 0!==s&&s,this.setupHooks()}return s()(e,[{key:"loadModule",value:function(){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function t(){var n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loadState=Pe.LOADING,this.hookEmitter.fire(Le.LOADING),t.prev=2,t.next=5,e.scriptLoader.loadScript(this.entryName,this.resourceUrl,this.retryTimes,this.isCss);case 5:return n=t.sent,this.loadState=Pe.SUCCESS,this.hookEmitter.fire(Le.LOADED),t.abrupt("return",n);case 11:throw t.prev=11,t.t0=t.catch(2),this.loadState=Pe.ERROR,this.hookEmitter.fire(Le.ERROR),t.t0;case 16:case"end":return t.stop()}}),t,this,[[2,11]])})))}},{key:"setupHooks",value:function(){var e=this;this.hookEmitter.event((function(t){var n,o,r=null===(o=null===(n=e.options)||void 0===n?void 0:n.hooks)||void 0===o?void 0:o[t];r&&r()}))}}]),e}();function He(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=v()(e);if(t){var r=v()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return h()(this,n)}}Ge.defaultRetryTimes=2,Ge.scriptLoader=Ke;var Ve=function(e){l()(n,e);var t=He(n);function n(e,o,i){var s;return r()(this,n),(s=t.call(this,e,o,i)).deferredModule=s.loadModule(),s}return s()(n,[{key:"getModule",value:function(){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.deferredModule);case 1:case"end":return e.stop()}}),e,this)})))}}]),n}(Ge),qe=function(){function e(t){r()(this,e),this.url=t}return s()(e,[{key:"bootstrap",value:function(){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loader=new Ve(this.url,this.url),e.next=3,this.loader.getModule();case 3:case"end":return e.stop()}}),e,this)})))}}]),e}(),Qe=function(){function e(t,n){r()(this,e),this.name=t,this.cdnPrefix=n}return s()(e,[{key:"bootstrap",value:function(){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function t(){var n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n="".concat(this.cdnPrefix.replace(/\/*$/,"/")).concat(this.name),e.loadRecords.has(n)){t.next=6;break}return this.loader=new Ve(this.name,n,{isCss:!0}),t.next=5,this.loader.getModule();case 5:e.loadRecords.add(n);case 6:case"end":return t.stop()}}),t,this)})))}}]),e}();Qe.loadRecords=new Set;var Ye=function(){function e(){var t=this;r()(this,e),this.isInnerOpen=!1,this.innerPromise=new Promise((function(e){t.completePromise=e}))}return s()(e,[{key:"isOpen",value:function(){return this.isInnerOpen}},{key:"open",value:function(){this.isInnerOpen=!0,this.completePromise(!0)}},{key:"wait",value:function(){return this.innerPromise}}]),e}();function Xe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=v()(e);if(t){var r=v()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return h()(this,n)}}var Je=function(e){l()(n,e);var t=Xe(n);function n(e,o,i){var s;return r()(this,n),(s=t.call(this,e,o,i)).schedulerHandler=I.scheduler,s.scheduleCallbackTask=s.loadWhenIdle(),s}return s()(n,[{key:"getModule",value:function(){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.loadState!==Pe.WAITING&&this.loadState!==Pe.ERROR){e.next=4;break}return this.schedulerHandler.cancelTask(this.scheduleCallbackTask),this.deferredModule=this.loadModule(),e.abrupt("return",this.deferredModule);case 4:return e.abrupt("return",this.deferredModule);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"loadWhenIdle",value:function(){var e=this;return this.schedulerHandler.scheduleTask((function(){e.deferredModule=e.loadModule()}))}}]),n}(Ge);function ze(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=v()(e);if(t){var r=v()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return h()(this,n)}}var $e,Ze=function(e){l()(n,e);var t=ze(n);function n(){return r()(this,n),t.apply(this,arguments)}return s()(n,[{key:"getModule",value:function(){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.deferredModule=this.loadModule(),e.abrupt("return",this.deferredModule);case 2:case"end":return e.stop()}}),e,this)})))}}]),n}(Ge),et=($e={},k()($e,xe.ON_DEMAND,Ze),k()($e,xe.IDLE,Je),k()($e,xe.EAGER,Ve),$e),tt=function(){function e(t,n,o,i){r()(this,e),this.name=t,this.url=n,this.surpportLanguages=o,this.language=i,this.loadTypeMap=new Map}return s()(e,[{key:"bootstrap",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=null!==(e=this.loadTypeMap.get(t))&&void 0!==e?e:xe.IDLE;this.loader=this.createLoader(n)}},{key:"addLoadType",value:function(e,t){this.loadTypeMap.set(null!=e?e:"",t)}},{key:"getInstance",value:function(){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.loader||this.bootstrap(),this.loader.loadState!==Pe.ERROR){e.next=3;break}throw new ke("load extension [".concat(this.name,"] error."));case 3:return e.next=5,this.waitSingletonInstance();case 5:return e.abrupt("return",this.instance);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"waitSingletonInstance",value:function(){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.instance){e.next=2;break}return e.abrupt("return");case 2:if(!this.barrier){e.next=7;break}return e.next=5,this.barrier.wait();case 5:e.next=17;break;case 7:return this.barrier=new Ye,e.next=10,this.loader.getModule();case 10:if("function"==typeof(t=e.sent)){e.next=14;break}throw Ae.loadFail({cost:-1,module:this.name,url:this.url,info:"constructor type: ".concat(y()(t))}),new ke("something went wrong in ".concat(this.name,"'s constructor."));case 14:this.instance=Ne(new t,this.name,this.url),this.instance.bootstraped=!1,this.barrier.open();case 17:case"end":return e.stop()}}),e,this)})))}},{key:"dealUrlForMultLanguage",value:function(e){var t,n=Array.isArray(e)?null==e?void 0:e[0]:e,o=null==n?void 0:n.lastIndexOf(".js");return-1===o||(null===(t=this.surpportLanguages)||void 0===t?void 0:t.includes(this.language))&&(n="".concat(n.slice(0,o),".").concat(this.language,".js")),n}},{key:"createLoader",value:function(e){return new(0,et[e])(this.name,this.dealUrlForMultLanguage(this.url))}}]),e}(),nt=function(){function e(){r()(this,e)}return s()(e,[{key:"bootstrap",value:function(){throw new ke("genesis dependency node should not be called")}}]),e}();nt.nodeName="GENESIS_DEPENDENCY_NODE";var ot=w.a.getConfig('npm["@tencent/ark-extensions"]'),rt=(null==ot?void 0:ot.React)||"//docs.idqqimg.com/tim/docs/components/libs/react-common-16.13.1-2bf240.js",it=(null==ot?void 0:ot.ReactDOM)||"//docs.idqqimg.com/tim/docs/components/libs/react-common-16.13.1-2bf240.js",st=(null==ot?void 0:ot.DEFAULT_COMPONENT_CDN_PREFIX)||"//docs.gtimg.com/docs_components",at={React:rt,ReactDOM:it},ct=function(){function e(t){r()(this,e),this.name=t}return s()(e,[{key:"bootstrap",value:function(){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=at[this.name]){e.next=3;break}throw new ke("common lib [".concat(this.name,"] is illegal because it's not in white list."));case 3:if(void 0!==window[this.name]){e.next=7;break}return this.loader=new Ve(this.name,t),e.next=7,this.loader.getModule();case 7:case"end":return e.stop()}}),e,this)})))}}]),e}(),ut=function(){function e(t,n){r()(this,e),this.name=t,this.cdnPrefix=n}return s()(e,[{key:"bootstrap",value:function(){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function t(){var n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n="".concat(this.cdnPrefix.replace(/\/*$/,"/")).concat(this.name),e.loadRecords.has(n)){t.next=6;break}return this.loader=new Ve(this.name,n),t.next=5,this.loader.getModule();case 5:e.loadRecords.add(n);case 6:case"end":return t.stop()}}),t,this)})))}}]),e}();ut.loadRecords=new Set;var dt=function(){function e(t){r()(this,e),this.metadataLoader=t,this.createDepGraph()}return s()(e,[{key:"addExtensionConfig",value:function(e){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.metadataRecord){t.next=4;break}return t.next=3,this.metadataLoader.getMetadataRecord();case 3:this.metadataRecord=t.sent;case 4:this.language=this.metadataLoader.getLanguage(),this.addDepNodeByConfig(e);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"addExtensionDescription",value:function(e){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function t(){var n,o,r;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.metadataRecord){t.next=4;break}return t.next=3,this.metadataLoader.getMetadataRecord();case 3:this.metadataRecord=t.sent;case 4:return n=e.name,o=e.loadType,(r=this.addExtensionDependencyNode(n,o)).bootstrap(),t.abrupt("return",r);case 8:case"end":return t.stop()}}),t,this)})))}},{key:"getInstance",value:function(e){return Object(u.__awaiter)(this,arguments,void 0,(function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.nodeName;return c.a.mark((function o(){var r,i,s,a,d,l,p,h,f,v,g,m;return c.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(t.depGraph.directDependantsOf(e).includes(n)){o.next=4;break}throw Ae.loadFail({module:e,url:"",cost:-1,info:"cannot find in metadata"}),new ke("Cannot get ".concat(e," extension in ").concat(n,", please add configuration !"));case 4:d=t.depGraph.getNodeData(e),l=t.depGraph.directDependenciesOf(e),o.prev=6,p=!0,h=Object(u.__asyncValues)(l);case 8:return o.next=10,h.next();case 10:if(f=o.sent,r=f.done){o.next=22;break}return a=f.value,p=!1,v=a,g=t.depGraph.getNodeData(v),o.next=19,g.bootstrap(e);case 19:p=!0,o.next=8;break;case 22:o.next=27;break;case 24:o.prev=24,o.t0=o.catch(6),i={error:o.t0};case 27:if(o.prev=27,o.prev=28,p||r||!(s=h.return)){o.next=32;break}return o.next=32,s.call(h);case 32:if(o.prev=32,!i){o.next=35;break}throw i.error;case 35:return o.finish(32);case 36:return o.finish(27);case 37:return o.next=39,d.getInstance();case 39:return m=o.sent,o.abrupt("return",m);case 41:case"end":return o.stop()}}),o,null,[[6,24,27,37],[28,,32,36]])}))()}))}},{key:"getDepGraph",value:function(){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.depGraph);case 1:case"end":return e.stop()}}),e,this)})))}},{key:"createDepGraph",value:function(){this.depGraph=new _.DepGraph;var e=new nt;this.depGraph.addNode(nt.nodeName,e)}},{key:"addDepNodeByConfig",value:function(e){var t=this;e.forEach((function(e){var n=e.name,o=e.loadType;try{var r=t.addExtensionDependencyNode(n,o);t.depGraph.addDependency(nt.nodeName,r.name)}catch(e){console.error(e)}}))}},{key:"addLibraryDependencyNode",value:function(e){var t=new ct(e);this.depGraph.addNode(e,t)}},{key:"addModulesDependencyNode",value:function(e,t){var n=new ut(e,t);this.depGraph.addNode(e,n)}},{key:"addCSSDependencyNode",value:function(e,t){var n=new Qe(e,t);this.depGraph.addNode(e,n)}},{key:"addChunkDependencyNode",value:function(e){var t=new qe(e);this.depGraph.addNode(e,t)}},{key:"addExtensionDependencyNode",value:function(e,t,n){var o=this;if(this.depGraph.hasNode(e)){var r=this.depGraph.getNodeData(e);return r.addLoadType(n,t),r}var i=this.metadataRecord[e];if(!i)throw new ke("Cannot find ".concat(e," extension in metadata!"));var s=i.url,a=i.chunks,c=void 0===a?[]:a,u=i.dependencies,d=void 0===u?{}:u,l=i.surpportLanguages,p=void 0===l?[]:l,h=d.commonModules,f=void 0===h?[]:h,v=d.commonLibs,g=void 0===v?[]:v,m=d.extensions,E=void 0===m?[]:m,y=d.css,_=void 0===y?[]:y,b=new tt(e,s,p,this.language);return b.addLoadType(n,t),this.depGraph.addNode(e,b),c.forEach((function(t){o.addChunkDependencyNode(t),o.depGraph.addDependency(e,t)})),g.forEach((function(t){o.addLibraryDependencyNode(t),o.depGraph.addDependency(e,t)})),f.forEach((function(t){o.addModulesDependencyNode(t,o.metadataLoader.COMPONENT_CDN_PREFIX),o.depGraph.addDependency(e,t)})),_.forEach((function(t){o.addCSSDependencyNode(t,o.metadataLoader.COMPONENT_CDN_PREFIX),o.depGraph.addDependency(e,t)})),E.forEach((function(t){var n;try{var r=null!==(n=xe[t.loadType.toString()])&&void 0!==n?n:xe.ON_DEMAND;o.addExtensionDependencyNode(t.name,r,e),o.depGraph.addDependency(e,t.name)}catch(e){console.error(e)}})),b}}]),e}();dt=Object(u.__decorate)([Object(u.__param)(0,Ue),Object(u.__metadata)("design:paramtypes",[Object])],dt);var lt,pt,ht=Object(b.a)("IExtensionManager");!function(e){e[e.WINDOW=0]="WINDOW",e[e.DOCUMENT=1]="DOCUMENT",e[e.DOCUMENT_BODY=2]="DOCUMENT_BODY"}(lt||(lt={})),function(e){e.RESIZE="resize",e.MOUSE_DOWN="mousedown",e.MOUSE_MOVE="mousemove",e.MOUSE_UP="mouseup",e.KEY_UP="keyup",e.KEY_DOWN="keydown",e.CLICK="click",e.TOUCH_START="touchstart",e.TOUCH_MOVE="touchmove",e.TOUCH_END="touchend",e.POP_STATE="popState",e.VISIBILITY_CHANGE="visibilitychange",e.ONLINE="online",e.OFFLINE="offline",e.MESSAGE="message",e.CUSTOM="custom"}(pt||(pt={}));var ft=function(){function e(){r()(this,e),this.eventListenerSet=new Set,this.customEventListenerMap=new Map}return s()(e,[{key:"listen",value:function(e){var t=e.type;switch(t){case pt.RESIZE:case pt.MOUSE_DOWN:case pt.MOUSE_MOVE:case pt.MOUSE_UP:case pt.KEY_UP:case pt.KEY_DOWN:case pt.CLICK:case pt.TOUCH_START:case pt.TOUCH_MOVE:case pt.TOUCH_END:case pt.POP_STATE:case pt.VISIBILITY_CHANGE:case pt.ONLINE:case pt.OFFLINE:case pt.MESSAGE:return this.bindEvent(e);case pt.CUSTOM:return this.bindCustomEvent(e);default:throw new ke("[".concat(t,"] event is not supported to use in extensions."))}}},{key:"listenCustomEvent",value:function(e){return this.bindCustomEvent(e),{name:e.name,fire:this.dispatchCustomEvent.bind(this,e.name)}}},{key:"dispatchCustomEvent",value:function(e,t){var n=new CustomEvent(e,{detail:t});this.node.dispatchEvent(n)}},{key:"remove",value:function(e){if(!this.eventListenerSet.has(e))throw new ke("unable to remove [".concat(e.type,"] event which is not in your namespace or not bound."));var t=e.name,n=e.type,o=e.fn,r=e.options;if(n===pt.CUSTOM)return this.node.removeEventListener(t,o,r),void this.customEventListenerMap.delete(t);this.node.removeEventListener(n,o,r),this.eventListenerSet.delete(e)}},{key:"removeAll",value:function(){var e=this;this.eventListenerSet.forEach((function(t){e.remove(t)})),this.customEventListenerMap.forEach((function(t){e.remove(t)}))}},{key:"bindEvent",value:function(e){if(this.eventListenerSet.has(e))throw new ke("duplicated [".concat(e.type,"] event."));var t=e.type,n=e.fn,o=e.options;this.node.addEventListener(t,n,o),this.eventListenerSet.add(e)}},{key:"bindCustomEvent",value:function(e){var t=e.name;if(this.customEventListenerMap.has(t))throw new ke("duplicated [".concat(t,"] event."));var n=t,o=e.fn,r=e.options;this.node.addEventListener(n,o,r),this.customEventListenerMap.set(t,e)}}]),e}();function vt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=v()(e);if(t){var r=v()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return h()(this,n)}}var gt=function(e){l()(n,e);var t=vt(n);function n(){var e;return r()(this,n),(e=t.apply(this,arguments)).node=document.body,e}return s()(n)}(ft);function mt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=v()(e);if(t){var r=v()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return h()(this,n)}}var Et=function(e){l()(n,e);var t=mt(n);function n(){var e;return r()(this,n),(e=t.apply(this,arguments)).node=document,e}return s()(n)}(ft);function yt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=v()(e);if(t){var r=v()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return h()(this,n)}}var _t=function(e){l()(n,e);var t=yt(n);function n(){var e;return r()(this,n),(e=t.apply(this,arguments)).node=window,e}return s()(n)}(ft),bt=function(){function e(){r()(this,e),this.initEventManagerPool()}return s()(e,[{key:"addListener",value:function(e){var t=e.target;return this.eventManagerPool[t].listen(e)}},{key:"removeListener",value:function(e){var t=e.target;return this.eventManagerPool[t].remove(e)}},{key:"removeAllListener",value:function(){Object.values(this.eventManagerPool).forEach((function(e){e.removeAll()}))}},{key:"initEventManagerPool",value:function(){var e,t=new _t,n=new Et,o=new gt;this.eventManagerPool=(e={},k()(e,lt.WINDOW,t),k()(e,lt.DOCUMENT,n),k()(e,lt.DOCUMENT_BODY,o),e)}}]),e}(),Ct=Object(b.a)("IExtensionEvent"),Rt=Object(b.a)("IExtensionContainerService"),St=function(){function e(t,n,o,i,s,a,c,u,d,l,p,h,f,v,g,m,E,y,_,b,C,R){r()(this,e),this.docMetaDomain=t,this.userInfoDomain=n,this.authDomain=o,this.fileDomain=i,this.likeDomain=s,this.folderDomain=a,this.templateDomain=c,this.accountDomain=u,this.loginDomain=d,this.notificationDomain=l,this.shareDomain=p,this.messageDomain=h,this.collaborateDomain=f,this.notifyScopeDomain=v,this.atMessageDomain=g,this.fileInfoDomain=m,this.connectionControllerService=E,this.accountApplication=y,this.enterpriseAccountApplication=_,this.docsManagementService=b,this.extensionEvent=C,this.extensionContainerService=R}return s()(e,[{key:"getExtensionService",value:function(e,t){return{getExtension:function(n){return e.safeGetExtension.call(e,n,t)},fireExtensionEvent:e.fireExtensionEvent.bind(e,t)}}},{key:"getDomainService",value:function(){return{docMetaDomain:this.docMetaDomain,userInfoDomain:this.userInfoDomain,authDomain:this.authDomain,fileDomain:this.fileDomain,likeDomain:this.likeDomain,folderDomain:this.folderDomain,templateDomain:this.templateDomain,accountDomain:this.accountDomain,loginDomain:this.loginDomain,notificationDomain:this.notificationDomain,shareDomain:this.shareDomain,messageDomain:this.messageDomain,collaborateDomain:this.collaborateDomain,notifyScopeDomain:this.notifyScopeDomain,atMessageDomain:this.atMessageDomain,fileInfoDomain:this.fileInfoDomain}}},{key:"getApplicationService",value:function(){return{accountApplication:this.accountApplication,enterpriseAccountApplication:this.enterpriseAccountApplication,connectionControllerService:this.connectionControllerService,docsManagementService:this.docsManagementService}}},{key:"getToolService",value:function(){return{networkRequest:me.networkRequest,event:this.extensionEvent}}},{key:"getExtensionContainerService",value:function(e){return{createContainerIfUnspecified:this.extensionContainerService.createContainerIfUnspecified.bind(this.extensionContainerService,e),createSandboxContainerIfUnspecified:this.extensionContainerService.createSandboxContainerIfUnspecified.bind(this.extensionContainerService,e)}}}]),e}();St=Object(u.__decorate)([Object(u.__param)(0,D.a),Object(u.__param)(1,A.a),Object(u.__param)(2,N.a),Object(u.__param)(3,L.a),Object(u.__param)(4,x.a),Object(u.__param)(5,P.a),Object(u.__param)(6,U.a),Object(u.__param)(7,j.a),Object(u.__param)(8,B.a),Object(u.__param)(9,F.a),Object(u.__param)(10,W.a),Object(u.__param)(11,K.a),Object(u.__param)(12,G.a),Object(u.__param)(13,H.a),Object(u.__param)(14,V.a),Object(u.__param)(15,q.a),Object(u.__param)(16,M.f),Object(u.__param)(17,M.e),Object(u.__param)(18,M.h),Object(u.__param)(19,M.g),Object(u.__param)(20,Ct),Object(u.__param)(21,Rt),Object(u.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object])],St);var Ot=Object(b.a)("IDependentServiceCombinder"),Tt=Object(b.a)("IExtensionConfigManager"),kt=function(){function e(t,n,o,i){r()(this,e),this.dependentServiceCombinder=t,this.extensionConfigManager=n,this.extensionManager=o,this.domainUpdater=i,this.extensionEventEmitter=new Fe}return s()(e,[{key:"updateDomainWithClientVars",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.domainUpdater.updateDomainWithClientVars(e,t)}},{key:"updateDomainWithRequests",value:function(e,t){this.domainUpdater.updateDomainWithRequests({docId:e,u:t})}},{key:"scanAndHandleExtensions",value:function(e){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.addExtensionConfig(e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"addExtensionConfig",value:function(e){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.extensionConfigReadyBarrier){t.next=5;break}return t.next=3,this.extensionConfigReadyBarrier.wait();case 3:t.next=6;break;case 5:this.extensionConfigReadyBarrier=new Ye;case 6:return t.next=8,this.extensionConfigManager.addExtensionConfig(e);case 8:this.extensionConfigReadyBarrier.open();case 9:case"end":return t.stop()}}),t,this)})))}},{key:"addExtensionDescription",value:function(e){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.extensionConfigManager.addExtensionDescription(e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"subscribeExtensionEvent",value:function(e){this.extensionEventEmitter.event((function(t){e(t.extensionName,t.type)}))}},{key:"fireExtensionEvent",value:function(e,t){var n={extensionName:e,type:t};this.extensionEventEmitter.fire(n)}},{key:"getExtension",value:function(e){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.safeGetExtension(e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"dispose",value:function(){throw new Error("Method not implemented.")}},{key:"disposeAllExtensions",value:function(){throw new Error("Method not implemented.")}},{key:"getExtensionConfig",value:function(){return this.extensionConfigManager.getExtensionConfig()}},{key:"getExtensionDepGraph",value:function(){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.extensionManager.getDepGraph());case 1:case"end":return e.stop()}}),e,this)})))}},{key:"safeGetExtension",value:function(e,t){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function n(){var o;return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.extensionConfigReadyBarrier.wait();case 2:return n.next=4,this.extensionManager.getInstance(e,t);case 4:return o=n.sent,this.bootstrapExtension(e,o),n.abrupt("return",o);case 7:case"end":return n.stop()}}),n,this)})))}},{key:"bootstrapExtension",value:function(e,t){if(!t.bootstraped){var n=this.dependentServiceCombinder.getExtensionService(this,e),o=this.dependentServiceCombinder.getDomainService(),r=this.dependentServiceCombinder.getApplicationService(),i=this.dependentServiceCombinder.getToolService(),s=this.dependentServiceCombinder.getExtensionContainerService(e),a=this.extensionConfigManager.findExtensionDescription(e),c=null==a?void 0:a.containerId,u=this.getContainer(c);t.bootstrap({extensionService:n,domainService:o,toolService:i,applicationService:r,containerService:s,extensionName:e,container:u}),t.bootstraped=!0}}},{key:"getContainer",value:function(e){var t=null;return e&&(t=document.getElementById(e)),t}}]),e}();kt=Object(u.__decorate)([Object(u.__param)(0,Ot),Object(u.__param)(1,Tt),Object(u.__param)(2,ht),Object(u.__param)(3,Q.a),Object(u.__metadata)("design:paramtypes",[Object,Object,Object,Object])],kt);var It="ark_extension",wt="__ark_extends_init_error_handler__";function Mt(){window[wt]||(window[wt]=!0,window.addEventListener(De,(function(e){Object(_e.tdwSingle)({opername:It,module:e.detail.module,action:"load_fail",ver7:e.detail.url,ver8:e.detail.cost,ver9:e.detail.start,ver10:e.detail.info})})),window.addEventListener(Me,(function(e){Object(_e.tdw)({opername:It,module:e.detail.module,action:"cost",ver7:e.detail.url,ver8:e.detail.cost,ver9:e.detail.start})})),window.addEventListener(we,(function(e){var t,n=e.detail.error instanceof Error?e.detail.error.stack:null===(t=e.detail.error)||void 0===t?void 0:t.toString();Object(_e.tdwSingle)({opername:It,module:e.detail.module,action:"call_error",ver7:e.detail.url,ver8:e.detail.cost,ver9:e.detail.function,ver10:n,ver11:e.detail.start})})),window.addEventListener(Ie,(function(e){e.detail.cost<1e3||Object(_e.tdw)({opername:It,module:e.detail.module,action:"call",ver7:e.detail.url,ver8:e.detail.cost,ver9:e.detail.function,ver11:e.detail.start})})),window.addEventListener("error",(function(e){var t;if((null==e?void 0:e.error)instanceof Error){var n=Ce.a.parse(e.error),o=[];if(n.forEach((function(e){if(e.fileName){var t=function(e){var t=new RegExp(/(docs-component-.*)\..*\.js$/).exec(e);if(null==t?void 0:t[1])return t[1]}(e.fileName);t&&o.push(t)}})),0!==o.length){var r=o[o.length-1];Object(_e.tdwSingle)({opername:It,action:"js_error",module:r,ver7:e.message,ver8:null===(t=e.error)||void 0===t?void 0:t.stack,ver9:o.join("->")})}}})))}var Dt=function(){function e(){r()(this,e),this.containerCollectionId="__unspesified_extension_container_collection__"}return s()(e,[{key:"createContainerIfUnspecified",value:function(e){this.unspecifiedContainerCollection=this.getUnspecifiedContainerCollection();var t=this.unspecifiedContainerCollection.querySelector("#".concat(e));return t||((t=document.createElement("div")).setAttribute("id",e),this.unspecifiedContainerCollection.appendChild(t),t)}},{key:"createSandboxContainerIfUnspecified",value:function(){throw new Error("Method not implemented.")}},{key:"getUnspecifiedContainerCollection",value:function(){var e=document.getElementById(this.containerCollectionId);return e||((e=document.createElement("div")).setAttribute("id",this.containerCollectionId),document.body.appendChild(e)),e}}]),e}(),At=function(){function e(t){r()(this,e),this.extensionManager=t,this.extensionConfig=[]}return s()(e,[{key:"addExtensionConfig",value:function(e){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.extensionConfig=this.extensionConfig.concat(e),t.next=3,this.extensionManager.addExtensionConfig(e);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"addExtensionDescription",value:function(e){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.assertNoDuplicatedDescription(e),this.extensionConfig.push(e),t.next=4,this.extensionManager.addExtensionDescription(e);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"getExtensionConfig",value:function(){return this.extensionConfig}},{key:"findExtensionDescription",value:function(e){return this.extensionConfig.find((function(t){return t.name===e}))}},{key:"iterateExtensionConfig",value:function(e){this.extensionConfig.forEach(e)}},{key:"assertNoDuplicatedDescription",value:function(e){if(this.extensionConfig.find((function(t){return t.name===e.name})))throw new ke("duplicated extension config of ".concat(e.name,"."))}}]),e}();At=Object(u.__decorate)([Object(u.__param)(0,ht),Object(u.__metadata)("design:paramtypes",[Object])],At);var Nt=Object(b.a)("IExtensionService"),Lt=Symbol.for("__META_REQUEST_CACHE__"),xt=window.location,Pt=xt.protocol,Ut=xt.host,jt="".concat(Pt,"//").concat(Ut,"/components/docs/metadata{{specifiedVersionKey}}.json?t={{time}}"),Bt=function(){function e(t){var n,o,i;r()(this,e),this.COMPONENT_CDN_PREFIX=null!==(n=t.componentCdnPrefix)&&void 0!==n?n:st,this.specifiedVersionKey=t.specifiedVersion?".v".concat(t.specifiedVersion):"",this.METADATA_URL=null!==(o=t.metadataUrl)&&void 0!==o?o:jt,this.language=null!==(i=t.language)&&void 0!==i?i:""}return s()(e,[{key:"metadataRequestCacheMap",get:function(){return void 0===globalThis[Lt]&&(globalThis[Lt]=new Map),globalThis[Lt]}},{key:"getMetadataRecord",value:function(){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function e(){var t,n,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.metadataRequestCacheMap.has(this.specifiedVersionKey),n=t?this.metadataRequestCacheMap.get(this.specifiedVersionKey):this.requestMetadataRecord(),t||this.metadataRequestCacheMap.set(this.specifiedVersionKey,n),e.next=5,n;case 5:return o=e.sent,e.abrupt("return",o);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"getLanguage",value:function(){return this.language}},{key:"loadMetadataScript",value:function(e){return new Promise((function(t,n){var o=document.createElement("script");o.src=e,o.async=!1,o.type="text/javascript",o.addEventListener("load",(function(){return t()})),o.addEventListener("error",(function(e){return n(e)})),document.body.appendChild(o)}))}},{key:"requestMetadataRecord",value:function(){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function e(){var t,n,o,r,i,s,a,u,d=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.METADATA_URL.replace("{{specifiedVersionKey}}",this.specifiedVersionKey).replace("{{time}}",Date.now().toString()),n=performance.now(),"http:"===Pt||"https:"===Pt||!this.METADATA_URL.includes("js")||this.METADATA_URL.includes("json")){e.next=14;break}return e.prev=3,e.next=6,this.loadMetadataScript(t);case 6:o={data:window.METADATA_DATA,status:0},e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),o={data:{},status:e.t0};case 12:e.next=17;break;case 14:return e.next=16,me.networkRequest.get(t);case 16:o=e.sent;case 17:if(r=performance.now(),i=r-n,Ae.loadCost({module:"metadata",url:t,cost:i,start:n}),o.data){e.next=23;break}throw Ae.loadFail({module:"metadata",url:t,info:o.status.toString(),cost:i,start:n}),new ke("request metadata error, error code: [".concat(o.status,"]."));case 23:return s=o.data,a=void 0===s?{}:s,u=Object.values(a).reduce((function(e,t){return Object.assign(Object.assign({},e),k()({},t.name,Object.assign(Object.assign({},t),{url:d.getMetadataUrl(t)})))}),{}),e.abrupt("return",u);case 26:case"end":return e.stop()}}),e,this,[[3,9]])})))}},{key:"getMetadataUrl",value:function(e){var t=this;return Array.isArray(e.url)?e.url.map((function(e){return"".concat(t.COMPONENT_CDN_PREFIX,"/").concat(e)})):["".concat(this.COMPONENT_CDN_PREFIX,"/").concat(e.url)]}}]),e}(),Ft="__ARK_EXTENSION_INSTANTIATION_SERVICE__",Wt="__ARK_EXTENSION_SERVICE__";function Kt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=globalThis[Wt];if(t)return t;var n=new C.a,o=new R.a,r={serviceRegister:n,serviceCollection:o};Gt(r,e),Ht(r);var i=Vt(o);globalThis[Ft]=i;var s=globalThis[Wt]=function(e){return e.invokeFunction((function(e){return e.get(Nt)}))}(i);return Mt(),s}function Gt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=e.serviceRegister;o.register(Nt,kt),o.register(Tt,At),o.register(Ue,Bt,[null!==(t=n.metadataLoaderOptions||n.metadataLoader)&&void 0!==t?t:{}]),o.register(ht,dt)}(e,t),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.serviceRegister,o=t.isEnterprise;n.register(Q.a,Y.a),n.register(X.a,J.a),n.register(N.a,z.a),n.register(F.a,$.a),n.register(W.a,Z.a),n.register(G.a,ee.a),n.register(j.a,te.a),n.register(ne.a,oe.a),n.register(D.a,o?re.a:ie.a),n.register(A.a,se.a),n.register(L.a,ae.a),n.register(q.a,ce.a),n.register(P.a,ue.a),n.register(U.a,de.a),n.register(B.a,le.a),n.register(K.a,pe.a),n.register(H.a,he.a),n.register(V.a,fe.a),n.register(x.a,o?ve.a:ge.a),n.register(M.f,M.b),n.register(M.e,M.a),n.register(M.h,M.d),n.register(M.g,M.c),n.register(Ot,St),n.register(Ct,bt),n.register(Rt,Dt)}(e,t)}function Ht(e){var t=e.serviceRegister,n=e.serviceCollection;t.getServiceDescriptors().forEach((function(e){var t=ye()(e,2),o=t[0],r=t[1];n.set(o,r)}))}function Vt(e){return new S.a(e)}var qt=function(){function e(t){return r()(this,e),this.scriptLoader=t||window.ScriptLoader||window.SLR,new Proxy(this,{set:function(e,t,n){return void 0!==e.scriptLoader[t]?(e.scriptLoader[t]=n,!0):(e[t]=n,!0)},get:function(e,t){return e[t]?e[t]:e.scriptLoader[t]?"function"==typeof e.scriptLoader[t]?e.scriptLoader[t].bind(e.scriptLoader):e.scriptLoader[t]:void 0}})}return s()(e,[{key:"init",value:function(e,t,n,o){this.scriptLoader.init(e,t,n,o)}},{key:"load",value:function(e,t,n,o){this.scriptLoader.load(e,t,n,o)}},{key:"dispatch",value:function(e,t){this.scriptLoader.dispatch(e,t)}},{key:"listen",value:function(e,t){this.scriptLoader.listen(e,t)}}]),e}();function Qt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=v()(e);if(t){var r=v()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return h()(this,n)}}var Yt=function(e){l()(n,e);var t=Qt(n);function n(e){var o;return r()(this,n),(o=t.call(this,e)).__adpater__=!0,o.__version__="3.19.18",o.isReady=!1,o.onReadyEmitter=new Fe,o.fcModuleMap=new Map,o.extensionService=Kt(),o.domainUpdater=o.extensionService.domainUpdater,o.extensionService.getExtensionConfig()||o.extensionService.scanAndHandleExtensions([]),o.onReady=o.onReadyEmitter.event,o}return s()(n,[{key:"ready",value:function(){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function e(){var t=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.updateDomainWithClientVars();case 2:return setTimeout((function(){t.isReady=!0,t.onReadyEmitter.fire()}),0),e.abrupt("return",this);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"registerExternalModule",value:function(e,t){this.fcModuleMap.has(e)||(t.bootstrap(this.extensionService,this),this.fcModuleMap.set(e,t))}},{key:"loadExternalModule",value:function(e,t,n){var o=this.fcModuleMap.get(e);void 0!==o?t(o):null==n||n()}},{key:"load",value:function(e,t,o,r){var i=this;this.isReady?this.fcModuleMap.has(e)?this.loadExternalModule(e,t,o):Se()(v()(n.prototype),"load",this).call(this,e,t,o,r):this.onReady((function(){i.load(e,t,o,r)}))}},{key:"updateDomainWithClientVars",value:function(){var e=this;return new Promise((function(t,n){setTimeout((function o(){try{if(!0===window.__DISALBE_AUTO_UPDATE_CLIENT_VARS__)return e.listen("updateDomainWithClientVars",(function(){e.domainUpdater.updateDomainWithClientVars(window.clientVars,!1)})),void t();if(void 0!==window.clientVars)return window.clientVars.padId&&e.domainUpdater.updateDomainWithClientVars(window.clientVars,!1),void t();setTimeout(o,0)}catch(e){n(e)}}),0)}))}}],[{key:"getInstance",value:function(e){return void 0===n.instance&&(n.instance=new n(e)),n.instance}}]),n}(qt),Xt=function(){return window.ScriptLoader||window.SLR};function Jt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xt();if(void 0===e)throw new Error("window.ScriptLoader OR window.SLR is undefined, use `patchScriptLoader(scriptLoader)` to patch");if(e instanceof Yt||e.__adpater__)return e;var t=Yt.getInstance(e);return window.ScriptLoader=t,window.SLR=t,t}var zt=function(){function e(){r()(this,e)}return s()(e,[{key:"bootstrap",value:function(e,t){this.extensionService=e,this.scriptLoader=t}},{key:"load",value:function(e){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.extension){t.next=2;break}return t.abrupt("return",this.extension);case 2:return t.next=4,this.extensionService.addExtensionDescription({name:this.name,branch:this.branch,containerId:e.id,loadType:xe.EAGER});case 4:return t.next=6,this.extensionService.getExtension(this.name);case 6:return this.extension=t.sent,t.abrupt("return",this.extension);case 8:case"end":return t.stop()}}),t,this)})))}}]),e}()}.call(this,n("5ef37df1a0"))},"116005830b":function(e,t,n){"use strict";var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},o.apply(this,arguments)},r=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.BigDataChannel=t.BuildBigDataChannel=void 0;var s=n("cdda668c2b"),a=n("f41252a196"),c=n("afc95ccd7b"),u="/dop-api/commitchanges",d=function(){function e(e,t){this.options=e,this.dependency=t}return e.prototype.dispose=function(){s.ConnectionLog.warn("BigDataChannel dispose.")},e.prototype.sendMessage=function(e){var t,n;return r(this,void 0,void 0,(function(){var o,r,a,c=this;return i(this,(function(i){switch(i.label){case 0:return 0!==(o=this.preCheck(e)).errCode||"object"!=typeof e.data?[3,2]:(r=[e.data],[4,this.bigChangesCommit(r)]);case 1:return a=i.sent(),s.ConnectionLog.info("bigChangesCommitResult : "+a.success+" retcode:"+a.retCode+" bodyLength:"+a.bodyLength),a.success?null===(t=a.data)||void 0===t||t.forEach((function(t){var n;if(t.commitId===e.taskId){var o={errCode:0,response:{new_rev:t.new_rev,body:{data:{author:t.author,changesetType:t.changesetType,commitId:t.commitId,subid:t.subId,applyTime:t.applyTime}}}};null===(n=e.onsendAccept)||void 0===n||n.call(e,t.commitId,"USER_CHANGES",e.data,"ACCEPT_COMMIT",o)}else{var r=c.createServerMessage(t);c.dependency.receiveMessageFromServer("NEW_CHANGES",[r])}})):e.onError(e.taskId,e.cmd,e.data,{errCode:null!==(n=a.retCode)&&void 0!==n?n:52e3,errMsg:a.reason}),[3,3];case 2:e.onError(e.taskId,e.cmd,e.data,o),i.label=3;case 3:return[2]}}))}))},e.prototype.batchCommitMessages=function(e,t,n){return r(this,void 0,void 0,(function(){var o,r;return i(this,(function(i){switch(i.label){case 0:return o=this.packUserChanges(e,t,n),[4,this.batchChangesRequest(this.options.serverVars.globalPadId,o,n)];case 1:return r=i.sent(),[2,this.getCommitResult(r,t)]}}))}))},e.prototype.batchChangesRequest=function(e,t,n){return r(this,void 0,void 0,(function(){var o,r,c,d;return i(this,(function(i){return o=s.Cookie.getXsrf(),r=u+"?padId="+e+"&xsrf="+o+"&"+((null==n?void 0:n.urlParameter)?null==n?void 0:n.urlParameter:""),c=s.JsonUtil.jsonStringify(t),c=encodeURIComponent(c),d={url:r,method:a.Method.POST,body:"data="+c,contentType:a.ContentType.FORM},[2,(new a.Request).sendCommonRequest(d)]}))}))},e.prototype.bigChangesCommit=function(e){var t,n;return r(this,void 0,void 0,(function(){var o,r,s;return i(this,(function(i){switch(i.label){case 0:return o=this.packUserChanges(e),(r=this.bigChangesRequestBody(this.options.serverVars.globalPadId,o)).length>=((null===(n=null===(t=this.options.config)||void 0===t?void 0:t.bigDataCommitConfig)||void 0===n?void 0:n.maxContentLength)||20971520)?[2,{success:!1,retCode:52003,bodyLength:r.length,data:[]}]:[4,this.bigChangesRequest(r)];case 1:return s=i.sent(),[2,this.getCommitResult(s)]}}))}))},e.prototype.bigChangesRequest=function(e){var t,n;return r(this,void 0,void 0,(function(){var o;return i(this,(function(r){return o={url:u,method:a.Method.POST,body:e,contentType:a.ContentType.JSON,timeout:null===(n=null===(t=this.options.config)||void 0===t?void 0:t.bigDataCommitConfig)||void 0===n?void 0:n.timeout},[2,(new a.Request).sendCommonRequest(o)]}))}))},e.prototype.bigChangesRequestBody=function(e,t){var n=s.Cookie.getXsrf();return s.JsonUtil.jsonStringify({padId:e,xsrf:n,commitData:t})},e.prototype.getCommitResult=function(e,t){var n,o,r={success:!1,retCode:0,data:[]};if(e.error){r.type="NetworkException";var i=null===(n=e.error)||void 0===n?void 0:n.statusCode;return 413===i&&(r.retCode=52003),s.ConnectionLog.info("batchCommitMessages: "+(null===(o=e.error)||void 0===o?void 0:o.message)+", statusCode:"+i),r}try{var a=JSON.parse(e.data);0===(null==a?void 0:a.retcode)?(a.Data.respective.forEach((function(e){var n;s.ConnectionLog.info("batchCommitMessages rev:"+t+", newRev:"+e.newRev+", taskId:"+e.commitId),null===(n=r.data)||void 0===n||n.push(e)})),r.type="Success",r.success=!0,r.common=a.Data.common):(r.retCode=a.retcode,r.type="ServerVerityException",r.reason=a.retmsg,s.ConnectionLog.info("batchCommitMessages retcode:"+(null==a?void 0:a.retcode)+" retmsg:"+(null==a?void 0:a.retmsg)))}catch(t){s.ConnectionLog.warn("getCommitResult parseJson error, data: "+e.data+"."),r.type="NetworkException"}return r},e.prototype.preCheck=function(e){var t={errCode:0};return e.data&&"string"!=typeof e.data||(t.errMsg="send data type is conrect.",t.errCode=52001),t},e.prototype.packUserChanges=function(e,t,n){var r,i=this,s=e[0];return{common:o(o({},null==n?void 0:n.additionalFieldsToCommon),{type:"USER_CHANGES",curRev:t,offlineMsg:!0,docid:this.options.serverVars.globalPadId,uid:this.options.uid,dver:this.options.serverVars.dver,base_rev:s.baseRev,code_ver:0,session_type:0,gray:this.options.serverVars.gray||0,generalpacket:null===(r=this.options.config)||void 0===r?void 0:r.headerGeneralPacket,pver:this.options.serverVars.pver,uuId:this.options.uuId}),respective:e.map((function(e){return i.getRespectiveItem(e)}))}},e.prototype.getRespectiveItem=function(e){var t={task_id:e.taskId,subId:e.subId,oSubId:e.oSubId||!1,head:e.head||!1,keydata:e.keydata||!1,changeSetCount:e.changeSetCount||1,changeset:e.changeset,changesetType:e.changesetType,apool:e.apool,isWorkbook:e.isWorkbook};return this.options.module===c.DOCUMENT_TYPE.DOC?(t.commands=e.base64Commands||e.changeset,t.changeset=""):t.changeset=e.changeset,t},e.prototype.createServerMessageHead=function(e){return{base_rev:e.new_rev-1,docid:this.options.serverVars.globalPadId,dver:this.options.serverVars.dver,new_rev:e.new_rev,session_type:0,type:"USER_CHANGES",uid:this.options.uid,uuid:this.options.uuId}},e.prototype.createServerMessageBody=function(e){var t;return{data:{apool:e.apool,author:e.author,changeset:e.changeset,commitId:e.commitId,head:e.head,isWorkbook:e.isWorkbook||!1,need:e.need,revert:e.revert,subId:null!==(t=e.subId)&&void 0!==t?t:e.subid,newRev:e.newRev,new_rev:e.newRev,type:e.type,uuId:this.options.uuId}}},e.prototype.createServerMessage=function(e){return{head:this.createServerMessageHead(e),body:this.createServerMessageBody(e),newRev:e.newRev,socketId:""}},e}();t.BigDataChannel=d,t.BuildBigDataChannel=function(e,t){return new d(e,t)}},"147e28b86b":function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n("c0f85d03df"),t),r(n("5c1e4c92a1"),t),r(n("d684f6ff39"),t),r(n("1eb2641e35"),t),r(n("193c542c4e"),t),r(n("4a7ec9f89e"),t),r(n("9c5a83385b"),t),r(n("868ec81a7d"),t)},"148a547de9":function(e,t,n){"use strict";var o=n("9da27020aa");e.exports=function(e,t){o.forEach(e,(function(n,o){o!==t&&o.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[o])}))}},"178f6c13df":function(e,t,n){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},"193c542c4e":function(e,t,n){"use strict";var o,r;Object.defineProperty(t,"__esModule",{value:!0}),t.NEED_RECONNECT_ERRCODES=t.NOT_NEED_TO_HANDLE_ERRCODES=t.SERVER_SUCCESS_CODES=t.NEED_RETRY_ERRCODES=t.RoomWebsocketErrorCode=t.RoomErrorCode=void 0,function(e){e[e.SUCCESS=0]="SUCCESS",e[e.TIMEOUT=101]="TIMEOUT",e[e.PARA_ERROR=102]="PARA_ERROR",e[e.EXIST=103]="EXIST",e[e.ROOM_DISCONNECT=104]="ROOM_DISCONNECT",e[e.ROOM_CLOSE=105]="ROOM_CLOSE",e[e.ROOM_STATE_ERR=106]="ROOM_STATE_ERR",e[e.ROOM_SHUTDOWN=107]="ROOM_SHUTDOWN",e[e.STATUS_ERR=108]="STATUS_ERR",e[e.BIG_COLLAB_CONNECT_TIMEOUT=109]="BIG_COLLAB_CONNECT_TIMEOUT"}(o||(o={})),t.RoomErrorCode=o,function(e){e[e.SOCKET_SERVER_SUCCESS=0]="SOCKET_SERVER_SUCCESS",e[e.SOCKET_DATA_SERVER_UNKNOWN_ERROR=1e4]="SOCKET_DATA_SERVER_UNKNOWN_ERROR",e[e.SOCKET_DATA_PROTOCOL_FIELD_LACK=10001]="SOCKET_DATA_PROTOCOL_FIELD_LACK",e[e.SOCKET_DATA_SERVER_ERROR=4e4]="SOCKET_DATA_SERVER_ERROR",e[e.SOCKET_DATA_DOC_NOT_EXIST=40001]="SOCKET_DATA_DOC_NOT_EXIST",e[e.SOCKET_DATA_SUBID_ERROR=40002]="SOCKET_DATA_SUBID_ERROR",e[e.SOCKET_DATA_ACTION_LENGTH=40003]="SOCKET_DATA_ACTION_LENGTH",e[e.SOCKET_DATA_CHANGESET_EASYSYNC=40005]="SOCKET_DATA_CHANGESET_EASYSYNC",e[e.SOCKET_DATA_SAVE_FAIL=40006]="SOCKET_DATA_SAVE_FAIL",e[e.SOCKET_DATA_READ_FAIL=40020]="SOCKET_DATA_READ_FAIL",e[e.SOCKET_DATA_BASEREV_ERROR=40021]="SOCKET_DATA_BASEREV_ERROR",e[e.SOCKET_DATA_NOT_SUPPORTED_TYPE=40022]="SOCKET_DATA_NOT_SUPPORTED_TYPE",e[e.SOCKET_DATA_NOT_SUPPORTED_PROTO=40023]="SOCKET_DATA_NOT_SUPPORTED_PROTO",e[e.SOCKET_GRAY_VERSION_INCONFORMITY=40024]="SOCKET_GRAY_VERSION_INCONFORMITY",e[e.SOCKET_DOCUMENT_EDIT_COLLAB_LIMIT=40025]="SOCKET_DOCUMENT_EDIT_COLLAB_LIMIT",e[e.SOCKET_DATA_CONTENT_LIMIT=40026]="SOCKET_DATA_CONTENT_LIMIT",e[e.SOCKET_DATA_REV_DIFF_UPPER_TEN=40027]="SOCKET_DATA_REV_DIFF_UPPER_TEN",e[e.SOCKET_DATA_EASYSYNC_TIMEOUT=40028]="SOCKET_DATA_EASYSYNC_TIMEOUT",e[e.SOCKET_CLIENT_VERSION_TOO_OLD=40029]="SOCKET_CLIENT_VERSION_TOO_OLD",e[e.SOCKET_JS_TOO_OLD=40030]="SOCKET_JS_TOO_OLD",e[e.SOCKET_NOT_CONFILCT_TO_COMMIT=40031]="SOCKET_NOT_CONFILCT_TO_COMMIT",e[e.SOCKET_COMMIT_QUEUE_NORMAL_LOCK=40032]="SOCKET_COMMIT_QUEUE_NORMAL_LOCK",e[e.SOCKET_COMMIT_QUEUE_OFFLINE_LOCK=40033]="SOCKET_COMMIT_QUEUE_OFFLINE_LOCK",e[e.SOCKET_COMMIT_DVER_INCONFORMITY=40034]="SOCKET_COMMIT_DVER_INCONFORMITY",e[e.SOCKET_SHEET_COMMIT_MIDDLE_SERVER_ERROR=40035]="SOCKET_SHEET_COMMIT_MIDDLE_SERVER_ERROR",e[e.SOCKET_SHEET_COMMIT_MUTATION_FORMAT_ERROR=40036]="SOCKET_SHEET_COMMIT_MUTATION_FORMAT_ERROR",e[e.SOCKET_SHEET_COMMIT_MUTATION_APPLY_ERROR=40037]="SOCKET_SHEET_COMMIT_MUTATION_APPLY_ERROR",e[e.SOCKET_WEB_VERSION_GREATER_SERVER_VERSION=40038]="SOCKET_WEB_VERSION_GREATER_SERVER_VERSION",e[e.SOCKET_SHEET_ROW_COL_NUMBER_LIIMT=40039]="SOCKET_SHEET_ROW_COL_NUMBER_LIIMT",e[e.SOCKET_DATA_DOCID_ERROR=41001]="SOCKET_DATA_DOCID_ERROR",e[e.SOCKET_DATA_PROTOCOL_TYPE_ERROR=41002]="SOCKET_DATA_PROTOCOL_TYPE_ERROR",e[e.COMMIT_CHANGES_CONTAIN_REVERT=50095]="COMMIT_CHANGES_CONTAIN_REVERT",e[e.SOCKET_SERVER_ERROR=6e4]="SOCKET_SERVER_ERROR",e[e.SOCKET_LAYER_ERROR=60001]="SOCKET_LAYER_ERROR",e[e.SOCKET_CLIENT_NOT_READY_ERROR=60002]="SOCKET_CLIENT_NOT_READY_ERROR",e[e.SOCKET_CLIENT_DATA_ERROR=60003]="SOCKET_CLIENT_DATA_ERROR",e[e.SOCKET_COLLAB_ROOM_TIMEOUT=60004]="SOCKET_COLLAB_ROOM_TIMEOUT",e[e.SOCKET_COLLAB_SERVER_TIMEOUT=60005]="SOCKET_COLLAB_SERVER_TIMEOUT",e[e.SOCKET_USER_AUTH_FAILED=60006]="SOCKET_USER_AUTH_FAILED",e[e.SOCKET_DOC_PRIVILEGE_FAILED=60007]="SOCKET_DOC_PRIVILEGE_FAILED",e[e.SOCKET_PACKAGE_SIZE_TOO_LARGE=60008]="SOCKET_PACKAGE_SIZE_TOO_LARGE",e[e.SOCKET_COLLAB_ROOM_ALREADY_EXIST=60009]="SOCKET_COLLAB_ROOM_ALREADY_EXIST",e[e.SOCKET_COLLAB_ROOM_MEMBER_FULL=60010]="SOCKET_COLLAB_ROOM_MEMBER_FULL",e[e.SOCKET_SERVER_STORAGE_TIMEOUT=60011]="SOCKET_SERVER_STORAGE_TIMEOUT",e[e.SOCKET_SERVER_CGI_TIMEOUT=60013]="SOCKET_SERVER_CGI_TIMEOUT",e[e.SOCKET_FREQUENCY_LIMIT=60014]="SOCKET_FREQUENCY_LIMIT",e[e.SOCKET_USER_DOC_NOPRIVILEGE=60015]="SOCKET_USER_DOC_NOPRIVILEGE",e[e.SOCKET_USER_CHANGE_PARAM_ERROR=60016]="SOCKET_USER_CHANGE_PARAM_ERROR",e[e.SOCKET_COMMAND_NOT_SUPPORTED=60017]="SOCKET_COMMAND_NOT_SUPPORTED",e[e.SOCKET_HACKPAD_TIMEOUT=60018]="SOCKET_HACKPAD_TIMEOUT",e[e.SOCKET_SERVER_WAITTING_TOO_LONG=60019]="SOCKET_SERVER_WAITTING_TOO_LONG",e[e.SOCKET_SERVER_WAITTING_TIMEOUT=60020]="SOCKET_SERVER_WAITTING_TIMEOUT",e[e.SOCKET_AUTH_TIMEOUT=60021]="SOCKET_AUTH_TIMEOUT",e[e.SOCKET_GET_PRIVILEGE_TIMEOUT=60022]="SOCKET_GET_PRIVILEGE_TIMEOUT",e[e.SOCKET_IP_BLACK_LIST=60030]="SOCKET_IP_BLACK_LIST",e[e.SOCKET_USER_BLACK_LIST=60031]="SOCKET_USER_BLACK_LIST",e[e.SOCKET_DOCMENT_BLACK_LIST=60032]="SOCKET_DOCMENT_BLACK_LIST",e[e.SOCKET_USERAGENT_BLACK_LIST=60033]="SOCKET_USERAGENT_BLACK_LIST",e[e.SOCKET_SWITCH_BIG_COLLAB=60034]="SOCKET_SWITCH_BIG_COLLAB",e[e.EXIT_BIG_COLLAB=60035]="EXIT_BIG_COLLAB",e[e.CLIENT_NOT_EXIST=62e3]="CLIENT_NOT_EXIST",e[e.WRITER_IS_EXIST=62001]="WRITER_IS_EXIST",e[e.SOCKET_UNKNOWN_ERROR=-1]="SOCKET_UNKNOWN_ERROR",e[e.SOCKET_COLLABROOM_GET_VIP_FAIL=7e4]="SOCKET_COLLABROOM_GET_VIP_FAIL",e[e.SOCKET_COLLABROOM_NOT_VIP_FULL=70001]="SOCKET_COLLABROOM_NOT_VIP_FULL",e[e.SOCKET_COLLABROOM_DOC_DELETED=70002]="SOCKET_COLLABROOM_DOC_DELETED",e[e.ROOM_WEBSOCKET_DISPOSE_SHUTDOWN=1000001]="ROOM_WEBSOCKET_DISPOSE_SHUTDOWN",e[e.INACTIVE=1000002]="INACTIVE",e[e.CODEREV_NEW=1000003]="CODEREV_NEW",e[e.SOCKET_SEND_MESSAGE_TIMEOUT=1000004]="SOCKET_SEND_MESSAGE_TIMEOUT",e[e.LOGIN_INVALIDATE=1000005]="LOGIN_INVALIDATE",e[e.LOGIN_FORBIDDEN=1000006]="LOGIN_FORBIDDEN"}(r||(r={})),t.RoomWebsocketErrorCode=r;var i=[r.SOCKET_COLLAB_ROOM_TIMEOUT,r.SOCKET_COLLAB_SERVER_TIMEOUT,r.SOCKET_SERVER_STORAGE_TIMEOUT,r.SOCKET_SERVER_CGI_TIMEOUT,r.SOCKET_FREQUENCY_LIMIT,r.SOCKET_LAYER_ERROR,r.SOCKET_CLIENT_NOT_READY_ERROR,r.SOCKET_COLLAB_ROOM_MEMBER_FULL];t.NEED_RETRY_ERRCODES=i;var s=[r.SOCKET_SERVER_SUCCESS,r.SOCKET_COLLAB_ROOM_ALREADY_EXIST];t.SERVER_SUCCESS_CODES=s;var a=[r.WRITER_IS_EXIST];t.NOT_NEED_TO_HANDLE_ERRCODES=a;var c=[r.CLIENT_NOT_EXIST,r.SOCKET_USER_AUTH_FAILED,r.SOCKET_DOC_PRIVILEGE_FAILED];t.NEED_RECONNECT_ERRCODES=c},"19d42386c4":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},"1d73a1ebc4":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisposableStore=void 0;var o=n("95b75d217e"),r=n("8838f60498"),i=function(){function e(){this.toDisposeSet=new Set,this.isDisposeState=!1}return e.prototype.dispose=function(e){if(!this.isDisposeState)if(r.markTracked(this),this.isDisposeState=!0,e)this.clear(e);else{var t=o.DisposeTrace.traceRoot(this.constructor.name);this.clear(t),t.stop()}},e.prototype.clear=function(e){this.toDisposeSet.forEach((function(t){var n=t.disposableId||t.constructor.name;t.dispose(null==e?void 0:e.branch(n))})),this.toDisposeSet.clear()},e.prototype.add=function(t){if(!t)return t;if(t===this)throw new Error("Cannot register a disposable on itself!");return r.markTracked(t),this.isDisposeState?e.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this.toDisposeSet.add(t),t},e.DISABLE_DISPOSED_WARNING=!1,e}();t.DisposableStore=i},"1e652ff12c":function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},o(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.buildCommonRequestChannel=void 0;var i=n("8c6f8478bd"),s=n("3170e5d2d7"),a=n("aac7a61d2a"),c=n("5d1be1397d"),u=n("cf3c69206c"),d=function(e){function t(t){var n=e.call(this,t,{requestUrl:"/dop-api/commitchanges",method:c.Method.POST,contentType:u.ContentType.JSON})||this;return n.options=t,n.init(),n}return r(t,e),t.prototype.init=function(){this.paramsPacker=new s.CommonRequestParamsPacker,this.responseHandler=new a.CommonResponseHandler},t}(i.BaseChannel);t.buildCommonRequestChannel=function(e){return new d(e)}},"1eb2641e35":function(e,t,n){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.RoomUtil=void 0;var r=n("147e28b86b"),i=n("193c542c4e"),s=((o={})[i.RoomWebsocketErrorCode.SOCKET_SERVER_ERROR]="Server internal error, code = "+i.RoomWebsocketErrorCode.SOCKET_SERVER_ERROR,o[i.RoomWebsocketErrorCode.SOCKET_LAYER_ERROR]="Connection not exist, code = "+i.RoomWebsocketErrorCode.SOCKET_LAYER_ERROR,o[i.RoomWebsocketErrorCode.SOCKET_USER_AUTH_FAILED]="TX-LOGIN-PSKEY-EXPIRED 登录态校验失败, code = "+i.RoomWebsocketErrorCode.SOCKET_USER_AUTH_FAILED,o[i.RoomWebsocketErrorCode.SOCKET_CLIENT_DATA_ERROR]="请求数据出错, code = "+i.RoomWebsocketErrorCode.SOCKET_CLIENT_DATA_ERROR,o[i.RoomWebsocketErrorCode.SOCKET_COLLAB_ROOM_TIMEOUT]="后台房间超时, code = "+i.RoomWebsocketErrorCode.SOCKET_COLLAB_ROOM_TIMEOUT,o[i.RoomWebsocketErrorCode.SOCKET_COLLAB_SERVER_TIMEOUT]="后台服务超时, code = "+i.RoomWebsocketErrorCode.SOCKET_COLLAB_SERVER_TIMEOUT,o[i.RoomWebsocketErrorCode.SOCKET_SERVER_STORAGE_TIMEOUT]="后台存储超时, code = "+i.RoomWebsocketErrorCode.SOCKET_SERVER_STORAGE_TIMEOUT,o[i.RoomWebsocketErrorCode.SOCKET_SERVER_CGI_TIMEOUT]="后台CGI超时, code = "+i.RoomWebsocketErrorCode.SOCKET_SERVER_CGI_TIMEOUT,o[i.RoomWebsocketErrorCode.SOCKET_DOC_PRIVILEGE_FAILED]="权限校验失败, code = "+i.RoomWebsocketErrorCode.SOCKET_DOC_PRIVILEGE_FAILED,o[i.RoomWebsocketErrorCode.SOCKET_USER_DOC_NOPRIVILEGE]="权限校验无权限, code = "+i.RoomWebsocketErrorCode.SOCKET_USER_DOC_NOPRIVILEGE,o[i.RoomWebsocketErrorCode.SOCKET_PACKAGE_SIZE_TOO_LARGE]="超过最大包长限制, code = "+i.RoomWebsocketErrorCode.SOCKET_PACKAGE_SIZE_TOO_LARGE,o[i.RoomWebsocketErrorCode.SOCKET_COLLAB_ROOM_MEMBER_FULL]="Member full, code = "+i.RoomWebsocketErrorCode.SOCKET_COLLAB_ROOM_MEMBER_FULL,o[i.RoomWebsocketErrorCode.SOCKET_FREQUENCY_LIMIT]="频率限制, code = "+i.RoomWebsocketErrorCode.SOCKET_FREQUENCY_LIMIT,o[i.RoomWebsocketErrorCode.SOCKET_AUTH_TIMEOUT]="TX-LOGIN-PSKEY-EXPIRED 鉴权超时, code = "+i.RoomWebsocketErrorCode.SOCKET_AUTH_TIMEOUT,o[i.RoomWebsocketErrorCode.SOCKET_GET_PRIVILEGE_TIMEOUT]="权限超时, code = "+i.RoomWebsocketErrorCode.SOCKET_GET_PRIVILEGE_TIMEOUT,o[i.RoomWebsocketErrorCode.SOCKET_DATA_SERVER_UNKNOWN_ERROR]="后台发生未知异常错误, code = "+i.RoomWebsocketErrorCode.SOCKET_DATA_SERVER_UNKNOWN_ERROR,o[i.RoomWebsocketErrorCode.SOCKET_DATA_PROTOCOL_FIELD_LACK]="数据协议字段缺失, code = "+i.RoomWebsocketErrorCode.SOCKET_DATA_PROTOCOL_FIELD_LACK,o[i.RoomWebsocketErrorCode.SOCKET_DATA_DOC_NOT_EXIST]="文档不存在, code = "+i.RoomWebsocketErrorCode.SOCKET_DATA_DOC_NOT_EXIST,o[i.RoomWebsocketErrorCode.SOCKET_DATA_SUBID_ERROR]="subId不正确, code = "+i.RoomWebsocketErrorCode.SOCKET_DATA_SUBID_ERROR,o[i.RoomWebsocketErrorCode.SOCKET_DATA_ACTION_LENGTH]="提交失败 action检查失败, code = "+i.RoomWebsocketErrorCode.SOCKET_DATA_ACTION_LENGTH,o[i.RoomWebsocketErrorCode.SOCKET_DATA_CHANGESET_EASYSYNC]="changeset easysync 异常, code = "+i.RoomWebsocketErrorCode.SOCKET_DATA_CHANGESET_EASYSYNC,o[i.RoomWebsocketErrorCode.SOCKET_DATA_SAVE_FAIL]="数据落盘失败, code = "+i.RoomWebsocketErrorCode.SOCKET_DATA_SAVE_FAIL,o[i.RoomWebsocketErrorCode.SOCKET_DATA_READ_FAIL]="读数据失败, code = "+i.RoomWebsocketErrorCode.SOCKET_DATA_READ_FAIL,o[i.RoomWebsocketErrorCode.SOCKET_DATA_BASEREV_ERROR]="baseRev错误, code = "+i.RoomWebsocketErrorCode.SOCKET_DATA_BASEREV_ERROR,o[i.RoomWebsocketErrorCode.SOCKET_DATA_NOT_SUPPORTED_TYPE]="不支持文档类型, code = "+i.RoomWebsocketErrorCode.SOCKET_DATA_NOT_SUPPORTED_TYPE,o[i.RoomWebsocketErrorCode.SOCKET_DATA_NOT_SUPPORTED_PROTO]="不支持请求协议, code = "+i.RoomWebsocketErrorCode.SOCKET_DATA_NOT_SUPPORTED_PROTO,o[i.RoomWebsocketErrorCode.SOCKET_GRAY_VERSION_INCONFORMITY]="灰度版本号不一致, code = "+i.RoomWebsocketErrorCode.SOCKET_GRAY_VERSION_INCONFORMITY,o[i.RoomWebsocketErrorCode.SOCKET_DOCUMENT_EDIT_COLLAB_LIMIT]="编辑提交文档被禁止协同, code = "+i.RoomWebsocketErrorCode.SOCKET_DOCUMENT_EDIT_COLLAB_LIMIT,o[i.RoomWebsocketErrorCode.SOCKET_DATA_CONTENT_LIMIT]=" 编辑提交大小限制, code = "+i.RoomWebsocketErrorCode.SOCKET_DATA_CONTENT_LIMIT,o[i.RoomWebsocketErrorCode.SOCKET_DATA_REV_DIFF_UPPER_TEN]="base版本号与服务器最新版本差距超过10, code = "+i.RoomWebsocketErrorCode.SOCKET_DATA_REV_DIFF_UPPER_TEN,o[i.RoomWebsocketErrorCode.SOCKET_DATA_EASYSYNC_TIMEOUT]="当前提交后台处理协同冲突超时, code = "+i.RoomWebsocketErrorCode.SOCKET_DATA_EASYSYNC_TIMEOUT,o[i.RoomWebsocketErrorCode.SOCKET_CLIENT_VERSION_TOO_OLD]="CLIENT_READY 前端版本过期, code = "+i.RoomWebsocketErrorCode.SOCKET_CLIENT_VERSION_TOO_OLD,o[i.RoomWebsocketErrorCode.SOCKET_JS_TOO_OLD]="USER_CHANGES 前端版本过期, code = "+i.RoomWebsocketErrorCode.SOCKET_JS_TOO_OLD,o[i.RoomWebsocketErrorCode.SOCKET_NOT_CONFILCT_TO_COMMIT]="前端限制，存在冲突, code = "+i.RoomWebsocketErrorCode.SOCKET_NOT_CONFILCT_TO_COMMIT,o[i.RoomWebsocketErrorCode.SOCKET_COMMIT_QUEUE_NORMAL_LOCK]="提交队列被正常提交锁, code = "+i.RoomWebsocketErrorCode.SOCKET_COMMIT_QUEUE_NORMAL_LOCK,o[i.RoomWebsocketErrorCode.SOCKET_COMMIT_QUEUE_OFFLINE_LOCK]="提交队列被离线提交锁, code = "+i.RoomWebsocketErrorCode.SOCKET_COMMIT_QUEUE_OFFLINE_LOCK,o[i.RoomWebsocketErrorCode.SOCKET_COMMIT_DVER_INCONFORMITY]="编辑提交，dver 版本不一致, code = "+i.RoomWebsocketErrorCode.SOCKET_COMMIT_DVER_INCONFORMITY,o[i.RoomWebsocketErrorCode.SOCKET_SHEET_COMMIT_MIDDLE_SERVER_ERROR]="表格编辑提交，中台服务器错误, code = "+i.RoomWebsocketErrorCode.SOCKET_SHEET_COMMIT_MIDDLE_SERVER_ERROR,o[i.RoomWebsocketErrorCode.SOCKET_SHEET_COMMIT_MUTATION_FORMAT_ERROR]="表格编辑提交，提交mutaton格式错误, code = "+i.RoomWebsocketErrorCode.SOCKET_SHEET_COMMIT_MUTATION_FORMAT_ERROR,o[i.RoomWebsocketErrorCode.SOCKET_SHEET_COMMIT_MUTATION_APPLY_ERROR]="表格编辑提交，提交mutaton apply出错, code = "+i.RoomWebsocketErrorCode.SOCKET_SHEET_COMMIT_MUTATION_APPLY_ERROR,o[i.RoomWebsocketErrorCode.SOCKET_WEB_VERSION_GREATER_SERVER_VERSION]="前端版本大于后端版本, code = "+i.RoomWebsocketErrorCode.SOCKET_WEB_VERSION_GREATER_SERVER_VERSION,o[i.RoomWebsocketErrorCode.SOCKET_SHEET_ROW_COL_NUMBER_LIIMT]="表格编辑单元格数，行数、列数超限, code = "+i.RoomWebsocketErrorCode.SOCKET_SHEET_ROW_COL_NUMBER_LIIMT,o[i.RoomWebsocketErrorCode.SOCKET_DATA_DOCID_ERROR]="批量提交docid不一致, code = "+i.RoomWebsocketErrorCode.SOCKET_DATA_DOCID_ERROR,o[i.RoomWebsocketErrorCode.SOCKET_DATA_PROTOCOL_TYPE_ERROR]="批量提交协议类型不一致, code = "+i.RoomWebsocketErrorCode.SOCKET_DATA_PROTOCOL_TYPE_ERROR,o[i.RoomWebsocketErrorCode.SOCKET_USER_CHANGE_PARAM_ERROR]="userchange 参数错误, code = "+i.RoomWebsocketErrorCode.SOCKET_USER_CHANGE_PARAM_ERROR,o[i.RoomWebsocketErrorCode.SOCKET_COMMAND_NOT_SUPPORTED]="任务管理层发现不支持命令, code = "+i.RoomWebsocketErrorCode.SOCKET_COMMAND_NOT_SUPPORTED,o[i.RoomWebsocketErrorCode.SOCKET_HACKPAD_TIMEOUT]="commit error：Hackpad调用超时, code = "+i.RoomWebsocketErrorCode.SOCKET_HACKPAD_TIMEOUT,o[i.RoomWebsocketErrorCode.SOCKET_SERVER_WAITTING_TOO_LONG]="onpost：队列超长，前端延迟重试, code = "+i.RoomWebsocketErrorCode.SOCKET_SERVER_WAITTING_TOO_LONG,o[i.RoomWebsocketErrorCode.SOCKET_SERVER_WAITTING_TIMEOUT]="commit error：队列超时，前端延迟重试, code = "+i.RoomWebsocketErrorCode.SOCKET_SERVER_WAITTING_TIMEOUT,o[i.RoomWebsocketErrorCode.SOCKET_COLLABROOM_GET_VIP_FAIL]="获取会员失败, code = "+i.RoomWebsocketErrorCode.SOCKET_COLLABROOM_GET_VIP_FAIL,o[i.RoomWebsocketErrorCode.SOCKET_COLLABROOM_NOT_VIP_FULL]="登录非会员房间满员, code = "+i.RoomWebsocketErrorCode.SOCKET_COLLABROOM_NOT_VIP_FULL,o[i.RoomWebsocketErrorCode.SOCKET_COLLABROOM_DOC_DELETED]="文档已经被删除, code = "+i.RoomWebsocketErrorCode.SOCKET_COLLABROOM_DOC_DELETED,o[i.RoomWebsocketErrorCode.ROOM_WEBSOCKET_DISPOSE_SHUTDOWN]="连接层 dispose 时关闭房间层错误码, code = "+i.RoomWebsocketErrorCode.ROOM_WEBSOCKET_DISPOSE_SHUTDOWN,o[i.RoomWebsocketErrorCode.INACTIVE]="后台房间踢人，原因是不活跃或者数据升级类, code = "+i.RoomWebsocketErrorCode.INACTIVE,o[i.RoomWebsocketErrorCode.CODEREV_NEW]=" 后台踢人，原因是数据版本dver、pver或者其他不匹配, code = "+i.RoomWebsocketErrorCode.CODEREV_NEW,o[i.RoomWebsocketErrorCode.SOCKET_SEND_MESSAGE_TIMEOUT]="Websocket 提交消息超时, code = "+i.RoomWebsocketErrorCode.SOCKET_SEND_MESSAGE_TIMEOUT,o),a=function(){function e(){}return e.getWebsocketChannelErrorMessage=function(e,t){var n;void 0===t&&(t="");var o=null!==(n=s[e])&&void 0!==n?n:"error msg, code = "+e;return t&&(o=t+" "+o),o},e.getCurrentTime=function(){return(new Date).getTime()},e.createNewMessage=function(e,t,n,o,i,s,a,c,u,d){return{taskId:e,postData:t,timeout:n,maxRetryCount:o,cmd:i,data:s,waitAcceptCmd:a,onError:c,onsend:u,onsendAccept:d,retryCount:0,lastSendTime:0,onpostTime:0,firstSendTime:0,state:r.MessageState.WAITING}},e.delay=function(e){return void 0===e&&(e=0),new Promise((function(t){return setTimeout(t,e)}))},e}();t.RoomUtil=a},"21a1a32486":function(e,t,n){"use strict";var o=n("9da27020aa"),r=n("78fef7d7c4"),i=n("4e3a71edae"),s=n("d3c9d8f7fe"),a=n("583c8654bd"),c=n("6b22a60341"),u=n("3dafecb593"),d=n("c7a12f3a4f"),l=n("992a7b5d2e"),p=n("2f925fe3c3");e.exports=function(e){return new Promise((function(t,n){var h,f=e.data,v=e.headers,g=e.responseType;function m(){e.cancelToken&&e.cancelToken.unsubscribe(h),e.signal&&e.signal.removeEventListener("abort",h)}o.isFormData(f)&&delete v["Content-Type"];var E=new XMLHttpRequest;if(e.auth){var y=e.auth.username||"",_=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";v.Authorization="Basic "+btoa(y+":"+_)}var b=a(e.baseURL,e.url);function C(){if(E){var o="getAllResponseHeaders"in E?c(E.getAllResponseHeaders()):null,i={data:g&&"text"!==g&&"json"!==g?E.response:E.responseText,status:E.status,statusText:E.statusText,headers:o,config:e,request:E};r((function(e){t(e),m()}),(function(e){n(e),m()}),i),E=null}}if(E.open(e.method.toUpperCase(),s(b,e.params,e.paramsSerializer),!0),E.timeout=e.timeout,"onloadend"in E?E.onloadend=C:E.onreadystatechange=function(){E&&4===E.readyState&&(0!==E.status||E.responseURL&&0===E.responseURL.indexOf("file:"))&&setTimeout(C)},E.onabort=function(){E&&(n(d("Request aborted",e,"ECONNABORTED",E)),E=null)},E.onerror=function(){n(d("Network Error",e,null,E)),E=null},E.ontimeout=function(){var t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",o=e.transitional||l;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(d(t,e,o.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",E)),E=null},o.isStandardBrowserEnv()){var R=(e.withCredentials||u(b))&&e.xsrfCookieName?i.read(e.xsrfCookieName):void 0;R&&(v[e.xsrfHeaderName]=R)}"setRequestHeader"in E&&o.forEach(v,(function(e,t){void 0===f&&"content-type"===t.toLowerCase()?delete v[t]:E.setRequestHeader(t,e)})),o.isUndefined(e.withCredentials)||(E.withCredentials=!!e.withCredentials),g&&"json"!==g&&(E.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&E.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&E.upload&&E.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(h=function(e){E&&(n(!e||e&&e.type?new p("canceled"):e),E.abort(),E=null)},e.cancelToken&&e.cancelToken.subscribe(h),e.signal&&(e.signal.aborted?h():e.signal.addEventListener("abort",h))),f||(f=null),E.send(f)}))}},"271684415e":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAGE_UNLOAD_TIME=t.DEFAULT_MIN_TRY_COUNT=t.MAX_DELAY_TIME=t.DEFAULT_DELAY_TIME=void 0;t.DEFAULT_MIN_TRY_COUNT=1;t.DEFAULT_DELAY_TIME=0;t.PAGE_UNLOAD_TIME=3e3;t.MAX_DELAY_TIME=3e4},"2c9817aaa1":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},"2f677d4277":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},"2f925fe3c3":function(e,t,n){"use strict";function o(e){this.message=e}o.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},o.prototype.__CANCEL__=!0,e.exports=o},"3170e5d2d7":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CommonRequestParamsPacker=void 0;var o=n("cdda668c2b"),r=function(){function e(){}return e.prototype.pack=function(e,t){var n,r={common:{type:e.data.type,docid:t.serverVars.globalPadId,uid:t.uid,session_type:0,uuId:t.uuId,padType:null!==(n=t.module)&&void 0!==n?n:"",padSubType:e.data.padSubType},respective:e.data.changeset},i=t.serverVars.globalPadId,s=o.Cookie.getXsrf();return o.JsonUtil.jsonStringify({padId:i,xsrf:s,data:o.JsonUtil.jsonStringify(r)})},e}();t.CommonRequestParamsPacker=r},"3829c8d1f6":function(e,t,n){"use strict";var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},o.apply(this,arguments)},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectStatusManager=void 0;var i=n("9ab1857893"),s=n("eba64b0be6"),a=n("46509843e6"),c=n("cdda668c2b"),u=r(n("751778941b")),d=n("147e28b86b"),l=r(n("6a0d65af8f")),p=function(){function e(e,t){this.options=e,this.dependency=t,this.onConnectEventEmitter=new i.Emitter,this.tag="ConnectStatusManager",this.connectStatus=a.ConnectStatus.INIT,this.onConnectEvent=this.onConnectEventEmitter.event,this.bigCollabLogin=new s.BigCollabLogin(this.options,o(o({},this.dependency),{connectStatusChange:this.connectStatusChange.bind(this)})),new l.default({disconnect:this.disconnect.bind(this)})}return e.prototype.dispose=function(){this.bigCollabLogin.dispose(),this.onConnectEventEmitter.dispose()},e.prototype.connect=function(){this.needLogin()?this.bigCollabLogin.login():c.ConnectionLog.warn(this.tag+" not connect. connectStatus:"+this.connectStatus)},e.prototype.isConnected=function(){return this.connectStatus===a.ConnectStatus.CONNECTED},e.prototype.reconnect=function(e){this.isDisconnected()?c.ConnectionLog.info(this.tag+" can not reconnect. connectStatus: disconnected"):(this.setConnnectStatus(a.ConnectStatus.WAIT_RECONNECTING),this.bigCollabLogin.relogin(e))},e.prototype.isDisconnected=function(){return this.connectStatus===a.ConnectStatus.DISCONNECT},e.prototype.disconnect=function(e){var t,n,o,r;if(c.ConnectionLog.info(this.tag+" disconnect errorCode:"+e.errCode+", reason:"+e.reason+" shutdown:"+e.shutDown),this.bigCollabLogin.unlogin(),e.shutDown)return this.bigCollabLogin.dispose(),this.setConnnectStatus(a.ConnectStatus.DISCONNECT),this.dependency.disconnect(e),void u.default.shutDownReport({module:this.options.module,attrName:String(null!==(t=e.errCode)&&void 0!==t?t:0),status:1,errorMessage:null!==(n=e.reason)&&void 0!==n?n:d.RoomUtil.getWebsocketChannelErrorMessage(null!==(o=e.errCode)&&void 0!==o?o:0)});this.bigCollabLogin.reset(),this.dependency.disconnect(e),u.default.reconnectReport({module:this.options.module,attrName:String(null!==(r=e.errCode)&&void 0!==r?r:0),errorMessage:e.reason,status:1}),this.reconnect(e.reconnectTime)},e.prototype.onConnectSuccess=function(){this.isConnected()||(this.setConnnectStatus(a.ConnectStatus.CONNECTED),this.dependency.connected())},e.prototype.connectStatusChange=function(e,t,n){this.setConnnectStatus(e,t),e===a.ConnectStatus.LOGIN_FAIL&&this.disconnect(null!=n?n:{shutDown:!1})},e.prototype.needLogin=function(){return[a.ConnectStatus.INIT,a.ConnectStatus.WAIT_RECONNECTING].includes(this.connectStatus)},e.prototype.setConnnectStatus=function(e,t){c.ConnectionLog.info(this.tag+" setConnnectStatus: oldState:"+this.connectStatus+", newStatus = "+e),e!==this.connectStatus&&(this.connectStatus=e,this.onConnectEventEmitter.fire({status:e,serverRequestParams:t}))},e}();t.ConnectStatusManager=p},"392e2b0ea1":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},"39f57aec85":function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n("cf3c69206c"),t),r(n("cdda668c2b"),t),r(n("d3819be4ca"),t),r(n("3f7ebe22ef"),t);var i=n("147e28b86b");Object.defineProperty(t,"RoomState",{enumerable:!0,get:function(){return i.RoomState}}),Object.defineProperty(t,"MessageWaitAcceptCmd",{enumerable:!0,get:function(){return i.MessageWaitAcceptCmd}}),Object.defineProperty(t,"RoomErrorCode",{enumerable:!0,get:function(){return i.RoomErrorCode}}),Object.defineProperty(t,"RoomWebsocketErrorCode",{enumerable:!0,get:function(){return i.RoomWebsocketErrorCode}}),r(n("afc95ccd7b"),t),r(n("be1585b84b"),t);var s=n("eee882e93f");Object.defineProperty(t,"NewChangeCommandsType",{enumerable:!0,get:function(){return s.NewChangeCommandsType}}),Object.defineProperty(t,"BatchCommitFailReason",{enumerable:!0,get:function(){return s.BatchCommitFailReason}}),Object.defineProperty(t,"CHANGESET_TYPE",{enumerable:!0,get:function(){return s.CHANGESET_TYPE}}),Object.defineProperty(t,"IBatchCommitChangesResultRetcode",{enumerable:!0,get:function(){return s.IBatchCommitChangesResultRetcode}}),Object.defineProperty(t,"DEFAULT_SEND_MESSAGE_TIMEOUT",{enumerable:!0,get:function(){return s.DEFAULT_SEND_MESSAGE_TIMEOUT}}),Object.defineProperty(t,"DEFAULT_RETRY_COUNTS",{enumerable:!0,get:function(){return s.DEFAULT_RETRY_COUNTS}}),Object.defineProperty(t,"DataEngineCodes",{enumerable:!0,get:function(){return s.DataEngineCodes}}),Object.defineProperty(t,"DocEditorError",{enumerable:!0,get:function(){return s.DocEditorError}})},"3dafecb593":function(e,t,n){"use strict";var o=n("9da27020aa");e.exports=o.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function r(e){var o=e;return t&&(n.setAttribute("href",o),o=n.href),n.setAttribute("href",o),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=r(window.location.href),function(t){var n=o.isString(t)?r(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0}},"3ec7c50a43":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CancellationTokenSource=void 0;var o=n("5c54996c0f"),r=function(){function e(){this.isCancelled=!1}return e.prototype.cancel=function(){this.isCancelled||(this.isCancelled=!0)},Object.defineProperty(e.prototype,"isCancellationRequested",{get:function(){return this.isCancelled},enumerable:!1,configurable:!0}),e}(),i=function(){function e(){this.innertoken=void 0}return Object.defineProperty(e.prototype,"token",{get:function(){return this.innertoken||(this.innertoken=new r),this.innertoken},enumerable:!1,configurable:!0}),e.prototype.cancel=function(){this.innertoken?this.innertoken instanceof r&&this.innertoken.cancel():this.innertoken=o.CancellationTokenState.Cancelled},e.prototype.dispose=function(){this.cancel()},e}();t.CancellationTokenSource=i},"3f7ebe22ef":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n("80d00c6e70");Object.defineProperty(t,"FeatureMessageCenter",{enumerable:!0,get:function(){return o.FeatureMessageCenter}})},"41c8f4a4e5":function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.hasOwnProperty.call(e,n)&&o(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.WebsocketManager=void 0;var s=i(n("485113c819")),a=n("cdda668c2b"),c=n("740addaa0b"),u=function(){function e(e){var t=this;this.options=e,this.socket=null,this.socketStatus=0,this.handleConnect=function(){c.ConnectionLog.info("socket io connect readyState: "+t.socket.io.readyState+", id:"+t.socket.id),t.options.featureMessageCenterReceiver.onConnect()},this.handleError=function(e){c.ConnectionLog.info("socket io error, type:"+(null==e?void 0:e.type)+", message:"+(null==e?void 0:e.message)+", description:"+(null==e?void 0:e.description)),t.disConnect(a.JsonUtil.jsonStringify(e)+" socket io error Closed by client.")},this.handleReconnectFailed=function(e){c.ConnectionLog.info("socket io reconnect_failed"),t.disConnect(a.JsonUtil.jsonStringify(e)+" reconnect_failed Closed by client.")},this.handleConnectFailed=function(e){c.ConnectionLog.info("socket io connect_failed"),t.disConnect(a.JsonUtil.jsonStringify(e)+"  connect_failed Closed by client.")},this.handleMessageFromServerPush=function(e){t.options.featureMessageCenterReceiver.onGetMessageFromServerPush(e)},this.handlePost=function(e){var n,o;null===(o=(n=t.options.featureMessageCenterReceiver).onPostFromServer)||void 0===o||o.call(n,e)}}return e.prototype.dispose=function(){this.disConnectSocket()},e.prototype.connect=function(){var e=s.default("wss://"+this.options.host,{query:{gtag:this.options.gtag},transports:s.DEFAULT_TRANSPORT_MODE,reconnection:!0,reconnectionAttempts:10,reconnectionDelay:s.WEBSOCKET_CONFIG.reconnectionDelay,reconnectionDelayMax:s.WEBSOCKET_CONFIG.reconnectionDelayMax,randomizationFactor:s.WEBSOCKET_CONFIG.randomizationFactor,timeout:s.WEBSOCKET_CONFIG.connectTimeout,path:"/socket.io"});this.socket=e,this.socket?(this.socket.on("get",this.handleMessageFromServerPush),this.socket.on("post",this.handlePost),this.socket.on("connect",this.handleConnect),this.socket.on("connect_failed",this.handleConnectFailed),this.socket.on("error",this.handleError),this.socket.on("reconnect_failed",this.handleReconnectFailed)):c.ConnectionLog.warn("socket is null")},e.prototype.disConnect=function(e){c.ConnectionLog.info("socket io disconnect reason: "+e),this.disConnectSocket(),this.options.featureMessageCenterReceiver.onConnectFail()},e.prototype.sendMessage=function(e){e&&this.socket&&this.socket.emit("post",e)},e.prototype.disConnectSocket=function(){this.socket&&(this.socket.disconnect(),this.socket=null)},e}();t.WebsocketManager=u},"42ee45218a":function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n("8d1b55641a"),t)},"44f185c0a0":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BuildBigCollabChannel=t.BigCollabChannel=void 0;var o=n("cdda668c2b"),r=n("147e28b86b"),i=n("3829c8d1f6"),s=n("a5b778a02f"),a=function(){function e(e,t){this.tag="BigCollabChannel",this.connectStatusManager=new i.ConnectStatusManager(e,t),this.messageCenter=new s.MessageCenter(e,t,this.connectStatusManager)}return e.prototype.dispose=function(){this.connectStatusManager.dispose(),this.messageCenter.dispose()},e.prototype.connect=function(){o.ConnectionLog.info(this.tag+" connect"),this.connectStatusManager.connect()},e.prototype.isConnected=function(){return this.connectStatusManager.isConnected()},e.prototype.isDisconnected=function(){return this.connectStatusManager.isDisconnected()},e.prototype.disconnect=function(e){o.ConnectionLog.error(this.tag+" disconnect, shutdown:"+e.shutDown+", errCode:"+e.errCode+" reason:"+e.reason),this.connectStatusManager.disconnect(e)},e.prototype.sendMessage=function(e){var t,n=e.taskId,o=e.cmd,i=e.data;this.connectStatusManager.isConnected()?this.messageCenter.sendMessage(e):null===(t=e.onError)||void 0===t||t.call(e,n,o,i,{errCode:this.connectStatusManager.isDisconnected()?r.RoomErrorCode.ROOM_SHUTDOWN:r.RoomErrorCode.ROOM_STATE_ERR,errMsg:"can not send message in this room state."})},e.prototype.cancelSendMessageByTaskId=function(e){var t,n;null===(n=(t=this.messageCenter).cancelSendMessageByTaskId)||void 0===n||n.call(t,e)},e}();t.BigCollabChannel=a;t.BuildBigCollabChannel=function(e,t){return new a(e,t)}},"45155de31c":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},"4649e19c41":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},"46509843e6":function(e,t,n){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectStatus=void 0,function(e){e.INIT="INIT",e.LOGIN="LOGIN",e.LOGIN_FAIL="LOGIN_FAIL",e.LOGINED="LOGINED",e.CONNECTED="CONNECTED",e.DISCONNECT="DISCONNECT",e.WAIT_RECONNECTING="WAIT_RECONNECTING"}(o||(o={})),t.ConnectStatus=o},"485113c819":function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||o(t,e,n)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=i(n("ab167130ca"));r(n("9c5a83385b"),t),r(n("b9e77a7da7"),t),t.default=s.default},"48a9511069":function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));class o{constructor(){this.hookRegistry=new Set}addHook(e,t){this.hookRegistry.add({hookPoint:e,callback:t})}executeHooks(e,t){this.hookRegistry.forEach((n=>{const{hookPoint:o,callback:r}=n;o===t&&r(e)}))}}},"493c9e859f":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},"49835f837f":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONNECT_DELAY_TIME=t.DELIMITER=t.ERROR_MESSAGE_INDEX=t.MAX_SERVER_REACHABLE_TIME=t.NOOP=t.PATH=void 0;t.PATH="/websocket/bind";t.NOOP="noop";t.DELIMITER="\r\n";t.MAX_SERVER_REACHABLE_TIME=45e3;t.CONNECT_DELAY_TIME=3e3;t.ERROR_MESSAGE_INDEX=[0,-1]},"4a7ec9f89e":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},"4abc89182b":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LimitFrequencyManager=void 0;var o=n("cdda668c2b"),r=n("825eafaa67"),i=n("80a1ca8977"),s=n("f4abd3e6e6"),a=function(){function e(e){this.dependency=e,this.limitFrequencyMessageMap=new Map,this.limitFrequencyMessageMap.set(s.USER_INOUT_TYPE,new s.UserInoutMessage(s.USER_INOUT_TYPE,i.MessagePriority.MIDDLE,this.dependency))}return e.prototype.dispose=function(){this.limitFrequencyMessageMap.clear(),this.reset()},e.prototype.reset=function(){this.memberCount=0},e.prototype.setPriority=function(e,t){this.limitFrequencyMessageMap.get(e)&&o.ConnectionLog.warn("LimitFrequencyManager type:"+e+" is exit."),this.limitFrequencyMessageMap.set(e,new r.LimitFrequencyMessage(e,t,this.dependency))},e.prototype.handleMessage=function(e){var t=this;this.updateMemberCount(e),this.limitFrequencyMessageMap.forEach((function(n){var o=e.head.type;n.shouldLimit(o)&&(null==n||n.handleMessage(e,t.getLimitFrequencyLevel(),t.memberCount))}))},e.prototype.updateMemberCount=function(e){var t,n,o,r,i;if(["USER_NEWINFO","USER_NEWINFOS","USER_LEAVE","USER_LEAVES"].includes(e.head.type)){var s=null!==(i=null!==(o=null===(n=null===(t=e.body)||void 0===t?void 0:t.notice)||void 0===n?void 0:n.mem_count)&&void 0!==o?o:null===(r=e.body)||void 0===r?void 0:r.mem_count)&&void 0!==i?i:0;this.memberCount=s}},e.prototype.getLimitFrequencyLevel=function(){return this.memberCount<=i.MIN_THRESHOLD?i.LimitFrequencyLevel.LOW:this.memberCount<=i.MIDDLE_THRESHOLD?i.LimitFrequencyLevel.MIDDLE:this.memberCount<=i.MAX_THRESHOLD?i.LimitFrequencyLevel.HIGH:i.LimitFrequencyLevel.HIGHEST},e}();t.LimitFrequencyManager=a},"4b7c121b83":function(e,t,n){"use strict";var o=n("9da27020aa");e.exports=function(e){return o.isObject(e)&&!0===e.isAxiosError}},"4baf8e9ea0":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RoomWebsocketMessageQueue=void 0;var o=n("147e28b86b"),r=n("cdda668c2b"),i=n("193c542c4e"),s=function(){function e(e){this.messageWaittingQueue=[],this.messageFinishQueue=[],this.messageSenderDependency=e}return e.prototype.dispose=function(){this.messageWaittingQueue=[],this.messageFinishQueue=[]},e.prototype.messageCount=function(){return this.messageWaittingQueue.length},e.prototype.messageAlreadyExist=function(e){var t=this.getMessageByTaskId(e.taskId);return(null==t?void 0:t.cmd)===e.cmd},e.prototype.getMessageByTaskId=function(e){return this.messageWaittingQueue.find((function(t){return t.taskId===e}))},e.prototype.getFinishedMessageByTaskId=function(e){return this.messageFinishQueue.find((function(t){return t.taskId===e}))},e.prototype.readyToSendMessage=function(){if(0===this.messageWaittingQueue.length)return r.ConnectionLog.info("readyToSendMessage: empty messageQueue"),!1;var e=this.messageWaittingQueue.find((function(e){return e.state===o.MessageState.SENDING}));return!e||(r.ConnectionLog.info("readyToSendMessage: message is sending, taskId:"+e.taskId+", cmd:"+e.cmd),!1)},e.prototype.addWaittingMessage=function(e){this.messageWaittingQueue.push(e)},e.prototype.addFinishMessage=function(e,t){void 0===t&&(t=-1),this.removeMessageFromQueue(e,t),this.messageFinishQueue.push(e)},e.prototype.removeMessageFromQueue=function(e,t){void 0===t&&(t=-1);var n=t>=0&&t<this.messageWaittingQueue.length?t:this.getIndexOfMessage(e);this.messageWaittingQueue.splice(n,1)},e.prototype.handleMessageQueueByRoomClose=function(e){for(var t=0;t<this.messageWaittingQueue.length;){var n=this.messageWaittingQueue[t];this.handleMessageByRoomClose(n,e),t+=1}},e.prototype.handleMessageByRoomClose=function(e,t){this.messageSenderDependency.doErrorCallback(e,{errCode:t?i.RoomErrorCode.ROOM_SHUTDOWN:i.RoomErrorCode.ROOM_CLOSE,errMsg:"room "+(t?"shutDown":"close")})},e.prototype.handleMsgBySocketDisconnect=function(){for(var e=0;e<this.messageWaittingQueue.length;){var t=this.messageWaittingQueue[e];t.retryCount>=t.maxRetryCount?(this.handleRetryCountLimitedMessageBySocketDisconnect(t),this.removeMessageFromQueue(t,e)):(this.handleMesageBySocketDisconnect(t),e+=1)}},e.prototype.getFirstWaittingMessage=function(){return this.messageWaittingQueue.find((function(e){return e.state===o.MessageState.WAITING}))},e.prototype.processMessageQueue=function(){for(var e=!1,t=!1,n=!1,r=0;r<this.messageWaittingQueue.length;){var i=this.messageWaittingQueue[r];this.sendingMsgIsTimeout(i)?(e=!0,i.retryCount<i.maxRetryCount?(this.retryMessageByTimeout(i),r+=1):this.handleRetryCountLimitedMessageByTimeout(i)):(t=i.state===o.MessageState.SENDING,n=i.state===o.MessageState.WAITING,r+=1)}return this.clearFinishQueueIfNeed(),!t&&n&&(e=!0),e},e.prototype.cancelMessage=function(e){for(var t=0;t<this.messageWaittingQueue.length;){var n=this.messageWaittingQueue[t];if(n.taskId===e)return r.ConnectionLog.info("cancelMessage: seq = "+e),this.addFinishMessage(n),n;t+=1}},e.prototype.clearFinishQueueIfNeed=function(){this.messageFinishQueue.length>50&&this.messageFinishQueue.splice(0,this.messageFinishQueue.length-50)},e.prototype.sendingMsgIsTimeout=function(e){var t=o.RoomUtil.getCurrentTime();return(e.state===o.MessageState.SENDING||e.state===o.MessageState.WAIT_ACCEPT)&&t>e.lastSendTime&&t-e.lastSendTime>e.timeout},e.prototype.handleRetryCountLimitedMessageBySocketDisconnect=function(e){this.messageIsSendingOrWaitAccept(e)&&this.messageSenderDependency.doErrorCallback(e,{errCode:i.RoomErrorCode.ROOM_DISCONNECT,errMsg:"room disconnect"})},e.prototype.handleMesageBySocketDisconnect=function(e){this.messageIsSendingOrWaitAccept(e)&&(e.state=o.MessageState.WAITING)},e.prototype.messageIsSendingOrWaitAccept=function(e){return e.state===o.MessageState.SENDING||e.state===o.MessageState.WAIT_ACCEPT},e.prototype.handleRetryCountLimitedMessageByTimeout=function(e){r.ConnectionLog.warn("send message timeout, taskId = "+e.taskId+", cmd = "+e.cmd+"."),e.retryCount=0,this.messageSenderDependency.closeAndDelayReopen({reason:"websocket send message timeout.",errCode:o.RoomWebsocketErrorCode.SOCKET_SEND_MESSAGE_TIMEOUT,shutDown:!1},0)},e.prototype.retryMessageByTimeout=function(e){r.ConnectionLog.warn("send message timeout, try again, taskId = "+e.taskId+",\n        cmd = "+e.cmd+", retryCount = "+e.retryCount+", maxRetryCount = "+e.maxRetryCount+", state = "+e.state),e.state=o.MessageState.WAITING},e.prototype.getIndexOfMessage=function(e){return this.messageWaittingQueue.findIndex((function(t){return t.taskId===e.taskId}))},e}();t.RoomWebsocketMessageQueue=s},"4bda62209d":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RoomStatus=void 0;var o=n("67db787303"),r=n("ebeebfcb4d"),i=n("cdda668c2b"),s=n("c0f85d03df"),a=function(){function e(e,t,n){this.roomState=s.RoomState.INIT,this.channelOption=t,this.connectionControllerDependency=n,this.messageSender=e,this.roomLogin=new o.RoomLogin(e,t,this),this.roomHeartBeat=new r.RoomHeartBeat(e,this.channelOption,this)}return Object.defineProperty(e.prototype,"state",{get:function(){return this.roomState},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){this.roomState=s.RoomState.INIT,this.roomHeartBeat.dispose(),this.roomLogin.dispose()},e.prototype.openRoom=function(){this.checkRoomState()&&(this.messageSender.openWebsocketConnection(),this.roomState===s.RoomState.INIT?this.setRoomState(s.RoomState.CONNECTING):this.setRoomState(s.RoomState.RECONNECTING_IN_CLOSED))},e.prototype.onRoomClosed=function(e){e.shutDown?this.handleShutDown(e):this.handleRoomClose(e)},e.prototype.loginRoom=function(){this.roomLogin.login()},e.prototype.resetLogin=function(){this.roomLogin.resetLogin()},e.prototype.onLoginResponse=function(e,t){this.roomLogin.onLoginResponse(e,t)},e.prototype.resetHeartBeat=function(){this.roomHeartBeat.resetHeartBeat()},e.prototype.onHeartBeatResponse=function(e,t){this.roomHeartBeat.onHeartBeatResponse(e,t)},e.prototype.roomStateReconnecting=function(){this.setRoomState(s.RoomState.CONNECTING)},e.prototype.getRoomState=function(){return this.state},e.prototype.notifyRoomOpened=function(e){this.setRoomState(s.RoomState.OPENED),this.resetLogin(),this.roomHeartBeat.resetHeartBeat();var t=e.response;this.roomHeartBeat.startHeartBeatOnTimer(t.onpost.heartbeat_interval),this.messageSender.startMessageSending(),this.messageSender.notifyRoomOpened(),this.connectionControllerDependency.connected()},e.prototype.checkRoomState=function(){return this.state!==s.RoomState.OPENED&&this.state!==s.RoomState.SHUTDOWN||(i.ConnectionLog.warn("checkRoomState:state is "+this.state+"!"),!1)},e.prototype.setRoomState=function(e,t){void 0===t&&(t=""),e!==this.roomState&&(this.roomState=e,i.ConnectionLog.info("setRoomState:set new state = "+e),this.connectionControllerDependency.connectedStateChange(this.roomState,t))},e.prototype.handleShutDown=function(e){var t=this.roomState;this.setRoomState(s.RoomState.SHUTDOWN,e.reason),t!==s.RoomState.SHUTDOWN&&this.connectionControllerDependency.disconnect(e)},e.prototype.handleRoomClose=function(e){var t=this.roomState;this.setRoomState(s.RoomState.RECONNECTING_IN_CLOSED,e.reason),t!==s.RoomState.RECONNECTING_IN_CLOSED&&this.connectionControllerDependency.disconnect(e)},e.prototype.heartBeatCommon=function(e){var t,n;null===(n=(t=this.connectionControllerDependency).heartBeatCommon)||void 0===n||n.call(t,e)},e}();t.RoomStatus=a},"4d185f5460":function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n("2f677d4277"),t),r(n("116005830b"),t),r(n("6e60483d27"),t)},"4e3a71edae":function(e,t,n){"use strict";var o=n("9da27020aa");e.exports=o.isStandardBrowserEnv()?{write:function(e,t,n,r,i,s){var a=[];a.push(e+"="+encodeURIComponent(t)),o.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),o.isString(r)&&a.push("path="+r),o.isString(i)&&a.push("domain="+i),!0===s&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},"4ece59fc57":function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectionController=void 0;var i=n("99cf54780e"),s=n("a6ef31917d"),a=n("9ab1857893"),c=n("4d185f5460"),u=n("cdda668c2b"),d=n("eee882e93f"),l=n("8645a705ed"),p=n("147e28b86b"),h=n("e75752bded"),f=n("d3a09514f9"),v=n("d3819be4ca"),g=function(){function e(e){var t,n=this;this.onConnectionEventEmitter=new a.Emitter,this.middleWareCenter=new v.MiddleWareCenter,this.connectionFireEvent=function(e,t){n.onConnectionEventEmitter.fire({event:e,data:t})},this.options=e,this.setConnectMode((null===(t=this.options.config)||void 0===t?void 0:t.connectMode)||l.ConnectMode.WEBSOCKET),this.onConnectionEvent=this.onConnectionEventEmitter.event,this.initDependencyEvent(),i.network.changeEnd(this.handleNetWorkChangeCallback.bind(this))}return e.prototype.dispose=function(){i.network.remove(this.handleNetWorkChangeCallback.bind(this)),this.onConnectionEventEmitter.dispose(),this.destoryChannel()},e.prototype.useMiddleWare=function(e,t){this.middleWareCenter.useMiddleWare(e,t)},e.prototype.connect=function(e){void 0===e&&(e=l.ConnectMode.WEBSOCKET),u.ConnectionLog.info("connect mode:"+e),this.setConnectMode(e),this.connectChannel(e)},e.prototype.reConnect=function(e,t){void 0===t&&(t=l.ConnectMode.WEBSOCKET),this.reconnect(e,t)},e.prototype.reconnect=function(e,t){void 0===t&&(t=l.ConnectMode.WEBSOCKET),u.ConnectionLog.warn("reconnect mode:"+t),e&&(this.options=e),this.destoryChannel(),this.setConnectMode(t),this.connectChannel(t)},e.prototype.isConnecting=function(){return this.isConnected()},e.prototype.isConnected=function(){return this.isWebsocketRoomState(p.RoomState.OPENED)||this.isUseBigCollabChannel()&&this.bigCollabChannel.isConnected()},e.prototype.isDisconnect=function(){return this.isDisconnected()},e.prototype.isDisconnected=function(){return this.isWebsocketRoomState(p.RoomState.SHUTDOWN)||this.isUseBigCollabChannel()&&this.bigCollabChannel.isDisconnected()},e.prototype.disconnect=function(e){var t,n;this.isDisconnected()?u.ConnectionLog.warn("was disconnect, please do not disconnect. new errCode:"+e.errCode):this.isUseBigCollabChannel()?null===(t=this.bigCollabChannelInstance)||void 0===t||t.disconnect(e):null===(n=this.websocketChannelInstance)||void 0===n||n.disconnect(e)},e.prototype.isOnline=function(){return i.network.isOnline},e.prototype.setVersion=function(e){s.isNumber(e)?this.version=e:u.ConnectionLog.error("setVersion version is not number")},e.prototype.sendMessage=function(e){if(u.isInvalidMessage(e))return u.ConnectionLog.warn("sendMessage fail: params invalid!"),void e.onError(e.taskId,e.cmd,e.data,{errCode:p.RoomErrorCode.PARA_ERROR,errMsg:"msg param invalid."});this.configMessageParam(e),this.isUseBigDataChannel(e)?this.bigDataChannel.sendMessage(e):this.isUseBigCollabChannel()?this.bigCollabChannel.sendMessage(e):this.websocketChannel.sendMessage(e)},e.prototype.sendCommonRequest=function(e){return o(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this.commonRequestChannel.sendMessage(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.batchCommitMessages=function(e,t,n){return o(this,void 0,void 0,(function(){return r(this,(function(o){return(null==e?void 0:e.length)?[2,this.bigDataChannel.batchCommitMessages(e,t,n)]:[2,this.handleMessagesError()]}))}))},e.prototype.cancelMessageBySeq=function(e){this.cancelSendMessageByTaskId(e)},e.prototype.cancelSendMessageByTaskId=function(e){var t,n,o,r;null===(n=null===(t=this.websocketChannelInstance)||void 0===t?void 0:t.cancelSendMessageByTaskId)||void 0===n||n.call(t,e),null===(r=null===(o=this.bigCollabChannelInstance)||void 0===o?void 0:o.cancelSendMessageByTaskId)||void 0===r||r.call(o,e)},e.prototype.handleMessagesError=function(){var e="batchCommitMessages message is null!";return u.ConnectionLog.warn(e),{success:!1,retCode:52001,reason:e}},Object.defineProperty(e.prototype,"bigDataChannel",{get:function(){return this.bigDataChannelInstance||(this.bigDataChannelInstance=c.BuildBigDataChannel(this.options,this.dependency)),this.bigDataChannelInstance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bigCollabChannel",{get:function(){return this.bigCollabChannelInstance||(this.bigCollabChannelInstance=f.BuildBigCollabChannel(this.options,this.dependency)),this.bigCollabChannelInstance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"websocketChannel",{get:function(){return this.websocketChannelInstance||(this.websocketChannelInstance=p.BuildRoomWebsocketChannel(this.options,this.dependency,this.middleWareCenter)),this.websocketChannelInstance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"commonRequestChannel",{get:function(){return this.commonRequestChannelInstance||(this.commonRequestChannelInstance=h.buildCommonRequestChannel(this.options)),this.commonRequestChannelInstance},enumerable:!1,configurable:!0}),e.prototype.handleNetWorkChangeCallback=function(e){var t,n,o,r;"online"===e?null===(n=(t=this.dependency).enterOnline)||void 0===n||n.call(t):null===(r=(o=this.dependency).enterOffline)||void 0===r||r.call(o)},e.prototype.isUseBigCollabChannel=function(){var e;return(null===(e=this.options.config)||void 0===e?void 0:e.connectMode)===l.ConnectMode.BIG_COLLAB},e.prototype.isUseBigDataChannel=function(e){var t,n=null===(t=this.options.config)||void 0===t?void 0:t.bigDataCommitConfig;if("USER_CHANGES"===e.cmd&&!0===(null==n?void 0:n.isSupportBigDataCommit)){var o=d.getMessageDataLength(e.data);if(o>((null==n?void 0:n.minContentLength)||5242880))return u.ConnectionLog.info("sendMessage BigData, length:"+o),!0}return!1},e.prototype.initDependencyEvent=function(){var e=this;this.dependency={enterOnline:function(){e.connectionFireEvent("OnEnterOnline")},enterOffline:function(){e.connectionFireEvent("OnEnterOffline")},connected:function(){e.connectionFireEvent("OnRoomOpen")},connectedStateChange:function(t,n){e.connectionFireEvent("OnRoomStateChange",{roomState:{roomState:t,description:n}})},receiveMessageFromServer:function(t,n){e.connectionFireEvent("OnReceiveMsgFromServer",{serverMsg:{type:t,data:n}})},networkReconnectedFail:function(){e.connectionFireEvent("OnNetReconnectedFail")},getHeaderGeneralPacket:function(){var t,n;return null!==(n=null===(t=e.options.config)||void 0===t?void 0:t.headerGeneralPacket)&&void 0!==n?n:{}},getVersion:function(){return e.version},disconnect:function(t){t.shutDown?e.connectionFireEvent("OnRoomShutDown",{closeReason:t}):e.connectionFireEvent("OnRoomClose",{closeReason:t})},heartBeatCommon:function(t){e.connectionFireEvent("onHeartBeatCommon",{heartBeatCommon:t})}}},e.prototype.isWebsocketRoomState=function(e){return!!this.websocketChannelInstance&&this.websocketChannel.getRoomState()===e},e.prototype.connectChannel=function(e){e!==l.ConnectMode.BIG_COLLAB?this.websocketChannel.connect():this.bigCollabChannel.connect()},e.prototype.destoryChannel=function(){var e,t,n,o;null===(e=this.websocketChannelInstance)||void 0===e||e.dispose(),this.websocketChannelInstance=void 0,null===(t=this.bigDataChannelInstance)||void 0===t||t.dispose(),this.bigDataChannelInstance=void 0,null===(n=this.commonRequestChannelInstance)||void 0===n||n.dispose(),this.commonRequestChannelInstance=void 0,null===(o=this.bigCollabChannelInstance)||void 0===o||o.dispose(),this.bigCollabChannelInstance=void 0},e.prototype.setConnectMode=function(e){this.options.config?this.options.config.connectMode=e:this.options.config={connectMode:e}},e.prototype.configMessageParam=function(e){var t,n;e.customParam?((null===(t=e.customParam)||void 0===t?void 0:t.timeout)&&(e.customParam.timeout=Math.min(e.customParam.timeout,3e4)),(null===(n=e.customParam)||void 0===n?void 0:n.maxRetryCount)&&(e.customParam.maxRetryCount=Math.min(e.customParam.maxRetryCount,d.DEFAULT_RETRY_COUNTS))):e.customParam={timeout:d.DEFAULT_SEND_MESSAGE_TIMEOUT,maxRetryCount:d.DEFAULT_RETRY_COUNTS}},e}();t.ConnectionController=g},"4f04e6c8a0":function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var o=n("fda8d8987d"),r=n("a1644e2245"),i=n("a282565e4f");class s{static has(e){return this.serviceIdsMap.has(e)}static get(e){return this.serviceIdsMap.get(e)}static set(e,t){this.serviceIdsMap.set(e,t)}}function a(e){if(s.has(e))return s.get(e);const t=function(e,n,s){if(3!==arguments.length)throw new Error(Object(i.r)(n));Object(o.a)(r.a,e,void 0,t,s)};return t.toLegacyString=()=>e,s.set(e,t),t}s.serviceIdsMap=new Map},"513019d975":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisposableNone=void 0,t.DisposableNone=Object.freeze({dispose:function(){}})},"551b953320":function(e,t,n){"use strict";var o,r;Object.defineProperty(t,"__esModule",{value:!0}),t.DocEditorError=t.DataEngineCodes=void 0,function(e){e[e.ERR_OK=0]="ERR_OK",e[e.ERR_UNSPECIFIED=601900]="ERR_UNSPECIFIED",e[e.ERR_TABLEKV_FAILED=601901]="ERR_TABLEKV_FAILED",e[e.ERR_DUPLICATED_KEY=601902]="ERR_DUPLICATED_KEY",e[e.ERR_OIDB=601903]="ERR_OIDB",e[e.ERR_CollabRevisionStoreErr=50001]="ERR_CollabRevisionStoreErr",e[e.ERR_GetRevisionFromSQLErr=50002]="ERR_GetRevisionFromSQLErr",e[e.ERR_BatchGetRevisionFromSQLErr=50003]="ERR_BatchGetRevisionFromSQLErr",e[e.ERR_COSPutObjectErr=50004]="ERR_COSPutObjectErr",e[e.ERR_COSGetObjectErr=50005]="ERR_COSGetObjectErr",e[e.ERR_CollabRevisionRecordStoreErr=50006]="ERR_CollabRevisionRecordStoreErr",e[e.ERR_DataEngineMetaStoreErr=50007]="ERR_DataEngineMetaStoreErr",e[e.ERR_GetMetaFromSQLErr=50008]="ERR_GetMetaFromSQLErr",e[e.ERR_GetRevisionRecordFromSQLErr=50009]="ERR_GetRevisionRecordFromSQLErr",e[e.ERR_DataEngineServerStopExpired=50010]="ERR_DataEngineServerStopExpired",e[e.ERR_RangeRevisionFromSQLErr=50011]="ERR_RangeRevisionFromSQLErr",e[e.ERR_GetDataEngineLockErr=50012]="ERR_GetDataEngineLockErr",e[e.ERR_EditBaseVersionWrongErr=50013]="ERR_EditBaseVersionWrongErr",e[e.ERR_DataEngineGetFileWrongVersion=50014]="ERR_DataEngineGetFileWrongVersion",e[e.ERR_GetRevisionRecordCountFromSQLErr=50015]="ERR_GetRevisionRecordCountFromSQLErr",e[e.ERR_SaveWatermarkToSQLErr=50016]="ERR_SaveWatermarkToSQLErr",e[e.ERR_GetWatermarkFromSQLErr=50017]="ERR_GetWatermarkFromSQLErr",e[e.ERR_RevisionRangeInvalidAttrs=50018]="ERR_RevisionRangeInvalidAttrs",e[e.ERR_GetRevisionsInvalidAttrs=50019]="ERR_GetRevisionsInvalidAttrs",e[e.ERR_DeduplicateRevisionsFail=50020]="ERR_DeduplicateRevisionsFail",e[e.ERR_CollabChangeRptMsgHpReqBodyEmpty=50021]="ERR_CollabChangeRptMsgHpReqBodyEmpty",e[e.ERR_DeduplicateCommitErr=50022]="ERR_DeduplicateCommitErr",e[e.ERR_DataEngineBrokenData=50023]="ERR_DataEngineBrokenData",e[e.ERR_GetMaxRevisionVersionFromSQLErr=50024]="ERR_GetMaxRevisionVersionFromSQLErr",e[e.ERR_SaveRevisionToSQLDuplicateErr=50025]="ERR_SaveRevisionToSQLDuplicateErr",e[e.ERR_NoCollabChangePrivilege=50026]="ERR_NoCollabChangePrivilege",e[e.ERR_NoAnnotatePrivilege=50027]="ERR_NoAnnotatePrivilege",e[e.ERR_COSGetPreSignedURLErr=50028]="ERR_COSGetPreSignedURLErr",e[e.ERR_DataEngineWrongTextType=50029]="ERR_DataEngineWrongTextType",e[e.ERR_DataEngineEmptyData=50030]="ERR_DataEngineEmptyData",e[e.ERR_ExecuteTimeOutErr=50031]="ERR_ExecuteTimeOutErr",e[e.ERR_DataEngineCgoCacheMiss=50032]="ERR_DataEngineCgoCacheMiss",e[e.ERR_CgoProtoToJSONErr=50033]="ERR_CgoProtoToJSONErr",e[e.ERR_CgoJSONToProtoErr=50034]="ERR_CgoJSONToProtoErr",e[e.ERR_CgoTransformErr=50035]="ERR_CgoTransformErr",e[e.ERR_MarshalPbLenZeroErr=50036]="ERR_MarshalPbLenZeroErr",e[e.ERR_CgoSetMaxCacheSizeErr=50037]="ERR_CgoSetMaxCacheSizeErr",e[e.ERR_CgoApplyRevisionsErr=50038]="ERR_CgoApplyRevisionsErr",e[e.ERR_CgoApplyRevisionsToSpecificKFErr=50039]="ERR_CgoApplyRevisionsToSpecificKFErr",e[e.ERR_CgoGetKeyframeErr=50040]="ERR_CgoGetKeyframeErr",e[e.ERR_CgoGetSpecificKeyframeErr=50041]="ERR_CgoGetSpecificKeyframeErr",e[e.ERR_MarshalPbErr=50042]="ERR_MarshalPbErr",e[e.ERR_CallCgoErr=50043]="ERR_CallCgoErr",e[e.ERR_DataEngineCtxCanceledErr=50044]="ERR_DataEngineCtxCanceledErr",e[e.ERR_UnmarshalPbErr=50045]="ERR_UnmarshalPbErr",e[e.ERR_CreateEmptyKeyframe=50046]="ERR_CreateEmptyKeyframe",e[e.ERR_CgoGetCacheSizeErr=50047]="ERR_CgoGetCacheSizeErr",e[e.ERR_TableKVGetWatermarkErr=50048]="ERR_TableKVGetWatermarkErr",e[e.ERR_TableKVSaveWatermarkErr=50049]="ERR_TableKVSaveWatermarkErr",e[e.ERR_TableKVSaveRevisionRecordErr=50050]="ERR_TableKVSaveRevisionRecordErr",e[e.ERR_TableKVGetRevisionRecordErr=50051]="ERR_TableKVGetRevisionRecordErr",e[e.ERR_TableKVBatchGetRevisionRecordErr=50052]="ERR_TableKVBatchGetRevisionRecordErr",e[e.ERR_TableKVCountRevisionRecordErr=50053]="ERR_TableKVCountRevisionRecordErr",e[e.ERR_TableKVSaveMetaErr=50054]="ERR_TableKVSaveMetaErr",e[e.ERR_TableKVGetMetaErr=50055]="ERR_TableKVGetMetaErr",e[e.ERR_TableKVMetaUpdateVersionInfoErr=50056]="ERR_TableKVMetaUpdateVersionInfoErr",e[e.ERR_TableKVMetaAddKeyFrameErr=50057]="ERR_TableKVMetaAddKeyFrameErr",e[e.ERR_TableKVBatchGetMetaErr=50058]="ERR_TableKVBatchGetMetaErr",e[e.ERR_TableKVSaveRevisionErr=50059]="ERR_TableKVSaveRevisionErr",e[e.ERR_TableKVGetRevisionErr=50060]="ERR_TableKVGetRevisionErr",e[e.ERR_TableKVGetRevisionRangeErr=50061]="ERR_TableKVGetRevisionRangeErr",e[e.ERR_TableKVBatchGetRevisionErr=50062]="ERR_TableKVBatchGetRevisionErr",e[e.ERR_TableKVGetRevisionMaxVerErr=50063]="ERR_TableKVGetRevisionMaxVerErr",e[e.ERR_TableKVBatchSaveRevisionErr=50064]="ERR_TableKVBatchSaveRevisionErr",e[e.ERR_CgoBuildCommandErr=50065]="ERR_CgoBuildCommandErr",e[e.ERR_CgoGetJSONFullTextErr=50066]="ERR_CgoGetJSONFullTextErr",e[e.ERR_DocVersionErr=50067]="ERR_DocVersionErr",e[e.ERR_CgoClearAllSensitiveDataErr=50068]="ERR_CgoClearAllSensitiveDataErr",e[e.ERR_TableKVGetSliceCountErr=50069]="ERR_TableKVGetSliceCountErr",e[e.ERR_FileHasAlreadyEdited=50070]="ERR_FileHasAlreadyEdited",e[e.ERR_SaveRevisionToTableKVDuplicateErr=50071]="ERR_SaveRevisionToTableKVDuplicateErr",e[e.ERR_CgoReplaceMentionErr=50072]="ERR_CgoReplaceMentionErr",e[e.ERR_CgoReplaceDocLinkErr=50073]="ERR_CgoReplaceDocLinkErr",e[e.ERR_CgoReplaceHyperlinkErr=50074]="ERR_CgoReplaceHyperlinkErr",e[e.ERR_CgoInsertCommentErr=50075]="ERR_CgoInsertCommentErr",e[e.ERR_CgoReplaceImageURLErr=50076]="ERR_CgoReplaceImageURLErr",e[e.ERR_CgoGetReplaceContentErr=50077]="ERR_CgoGetReplaceContentErr",e[e.ERR_OverSizeDoc=50078]="ERR_OverSizeDoc",e[e.ERR_RollbackToMeloDocErr=50079]="ERR_RollbackToMeloDocErr",e[e.ERR_EmptyMetaVersionInfo=50080]="ERR_EmptyMetaVersionInfo",e[e.ERR_InvalidGetHistoryRsp=50081]="ERR_InvalidGetHistoryRsp",e[e.ERR_OOXMLDocNoNeedToUpgrade=50082]="ERR_OOXMLDocNoNeedToUpgrade",e[e.ERR_ParaQuoteDoc=50083]="ERR_ParaQuoteDoc",e[e.ERR_IllegalCopy=50084]="ERR_IllegalCopy",e[e.ERR_UIDToTinyIDErr=50085]="ERR_UIDToTinyIDErr",e[e.ERR_InvalidUpgradeTinyID=50086]="ERR_InvalidUpgradeTinyID",e[e.ERR_COSDeleteObjectErr=50087]="ERR_COSDeleteObjectErr",e[e.ERR_UpgradeFileError=50088]="ERR_UpgradeFileError",e[e.ERR_TableKVGetMetaEmpty=50089]="ERR_TableKVGetMetaEmpty",e[e.ERR_DocDataCannotClone=50090]="ERR_DocDataCannotClone",e[e.ERR_DataEngineRangeStoreErr=50091]="ERR_DataEngineRangeStoreErr",e[e.ERR_CheckUserRangePrivilegeRspNil=50092]="ERR_CheckUserRangePrivilegeRspNil",e[e.ERR_CloneMetaFailedError=50093]="ERR_CloneMetaFailedError",e[e.ERR_CannotEditRangeError=50094]="ERR_CannotEditRangeError",e[e.ERR_CommitMissChangesContainRevert=50095]="ERR_CommitMissChangesContainRevert",e[e.ERR_PermissionRangeLengthZeroError=50096]="ERR_PermissionRangeLengthZeroError",e[e.ERR_GetRangePrivilegeRspNil=50097]="ERR_GetRangePrivilegeRspNil",e[e.ERR_TableKVNonLoginUserTicketErr=50098]="ERR_TableKVNonLoginUserTicketErr",e[e.ERR_InvalidVersion=50099]="ERR_InvalidVersion",e[e.ERR_EditValidateErr=50100]="ERR_EditValidateErr",e[e.ERR_TableKVSaveUpgradeVersionErr=50101]="ERR_TableKVSaveUpgradeVersionErr",e[e.ERR_TableKVGetUpgradeVersionErr=50102]="ERR_TableKVGetUpgradeVersionErr",e[e.ERR_TableKVGetUpgradeVersionEmpty=50103]="ERR_TableKVGetUpgradeVersionEmpty",e[e.ERR_TableKVDeleteMetaErr=50104]="ERR_TableKVDeleteMetaErr",e[e.ERR_TableKVDeleteRevisionErr=50105]="ERR_TableKVDeleteRevisionErr",e[e.ERR_TableKVDeleteRevisionRecordErr=50106]="ERR_TableKVDeleteRevisionRecordErr",e[e.ERR_TableKVDeleteWatermarkErr=50107]="ERR_TableKVDeleteWatermarkErr",e[e.ERR_TableKVDeleteUpgradeVersionErr=50108]="ERR_TableKVDeleteUpgradeVersionErr",e[e.ERR_GetRevisionRecordNotFound=502001]="ERR_GetRevisionRecordNotFound",e[e.ERR_GetRevisionRecordCountNotFound=502002]="ERR_GetRevisionRecordCountNotFound",e[e.ERR_GetWatermarkNotFound=502003]="ERR_GetWatermarkNotFound",e[e.ERR_GetChunkMetaNotFound=502004]="ERR_GetChunkMetaNotFound",e[e.ERR_GetChunksNotFound=502005]="ERR_GetChunksNotFound",e[e.ERR_GetTextAndLinksNotFound=502006]="ERR_GetTextAndLinksNotFound",e[e.ERR_InvalidRevertVersion=502007]="ERR_InvalidRevertVersion"}(o||(o={})),t.DataEngineCodes=o,function(e){e[e.DocEditorErrorPlaceholder=0]="DocEditorErrorPlaceholder",e[e.DocEditorErrorServerError=1e4]="DocEditorErrorServerError",e[e.DocEditorErrorMissParam=10001]="DocEditorErrorMissParam",e[e.DocEditorErrordVerNotSupport=10002]="DocEditorErrordVerNotSupport",e[e.BodyTooLargeError=60100]="BodyTooLargeError"}(r||(r={})),t.DocEditorError=r},"583c8654bd":function(e,t,n){"use strict";var o=n("6be3f76c90"),r=n("178f6c13df");e.exports=function(e,t){return e&&!o(t)?r(e,t):t}},"5adb739611":function(e,t,n){"use strict";(function(t){var o=n("9da27020aa"),r=n("148a547de9"),i=n("f9d31e5257"),s=n("992a7b5d2e"),a={"Content-Type":"application/x-www-form-urlencoded"};function c(e,t){!o.isUndefined(e)&&o.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var u,d={transitional:s,adapter:(("undefined"!=typeof XMLHttpRequest||void 0!==t&&"[object process]"===Object.prototype.toString.call(t))&&(u=n("21a1a32486")),u),transformRequest:[function(e,t){return r(t,"Accept"),r(t,"Content-Type"),o.isFormData(e)||o.isArrayBuffer(e)||o.isBuffer(e)||o.isStream(e)||o.isFile(e)||o.isBlob(e)?e:o.isArrayBufferView(e)?e.buffer:o.isURLSearchParams(e)?(c(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):o.isObject(e)||t&&"application/json"===t["Content-Type"]?(c(t,"application/json"),function(e,t,n){if(o.isString(e))try{return(t||JSON.parse)(e),o.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional||d.transitional,n=t&&t.silentJSONParsing,r=t&&t.forcedJSONParsing,s=!n&&"json"===this.responseType;if(s||r&&o.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(s){if("SyntaxError"===e.name)throw i(e,this,"E_JSON_PARSE");throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};o.forEach(["delete","get","head"],(function(e){d.headers[e]={}})),o.forEach(["post","put","patch"],(function(e){d.headers[e]=o.merge(a)})),e.exports=d}).call(this,n("6c0cbd9268"))},"5c1e4c92a1":function(e,t,n){"use strict";var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},o.apply(this,arguments)},r=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BuildRoomWebsocketChannel=t.RoomWebsocketChannel=void 0;var a=n("4bda62209d"),c=n("aceb389a01"),u=n("1eb2641e35"),d=s(n("751778941b")),l=n("9c5a83385b"),p=function(){function e(e,t){this.padInfo=e,this.roomDependency=t,this.websocketMessageSender=new c.RoomWebsocketMessageSender(this.padInfo,this.roomDependency,this),this.roomStatus=new a.RoomStatus(this.websocketMessageSender,o({},this.padInfo),this.roomDependency)}return e.prototype.connect=function(){this.websocketMessageSender.openWebsocketConnection()},e.prototype.disconnect=function(e){var t,n,o={module:this.padInfo.module,attrName:String(null!==(t=e.errCode)&&void 0!==t?t:0),status:1,errorMessage:u.RoomUtil.getWebsocketChannelErrorMessage(null!==(n=e.errCode)&&void 0!==n?n:0)};this.websocketMessageSender.shutDown(e),d.default.shutDownReport(o)},e.prototype.dispose=function(){this.websocketMessageSender.dispose(),this.roomStatus.dispose()},e.prototype.sendMessage=function(e){this.websocketMessageSender.sendMessage(e)},e.prototype.batchCommitMessages=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(e){return[2,{success:!1,retCode:52002,reason:"websocket not support batch commit."}]}))}))},e.prototype.cancelSendMessageByTaskId=function(e){this.websocketMessageSender.cancelSendMessageByTaskId(e)},e.prototype.openRoom=function(){this.roomStatus.openRoom()},e.prototype.onRoomClosed=function(e){this.roomStatus.onRoomClosed(e)},e.prototype.roomStateReconnecting=function(){this.roomStatus.roomStateReconnecting()},e.prototype.getRoomState=function(){return this.roomStatus.getRoomState()},e.prototype.loginRoom=function(){this.roomStatus.loginRoom()},e.prototype.onLoginResponse=function(e,t){this.roomStatus.onLoginResponse(e,t)},e.prototype.resetLogin=function(){this.roomStatus.resetLogin()},e.prototype.onHeartBeatResponse=function(e,t){this.roomStatus.onHeartBeatResponse(e,t)},e.prototype.resetHeartBeat=function(){this.roomStatus.resetHeartBeat()},e}();t.RoomWebsocketChannel=p,t.BuildRoomWebsocketChannel=function(e,t,n){var o,r,i,s,a,c,u={module:e.module,padId:e.serverVars.padId,globalPadId:e.serverVars.globalPadId,codeVer:null!==(o=e.serverVars.pver)&&void 0!==o?o:0,gray:null!==(r=e.serverVars.gray)&&void 0!==r?r:0,dver:e.serverVars.dver,pver:e.serverVars.pver,apId:e.serverVars.apid,wmode:null!==(i=e.serverVars.wmode)&&void 0!==i?i:l.DEFAULT_WMODE,padType:e.serverVars.padType,websocketReopenCount:null!==(s=e.serverVars.websocketReopenCount)&&void 0!==s?s:l.WEBSOCKET_CONFIG.pollingReopenCount,pollingAttemptNumber:null!==(a=e.serverVars.pollingAttemptNumber)&&void 0!==a?a:l.WEBSOCKET_CONFIG.pollingAttemptCount,upid:e.serverVars.client.upid,sid:e.serverVars.client.sid,tid:e.serverVars.client.tid,sig:e.serverVars.client.sig,uid:e.uid,uuId:e.userid,userId:e.userid,nowUserIndex:null!==(c=e.nowUserIndex)&&void 0!==c?c:window.nowUserIndex,middleWareCenter:n,config:e.config};return new p(u,t)}},"5c54996c0f":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isCancellationToken=t.CancellationTokenState=void 0;var o=function(){function e(){}return e.None=Object.freeze({isCancellationRequested:!1}),e.Cancelled=Object.freeze({isCancellationRequested:!0}),e}();t.CancellationTokenState=o,t.isCancellationToken=function(e){return e===o.None||e===o.Cancelled||!(!e||"object"!=typeof e)&&"boolean"==typeof e.isCancellationRequested}},"5d1be1397d":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RetCode=t.HttpStatus=t.Method=void 0;var o,r=n("cf3c69206c");Object.defineProperty(t,"Method",{enumerable:!0,get:function(){return r.Method}}),Object.defineProperty(t,"HttpStatus",{enumerable:!0,get:function(){return r.HttpStatus}}),function(e){e[e.SUCCESS=0]="SUCCESS"}(o||(o={})),t.RetCode=o},"5fc26b30d4":function(e,t,n){var o,r,i;!function(s,a){"use strict";r=[n("d9e8a1cab8")],void 0===(i="function"==typeof(o=function(e){var t=/(^|@)\S+:\d+/,n=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(e){if(void 0!==e.stacktrace||void 0!==e["opera#sourceloc"])return this.parseOpera(e);if(e.stack&&e.stack.match(n))return this.parseV8OrIE(e);if(e.stack)return this.parseFFOrSafari(e);throw new Error("Cannot parse given Error object")},extractLocation:function(e){if(-1===e.indexOf(":"))return[e];var t=/(.+?)(?::(\d+))?(?::(\d+))?$/.exec(e.replace(/[()]/g,""));return[t[1],t[2]||void 0,t[3]||void 0]},parseV8OrIE:function(t){return t.stack.split("\n").filter((function(e){return!!e.match(n)}),this).map((function(t){t.indexOf("(eval ")>-1&&(t=t.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var n=t.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),o=n.match(/ (\(.+\)$)/);n=o?n.replace(o[0],""):n;var r=this.extractLocation(o?o[1]:n),i=o&&n||void 0,s=["eval","<anonymous>"].indexOf(r[0])>-1?void 0:r[0];return new e({functionName:i,fileName:s,lineNumber:r[1],columnNumber:r[2],source:t})}),this)},parseFFOrSafari:function(t){return t.stack.split("\n").filter((function(e){return!e.match(o)}),this).map((function(t){if(t.indexOf(" > eval")>-1&&(t=t.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),-1===t.indexOf("@")&&-1===t.indexOf(":"))return new e({functionName:t});var n=/((.*".+"[^@]*)?[^@]*)(?:@)/,o=t.match(n),r=o&&o[1]?o[1]:void 0,i=this.extractLocation(t.replace(n,""));return new e({functionName:r,fileName:i[0],lineNumber:i[1],columnNumber:i[2],source:t})}),this)},parseOpera:function(e){return!e.stacktrace||e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length?this.parseOpera9(e):e.stack?this.parseOpera11(e):this.parseOpera10(e)},parseOpera9:function(t){for(var n=/Line (\d+).*script (?:in )?(\S+)/i,o=t.message.split("\n"),r=[],i=2,s=o.length;i<s;i+=2){var a=n.exec(o[i]);a&&r.push(new e({fileName:a[2],lineNumber:a[1],source:o[i]}))}return r},parseOpera10:function(t){for(var n=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,o=t.stacktrace.split("\n"),r=[],i=0,s=o.length;i<s;i+=2){var a=n.exec(o[i]);a&&r.push(new e({functionName:a[3]||void 0,fileName:a[2],lineNumber:a[1],source:o[i]}))}return r},parseOpera11:function(n){return n.stack.split("\n").filter((function(e){return!!e.match(t)&&!e.match(/^Error created at/)}),this).map((function(t){var n,o=t.split("@"),r=this.extractLocation(o.pop()),i=o.shift()||"",s=i.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0;i.match(/\(([^)]*)\)/)&&(n=i.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var a=void 0===n||"[arguments not available]"===n?void 0:n.split(",");return new e({functionName:s,args:a,fileName:r[0],lineNumber:r[1],columnNumber:r[2],source:t})}),this)}}})?o.apply(t,r):o)||(e.exports=i)}()},"601e8bbc18":function(e,t,n){"use strict";var o=n("9da27020aa"),r=n("c9b7c5690f"),i=n("ea59e4d4bf"),s=n("5adb739611"),a=n("2f925fe3c3");function c(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new a("canceled")}e.exports=function(e){return c(e),e.headers=e.headers||{},e.data=r.call(e,e.data,e.headers,e.transformRequest),e.headers=o.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),o.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||s.adapter)(e).then((function(t){return c(e),t.data=r.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return i(t)||(c(e),t&&t.response&&(t.response.data=r.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},"6064ce49c9":function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},o(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return s},s=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0}),t.mixinRootDisposable=t.mixinDisposable=t.Disposable=t.RootDisposable=void 0;var a=n("6cac31cea5"),c=n("6bb936b136"),u=n("88476f9607"),d=function(){function e(){this.disposedStore=new u.DisposableStore}return e.prototype.dispose=function(e){this.disposedStore.dispose(e)},e.prototype._register=function(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this.disposedStore.add(e)},e}(),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.dispose=function(t){var n=t,o=!1;if(!n){var r=this.constructor.name;n=a.DisposeTrace.traceRoot(r),o=!0}e.prototype.dispose.call(this,n),o&&n.stop()},t.prototype._register=function(t){return e.prototype._register.call(this,t)},t}(d);t.RootDisposable=l;var p=function(e){function t(){var t=e.call(this)||this;return c.trackDisposable(t),t}return r(t,e),t.prototype.dispose=function(t){c.markTracked(this),e.prototype.dispose.call(this,t)},t}(d);t.Disposable=p,t.mixinDisposable=function(e){return function(e){function t(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var o=e.apply(this,s(t))||this;return o.disposedStore=new u.DisposableStore,c.trackDisposable(o),o}return r(t,e),t.prototype.dispose=function(e){c.markTracked(this),this.disposedStore.dispose(e)},t.prototype._register=function(e){return this.disposedStore.add(e)},t}(e)},t.mixinRootDisposable=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.disposedStore=new u.DisposableStore,t}return r(t,e),t.prototype.dispose=function(e){c.markTracked(this);var t=e,n=!1;if(!t){var o=this.constructor.name;t=a.DisposeTrace.traceRoot(o),n=!0}this.disposedStore.dispose(t),n&&t.stop()},t.prototype._register=function(e){return this.disposedStore.add(e)},t}(e)}},"60e8a8f162":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createMessageHead=void 0;var o=n("96ed841b55"),r=n("c5556536fb");t.createMessageHead=function(e,t){var n,i,s=t.baseRev,a=t.taskId,c=t.command,u=t.additionalFieldsToHead,d=t.getHeaderGeneralPacket,l=e.serverVars,p=e.nowUserIndex,h=Number(e.userid.startsWith("g")),f={type:c,uid:e.uid||e.userid.replace("p.","").replace("g.",""),task_id:a,session_type:h,u:null!=p?p:window.nowUserIndex,base_rev:s,generalpacket:d,apid:l.apid,docid:l.globalPadId,code_ver:null!==(n=l.pver)&&void 0!==n?n:0,gray:null!==(i=l.gray)&&void 0!==i?i:0,dver:l.dver,docs_type:l.padType,wl:o.Cookie.get("wl"),cookie:o.getCookieForMessage()};return f=Object.assign(null!=u?u:{},f),r.JsonUtil.jsonStringify(f)}},"6372fb3a1c":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateMessageTaskId=t.generateUuid=void 0;t.generateUuid=function(e,t){return t?e+t.slice(0,5):e};t.generateMessageTaskId=function(){return Math.ceil(0x4189374bc6a7f0*Math.random())}},"67db787303":function(e,t,n){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RoomLogin=void 0;var r=n("cdda668c2b"),i=n("1eb2641e35"),s=n("c0f85d03df"),a=n("193c542c4e"),c=o(n("751778941b")),u=[a.RoomWebsocketErrorCode.SOCKET_COLLAB_ROOM_TIMEOUT,a.RoomWebsocketErrorCode.SOCKET_COLLAB_SERVER_TIMEOUT,a.RoomWebsocketErrorCode.SOCKET_SERVER_STORAGE_TIMEOUT,a.RoomWebsocketErrorCode.SOCKET_SERVER_CGI_TIMEOUT,a.RoomWebsocketErrorCode.SOCKET_FREQUENCY_LIMIT,a.RoomWebsocketErrorCode.SOCKET_GET_PRIVILEGE_TIMEOUT],d=[a.RoomWebsocketErrorCode.SOCKET_LAYER_ERROR,a.RoomWebsocketErrorCode.SOCKET_CLIENT_NOT_READY_ERROR],l=function(){function e(e,t,n){this.loginCount=0,this.delayLoginTimer=0,this.loginSeq=0,this.loginTimeout=0,this.loginTime=0,this.messageSender=e,this.channelOption=t,this.roomStatusDependency=n}return e.prototype.dispose=function(){this.resetLoginAll()},e.prototype.login=function(){this.isConnected()?this.loginInternal():r.ConnectionLog.info("loginRoom: not connected!")},e.prototype.resetLoginAll=function(){this.resetServerErrorInfo(),this.resetLogin()},e.prototype.resetServerErrorInfo=function(){this.serverErrorInfo=void 0},e.prototype.resetLogin=function(){var e;(null===(e=this.serverErrorInfo)||void 0===e?void 0:e.preventResetLoginCount)||(this.loginCount=0),this.loginSeq=0,this.loginTimeout&&(clearTimeout(this.loginTimeout),this.loginTimeout=0),this.delayLoginTimer&&(clearTimeout(this.delayLoginTimer),this.delayLoginTimer=0)},e.prototype.onLoginResponse=function(e,t){if("CLIENT_READY"===e.type){var n={errCode:a.RoomErrorCode.SUCCESS,errMsg:"",response:t};this.handleLoginResponse(e.task_id,e.type,n)}},e.prototype.isConnected=function(){return this.messageSender.isConnected()},e.prototype.loginInternal=function(){var e,t,n,o,s=this;this.loginTimeout&&(clearTimeout(this.loginTimeout),this.loginTimeout=0),this.loginCount+=1,this.loginSeq=r.generateMessageTaskId();var c={roomType:"padpage",roomName:"padpage/"+this.channelOption.globalPadId,upid:null!==(e=this.channelOption.upid)&&void 0!==e?e:"",gid:this.channelOption.globalPadId,sid:this.channelOption.sid,tid:this.channelOption.tid,sig:this.channelOption.sig,data:{stats:this.getStats()}};r.ConnectionLog.info("loginRoom: CLIENT_READY, taskId: "+this.loginSeq);var u=null!==(n=null===(t=this.channelOption.config)||void 0===t?void 0:t.customLoginMsgOptions)&&void 0!==n?n:c;this.loginPostData=this.messageSender.createPostData("CLIENT_READY",this.loginSeq,r.JsonUtil.jsonStringify(u),null===(o=this.channelOption.config)||void 0===o?void 0:o.loginAdditionalHead),this.messageSender.postMessageWithWebsocket(this.loginPostData),this.loginTime=i.RoomUtil.getCurrentTime(),this.loginTimeout=setTimeout((function(){r.ConnectionLog.warn("loginRoom: time out, seq = "+s.loginSeq);var e={errCode:a.RoomErrorCode.TIMEOUT,errMsg:"login room time out."};s.handleLoginResponse(s.loginSeq,"CLIENT_READY",e)}),3e3)},e.prototype.handleLoginResponse=function(e,t,n){this.loginTimeout&&(clearTimeout(this.loginTimeout),this.loginTimeout=0);var o={errCode:0,errMsg:"",event:s.MessageResultEvent.ON_POST,needRetry:!1};if(this.checkLoginResult(n)?(this.roomStatusDependency.notifyRoomOpened(n),o.errCode=n.response.onpost.result,this.resetLoginAll()):this.handleLoginResponseFail(n,o),0!==o.errCode){o.errMsg=i.RoomUtil.getWebsocketChannelErrorMessage(o.errCode);var r={module:this.channelOption.module,cmd:"CLIENT_READY",attrName:String(n.errCode||n.response.onpost.result),status:1,errorMessage:o.errMsg};c.default.loginRoomError(r)}},e.prototype.checkLoginResult=function(e){var t,n;return 0===e.errCode&&(0===(null===(n=null===(t=e.response)||void 0===t?void 0:t.onpost)||void 0===n?void 0:n.result)||e.response.onpost.result===a.RoomWebsocketErrorCode.SOCKET_COLLAB_ROOM_ALREADY_EXIST)},e.prototype.handleLoginResponseFail=function(e,t){0!==e.errCode?(r.ConnectionLog.info("handleLoginFailed: client error, code = "+e.errCode+"."),this.loginCount>=3?(r.ConnectionLog.info("handleLoginFailed: login count = "+this.loginCount+"."),this.resetLogin(),this.messageSender.closeAndDelayReopen({reason:i.RoomUtil.getWebsocketChannelErrorMessage(e.errCode),shutDown:!1},0),t.needRetry=!1):(this.delayLogin(1500),t.needRetry=!0),t.errCode=e.errCode,t.event=s.MessageResultEvent.NET_STATUS_CHANGE):this.handleLoginResponseServerFail(e,t)},e.prototype.handleLoginResponseServerFail=function(e,t){var n=e.response.onpost.result;t.errCode=n;var o={errCode:n,reason:i.RoomUtil.getWebsocketChannelErrorMessage(n,"login failed."),shutDown:!1};if(r.ConnectionLog.info("handleLoginResponseSvrFail: errCode = "+n),this.updateServerErrorInfo(n),this.loginCount<3){if(u.includes(n))return this.handleLoginRetry(e,t);if(d.includes(n))return this.messageSender.closeAndDelayReopen(o,0)}this.shutdownByServerFailure(o,t)},e.prototype.shutdownByServerFailure=function(e,t){this.resetLoginAll(),e.shutDown=!0,this.messageSender.shutDown(e),t.needRetry=!1},e.prototype.handleLoginRetry=function(e,t){var n,o,r,s=e.response.onpost.result,c={errCode:s,reason:i.RoomUtil.getWebsocketChannelErrorMessage(s,"login failed."),shutDown:!1};if(this.loginCount>=3)this.resetLogin(),s===a.RoomWebsocketErrorCode.SOCKET_AUTH_TIMEOUT&&this.messageSender.closeAndDelayReopen(c,0),t.needRetry=!1;else{var u=null!==(r=null===(o=null===(n=null==e?void 0:e.response)||void 0===n?void 0:n.onpost)||void 0===o?void 0:o.retry_interval)&&void 0!==r?r:this.delayLoginTime;this.delayLogin(u),t.needRetry=!0}},e.prototype.updateServerErrorInfo=function(e){var t;(null===(t=this.serverErrorInfo)||void 0===t?void 0:t.preErrorCode)===e?this.serverErrorInfo.preventResetLoginCount=!0:(this.serverErrorInfo={preErrorCode:e,preventResetLoginCount:!1},this.loginCount=0)},e.prototype.delayLogin=function(e){var t=this;this.delayLoginTimer=setTimeout((function(){t.login()}),e)},e.prototype.getStats=function(){return{screen:""}},e}();t.RoomLogin=l},"686df8963b":function(e,t,n){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.MessageClassification=t.MessageSendType=void 0,function(e){e.SERIAL="SERIAL",e.PARALLEL="PARALLEL"}(o=t.MessageSendType||(t.MessageSendType={}));var r=function(){function e(e){void 0===e&&(e=[]),this.messageClassfyMap=new Map(e)}return e.prototype.setMessageSendType=function(e,t){this.messageClassfyMap.set(e,t)},e.prototype.getMessageSendType=function(e){var t;return null!==(t=this.messageClassfyMap.get(e))&&void 0!==t?t:o.SERIAL},e}();t.MessageClassification=r},"6a0d65af8f":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n("193c542c4e"),r=n("271684415e"),i=function(){function e(e){var t=this;this.dependency=e,this.disconnect=function(){t.dependency.disconnect({reason:"close by client, beforeunload",shutDown:!1,errCode:o.RoomErrorCode.ROOM_CLOSE,reconnectTime:r.PAGE_UNLOAD_TIME})},this.addBeforeunloadListener(this.disconnect)}return e.prototype.addBeforeunloadListener=function(e){window.addEventListener("beforeunload",e)},e}();t.default=i},"6b22a60341":function(e,t,n){"use strict";var o=n("9da27020aa"),r=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,n,i,s={};return e?(o.forEach(e.split("\n"),(function(e){if(i=e.indexOf(":"),t=o.trim(e.substr(0,i)).toLowerCase(),n=o.trim(e.substr(i+1)),t){if(s[t]&&r.indexOf(t)>=0)return;s[t]="set-cookie"===t?(s[t]?s[t]:[]).concat([n]):s[t]?s[t]+", "+n:n}})),s):s}},"6bb936b136":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.trackDisposable=t.markTracked=t.disableDisposablesTrack=t.enableDisposablesTrack=void 0;var o=n("513019d975"),r=!1,i="__is_disposable_tracked__";t.enableDisposablesTrack=function(){r=!0},t.disableDisposablesTrack=function(){r=!1},t.markTracked=function(e){if(r&&e&&e!==o.DisposableNone)try{e[i]=!0}catch(e){}},t.trackDisposable=function(e){if(!r)return e;e[i]||(e[i]=!1);var t=new Error("Potentially leaked disposable").stack;return setTimeout((function(){e[i]||console.log(t)}),3e3),e}},"6be3f76c90":function(e,t,n){"use strict";e.exports=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}},"6cac31cea5":function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},o(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return s};Object.defineProperty(t,"__esModule",{value:!0}),t.DisposeTrace=t.disableDisposeTrace=t.enableDisposeTrace=void 0;var a=!1;t.enableDisposeTrace=function(){a=!0},t.disableDisposeTrace=function(){a=!1};var c=function(){function e(e){this.name=e,this._dep=[]}return e.traceRoot=function(t){return a?new e(t):e._None},e.prototype.branch=function(t){var n=new e(t);return this._dep.push([t,n]),n},e.prototype.stop=function(){var e=["dispose "+this.name,""+function e(t,n){var o,r,a=[],c=new Array(t+1).join("\t");try{for(var u=i(n._dep),d=u.next();!d.done;d=u.next()){var l=s(d.value,2),p=l[0],h=l[1];if(h){a.push(c+"dispose -> "+p);var f=e(t+1,h);f&&a.push(f)}else a.push(c+"dispose -> "+p)}}catch(e){o={error:e}}finally{try{d&&!d.done&&(r=u.return)&&r.call(u)}finally{if(o)throw o.error}}return a.join("\n")}(1,this)];console.log(e.join("\n"))},e._None=new(function(e){function t(){return e.call(this,null)||this}return r(t,e),t.prototype.stop=function(){},t.prototype.branch=function(){return this},t}(e)),e}();t.DisposeTrace=c},"6e60483d27":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},"6f60718a3f":function(e,t,n){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isWebOffice=t.appConfigInstance=void 0;var r=o(n("d7a2286b24"));t.appConfigInstance=r.default.getInstance(),t.isWebOffice=["weboffice","paas-weboffice"].includes(t.appConfigInstance.getConfig("domain"))},"70189fba97":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isInvalidWaitAcceptCmd=t.isInvalidMessage=void 0;var o=function(e){var t;return!(!e.onsendAccept||(null===(t=e.customParam)||void 0===t?void 0:t.waitAcceptCmd)&&"[object Array]"===Object.prototype.toString.call(e.customParam.waitAcceptCmd)&&0!==e.customParam.waitAcceptCmd.length)};t.isInvalidWaitAcceptCmd=o;t.isInvalidMessage=function(e){return function(e){return"USER_CHANGES"===e.cmd&&!e.onsendAccept}(e)||o(e)}},"740addaa0b":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initLogAndManager=t.ConnectionLog=void 0;var o={ConnectionLogModule:"ConnectionLog",liteReconnects:0,needSaveLog:function(){return o.liteReconnects<5},debug:function(){},info:function(){},warn:function(){},error:function(){}};t.ConnectionLog=o,t.initLogAndManager=function(e){e&&(o.debug=function(t){var n;o.needSaveLog()&&(null===(n=e.debug)||void 0===n||n.call(e,o.ConnectionLogModule,t))},o.info=function(t){var n;o.needSaveLog()&&(null===(n=e.info)||void 0===n||n.call(e,o.ConnectionLogModule,t))},o.warn=function(t){var n;o.needSaveLog()&&(null===(n=e.warn)||void 0===n||n.call(e,o.ConnectionLogModule,t))},o.error=function(t){var n;o.needSaveLog()&&(null===(n=e.error)||void 0===n||n.call(e,o.ConnectionLogModule,t))})}},"751778941b":function(e,t,n){"use strict";var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},o.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n("cdda668c2b"),i="big-collab",s=function(){function e(){try{if(!window.Aegis)return;this.aegis=new window.Aegis({id:"SDK-9818a6f1a4d99eacc267",hostUrl:{url:"https://galileotelemetry.tencent.com/collect"},version:window.__globalReleaseVersion,useAid:!0,speedSample:!1,reportApiSpeed:!1,reportAssetSpeed:!1,pagePerformance:!1,plugin:{pv:!1,aid:!0,error:!1,device:!1,close:!1,pagePerformance:!1,webVitals:!1,fId:!0,ie:!0,spa:!1,api:!1,apiSpeed:!1,assetSpeed:!1}})}catch(e){r.ConnectionLog.warn("CollabRoomReporter init error:"+(null==e?void 0:e.message))}}return e.prototype.loginRoomError=function(e){this.needToResetLastErrorCode(e)?this.resetLastErrorCode():(this.lastAttrName=e.attrName,this.reportToServer(o(o({},e),{source:"loginRoom"})))},e.prototype.commitError=function(e){this.needToResetLastErrorCode(e)?this.resetLastErrorCode():(this.lastAttrName=e.attrName,this.reportToServer(o(o({},e),{source:"commitError"})))},e.prototype.serverNotice=function(e){this.needToResetLastErrorCode(e)?this.resetLastErrorCode():(this.lastAttrName=e.attrName,this.reportToServer(o(o({},e),{source:"serverNotice"})))},e.prototype.shutDownReport=function(e){this.needToResetLastErrorCode(e)||e.attrName===this.lastAttrName?this.resetLastErrorCode():this.reportToServer(o(o({},e),{source:"shutDown"}))},e.prototype.reconnectReport=function(e){this.reportToServer(o(o({},e),{source:"reconnect",transports:i}))},e.prototype.retryRequestReport=function(e,t){this.reportToServer({attrName:e.name,module:t,errorMessage:e.message,status:1,source:"retryRequest",transports:i})},e.prototype.receiverParseError=function(e,t){this.reportToServer({attrName:"receiver-parse-error",module:t,errorMessage:e,status:1,source:"receiver-parse-error",transports:i})},e.prototype.reportSocketConnect=function(e){this.reportToServer(o(o({},e),{source:"socketConnect"}))},e.prototype.reportUserChannel=function(){this.reportToServer({attrName:"非编辑通道请求",status:0})},e.prototype.reportToServer=function(e){var t,n,o=e.module,r=void 0===o?"unknown":o,i=e.source,s=void 0===i?"":i,a=e.transports,c=void 0===a?"":a;null===(n=null===(t=this.aegis)||void 0===t?void 0:t.reportEvent)||void 0===n||n.call(t,{name:"collab",eventName:e.attrName,status:e.status,errorMessage:e.errorMessage,documentType:r,source:s,transports:c})},e.prototype.resetLastErrorCode=function(){this.lastAttrName=""},e.prototype.needToResetLastErrorCode=function(e){return!(null==e?void 0:e.attrName)||"0"===(null==e?void 0:e.attrName)},e}();t.default=new s},"763f20313f":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},"77e684763e":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n("a395430f42");Object.defineProperty(t,"Disposable",{enumerable:!0,get:function(){return o.Disposable}}),Object.defineProperty(t,"RootDisposable",{enumerable:!0,get:function(){return o.RootDisposable}}),Object.defineProperty(t,"mixinDisposable",{enumerable:!0,get:function(){return o.mixinDisposable}}),Object.defineProperty(t,"mixinRootDisposable",{enumerable:!0,get:function(){return o.mixinRootDisposable}});var r=n("dd1cfaf242");Object.defineProperty(t,"DisposableNone",{enumerable:!0,get:function(){return r.DisposableNone}});var i=n("8838f60498");Object.defineProperty(t,"markTracked",{enumerable:!0,get:function(){return i.markTracked}}),Object.defineProperty(t,"trackDisposable",{enumerable:!0,get:function(){return i.trackDisposable}}),Object.defineProperty(t,"enableDisposablesTrack",{enumerable:!0,get:function(){return i.enableDisposablesTrack}}),Object.defineProperty(t,"disableDisposablesTrack",{enumerable:!0,get:function(){return i.disableDisposablesTrack}});var s=n("95b75d217e");Object.defineProperty(t,"DisposeTrace",{enumerable:!0,get:function(){return s.DisposeTrace}}),Object.defineProperty(t,"enableDisposeTrace",{enumerable:!0,get:function(){return s.enableDisposeTrace}}),Object.defineProperty(t,"disableDisposeTrace",{enumerable:!0,get:function(){return s.disableDisposeTrace}});var a=n("08e718accf");Object.defineProperty(t,"toDisposable",{enumerable:!0,get:function(){return a.toDisposable}}),Object.defineProperty(t,"isDisposable",{enumerable:!0,get:function(){return a.isDisposable}}),Object.defineProperty(t,"dispose",{enumerable:!0,get:function(){return a.dispose}}),Object.defineProperty(t,"combinedDisposable",{enumerable:!0,get:function(){return a.combinedDisposable}}),Object.defineProperty(t,"tryToDispose",{enumerable:!0,get:function(){return a.tryToDispose}}),Object.defineProperty(t,"tryToMarkDispose",{enumerable:!0,get:function(){return a.tryToMarkDispose}});var c=n("1d73a1ebc4");Object.defineProperty(t,"DisposableStore",{enumerable:!0,get:function(){return c.DisposableStore}});var u=n("3ec7c50a43");Object.defineProperty(t,"CancellationTokenSource",{enumerable:!0,get:function(){return u.CancellationTokenSource}})},"78fef7d7c4":function(e,t,n){"use strict";var o=n("c7a12f3a4f");e.exports=function(e,t,n){var r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(o("Request failed with status code "+n.status,n.config,null,n.request,n)):e(n)}},"7a6008fb54":function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0}),t.Sender=void 0;var s=n("cd1340aeac"),a=n("5d1be1397d"),c=n("cf3c69206c"),u=n("eee882e93f"),d=function(){function e(e){this.dependency=e,this.requestId=0,this.retryTimerMap=new Map}return e.prototype.dispose=function(){this.clearAllRetryTimer()},e.prototype.sendMessage=function(e){return o(this,void 0,void 0,(function(){var t,n;return r(this,(function(o){switch(o.label){case 0:return t=this.createRequestConfig(e),[4,this.commitMessage(e,t)];case 1:return n=o.sent(),[4,this.handleCommitResult(e,n)];case 2:return[2,o.sent()]}}))}))},e.prototype.clearAllRetryTimer=function(){var e,t;try{for(var n=i(this.retryTimerMap.values()),o=n.next();!o.done;o=n.next()){var r=o.value;clearTimeout(r)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.retryTimerMap.clear()},e.prototype.createRequestConfig=function(e){return{timeout:e.timeout,maxRetry:u.DEFAULT_RETRY_COUNTS,contentType:c.ContentTypeValue.JSON}},e.prototype.commitMessage=function(e,t){return o(this,void 0,void 0,(function(){var n,o,i,c,u,d;return r(this,(function(r){switch(r.label){case 0:return n=this.dependency.getServerParams(),o=n.token,i=n.sid,c=n.routeKey,u="/websocket/save?routeKey="+c,d={routeKey:c,token:o,sid:i,syncCommit:e.syncCommit,requestId:this.requestId,head:e.postData.head,body:e.postData.body},this.requestId+=1,[4,(new s.Request).sendRequest(u,a.Method.POST,d,t)];case 1:return[2,r.sent()]}}))}))},e.prototype.handleCommitResult=function(e,t){var n;return o(this,void 0,void 0,(function(){var o;return r(this,(function(r){switch(r.label){case 0:return o=null===(n=t.data)||void 0===n?void 0:n.data,!t.error&&o?[3,2]:[4,this.retrySendMessage(e)];case 1:return[2,r.sent()];case 2:return[2,o]}}))}))},e.prototype.clearMessageRetryTimer=function(e){this.retryTimerMap.has(e.taskId)&&(clearTimeout(this.retryTimerMap.get(e.taskId)),this.retryTimerMap.delete(e.taskId))},e.prototype.retrySendMessage=function(e){return o(this,void 0,void 0,(function(){var t,n=this;return r(this,(function(i){return this.clearMessageRetryTimer(e),this.dependency.isConnected()?(t=this.getDelayDuration(e.retryCount),[2,new Promise((function(i){var s=setTimeout((function(){return o(n,void 0,void 0,(function(){var t;return r(this,(function(n){switch(n.label){case 0:return this.dependency.onMessageSending(e),[4,this.sendMessage(e)];case 1:return t=n.sent(),i(t),[2]}}))}))}),t);n.retryTimerMap.set(e.taskId,s)}))]):(this.dependency.onMessageWaiting(e),e.retryCount=0,[2])}))}))},e.prototype.getDelayDuration=function(e){return 1e3*Math.min(2*e,30)},e}();t.Sender=d},"7e2e5664bb":function(e,t,n){"use strict";var o=n("9da27020aa");function r(){this.handlers=[]}r.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},r.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},r.prototype.forEach=function(e){o.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=r},"7fe7469c29":function(e,t,n){"use strict";var o=n("9da27020aa"),r=n("f091811571"),i=n("fabb3a5f21"),s=n("80f80074c6");var a=function e(t){var n=new i(t),a=r(i.prototype.request,n);return o.extend(a,i.prototype,n),o.extend(a,n),a.create=function(n){return e(s(t,n))},a}(n("5adb739611"));a.Axios=i,a.Cancel=n("2f925fe3c3"),a.CancelToken=n("92389ef378"),a.isCancel=n("ea59e4d4bf"),a.VERSION=n("a2bdef5516").version,a.all=function(e){return Promise.all(e)},a.spread=n("c013a37247"),a.isAxiosError=n("4b7c121b83"),e.exports=a,e.exports.default=a},"80a1ca8977":function(e,t,n){"use strict";var o,r;Object.defineProperty(t,"__esModule",{value:!0}),t.FOREVER_LIMIT_FREQUENCY=t.NOT_LIMIT_FREQUENCY=t.LIMIT_FREQUENCY_STRAGEGY=t.MAX_THRESHOLD=t.MIDDLE_THRESHOLD=t.MIN_THRESHOLD=t.LimitFrequencyLevel=t.MessagePriority=void 0,function(e){e[e.HIGH=0]="HIGH",e[e.MIDDLE=1]="MIDDLE",e[e.LOW=2]="LOW"}(o||(o={})),t.MessagePriority=o,function(e){e[e.LOW=0]="LOW",e[e.MIDDLE=1]="MIDDLE",e[e.HIGH=2]="HIGH",e[e.HIGHEST=3]="HIGHEST"}(r||(r={})),t.LimitFrequencyLevel=r;t.MIN_THRESHOLD=20;t.MIDDLE_THRESHOLD=50;t.MAX_THRESHOLD=100;t.NOT_LIMIT_FREQUENCY=0;var i=Number.MAX_SAFE_INTEGER;t.FOREVER_LIMIT_FREQUENCY=i;var s=[[0,0,0,0],[0,5e3,1e4,2e4],[0,1e4,2e4,i]];t.LIMIT_FREQUENCY_STRAGEGY=s},"80d00c6e70":function(e,t,n){"use strict";(function(e){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FeatureMessageCenter=void 0;var r=n("9ab1857893"),i=n("a8a4b19997"),s=n("cdda668c2b"),a=n("41c8f4a4e5"),c=o(n("751778941b")),u=function(){function t(){this.onFeatureMessageEventEmitter=new r.Emitter,this.sendMessages=new Map,this.uid=t.configs.uid||i.getUid();var e=t.configs.userId||"p."+this.uid;this.userId=""+e,this.gtag="main_page_"+this.userId,this.onFeatureMessageEvent=this.onFeatureMessageEventEmitter.event,c.default.reportUserChannel()}return t.config=function(e){t.configs=Object.assign(t.configs,e)},t.getInstance=function(){if(!e.featureMessageCenterInstance){var n=new t;e.featureMessageCenterInstance=n,n.connect()}return t.instance||(t.instance=e.featureMessageCenterInstance),t.instance},t.prototype.isConnecting=function(){return!!this.socketManager},t.prototype.connect=function(){this.isConnecting()||this.websocketConnect()},t.prototype.disConnect=function(e){var t;null===(t=this.socketManager)||void 0===t||t.disConnect(null!=e?e:"")},t.prototype.dispose=function(){var e;this.onFeatureMessageEventEmitter.dispose(),null===(e=this.socketManager)||void 0===e||e.dispose()},t.prototype.onConnect=function(){this.sendClientReady()},t.prototype.sendMessage=function(e){var t,n,o=this;if(e.type){var r=s.generateMessageTaskId(),i={uid:this.userId,type:e.type,task_id:r};i=Object.assign(i,e);var a=setTimeout((function(){var e;clearTimeout(a);var t=""+r;if(o.sendMessages.has(t)){var n=o.sendMessages.get(t);null===(e=null==n?void 0:n.onError)||void 0===e||e.call(n,new Error("sending timeout.")),o.sendMessages.delete(t)}}),e.timeout||3e4);this.sendMessages.set(""+r,e),null===(n=this.socketManager)||void 0===n||n.sendMessage(r+"="+s.JsonUtil.jsonStringify(i))}else null===(t=e.onError)||void 0===t||t.call(e,new Error("type is undefined"))},t.prototype.onConnectFail=function(){var e=this;if(!this.websocketDelayConnectTimer){this.socketManager=void 0;var t=1e3*Math.max(Math.floor(20*Math.random()),2);this.websocketDelayConnectTimer=setTimeout((function(){e.websocketConnect()}),t)}},t.prototype.onGetMessageFromServerPush=function(e){var t,n=s.JsonUtil.parseJson(e),o=void 0,r=void 0;(null==n?void 0:n.task_id)&&(o=""+n.task_id,r=this.sendMessages.get(o)),this.onFeatureMessageEventEmitter.fire({data:e,type:null==r?void 0:r.type}),e&&o&&r&&(null===(t=r.onSuccess)||void 0===t||t.call(r,n),this.sendMessages.delete(o))},t.prototype.websocketConnect=function(){this.uid&&(this.resetWebsocketDelayConnectTimer(),this.socketManager=new a.WebsocketManager({userId:this.userId,gtag:this.gtag,host:window.location.host,featureMessageCenterReceiver:this}),this.socketManager.connect())},t.prototype.sendClientReady=function(){var e,t={type:"CLIENT_READY",uid:this.userId,gtag:this.gtag,cookie:s.getCookieForMessage()},n=s.generateMessageTaskId()+"="+s.JsonUtil.jsonStringify(t);null===(e=this.socketManager)||void 0===e||e.sendMessage(n)},t.prototype.resetWebsocketDelayConnectTimer=function(){this.websocketDelayConnectTimer&&(clearTimeout(this.websocketDelayConnectTimer),this.websocketDelayConnectTimer=0)},t.configs={},t}();t.FeatureMessageCenter=u}).call(this,n("5ef37df1a0"))},"80f80074c6":function(e,t,n){"use strict";var o=n("9da27020aa");e.exports=function(e,t){t=t||{};var n={};function r(e,t){return o.isPlainObject(e)&&o.isPlainObject(t)?o.merge(e,t):o.isPlainObject(t)?o.merge({},t):o.isArray(t)?t.slice():t}function i(n){return o.isUndefined(t[n])?o.isUndefined(e[n])?void 0:r(void 0,e[n]):r(e[n],t[n])}function s(e){if(!o.isUndefined(t[e]))return r(void 0,t[e])}function a(n){return o.isUndefined(t[n])?o.isUndefined(e[n])?void 0:r(void 0,e[n]):r(void 0,t[n])}function c(n){return n in t?r(e[n],t[n]):n in e?r(void 0,e[n]):void 0}var u={url:s,method:s,data:s,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:c};return o.forEach(Object.keys(e).concat(Object.keys(t)),(function(e){var t=u[e]||i,r=t(e);o.isUndefined(r)&&t!==c||(n[e]=r)})),n}},"81cf3de5f1":function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));class o{static hasMetadata(e,t){return!!t[e]}static getDepsMetadata(e,t){return t[e]}static setDepsMetadata(e,t,n){n[e]=t}static getMethodMetadata(e,t){return t[e]}static setMethodMetadata(e,t,n){n[e]=t}}},"825eafaa67":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LimitFrequencyMessage=void 0;var o=n("cdda668c2b"),r=n("80a1ca8977"),i=function(){function e(e,t,n){this.type=e,this.priority=t,this.dependency=n,this.duration=r.NOT_LIMIT_FREQUENCY,this.messages=[]}return e.prototype.shouldLimit=function(e){return this.type===e},e.prototype.handleMessage=function(e,t,n){var o=this;this.memberCount=n;var i=this.calculateLimitDuration(t);i!==r.NOT_LIMIT_FREQUENCY?(e.needDeal=!1,i!==r.FOREVER_LIMIT_FREQUENCY?(this.pushMessage(e),i!==this.duration&&(this.reset(),this.duration=i,this.transferTimer=setInterval((function(){o.transfer()}),this.duration))):this.duration=i):i!==this.duration&&(this.transfer(),this.reset())},e.prototype.pushMessage=function(e){this.messages.push(e)},e.prototype.transfer=function(){this.messages.length&&(o.ConnectionLog.info("transfer memberCount:"+this.memberCount+", type:"+this.type+", duration:"+this.duration),this.transferToBusiness(this.type,this.messages),this.messages.splice(0,this.messages.length))},e.prototype.transferToBusiness=function(e,t){this.dependency.receiveMessageFromServer(e,t)},e.prototype.reset=function(){clearInterval(this.transferTimer),this.transferTimer=0,this.duration=r.NOT_LIMIT_FREQUENCY},e.prototype.calculateLimitDuration=function(e){try{return this.priority===r.MessagePriority.HIGH?r.NOT_LIMIT_FREQUENCY:r.LIMIT_FREQUENCY_STRAGEGY[this.priority][e]}catch(e){return r.NOT_LIMIT_FREQUENCY}},e}();t.LimitFrequencyMessage=i},"8645a705ed":function(e,t,n){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectMode=void 0,function(e){e.WEBSOCKET="WEBSOCKET",e.BIG_COLLAB="BIG_COLLAB",e.WEBSOCKET_FORCED="WEBSOCKET_FORCED"}(o||(o={})),t.ConnectMode=o},"868ec81a7d":function(e,t,n){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.RoomWebsocketEvent=void 0,function(e){e.open="open",e.close="close",e.connect="connect",e.connectFail="connectfail",e.reconnecting="reconnecting",e.disconnect="disconnect",e.connectTimeout="connect_timeout",e.connectError="connect_error"}(o||(o={})),t.RoomWebsocketEvent=o},"8838f60498":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.trackDisposable=t.markTracked=t.disableDisposablesTrack=t.enableDisposablesTrack=void 0;var o=n("dd1cfaf242"),r=!1,i="__is_disposable_tracked__";t.enableDisposablesTrack=function(){r=!0},t.disableDisposablesTrack=function(){r=!1},t.markTracked=function(e){if(r&&e&&e!==o.DisposableNone)try{e[i]=!0}catch(e){}},t.trackDisposable=function(e){if(!r)return e;e[i]||(e[i]=!1);var t=new Error("Potentially leaked disposable").stack;return setTimeout((function(){e[i]||console.log(t)}),3e3),e}},"88476f9607":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisposableStore=void 0;var o=n("6cac31cea5"),r=n("6bb936b136"),i=function(){function e(){this.toDisposeSet=new Set,this.isDisposeState=!1}return e.prototype.dispose=function(e){if(!this.isDisposeState)if(r.markTracked(this),this.isDisposeState=!0,e)this.clear(e);else{var t=o.DisposeTrace.traceRoot(this.constructor.name);this.clear(t),t.stop()}},e.prototype.clear=function(e){this.toDisposeSet.forEach((function(t){var n=t.disposableId||t.constructor.name;t.dispose(null==e?void 0:e.branch(n))})),this.toDisposeSet.clear()},e.prototype.add=function(t){if(!t)return t;if(t===this)throw new Error("Cannot register a disposable on itself!");return r.markTracked(t),this.isDisposeState?e.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this.toDisposeSet.add(t),t},e.DISABLE_DISPOSED_WARNING=!1,e}();t.DisposableStore=i},"898db569a7":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},"8a015847e6":function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return i}));var o,r=n("4f04e6c8a0");!function(e){e[e.POST_CONSTRUCTOR=0]="POST_CONSTRUCTOR"}(o||(o={}));const i=Object(r.a)("IInstantiationService")},"8c6f8478bd":function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.BaseChannel=void 0;var i=n("f7ee9899ef"),s=n("cdda668c2b"),a=function(){function e(e,t){this.options=e,this.defaultConfig=t}return e.prototype.dispose=function(){this.paramsPacker=void 0,this.responseHandler=void 0},e.prototype.sendMessage=function(e){return o(this,void 0,void 0,(function(){var t,n,o,a,c,u;return r(this,(function(r){switch(r.label){case 0:return this.paramsPacker&&this.responseHandler?(n=this.paramsPacker.pack(e,this.options),o=e.requestUrl,a=e.method,c=e.contentType,[4,(new i.Request).sendRequest(null!=o?o:this.defaultConfig.requestUrl,null!=a?a:this.defaultConfig.method,null!=c?c:this.defaultConfig.contentType,n)]):(t="Channel Error, sendMessage failed paramsPacker:"+this.paramsPacker+", responseHandler:"+this.responseHandler+" ",s.ConnectionLog.error(t),[2,{error:t}]);case 1:return u=r.sent(),[2,this.responseHandler.handle(u)]}}))}))},e}();t.BaseChannel=a},"8d1b55641a":function(e,t,n){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.MiddleWareCenter=t.MiddleWareType=void 0,function(e){e.RECEIVE_MESSAGE_FROM_SERVER="RECEIVE_MESSAGE_FROM_SERVER"}(o||(o={})),t.MiddleWareType=o;var r=function(){function e(){this.middleWares=new Map}return e.prototype.useMiddleWare=function(e,t){if(e&&t){var n=this.getMiddleWares(e);n.push(t),this.middleWares.set(e,n)}},e.prototype.run=function(e,t){var n=this.getMiddleWares(e);this.compose(n,t)},e.prototype.getMiddleWares=function(e){var t;return null!==(t=this.middleWares.get(e))&&void 0!==t?t:[]},e.prototype.compose=function(e,t){var n=-1;return function o(r){if(r<=n)throw new Error("next only called once");if(n=r,r===e.length)return t;var i=e[r];return null==i?void 0:i(t,o.bind(null,r+1))}(0)},e}();t.MiddleWareCenter=r},"8daac3befe":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PageVisibilityChecker=void 0;var o=n("cdda668c2b"),r=function(){function e(e){var t=this;this.dependency=e,this.timer=0,this.isTimeout=!1,this.needGetReceiverClient=!1,this.onVisibilitychange=function(){"hidden"===document.visibilityState?t.onPageHide():t.onPageShow()},this.onPageHide=function(){o.ConnectionLog.info("pageVisibility: pagehide"),t.clearTimeout(),t.timer=setTimeout((function(){t.isTimeout=!0}),3e4)},this.onPageShow=function(){var e,n;o.ConnectionLog.info("pageVisibility: pageshow"),t.clearTimeout(),t.isTimeout&&t.needGetReceiverClient&&(null===(n=(e=t.dependency).resumeCallback)||void 0===n||n.call(e)),t.isTimeout=!1,t.needGetReceiverClient=!1},this.addListener()}return e.prototype.dispose=function(){this.clearTimeout(),document.removeEventListener("visibilitychange",this.onVisibilitychange),window.removeEventListener("pagehide",this.onPageHide),window.removeEventListener("pageshow",this.onPageShow)},Object.defineProperty(e.prototype,"isHidden",{get:function(){return document.hidden&&this.isTimeout},enumerable:!1,configurable:!0}),e.prototype.resumeAfterVisibility=function(){this.needGetReceiverClient=!0},e.prototype.addListener=function(){document.addEventListener("visibilitychange",this.onVisibilitychange),/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&(window.addEventListener("pagehide",this.onPageHide),window.addEventListener("pageshow",this.onPageShow))},e.prototype.clearTimeout=function(){this.timer&&(clearTimeout(this.timer),this.timer=0)},e}();t.PageVisibilityChecker=r},"92389ef378":function(e,t,n){"use strict";var o=n("2f925fe3c3");function r(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;this.promise.then((function(e){if(n._listeners){var t,o=n._listeners.length;for(t=0;t<o;t++)n._listeners[t](e);n._listeners=null}})),this.promise.then=function(e){var t,o=new Promise((function(e){n.subscribe(e),t=e})).then(e);return o.cancel=function(){n.unsubscribe(t)},o},e((function(e){n.reason||(n.reason=new o(e),t(n.reason))}))}r.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},r.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},r.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},r.source=function(){var e;return{token:new r((function(t){e=t})),cancel:e}},e.exports=r},"92e2df3b64":function(e,t,n){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.NewChangeCommandsType=void 0,function(e){e.JSON="JSON",e.BASE64="BASE64"}(o||(o={})),t.NewChangeCommandsType=o},"95b75d217e":function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},o(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return s};Object.defineProperty(t,"__esModule",{value:!0}),t.DisposeTrace=t.disableDisposeTrace=t.enableDisposeTrace=void 0;var a=!1;t.enableDisposeTrace=function(){a=!0},t.disableDisposeTrace=function(){a=!1};var c=function(){function e(e){this.name=e,this._dep=[]}return e.traceRoot=function(t){return a?new e(t):e._None},e.prototype.branch=function(t){var n=new e(t);return this._dep.push([t,n]),n},e.prototype.stop=function(){var e=["dispose "+this.name,""+function e(t,n){var o,r,a=[],c=new Array(t+1).join("\t");try{for(var u=i(n._dep),d=u.next();!d.done;d=u.next()){var l=s(d.value,2),p=l[0],h=l[1];if(h){a.push(c+"dispose -> "+p);var f=e(t+1,h);f&&a.push(f)}else a.push(c+"dispose -> "+p)}}catch(e){o={error:e}}finally{try{d&&!d.done&&(r=u.return)&&r.call(u)}finally{if(o)throw o.error}}return a.join("\n")}(1,this)];console.log(e.join("\n"))},e._None=new(function(e){function t(){return e.call(this,null)||this}return r(t,e),t.prototype.stop=function(){},t.prototype.branch=function(){return this},t}(e)),e}();t.DisposeTrace=c},"96ed841b55":function(e,t,n){"use strict";var o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return s};Object.defineProperty(t,"__esModule",{value:!0}),t.getDecodeURIComponentValue=t.getCookieForMessage=t.Cookie=void 0;var r=function(e){try{return decodeURIComponent(e)}catch(t){return e}};t.getDecodeURIComponentValue=r;var i={get:function(e){var t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return t?r(t[2]):""},getXsrf:function(){return i.get("TOK")||""}};t.Cookie=i;t.getCookieForMessage=function(){return document.cookie.split(";").map((function(e){var t=o(/(\w+)=(.*)/.exec(e.trim())||[],3),n=t[0],i=t[1],s=t[2];return i?i+"="+r(s):n})).join(";")}},"97d6e03b61":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Result=void 0;var o=function(e,t){e&&(this.error=e),void 0!==t&&(this.data=t)};t.Result=o},"992a7b5d2e":function(e,t,n){"use strict";e.exports={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1}},"99cf54780e":function(e,t,n){"use strict";n.r(t),n.d(t,"network",(function(){return d}));var o=n("4f3b15d017");const r=n("d7a2286b24").default.getInstance().getConfig('npm["@tencent/netcheck"]');var i,s={version:6,autoRun:!0,ignoreDefaultSources:!0,cdnSources:Object.values((null==r?void 0:r.cdnSources)||["https://docs.qq.com/net-check/img","https://docs.gtimg.com/components/img/1px.gif","https://docs2.gtimg.com/components/img/1px.gif"]),duration:6e4},a=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};!function(e){e.OFF_LINE="offline",e.ON_LINE="online"}(i||(i={}));let c;window.__offlinetest=!1,void 0!==document.hidden?c="visibilitychange":void 0!==document.mozHidden?c="mozvisibilitychange":void 0!==document.msHidden?c="msvisibilitychange":void 0!==document.webkitHidden&&(c="webkitvisibilitychange");class u{constructor(e){this.cdnSources=s.cdnSources,this.autoRun=s.autoRun,this.duration=s.duration,this.counter=0,this.handleVisibility=()=>{document.hidden||document.webkitHidden||document.msHidden||document.mozHidden?(this.duration=3e5,this.pause(),this.startCheck()):(this.duration=6e4,this.pause(),this.startCheck())},this.handleNetstatus=()=>a(this,void 0,void 0,(function*(){this.status=yield this.netcheck(),this.handleCalback()})),this.setConfig(e),this.status=this.navigatorOnlineStatus,[this.netchecksource]=this.cdnSources,this.callbacks=[],this.autoRun&&this.init()}static create(e){return new u(e)}static getInstance(e){return u.instance||(u.instance=u.create(e)),u.instance}setConfig(e){const{cdnSources:t=this.cdnSources,ignoreDefaultSources:n=s.ignoreDefaultSources,autoRun:o=this.autoRun,duration:r=this.duration}=e;Array.isArray(t)&&(this.cdnSources=n?t:this.cdnSources.concat(t)),this.autoRun=!!o,Number.isInteger(r)&&(this.duration=r)}getVersion(){return u.version}init(){return a(this,void 0,void 0,(function*(){const e=yield this.preNetCheck();this.status=e,this.bindVisibility(),this.bindNetStatus(),this.startCheck()}))}get isOnline(){return!window.__offlinetest&&this.status===i.ON_LINE}changeEnd(e){this.callbacks.push(e)}extendCallbacks(e){this.callbacks=this.callbacks.concat(e.slice())}getCallbacks(){return this.callbacks}remove(e){const t=this.callbacks.slice(0,this.callbacks.length);for(let n=0;n<t.length;n++)t[n]===e&&(t.splice(n,1),this.callbacks=t)}handleCalback(){this.callbacks.forEach((e=>{e(this.status)}))}destory(){window.mqq&&o.default.isAndroid&&(o.default.isTencentDocsApp||o.default.isTimOrQQ)&&!o.default.isQQMiniProgram?window.mqq.removeEventListener("qbrowserVisibilityChange",this.handleVisibility):document.removeEventListener(c,this.handleVisibility),this.pause(),window.removeEventListener(i.ON_LINE,this.handleNetstatus),window.removeEventListener(i.OFF_LINE,this.handleNetstatus),this.counter=0,this.preCheckOnlineStatus=!1,this.duration=6e4}bindNetStatus(){window.addEventListener(i.ON_LINE,this.handleNetstatus),window.addEventListener(i.OFF_LINE,this.handleNetstatus)}bindVisibility(){window.mqq&&o.default.isAndroid&&(o.default.isTencentDocsApp||o.default.isTimOrQQ)&&!o.default.isQQMiniProgram?window.mqq.addEventListener("qbrowserVisibilityChange",this.handleVisibility):document.addEventListener(c,this.handleVisibility)}pause(){clearInterval(this.Timer),this.Timer=null}startCheck(){this.Timer=window.setInterval((()=>a(this,void 0,void 0,(function*(){yield this.polling()}))),this.duration)}polling(){return a(this,void 0,void 0,(function*(){this.preCheckOnlineStatus?this.status=yield this.netcheck():this.status=this.navigatorOnlineStatus,this.counter>=15?(yield this.preNetCheck(),this.counter=0):this.counter+=1,this.handleCalback()}))}get navigatorOnlineStatus(){return window.navigator.onLine?i.ON_LINE:i.OFF_LINE}preNetCheck(){return a(this,void 0,void 0,(function*(){return new Promise((e=>{const t=this.cdnSources.map((e=>this.sourceCheck(e)));var n;(n=t,new Promise(((e,t)=>{let{length:o}=n;o||t(new AggregateError("null"));const r=[];n.forEach((n=>{n.then((t=>e(t))).catch((e=>{o-=1,r.push(e),o||t(new AggregateError(r))}))}))}))).then((t=>{this.preCheckOnlineStatus=!0,this.netchecksource=t,e(i.ON_LINE)})).catch((()=>{this.preCheckOnlineStatus=!1,e(i.OFF_LINE)}))}))}))}sourceCheck(e){return a(this,void 0,void 0,(function*(){const t=new Image;return new Promise(((n,o)=>{t.onload=()=>{n(e)},t.onerror=()=>{o(`${e} load fail`)},t.src=`${e}?t=${Date.now()}`}))}))}netcheck(){return a(this,void 0,void 0,(function*(){return this.netcheckImage||(this.netcheckImage=new Image),new Promise((e=>{this.netcheckImage.onload=function(){e(i.ON_LINE)},this.netcheckImage.onerror=function(){e(i.OFF_LINE)},this.netcheckImage.src=`${this.netchecksource}?t=${Date.now()}`}))}))}}u.version=s.version;const d=function(e){if(window.tdocsNetcheck){const t=window.tdocsNetcheck.getVersion();e.getVersion()>t&&(e.extendCallbacks(window.tdocsNetcheck.getCallbacks()),window.tdocsNetcheck.destory(),window.tdocsNetcheck=e,window.tdocsNetcheck.init())}else window.tdocsNetcheck=e,window.tdocsNetcheck.init();return window.tdocsNetcheck}(u.create({autoRun:!1}))},"9b00d9b77e":function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var o=n("0368aca230"),r=n("a282565e4f"),i=n("8a015847e6"),s=n("48a9511069");class a{constructor(e){this.instantiationHook=new s.a,this.selfInstantiationService=e}createInstance(e,t){if(this.instance)return this.instance;const n=this.loaderInstantiationService().createInstance(e,...t);return this.executeHooks(n,i.a.POST_CONSTRUCTOR),this.instance=n,Object(o.tryToMarkDispose)(n),n}loaderInstantiationService(){const e=this.getInstantion()||a.staticInstantiationService;if(e&&e!==this.selfInstantiationService){let t=!0;if(e.getHierarchyNode().walkUp((e=>{t&&e===this.selfInstantiationService&&(t=!1)})),t)throw new Error(r.m)}return e||this.selfInstantiationService}getInstantion(){return null}addHook(e,t){this.instantiationHook.addHook(e,t)}executeHooks(e,t){this.instantiationHook.executeHooks(e,t)}static initStaticInstantiationService(e){if(a.staticInstantiationService)throw new Error(r.n);a.staticInstantiationService=e}dispose(e){var t,n;this.instance&&(Object(o.isDisposable)(this.instance)&&(e&&e.branch(`${(null===(n=null===(t=this.instance)||void 0===t?void 0:t.constructor)||void 0===n?void 0:n.name)||""}instance`),this.instance.dispose(e)),this.instance=null)}}},"9c5a83385b":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_WMODE=t.TRANSPOET_MODE_MAP=t.DEFAULT_ATTEMPT_TRANSPORT_MODE=t.DEFAULT_TRANSPORT_MODE=t.WEBSOCKET_CONFIG=void 0;t.WEBSOCKET_CONFIG={reconnectMaxTimes:3,connectTimeout:5e3,reconnectionDelay:3e3,reconnectionDelayMax:5e3,randomizationFactor:1,pollingReopenCount:0,pollingAttemptCount:3};var o=["websocket"];t.DEFAULT_TRANSPORT_MODE=o;var r=["polling","websocket"];t.DEFAULT_ATTEMPT_TRANSPORT_MODE=r;var i=new Map([["w",o],["l",["polling"]],["b",r]]);t.TRANSPOET_MODE_MAP=i;t.DEFAULT_WMODE="ww"},"9da27020aa":function(e,t,n){"use strict";var o=n("f091811571"),r=Object.prototype.toString;function i(e){return Array.isArray(e)}function s(e){return void 0===e}function a(e){return"[object ArrayBuffer]"===r.call(e)}function c(e){return null!==e&&"object"==typeof e}function u(e){if("[object Object]"!==r.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function d(e){return"[object Function]"===r.call(e)}function l(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),i(e))for(var n=0,o=e.length;n<o;n++)t.call(null,e[n],n,e);else for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.call(null,e[r],r,e)}e.exports={isArray:i,isArrayBuffer:a,isBuffer:function(e){return null!==e&&!s(e)&&null!==e.constructor&&!s(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"[object FormData]"===r.call(e)},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&a(e.buffer)},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:c,isPlainObject:u,isUndefined:s,isDate:function(e){return"[object Date]"===r.call(e)},isFile:function(e){return"[object File]"===r.call(e)},isBlob:function(e){return"[object Blob]"===r.call(e)},isFunction:d,isStream:function(e){return c(e)&&d(e.pipe)},isURLSearchParams:function(e){return"[object URLSearchParams]"===r.call(e)},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:l,merge:function e(){var t={};function n(n,o){u(t[o])&&u(n)?t[o]=e(t[o],n):u(n)?t[o]=e({},n):i(n)?t[o]=n.slice():t[o]=n}for(var o=0,r=arguments.length;o<r;o++)l(arguments[o],n);return t},extend:function(e,t,n){return l(t,(function(t,r){e[r]=n&&"function"==typeof t?o(t,n):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}}},a1644e2245:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return r}));const o="di:ctor_deps",r="di:post_constructor"},a282565e4f:function(e,t,n){"use strict";n.d(t,"k",(function(){return o})),n.d(t,"f",(function(){return r})),n.d(t,"b",(function(){return i})),n.d(t,"s",(function(){return s})),n.d(t,"a",(function(){return a})),n.d(t,"i",(function(){return c})),n.d(t,"j",(function(){return u})),n.d(t,"h",(function(){return d})),n.d(t,"o",(function(){return l})),n.d(t,"l",(function(){return p})),n.d(t,"e",(function(){return h})),n.d(t,"d",(function(){return f})),n.d(t,"p",(function(){return v})),n.d(t,"q",(function(){return g})),n.d(t,"g",(function(){return m})),n.d(t,"r",(function(){return E})),n.d(t,"m",(function(){return y})),n.d(t,"n",(function(){return _})),n.d(t,"c",(function(){return b}));const o="Metadata must be applied to the parameters of a class constructor",r=(...e)=>`Metadata key was used more than once for parameter of class ${e[0]} in position ${e[1]}, already has metadata: [${e[2]}], newly add metadata: [${e[3]}]`,i=(...e)=>`Ambiguous override for serviceIdentifier: ${e[0]}`,s=(...e)=>`Should not update identifier ${e[0]} holder's descriptor, when ${e[1]} already has a instance`,a=(...e)=>`Ambiguous match found for serviceIdentifier: ${e[0]}`,c="Illegal hierarchy state: elder border is duplicated",u="Illegal merge state: cannot merge a node with a parent to anther node",d="Illegal parent state: there is already a parent node",l=(...e)=>`Warning: try to override service [${e[0]}], which with no supportsOverride options`,p=(...e)=>`[invokeFunction] get unknown service '${e[0]}'`,h=(...e)=>`Service ${e[0]} depends on unknown service ${e[1]}`,f=(...e)=>`IllegalState: creating unknown service instance ${e[0]}`,v=(...e)=>`IllegalState: resolve unknown service instance ${e[0]}`,g="Cyclic dependency between services",m="May detected cyclic dependency in graph",E=(...e)=>`@ServiceName decorator [${e[0]}] can only be used to decorate constructor parameter`,y="Illegal state: getInstantion return orphan InstantiationService",_="Illegal state: staticInstantiationService of LoaderBase can only be set once",b=(...e)=>`CreateInstance ${e[0]} depends on ${e[1]} which is NOT registered`},a2bdef5516:function(e,t){e.exports={version:"0.26.1"}},a395430f42:function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},o(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return s},s=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0}),t.mixinRootDisposable=t.mixinDisposable=t.Disposable=t.RootDisposable=void 0;var a=n("95b75d217e"),c=n("8838f60498"),u=n("1d73a1ebc4"),d=function(){function e(){this.disposedStore=new u.DisposableStore}return e.prototype.dispose=function(e){this.disposedStore.dispose(e)},e.prototype._register=function(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this.disposedStore.add(e)},e}(),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.dispose=function(t){var n=t,o=!1;if(!n){var r=this.constructor.name;n=a.DisposeTrace.traceRoot(r),o=!0}e.prototype.dispose.call(this,n),o&&n.stop()},t.prototype._register=function(t){return e.prototype._register.call(this,t)},t}(d);t.RootDisposable=l;var p=function(e){function t(){var t=e.call(this)||this;return c.trackDisposable(t),t}return r(t,e),t.prototype.dispose=function(t){c.markTracked(this),e.prototype.dispose.call(this,t)},t}(d);t.Disposable=p,t.mixinDisposable=function(e){return function(e){function t(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var o=e.apply(this,s(t))||this;return o.disposedStore=new u.DisposableStore,c.trackDisposable(o),o}return r(t,e),t.prototype.dispose=function(e){c.markTracked(this),this.disposedStore.dispose(e)},t.prototype._register=function(e){return this.disposedStore.add(e)},t}(e)},t.mixinRootDisposable=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.disposedStore=new u.DisposableStore,t}return r(t,e),t.prototype.dispose=function(e){c.markTracked(this);var t=e,n=!1;if(!t){var o=this.constructor.name;t=a.DisposeTrace.traceRoot(o),n=!0}this.disposedStore.dispose(t),n&&t.stop()},t.prototype._register=function(e){return this.disposedStore.add(e)},t}(e)}},a5b778a02f:function(e,t,n){"use strict";var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},o.apply(this,arguments)},r=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},s=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return s},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MessageCenter=void 0;var c=n("cdda668c2b"),u=n("147e28b86b"),d=n("46509843e6"),l=n("e2584d8846"),p=n("7a6008fb54"),h=n("d3819be4ca"),f=n("e9dc8c48dc"),v=n("686df8963b"),g=n("094a0886cb"),m=n("c4f2c30fd5"),E=n("de23095cc5"),y=a(n("751778941b")),_=function(){function e(e,t,n){var o,r,i=this;this.options=e,this.dependency=t,this.connectManager=n,this.tag="MessageCenter",this.limitFrequencyManager=new h.LimitFrequencyManager(this.dependency),null===(r=null===(o=this.options.config)||void 0===o?void 0:o.messagePriority)||void 0===r||r.forEach((function(e,t){i.limitFrequencyManager.setPriority(t,e)}));var s={getServerParams:function(){return i.serverRequestParams},reconnect:function(e){return i.reconnect(e)},disconnect:function(e){return i.connectManager.disconnect(e)},isDisconnected:function(){return i.connectManager.isDisconnected()},handleServerMessage:function(e){return i.handleServerMessage(e)},onConnectSuccess:function(){return i.connectManager.onConnectSuccess()}};this.sender=new p.Sender({getServerParams:function(){return i.serverRequestParams},isConnected:function(){return i.connectManager.isConnected()},onMessageSending:function(e){return i.onMessageSending(e)},onMessageWaiting:function(e){return i.onMessageWaiting(e)}}),this.receiver=new l.Receiver(s);var a=new v.MessageClassification([["CURSOR_MESSAGE",v.MessageSendType.PARALLEL]]);this.messageSendQueue=new f.MessageSendQueue(a),this.timeoutChecker=new m.TimeoutChecker(this.messageSendQueue,{trySendMessage:function(){return i.trySendMessage()}}),this.initOnConnectEvent()}return e.prototype.dispose=function(){this.receiver.dispose(),this.sender.dispose(),this.timeoutChecker.dispose()},e.prototype.sendMessage=function(e){if(c.ConnectionLog.info(this.tag+" sendMessage cmd:"+e.cmd+" taskId:"+e.taskId),this.messageSendQueue.has(e.taskId))return c.ConnectionLog.warn(this.tag+" sendMessage taskId:"+e.taskId+" is sending."),void e.onError(e.taskId,e.cmd,e.data,{errCode:u.RoomErrorCode.EXIST,errMsg:"msg already exist."});var t=E.MessageCreater.createMessage(e,this.options,this.dependency);this.messageSendQueue.add(t),this.trySendMessage()},e.prototype.cancelSendMessageByTaskId=function(e){c.ConnectionLog.info("cancelSendMessageByTaskId taskId:"+e),this.messageSendQueue.remove(e)},e.prototype.initOnConnectEvent=function(){var e=this;this.connectManager.onConnectEvent((function(t){var n,o=t.status,r=t.serverRequestParams;c.ConnectionLog.debug("onConnectEvent: "+o);var i=new Map([[""+d.ConnectStatus.LOGINED,function(){return e.handleLogined(r)}],[""+d.ConnectStatus.CONNECTED,function(){return e.trySendMessage()}],[""+d.ConnectStatus.DISCONNECT,function(){return e.handleDisconnect()}],[""+d.ConnectStatus.WAIT_RECONNECTING,function(){return e.handleWaitReconnecting()}]]);i.has(t.status)&&(null===(n=i.get(t.status))||void 0===n||n())}))},e.prototype.trySendMessage=function(){this.connectManager.isDisconnected()?this.triggerAllMessagesShutdown():(this.trySendParallelMessage(),this.trySendSerialMessage())},e.prototype.trySendSerialMessage=function(){if(!this.messageSendQueue.isCommittingSerialMessage())if(this.connectManager.isDisconnected())this.triggerAllMessagesShutdown();else{var e=this.messageSendQueue.nextSerialMessage();e&&this.sendBigCollabMessage(e)}},e.prototype.trySendParallelMessage=function(){var e=this;this.messageSendQueue.nextParallelMessages().forEach((function(t){return e.sendBigCollabMessage(t)}))},e.prototype.sendBigCollabMessage=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return this.onMessageSending(e),this.timeoutChecker.startCheckSendTimeout(),[4,this.sender.sendMessage(e)];case 1:return t=n.sent(),this.handleMessageResult(e,t),[2]}}))}))},e.prototype.onMessageSending=function(e){e.state=u.MessageState.SENDING,e.lastSendTime=Date.now(),e.retryCount+=1},e.prototype.onMessageWaiting=function(e){e.state=u.MessageState.WAITING},e.prototype.handleMessageResult=function(e,t){return r(this,void 0,void 0,(function(){var n;return i(this,(function(o){return t?e.syncCommit?(this.handleSyncMessage(e,t),[2]):(n={errCode:t.retcode,errMsg:t.msg,response:t.data.syncResult?c.JsonUtil.parseJson(t.data.syncResult):t},this.handleMessageResultSend(e,n),[2]):[2]}))}))},e.prototype.handleSyncMessage=function(e,t){var n=this;if(0===t.retcode){this.parseSyncMessageResult(e,t).forEach((function(e){n.handleServerMessage(e)}))}else{var r={task_id:e.taskId,type:u.MessageWaitAcceptCmd.COMMIT_ERROR},i={data:o(o({},t),{reason:t.retcode})};this.handleMessageResultSendAccept(r,i)}},e.prototype.parseSyncMessageResult=function(e,t){if(!t.data.syncResult)throw Error("Save Response Error, syncResult is undefined, taskId: "+e.taskId);return t.data.syncResult.split("\r\n").map((function(e){return e.split("\n")}))},e.prototype.hasWaitAcceptCommand=function(e,t){var n;return!!(null===(n=e.waitAcceptCmd)||void 0===n?void 0:n.includes(t))},e.prototype.handleMessageResultSend=function(e,t){var n,o;return r(this,void 0,void 0,(function(){var r,s,a;return i(this,(function(i){return r=e.taskId,s=e.cmd,a=e.data,e.onpostTime=u.RoomUtil.getCurrentTime(),this.shouldReconnect(t.errCode)?(this.reconnect({attrName:String(t.errCode),reason:"save Error, retcode: "+t.errCode+", msg: "+t.errMsg}),this.messageSendQueue.remove(e.taskId),[2]):0!==t.errCode?(this.handleSendMessageError(e,t),[2]):(null===(n=e.onsend)||void 0===n||n.call(e,r,s,a,t),e.onsendAccept?(null===(o=e.waitAcceptCmd)||void 0===o?void 0:o.length)&&(e.state=u.MessageState.WAIT_ACCEPT):(this.messageSendQueue.remove(r),this.trySendMessage()),[2])}))}))},e.prototype.shouldReconnect=function(e){return u.NEED_RECONNECT_ERRCODES.includes(e)},e.prototype.handleSendMessageError=function(e,t){var n,o=e.taskId,r=e.cmd,i=e.data;null===(n=e.onError)||void 0===n||n.call(e,o,r,i,t),this.reportCommitError(e,t.errCode,"save Error, retcode: "+t.errCode+", msg: "+t.errMsg),this.messageSendQueue.remove(o),this.trySendMessage()},e.prototype.handleMessageResultSendAccept=function(e,t){var n,o,r,i,s,a;if(e.task_id){var c=this.messageSendQueue.remove(e.task_id);if(c&&this.hasWaitAcceptCommand(c,e.type)){this.reportCommitError(c,null!==(o=null===(n=t.data)||void 0===n?void 0:n.reason)&&void 0!==o?o:0);var u=c.taskId,d=c.cmd,l=c.data,p=c.onsendAccept,h=e.type,f=e.new_rev;null==p||p(u,d,l,h,{errCode:null!==(i=null===(r=null==t?void 0:t.data)||void 0===r?void 0:r.reason)&&void 0!==i?i:0,errMsg:null!==(a=null===(s=null==t?void 0:t.data)||void 0===s?void 0:s.msg)&&void 0!==a?a:"",response:{body:t,new_rev:f}}),this.trySendSerialMessage()}}},e.prototype.handleServerMessage=function(e){var t,n,o=s(e.map((function(e){return c.JsonUtil.parseJson(e)})),2),r=o[0],i=o[1];if(this.messageSendQueue.get(r.task_id))this.handleMessageResultSendAccept(r,i);else if("QUIT_NOTICE"===(null==r?void 0:r.type)&&Object.values(g.QUIT_TYPE).includes(null==i?void 0:i.notice.quit_type)){var a=new Map([[g.QUIT_TYPE.INACTIVE,{code:u.RoomWebsocketErrorCode.INACTIVE,reason:g.QUIT_TYPE.INACTIVE}],[g.QUIT_TYPE.LOGIN_INVALIDATE,{code:u.RoomWebsocketErrorCode.LOGIN_INVALIDATE,reason:g.QUIT_TYPE.LOGIN_INVALIDATE}],[g.QUIT_TYPE.LOGIN_FORBIDDEN,{code:u.RoomWebsocketErrorCode.LOGIN_FORBIDDEN,reason:g.QUIT_TYPE.LOGIN_FORBIDDEN}]]);this.connectManager.disconnect({reason:null===(t=a.get(null==i?void 0:i.notice.quit_type))||void 0===t?void 0:t.reason,errCode:null===(n=a.get(null==i?void 0:i.notice.quit_type))||void 0===n?void 0:n.code,shutDown:!0})}else{var d={head:r,body:i,newRev:r.new_rev,ts:r.ts,needDeal:!0};this.limitFrequencyManager.handleMessage(d),d.needDeal&&this.dependency.receiveMessageFromServer(r.type,[d])}},e.prototype.handleWaitReconnecting=function(){this.handleDisconnect("WaitReconnecting"),this.messageSendQueue.updateMessageState(u.MessageState.WAITING)},e.prototype.handleDisconnect=function(e){c.ConnectionLog.info(this.tag+" handleDisconnect reason:"+e),this.receiver.stopToReceive(),this.sender.clearAllRetryTimer(),this.timeoutChecker.clearTimer(),this.triggerAllMessagesClose()},e.prototype.reconnect=function(e){var t,n;y.default.reconnectReport({module:this.options.module,attrName:e.attrName,status:1,errorMessage:null!==(t=e.reason)&&void 0!==t?t:u.RoomUtil.getWebsocketChannelErrorMessage(null!==(n=Number(e.attrName))&&void 0!==n?n:0)}),this.connectManager.reconnect()},e.prototype.handleLogined=function(e){this.serverRequestParams=e,this.serverRequestParams.routeKey||(this.serverRequestParams.routeKey=this.options.serverVars.globalPadId),this.receiver.receive()},e.prototype.triggerAllMessagesClose=function(){this.triggerAllMessagesError({errCode:u.RoomErrorCode.ROOM_CLOSE,errMsg:"room close"})},e.prototype.triggerAllMessagesShutdown=function(){this.triggerAllMessagesError({errCode:u.RoomErrorCode.ROOM_SHUTDOWN,errMsg:"room shutdown"})},e.prototype.triggerAllMessagesError=function(e){this.messageSendQueue.filter((function(e){return!!e})).forEach((function(t){var n,o=t.taskId,r=t.cmd,i=t.data;null===(n=t.onError)||void 0===n||n.call(t,o,r,i,e)}))},e.prototype.reportCommitError=function(e,t,n){y.default.commitError({attrName:String(t),status:1,cmd:e.cmd,module:this.options.module,errorMessage:null!=n?n:u.RoomUtil.getWebsocketChannelErrorMessage(null!=t?t:0),transports:"big-collab"})},e}();t.MessageCenter=_},a71e91f775:function(e,t,n){var o,r,i=n("bca278778b"),s=n("09eb40a269"),a=0,c=0;e.exports=function(e,t,n){var u=t&&n||0,d=t||[],l=(e=e||{}).node||o,p=void 0!==e.clockseq?e.clockseq:r;if(null==l||null==p){var h=i();null==l&&(l=o=[1|h[0],h[1],h[2],h[3],h[4],h[5]]),null==p&&(p=r=16383&(h[6]<<8|h[7]))}var f=void 0!==e.msecs?e.msecs:(new Date).getTime(),v=void 0!==e.nsecs?e.nsecs:c+1,g=f-a+(v-c)/1e4;if(g<0&&void 0===e.clockseq&&(p=p+1&16383),(g<0||f>a)&&void 0===e.nsecs&&(v=0),v>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=f,c=v,r=p;var m=(1e4*(268435455&(f+=122192928e5))+v)%4294967296;d[u++]=m>>>24&255,d[u++]=m>>>16&255,d[u++]=m>>>8&255,d[u++]=255&m;var E=f/4294967296*1e4&268435455;d[u++]=E>>>8&255,d[u++]=255&E,d[u++]=E>>>24&15|16,d[u++]=E>>>16&255,d[u++]=p>>>8|128,d[u++]=255&p;for(var y=0;y<6;++y)d[u+y]=l[y];return t||s(d)}},a73d724fe4:function(e,t,n){"use strict";n.d(t,"a",(function(){return R}));var o=n("0368aca230"),r=n("a282565e4f");class i{constructor(e){this.incoming=new Map,this.outgoing=new Map,this.data=e}}class s{constructor(e){this.identifier=e,this.innerNodes=new Map}roots(){const e=[];return this.innerNodes.forEach((t=>{0===t.outgoing.size&&e.push(t)})),e}insertEdge(e,t){const n=this.lookupOrInsertNode(e),o=this.lookupOrInsertNode(t);n.outgoing.set(this.identifier.hashId(t),o),o.incoming.set(this.identifier.hashId(e),n)}removeNode(e){const t=this.identifier.hashId(e);this.innerNodes.delete(t),this.innerNodes.forEach((e=>{e.outgoing.delete(t),e.incoming.delete(t)}))}lookupOrInsertNode(e){const t=this.identifier.hashId(e);let n=this.innerNodes.get(t);return n||(n=new i(e),this.innerNodes.set(t,n)),n}lookup(e){return this.innerNodes.get(this.identifier.hashId(e))}isEmpty(){return 0===this.innerNodes.size}dfs(e,t){const n=this.clone(),o=[],i=n.innerNodes.get(n.identifier.hashId(e));if(!i)return;o.push(i);let s=0;for(;o.length;){if(s>1e4)throw new Error(r.g);s+=1;const e=o[o.length-1];e.outgoing.forEach((e=>{o.push(e)})),e.outgoing.size||(n.lookup(e.data)&&(t(e.data),n.removeNode(e.data)),o.pop())}}clone(){const e=new s(this.identifier);return this.innerNodes.forEach((t=>{t.outgoing.forEach((n=>{e.insertEdge(t.data,n.data)}))})),e}toString(){const e=[];return this.innerNodes.forEach((t=>{const n=this.identifier.hashString(t.data),o=[];t.incoming.forEach((e=>{o.push(this.identifier.hashString(e.data))}));const r=[];t.outgoing.forEach((e=>{r.push(this.identifier.hashString(e.data))})),e.push(`${n}, (incoming)[${o.join(", ")}], (outgoing)[${r.join(", ")}]`)})),e.join("\n")}}var a=n("f6998d6780"),c=n("0b588a7d4e"),u=n("8a015847e6"),d=n("d63229afdc");class l{constructor(e){this.didRun=!1,this.executor=()=>{try{this.innerValue=e()}catch(e){this.innerError=e}finally{this.didRun=!0}}}get value(){if(this.didRun||this.executor(),this.innerError)throw this.innerError;return this.innerValue}dispose(e){this.innerValue&&Object(o.isDisposable)(this.innerValue)&&this.innerValue.dispose(e)}}var p=n("af75a08457");let h=!1;class f{constructor(e,t){this.type=e,this.name=t,this._start=Date.now(),this._dep=[]}static traceInvocation(e){return h?new f(1,e.name||e.toString().substring(0,42).replace(/\n/g,"")):f._None}static traceCreation(e){return h?new f(0,e.name):f._None}static traverse(e,t,n=!1){if(!h)return n;let o=n;return null==e||e._dep.forEach(((n,r)=>{const[i,s,a]=n;i===t?!0===o&&!0===s?e._dep[r]=[i,!1,new f(2,i.toString())]:(o=!0,(null==a?void 0:a._dep)&&(null==a?void 0:a._dep.length)>0&&(o=f.traverse(a,t,o))):(null==a?void 0:a._dep)&&(null==a?void 0:a._dep.length)>0&&(o=f.traverse(a,t,o))})),o}branch(e,t){const n=new f(2,e.toString());return this._dep.push([e,t,n]),n}stop(){const e=Date.now()-this._start;f._totals+=e;let t=!1;const n=[`${0===this.type?"CREATE":"CALL"} ${this.name}`,`${function e(n,o){const r=[],i=new Array(n+1).join("\t");for(const[s,a,c]of o._dep)if(a&&c){t=!0,r.push(`${i}CREATES -> ${Object(p.a)(s)}`);const o=e(n+1,c);o&&r.push(o)}else r.push(`${i}uses -> ${Object(p.a)(s)}`);return r.join("\n")}(1,this)}`,`DONE, took ${e.toFixed(2)}ms (grand total ${f._totals.toFixed(2)}ms)`];(e>2||t)&&console.log(n.join("\n"))}}f._None=new class extends f{constructor(){super(-1,null)}stop(){}branch(){return this}},f._totals=0;var v=n("a1644e2245"),g=n("81cf3de5f1"),m=n("fda8d8987d");class E{static addServiceDependencies(e,t,n){Object(m.a)(v.a,e,void 0,t,n)}static getServiceDependencies(e){const t=[],n=g.a.getDepsMetadata(v.a,e);return n?(Object.keys(n).forEach((e=>{const o=n[e];o[1]?t.push({id:o[1].serviceIdentifier,index:parseInt(e,10),query:o[1]}):o[0]&&t.push({id:o[0],index:parseInt(e,10),query:{serviceIdentifier:o[0]}})})),t):t}}class y{constructor(e){this.children=new Set,this.isElderBrother=!1,this.self=e}static linkParentAndChild(e,t){e.addChild(t),t.attachToParent(e)}static linkSibling(e,t){e.addAsRightSibling(t),t.addAsLeftSibling(e)}attachToParent(e,t=!1){if(this.parent&&!t)throw new Error(r.h);this.parent=e}getParent(){return this.parent}addChild(e){this.children.has(e)||this.children.add(e)}walkUp(e){this.walkSiblings((t=>{e(t.getSelfNode())}));const t=this.getElderBrother().getParent();t&&t.walkUp(e)}walkDown(e){this.walkSiblings((t=>{e(t.getSelfNode())}));const t=this.getElderBrother().getChildren();t.size>0&&t.forEach((t=>t.walkDown(e)))}mergeTo(e){if(this.getParent())throw new Error(r.j);const t=e.getElderBrother();this.walkSiblings((e=>{e.setElderBrother(!1),e.getChildren().forEach((e=>{e.attachToParent(t,!0),t.addChild(e)})),e.removeChildren()}));const n=e.getRightTailSiblingNode();e.getRightTailSiblingNode().addAsRightSibling(this.getLeftHeadSiblingNode()),this.getLeftHeadSiblingNode().addAsLeftSibling(n)}getChildren(){return this.children}removeChildren(){this.children.clear()}addAsLeftSibling(e){if(this.leftSibling){const t=this.getLeftHeadSiblingNode();null==t||t.addAsLeftSibling(e)}else this.leftSibling=e}addAsRightSibling(e){if(this.rightSibling){this.getRightTailSiblingNode().addAsRightSibling(e)}else this.rightSibling=e}getLeftSibling(){return this.leftSibling}getRightSibling(){return this.rightSibling}isSelfElder(){return this.isElderBrother}setElderBrother(e){this.isElderBrother=e}getSelfNode(){return this.self}getLeftHeadSiblingNode(){let e=this.getLeftSibling();if(!e)return this;for(;null==e?void 0:e.getLeftSibling();)e=null==e?void 0:e.getLeftSibling();return e||this}getRightTailSiblingNode(){let e=this.getRightSibling();if(!e)return this;for(;null==e?void 0:e.getRightSibling();)e=null==e?void 0:e.getRightSibling();return e||this}getElderBrother(){let e;return this.walkSiblings((t=>{if(t.isSelfElder()||t.getParent()){if(e)throw new Error(r.i);e=t}})),e||this}walkSiblings(e){e(this);let t=this.leftSibling;for(;t;)e(t),t=t.getLeftSibling();let n=this.rightSibling;for(;n;)e(n),n=n.getRightSibling()}}var _=n("9b00d9b77e"),b=n("b8f805ddc2");const C="undefined"!=typeof Proxy;class R{constructor(e=new d.a,t=!1,n){if(this.hookRegistry=new Map,this.commonHookList=[],this.innerService=e,this.strictMode=t,this.innerService.set(u.b,this),this.hierarchyNode=new y(this),n){const e=n.getHierarchyNode();y.linkParentAndChild(e,this.hierarchyNode)}}getHierarchyNode(){return this.hierarchyNode}createChild(e){return new R(e,this.strictMode,this)}addChild(e){y.linkParentAndChild(this.hierarchyNode,e.getHierarchyNode())}attachToParent(e){y.linkParentAndChild(e.getHierarchyNode(),this.hierarchyNode)}getParent(){var e;return null===(e=this.hierarchyNode.getParent())||void 0===e?void 0:e.getSelfNode()}addService(e,t,n){n?this.innerService.setMulti(e,t):this.innerService.set(e,t)}createInstance(e,...t){let n,o;return e instanceof a.a?(n=f.traceCreation(e.ctor),o=this.resolveAndCreateInstance(e.ctor,e.staticArguments.concat(t),n)):(n=f.traceCreation(e),o=this.resolveAndCreateInstance(e,t,n)),n.stop(),o}invokeFunction(e,...t){const n=f.traceInvocation(e);try{return e({get:e=>{const t={serviceIdentifier:e,isMultiInject:!0},o=this.getOrCreateServiceInstance(t,n);if(!o)throw new Error(Object(r.l)(Object(p.a)(e)));return o},getAll:e=>{const t={serviceIdentifier:e,isMultiInject:!0},o=this.getOrCreateServiceInstances(t,n);if(!o)throw new Error(Object(r.l)(Object(p.a)(e)));return o}},...t)}finally{n.stop()}}dispose(e,t=!1){const n=e||o.DisposeTrace.traceRoot("IInstantiationService");this.innerService.teardown((e=>e&&!(e instanceof R)),(e=>!(e instanceof _.a)),(e=>!(e instanceof R)),n),t||this.hierarchyNode.walkDown((e=>{e!==this&&e.dispose(n.branch("IInstantiationService"),!0)})),this.hookRegistry.clear(),this.commonHookList=[],!e&&n&&n.stop()}has(e){let t=!1;return this.hierarchyNode.walkUp((n=>{t||(t=n.innerService.has(e))})),t}getClass(e){let t;return this.hierarchyNode.walkUp((n=>{var o;if(!t){const r=n.innerService.getHolder({serviceIdentifier:e});t=null===(o=null==r?void 0:r.descriptor)||void 0===o?void 0:o.ctor}})),t}addHook(e,t,n){return this.addServiceHook(e,t,n)}addCommonHook(e,t,n){this.commonHookList.push({hookPoint:e,callback:t,filter:n})}mergeTo(e){this.hierarchyNode.mergeTo(e.getHierarchyNode())}addServiceHook(e,t,n){let o=!1;return this.hierarchyNode.walkUp((r=>{if(!o&&r.innerService.has(t)){const i=r.innerService.getAllHolder({serviceIdentifier:t,isMultiInject:!0});null==i||i.forEach((t=>{t.instance&&Object(b.d)(t.instance)&&Object(b.a)(t.instance,e,n)}));r.innerService.getMapping().getMapping(t).forEach((t=>{if(t&&"string"!=typeof t){const i=r.hookRegistry.get(t)||[];i.push({hookPoint:e,callback:n}),r.hookRegistry.set(t,i),o=!0}}))}})),o}resolveAndCreateInstance(e,t=[],n){var o;const i=E.getServiceDependencies(e).sort(((e,t)=>e.index-t.index)),s=[];for(const t of i){const i=t.query.isMultiInject?this.getOrCreateServiceInstances(t.query,n):this.getOrCreateServiceInstance(t.query,n);if(!i&&this.strictMode&&!(null===(o=null==t?void 0:t.query)||void 0===o?void 0:o.isOption))throw new Error(Object(r.e)(e.name,Object(p.a)(t.id)));s.push(i)}const a=new e(...[...this.alignArgs(t,i),...s]);return this.executePostDecorator(e,a),this.executePostHooks(e,a),this.executeCommonPostHooks(a),a}executePostHooks(e,t){const n=this.hookRegistry.get(e);n&&n.forEach((e=>{const{hookPoint:n,callback:o}=e;n===u.a.POST_CONSTRUCTOR&&(t&&Object(b.d)(t)?Object(b.a)(t,n,o):o(t))}))}executeCommonPostHooks(e){this.hierarchyNode.walkDown((t=>{t.commonHookList.forEach((t=>{const{hookPoint:n,callback:o,filter:r}=t;n===u.a.POST_CONSTRUCTOR&&(r&&!r(e)||o(e))}))}))}executePostDecorator(e,t){const n=Object(b.c)(e);n&&t[n].call(t)}alignArgs(e,t){let n=e;const o=t.length>0?t[0].index:e.length;if(e.length!==o){const t=o-e.length;n=t>0?e.concat(new Array(t)):e.slice(0,o)}return n}tryToCacheServiceInstance(e,t){return(null==e?void 0:e.descriptor)instanceof a.a&&(e.instance=t,!0)}getServiceInstanceOrDescriptor(e){let t;return this.hierarchyNode.walkUp((n=>{t||(t=n.innerService.getHolder(e))})),t}getAllServiceInstanceOrDescriptors(e){let t;return this.hierarchyNode.walkUp((n=>{t||(t=n.innerService.getAllHolder(e))})),t}createAndCacheServiceInstance(e,t,n){const o=this.resolveDependencyGraph(e,t,n);return this.createServiceInstanceFromGraph(o)}resolveDependencyGraph(e,t,n){var o;const i=new s({hashId:e=>e.query.serviceIdentifier,hashString:e=>Object(p.a)(e.query.serviceIdentifier)});let a=0;const u=[{query:e,descriptor:t,trace:n}];for(;u.length;){const t=u.pop();if(i.lookupOrInsertNode(t),a>1e3)throw new c.a(i);a+=1;const n=E.getServiceDependencies(t.descriptor.ctor);for(const s of n){const n=this.getAllServiceInstanceOrDescriptors(s.query);n||(null===(o=null==s?void 0:s.query)||void 0===o?void 0:o.isOption)||console.warn(Object(r.c)(Object(p.a)(e.serviceIdentifier),Object(p.a)(s.id)));const a=null==n?void 0:n.filter((e=>e.descriptor));if(a&&(null==a?void 0:a.length)>0&&a[0].descriptor){const e={query:s.query,descriptor:a[0].descriptor,trace:t.trace.branch(s.id,!0)};i.insertEdge(t,e),u.push(e)}}}return i}createServiceInstanceFromGraph(e){let t,n;for(;;){const o=e.roots();if(0===o.length){if(!e.isEmpty())throw new c.a(e);break}for(const{data:r}of o)n=r.descriptor.ctor,t=this.createServiceInstanceWithOwner(r.query,r.descriptor.ctor,r.descriptor.staticArguments,r.descriptor.supportsDelayedInstantiation,r.trace),e.removeNode(r)}if(!t)throw new Error(Object(r.p)(null==n?void 0:n.name));return t}getOrCreateServiceInstance(e,t){var n;const o=this.getServiceInstanceOrDescriptor(e);return!(null==o?void 0:o.instance)&&(null==o?void 0:o.descriptor)?this.createAndCacheServiceInstance(e,o.descriptor,t.branch(e.serviceIdentifier,!0)):(f.traverse(t,e.serviceIdentifier,!1)||t.branch(e.serviceIdentifier,!1),null!==(n=null==o?void 0:o.instance)&&void 0!==n?n:void 0)}getOrCreateServiceInstances(e,t){const n=this.getAllServiceInstanceOrDescriptors(e),o=[];return null==n||n.forEach((n=>{if(n.instance)o.push(n.instance);else if(n.descriptor){const r=this.createAndCacheServiceInstance(e,n.descriptor,t.branch(e.serviceIdentifier,!0));o.push(r)}f.traverse(t,e.serviceIdentifier,!1)||t.branch(e.serviceIdentifier,!1)})),o||void 0}createServiceInstanceWithOwner(e,t,n=[],o,i){let s;if(this.hierarchyNode.walkUp((r=>{var a;if(s)return;const c=r.innerService.getAllHolder(e,(e=>{var n;return(null===(n=e.descriptor)||void 0===n?void 0:n.ctor)===t})),u=null==c?void 0:c[0];s=null!==(a=null==u?void 0:u.instance)&&void 0!==a?a:void 0,s||(null==u?void 0:u.descriptor)&&(s=r.createServiceInstance(t,n,o,i),this.tryToCacheServiceInstance(u,s))})),s)return s;throw new Error(Object(r.d)(t.name))}createServiceInstance(e,t=[],n,o){if(!n||!C)return this.resolveAndCreateInstance(e,t,o);const r=new l((()=>this.resolveAndCreateInstance(e,t,o)));return new Proxy(Object.create(null),{get(e,t){if(t in e)return e[t];const n=r.value;let o=n[t];return"function"!=typeof o||(o=o.bind(n),e[t]=o),o},set:(e,t,n)=>(r.value[t]=n,!0)})}}},aac7a61d2a:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CommonResponseHandler=void 0;var o=function(){function e(){}return e.prototype.handle=function(e){if(e.error)return{error:e.error};var t=e.data,n=t.status,o=t.data;return{status:n,retcode:null==o?void 0:o.retcode,message:null==o?void 0:o.retmsg,data:null==o?void 0:o.Data}},e}();t.CommonResponseHandler=o},ab14ea14de:function(e,t,n){var o=n("bca278778b"),r=n("09eb40a269");e.exports=function(e,t,n){var i=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||o)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[i+a]=s[a];return t||r(s)}},ab167130ca:function(e,t,n){(function(t){
/*!
 * Socket.IO v2.2.0
 * (c) 2014-2018 Guillermo Rauch
 * Released under the MIT License.
 */
e.exports=function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={exports:{},id:o,loaded:!1};return e[o].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function o(e,t){"object"===(void 0===e?"undefined":r(e))&&(t=e,e=void 0),t=t||{};var n,o=i(e),s=o.source,d=o.id,l=o.path,p=u[d]&&l in u[d].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||p?(c("ignoring socket cache for %s",s),n=a(s,t)):(u[d]||(c("new io instance for %s",s),u[d]=a(s,t)),n=u[d]),o.query&&!t.query&&(t.query=o.query),n.socket(o.path,t)}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=n(1),s=n(7),a=n(12),c=n(3)("socket.io-client");e.exports=t=o;var u=t.managers={};t.protocol=s.protocol,t.connect=o,t.Manager=n(12),t.Socket=n(36)},function(e,t,n){"use strict";function o(e,t){var n=e;t=t||"undefined"!=typeof location&&location,null==e&&(e=t.protocol+"//"+t.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(i("protocol-less url %s",e),e=void 0!==t?t.protocol+"//"+e:"https://"+e),i("parse %s",e),n=r(e)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";var o=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+o+":"+n.port,n.href=n.protocol+"://"+o+(t&&t.port===n.port?"":":"+n.port),n}var r=n(2),i=n(3)("socket.io-client:url");e.exports=o},function(e,t){var n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,o=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(e){var t=e,r=e.indexOf("["),i=e.indexOf("]");-1!=r&&-1!=i&&(e=e.substring(0,r)+e.substring(r,i).replace(/:/g,";")+e.substring(i,e.length));for(var s=n.exec(e||""),a={},c=14;c--;)a[o[c]]=s[c]||"";return-1!=r&&-1!=i&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a}},function(e,t,n){(function(o){function r(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function i(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),n){var o="color: "+this.color;e.splice(1,0,o,"color: inherit");var r=0,i=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(r++,"%c"===e&&(i=r))})),e.splice(i,0,o)}}function s(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function a(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}}function c(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==o&&"env"in o&&(e=o.env.DEBUG),e}function u(){try{return window.localStorage}catch(e){}}(t=e.exports=n(5)).log=s,t.formatArgs=i,t.save=a,t.load=c,t.useColors=r,t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:u(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(c())}).call(t,n(4))},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function r(e){if(d===setTimeout)return setTimeout(e,0);if((d===n||!d)&&setTimeout)return d=setTimeout,setTimeout(e,0);try{return d(e,0)}catch(t){try{return d.call(null,e,0)}catch(t){return d.call(this,e,0)}}}function i(e){if(l===clearTimeout)return clearTimeout(e);if((l===o||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(e);try{return l(e)}catch(t){try{return l.call(null,e)}catch(t){return l.call(this,e)}}}function s(){v&&h&&(v=!1,h.length?f=h.concat(f):g=-1,f.length&&a())}function a(){if(!v){var e=r(s);v=!0;for(var t=f.length;t;){for(h=f,f=[];++g<t;)h&&h[g].run();g=-1,t=f.length}h=null,v=!1,i(e)}}function c(e,t){this.fun=e,this.array=t}function u(){}var d,l,p=e.exports={};!function(){try{d="function"==typeof setTimeout?setTimeout:n}catch(e){d=n}try{l="function"==typeof clearTimeout?clearTimeout:o}catch(e){l=o}}();var h,f=[],v=!1,g=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];f.push(new c(e,t)),1!==f.length||v||r(a)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=u,p.addListener=u,p.once=u,p.off=u,p.removeListener=u,p.removeAllListeners=u,p.emit=u,p.prependListener=u,p.prependOnceListener=u,p.listeners=function(e){return[]},p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},function(e,t,n){function o(e){var n,o=0;for(n in e)o=(o<<5)-o+e.charCodeAt(n),o|=0;return t.colors[Math.abs(o)%t.colors.length]}function r(e){function n(){if(n.enabled){var e=n,o=+new Date,i=o-(r||o);e.diff=i,e.prev=r,e.curr=o,r=o;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=t.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var c=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,(function(n,o){if("%%"===n)return n;c++;var r=t.formatters[o];if("function"==typeof r){var i=s[c];n=r.call(e,i),s.splice(c,1),c--}return n})),t.formatArgs.call(e,s),(n.log||t.log||console.log.bind(console)).apply(e,s)}}var r;return n.namespace=e,n.enabled=t.enabled(e),n.useColors=t.useColors(),n.color=o(e),n.destroy=i,"function"==typeof t.init&&t.init(n),t.instances.push(n),n}function i(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}function s(e){t.save(e),t.names=[],t.skips=[];var n,o=("string"==typeof e?e:"").split(/[\s,]+/),r=o.length;for(n=0;n<r;n++)o[n]&&("-"===(e=o[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var i=t.instances[n];i.enabled=t.enabled(i.namespace)}}function a(){t.enable("")}function c(e){if("*"===e[e.length-1])return!0;var n,o;for(n=0,o=t.skips.length;n<o;n++)if(t.skips[n].test(e))return!1;for(n=0,o=t.names.length;n<o;n++)if(t.names[n].test(e))return!0;return!1}function u(e){return e instanceof Error?e.stack||e.message:e}(t=e.exports=r.debug=r.default=r).coerce=u,t.disable=a,t.enable=s,t.enabled=c,t.humanize=n(6),t.instances=[],t.names=[],t.skips=[],t.formatters={}},function(e,t){function n(e){if(!((e=String(e)).length>100)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*d;case"days":case"day":case"d":return n*u;case"hours":case"hour":case"hrs":case"hr":case"h":return n*c;case"minutes":case"minute":case"mins":case"min":case"m":return n*a;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function o(e){return e>=u?Math.round(e/u)+"d":e>=c?Math.round(e/c)+"h":e>=a?Math.round(e/a)+"m":e>=s?Math.round(e/s)+"s":e+"ms"}function r(e){return i(e,u,"day")||i(e,c,"hour")||i(e,a,"minute")||i(e,s,"second")||e+" ms"}function i(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var s=1e3,a=60*s,c=60*a,u=24*c,d=365.25*u;e.exports=function(e,t){t=t||{};var i=typeof e;if("string"===i&&e.length>0)return n(e);if("number"===i&&!1===isNaN(e))return t.long?r(e):o(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,n){function o(){}function r(e){var n=""+e.type;if(t.BINARY_EVENT!==e.type&&t.BINARY_ACK!==e.type||(n+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(n+=e.nsp+","),null!=e.id&&(n+=e.id),null!=e.data){var o=i(e.data);if(!1===o)return m;n+=o}return p("encoded %j as %s",e,n),n}function i(e){try{return JSON.stringify(e)}catch(e){return!1}}function s(e,t){function n(e){var n=f.deconstructPacket(e),o=r(n.packet),i=n.buffers;i.unshift(o),t(i)}f.removeBlobs(e,n)}function a(){this.reconstructor=null}function c(e){var n=0,o={type:Number(e.charAt(0))};if(null==t.types[o.type])return l("unknown packet type "+o.type);if(t.BINARY_EVENT===o.type||t.BINARY_ACK===o.type){for(var r="";"-"!==e.charAt(++n)&&(r+=e.charAt(n),n!=e.length););if(r!=Number(r)||"-"!==e.charAt(n))throw new Error("Illegal attachments");o.attachments=Number(r)}if("/"===e.charAt(n+1))for(o.nsp="";++n&&","!==(s=e.charAt(n))&&(o.nsp+=s,n!==e.length););else o.nsp="/";var i=e.charAt(n+1);if(""!==i&&Number(i)==i){for(o.id="";++n;){var s;if(null==(s=e.charAt(n))||Number(s)!=s){--n;break}if(o.id+=e.charAt(n),n===e.length)break}o.id=Number(o.id)}if(e.charAt(++n)){var a=u(e.substr(n));if(!1===a||o.type!==t.ERROR&&!v(a))return l("invalid payload");o.data=a}return p("decoded %s as %j",e,o),o}function u(e){try{return JSON.parse(e)}catch(e){return!1}}function d(e){this.reconPack=e,this.buffers=[]}function l(e){return{type:t.ERROR,data:"parser error: "+e}}var p=n(3)("socket.io-parser"),h=n(8),f=n(9),v=n(10),g=n(11);t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=o,t.Decoder=a;var m=t.ERROR+'"encode error"';o.prototype.encode=function(e,n){p("encoding packet %j",e),t.BINARY_EVENT===e.type||t.BINARY_ACK===e.type?s(e,n):n([r(e)])},h(a.prototype),a.prototype.add=function(e){var n;if("string"==typeof e)n=c(e),t.BINARY_EVENT===n.type||t.BINARY_ACK===n.type?(this.reconstructor=new d(n),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",n)):this.emit("decoded",n);else{if(!g(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(n=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",n))}},a.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},d.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=f.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},d.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},function(e,t,n){function o(e){if(e)return r(e)}function r(e){for(var t in o.prototype)e[t]=o.prototype[t];return e}e.exports=o,o.prototype.on=o.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},o.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},o.prototype.off=o.prototype.removeListener=o.prototype.removeAllListeners=o.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var o,r=0;r<n.length;r++)if((o=n[r])===t||o.fn===t){n.splice(r,1);break}return this},o.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks["$"+e];if(n)for(var o=0,r=(n=n.slice(0)).length;o<r;++o)n[o].apply(this,t);return this},o.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},o.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t,n){function o(e,t){if(!e)return e;if(s(e)){var n={_placeholder:!0,num:t.length};return t.push(e),n}if(i(e)){for(var r=new Array(e.length),a=0;a<e.length;a++)r[a]=o(e[a],t);return r}if("object"==typeof e&&!(e instanceof Date)){for(var c in r={},e)r[c]=o(e[c],t);return r}return e}function r(e,t){if(!e)return e;if(e&&e._placeholder)return t[e.num];if(i(e))for(var n=0;n<e.length;n++)e[n]=r(e[n],t);else if("object"==typeof e)for(var o in e)e[o]=r(e[o],t);return e}var i=n(10),s=n(11),a=Object.prototype.toString,c="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===a.call(Blob),u="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===a.call(File);t.deconstructPacket=function(e){var t=[],n=e.data,r=e;return r.data=o(n,t),r.attachments=t.length,{packet:r,buffers:t}},t.reconstructPacket=function(e,t){return e.data=r(e.data,t),e.attachments=void 0,e},t.removeBlobs=function(e,t){function n(e,a,d){if(!e)return e;if(c&&e instanceof Blob||u&&e instanceof File){o++;var l=new FileReader;l.onload=function(){d?d[a]=this.result:r=this.result,--o||t(r)},l.readAsArrayBuffer(e)}else if(i(e))for(var p=0;p<e.length;p++)n(e[p],p,e);else if("object"==typeof e&&!s(e))for(var h in e)n(e[h],h,e)}var o=0,r=e;n(r),o||t(r)}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,n){function o(e){return r&&t.isBuffer(e)||i&&(e instanceof ArrayBuffer||s(e))}e.exports=o;var r="function"==typeof t&&"function"==typeof t.isBuffer,i="function"==typeof ArrayBuffer,s=function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer}},function(e,t,n){"use strict";function o(e,t){if(!(this instanceof o))return new o(e,t);e&&"object"===(void 0===e?"undefined":r(e))&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new h({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var n=t.parser||c;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=n(13),s=n(36),a=n(8),c=n(7),u=n(38),d=n(39),l=n(3)("socket.io-client:manager"),p=n(35),h=n(40),f=Object.prototype.hasOwnProperty;e.exports=o,o.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)f.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},o.prototype.updateSocketIds=function(){for(var e in this.nsps)f.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},o.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},a(o.prototype),o.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},o.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},o.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},o.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},o.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},o.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},o.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},o.prototype.open=o.prototype.connect=function(e,t){if(l("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;l("opening %s",this.uri),this.engine=i(this.uri,this.opts);var n=this.engine,o=this;this.readyState="opening",this.skipReconnect=!1;var r=u(n,"open",(function(){o.onopen(),e&&e()})),s=u(n,"error",(function(t){if(l("connect_error"),o.cleanup(),o.readyState="closed",o.emitAll("connect_error",t),e){var n=new Error("Connection error");n.data=t,e(n)}else o.maybeReconnectOnOpen()}));if(!1!==this._timeout){var a=this._timeout;l("connect attempt will timeout after %d",a);var c=setTimeout((function(){l("connect attempt timed out after %d",a),r.destroy(),n.close(),n.emit("error","timeout"),o.emitAll("connect_timeout",a)}),a);this.subs.push({destroy:function(){clearTimeout(c)}})}return this.subs.push(r),this.subs.push(s),this},o.prototype.onopen=function(){l("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(u(e,"data",d(this,"ondata"))),this.subs.push(u(e,"ping",d(this,"onping"))),this.subs.push(u(e,"pong",d(this,"onpong"))),this.subs.push(u(e,"error",d(this,"onerror"))),this.subs.push(u(e,"close",d(this,"onclose"))),this.subs.push(u(this.decoder,"decoded",d(this,"ondecoded")))},o.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},o.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},o.prototype.ondata=function(e){this.decoder.add(e)},o.prototype.ondecoded=function(e){this.emit("packet",e)},o.prototype.onerror=function(e){l("error",e),this.emitAll("error",e)},o.prototype.socket=function(e,t){function n(){~p(r.connecting,o)||r.connecting.push(o)}var o=this.nsps[e];if(!o){o=new s(this,e,t),this.nsps[e]=o;var r=this;o.on("connecting",n),o.on("connect",(function(){o.id=r.generateId(e)})),this.autoConnect&&n()}return o},o.prototype.destroy=function(e){var t=p(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},o.prototype.packet=function(e){l("writing packet %j",e);var t=this;e.query&&0===e.type&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,(function(n){for(var o=0;o<n.length;o++)t.engine.write(n[o],e.options);t.encoding=!1,t.processPacketQueue()})))},o.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},o.prototype.cleanup=function(){l("cleanup");for(var e=this.subs.length,t=0;t<e;t++)this.subs.shift().destroy();this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},o.prototype.close=o.prototype.disconnect=function(){l("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},o.prototype.onclose=function(e){l("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},o.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)l("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();l("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var n=setTimeout((function(){e.skipReconnect||(l("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open((function(t){t?(l("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(l("reconnect success"),e.onreconnect())})))}),t);this.subs.push({destroy:function(){clearTimeout(n)}})}},o.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},function(e,t,n){e.exports=n(14),e.exports.parser=n(21)},function(e,t,n){function o(e,t){return this instanceof o?(t=t||{},e&&"object"==typeof e&&(t=e,e=null),e?(e=d(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=d(t.host).host),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=l.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.transportOptions=t.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized||t.rejectUnauthorized,this.forceNode=!!t.forceNode,this.isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),("undefined"==typeof self||this.isReactNative)&&(t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,void this.open()):new o(e,t)}function r(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}var i=n(15),s=n(8),a=n(3)("engine.io-client:socket"),c=n(35),u=n(21),d=n(2),l=n(29);e.exports=o,o.priorWebsocketSuccess=!1,s(o.prototype),o.protocol=u.protocol,o.Socket=o,o.Transport=n(20),o.transports=n(15),o.parser=n(21),o.prototype.createTransport=function(e){a('creating transport "%s"',e);var t=r(this.query);t.EIO=u.protocol,t.transport=e;var n=this.transportOptions[e]||{};return this.id&&(t.sid=this.id),new i[e]({query:t,socket:this,agent:n.agent||this.agent,hostname:n.hostname||this.hostname,port:n.port||this.port,secure:n.secure||this.secure,path:n.path||this.path,forceJSONP:n.forceJSONP||this.forceJSONP,jsonp:n.jsonp||this.jsonp,forceBase64:n.forceBase64||this.forceBase64,enablesXDR:n.enablesXDR||this.enablesXDR,timestampRequests:n.timestampRequests||this.timestampRequests,timestampParam:n.timestampParam||this.timestampParam,policyPort:n.policyPort||this.policyPort,pfx:n.pfx||this.pfx,key:n.key||this.key,passphrase:n.passphrase||this.passphrase,cert:n.cert||this.cert,ca:n.ca||this.ca,ciphers:n.ciphers||this.ciphers,rejectUnauthorized:n.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:n.perMessageDeflate||this.perMessageDeflate,extraHeaders:n.extraHeaders||this.extraHeaders,forceNode:n.forceNode||this.forceNode,localAddress:n.localAddress||this.localAddress,requestTimeout:n.requestTimeout||this.requestTimeout,protocols:n.protocols||void 0,isReactNative:this.isReactNative})},o.prototype.open=function(){var e;if(this.rememberUpgrade&&o.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout((function(){t.emit("error","No transports available")}),0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},o.prototype.setTransport=function(e){a("setting transport %s",e.name);var t=this;this.transport&&(a("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",(function(){t.onDrain()})).on("packet",(function(e){t.onPacket(e)})).on("error",(function(e){t.onError(e)})).on("close",(function(){t.onClose("transport close")}))},o.prototype.probe=function(e){function t(){if(p.onlyBinaryUpgrades){var t=!this.supportsBinary&&p.transport.supportsBinary;l=l||t}l||(a('probe transport "%s" opened',e),d.send([{type:"ping",data:"probe"}]),d.once("packet",(function(t){if(!l)if("pong"===t.type&&"probe"===t.data){if(a('probe transport "%s" pong',e),p.upgrading=!0,p.emit("upgrading",d),!d)return;o.priorWebsocketSuccess="websocket"===d.name,a('pausing current transport "%s"',p.transport.name),p.transport.pause((function(){l||"closed"!==p.readyState&&(a("changing transport and sending upgrade packet"),u(),p.setTransport(d),d.send([{type:"upgrade"}]),p.emit("upgrade",d),d=null,p.upgrading=!1,p.flush())}))}else{a('probe transport "%s" failed',e);var n=new Error("probe error");n.transport=d.name,p.emit("upgradeError",n)}})))}function n(){l||(l=!0,u(),d.close(),d=null)}function r(t){var o=new Error("probe error: "+t);o.transport=d.name,n(),a('probe transport "%s" failed because of error: %s',e,t),p.emit("upgradeError",o)}function i(){r("transport closed")}function s(){r("socket closed")}function c(e){d&&e.name!==d.name&&(a('"%s" works - aborting "%s"',e.name,d.name),n())}function u(){d.removeListener("open",t),d.removeListener("error",r),d.removeListener("close",i),p.removeListener("close",s),p.removeListener("upgrading",c)}a('probing transport "%s"',e);var d=this.createTransport(e,{probe:1}),l=!1,p=this;o.priorWebsocketSuccess=!1,d.once("open",t),d.once("error",r),d.once("close",i),this.once("close",s),this.once("upgrading",c),d.open()},o.prototype.onOpen=function(){if(a("socket open"),this.readyState="open",o.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){a("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},o.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(a('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else a('packet received with socket readyState "%s"',this.readyState)},o.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},o.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout((function(){"closed"!==t.readyState&&t.onClose("ping timeout")}),e||t.pingInterval+t.pingTimeout)},o.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout((function(){a("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)}),e.pingInterval)},o.prototype.ping=function(){var e=this;this.sendPacket("ping",(function(){e.emit("ping")}))},o.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},o.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(a("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},o.prototype.write=o.prototype.send=function(e,t,n){return this.sendPacket("message",e,t,n),this},o.prototype.sendPacket=function(e,t,n,o){if("function"==typeof t&&(o=t,t=void 0),"function"==typeof n&&(o=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var r={type:e,data:t,options:n};this.emit("packetCreate",r),this.writeBuffer.push(r),o&&this.once("flush",o),this.flush()}},o.prototype.close=function(){function e(){o.onClose("forced close"),a("socket closing - telling transport to close"),o.transport.close()}function t(){o.removeListener("upgrade",t),o.removeListener("upgradeError",t),e()}function n(){o.once("upgrade",t),o.once("upgradeError",t)}if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var o=this;this.writeBuffer.length?this.once("drain",(function(){this.upgrading?n():e()})):this.upgrading?n():e()}return this},o.prototype.onError=function(e){a("socket error %j",e),o.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},o.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){a('socket close with reason: "%s"',e);var n=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),n.writeBuffer=[],n.prevBufferLen=0}},o.prototype.filterUpgrades=function(e){for(var t=[],n=0,o=e.length;n<o;n++)~c(this.transports,e[n])&&t.push(e[n]);return t}},function(e,t,n){function o(e){var t=!1,n=!1,o=!1!==e.jsonp;if("undefined"!=typeof location){var a="https:"===location.protocol,c=location.port;c||(c=a?443:80),t=e.hostname!==location.hostname||c!==e.port,n=e.secure!==a}if(e.xdomain=t,e.xscheme=n,"open"in new r(e)&&!e.forceJSONP)return new i(e);if(!o)throw new Error("JSONP disabled");return new s(e)}var r=n(16),i=n(18),s=n(32),a=n(33);t.polling=o,t.websocket=a},function(e,t,n){var o=n(17);e.exports=function(e){var t=e.xdomain,n=e.xscheme,r=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||o))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!n&&r)return new XDomainRequest}catch(e){}if(!t)try{return new(self[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}},function(e,t){try{e.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){e.exports=!1}},function(e,t,n){function o(){}function r(e){if(c.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,"undefined"!=typeof location){var t="https:"===location.protocol,n=location.port;n||(n=t?443:80),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||n!==e.port,this.xs=e.secure!==t}}function i(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}function s(){for(var e in i.requests)i.requests.hasOwnProperty(e)&&i.requests[e].abort()}var a=n(16),c=n(19),u=n(8),d=n(30),l=n(3)("engine.io-client:polling-xhr");if(e.exports=r,e.exports.Request=i,d(r,c),r.prototype.supportsBinary=!0,r.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new i(e)},r.prototype.doWrite=function(e,t){var n="string"!=typeof e&&void 0!==e,o=this.request({method:"POST",data:e,isBinary:n}),r=this;o.on("success",t),o.on("error",(function(e){r.onError("xhr post error",e)})),this.sendXhr=o},r.prototype.doPoll=function(){l("xhr poll");var e=this.request(),t=this;e.on("data",(function(e){t.onData(e)})),e.on("error",(function(e){t.onError("xhr poll error",e)})),this.pollXhr=e},u(i.prototype),i.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new a(e),n=this;try{l("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var o in t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(o)&&t.setRequestHeader(o,this.extraHeaders[o])}catch(e){}if("POST"===this.method)try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=!0),this.requestTimeout&&(t.timeout=this.requestTimeout),this.hasXDR()?(t.onload=function(){n.onLoad()},t.onerror=function(){n.onError(t.responseText)}):t.onreadystatechange=function(){if(2===t.readyState)try{var e=t.getResponseHeader("Content-Type");n.supportsBinary&&"application/octet-stream"===e&&(t.responseType="arraybuffer")}catch(e){}4===t.readyState&&(200===t.status||1223===t.status?n.onLoad():setTimeout((function(){n.onError(t.status)}),0))},l("xhr data %s",this.data),t.send(this.data)}catch(e){return void setTimeout((function(){n.onError(e)}),0)}"undefined"!=typeof document&&(this.index=i.requestsCount++,i.requests[this.index]=this)},i.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},i.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},i.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},i.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=o:this.xhr.onreadystatechange=o,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete i.requests[this.index],this.xhr=null}},i.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(e){}e="application/octet-stream"===t&&this.xhr.response||this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},i.prototype.hasXDR=function(){return"undefined"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR},i.prototype.abort=function(){this.cleanup()},i.requestsCount=0,i.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",s);else if("function"==typeof addEventListener){var p="onpagehide"in self?"pagehide":"unload";addEventListener(p,s,!1)}},function(e,t,n){function o(e){var t=e&&e.forceBase64;d&&!t||(this.supportsBinary=!1),r.call(this,e)}var r=n(20),i=n(29),s=n(21),a=n(30),c=n(31),u=n(3)("engine.io-client:polling");e.exports=o;var d=null!=new(n(16))({xdomain:!1}).responseType;a(o,r),o.prototype.name="polling",o.prototype.doOpen=function(){this.poll()},o.prototype.pause=function(e){function t(){u("paused"),n.readyState="paused",e()}var n=this;if(this.readyState="pausing",this.polling||!this.writable){var o=0;this.polling&&(u("we are currently polling - waiting to pause"),o++,this.once("pollComplete",(function(){u("pre-pause polling complete"),--o||t()}))),this.writable||(u("we are currently writing - waiting to pause"),o++,this.once("drain",(function(){u("pre-pause writing complete"),--o||t()})))}else t()},o.prototype.poll=function(){u("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},o.prototype.onData=function(e){var t=this;u("polling got data %s",e);var n=function(e,n,o){return"opening"===t.readyState&&t.onOpen(),"close"===e.type?(t.onClose(),!1):void t.onPacket(e)};s.decodePayload(e,this.socket.binaryType,n),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():u('ignoring poll - transport state "%s"',this.readyState))},o.prototype.doClose=function(){function e(){u("writing close packet"),t.write([{type:"close"}])}var t=this;"open"===this.readyState?(u("transport open - closing"),e()):(u("transport not open - deferring close"),this.once("open",e))},o.prototype.write=function(e){var t=this;this.writable=!1;var n=function(){t.writable=!0,t.emit("drain")};s.encodePayload(e,this.supportsBinary,(function(e){t.doWrite(e,n)}))},o.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(e[this.timestampParam]=c()),this.supportsBinary||e.sid||(e.b64=1),e=i.encode(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e}},function(e,t,n){function o(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.isReactNative=e.isReactNative,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}var r=n(21),i=n(8);e.exports=o,i(o.prototype),o.prototype.onError=function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this},o.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},o.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},o.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},o.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},o.prototype.onData=function(e){var t=r.decodePacket(e,this.socket.binaryType);this.onPacket(t)},o.prototype.onPacket=function(e){this.emit("packet",e)},o.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},function(e,t,n){function o(e,n){return n("b"+t.packets[e.type]+e.data.data)}function r(e,n,o){if(!n)return t.encodeBase64Packet(e,o);var r=e.data,i=new Uint8Array(r),s=new Uint8Array(1+r.byteLength);s[0]=E[e.type];for(var a=0;a<i.length;a++)s[a+1]=i[a];return o(s.buffer)}function i(e,n,o){if(!n)return t.encodeBase64Packet(e,o);var r=new FileReader;return r.onload=function(){t.encodePacket({type:e.type,data:r.result},n,!0,o)},r.readAsArrayBuffer(e.data)}function s(e,n,o){if(!n)return t.encodeBase64Packet(e,o);if(m)return i(e,n,o);var r=new Uint8Array(1);return r[0]=E[e.type],o(new b([r.buffer,e.data]))}function a(e){try{e=f.decode(e,{strict:!1})}catch(e){return!1}return e}function c(e,t,n){for(var o=new Array(e.length),r=h(e.length,n),i=function(e,n,r){t(n,(function(t,n){o[e]=n,r(t,o)}))},s=0;s<e.length;s++)i(s,e[s],r)}var u,d=n(22),l=n(23),p=n(24),h=n(25),f=n(26);"undefined"!=typeof ArrayBuffer&&(u=n(27));var v="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),g="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),m=v||g;t.protocol=3;var E=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},y=d(E),_={type:"error",data:"parser error"},b=n(28);t.encodePacket=function(e,t,n,i){"function"==typeof t&&(i=t,t=!1),"function"==typeof n&&(i=n,n=null);var a=void 0===e.data?void 0:e.data.buffer||e.data;if("undefined"!=typeof ArrayBuffer&&a instanceof ArrayBuffer)return r(e,t,i);if(void 0!==b&&a instanceof b)return s(e,t,i);if(a&&a.base64)return o(e,i);var c=E[e.type];return void 0!==e.data&&(c+=n?f.encode(String(e.data),{strict:!1}):String(e.data)),i(""+c)},t.encodeBase64Packet=function(e,n){var o,r="b"+t.packets[e.type];if(void 0!==b&&e.data instanceof b){var i=new FileReader;return i.onload=function(){var e=i.result.split(",")[1];n(r+e)},i.readAsDataURL(e.data)}try{o=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(t){for(var s=new Uint8Array(e.data),a=new Array(s.length),c=0;c<s.length;c++)a[c]=s[c];o=String.fromCharCode.apply(null,a)}return r+=btoa(o),n(r)},t.decodePacket=function(e,n,o){if(void 0===e)return _;if("string"==typeof e){if("b"===e.charAt(0))return t.decodeBase64Packet(e.substr(1),n);if(o&&!1===(e=a(e)))return _;var r=e.charAt(0);return Number(r)==r&&y[r]?e.length>1?{type:y[r],data:e.substring(1)}:{type:y[r]}:_}r=new Uint8Array(e)[0];var i=p(e,1);return b&&"blob"===n&&(i=new b([i])),{type:y[r],data:i}},t.decodeBase64Packet=function(e,t){var n=y[e.charAt(0)];if(!u)return{type:n,data:{base64:!0,data:e.substr(1)}};var o=u.decode(e.substr(1));return"blob"===t&&b&&(o=new b([o])),{type:n,data:o}},t.encodePayload=function(e,n,o){function r(e){return e.length+":"+e}function i(e,o){t.encodePacket(e,!!s&&n,!1,(function(e){o(null,r(e))}))}"function"==typeof n&&(o=n,n=null);var s=l(e);return n&&s?b&&!m?t.encodePayloadAsBlob(e,o):t.encodePayloadAsArrayBuffer(e,o):e.length?void c(e,i,(function(e,t){return o(t.join(""))})):o("0:")},t.decodePayload=function(e,n,o){if("string"!=typeof e)return t.decodePayloadAsBinary(e,n,o);var r;if("function"==typeof n&&(o=n,n=null),""===e)return o(_,0,1);for(var i,s,a="",c=0,u=e.length;c<u;c++){var d=e.charAt(c);if(":"===d){if(""===a||a!=(i=Number(a)))return o(_,0,1);if(a!=(s=e.substr(c+1,i)).length)return o(_,0,1);if(s.length){if(r=t.decodePacket(s,n,!1),_.type===r.type&&_.data===r.data)return o(_,0,1);if(!1===o(r,c+i,u))return}c+=i,a=""}else a+=d}return""!==a?o(_,0,1):void 0},t.encodePayloadAsArrayBuffer=function(e,n){function o(e,n){t.encodePacket(e,!0,!0,(function(e){return n(null,e)}))}return e.length?void c(e,o,(function(e,t){var o=t.reduce((function(e,t){var n;return e+(n="string"==typeof t?t.length:t.byteLength).toString().length+n+2}),0),r=new Uint8Array(o),i=0;return t.forEach((function(e){var t="string"==typeof e,n=e;if(t){for(var o=new Uint8Array(e.length),s=0;s<e.length;s++)o[s]=e.charCodeAt(s);n=o.buffer}r[i++]=t?0:1;var a=n.byteLength.toString();for(s=0;s<a.length;s++)r[i++]=parseInt(a[s]);for(r[i++]=255,o=new Uint8Array(n),s=0;s<o.length;s++)r[i++]=o[s]})),n(r.buffer)})):n(new ArrayBuffer(0))},t.encodePayloadAsBlob=function(e,n){function o(e,n){t.encodePacket(e,!0,!0,(function(e){var t=new Uint8Array(1);if(t[0]=1,"string"==typeof e){for(var o=new Uint8Array(e.length),r=0;r<e.length;r++)o[r]=e.charCodeAt(r);e=o.buffer,t[0]=0}var i=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),s=new Uint8Array(i.length+1);for(r=0;r<i.length;r++)s[r]=parseInt(i[r]);if(s[i.length]=255,b){var a=new b([t.buffer,s.buffer,e]);n(null,a)}}))}c(e,o,(function(e,t){return n(new b(t))}))},t.decodePayloadAsBinary=function(e,n,o){"function"==typeof n&&(o=n,n=null);for(var r=e,i=[];r.byteLength>0;){for(var s=new Uint8Array(r),a=0===s[0],c="",u=1;255!==s[u];u++){if(c.length>310)return o(_,0,1);c+=s[u]}r=p(r,2+c.length),c=parseInt(c);var d=p(r,0,c);if(a)try{d=String.fromCharCode.apply(null,new Uint8Array(d))}catch(e){var l=new Uint8Array(d);for(d="",u=0;u<l.length;u++)d+=String.fromCharCode(l[u])}i.push(d),r=p(r,c)}var h=i.length;i.forEach((function(e,r){o(t.decodePacket(e,n,!0),r,h)}))}},function(e,t){e.exports=Object.keys||function(e){var t=[],n=Object.prototype.hasOwnProperty;for(var o in e)n.call(e,o)&&t.push(o);return t}},function(e,n,o){function r(e){if(!e||"object"!=typeof e)return!1;if(i(e)){for(var n=0,o=e.length;n<o;n++)if(r(e[n]))return!0;return!1}if("function"==typeof t&&t.isBuffer&&t.isBuffer(e)||"function"==typeof ArrayBuffer&&e instanceof ArrayBuffer||a&&e instanceof Blob||c&&e instanceof File)return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return r(e.toJSON(),!0);for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&r(e[s]))return!0;return!1}var i=o(10),s=Object.prototype.toString,a="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===s.call(Blob),c="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===s.call(File);e.exports=r},function(e,t){e.exports=function(e,t,n){var o=e.byteLength;if(t=t||0,n=n||o,e.slice)return e.slice(t,n);if(t<0&&(t+=o),n<0&&(n+=o),n>o&&(n=o),t>=o||t>=n||0===o)return new ArrayBuffer(0);for(var r=new Uint8Array(e),i=new Uint8Array(n-t),s=t,a=0;s<n;s++,a++)i[a]=r[s];return i.buffer}},function(e,t){function n(e,t,n){function r(e,o){if(r.count<=0)throw new Error("after called too many times");--r.count,e?(i=!0,t(e),t=n):0!==r.count||i||t(null,o)}var i=!1;return n=n||o,r.count=e,0===e?t():r}function o(){}e.exports=n},function(e,t){function n(e){for(var t,n,o=[],r=0,i=e.length;r<i;)(t=e.charCodeAt(r++))>=55296&&t<=56319&&r<i?56320==(64512&(n=e.charCodeAt(r++)))?o.push(((1023&t)<<10)+(1023&n)+65536):(o.push(t),r--):o.push(t);return o}function o(e){for(var t,n=e.length,o=-1,r="";++o<n;)(t=e[o])>65535&&(r+=f((t-=65536)>>>10&1023|55296),t=56320|1023&t),r+=f(t);return r}function r(e,t){if(e>=55296&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function i(e,t){return f(e>>t&63|128)}function s(e,t){if(0==(4294967168&e))return f(e);var n="";return 0==(4294965248&e)?n=f(e>>6&31|192):0==(4294901760&e)?(r(e,t)||(e=65533),n=f(e>>12&15|224),n+=i(e,6)):0==(4292870144&e)&&(n=f(e>>18&7|240),n+=i(e,12),n+=i(e,6)),n+f(63&e|128)}function a(e,t){for(var o=!1!==(t=t||{}).strict,r=n(e),i=r.length,a=-1,c="";++a<i;)c+=s(r[a],o);return c}function c(){if(h>=p)throw Error("Invalid byte index");var e=255&l[h];if(h++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function u(e){var t,n;if(h>p)throw Error("Invalid byte index");if(h==p)return!1;if(t=255&l[h],h++,0==(128&t))return t;if(192==(224&t)){if((n=(31&t)<<6|c())>=128)return n;throw Error("Invalid continuation byte")}if(224==(240&t)){if((n=(15&t)<<12|c()<<6|c())>=2048)return r(n,e)?n:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&(n=(7&t)<<18|c()<<12|c()<<6|c())>=65536&&n<=1114111)return n;throw Error("Invalid UTF-8 detected")}function d(e,t){var r=!1!==(t=t||{}).strict;l=n(e),p=l.length,h=0;for(var i,s=[];!1!==(i=u(r));)s.push(i);return o(s)}/*! https://mths.be/utf8js v2.1.2 by @mathias */var l,p,h,f=String.fromCharCode;e.exports={version:"2.1.2",encode:a,decode:d}},function(e,t){!function(){"use strict";for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(256),o=0;o<e.length;o++)n[e.charCodeAt(o)]=o;t.encode=function(t){var n,o=new Uint8Array(t),r=o.length,i="";for(n=0;n<r;n+=3)i+=e[o[n]>>2],i+=e[(3&o[n])<<4|o[n+1]>>4],i+=e[(15&o[n+1])<<2|o[n+2]>>6],i+=e[63&o[n+2]];return r%3==2?i=i.substring(0,i.length-1)+"=":r%3==1&&(i=i.substring(0,i.length-2)+"=="),i},t.decode=function(e){var t,o,r,i,s,a=.75*e.length,c=e.length,u=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var d=new ArrayBuffer(a),l=new Uint8Array(d);for(t=0;t<c;t+=4)o=n[e.charCodeAt(t)],r=n[e.charCodeAt(t+1)],i=n[e.charCodeAt(t+2)],s=n[e.charCodeAt(t+3)],l[u++]=o<<2|r>>4,l[u++]=(15&r)<<4|i>>2,l[u++]=(3&i)<<6|63&s;return d}}()},function(e,t){function n(e){return e.map((function(e){if(e.buffer instanceof ArrayBuffer){var t=e.buffer;if(e.byteLength!==t.byteLength){var n=new Uint8Array(e.byteLength);n.set(new Uint8Array(t,e.byteOffset,e.byteLength)),t=n.buffer}return t}return e}))}function o(e,t){t=t||{};var o=new i;return n(e).forEach((function(e){o.append(e)})),t.type?o.getBlob(t.type):o.getBlob()}function r(e,t){return new Blob(n(e),t||{})}var i=void 0!==i?i:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder&&MozBlobBuilder,s=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),a=s&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),c=i&&i.prototype.append&&i.prototype.getBlob;"undefined"!=typeof Blob&&(o.prototype=Blob.prototype,r.prototype=Blob.prototype),e.exports=s?a?Blob:r:c?o:void 0},function(e,t){t.encode=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},t.decode=function(e){for(var t={},n=e.split("&"),o=0,r=n.length;o<r;o++){var i=n[o].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}},function(e,t){e.exports=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t){"use strict";function n(e){var t="";do{t=s[e%a]+t,e=Math.floor(e/a)}while(e>0);return t}function o(e){var t=0;for(d=0;d<e.length;d++)t=t*a+c[e.charAt(d)];return t}function r(){var e=n(+new Date);return e!==i?(u=0,i=e):e+"."+n(u++)}for(var i,s="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),a=64,c={},u=0,d=0;d<a;d++)c[s[d]]=d;r.encode=n,r.decode=o,e.exports=r},function(e,t,n){(function(t){function o(){}function r(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{}}function i(e){if(s.call(this,e),this.query=this.query||{},!c){var t=r();c=t.___eio=t.___eio||[]}this.index=c.length;var n=this;c.push((function(e){n.onData(e)})),this.query.j=this.index,"function"==typeof addEventListener&&addEventListener("beforeunload",(function(){n.script&&(n.script.onerror=o)}),!1)}var s=n(19),a=n(30);e.exports=i;var c,u=/\n/g,d=/\\n/g;a(i,s),i.prototype.supportsBinary=!1,i.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),s.prototype.doClose.call(this)},i.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(t,n):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout((function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)}),100)},i.prototype.doWrite=function(e,t){function n(){o(),t()}function o(){if(r.iframe)try{r.form.removeChild(r.iframe)}catch(e){r.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+r.iframeId+'">';i=document.createElement(e)}catch(e){(i=document.createElement("iframe")).name=r.iframeId,i.src="javascript:0"}i.id=r.iframeId,r.form.appendChild(i),r.iframe=i}var r=this;if(!this.form){var i,s=document.createElement("form"),a=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;s.className="socketio",s.style.position="absolute",s.style.top="-1000px",s.style.left="-1000px",s.target=c,s.method="POST",s.setAttribute("accept-charset","utf-8"),a.name="d",s.appendChild(a),document.body.appendChild(s),this.form=s,this.area=a}this.form.action=this.uri(),o(),e=e.replace(d,"\\\n"),this.area.value=e.replace(u,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===r.iframe.readyState&&n()}:this.iframe.onload=n}}).call(t,function(){return this}())},function(e,n,o){function r(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=i&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(h=s),a.call(this,e)}var i,s,a=o(20),c=o(21),u=o(29),d=o(30),l=o(31),p=o(3)("engine.io-client:websocket");if("undefined"==typeof self)try{s=o(34)}catch(e){}else i=self.WebSocket||self.MozWebSocket;var h=i||s;e.exports=r,d(r,a),r.prototype.name="websocket",r.prototype.supportsBinary=!0,r.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=this.protocols,n={agent:this.agent,perMessageDeflate:this.perMessageDeflate};n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(n.headers=this.extraHeaders),this.localAddress&&(n.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?t?new h(e,t):new h(e):new h(e,t,n)}catch(e){return this.emit("error",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},r.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(t){t&&window.log&&window.log.info&&window.log.info("ConnectionLog socket.io onclose code:"+t.code+", reason:"+t.reason+",wasClean:"+t.wasClean),e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},r.prototype.write=function(e){function n(){o.emit("flush"),setTimeout((function(){o.writable=!0,o.emit("drain")}),0)}var o=this;this.writable=!1;for(var r=e.length,i=0,s=r;i<s;i++)!function(e){c.encodePacket(e,o.supportsBinary,(function(i){if(!o.usingBrowserWebSocket){var s={};e.options&&(s.compress=e.options.compress),o.perMessageDeflate&&("string"==typeof i?t.byteLength(i):i.length)<o.perMessageDeflate.threshold&&(s.compress=!1)}try{o.usingBrowserWebSocket?o.ws.send(i):o.ws.send(i,s)}catch(e){p("websocket closed before onclose event")}--r||n()}))}(e[i])},r.prototype.onClose=function(){a.prototype.onClose.call(this)},r.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},r.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=l()),this.supportsBinary||(e.b64=1),(e=u.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e},r.prototype.check=function(){return!(!h||"__initialize"in h&&this.name===r.prototype.name)}},function(e,t){},function(e,t){var n=[].indexOf;e.exports=function(e,t){if(n)return e.indexOf(t);for(var o=0;o<e.length;++o)if(e[o]===t)return o;return-1}},function(e,t,n){"use strict";function o(e,t,n){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=n(7),s=n(8),a=n(37),c=n(38),u=n(39),d=n(3)("socket.io-client:socket"),l=n(29),p=n(23);e.exports=o;var h={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},f=s.prototype.emit;s(o.prototype),o.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[c(e,"open",u(this,"onopen")),c(e,"packet",u(this,"onpacket")),c(e,"close",u(this,"onclose"))]}},o.prototype.open=o.prototype.connect=function(){return this.connected||(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting")),this},o.prototype.send=function(){var e=a(arguments);return e.unshift("message"),this.emit.apply(this,e),this},o.prototype.emit=function(e){if(h.hasOwnProperty(e))return f.apply(this,arguments),this;var t=a(arguments),n={type:(void 0!==this.flags.binary?this.flags.binary:p(t))?i.BINARY_EVENT:i.EVENT,data:t,options:{}};return n.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(d("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),n.id=this.ids++),this.connected?this.packet(n):this.sendBuffer.push(n),this.flags={},this},o.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},o.prototype.onopen=function(){if(d("transport is open - connecting"),"/"!==this.nsp)if(this.query){var e="object"===r(this.query)?l.encode(this.query):this.query;d("sending connect packet with query %s",e),this.packet({type:i.CONNECT,query:e})}else this.packet({type:i.CONNECT})},o.prototype.onclose=function(e){d("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},o.prototype.onpacket=function(e){var t=e.nsp===this.nsp,n=e.type===i.ERROR&&"/"===e.nsp;if(t||n)switch(e.type){case i.CONNECT:this.onconnect();break;case i.EVENT:case i.BINARY_EVENT:this.onevent(e);break;case i.ACK:case i.BINARY_ACK:this.onack(e);break;case i.DISCONNECT:this.ondisconnect();break;case i.ERROR:this.emit("error",e.data)}},o.prototype.onevent=function(e){var t=e.data||[];d("emitting event %j",t),null!=e.id&&(d("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?f.apply(this,t):this.receiveBuffer.push(t)},o.prototype.ack=function(e){var t=this,n=!1;return function(){if(!n){n=!0;var o=a(arguments);d("sending ack %j",o),t.packet({type:p(o)?i.BINARY_ACK:i.ACK,id:e,data:o})}}},o.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(d("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):d("bad ack %s",e.id)},o.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},o.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)f.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},o.prototype.ondisconnect=function(){d("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},o.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},o.prototype.close=o.prototype.disconnect=function(){return this.connected&&(d("performing disconnect (%s)",this.nsp),this.packet({type:i.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},o.prototype.compress=function(e){return this.flags.compress=e,this},o.prototype.binary=function(e){return this.flags.binary=e,this}},function(e,t){function n(e,t){for(var n=[],o=(t=t||0)||0;o<e.length;o++)n[o-t]=e[o];return n}e.exports=n},function(e,t){"use strict";function n(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}}e.exports=n},function(e,t){var n=[].slice;e.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var o=n.call(arguments,2);return function(){return t.apply(e,o.concat(n.call(arguments)))}}},function(e,t){function n(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}e.exports=n,n.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},n.prototype.reset=function(){this.attempts=0},n.prototype.setMin=function(e){this.ms=e},n.prototype.setMax=function(e){this.max=e},n.prototype.setJitter=function(e){this.jitter=e}}])}).call(this,n("ec247fcea0").Buffer)},aceb389a01:function(e,t,n){"use strict";var o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return s},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RoomWebsocketMessageSender=void 0;var i=n("cf3c69206c"),s=n("dee170f313"),a=n("cdda668c2b"),c=n("c0f85d03df"),u=n("1eb2641e35"),d=n("193c542c4e"),l=n("afc95ccd7b"),p=r(n("751778941b")),h=n("eee882e93f"),f=n("4baf8e9ea0"),v=n("d3819be4ca"),g=function(){function e(e,t,n){var o,r,i=this;this.reconnectTimes=[],this.liteReconnects=0,this.socketDisconnectTimer=0,this.reopenDelayTimer=0,this.websocketDisconneted=!1,this.hasSocketReconnected=!1,this.messageSenderTimer=0,this.channelOption=e,this.controllerDependency=t,this.roomChannelDependency=n,this.roomMsgQueue=new f.RoomWebsocketMessageQueue(this),this.limitFrequencyManager=new v.LimitFrequencyManager(this.controllerDependency),null===(r=null===(o=this.channelOption.config)||void 0===o?void 0:o.messagePriority)||void 0===r||r.forEach((function(e,t){i.limitFrequencyManager.setPriority(t,e)}))}return e.prototype.dispose=function(){var e,t;null===(e=this.roomWebsocket)||void 0===e||e.dispose(),this.roomMsgQueue.dispose(),this.clearSocket(),null===(t=this.limitFrequencyManager)||void 0===t||t.dispose()},e.prototype.openWebsocketConnection=function(){this.isConnected()?a.ConnectionLog.warn("openWebsocketConnection: already exist."):this.roomChannelDependency.getRoomState()!==c.RoomState.SHUTDOWN?this.createWebsocketAndConnect():a.ConnectionLog.error("openWebsocketConnection: room state shut down.")},e.prototype.isConnected=function(){var e,t;return!this.websocketDisconneted&&null!==(t=null===(e=this.roomWebsocket)||void 0===e?void 0:e.isConnected())&&void 0!==t&&t},e.prototype.shutDown=function(e){var t;a.ConnectionLog.info("shutDown, close reason: "+e.reason+", errCode:"+e.errCode),e.reason=null!==(t=e.reason)&&void 0!==t?t:"close by client.",this.clearSocket(),e.shutDown=!0,this.notifyRoomClosed(e,0)},e.prototype.sendMessage=function(e){if(a.isInvalidWaitAcceptCmd(e))a.ConnectionLog.error("sendMessage: waitAcceptCmd params invalid!"),this.doErrorCallback(e,{errCode:d.RoomErrorCode.PARA_ERROR,errMsg:"msg param invalid."});else if(this.roomChannelDependency.getRoomState()!==c.RoomState.OPENED){var t=this.roomChannelDependency.getRoomState();a.ConnectionLog.warn("sendMessage: room state error, state = "+t+"!"),this.needReopen()&&this.reopen(),this.doErrorCallback(e,{errCode:t===c.RoomState.SHUTDOWN?d.RoomErrorCode.ROOM_SHUTDOWN:d.RoomErrorCode.ROOM_STATE_ERR,errMsg:"can not send message in this room state."})}else this.sendMessageInternal(e)},e.prototype.cancelSendMessageByTaskId=function(e){var t=this.roomMsgQueue.cancelMessage(e);(null==t?void 0:t.state)===c.MessageState.SENDING&&this.startMessageSending()},e.prototype.postMessageWithWebsocket=function(e){var t;null===(t=this.roomWebsocket)||void 0===t||t.postMessageForWebSocket(e)},e.prototype.createPostData=function(e,t,n,o){var r,i,s=Number(this.channelOption.userId.startsWith("g")),c=this.channelOption.uid||this.channelOption.userId.replace("p.","").replace("g.",""),u={apid:this.channelOption.apId,type:e,task_id:t,docid:this.channelOption.globalPadId,uid:c,cookie:a.getCookieForMessage(),base_rev:"object"==typeof n&&"number"==typeof n.baseRev?n.baseRev:this.controllerDependency.getVersion(),code_ver:this.channelOption.codeVer,session_type:s,gray:this.channelOption.gray,dver:this.channelOption.dver,wl:a.Cookie.get("wl"),u:this.channelOption.nowUserIndex,generalpacket:this.controllerDependency.getHeaderGeneralPacket(),docs_type:this.channelOption.padType};(null===(r=this.channelOption.config)||void 0===r?void 0:r.connectMode)===l.ConnectMode.WEBSOCKET_FORCED&&(u.model="websocket"),u=Object.assign(null!=o?o:{},u);var d=a.JsonUtil.jsonStringify(u)+"\n";return d+=null!==(i=h.prepareCommitMessage(n,this.channelOption.uuId,this.channelOption.pver))&&void 0!==i?i:""},e.prototype.startMessageSending=function(){this.roomMsgQueue.messageCount()>0&&this.trySendPendingMessage()},e.prototype.notifyRoomOpened=function(){this.limitFrequencyManager.reset()},e.prototype.closeAndDelayReopen=function(e,t){var n;e.reason=null!==(n=e.reason)&&void 0!==n?n:"close by client.",a.ConnectionLog.info("closeAndDelayReopen: close reason = "+e.reason+", delay time = "+t),this.clearSocket(),e.shutDown=!1,this.notifyRoomClosed(e,t)},e.prototype.onSocketStatusChanged=function(e){e.event?("open"!==e.event&&this.roomChannelDependency.getRoomState()!==c.RoomState.SHUTDOWN&&this.roomChannelDependency.roomStateReconnecting(),this.handleSocketStatusChangeEvent(e)):a.ConnectionLog.warn("onSocketStatusChanged: channel info error.")},e.prototype.onGetMessageFromServerPush=function(e){var t=e.split("\r\n");t instanceof Array?this.parseGetMsgDataList(t):a.ConnectionLog.error("onGetMessageFromServer: message data error.")},e.prototype.onPostFromServer=function(e){var t=e.split("\n"),n=o(t.map((function(e){return a.JsonUtil.parseJson(e)})),2),r=n[0],i=n[1];r&&i?"HEART_BEAT"!==r.type?"CLIENT_READY"!==r.type?this.parsePostCommonMessageFromServer(r,i):this.roomChannelDependency.onLoginResponse(r,i):this.roomChannelDependency.onHeartBeatResponse(r,i):a.ConnectionLog.error("onPostFromServer: message data parsed error.")},e.prototype.onSocketOpen=function(){this.liteReconnects=0,this.reconnectTimes=[],this.websocketDisconneted=!1,this.hasSocketReconnected=!1,a.ConnectionLog.info("onSocketOpenEvent"),this.clearDisconnectTimer(),this.clearReopenDelayTimer(),this.roomChannelDependency.resetHeartBeat(),this.roomChannelDependency.resetLogin(),this.roomChannelDependency.loginRoom()},e.prototype.onSocketClosed=function(e){a.ConnectionLog.info("onSocketClosedEvent: socket closed!"),this.roomWebsocket=null,this.notifyRoomClosed({reason:e,shutDown:!1},0),this.hasSocketReconnected&&this.controllerDependency.networkReconnectedFail()},e.prototype.onReopenCount=function(){return this.liteReconnects},e.prototype.doErrorCallback=function(e,t){e.onError(e.taskId,e.cmd,e.data,t)},e.prototype.reportMessage=function(e,t){var n={cmd:e.cmd,attrName:String(t.errCode),status:1,module:this.channelOption.module,errorMessage:t.errMsg,waitAcceptCmd:t.waitAcceptCmd};p.default.commitError(n)},e.prototype.sendMessageInternal=function(e){var t,n,o,r,i,s;if(this.roomMsgQueue.messageAlreadyExist(e))this.doErrorCallback(e,{errCode:d.RoomErrorCode.EXIST,errMsg:"msg already exist."});else{var c,l=e.taskId||a.generateMessageTaskId(),p=this.createPostData(e.cmd,l,e.data,e.additionalFieldsToHead);(null===(t=e.customParam)||void 0===t?void 0:t.waitAcceptCmd)&&(c=null===(n=e.customParam)||void 0===n?void 0:n.waitAcceptCmd);var f=u.RoomUtil.createNewMessage(l,p,null!==(r=null===(o=e.customParam)||void 0===o?void 0:o.timeout)&&void 0!==r?r:h.DEFAULT_SEND_MESSAGE_TIMEOUT,null!==(s=null===(i=e.customParam)||void 0===i?void 0:i.maxRetryCount)&&void 0!==s?s:h.DEFAULT_RETRY_COUNTS,e.cmd,e.data,c,e.onError,e.onsend,e.onsendAccept);this.roomMsgQueue.addWaittingMessage(f),this.startMessageSending(),this.startMessageTimer()}},e.prototype.handleSocketStatusChangeEvent=function(e){var t;a.ConnectionLog.info("handleSocketStatusChangeEvent: "+e.event+" reason: "+(null!==(t=e.disconnectReason)&&void 0!==t?t:e.failReason)),"reconnecting"===e.event?this.hasSocketReconnected=!0:"disconnect"===e.event&&this.handleDisconnectEvent(e)},e.prototype.createWebsocketAndConnect=function(){if(this.roomWebsocket)a.ConnectionLog.warn("createWebsocketAndConnect:socket has exist");else{var e={padId:this.channelOption.padId,roomWebSocketDependency:this,tag:this.channelOption.padId,gid:this.channelOption.globalPadId,upid:this.channelOption.upid||"",sig:this.channelOption.sig,uid:this.channelOption.uid,uidKey:a.Cookie.get("uid_key"),wmode:this.channelOption.wmode,websocketReopenCount:this.channelOption.websocketReopenCount,pollingAttemptNumber:this.channelOption.pollingAttemptNumber,nowUserIndex:this.channelOption.nowUserIndex,module:this.channelOption.module,config:this.channelOption.config};this.roomWebsocket=new s.RoomWebsocket(e),this.roomWebsocket.connect(),this.setupSocketTime=u.RoomUtil.getCurrentTime()}},e.prototype.clearSocket=function(){this.roomWebsocket&&(this.roomWebsocket.disconnect(""),this.clearDisconnectTimer()),this.roomWebsocket=null},e.prototype.reopen=function(){a.ConnectionLog.info("reopen: socket reopen."),this.clearSocket(),this.roomChannelDependency.resetHeartBeat(),this.roomChannelDependency.resetLogin(),this.openWebsocketConnection()},e.prototype.needReopen=function(){var e=this.roomChannelDependency.getRoomState();if(e===c.RoomState.CONNECTING||e===c.RoomState.RECONNECTING_IN_CLOSED){var t=u.RoomUtil.getCurrentTime();if(this.setupSocketTime&&t>this.setupSocketTime&&t-this.setupSocketTime>5e4)return!0}return!1},e.prototype.notifyRoomClosed=function(e,t){a.ConnectionLog.info("notifyRoomClosed: reason = "+e.reason+", shutdown = "+e.shutDown),this.clearDisconnectTimer(),this.websocketDisconneted=!0,this.roomChannelDependency.resetHeartBeat(),this.roomChannelDependency.resetLogin(),this.roomChannelDependency.onRoomClosed(e),this.roomMsgQueue.handleMessageQueueByRoomClose(e.shutDown),e.shutDown?(this.reset(),this.clearMessageSenderTimer()):this.delayReopen(t)},e.prototype.delayReopen=function(e){var t=this;if(!this.reopenDelayTimer){this.reconnectTimes.push(u.RoomUtil.getCurrentTime()),this.liteReconnects+=1;var n=e;e||(n=Math.min(3e4,1e3*Math.pow(2,this.liteReconnects+1)),n=this.generateFuzzyInterval(n,.4*n)),this.reopenDelayTimer=setTimeout((function(){t.clearReopenDelayTimer(),t.roomChannelDependency.openRoom()}),n)}},e.prototype.generateFuzzyInterval=function(e,t){return e+Math.floor(Math.random()*(2*t+1)-t)},e.prototype.reset=function(){this.roomWebsocket=null,this.liteReconnects=0,this.reconnectTimes=[],this.clearDisconnectTimer(),this.clearReopenDelayTimer(),this.roomChannelDependency.resetLogin(),this.roomChannelDependency.resetHeartBeat()},e.prototype.parsePostCommonMessageFromServer=function(e,t){var n=this.roomMsgQueue.getMessageByTaskId(e.task_id);n&&n.cmd===e.type?(this.handleCommonMessage(n,t),this.finishParseMessage(n,t)):this.roomMsgQueue.getFinishedMessageByTaskId(e.task_id)||a.ConnectionLog.warn("parsePostCommonMessageFromServer: msg not found! seq = "+e.task_id+", cmd = "+e.type);this.startMessageSending(),this.roomMsgQueue.clearFinishQueueIfNeed()},e.prototype.finishParseMessage=function(e,t){var n,o=t.onpost.result;(null===(n=e.waitAcceptCmd)||void 0===n?void 0:n.length)&&0===o?e.state=c.MessageState.WAIT_ACCEPT:this.roomMsgQueue.addFinishMessage(e),this.startMessageSending()},e.prototype.handleCommonMessage=function(e,t){e.onpostTime=u.RoomUtil.getCurrentTime();var n=t.onpost.result,o=t.onpost.retry_interval;if(n!==d.RoomWebsocketErrorCode.SOCKET_SERVER_SUCCESS&&a.ConnectionLog.error("handleCommonMessage: server response error, code = "+n),this.reportMsgParseErrorIfNeed(n,e,t),n!==d.RoomWebsocketErrorCode.SOCKET_SERVER_ERROR&&n!==d.RoomWebsocketErrorCode.SOCKET_USER_AUTH_FAILED)if(n!==d.RoomWebsocketErrorCode.SOCKET_LAYER_ERROR){var r={errCode:n,errMsg:"",response:t};n===d.RoomWebsocketErrorCode.SOCKET_SERVER_SUCCESS?this.doMsgOnSendSuccessCallback(e,r):this.doErrorCallback(e,r)}else this.closeAndDelayReopen({errCode:n,reason:u.RoomUtil.getWebsocketChannelErrorMessage(n),shutDown:!1},o);else this.shutDown({errCode:n,reason:u.RoomUtil.getWebsocketChannelErrorMessage(n),shutDown:!0})},e.prototype.reportMsgParseErrorIfNeed=function(e,t,n){if(e!==d.RoomWebsocketErrorCode.SOCKET_SERVER_SUCCESS){var o={errCode:e,errMsg:u.RoomUtil.getWebsocketChannelErrorMessage(e),event:c.MessageResultEvent.ON_POST,response:n,needRetry:!1};this.reportMessage(t,o)}},e.prototype.trySendPendingMessage=function(){this.needReopen()?this.reopen():this.readyToSendMessage()&&this.sendWaitingMessage()},e.prototype.sendWaitingMessage=function(){var e=this.roomMsgQueue.getFirstWaittingMessage();e&&(this.postOneMessage(e),this.startMessageTimer())},e.prototype.postOneMessage=function(e){this.preparePostMessage(e),this.postMessageWithWebsocket(e.postData)},e.prototype.preparePostMessage=function(e){0!==e.retryCount&&e.firstSendTime||(e.firstSendTime=u.RoomUtil.getCurrentTime()),e.retryCount+=1,e.lastSendTime=u.RoomUtil.getCurrentTime(),e.onpostTime=0,e.state=c.MessageState.SENDING},e.prototype.startMessageTimer=function(){var e=this;this.messageSenderTimer||(this.messageSenderTimer=setTimeout((function(){e.handleMessageTimer()}),1e3))},e.prototype.handleMessageTimer=function(){this.clearMessageSenderTimer();var e=this.roomMsgQueue.processMessageQueue();this.roomMsgQueue.messageCount()>0&&(e&&this.startMessageSending(),this.startMessageTimer())},e.prototype.readyToSendMessage=function(){return this.roomChannelDependency.getRoomState()===c.RoomState.OPENED&&this.isConnected()?this.roomMsgQueue.readyToSendMessage():(a.ConnectionLog.warn("readyToSendMessage: roomstate = "+this.roomChannelDependency.getRoomState()+", websocket connected = "+this.isConnected()),!1)},e.prototype.handleMessageErrorCode=function(e,t){var n={attrName:String(e),status:1,module:this.channelOption.module,errorMessage:u.RoomUtil.getWebsocketChannelErrorMessage(e)};this.shutDown({reason:t,errCode:e,shutDown:!0}),p.default.shutDownReport(n)},e.prototype.receiveMessageFromServer=function(e,t){var n,o={head:e,body:t,newRev:e.new_rev,ts:e.ts,socketId:(null===(n=this.roomWebsocket)||void 0===n?void 0:n.socketId)||"",needDeal:!0};this.limitFrequencyManager.handleMessage(o),o.needDeal&&this.controllerDependency.receiveMessageFromServer(e.type,[o])},e.prototype.handleWaitAcceptMessage=function(e,t){var n=this.roomMsgQueue.getMessageByTaskId(e.task_id);n?this.processWaitAcceptMessage(n,e,t)?this.roomMsgQueue.addFinishMessage(n):a.ConnectionLog.error("processWaitAcceptMessage: msg found but waitcmd not match. seq = "+n.taskId+", cmd = "+n.cmd+", wait cmd = "+e.type):(n=this.roomMsgQueue.getFinishedMessageByTaskId(e.task_id))||this.receiveMessageFromServer(e,t)},e.prototype.hasWaitAcceptCommand=function(e,t){var n;return!!(null===(n=e.waitAcceptCmd)||void 0===n?void 0:n.includes(t))},e.prototype.processWaitAcceptMessage=function(e,t,n){var o,r,i,s;if(this.hasWaitAcceptCommand(e,t.type)){this.doMsgOnSendAcceptSuccessCallback(e,t,n);var a={errCode:null!==(r=null===(o=n.data)||void 0===o?void 0:o.reason)&&void 0!==r?r:0,errMsg:u.RoomUtil.getWebsocketChannelErrorMessage(null!==(s=null===(i=n.data)||void 0===i?void 0:i.reason)&&void 0!==s?s:0),waitAcceptCmd:t.type,event:c.MessageResultEvent.ON_SEND_ACCEPT,response:n,needRetry:!1};return this.reportMessage(e,a),!0}return!1},e.prototype.parseGetMsgDataList=function(e){for(var t=0;t<e.length;t++){var n=e[t].split("\n");if(n.length<2)return void a.ConnectionLog.error("onGetMessageFromServer: message data error.");this.parseGetMsgList(n)}},e.prototype.parseGetMsgList=function(e){var t,n,r=o(e.map((function(e){return a.JsonUtil.parseJson(e)})),2),s=r[0],c=r[1];if("QUIT_NOTICE"===(null==s?void 0:s.type)&&Object.values(i.QUIT_TYPE).includes(null==c?void 0:c.notice.quit_type)){var u=new Map([[i.QUIT_TYPE.INACTIVE,{code:d.RoomWebsocketErrorCode.INACTIVE,reason:i.QUIT_TYPE.INACTIVE}],[i.QUIT_TYPE.LOGIN_INVALIDATE,{code:d.RoomWebsocketErrorCode.LOGIN_INVALIDATE,reason:i.QUIT_TYPE.LOGIN_INVALIDATE}],[i.QUIT_TYPE.LOGIN_FORBIDDEN,{code:d.RoomWebsocketErrorCode.LOGIN_FORBIDDEN,reason:i.QUIT_TYPE.LOGIN_FORBIDDEN}]]);this.handleMessageErrorCode(null===(t=u.get(null==c?void 0:c.notice.quit_type))||void 0===t?void 0:t.code,null===(n=u.get(null==c?void 0:c.notice.quit_type))||void 0===n?void 0:n.reason)}else 0!==this.roomMsgQueue.messageCount()?this.handleWaitAcceptMessage(s,c):this.processFinishedGetMsg(s,c)},e.prototype.processFinishedGetMsg=function(e,t){this.roomMsgQueue.getFinishedMessageByTaskId(e.task_id)||this.receiveMessageFromServer(e,t)},e.prototype.handleDisconnectEvent=function(e){var t=this;e.event&&(this.websocketDisconneted=!0,this.socketDisconnectTimer||(this.roomChannelDependency.resetLogin(),this.roomChannelDependency.resetHeartBeat(),this.roomMsgQueue.handleMsgBySocketDisconnect(),this.socketDisconnectTimer=setTimeout((function(){var n,o;e.socketId||e.socketId!==(null===(n=t.roomWebsocket)||void 0===n?void 0:n.socketId)||t.disConnect(null!==(o=e.disconnectReason)&&void 0!==o?o:"")}),25e3)))},e.prototype.clearDisconnectTimer=function(){this.socketDisconnectTimer&&(clearTimeout(this.socketDisconnectTimer),this.socketDisconnectTimer=0)},e.prototype.clearReopenDelayTimer=function(){this.reopenDelayTimer&&(clearTimeout(this.reopenDelayTimer),this.reopenDelayTimer=0)},e.prototype.clearMessageSenderTimer=function(){this.messageSenderTimer&&(clearTimeout(this.messageSenderTimer),this.messageSenderTimer=0)},e.prototype.disConnect=function(e){a.ConnectionLog.info("disConnect, reason:"+e),this.roomChannelDependency.getRoomState()!==c.RoomState.SHUTDOWN&&(this.clearSocket(),this.notifyRoomClosed({reason:"close by disconnect, reason "+e,shutDown:!1},0))},e.prototype.doMsgOnSendAcceptSuccessCallback=function(e,t,n){var o,r,i,s,a;null===(o=e.onsendAccept)||void 0===o||o.call(e,e.taskId,e.cmd,e.data,t.type,{errCode:null!==(i=null===(r=null==n?void 0:n.data)||void 0===r?void 0:r.reason)&&void 0!==i?i:0,errMsg:null!==(a=null===(s=null==n?void 0:n.data)||void 0===s?void 0:s.msg)&&void 0!==a?a:"",response:{body:n,new_rev:t.new_rev}})},e.prototype.doMsgOnSendSuccessCallback=function(e,t){var n;null===(n=e.onsend)||void 0===n||n.call(e,e.taskId,e.cmd,e.data,t)},e}();t.RoomWebsocketMessageSender=g},ad7834bc49:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},af75a08457:function(e,t,n){"use strict";function o(e){return"function"==typeof e?"function"==typeof e.toLegacyString?e.toLegacyString():e.name:String(e)}n.d(t,"a",(function(){return o}))},afc95ccd7b:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n("0bbff1c330"),t),r(n("cb8440da0d"),t),r(n("4ece59fc57"),t),r(n("8645a705ed"),t),r(n("b53c045cfc"),t)},b064ea590e:function(e,t,n){e.exports=n("7fe7469c29")},b17aeaa40b:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},b284f06ad9:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n("825eafaa67"),t),r(n("80a1ca8977"),t),r(n("4abc89182b"),t),r(n("45155de31c"),t)},b53c045cfc:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectionCallBackEvent=void 0,function(e){e.onEnterOnline="OnEnterOnline",e.onEnterOffline="OnEnterOffline",e.onRoomOpen="OnRoomOpen",e.onRoomClose="OnRoomClose",e.onRoomShutDown="OnRoomShutDown",e.onRoomStateChange="OnRoomStateChange",e.onReceiveMsgFromServer="OnReceiveMsgFromServer",e.onNetReconnectedFail="OnNetReconnectedFail",e.onHeartBeatCommon="onHeartBeatCommon"}(t.ConnectionCallBackEvent||(t.ConnectionCallBackEvent={}))},b8f805ddc2:function(e,t,n){"use strict";n.d(t,"b",(function(){return d})),n.d(t,"c",(function(){return l})),n.d(t,"d",(function(){return p})),n.d(t,"a",(function(){return h}));var o=n("a1644e2245"),r=n("81cf3de5f1"),i=n("9b00d9b77e"),s=n("d7c625d1f2"),a=n("8a015847e6"),c=n("48a9511069");let u=class{constructor(e=[],t){this.instantiationService=t,this.instantiationHook=new c.a,this.params=e}getNewInstance(e){const t=e||(this.params.length>0?this.params:[]),n=this.getCtor(),o=this.instantiationService.createInstance(n,...t);return this.executeHooks(o,a.a.POST_CONSTRUCTOR),o}addHook(e,t){this.instantiationHook.addHook(e,t)}executeHooks(e,t){this.instantiationHook.executeHooks(e,t)}};function d(e,t,n=((e,t)=>e===t)){if(e===t)return!0;if(!e||!t)return!1;if(e.length!==t.length)return!1;for(let o=0,r=e.length;o<r;o++)if(!n(e[o],t[o]))return!1;return!0}function l(e){const t=r.a.getMethodMetadata(o.b,e);if(t)return t.methodName}function p(e){return e instanceof i.a||e instanceof u}function h(e,t,n){(e instanceof i.a||e instanceof u)&&e.addHook(t,n)}u=Object(s.__decorate)([Object(s.__param)(1,a.b)],u)},b9b3430781:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},b9e77a7da7:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},bc0c4da4ca:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tryToMarkDispose=t.tryToDispose=t.toDisposable=t.combinedDisposable=t.dispose=t.isDisposable=void 0;var o=n("6cac31cea5"),r=n("6bb936b136");function i(e){return"function"==typeof e.dispose&&(0===e.dispose.length||1===e.dispose.length)}function s(e,t){if(Array.isArray(e)){var n=t||o.DisposeTrace.traceRoot("disposables");return e.forEach((function(e){e&&(r.markTracked(e),e.dispose(n))})),n.stop(),[]}if(e){var i=t||o.DisposeTrace.traceRoot("disposables");return r.markTracked(e),e.dispose(i),i.stop(),e}}t.isDisposable=i,t.dispose=s,t.combinedDisposable=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.forEach(r.markTracked),r.trackDisposable({dispose:function(t){return s(e,t)}})},t.toDisposable=function(e,t){void 0===t&&(t="");var n=r.trackDisposable({dispose:function(t){r.markTracked(n),e(t)},disposableId:t});return n},t.tryToDispose=function(e,t){e&&i(e)&&e.dispose(t)},t.tryToMarkDispose=function(e){i(e)&&r.markTracked(e)}},bca278778b:function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var o=new Uint8Array(16);e.exports=function(){return n(o),o}}else{var r=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r}}},be1585b84b:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n("e75752bded"),t)},c013a37247:function(e,t,n){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},c0f85d03df:function(e,t,n){"use strict";var o,r,i,s;Object.defineProperty(t,"__esModule",{value:!0}),t.MessageState=t.MessageWaitAcceptCmd=t.MessageResultEvent=t.RoomState=void 0,function(e){e.INIT="INIT",e.CONNECTING="CONNECTING",e.OPENED="OPENED",e.RECONNECTING_IN_CLOSED="RECONNECTING_In_CLOSED",e.SHUTDOWN="SHUTDOWN"}(o||(o={})),t.RoomState=o,function(e){e.ON_POST="onpost",e.NET_STATUS_CHANGE="netStatusChange",e.ON_SEND_ACCEPT="onsendAccept"}(r||(r={})),t.MessageResultEvent=r,function(e){e.ACCEPT_COMMIT="ACCEPT_COMMIT",e.COMMIT_ERROR="COMMIT_ERROR",e.TASK_DUPLICATE="TASK_DUPLICATE"}(i||(i={})),t.MessageWaitAcceptCmd=i,function(e){e.UNKNOWN="unknown",e.SENDING="sending",e.WAITING="waiting",e.WAIT_ACCEPT="waitAccept"}(s||(s={})),t.MessageState=s},c4f2c30fd5:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TimeoutChecker=void 0;var o=n("cdda668c2b"),r=n("147e28b86b"),i=function(){function e(e,t){this.messageSendQueue=e,this.dependency=t,this.sendTimeoutTimer=0}return e.prototype.dispose=function(){this.clearTimer()},e.prototype.clearTimer=function(){clearTimeout(this.sendTimeoutTimer),this.sendTimeoutTimer=0},e.prototype.startCheckSendTimeout=function(){var e=this;this.sendTimeoutTimer&&(clearTimeout(this.sendTimeoutTimer),this.sendTimeoutTimer=0),this.sendTimeoutTimer=setTimeout((function(){e.checkSendTimeout()}),1e3)},e.prototype.checkSendTimeout=function(){var e=this.messageSendQueue.filter(this.timeoutMessage);e.forEach((function(e){e.state=r.MessageState.WAITING,e.retryCount>=e.maxRetryCount&&(o.ConnectionLog.warn("timeout-checker: send message timeout, taskId = "+e.taskId+", cmd = "+e.cmd+"."),e.retryCount=0)})),e.length>0&&this.dependency.trySendMessage(),0!==this.messageSendQueue.filter((function(e){return!!e})).length&&this.startCheckSendTimeout()},e.prototype.timeoutMessage=function(e){var t=r.RoomUtil.getCurrentTime();return(e.state===r.MessageState.SENDING||e.state===r.MessageState.WAIT_ACCEPT)&&t-e.lastSendTime>e.timeout},e}();t.TimeoutChecker=i},c5556536fb:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JsonUtil=void 0;var o=n("740addaa0b"),r=function(){function e(){}return e.parseJson=function(e){var t;try{t=JSON.parse(e)}catch(e){o.ConnectionLog.error("parseJson: error = "+e+".")}return t},e.jsonStringify=function(e){var t="";try{t=JSON.stringify(e)}catch(e){o.ConnectionLog.error("jsonStringify: error = "+e+".")}return t},e}();t.JsonUtil=r},c78a4443e5:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return Bt})),n.d(t,"b",(function(){return ue})),n.d(t,"c",(function(){return on})),n.d(t,"d",(function(){return qt})),n.d(t,"e",(function(){return Jt})),n.d(t,"f",(function(){return $})),n.d(t,"g",(function(){return nn})),n.d(t,"h",(function(){return zt}));var o=n("fe9bc614bd"),r=(n("56683198d5"),n("73b854064b"),n("9132715560")),i=n.n(r),s=n("6a364eb35c"),a=n.n(s),c=n("8eec1e4a03"),u=n.n(c),d=n("bd29e2df90"),l=n.n(d),p=n("ab5eb40518"),h=n.n(p),f=n("1b4cdd6a36"),v=n.n(f),g=n("3ef2352f0b"),m=n.n(g),E=(n("4a871f4295"),n("e8b2c0f5e8"),n("af802ec74b"),n("963f2eaace"),n("fdb955876a"),n("c6244f7705"),n("8ee19818c4"),n("081c8cafea"),n("d7c625d1f2")),y=n("536530eec5"),_=n("2e1bb889e5"),b=n("a7f251464e"),C=n("1c3848e586"),R=n("8a3f853387"),S=n("834b03d62c"),O=n("2c8ead4d96"),T=n("00b54de57b"),k=n("488b683127"),I=n("64973f262b"),w=n("9a4c21e153"),M=(n("9617b3921c"),n("580f342750"),n("77e684763e")),D=(n("de37db1287"),n("8e7cce0ada"),n("85d48ef22b"),n("2a6f332b5e"),n("a84962d637"),n("f45588a8ad"),n("39f57aec85")),A=n("ddb86d0a26"),N=(n("3bf1976a4f"),n("7b8243a880"),n("47ca619755"),n("bd80bf2d0f"),n("433247001a"),n("2dea9e08f0"),n("1bab7b5fb7"),n("5cd40edab3"),n("b7cba4397b")),L=n("4f3b15d017"),x=(n("229fddc286"),n("547611bd96")),P=n.n(x),U=(n("c9a7ecac4d"),n("6c6f26abf4"),n("29f8c5f672"),n("d95394beba"),n("09dd86480e"),n("342844cefa"),n("7a3400cab1"),n("8a35b54c1d"),n("b8217400dc"),n("e6f68cdf2e"),n("d66c2b8c37"),n("10f9b6de11")),j=n("725707fbbc"),B=(n("2504ad7290"),n("0aeae65bf4"),n("d0d0e18ee6"),n("c554310b5c"),n("99cf54780e")),F=n("7a5536c9bf"),W=n.n(F),K=(n("0acdc5834b"),n("e235bb9b7e"),n("78ff1b2e5b")),G=n.n(K),H=(n("826dc923b3"),n("5cb862f352")),V=n.n(H),q=(n("4bbb5840d5"),n("a2a09da1e3"),n("34cd92f77a"),n("85d0a7609b")),Q=n.n(q),Y=(n("7b51a32a7d"),n("d388adbf11"),n("13f4809b5e"),n("bbd8fa3a89"),n("75563bc376"),n("c14c4f06d8"),n("9d7978d445"),n("63513d8b56"),n("759492dad9"),n("6e20b6a7d8"),n("9d0daf5c3f"),n("1aa20789e9"),n("8b13fcae36")),X=(n("c05a92dcb5"),n("14502724a6")),J=n.n(X),z=n("b512c0eccb"),$=Object(o.a)("IConnectionControllerService"),Z=function(e){return"".concat(String(e),"__locked")},ee=function(e){return"".concat(String(e),"__result")};function te(){return function(e,t,n){var o=n.value,r=Z(t),i=ee(t);n.value=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this[r]||(this[i]=o.call.apply(o,Object(E.__spreadArray)([this],Object(E.__read)(e),!1)),this[r]=!0),this[i]}}}function ne(e){return function(t,n,o){var r=o.value,i=Z(e),s=ee(e);o.value=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this[i]&&(this[i]=!1,this[s]=void 0),r.call.apply(r,Object(E.__spreadArray)([this],Object(E.__read)(e),!1))}}}var oe=function(){function e(t){this.element=t,this.next=e.Undefined,this.prev=e.Undefined}return e.Undefined=new e(void 0),e}(),re=function(){function e(){this.first=oe.Undefined,this.last=oe.Undefined,this.mSize=0}return Object.defineProperty(e.prototype,"size",{get:function(){return this.mSize},enumerable:!1,configurable:!0}),e.prototype.isEmpty=function(){return this.first===oe.Undefined},e.prototype.clear=function(){this.first=oe.Undefined,this.last=oe.Undefined,this.mSize=0},e.prototype.unshift=function(e){return this.insert(e,!1)},e.prototype.push=function(e){return this.insert(e,!0)},e.prototype.shift=function(){if(this.first!==oe.Undefined){var e=this.first.element;return this.remove(this.first),e}},e.prototype.pop=function(){if(this.last!==oe.Undefined){var e=this.last.element;return this.remove(this.last),e}},e.prototype[Symbol.iterator]=function(){var e;return Object(E.__generator)(this,(function(t){switch(t.label){case 0:e=this.first,t.label=1;case 1:return e===oe.Undefined?[3,3]:[4,e.element];case 2:return t.sent(),e=e.next,[3,1];case 3:return[2]}}))},e.prototype.insert=function(e,t){var n=this,o=new oe(e);if(this.first===oe.Undefined)this.first=o,this.last=o;else if(t){var r=this.last;this.last=o,o.prev=r,r.next=o}else{var i=this.first;this.first=o,o.next=i,i.prev=o}this.mSize+=1;var s=!1;return function(){s||(s=!0,n.remove(o))}},e.prototype.remove=function(e){if(e.prev!==oe.Undefined&&e.next!==oe.Undefined){var t=e.prev;t.next=e.next,e.next.prev=t,e.next=oe.Undefined,e.prev=oe.Undefined}else e.prev===oe.Undefined&&e.next===oe.Undefined?(this.first=oe.Undefined,this.last=oe.Undefined):e.next===oe.Undefined?(this.last=this.last.prev,this.last.next=oe.Undefined,e.prev=oe.Undefined):e.prev===oe.Undefined&&(this.first=this.first.next,this.first.prev=oe.Undefined,e.next=oe.Undefined);this.mSize-=1},e}(),ie=function(){function e(e){this.disposed=!1,this.options=e}return Object.defineProperty(e.prototype,"event",{get:function(){var e=this;return this.mEvent||(this.mEvent=function(t,n,o){var r,i,s;e.listeners||(e.listeners=new re);var a=e.listeners.isEmpty();a&&(null===(r=e.options)||void 0===r?void 0:r.onFirstListenerAdd)&&e.options.onFirstListenerAdd(e);var c=e.listeners.push(n?[t,n]:t);a&&(null===(i=e.options)||void 0===i?void 0:i.onFirstListenerDidAdd)&&e.options.onFirstListenerDidAdd(e),(null===(s=e.options)||void 0===s?void 0:s.onListenerDidAdd)&&e.options.onListenerDidAdd(e,t,n);var u={dispose:function(){var t;e.disposed||(c(),(null===(t=e.options)||void 0===t?void 0:t.onLastListenerRemove)&&(e.listeners&&!e.listeners.isEmpty()||e.options.onLastListenerRemove(e)));Object(M.markTracked)(u)},disposableId:"event"};return Array.isArray(o)&&o.push(u),Object(M.trackDisposable)(u),u}),this.mEvent},enumerable:!1,configurable:!0}),e.prototype.fire=function(e){var t,n;if(this.listeners){this.deliveryQueue||(this.deliveryQueue=new re);try{for(var o=Object(E.__values)(this.listeners),r=o.next();!r.done;r=o.next()){var i=r.value;this.deliveryQueue.push([i,e])}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}for(;this.deliveryQueue.size>0;){var s=Object(E.__read)(this.deliveryQueue.shift(),2),a=(i=s[0],s[1]);try{"function"==typeof i?i.call(void 0,a):i[0].call(i[1],a)}catch(e){console.error(e)}}}},e.prototype.dispose=function(){this.listeners&&this.listeners.clear(),this.deliveryQueue&&this.deliveryQueue.clear(),this.disposed=!0},e}();function se(e,t){return Object.prototype.toString.call(t)==="[object ".concat(e,"]")}function ae(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=v()(e);if(t){var r=v()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return h()(this,n)}}var ce;!function(e){e[e.USER_INITIATIVE=72105]="USER_INITIATIVE"}(ce||(ce={}));var ue=function(e){l()(n,e);var t=ae(n);function n(e,o,r,s){var a;return i()(this,n),(a=t.call(this)).docMetaDomain=e,a.authDomain=o,a.collaborateDomain=r,a.likeDomain=s,a.onEnterOnlineEmitter=new ie,a.onEnterOfflineEmitter=new ie,a.onRoomStateChangeEmitter=new ie,a.onNetReconnectedFailEmitter=new ie,a.logger=new A.a("ConnectionControllerService").use("console"),a.onEnterOnline=a.onEnterOnlineEmitter.event,a.onEnterOffline=a.onEnterOfflineEmitter.event,a.onRoomStateChange=a.onRoomStateChangeEmitter.event,a.onNetReconnectedFail=a.onNetReconnectedFailEmitter.event,a.configEventHandlerMap(),a.configMsgHandlerMap(),a}return a()(n,[{key:"openRoom",value:function(){if(!this.connectionController)throw new Error("没有 connectionController 对象，需要先通过 initConnectionControllerWithClientVars 初始化");this.connectionController.connect()}},{key:"shutDown",value:function(e){if(!this.connectionController)throw new Error("没有 connectionController 对象，需要先通过 initConnectionControllerWithClientVars 初始化");var t=Object.assign({},e);t.errCode||(t.errCode=72105),this.connectionController.disconnect(t)}},{key:"setConnectionController",value:function(e){var t=this;this.connectionController=e,this.connectionController.onConnectionEvent((function(e){t.dispathEvent(e)}))}},{key:"dispose",value:function(){var e;u()(v()(n.prototype),"dispose",this).call(this),null===(e=this.connectionController)||void 0===e||e.dispose(),this.connectionController=null}},{key:"init",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}}),e)})))}},{key:"getConnectionController",value:function(){return this.connectionController}},{key:"initConnectionControllerWithClientVars",value:function(e){var t=this,n={serverVars:e.collab_client_vars,uuId:e.userId+e.collab_client_vars.client.sid.slice(0,5),userid:e.userId,module:"ARK",uid:e.tinyid};this.connectionController=new D.ConnectionController(n),this.connectionController.onConnectionEvent((function(e){t.dispathEvent(e)}))}},{key:"configEventHandlerMap",value:function(){var e=this;this.eventHandlerMap={onEnterOnline:function(){return e.onEnterOnlineEmitter.fire(void 0)},onEnterOffline:function(){return e.onEnterOfflineEmitter.fire(void 0)},onNetReconnectedFail:function(){return e.onNetReconnectedFailEmitter.fire(void 0)},onRoomStateChange:function(t){var n;e.onRoomStateChangeEmitter.fire(null===(n=t.data)||void 0===n?void 0:n.roomState)}}}},{key:"configMsgHandlerMap",value:function(){var e=this;this.msgHandlerMap={HANDLE_DELETE:function(){return e.handleDelete()},REVERT_MESSAGE:function(){return e.handleRevertMessage()},RIGHT_MESSAGE:function(t){return e.handleRightMessage(t)},TITLE_MESSAGE:function(t){return e.handleTitleMessage(t)},USER_NEWINFO:function(t){return e.handleNewUserInfo(t)},USER_NEWINFOS:function(t){return e.handleNewUserInfos(t)},USER_LEAVE:function(t){return e.handleUserLeave(t)},USER_LEAVES:function(t){return e.handleUserLeaves(t)},COMMERCIALIZE_MESSAGE:function(t){return e.handleCommerCializeMessage(t)},COMMERICILIZE_MESSAGE:function(t){return e.handleCommerIcilizeMessage(t)},MARK_MESSAGE:function(t){return e.handleMarkMessage(t)},COMM_NOTICE:function(t){return e.handleCommNotice(t)}}}},{key:"onRoomShutDown",value:function(e){if(e){var t=e.errCode;72105!==(void 0===t?0:t)||this.logger.info("info  = onRoomShutDown = type or errCode === USER_SHUTDOWN_CODE")}else this.logger.info("info  = onRoomShutDown = type or closeReason is null")}},{key:"onReceiveMsgFromServer",value:function(e){if((null==e?void 0:e.type)&&se("Array",null==e?void 0:e.data)){var t=e.type,n=e.data,o=this.msgHandlerMap[t];o&&o(n)}else this.logger.error("error = onReceiveMsgFromServer, type or receiveData.data is null")}},{key:"dispathEvent",value:function(e){var t,n,o=this.eventHandlerMap[e.event];o?o(e):"OnReceiveMsgFromServer"===e.event?this.onReceiveMsgFromServer(null===(t=e.data)||void 0===t?void 0:t.serverMsg):"OnRoomShutDown"===e.event&&this.onRoomShutDown(null===(n=e.data)||void 0===n?void 0:n.closeReason)}},{key:"handleDelete",value:function(){this.docMetaDomain.docMetaEntity.handleNoticeDeleted()}},{key:"handleRevertMessage",value:function(){this.logger.debug("REVERT_MESSAGE")}},{key:"handleRightMessage",value:function(e){var t=this;this.logger.debug("RIGHT_MESSAGE"),e.forEach((function(e){var n;t.authDomain.authAggregate.authInfoEntity.onReceiveMessageFromServer(null===(n=null==e?void 0:e.body)||void 0===n?void 0:n.notice,t.connectionController)}))}},{key:"handleTitleMessage",value:function(e){var t=this;e.forEach((function(e){var n=e.body.notice;t.docMetaDomain.docMetaEntity.handleNoticeTitleChanged(n.title)}))}},{key:"handleNewUserInfo",value:function(e){var t=this;e.forEach((function(e){var n=e.body.notice,o={sessionType:n.session_type,userId:n.userId,uuId:n.uuId,vipInfo:n.vip_info},r={memCount:n.mem_count,notices:[o]};t.collaborateDomain.collaborateAggregate.handleUserComeIn(r)}))}},{key:"handleNewUserInfos",value:function(e){var t=this;e.forEach((function(e){var n=e.body,o=n.notices,r=n.mem_count,i=[];null==o||o.forEach((function(e){var t={sessionType:e.session_type,userId:e.userId,uuId:e.uuId,vipInfo:e.vip_info};i.push(t)}));var s={memCount:r,notices:i};t.collaborateDomain.collaborateAggregate.handleUserComeIn(s)}))}},{key:"handleUserLeave",value:function(e){var t=this;e.forEach((function(e){var n=e.body.notice,o={sessionType:n.session_type,userId:n.userId,uuId:n.uuId,vipInfo:n.vip_info},r={memCount:n.mem_count,notices:[o]};t.collaborateDomain.collaborateAggregate.handleUserLeave(r)}))}},{key:"handleUserLeaves",value:function(e){var t=this;e.forEach((function(e){var n=e.body,o=n.notices,r=n.mem_count,i=[];null==o||o.forEach((function(e){var t={sessionType:e.session_type,userId:e.userId,uuId:e.uuId,vipInfo:e.vip_info};i.push(t)}));var s={memCount:r,notices:i};t.collaborateDomain.collaborateAggregate.handleUserLeave(s)}))}},{key:"handleCommerCializeMessage",value:function(e){var t=this;this.likeDomain.likeEntity.handleRealTimeLikeMessage(e),e.forEach((function(e){t.collaborateDomain.collaborateAggregate.handleCommerIcilizeMessage(e)}))}},{key:"handleCommerIcilizeMessage",value:function(e){var t=this;e.forEach((function(e){t.collaborateDomain.collaborateAggregate.handleCommerIcilizeMessage(e)}))}},{key:"handleMarkMessage",value:function(e){this.logger.debug(e)}},{key:"handleCommNotice",value:function(e){this.logger.debug(e)}}]),n}(M.Disposable);Object(E.__decorate)([ne("init"),Object(E.__metadata)("design:type",Function),Object(E.__metadata)("design:paramtypes",[]),Object(E.__metadata)("design:returntype",void 0)],ue.prototype,"dispose",null),Object(E.__decorate)([te(),Object(E.__metadata)("design:type",Function),Object(E.__metadata)("design:paramtypes",[]),Object(E.__metadata)("design:returntype",Promise)],ue.prototype,"init",null),ue=Object(E.__decorate)([Object(E.__param)(0,y.a),Object(E.__param)(1,_.a),Object(E.__param)(2,b.a),Object(E.__param)(3,C.a),Object(E.__metadata)("design:paramtypes",[Object,Object,Object,Object])],ue);var de=N.a.getConfig('npm["@tencent/ark-application"]'),le=window.location.host;null==de||de.TENCENT_DOCS_HOME,new RegExp((null==de?void 0:de.TENCENT_DOCS_EDITOR_REGEXP)||"docs\\.qq\\.com\\/.+\\/[BD].+"),null==de||de.WECOM_DOCS_HOME,null==de||de.WECOM_DOCS_EDITOR;null==de||de.FEEDBACK_URL;var pe=(null==de?void 0:de.EXACTLY_PARENT_TOC_COOKIE_DOMAIN)||"qq.com",he=(null==de?void 0:de.PARENT_TOC_COOKIE_DOMAIN)||".qq.com",fe=(null==de?void 0:de.TOC_COOKIE_DOMAIN)||".docs.qq.com",ve=(null==de?void 0:de.PARENT_TOB_COOKIE_DOMAIN)||".weixin.qq.com",ge=(null==de?void 0:de.TOB_COOKIE_DOMAIN)||".doc.weixin.qq.com",me=(null==de?void 0:de.WECOM_HOME_PAGE)||"https://doc.weixin.qq.com/home/recent";null==de||de.PAGE_JUMP_TO_C,new RegExp((null==de?void 0:de.TOC_HOME_PAGE_REGEXP)||"docs\\.qq\\.com\\/desktop(\\/)?","i");var Ee=(null==de?void 0:de.TOB_LOGIN_PAGE_URL)||"https://doc.weixin.qq.com/disklogin/login",ye=(null==de?void 0:de.TOC_HOME_PAGE)||"https://docs.qq.com/desktop",_e=(null==de?void 0:de.C_JUMP_TO_B_URL)||"https://docs.qq.com/scenario/page-jump-to-b.html";null==de||de.C_JUMP_TOB_LOGIN_PAGE_URL;var be=(null==de?void 0:de.C_LOGIN_URL)||"https://docs.qq.com/scenario/login.html";new RegExp((null==de?void 0:de.TOB_HOME_PAGE_REGEXP)||"doc\\.weixin\\.qq\\.com\\/home\\/recent(\\/)?","i"),new RegExp((null==de?void 0:de.TOB_MALL_PAGE_REGEXP)||"doc\\.weixin\\.qq\\.com\\/mall\\/index(\\/)?","i"),new RegExp((null==de?void 0:de.TOC_MALL_PAGE_REGEXP)||"docs\\.qq\\.com\\/mall(\\/)?","i"),null==de||de.TOC_MALL_PAGE;var Ce=Symbol.for("swr-decorator:fetcherMap");function Re(e){return function(t,n){var o=Reflect.getMetadata(Ce,t)||new Map;o.set(e,n),Reflect.defineMetadata(Ce,o,t)}}var Se=Symbol.for("swr-decorator:properties");function Oe(e,t){var n,o=null!==(n=Reflect.getMetadata(Se,e))&&void 0!==n?n:[];o.push(t),Reflect.defineMetadata(Se,o,e)}function Te(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=v()(e);if(t){var r=v()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return h()(this,n)}}var ke=function(){function e(t,n){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];i()(this,e),this.value=t,this.fetcher=n,this.subscribers=new Set,this.validating=!1,this.firstRequire=!1,this.updatePropertiesOnFirstRequire=o}return a()(e,[{key:"getValue",value:function(){var e=this;return this.updatePropertiesOnFirstRequire&&!this.firstRequire&&(setTimeout((function(){return e.revalidate()}),0),this.firstRequire=!0),this.value}},{key:"getValueMutate",value:function(){return this.revalidate(),this.value}},{key:"setValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.value=e,t||this.subscribers.forEach((function(t){return t(e)})),!0}},{key:"addSubscriber",value:function(e){this.subscribers.add(e)}},{key:"removeSubscriber",value:function(e){this.subscribers.delete(e)}},{key:"isValidating",value:function(){return this.validating}},{key:"revalidate",value:function(){var e=this;this.validating||this.fetcher&&(this.validating=!0,this.fetcher().then((function(t){e.validating=!1,e.setValue(t)})).catch((function(t){throw e.validating=!1,t})))}}]),e}();function Ie(e){var t=(null!=e?e:{}).updatePropertiesOnFirstRequire;return function(e){var n=new Map;return function(e){l()(r,e);var o=Te(r);function r(){var e,s,a;i()(this,r);for(var c=arguments.length,u=new Array(c),d=0;d<c;d++)u[d]=arguments[d];e=o.call.apply(o,[this].concat(u));var l={},p=null!==(s=Reflect.getMetadata(Ce,P()(e)))&&void 0!==s?s:new Map;return(null!==(a=Reflect.getMetadata(Se,P()(e)))&&void 0!==a?a:[]).forEach((function(o){var r,i=p.get(o),s=null===(r=e[i])||void 0===r?void 0:r.bind(P()(e)),a=new ke(e[o],s,t);n.set(o,a),l[o]={get:function(){return a.getValue()},set:function(e){return a.setValue(e),!0}},e[i]=function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return Object(E.__awaiter)(P()(e),void 0,void 0,m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.apply(void 0,n);case 2:return t=e.sent,a.setValue(t),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)})))}})),Object.defineProperties(P()(e),l),e}return a()(r,[{key:"isValidating",value:function(e){var t,o;return null!==(o=null===(t=n.get(e))||void 0===t?void 0:t.isValidating())&&void 0!==o&&o}},{key:"subscribe",value:function(e,t){var o;return null===(o=n.get(e))||void 0===o||o.addSubscriber(t),function(){var o;null===(o=n.get(e))||void 0===o||o.removeSubscriber(t)}}},{key:"mutate",value:function(e,t){return Object(E.__awaiter)(this,arguments,void 0,(function(e,t){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return m.a.mark((function r(){var i,s;return m.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:void 0!==t&&(null===(i=n.get(e))||void 0===i||i.setValue(t,!0)),o&&(null===(s=n.get(e))||void 0===s||s.revalidate());case 2:case"end":return r.stop()}}),r)}))()}))}}]),r}(e)}}var we={nick:"nickname",avatar:"avatarURI",uType:"accountType",phone:"phoneNumber",isHasPassword:"enabled",utype:"accountType",uin:"qq"},Me={raw:we,words:Object.keys(we)},De={};function Ae(){return"undefined"!=typeof window}function Ne(){return void 0!==e}var Le=Ae()?window:Ne()?e:Ae||"undefined"==typeof self?(Ne()&&e.describe,De):self;function xe(e,t){return null!==e&&Object.prototype.hasOwnProperty.call(e,t)}var Pe="location";function Ue(){return xe(Le,Pe)?location.search:""}function je(e,t){if(void 0===t&&(t={shouldDecodeURI:!1}),!xe(Le,Pe))return"";var n=new RegExp("(\\?|&)".concat(e,"=([^&]*)(#|&|$)")),o=((null==t?void 0:t.shouldDecodeURI)?decodeURIComponent(Ue()):Ue()).match(n);return o?decodeURIComponent(o[2]):""}var Be,Fe=["/doc/","/sheet/","/slide/","/form/","/mind/","/flowchart/","/pdf/"],We=function(){function e(){if(i()(this,e),L.default.isMiniProgram)return new Ke;try{var t=new j.StorageManager({type:this.isSupportClientDB()?j.DBEngineType.nativeDB:j.DBEngineType.indexDB,disableAutoOpen:!1}).storage.collection(U.UserInfo);this.userInfoStorage=new j.UserInfoStorage(t),this.onOfflineState=!1}catch(e){return console.error(e),new Ke}}return a()(e,[{key:"setOnOfflineState",value:function(e){this.onOfflineState=e}},{key:"addUserInfo",value:function(e){if(B.network&&B.network.isOnline&&!this.onOfflineState&&(null==e?void 0:e.tinyId)&&e.tinyId!==R.h){var t=new U.UserInfo(Object.assign(Object.assign({},e),this.getDocInfo()));this.userInfoStorage.addUserInfo(t)}}},{key:"updateUserInfo",value:function(e){B.network&&B.network.isOnline&&(e.tinyId===R.h||this.onOfflineState||this.userInfoStorage.updateUserInfo({tinyId:e.tinyId},e))}},{key:"getUserInfo",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n,o,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=je("u"))){e.next=7;break}return e.t0=this,e.next=5,this.userInfoStorage.getUserInfoByNowUserIndex(t);case 5:return e.t1=e.sent,e.abrupt("return",e.t0.changeOfflineData.call(e.t0,e.t1));case 7:return n=this.getDocInfo(),o=n.pageType,r=n.docId,e.t2=this,e.next=11,this.userInfoStorage.getUserInfoByDocInfo(o,r);case 11:return e.t3=e.sent,e.abrupt("return",e.t2.changeOfflineData.call(e.t2,e.t3));case 13:case"end":return e.stop()}}),e,this)})))}},{key:"changeOfflineData",value:function(e){if(!e)return null;var t={tinyId:e.tinyId,corpId:e.corpId,corpName:e.corpName,englishName:e.englishName,loginType:e.loginType,uidSource:e.uidSource,openId:e.openId,uin:e.uin,userId:e.userId,userName:e.userName,userPic:e.userPic,nowUserIndex:e.nowUserIndex,settings:e.settings,wedriveUin:e.wedriveUin||""},n=e.bindUserInfo;return{userInfo:t,vipInfo:e.vipUserInfo,bindUserInfo:n}}},{key:"isSupportClientDB",value:function(){var e=/_tdocFlag\/(\d+)/.exec(navigator.userAgent);return!!(null==e?void 0:e[1])&&(2&parseInt(e[1],10))>0}},{key:"getDocInfo",value:function(){var e=null===globalThis||void 0===globalThis?void 0:globalThis.location.pathname.split("/"),t=e[1];return Fe.filter((function(e){return globalThis.location.pathname.includes(e)})).length>0?{pageType:t,docId:e[2],updateTime:Date.now().toString()}:{pageType:t,docId:t,updateTime:Date.now().toString()}}}]),e}(),Ke=function(){function e(){i()(this,e)}return a()(e,[{key:"setOnOfflineState",value:function(){}},{key:"addUserInfo",value:function(){}},{key:"updateUserInfo",value:function(){}},{key:"getUserInfo",value:function(){return Promise.resolve(null)}}]),e}();!function(e){e.SUCCESS="SUCCESS",e.MAIN_SUCCESS_SECOND_FAIL="MAIN_SUCCESS_SECOND_FAIL",e.MAIN_FAIL_SECOND_SUCCESS="MAIN_FAIL_SECOND_SUCCESS",e.FAIL="FAIL",e.NOT_EXIST="NOT_EXIST"}(Be||(Be={}));var Ge,He=function(){function e(t,n){i()(this,e),this.accountDomainService=t,this.messageDomainService=n}return a()(e,[{key:"getPersonalAccountList",value:function(e,t){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function n(){return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.getFetchAccountList(e,t);case 2:return this.fetchAccountList=n.sent,n.abrupt("return",this.mergeAccountList(this.fetchAccountList,[]));case 4:case"end":return n.stop()}}),n,this)})))}},{key:"getFetchAccountList",value:function(e,t){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function n(){return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.accountDomainService.accountAggregate.accountListEntity.getAccountList(e,t);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n,this)})))}},{key:"deleteAccountForList",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n,o,r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.uid,o=e.userIndex,r=!0,!this.isHasSameTinyID(this.fetchAccountList,n)){t.next=7;break}return t.next=6,this.deleteFetchAccountList(e);case 6:r=t.sent;case 7:return r&&G.a.postMessage({type:S.a.LOGOUT,data:o,needCookie:!0}),t.abrupt("return",this.changeDeleteAccountState(r,!0));case 9:case"end":return t.stop()}}),t,this)})))}},{key:"changeSign",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.userIndex){t.next=3;break}return t.abrupt("return",!1);case 3:return t.next=5,this.accountDomainService.accountAggregate.accountListEntity.changeSign(n);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"dispose",value:function(){this.messageDomainService.getEnterpriseAccountListMessage.dispose()}},{key:"changeDeleteAccountState",value:function(e,t){return e&&t?Be.SUCCESS:e?Be.MAIN_SUCCESS_SECOND_FAIL:t?Be.MAIN_FAIL_SECOND_SUCCESS:Be.FAIL}},{key:"deleteFetchAccountList",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.userIndex){t.next=3;break}return t.abrupt("return",!1);case 3:return t.next=5,this.accountDomainService.accountAggregate.accountListEntity.delAccountForList(n);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"mergeAccountList",value:function(e,t){var n=this;return t.reduce((function(e,t){return n.isHasSameTinyID(e,t.uid)?e:[].concat(W()(e),[t])}),e)}},{key:"isHasSameTinyID",value:function(e,t){return e.some((function(e){return e.uid===t}))}},{key:"getEnterpriseAccountList",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n=this;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.messageDomainService.getEnterpriseAccountListMessage.connect(),this.getIframeMountMessage(),this.messageDomainService.getEnterpriseAccountListMessage.createGetAccountListIframe((function(){n.messageDomainService.getEnterpriseAccountListMessage.sendAccountListMessage()})),e.next=5,this.getAccountListMessage();case 5:return t=e.sent,e.abrupt("return",t);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"deleteEnterpriseAccountList",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.cookie){t.next=3;break}return t.abrupt("return",!1);case 3:return this.messageDomainService.getEnterpriseAccountListMessage.sendDeleteAccountMessage(n),t.next=6,this.getDeleteAccountMessage();case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t,this)})))}},{key:"getAccountListMessage",value:function(){var e=this;return new Promise((function(t){e.messageDomainService.getEnterpriseAccountListMessage.getAccountListMessage((function(e){var n=e.data.userList;t(n)}))}))}},{key:"getDeleteAccountMessage",value:function(){var e=this;return new Promise((function(t){e.messageDomainService.getEnterpriseAccountListMessage.getDeleteAccountMessage((function(){t(!0)}))}))}},{key:"getIframeMountMessage",value:function(){var e=this;return new Promise((function(t){e.messageDomainService.getEnterpriseAccountListMessage.getIframeMountMessage((function(){t(!0),e.messageDomainService.getEnterpriseAccountListMessage.sendAccountListMessage()}))}))}}]),e}();He=Object(E.__decorate)([Object(E.__param)(0,O.a),Object(E.__param)(1,T.a),Object(E.__metadata)("design:paramtypes",[Object,Object])],He),function(e){e.BIND_CGI_SUCCESS="BIND_CGI_SUCCESS",e.CHECK_KEY_IS_READY="CHECK_KEY_IS_READY",e.BIND_POLLING_RUNNING="BIND_POLLING_RUNNING",e.BIND_POLLING_FINISH="BIND_POLLING_FINISH",e.BIND_TIMEOUT="BIND_TIMEOUT",e.ERROR="ERROR"}(Ge||(Ge={}));var Ve,qe,Qe=function(){function e(t){i()(this,e),this.accountDomainService=t,this.isExpired=!1}return a()(e,[{key:"getBindingQQAccountInfo",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountDomainService.accountAggregate.bindingQQInfo();case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"getStatus",value:function(e){var t=this;return this.runBindProcess(e),{dispose:function(){return t.dispose()}}}},{key:"runBindProcess",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n,o;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.accountDomainService.accountAggregate.accountRepository.bindUserInfo();case 2:n=t.sent,0===(null==(o=n.resData)?void 0:o.cgicode)?(e(Ge.BIND_CGI_SUCCESS),this.getKey(e)):e(Ge.ERROR,{errBindQQStatus:Ge.BIND_CGI_SUCCESS});case 5:case"end":return t.stop()}}),t,this)})))}},{key:"dispose",value:function(){this.pollingTimer&&clearTimeout(this.pollingTimer),this.isExpired=!0}},{key:"getKey",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n,o,r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.accountDomainService.accountAggregate.userInfo.nowUserIndex,t.next=3,this.accountDomainService.accountAggregate.accountRepository.getBindWxQrCode(n);case 3:if(o=t.sent,0!==(null==(r=o.resData)?void 0:r.cgicode)){t.next=9;break}return e(Ge.CHECK_KEY_IS_READY),this.runPolling(r.data.checkKey,e),t.abrupt("return");case 9:e(Ge.ERROR,{errBindQQStatus:Ge.CHECK_KEY_IS_READY});case 10:case"end":return t.stop()}}),t,this)})))}},{key:"runPolling",value:function(e,t){var n=this;this.isExpired||(this.pollingTimer=setTimeout((function(){return Object(E.__awaiter)(n,void 0,void 0,m.a.mark((function n(){var o,r;return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.accountDomainService.accountAggregate.accountRepository.getBindProcess(e);case 2:if(o=n.sent,r=o.resData,clearTimeout(this.pollingTimer),0!==(null==r?void 0:r.cgicode)){n.next=15;break}if(!r.data.isFinish){n.next=9;break}return t(Ge.BIND_POLLING_FINISH),n.abrupt("return");case 9:if(!(Number(r.data.lastUpdateRs)>15)){n.next=12;break}return t(Ge.BIND_POLLING_FINISH,{progress:this.getProgress(r.data.totalNum,r.data.succNum)}),n.abrupt("return");case 12:return t(Ge.BIND_POLLING_RUNNING,{progress:this.getProgress(r.data.totalNum,r.data.succNum)}),this.runPolling(e,t),n.abrupt("return");case 15:t(Ge.ERROR,{errBindQQStatus:Ge.BIND_POLLING_RUNNING});case 16:case"end":return n.stop()}}),n,this)})))}),1e3))}},{key:"getProgress",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e?Math.floor(t/e):1}}]),e}();function Ye(e,t,n){var o,r=this;return qe=t,function(i){return function s(){return Object(E.__awaiter)(r,void 0,void 0,m.a.mark((function r(){var a,c,u;return m.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(qe===t){r.next=2;break}return r.abrupt("return");case 2:return r.next=4,e.loginRepository.updateWeChatLoginQRCodeStatus(t,n);case 4:if(a=r.sent,c=a.error,u=a.resData,!c){r.next=10;break}return i({status:Ve.ERROR}),r.abrupt("return");case 10:if(!(null==u?void 0:u.data.status.isFinish)){r.next=13;break}return i({status:Ve.USER_HAS_CONFIRMED}),r.abrupt("return");case 13:o=setTimeout(s,1e3);case 14:case"end":return r.stop()}}),r)})))}(),setTimeout((function(){qe===t&&i({status:Ve.CODE_WAS_EXPIRED}),clearTimeout(o)}),58e3),function(){return clearTimeout(o)}}}Qe=Object(E.__decorate)([Object(E.__param)(0,O.a),Object(E.__metadata)("design:paramtypes",[Object])],Qe),function(e){e.CODE_IS_READY="CODE_IS_READY",e.USER_HAS_SCANNED="USER_HAS_SCANNED",e.CODE_WAS_EXPIRED="CODE_WAS_EXPIRED",e.USER_HAS_CONFIRMED="USER_HAS_CONFIRMED",e.ERROR="ERROR"}(Ve||(Ve={}));var Xe=function(){function e(t,n){i()(this,e),this.accountDomainService=t,this.loginDomainService=n}return a()(e,[{key:"getQRCode",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n,o,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.accountDomainService.accountAggregate.userInfo.nowUserIndex,e.next=3,this.accountDomainService.accountAggregate.accountRepository.getBindWxQrCode(t);case 3:if(n=e.sent,o=n.error,r=n.resData,!o){e.next=7;break}throw o;case 7:return e.abrupt("return",this.convertWeChatQRCodeResponse(null==r?void 0:r.data));case 8:case"end":return e.stop()}}),e,this)})))}},{key:"convertWeChatQRCodeResponse",value:function(e){var t=null!=e?e:{},n=t.img,o=t.checkKey;if(!n||!o)throw Error("获取微信二维码失败");return{id:o,image:"data:image/png;base64,".concat(n),subscribe:Ye(this.loginDomainService.loginAggregate,o)}}}]),e}();Xe=Object(E.__decorate)([Object(E.__param)(0,O.a),Object(E.__param)(1,k.a),Object(E.__metadata)("design:paramtypes",[Object,Object])],Xe);var Je,ze,$e=function(){function e(t,n){i()(this,e),this.accountDomainService=t,this.loginDomainService=n}return a()(e,[{key:"qqBind",value:function(e){return this.qqBindApplication||(this.qqBindApplication=new Qe(this.accountDomainService)),this.qqBindApplication.getStatus(e)}},{key:"wechatBind",value:function(){return this.wechatBindApplication=new Xe(this.accountDomainService,this.loginDomainService),this.wechatBindApplication.getQRCode()}},{key:"getQQBindingInfo",value:function(){return this.qqBindApplication||(this.qqBindApplication=new Qe(this.accountDomainService)),this.qqBindApplication.getBindingQQAccountInfo()}},{key:"getCurrentAccountBindingInfo",value:function(){return this.accountDomainService.accountAggregate.currentLoginAccountBindInfo()}}]),e}();$e=Object(E.__decorate)([Object(E.__param)(0,O.a),Object(E.__param)(1,k.a),Object(E.__metadata)("design:paramtypes",[Object,Object])],$e),function(e){e.CODE_IS_READY="CODE_IS_READY",e.USER_HAS_SCANNED="USER_HAS_SCANNED",e.CODE_WAS_EXPIRED="CODE_WAS_EXPIRED",e.LOGIN_SUCCESS="LOGIN_SUCCESS",e.ERROR="ERROR"}(Je||(Je={})),function(e){e[e.WECHAT_LOGIN_CASE_DEFAULT=0]="WECHAT_LOGIN_CASE_DEFAULT",e[e.WECHAT_LOGIN_CASE_H5=1]="WECHAT_LOGIN_CASE_H5"}(ze||(ze={}));var Ze,et=function(){function e(t){i()(this,e),this.loginDomainService=t,this.isExpired=!1}return a()(e,[{key:"login",value:function(e){var t=this;return this.runLoginProcess(e),{dispose:function(){return t.dispose()}}}},{key:"dispose",value:function(){this.qrTimer&&clearTimeout(this.qrTimer),this.pollingTimer&&clearTimeout(this.pollingTimer),this.isExpired=!0}},{key:"runLoginProcess",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getWechatLoginQRcode(e);case 2:if(n=t.sent){t.next=5;break}return t.abrupt("return");case 5:this.isExpired=!1,this.runPolling(n,e),this.runQRTimer(e);case 8:case"end":return t.stop()}}),t,this)})))}},{key:"getWechatLoginQRcode",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n,o,r,i;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loginDomainService.loginAggregate.loginRepository.getWeChatLogInQRCodeURI();case 2:if(n=t.sent,0!==(null==(o=n.resData)?void 0:o.retcode)){t.next=11;break}return r=o.data.checkKey,t.next=8,this.getQRcode(r,e);case 8:return i=t.sent,e(Je.CODE_IS_READY,{qrCodeImage:i}),t.abrupt("return",o.data.checkKey);case 11:return e(Je.ERROR,{errorQrQQLoginStatus:Je.CODE_IS_READY}),t.abrupt("return","");case 13:case"end":return t.stop()}}),t,this)})))}},{key:"getQRcode",value:function(e,t){return new Promise((function(n){V.a.make("https://".concat(le,"/scenario/qr-h5login.html?key=").concat(e)).then((function(e){return n(e)})).catch((function(){t(Je.ERROR,{errorQrQQLoginStatus:Je.CODE_IS_READY})}))}))}},{key:"runPolling",value:function(e,t){var n=this;this.isExpired||(this.pollingTimer=setTimeout((function(){return Object(E.__awaiter)(n,void 0,void 0,m.a.mark((function n(){var o,r,i,s,a,c;return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.loginDomainService.loginAggregate.loginRepository.updateEnterpriseWeChatLoginQRCodeStatus(e);case 2:if(i=n.sent,0===(null==(s=i.resData)?void 0:s.retcode)){n.next=9;break}return t(Je.ERROR,{errorQrQQLoginStatus:Je.USER_HAS_SCANNED}),clearTimeout(this.qrTimer),clearTimeout(this.pollingTimer),n.abrupt("return");case 9:if(a=null!==(r=null===(o=null==s?void 0:s.data)||void 0===o?void 0:o.status)&&void 0!==r?r:{},c=a.loginScanFlag,!a.login){n.next=15;break}return t(Je.LOGIN_SUCCESS,{changeKey:e}),clearTimeout(this.qrTimer),clearTimeout(this.pollingTimer),n.abrupt("return");case 15:c&&t(Je.USER_HAS_SCANNED),clearTimeout(this.pollingTimer),this.runPolling(e,t);case 18:case"end":return n.stop()}}),n,this)})))}),1e3))}},{key:"runQRTimer",value:function(e){var t=this;this.qrTimer=setTimeout((function(){e(Je.CODE_WAS_EXPIRED),t.isExpired=!0,clearTimeout(t.qrTimer)}),58e3)}}]),e}();et=Object(E.__decorate)([Object(E.__param)(0,k.a),Object(E.__metadata)("design:paramtypes",[Object])],et),function(e){e.UPDATE_USER_INDEX="account:update-user-index",e.DELETE_USER_INDEX="account:delete-user-index",e.SWITCH_USER_INDEX="account:switch-user-index"}(Ze||(Ze={}));var tt,nt="https://".concat(le,"/tim/docs/components/BindQQ.html?type=login"),ot=function(e){return nt+(e?"&autojump=1":"")};!function(e){e.IFRAME_MESSAGE_CONNECTED="IFRAME_MESSAGE_CONNECTED",e.IFRAME_DOM_MOUNTED="IFRAME_DOM_MOUNTED",e.USER_HAS_CONFIRMED="USER_HAS_CONFIRMED",e.LOGIN_SUCCESS="LOGIN_SUCCESS",e.ERROR="ERROR"}(tt||(tt={}));var rt=function(){function e(t,n){i()(this,e),this.loginDomainService=t,this.messageDomainService=n}return a()(e,[{key:"login",value:function(e,t){var n=this;return this.runLoginProcess(e,t),{dispose:function(){return n.disposeQQLoginIframe()}}}},{key:"disposeQQLoginIframe",value:function(){this.messageDomainService.qqMessage.qqLoginMessage.dispose()}},{key:"loadQQLoginIframe",value:function(e,t){var n,o,r;this.messageDomainService.qqMessage.qqLoginMessage.connect(),this.getLoadQQLoginIframeMessage(t),this.messageDomainService.qqMessage.qqLoginMessage.createQQLoginIframe(e.qqPtLoginIframeRenderDom,this.getQQLoginIframeSrc(null!==(n=null==e?void 0:e.useOauth)&&void 0!==n&&n,null===(o=e.isCheckAutoLogin)||void 0===o||o,null!==(r=e.isJumpFromQQClient)&&void 0!==r&&r,e.isJumpFromQQClient?je("jumpuin"):""))}},{key:"runLoginProcess",value:function(e,t){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function n(){var o;return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.loadQQLoginIframe(e,t),n.next=3,this.getQQLoginSuccessMessage(t);case 3:if(o=n.sent,!e.disableUserInfoAutoUpdating){n.next=7;break}return t(tt.LOGIN_SUCCESS,{}),n.abrupt("return");case 7:return n.next=9,this.checkQQLogin(t,o,e.loginApiData);case 9:case"end":return n.stop()}}),n,this)})))}},{key:"getQQLoginIframeSrc",value:function(e,t,n,o){var r,i=e?(r=ot(n),"https://graph.qq.com/oauth2.0/authorize?which=Login&display=pc&response_type=code&theme=10&client_id=101458937&redirect_uri=".concat(encodeURIComponent(r),"&state=state")):function(e,t){return"https://xui.ptlogin2.qq.com/cgi-bin/xlogin?theme=4&appid=1600000931&pt_no_auth=1&daid=536&link_target=blank&target=self&hide_close_icon=1&style=20&low_login_enable=".concat(e?1:0,"&low_login_foreced=1&low_login_hour=720&hide_border=1&s_url=").concat(encodeURIComponent(t),"&pt_isdocs=0")}(t,ot(n));return o?"".concat(i,"&jumpuin=").concat(o):i}},{key:"getLoadQQLoginIframeMessage",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.messageDomainService.qqMessage.qqLoginMessage.getQQIframeMessage((function(){e(tt.IFRAME_DOM_MOUNTED)}));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"getQQLoginSuccessMessage",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n=this;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){n.messageDomainService.qqMessage.qqLoginMessage.getQQLoginSuccessMessage((function(n){e(tt.USER_HAS_CONFIRMED);var o=n.data;if("string"==typeof o&&o.startsWith("login qq oauth success")&&o.includes("code=")){var r=o.slice(o.indexOf("code=")+5);t({success:!0,code:r})}t({success:!0})}))})));case 1:case"end":return t.stop()}}),t)})))}},{key:"checkQQLogin",value:function(e,t,n){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function o(){var r,i,s,a,c,u;return m.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(c={},!t.code){o.next=7;break}return o.next=4,this.loginDomainService.loginAggregate.loginRepository.checkQQOAuthLogin(t.code,n);case 4:c=o.sent,o.next=10;break;case 7:return o.next=9,this.loginDomainService.loginAggregate.loginRepository.checkQQLogin();case 9:c=o.sent;case 10:if(!(null==(u=c.resData)?void 0:u.data.userIndex)){o.next=15;break}return e(tt.LOGIN_SUCCESS,{userIndex:null==u?void 0:u.data.userIndex}),null===(i=null===(r=navigator.serviceWorker)||void 0===r?void 0:r.controller)||void 0===i||i.postMessage({type:Ze.SWITCH_USER_INDEX,data:{userIndex:u.data.userIndex,url:location.href}}),o.abrupt("return");case 15:if(0!==(null==u?void 0:u.cgicode)){o.next=19;break}return e(tt.LOGIN_SUCCESS),null===(a=null===(s=navigator.serviceWorker)||void 0===s?void 0:s.controller)||void 0===a||a.postMessage({type:Ze.SWITCH_USER_INDEX,data:{url:location.href}}),o.abrupt("return");case 19:e(tt.ERROR,{errorQrQQLoginStatus:tt.LOGIN_SUCCESS});case 20:case"end":return o.stop()}}),o,this)})))}}]),e}();rt=Object(E.__decorate)([Object(E.__param)(0,k.a),Object(E.__param)(1,T.a),Object(E.__metadata)("design:paramtypes",[Object,Object])],rt);var it=function(){function e(t,n,o){i()(this,e),this.messageDomainService=t,this.loginDomainService=n,this.accountDomainService=o,this.isExpired=!1}return a()(e,[{key:"login",value:function(e,t){var n=this;return this.runLoginProcess(e,t),{dispose:function(){return n.dispose()}}}},{key:"dispose",value:function(){this.qrTimer&&clearTimeout(this.qrTimer),this.pollingTimer&&clearTimeout(this.pollingTimer),this.isExpired=!0}},{key:"runLoginProcess",value:function(e,t){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function n(){var o;return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(null==t?void 0:t.useOfficialAccountOrH5)?this.getWechatLoginQRUrl(e,t):this.getWechatLoginQRcode(e);case 2:if(o=n.sent){n.next=5;break}return n.abrupt("return");case 5:this.isExpired=!1,this.runPolling(o,e,null==t?void 0:t.pollingApiData),this.runQRTimer(o,e);case 8:case"end":return n.stop()}}),n,this)})))}},{key:"getWechatLoginQRcode",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n,o;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loginDomainService.loginAggregate.loginRepository.getWeChatLogInQRCodeURI();case 2:if(n=t.sent,0!==(null==(o=n.resData)?void 0:o.retcode)){t.next=7;break}return e(Je.CODE_IS_READY,{qrCodeImage:"data:image/png;base64,".concat(o.data.img),checkKey:o.data.checkKey}),t.abrupt("return",o.data.checkKey);case 7:return e(Je.ERROR,{errorQrQQLoginStatus:Je.CODE_IS_READY}),t.abrupt("return","");case 9:case"end":return t.stop()}}),t,this)})))}},{key:"getWechatLoginQRUrl",value:function(e,t){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function n(){var o,r;return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.loginDomainService.loginAggregate.loginRepository.getWeChatLogInQRURI(null==t?void 0:t.wechatLoginCase);case 2:if(o=n.sent,0!==(null==(r=o.resData)?void 0:r.retcode)){n.next=7;break}return e(Je.CODE_IS_READY,{qrCodeUrl:r.data.url,checkKey:r.data.checkKey}),n.abrupt("return",r.data.checkKey);case 7:return e(Je.ERROR,{errorQrQQLoginStatus:Je.CODE_IS_READY}),n.abrupt("return","");case 9:case"end":return n.stop()}}),n,this)})))}},{key:"runPolling",value:function(e,t,n){var o=this,r=this.accountDomainService.accountAggregate.userInfo.nowUserIndex;this.isExpired||(this.pollingTimer=setTimeout((function(){return Object(E.__awaiter)(o,void 0,void 0,m.a.mark((function o(){var i,s,a,c,u,d,l,p;return m.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.loginDomainService.loginAggregate.loginRepository.updateWeChatLoginQRCodeStatus(e,n);case 2:if(u=o.sent,0===(null==(d=u.resData)?void 0:d.retcode)){o.next=10;break}return G.a.postMessage({type:S.a.LOGIN,data:r,needCookie:!0}),t(Je.ERROR,{errorQrQQLoginStatus:Je.USER_HAS_SCANNED,checkKey:e}),clearTimeout(this.qrTimer),clearTimeout(this.pollingTimer),o.abrupt("return");case 10:if(l=null!==(s=null===(i=null==d?void 0:d.data)||void 0===i?void 0:i.status)&&void 0!==s?s:{},p=l.loginScanFlag,!l.login){o.next=18;break}return G.a.postMessage({type:S.a.LOGIN,data:r,needCookie:!0}),t(Je.LOGIN_SUCCESS,{userIndex:d.data.userIndex,checkKey:e}),clearTimeout(this.qrTimer),clearTimeout(this.pollingTimer),null===(c=null===(a=navigator.serviceWorker)||void 0===a?void 0:a.controller)||void 0===c||c.postMessage({type:Ze.SWITCH_USER_INDEX,data:{userIndex:d.data.userIndex,url:location.href}}),o.abrupt("return");case 18:p&&t(Je.USER_HAS_SCANNED,{checkKey:e}),clearTimeout(this.pollingTimer),this.runPolling(e,t,n);case 21:case"end":return o.stop()}}),o,this)})))}),1e3))}},{key:"runQRTimer",value:function(e,t){var n=this;this.qrTimer=setTimeout((function(){t(Je.CODE_WAS_EXPIRED,{checkKey:e}),n.isExpired=!0,clearTimeout(n.qrTimer)}),58e3)}}]),e}();it=Object(E.__decorate)([Object(E.__param)(0,T.a),Object(E.__param)(1,k.a),Object(E.__metadata)("design:paramtypes",[Object,Object,Object])],it);var st;!function(e){e.IFRAME_MESSAGE_CONNECTED="IFRAME_MESSAGE_CONNECTED",e.IFRAME_DOM_MOUNTED="IFRAME_DOM_MOUNTED",e.USER_HAS_CONFIRMED="USER_HAS_CONFIRMED",e.GOT_CHANGE_KEY="GOT_CHANGE_KEY",e.LOGIN_SUCCESS="LOGIN_SUCCESS",e.ERROR="ERROR"}(st||(st={}));var at=function(){function e(t){i()(this,e),this.messageDomainService=t}return a()(e,[{key:"login",value:function(e,t){var n=this;return this.loadWeworkLoginIframe(e,t),this.getWeworkLoginSuccessMessage(t),{dispose:function(){return n.dispose()}}}},{key:"loadWeworkLoginIframe",value:function(e,t){var n,o;this.messageDomainService.weworkMessage.weworkLoginMessage.connect("enterprise"),this.getLoadWeworkLoginIframeMessage(t),this.messageDomainService.weworkMessage.weworkLoginMessage.createWeworkLoginIframe(e.weworkLoginIframeRenderDom,(o=e.targetUrl,n=o.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),"https://".concat(le,"/scenario/wework-quick-login.html?redirect_uri=").concat(encodeURIComponent(n),"&open_id_gray=1&code_gray=1")))}},{key:"dispose",value:function(){this.messageDomainService.weworkMessage.weworkLoginMessage.dispose()}},{key:"getLoadWeworkLoginIframeMessage",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.messageDomainService.weworkMessage.weworkLoginMessage.getWeworkIframeMessage((function(){e(st.IFRAME_DOM_MOUNTED)}));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"getWeworkLoginSuccessMessage",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n=this;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){n.messageDomainService.weworkMessage.weworkLoginMessage.getWeworkLoginSuccessMessage((function(n){var o,r,i=n.data;i.includes("code=")?e(st.LOGIN_SUCCESS,{code:i.slice(i.indexOf("code=")+5)}):e(st.LOGIN_SUCCESS),null===(r=null===(o=navigator.serviceWorker)||void 0===o?void 0:o.controller)||void 0===r||r.postMessage({type:Ze.SWITCH_USER_INDEX,data:{url:location.href}}),G.a.postMessage({type:S.a.LOGIN,data:"",needCookie:!0}),t(i)}))})));case 1:case"end":return t.stop()}}),t)})))}}]),e}();at=Object(E.__decorate)([Object(E.__param)(0,T.a),Object(E.__metadata)("design:paramtypes",[Object])],at);var ct=function(){function e(t,n,o){i()(this,e),this.loginDomainService=t,this.messageDomainService=n,this.accountDomainService=o}return a()(e,[{key:"qrQQLogin",value:function(e,t){return new rt(this.loginDomainService,this.messageDomainService).login(e,t)}},{key:"qrWechatLogin",value:function(e,t){return new it(this.messageDomainService,this.loginDomainService,this.accountDomainService).login(e,t)}},{key:"enterpriseQrWechatLogin",value:function(e){return new et(this.loginDomainService).login(e)}},{key:"qrWecomLogin",value:function(e,t){return new at(this.messageDomainService).login(e,t)}}]),e}();ct=Object(E.__decorate)([Object(E.__param)(0,k.a),Object(E.__param)(1,T.a),Object(E.__metadata)("design:paramtypes",[Object,Object,Object])],ct);var ut,dt="document";function lt(e){return se("Object",e)?JSON.stringify(e):e}function pt(e,t,n,o,r){if(xe(Le,dt)){var i=encodeURIComponent(lt(t)),s=2592e6;n&&(s=864e5*n);var a=new Date;s+=a.getTime(),a.setTime(s);var c=a.toUTCString(),u=o||"/",d=r?"domain=".concat(r,";"):"";document.cookie="".concat(e,"=").concat(i,";expires=").concat(c,";path=").concat(u,";").concat(d)}}function ht(e,t,n){if(xe(Le,dt)){var o=t||"/",r=n?"domain=".concat(n,";"):"",i=new Date(0).toUTCString();document.cookie="".concat(e,"=;expires=").concat(i,";path=").concat(o,";").concat(r)}}function ft(e){if(!xe(Le,dt))return null;var t=new RegExp("(?:^|;+|\\s+)".concat(e,"=([^;]*)")),n=document.cookie.match(t);return(n?n[1]:null)||null}!function(e){e.xsrf="TOK",e.devRouteId="dev_route_id",e.devOaName="dev_oa_name",e.fd="fd",e.envId="env_id",e.sid="SID",e.sids="SID_S",e.uid="uid",e.uidKey="uid_key",e.uin="uin",e.loginTime="loginTime",e.hasBeenLogin="has_been_login",e.adtag="adtag",e.plUin="p_luin",e.pUin="p_uin",e.pSkey="p_skey",e.plSkey="p_lskey"}(ut||(ut={}));var vt="#",gt="?",mt="&";function Et(e,t){var n,o=e.split(gt),r=null===(n=o[1])||void 0===n?void 0:n.split(mt);if(!r)return e;var i=r;return t.forEach((function(e){r.forEach((function(t){if(0===t.indexOf("".concat(e,"="))){var n=i.indexOf(t);i.splice(n,1)}}))})),0===i.length?o[0]:(o[1]=i.join(mt),o.join(gt))}function yt(e,t){if(e.includes(gt)){var n=e;return Object.keys(t).map((function(e){n=function(e,t,n){var o=e.split(gt),r=o[1].split(mt),i=!0,s=new Map;r.forEach((function(e){var t=e.split("=");s.set(t[0],t[1])})),r.some((function(e){0===e.indexOf("".concat(t,"="))&&(s.set(t,n),i=!1)})),i&&s.set(t,n);var a=[];return s.forEach((function(e,t){var n="".concat(t,"=").concat(e);a.push(n)})),o[1]=a.join(mt),o.join(gt)}(n,e,t[e])})),n}var o=Object.keys(t).map((function(e){return"".concat(e,"=").concat(t[e])})).join(mt);return"".concat(e,"?").concat(o)}function _t(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(e.split(gt).length<2||t.length<1)return e;if(e.includes(vt)){var o=e.split(vt);return o[0]=Et(o[0],t),o.join(vt)}return Et(e,t)}function bt(e,t){if(Object.keys(t).length<1)return e;if(e.includes(vt)){var n=e.split(vt);return n[0]=yt(n[0],t),n.join(vt)}return yt(e,t)}var Ct=me,Rt=function(){function e(t){i()(this,e),this.accountDomainService=t}return a()(e,[{key:"loginSuccessJumpUrl",value:function(e,t,n,o){var r=this.accountDomainService.accountAggregate.userInfo.nowUserIndex;if(t){var i=window.btoa(Ct).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,""),s="".concat(Ee,"?product=2&from=30&code=").concat(n,"&redirect_url=").concat(i);Object(Y.tencentDocOpenUrlForAll)({replace:null==o?void 0:o.replace,url:s})}else{var a=bt(_t(e,"autoshowlogin","u","jumpuin"),Q()({},"_t",Date.now()));G.a.postMessage({type:S.a.LOGIN,data:r,needCookie:!0}),Object(Y.tencentDocOpenUrlForAll)({replace:!0,url:a})}}},{key:"logoutSuccessJumpUrl",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n,o,r,i,s,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=_t(window.location.href,"u"),e.next=3,this.accountDomainService.accountAggregate.accountListEntity.getAccountList();case 3:if(n=e.sent,o=ft("uid")||null,r=n.find((function(e){return e.uid!==o})),!(null==(i=r)?void 0:i.userIndex)){e.next=13;break}return e.next=10,this.accountDomainService.accountAggregate.accountListEntity.changeSign(i.userIndex);case 10:return s=bt(_t(t,"u"),{u:i.userIndex}),Object(Y.tencentDocOpenUrlForAll)({replace:!0,url:s}),e.abrupt("return");case 13:a=bt(_t(t,"needShowTips"),{needShowTips:1}),Object(Y.tencentDocOpenUrlForAll)({replace:!0,url:a,noUserIndex:!0});case 15:case"end":return e.stop()}}),e,this)})))}}]),e}();Rt=Object(E.__decorate)([Object(E.__param)(0,O.a),Object(E.__metadata)("design:paramtypes",[Object])],Rt);var St,Ot,Tt=L.default.isPC||L.default.isIPad&&!(L.default.isMiniProgram||L.default.isTencentDocsApp||L.default.isWeChat||L.default.isQQ||L.default.isTim||L.default.isWxWork),kt=function(){function e(t){i()(this,e),this.loginDomainService=t}return a()(e,[{key:"login",value:function(e,t,n){document.location.pathname.indexOf("/desktop")>-1?this.desktopLogin(e,t):this.docLogin(e,t,n)}},{key:"docLogin",value:function(e,t,n){var o=this.loginDomainService.loginAggregate;L.default.isMiniProgram?o.loginDocsInMiniProgram(e):L.default.isWeChat?n():L.default.isWxWork?o.loginDocsInWework(e):(L.default.isTimOrQQ&&o.timOrQQH5Login(),Tt?t():o.jumpToLoginInCommonView(e))}},{key:"desktopLogin",value:function(e,t){var n=this.loginDomainService.loginAggregate;L.default.isMiniProgram?n.reloadMiniProgramForDesktop():L.default.isWeChat?n.jumpToLoginInWechatWebview(e):L.default.isWxWork?n.jumpToLoginInWeworkWebview(e):Tt?t():n.jumpToLoginInCommonView(e)}}]),e}();kt=Object(E.__decorate)([Object(E.__param)(0,k.a),Object(E.__metadata)("design:paramtypes",[Object])],kt),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.QQ=1]="QQ",e[e.WX=2]="WX",e[e.WORK=3]="WORK",e[e.EMAIL=4]="EMAIL",e[e.PHONE=8]="PHONE",e[e.WORK_COMBINATION=9]="WORK_COMBINATION",e[e.TOWER=10]="TOWER",e[e.ROBOT=11]="ROBOT",e[e.QFYF=12]="QFYF",e[e.OPEN=13]="OPEN",e[e.MEETING=14]="MEETING"}(St||(St={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.WECHAT=4]="WECHAT",e[e.WEWORK=3]="WEWORK"}(Ot||(Ot={}));var It=function(){ht("p_uin","/",fe),ht("p_skey","/",fe),ht("p_luin","/",fe),ht("p_lskey","/",fe),ht("p_uin","/",he),ht("p_skey","/",he),ht("p_luin","/",he),ht("p_lskey","/",he),ht("txdoc_pwd_token","/",fe)},wt=function(){function e(t){i()(this,e),this.accountDomainService=t}return a()(e,[{key:"logout",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.accountDomainService.accountAggregate.userInfo.loginType!==St.WORK){t.next=3;break}return t.abrupt("return",this.logoutForEnterpriseAccount());case 3:return t.abrupt("return",this.logoutForPersonAccount(e));case 4:case"end":return t.stop()}}),t,this)})))}},{key:"getLogoutMessage",value:function(e){G.a.setCallback((function(){e()}))}},{key:"logoutForEnterpriseAccount",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n,o,r,i,s,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=this.accountDomainService.accountAggregate.userInfo,r=o.tinyId,i=o.nowUserIndex,e.next=3,this.accountDomainService.accountAggregate.accountRepository.wecomLogoutForCDomain(r);case 3:if(s=e.sent,0!==(null==(a=s.resData)?void 0:a.retcode)){e.next=9;break}return G.a.postMessage({type:S.a.LOGOUT,data:i,needCookie:!0}),null===(n=null===(t=navigator.serviceWorker)||void 0===t?void 0:t.controller)||void 0===n||n.postMessage({type:Ze.DELETE_USER_INDEX,data:{userIndex:i}}),e.abrupt("return",!0);case 9:return e.abrupt("return",!1);case 10:case"end":return e.stop()}}),e,this)})))}},{key:"logoutForPersonAccount",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n,o,r,i,s;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this.accountDomainService.accountAggregate.userInfo.nowUserIndex,t.next=3,this.accountDomainService.accountAggregate.accountRepository.logout(e);case 3:if(i=t.sent,0!==(null==(s=i.resData)?void 0:s.retcode)){t.next=10;break}return G.a.postMessage({type:S.a.LOGOUT,data:r,needCookie:!0}),null===(o=null===(n=navigator.serviceWorker)||void 0===n?void 0:n.controller)||void 0===o||o.postMessage({type:Ze.DELETE_USER_INDEX,data:{userIndex:r}}),It(),t.abrupt("return",!0);case 10:return t.abrupt("return",!1);case 11:case"end":return t.stop()}}),t,this)})))}}]),e}();wt=Object(E.__decorate)([Object(E.__param)(0,O.a),Object(E.__metadata)("design:paramtypes",[Object])],wt);var Mt=function(){return ft("TOK")};function Dt(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){setTimeout(t,e)})));case 1:case"end":return t.stop()}}),t)})))}var At,Nt;!function(e){e[e.CAN_NOT_VIEW=0]="CAN_NOT_VIEW",e[e.CAN_VIEW=1]="CAN_VIEW"}(At||(At={})),function(e){e.QQ="qq",e.WX="wx",e.WX_WORK="wx-work",e.WW="ww",e.QFYF="qfyf"}(Nt||(Nt={}));var Lt=function(){function e(t,n){i()(this,e),this.accountDomainService=t,this.messageDomainService=n,this.accountListApplicationService=new He(t,n)}return a()(e,[{key:"switchAccount",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n,o;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.accountType,o=e.userIndex,G.a.postMessage({type:S.a.SWITCH,data:o,needCookie:!0}),n!==Nt.WW||!document.location.pathname.includes("/desktop")){t.next=5;break}return Object(Y.tencentDocOpenUrlForAll)({url:me}),t.abrupt("return");case 5:if(n!==Nt.WW||!document.location.pathname.includes("/mall")){t.next=8;break}return Object(Y.tencentDocOpenUrlForAll)({url:me,replace:!0}),t.abrupt("return");case 8:if(n!==Nt.WW||!document.location.pathname.includes("/resume")){t.next=11;break}return Object(Y.tencentDocOpenUrlForAll)({url:me,replace:!0}),t.abrupt("return");case 11:return It(),t.next=14,this.accountListApplicationService.changeSign(e);case 14:this.switchFetchAccount(o);case 15:case"end":return t.stop()}}),t,this)})))}},{key:"switchFetchAccount",value:function(e){var t,n;null===(n=null===(t=navigator.serviceWorker)||void 0===t?void 0:t.controller)||void 0===n||n.postMessage({type:Ze.SWITCH_USER_INDEX,data:{userIndex:e,url:location.href}}),Object(Y.tencentDocOpenUrlForAll)({url:this.getNewJumpUrl(e),replace:!0,noUserIndex:!0})}},{key:"switchEnterpriseAccount",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n,o=this;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.cookie){t.next=3;break}return t.abrupt("return",!1);case 3:return this.messageDomainService.switchEnterpriseAccountMessage.connect(),this.getIframeMountMessage(n),this.messageDomainService.switchEnterpriseAccountMessage.createSwitchEnterpriseAccount((function(){o.messageDomainService.switchEnterpriseAccountMessage.sendSwitchAccountMessage(n)})),t.next=8,this.getSwitchAccountMessage();case 8:if(t.sent){t.next=11;break}return t.abrupt("return",!1);case 11:case"end":return t.stop()}}),t,this)})))}},{key:"getNewJumpUrl",value:function(e){var t=location,n=t.pathname,o=t.hostname,r="https://".concat(o).concat(n);(function(e){return/^(https?:)?\/\/(\w*\.)*(docs\.qq\.com|txdocs\.qq\.com|doc\.weixin\.qq\.com)($|\/|\\|\?)/i.test(decodeURIComponent(e))})(je("success_jump_url"))&&(r=_t((r=decodeURIComponent(je("success_jump_url"))||"https://".concat(o).concat(n)).replace(/&$/gi,""),"u"));var i=location.search;if(i=_t(i.replace(/&$/gi,""),"hst"),i=_t(i.replace(/&$/gi,""),"success_jump_url"),""===(i=_t(i.replace(/&$/gi,""),"show_type"))&&e)return"".concat(r,"?u=").concat(e);if(""===i)return"".concat(r);var s=i.replace(/(&)*u=(\w+)(\/|\?|#|&|$)/,"");return e?"".concat(r).concat(s,"&u=").concat(e):"".concat(r).concat(s)}},{key:"getIframeMountMessage",value:function(e){var t=this;return new Promise((function(n){t.messageDomainService.switchEnterpriseAccountMessage.getIframeMountMessage((function(){n(!0),t.messageDomainService.switchEnterpriseAccountMessage.sendSwitchAccountMessage(e)}))}))}},{key:"getSwitchAccountMessage",value:function(){var e=this;return new Promise((function(t){e.messageDomainService.switchEnterpriseAccountMessage.getSwitchAccountMessage((function(){t(!0)}))}))}}]),e}();Lt=Object(E.__decorate)([Object(E.__param)(0,O.a),Object(E.__param)(1,T.a),Object(E.__metadata)("design:paramtypes",[Object,Object])],Lt);var xt=function e(t,n){if(Array.isArray(t))return t.map((function(t){return e(t,n)}));if(!t)return t;for(var o={},r=0,i=Object.keys(t);r<i.length;r++){var s=i[r];o[n.words.includes(s)?n.raw[s]:s]=t[s]}return o},Pt=function(e){return function(t){return xt(t,e)}};function Ut(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=v()(e);if(t){var r=v()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return h()(this,n)}}var jt=Pt(Me),Bt=function(e){l()(n,e);var t=Ut(n);function n(e,o,r){var s;i()(this,n),(s=t.call(this)).accountDomainService=e,s.loginDomainService=o,s.messageDomainService=r,s.accountApplicationOfflineService=new We;var a=null===globalThis||void 0===globalThis?void 0:globalThis.basicClientVars;s.isInitFinish=s.accountDomainService.createPersonalEnvAccountAggregateByBasicClientVars(null==a?void 0:a.userInfo);var c=s.accountDomainService.accountAggregate.userInfo.tinyId;return s.loginDomainService.createLoginAggregate(c),s.initDomainService(),s.accountListApplicationService=new He(e,r),s.dcLoginApplicationService=new ct(o,r,e),s}return a()(n,[{key:"updatePasswordsSettings",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.accountDomainService.accountAggregate,e.next=3,t.passwordEntity.updatePwdTips();case 3:return e.abrupt("return",{enabled:t.passwordEntity.isHasPassword,phoneNumber:t.passwordEntity.phone});case 4:case"end":return e.stop()}}),e,this)})))}},{key:"updateVipInfo",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getUserVipInfo();case 2:return t=this.accountDomainService.accountAggregate,n=t.vipInfo,o=t.userInfo,this.accountApplicationOfflineService.updateUserInfo(Object.assign(Object.assign({},o),{vipUserInfo:n})),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"updateBindUserInfo",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n,o,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.completionUserInfo();case 2:return t=this.accountDomainService.accountAggregate,n=t.userInfo,o=t.bindUserInfo,r=t.officialInfo,this.accountApplicationOfflineService.updateUserInfo(Object.assign(Object.assign({},n),{bindUserInfo:o,officialInfo:r})),e.abrupt("return",o);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"updateOfficialInfo",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n,o,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.completionUserInfo();case 2:return t=this.accountDomainService.accountAggregate,n=t.userInfo,o=t.bindUserInfo,r=t.officialInfo,this.accountApplicationOfflineService.updateUserInfo(Object.assign(Object.assign({},n),{bindUserInfo:o,officialInfo:r})),e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"updateUserInfo",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.accountDomainService.updatePersonalEnvAccountAggregate(e);case 2:return n=this.accountDomainService.accountAggregate.userInfo.tinyId,this.loginDomainService.createLoginAggregate(n),this.initDomainService(),t.abrupt("return",this.accountDomainService.accountAggregate.userInfo);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"init",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isInitFinish){e.next=2;break}return e.abrupt("return",!0);case 2:return e.next=4,this.initForUserInfoFetch();case 4:if(!e.sent){e.next=7;break}return e.abrupt("return",!0);case 7:return e.abrupt("return",this.initForUserInfoOfflineData());case 8:case"end":return e.stop()}}),e,this)})))}},{key:"dispose",value:function(){}},{key:"updatePersonalNicknameAndAvatar",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.accountDomainService.updatePersonalNicknameAndAvatar(e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"getPasswordsModifyQuestionList",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.accountDomainService.accountAggregate,e.next=3,t.passwordEntity.updatePwdQuestionList();case 3:return e.abrupt("return",t.passwordEntity.pwdQuestionList);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"getAccountProfileList",value:function(e,t){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function n(){var o;return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.accountListApplicationService.getPersonalAccountList(e,t);case 2:return o=n.sent,n.abrupt("return",jt(o));case 4:case"end":return n.stop()}}),n,this)})))}},{key:"getFetchAccountList",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountListApplicationService.getFetchAccountList();case 2:return t=e.sent,e.abrupt("return",jt(t));case 4:case"end":return e.stop()}}),e,this)})))}},{key:"completionUserInfo",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountDomainService.completionUserInfo();case 2:return t=e.sent,this.bindUserInfo=this.accountDomainService.accountAggregate.bindUserInfo,this.officialInfo=this.accountDomainService.accountAggregate.officialInfo,e.abrupt("return",t);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"getUserVipInfo",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountDomainService.getUserVipInfo();case 2:return t=e.sent,this.vipInfo=this.accountDomainService.accountAggregate.vipInfo,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"loginSuccessJumpUrl",value:function(e,t,n,o){new Rt(this.accountDomainService).loginSuccessJumpUrl(e,t,n,o)}},{key:"logoutSuccessJumpUrl",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Rt(this.accountDomainService),e.next=3,t.logoutSuccessJumpUrl();case 3:case"end":return e.stop()}}),e,this)})))}},{key:"login",value:function(e,t,n){new kt(this.loginDomainService).login(e,t,n)}},{key:"logout",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new wt(this.accountDomainService),t.abrupt("return",n.logout(e));case 2:case"end":return t.stop()}}),t,this)})))}},{key:"deleteAccount",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.accountListApplicationService.deleteAccountForList(e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"switchToAccount",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new Lt(this.accountDomainService,this.messageDomainService),t.next=3,n.switchAccount(e);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"bindQQAccount",value:function(e){return new $e(this.accountDomainService,this.loginDomainService).qqBind(e)}},{key:"getCertificationGrey",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n,o,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountDomainService.accountAggregate.accountRepository.getCertificationGrey();case 2:return o=e.sent,r=o.resData,e.abrupt("return",(null===(n=null===(t=null==r?void 0:r.data)||void 0===t?void 0:t.result)||void 0===n?void 0:n.open)||!1);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"bindWeChatAccount",value:function(){return new $e(this.accountDomainService,this.loginDomainService).wechatBind()}},{key:"getQQBindingInfo",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.accountDomainService.accountAggregate.bindingQQInfo());case 1:case"end":return e.stop()}}),e,this)})))}},{key:"getTipsStatus",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.accountDomainService.getTipsStatus(e);case 2:return n=t.sent,t.abrupt("return",n);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"initDomainAction",value:function(){var e=this.accountDomainService.accountAggregate,t=e.passwordEntity.passwordRepository;this.sendVerifyCodeSMS=t.pwdVerifyCodeGet.bind(t),this.addPasswordsWithNewPhoneNumber=t.pwdAdd.bind(t),this.resetPasswords=t.pwdReset.bind(t),this.verifyCodeSMS=t.pwdVerifyCodeCheck.bind(t),this.verifyQuestionAnswers=t.pwdQuestionCheck.bind(t),this.delPasswords=t.pwdDel.bind(t),this.verifyPasswords=t.pwdVerify.bind(t),this.unbindAccount=e.accountRepository.unbindUserInfo.bind(e.accountRepository),this.getCurrentAccountBindingInfo=e.currentLoginAccountBindInfo.bind(e)}},{key:"initDomainService",value:function(){var e=this.accountDomainService.accountAggregate;this.userInfo=e.userInfo;var t=e.passwordEntity,n=t.isHasPassword,o=t.phone;this.passwordsSettings={enabled:n,phoneNumber:o},this.vipInfo=e.vipInfo,this.bindUserInfo=e.bindUserInfo,this.officialInfo=e.officialInfo,this.accountApplicationOfflineService.addUserInfo(Object.assign(Object.assign({},this.userInfo),{vipUserInfo:this.vipInfo,bindUserInfo:this.bindUserInfo})),this.initDomainAction()}},{key:"initForUserInfoFetch",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n,o,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountDomainService.userInfoRepository.getPersonalUserInfo();case 2:if(t=e.sent,n=t.resData,!t.error){e.next=7;break}return e.abrupt("return",!1);case 7:return 0===(null==n?void 0:n.cgicode)&&(o=window.nowUserIndex||"",this.accountDomainService.createPersonalEnvAccountAggregateByUserInfoCgi(n.data,o),r=this.accountDomainService.accountAggregate.userInfo.tinyId,this.loginDomainService.createLoginAggregate(r),this.initDomainService()),e.abrupt("return",!0);case 9:case"end":return e.stop()}}),e,this)})))}},{key:"initForUserInfoOfflineData",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountApplicationOfflineService.getUserInfo();case 2:if(t=e.sent,this.accountApplicationOfflineService.setOnOfflineState(!0),t){e.next=6;break}return e.abrupt("return",!1);case 6:return this.userInfo=t.userInfo,this.vipInfo=t.vipInfo,this.bindUserInfo=t.bindUserInfo,e.abrupt("return",!0);case 10:case"end":return e.stop()}}),e,this)})))}}]),n}(M.Disposable);Object(E.__decorate)([Oe,Object(E.__metadata)("design:type",Object)],Bt.prototype,"userInfo",void 0),Object(E.__decorate)([Oe,Object(E.__metadata)("design:type",Object)],Bt.prototype,"passwordsSettings",void 0),Object(E.__decorate)([Oe,Object(E.__metadata)("design:type",Object)],Bt.prototype,"vipInfo",void 0),Object(E.__decorate)([Oe,Object(E.__metadata)("design:type",Object)],Bt.prototype,"bindUserInfo",void 0),Object(E.__decorate)([Oe,Object(E.__metadata)("design:type",Object)],Bt.prototype,"officialInfo",void 0),Object(E.__decorate)([Re("passwordsSettings"),Object(E.__metadata)("design:type",Function),Object(E.__metadata)("design:paramtypes",[]),Object(E.__metadata)("design:returntype",Promise)],Bt.prototype,"updatePasswordsSettings",null),Object(E.__decorate)([Re("vipInfo"),Object(E.__metadata)("design:type",Function),Object(E.__metadata)("design:paramtypes",[]),Object(E.__metadata)("design:returntype",Promise)],Bt.prototype,"updateVipInfo",null),Object(E.__decorate)([Re("bindUserInfo"),Object(E.__metadata)("design:type",Function),Object(E.__metadata)("design:paramtypes",[]),Object(E.__metadata)("design:returntype",Promise)],Bt.prototype,"updateBindUserInfo",null),Object(E.__decorate)([Re("officialInfo"),Object(E.__metadata)("design:type",Function),Object(E.__metadata)("design:paramtypes",[]),Object(E.__metadata)("design:returntype",Promise)],Bt.prototype,"updateOfficialInfo",null),Object(E.__decorate)([Re("userInfo"),Object(E.__metadata)("design:type",Function),Object(E.__metadata)("design:paramtypes",[String]),Object(E.__metadata)("design:returntype",Promise)],Bt.prototype,"updateUserInfo",null),Object(E.__decorate)([te(),Object(E.__metadata)("design:type",Function),Object(E.__metadata)("design:paramtypes",[]),Object(E.__metadata)("design:returntype",Promise)],Bt.prototype,"init",null),Object(E.__decorate)([ne("init"),Object(E.__metadata)("design:type",Function),Object(E.__metadata)("design:paramtypes",[]),Object(E.__metadata)("design:returntype",void 0)],Bt.prototype,"dispose",null),Bt=Object(E.__decorate)([Ie(),Object(E.__param)(0,O.a),Object(E.__param)(1,k.a),Object(E.__param)(2,T.a),Object(E.__metadata)("design:paramtypes",[Object,Object,Object])],Bt);var Ft=function(){function e(t,n){i()(this,e),this.messageDomainService=t,this.accountDomainService=n}return a()(e,[{key:"getAccountList",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getFetchEnterpriseAccountList();case 2:return this.fetchEnterpriseAccountList=e.sent,e.abrupt("return",this.fetchEnterpriseAccountList);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"deleteAccountForList",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n,o;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.uid,o=!0,!this.isHasSameUid(this.fetchEnterpriseAccountList,n)){t.next=7;break}return t.next=6,this.deleteFetchEnterpriseAccountList(e);case 6:o=t.sent;case 7:return t.abrupt("return",this.changeDeleteAccountState(o));case 8:case"end":return t.stop()}}),t,this)})))}},{key:"addAccountForList",value:function(){}},{key:"dispose",value:function(){this.messageDomainService.getPersonAccountListMessage.dispose()}},{key:"deleteFetchEnterpriseAccountList",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n,o,r,i;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.cookie,o=n.wedocSid,r=n.wedriveSid,i=o||r){t.next=4;break}return t.abrupt("return",!1);case 4:return t.next=6,this.accountDomainService.accountAggregate.enterpriseAccountListEntity.delEnterpriseAccountForList(i);case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t,this)})))}},{key:"getFetchEnterpriseAccountList",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountDomainService.accountAggregate.enterpriseAccountListEntity.getEnterpiseAccountList();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"changeDeleteAccountState",value:function(e){return e?Be.SUCCESS:Be.FAIL}},{key:"isHasSameUid",value:function(e,t){return e.some((function(e){return e.uid===t}))}}]),e}();Ft=Object(E.__decorate)([Object(E.__param)(0,T.a),Object(E.__param)(1,I.a),Object(E.__metadata)("design:paramtypes",[Object,Object])],Ft);var Wt=function(){function e(){i()(this,e)}return a()(e,[{key:"loginSuccessJumpUrl",value:function(e,t){Object(Y.tencentDocOpenUrlForAll)({replace:!0,url:e,noUserIndex:!0})}},{key:"logoutSuccessJumpUrl",value:function(){var e=_t(window.location.href,"u","wwapp_deviceid","wwapp_vid","wwapp_cst","needShowTips");window.location.pathname.includes("home/recent")?window.location.replace("".concat(be,"?success_jump_url=").concat(encodeURIComponent(ye))):window.location.replace(e)}}]),e}(),Kt=function(){function e(t){i()(this,e),this.accountDomainService=t}return a()(e,[{key:"logout",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.accountDomainService.accountAggregate.userInfo,n=t.loginType,o=t.tinyId,n!==St.WORK){e.next=4;break}return e.next=4,this.logoutForEnterpriseAccount();case 4:return ht("utype","/",ge),ht("uid","/",ge),ht("uid","/",pe),ht("uid_key","/",ge),ht("login_client","/",ge),ht("CheckKey","/",ge),ht("TOK","/",ge),ht("ES2","/",ge),ht("loginTime","/",ge),ht("wedrive_uin","/",fe),ht("wedrive_sids","/",fe),ht("wedrive_sid","/",fe),ht("wedrive_skey","/",fe),ht("wedrive_ticket","/",fe),ht("wedrive_uin","/",ve),ht("wedrive_sids","/",ve),ht("wedrive_sid","/",ve),ht("wedrive_skey","/",ve),ht("wedrive_ticket","/",ve),ht("wedrive_uin","/",ge),ht("wedrive_sids","/",ge),ht("wedrive_sid","/",ge),ht("wedrive_skey","/",ge),ht("wedrive_ticket","/",ge),ht("tdoc_vid","/",fe),ht("tdoc_sid","/",fe),ht("tdoc_skey","/",fe),ht("tdoc_vid","/",ve),ht("tdoc_sid","/",ve),ht("tdoc_skey","/",ve),ht("tdoc_vid","/",ge),ht("tdoc_sid","/",ge),ht("tdoc_skey","/",ge),ht("wedoc_openid","/",ge),ht("wedoc_skey","/",ge),ht("wedoc_ticket","/",ge),ht("wedoc_sid","/",ge),ht("tdoc_uid","/",ge),ht("tdoc_skey","/",ge),G.a.postMessage({type:S.a.LOGOUT,data:o,needCookie:!0}),e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"logoutForEnterpriseAccount",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n,o,r,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=ft("wedoc_sid"),n=ft("wedrive_sid"),!(o=t||n)){e.next=10;break}return e.next=6,this.accountDomainService.accountAggregate.accountRepository.wecomLogoutForBDomain(o);case 6:if(r=e.sent,0!==(null==(i=r.resData)?void 0:i.retcode)){e.next=10;break}return e.abrupt("return",!0);case 10:return e.abrupt("return",!1);case 11:case"end":return e.stop()}}),e,this)})))}}]),e}();Kt=Object(E.__decorate)([Object(E.__param)(0,I.a),Object(E.__metadata)("design:paramtypes",[Object])],Kt);var Gt=function(){function e(t){i()(this,e),this.messageDomainService=t}return a()(e,[{key:"switchAccount",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n,o,r,i,s;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.cookie,o=e.uid,e.fromDomain!==w.a.C_DOMAIN){t.next=9;break}if(n){t.next=4;break}return t.abrupt("return",!1);case 4:return t.next=6,this.switchPersonAccount(n);case 6:return(r=t.sent)&&(i=this.isInDesktopPage()?ye:"".concat(location.origin).concat(location.pathname),s="".concat(_e,"?redirect_uri=").concat(i,"u=").concat(e.userIndex),window.location.href=s),t.abrupt("return",r);case 9:return this.switchEnterpriseAccount(e),G.a.postMessage({type:S.a.SWITCH,data:o,needCookie:!0}),t.abrupt("return",!0);case 12:case"end":return t.stop()}}),t,this)})))}},{key:"switchPersonAccount",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n=this;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.messageDomainService.switchPersonAccountMessage.connect(),this.getIframeMountMessage(e),this.messageDomainService.switchPersonAccountMessage.createSwitchEnterpriseAccount((function(){n.messageDomainService.switchPersonAccountMessage.sendSwitchAccountMessage(e)})),t.next=5,this.getSwitchAccountMessage();case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"switchEnterpriseAccount",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n,o,r,i,s,a,c,u;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=null===(n=e.cookie)||void 0===n?void 0:n.wedocSid,a=null===(o=e.cookie)||void 0===o?void 0:o.tdocUid,c=null===(r=e.cookie)||void 0===r?void 0:r.wedocOpenid,u=null===(i=e.cookie)||void 0===i?void 0:i.wedriveSid,s?(pt("wedoc_sid",s,30,"/",ge),a&&pt("tdoc_uid",a,30,"/",ge),c&&pt("wedoc_openid",c,30,"/",ge)):u&&pt("wedrive_sid",u,30,"/",ve),location.reload(),t.abrupt("return",!0);case 7:case"end":return t.stop()}}),t)})))}},{key:"getIframeMountMessage",value:function(e){var t=this;return new Promise((function(n){t.messageDomainService.switchPersonAccountMessage.getIframeMountMessage((function(){n(!0),t.messageDomainService.switchPersonAccountMessage.sendSwitchAccountMessage(e)}))}))}},{key:"getSwitchAccountMessage",value:function(){var e=this;return new Promise((function(t){e.messageDomainService.switchPersonAccountMessage.getSwitchAccountMessage((function(e){"SUCCESS_SET_COOKIE"===e.data.event&&t(!0),t(!1)}))}))}},{key:"isInDesktopPage",value:function(){return document.location.pathname.indexOf("/home/")>-1}}]),e}();function Ht(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=v()(e);if(t){var r=v()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return h()(this,n)}}Gt=Object(E.__decorate)([Object(E.__param)(0,T.a),Object(E.__metadata)("design:paramtypes",[Object])],Gt);var Vt=Pt(Me),qt=function(e){l()(n,e);var t=Ht(n);function n(e,o,r){var s,a;i()(this,n),(s=t.call(this)).accountDomainService=e,s.loginDomainService=o,s.messageDomainService=r,s.accountApplicationOfflineService=new We,s.enterpriseAccountListApplicationService=new Ft(r,e),s.dcLoginApplicationService=new ct(o,r,e);var c=null===globalThis||void 0===globalThis?void 0:globalThis.basicClientVars;return s.loginDomainService.createLoginAggregate((null===(a=null==c?void 0:c.userInfo)||void 0===a?void 0:a.tinyId)||R.h),s.createEnterpriseEnvAccountAggregateByBasicClientVarsAndDocInfo(),s}return a()(n,[{key:"updateVipInfo",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n,o,r,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.completionUserInfo();case 2:return t=this.accountDomainService.accountAggregate,n=t.vipInfo,o=t.userInfo,r=t.bindUserInfo,i=t.officialInfo,this.accountApplicationOfflineService.updateUserInfo(Object.assign(Object.assign({},o),{vipUserInfo:n,bindUserInfo:r,officialInfo:i})),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"updateUserInfo",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n,o,r,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountDomainService.userInfoRepository.getEnterpriseUserInfo();case 2:return t=e.sent,e.next=5,this.accountDomainService.userInfoRepository.getEnterpriseDocInfo();case 5:if(n=e.sent,o=n.resData,!t||0!==(null==o?void 0:o.cgicode)){e.next=12;break}return r=this.accountDomainService.accountAggregate.userInfo.tinyId,this.loginDomainService.createLoginAggregate(r),i=this.accountDomainService.accountAggregate,e.abrupt("return",i.userInfo);case 12:return this.accountApplicationOfflineService.updateUserInfo(Object.assign({},this.userInfo)),e.abrupt("return",this.userInfo);case 14:case"end":return e.stop()}}),e,this)})))}},{key:"init",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initForUserInfoFetch();case 2:if(!e.sent){e.next=5;break}return e.abrupt("return",!0);case 5:return e.abrupt("return",this.initForUserInfoOfflineData());case 6:case"end":return e.stop()}}),e,this)})))}},{key:"dispose",value:function(){}},{key:"getAccountProfileList",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.enterpriseAccountListApplicationService.getAccountList();case 2:return t=e.sent,e.abrupt("return",Vt(t));case 4:case"end":return e.stop()}}),e,this)})))}},{key:"deleteAccount",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.enterpriseAccountListApplicationService.deleteAccountForList(e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"addAccount",value:function(){}},{key:"switchToAccount",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new Gt(this.messageDomainService),t.next=3,n.switchAccount(e);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"completionUserInfo",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountDomainService.completionUserInfo();case 2:return t=e.sent,this.vipInfo=this.accountDomainService.accountAggregate.vipInfo,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"loginSuccessJumpUrl",value:function(e,t){var n=this.accountDomainService.accountAggregate.userInfo.nowUserIndex;G.a.postMessage({type:S.a.LOGIN,data:n,needCookie:!0}),(new Wt).loginSuccessJumpUrl(e,t)}},{key:"logoutSuccessJumpUrl",value:function(){(new Wt).logoutSuccessJumpUrl()}},{key:"login",value:function(e,t,n){new kt(this.loginDomainService).login(e,t,n)}},{key:"logout",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Kt(this.accountDomainService),e.abrupt("return",t.logout());case 2:case"end":return e.stop()}}),e,this)})))}},{key:"initForUserInfoFetch",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t=this;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([this.accountDomainService.userInfoRepository.getEnterpriseUserInfo()]).then((function(e){var n=J()(e,1)[0];if(n){t.accountDomainService.createEnterpriseEnvAccountAggregateByUserInfoCgi(n);var o=t.accountDomainService.accountAggregate.userInfo.tinyId;t.loginDomainService.createLoginAggregate(o);var r=t.accountDomainService.accountAggregate;t.userInfo=r.userInfo,t.accountApplicationOfflineService.addUserInfo(Object.assign({},t.userInfo))}return!0})));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"initForUserInfoOfflineData",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountApplicationOfflineService.getUserInfo();case 2:if(t=e.sent,this.accountApplicationOfflineService.setOnOfflineState(!0),t){e.next=6;break}return e.abrupt("return",!1);case 6:return this.userInfo=t.userInfo,e.abrupt("return",!0);case 8:case"end":return e.stop()}}),e,this)})))}},{key:"createEnterpriseEnvAccountAggregateByBasicClientVarsAndDocInfo",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=null===globalThis||void 0===globalThis?void 0:globalThis.basicClientVars,n=this.accountDomainService.createEnterpriseEnvAccountAggregateByBasicClientVars(null==t?void 0:t.userInfo),o=this.accountDomainService.accountAggregate,this.userInfo=o.userInfo,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})))}}]),n}(M.Disposable);Object(E.__decorate)([Oe,Object(E.__metadata)("design:type",Object)],qt.prototype,"userInfo",void 0),Object(E.__decorate)([Oe,Object(E.__metadata)("design:type",Object)],qt.prototype,"vipInfo",void 0),Object(E.__decorate)([Re("vipInfo"),Object(E.__metadata)("design:type",Function),Object(E.__metadata)("design:paramtypes",[]),Object(E.__metadata)("design:returntype",Promise)],qt.prototype,"updateVipInfo",null),Object(E.__decorate)([Re("userInfo"),Object(E.__metadata)("design:type",Function),Object(E.__metadata)("design:paramtypes",[]),Object(E.__metadata)("design:returntype",Promise)],qt.prototype,"updateUserInfo",null),Object(E.__decorate)([te(),Object(E.__metadata)("design:type",Function),Object(E.__metadata)("design:paramtypes",[]),Object(E.__metadata)("design:returntype",Promise)],qt.prototype,"init",null),Object(E.__decorate)([ne("init"),Object(E.__metadata)("design:type",Function),Object(E.__metadata)("design:paramtypes",[]),Object(E.__metadata)("design:returntype",void 0)],qt.prototype,"dispose",null),qt=Object(E.__decorate)([Ie(),Object(E.__param)(0,I.a),Object(E.__param)(1,k.a),Object(E.__param)(2,T.a),Object(E.__metadata)("design:paramtypes",[Object,Object,Object])],qt);var Qt,Yt,Xt,Jt=Object(o.a)("IAccountApplicationService"),zt=Object(o.a)("IEnterpriseAccountApplicationService");!function(e){e.CODE_IS_READY="CODE_IS_READY",e.USER_HAS_SCANNED="USER_HAS_SCANNED",e.CODE_WAS_EXPIRED="CODE_WAS_EXPIRED",e.USER_HAS_CONFIRMED="USER_HAS_CONFIRMED",e.ERROR="ERROR"}(Qt||(Qt={})),function(e){e.TENCENT_DOCS="TENCENT_DOCS"}(Yt||(Yt={})),function(e){e.CODE_IS_READY="CODE_IS_READY",e.BIND_POLLING_RUNNING="BIND_POLLING_RUNNING",e.BIND_POLLING_FINISH="BIND_POLLING_FINISH",e.BIND_TIMEOUT="BIND_TIMEOUT",e.CODE_WAS_EXPIRED="CODE_WAS_EXPIRED",e.ERROR="ERROR"}(Xt||(Xt={}));var $t=function(){function e(t){var n,o,r;i()(this,e),this.title=t.title,this.padId=t.padId,this.domainId=t.domainId,this.docType=t.docType,this.create_type=null!==(n=t.create_type)&&void 0!==n?n:"",this.redirect=null!==(o=t.redirect)&&void 0!==o?o:"",this.isMiniProgram=null!==(r=t.isMiniProgram)&&void 0!==r?r:""}return a()(e,[{key:"send",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new FormData).append("domain_id",this.domainId),t.append("title",this.title),t.append("pad_id",this.padId),t.append("xsrf",Mt()),t.append("create_type",this.create_type),t.append("redirect",this.redirect),t.append("isMiniProgram",this.isMiniProgram),e.next=10,z.networkRequest.post("/cgi-bin/online-docs/createdoc_new",t);case 10:return n=e.sent,o=n.data,e.abrupt("return",o);case 13:case"end":return e.stop()}}),e,this)})))}}]),e}(),Zt=function(){function e(t){i()(this,e),this.file_id=t.file_id,this.parent_id=t.parent_id}return a()(e,[{key:"send",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z.networkRequest.post("".concat("/v2/file/clone","?xsrf=").concat(Mt()),{file_id:this.file_id,parent_id:this.parent_id});case 2:return t=e.sent,n=t.data,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})))}}]),e}(),en={retcode:-1,doc_url:"",message:"创建副本存到本地失败",doc_id:{pad_id:""}},tn=function(){function e(t){i()(this,e),this.logger=new A.a("IDocsManagementService").use("console"),this.title=t.title,this.padId=t.padId,this.domainId=t.domainId}return a()(e,[{key:"send",value:function(){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n,o,r,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new FormData).append("domain_id",this.domainId),t.append("title",this.title),t.append("pad_id",this.padId),t.append("xsrf",Mt()),e.next=7,z.networkRequest.post("/cgi-bin/online_docs/copydoc_async",t);case 7:if(n=e.sent,o=n.data,r=o.retcode,i=o.doc_id.pad_id,0===r&&i){e.next=13;break}return this.logger.error(o),e.abrupt("return",o);case 13:return e.next=15,this.requestCreateCopyLoop(o);case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}}),e,this)})))}},{key:"requestCreateCopyLoop",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n,o,r,i,s,a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.doc_id.pad_id,o=e.doc_url,r=30;case 3:if(!(r-=1)){t.next=20;break}return t.next=6,Dt(2e3);case 6:return(i=new FormData).append("domain_id",this.domainId),i.append("pad_id",n),i.append("xsrf",Mt()),t.next=12,z.networkRequest.post("/cgi-bin/online_docs/copydoc_loop",i);case 12:if(s=t.sent,a=s.data,o=o||a.doc_url,10027!==a.retcode){t.next=17;break}return t.abrupt("continue",3);case 17:return t.abrupt("return",a);case 20:return t.abrupt("return",en);case 21:case"end":return t.stop()}}),t,this)})))}}]),e}(),nn=Object(o.a)("IDocsManagementService"),on=function(){function e(){i()(this,e)}return a()(e,[{key:"loopClone",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new tn(e.params).send();case 2:n=t.sent,this.handleResult(e,n);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"createDocClone",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new $t(e.params).send();case 2:n=t.sent,this.handleResult(e,n);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"driveClone",value:function(e){return Object(E.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Zt(e.params).send();case 2:n=t.sent,this.handleResult(e,n);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"handleResult",value:function(e,t){t?e.success(t):e.fail()}}]),e}()}).call(this,n("5ef37df1a0"))},c7a12f3a4f:function(e,t,n){"use strict";var o=n("f9d31e5257");e.exports=function(e,t,n,r,i){var s=new Error(e);return o(s,t,n,r,i)}},c9b7c5690f:function(e,t,n){"use strict";var o=n("9da27020aa"),r=n("5adb739611");e.exports=function(e,t,n){var i=this||r;return o.forEach(n,(function(n){e=n.call(i,e,t)})),e}},ca13d5cafb:function(e,t,n){var o=n("a71e91f775"),r=n("ab14ea14de"),i=r;i.v1=o,i.v4=r,e.exports=i},cb8440da0d:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},cd1340aeac:function(e,t,n){"use strict";var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},o.apply(this,arguments)},r=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Request=void 0;var s=n("b512c0eccb"),a=n("cdda668c2b"),c=n("5d1be1397d"),u=n("cf3c69206c"),d=n("06223329e1"),l=s.createNetworkRequestInstance(),p=function(e){var t,n,o=null!==(t=e.code)&&void 0!==t?t:"";return!![s.REQUEST_ERROR_CODE.network,s.REQUEST_ERROR_CODE.timeout].includes(o)||200!==(null===(n=e.response)||void 0===n?void 0:n.status)},h=function(){function e(){}return e.prototype.sendRequest=function(e,t,n,s){return r(this,void 0,void 0,(function(){var r,h,f,v;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,5,,6]),r=void 0,h=new d.RequestBackOff,f=o(o({},s),{errorFilter:p,backoffFactory:h}),t!==c.Method.GET?[3,2]:[4,l.get(e,f)];case 1:return r=i.sent(),[3,4];case 2:return[4,l.post(e,n,f)];case 3:r=i.sent(),i.label=4;case 4:return[2,new u.Result(void 0,r)];case 5:return v=i.sent(),a.ConnectionLog.error("Request Failed, url:"+e+", stack: "+(null==v?void 0:v.stack)+", message: "+(null==v?void 0:v.message)+", code: "+(null==v?void 0:v.code)),[2,new u.Result(v)];case 6:return[2]}}))}))},e.prototype.sendBeacon=function(e,t,n){try{var o=null!=n?n:u.ContentTypeValue.JSON,r=new Blob([a.JsonUtil.jsonStringify(t)],{type:o});return navigator.sendBeacon(e,r)}catch(t){return a.ConnectionLog.error("sendBeacon Failed, url:"+e+", stack: "+(null==t?void 0:t.stack)+", message: "+(null==t?void 0:t.message)+", code: "+(null==t?void 0:t.code)),!1}},e}();t.Request=h},cdda668c2b:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n("96ed841b55"),t),r(n("740addaa0b"),t),r(n("6372fb3a1c"),t),r(n("c5556536fb"),t),r(n("60e8a8f162"),t),r(n("cd1340aeac"),t),r(n("70189fba97"),t),r(n("fd8dd5b6c8"),t),r(n("6f60718a3f"),t)},cf3c69206c:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n("898db569a7"),t),r(n("e67f1ebb74"),t),r(n("97d6e03b61"),t),r(n("ef67208c03"),t),r(n("cfaa4b8621"),t),r(n("094a0886cb"),t)},cfaa4b8621:function(e,t,n){"use strict";var o,r;Object.defineProperty(t,"__esModule",{value:!0}),t.ContentTypeValue=t.ContentTypeValueMap=t.HttpStatus=t.Method=t.ContentType=void 0,function(e){e.JSON="JSON",e.FORM="FORM"}(o||(o={})),t.ContentType=o,function(e){e.JSON="application/json",e.FORM="application/x-www-form-urlencoded"}(r||(r={})),t.ContentTypeValue=r;var i,s,a=new Map([[o.JSON,r.JSON],[o.FORM,r.FORM]]);t.ContentTypeValueMap=a,function(e){e.POST="POST",e.GET="GET"}(i||(i={})),t.Method=i,function(e){e[e.SUCCESS=200]="SUCCESS",e[e.NOT_FOUND=404]="NOT_FOUND"}(s||(s={})),t.HttpStatus=s},d11cf19c18:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isCancellationToken=t.CancellationTokenState=void 0;var o=function(){function e(){}return e.None=Object.freeze({isCancellationRequested:!1}),e.Cancelled=Object.freeze({isCancellationRequested:!0}),e}();t.CancellationTokenState=o,t.isCancellationToken=function(e){return e===o.None||e===o.Cancelled||!(!e||"object"!=typeof e)&&"boolean"==typeof e.isCancellationRequested}},d3819be4ca:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n("42ee45218a"),t),r(n("b284f06ad9"),t)},d3a09514f9:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n("dd7d1011cb"),t),r(n("44f185c0a0"),t)},d3c9d8f7fe:function(e,t,n){"use strict";var o=n("9da27020aa");function r(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,n){if(!t)return e;var i;if(n)i=n(t);else if(o.isURLSearchParams(t))i=t.toString();else{var s=[];o.forEach(t,(function(e,t){null!=e&&(o.isArray(e)?t+="[]":e=[e],o.forEach(e,(function(e){o.isDate(e)?e=e.toISOString():o.isObject(e)&&(e=JSON.stringify(e)),s.push(r(t)+"="+r(e))})))})),i=s.join("&")}if(i){var a=e.indexOf("#");-1!==a&&(e=e.slice(0,a)),e+=(-1===e.indexOf("?")?"?":"&")+i}return e}},d536a5377f:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},d5bac86374:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var o=n("f6998d6780");class r{constructor(){this.innerRegistry=[],this.innerMultiRegistry=[]}register(e,t,n,r){this.innerRegistry.push([e,new o.a(t,n,r)])}registerValue(e,t){this.innerRegistry.push([e,t])}registerMulti(e,t,n,r){this.innerMultiRegistry.push([e,new o.a(t,n,r)])}registerMultiValue(e,t){this.innerMultiRegistry.push([e,t])}getServiceDescriptors(){return this.innerRegistry}getMulServiceDescriptor(){return this.innerMultiRegistry}}},d63229afdc:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var o=n("0368aca230"),r=n("f6998d6780"),i=n("0b588a7d4e"),s=n("af75a08457"),a=n("ca13d5cafb"),c=n("a282565e4f");class u{constructor(){this.identifierMap=new Map,this.serviceKeyMap=new Map}getMapping(e){const t=this.identifierMap.get(e),n=[];return null==t||t.forEach((e=>{this.serviceKeyMap.get(e)&&n.push(e)})),void 0===t&&"function"==typeof e&&"function"!=typeof e.toLegacyString&&this.serviceKeyMap.get(e)&&n.push(e),n}deleteMapping(e){this.identifierMap.forEach((t=>{const n=t.indexOf(e);n>=0&&(t.splice(n,1),this.serviceKeyMap.delete(e))}))}clear(){this.identifierMap.clear(),this.serviceKeyMap.clear()}dispose(){this.clear()}generateServiceKey(e,t,n=!1){return t instanceof r.a?this.generateDescriptorKey(e,t,n):this.generateValueInstanceKey(e,t,n)}generateValueInstanceKey(e,t,n=!1){if(n){const n=this.createRandomValueKey(t);return this.addMapping(e,t,{valueId:n}),n}const o=this.getMapping(e);if(0===o.length){const n=this.createRandomValueKey(t);return this.addMapping(e,t,{valueId:n}),n}if(1===o.length){const n=o[0],r=this.serviceKeyMap.get(n);if(null==r?void 0:r.override){this.deleteMappingById(e,n);const o=this.createRandomValueKey(t);return this.addMapping(e,t,{valueId:o}),o}return o[0]}throw new Error(Object(c.b)(Object(s.a)(e)))}generateDescriptorKey(e,t,n=!1){const o=this.getMapping(e);if(n)return(null==o?void 0:o.includes(t))||this.addMapping(e,t.ctor),t.ctor;if(0===o.length)return this.addMapping(e,t.ctor,{override:t.supportsOverride}),t.ctor;if(1===o.length){const n=o[0],r=this.serviceKeyMap.get(n);return(null==r?void 0:r.override)&&t.ctor!==n?(this.deleteMappingById(e,n),this.addMapping(e,t.ctor,{override:t.supportsOverride}),t.ctor):o[0]}throw new Error(Object(c.b)(Object(s.a)(e)))}addMapping(e,t,n){const o=this.identifierMap.get(e);if(null==n?void 0:n.valueId){const{valueId:t}=n;o?o.push(t):this.identifierMap.set(e,[t]),this.serviceKeyMap.set(t,{serviceKey:t})}else o?o.push(t):this.identifierMap.set(e,[t]),this.serviceKeyMap.set(t,{serviceKey:t,override:null==n?void 0:n.override})}createRandomValueKey(e){return`${e.constructor.name}@${Object(a.v4)()}`}deleteMappingById(e,t){let n=0;if(this.identifierMap.forEach((e=>{e.indexOf(t)>=0&&(n+=1)})),0===n)return;const o=this.identifierMap.get(e);if(o&&o.length){const e=o.indexOf(t);e>=0&&o.splice(e,1),1===n&&this.serviceKeyMap.delete(t)}}}class d{constructor(...e){this.innerEntries=new Map,this.keyMapping=new u;for(const[t,n]of e)this.set(t,n)}set(e,t){const n=this.keyMapping.generateServiceKey(e,t),o=this.innerEntries.get(n);o?t instanceof r.a?this.overrideExistServiceHolder(e,o,t):this.setHolderInstance(n,o,t):this.createNewServiceHolder(n,t)}setMulti(e,t){const n=this.keyMapping.generateServiceKey(e,t,!0);if(!this.innerEntries.get(n)){const e=this.createNewHolderByCondition(t);this.innerEntries.set(n,e)}}has(e){return!!this.keyMapping.getMapping(e).find((e=>this.innerEntries.has(e)))}get(e){const t=this.keyMapping.getMapping(e);if(0===t.length)return;if(t.length>1)throw new Error(Object(c.a)(Object(s.a)(e)));const n=this.innerEntries.get(t[0]);return(null==n?void 0:n.instance)||(null==n?void 0:n.descriptor)||void 0}getAllHolder(e,t){const n=this.keyMapping.getMapping(e.serviceIdentifier),o=[];return n.forEach((e=>{const t=this.innerEntries.get(e);t&&(null==o||o.push(t))})),t?null==o?void 0:o.filter(((e,n)=>t(e,n))):o.length>0?o:void 0}getHolder(e){const t=this.keyMapping.getMapping(e.serviceIdentifier);if(0===t.length)return;if(t.length>1)throw new Error(Object(c.a)(Object(s.a)(e.serviceIdentifier)));return this.innerEntries.get(t[0])}getMapping(){return this.keyMapping}teardown(e,t,n,r){this.innerEntries.forEach(((i,a)=>{const{instance:c,descriptor:u}=i;(null==e?void 0:e(c))&&Object(o.tryToDispose)(c,null==r?void 0:r.branch(Object(s.a)(a))),u&&c&&(null==t?void 0:t(c))&&(i.instance=null),!u&&c&&(null==n?void 0:n(c))&&(this.innerEntries.delete(a),this.keyMapping.deleteMapping(a))}))}createNewServiceHolder(e,t){const n=this.createNewHolderByCondition(t);this.innerEntries.set(e,n)}overrideExistServiceHolder(e,t,n){var o,r,i;if(null===(o=t.descriptor)||void 0===o?void 0:o.supportsOverride){const t=this.keyMapping.generateServiceKey(e,n),o=this.createHolderInstance(null,n);this.innerEntries.set(t,o)}else{if(t.instance)throw new Error(Object(c.s)(Object(s.a)(e),null===(i=t.descriptor)||void 0===i?void 0:i.ctor.name));(null===(r=t.descriptor)||void 0===r?void 0:r.isEqualWith(n))||console.warn(Object(c.o)(Object(s.a)(e)))}}setHolderInstance(e,t,n){Object(o.tryToMarkDispose)(n),t.instance=n,this.innerEntries.set(e,t)}createNewHolderByCondition(e){if(e instanceof r.a){return this.createHolderInstance(null,e)}Object(o.tryToMarkDispose)(e);return this.createHolderInstance(e,null)}createHolderInstance(e,t){return new i.b(e,t)}}},d684f6ff39:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},dd1cfaf242:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisposableNone=void 0,t.DisposableNone=Object.freeze({dispose:function(){}})},dd7d1011cb:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},de23095cc5:function(e,t,n){"use strict";var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},o.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.MessageCreater=void 0;var r=n("eee882e93f"),i=n("cdda668c2b"),s=n("147e28b86b"),a=function(){function e(){}return e.createMessage=function(e,t,n){var a,c,u,d,l,p,h,f=this.createPostData(e,t,n),v=s.RoomUtil.createNewMessage(e.taskId||i.generateMessageTaskId(),f,null!==(c=null===(a=e.customParam)||void 0===a?void 0:a.timeout)&&void 0!==c?c:r.DEFAULT_SEND_MESSAGE_TIMEOUT,null!==(d=null===(u=e.customParam)||void 0===u?void 0:u.maxRetryCount)&&void 0!==d?d:r.DEFAULT_RETRY_COUNTS,e.cmd,e.data,null===(l=e.customParam)||void 0===l?void 0:l.waitAcceptCmd,e.onError,e.onsend,e.onsendAccept),g=!!(null===(h=null===(p=t.config)||void 0===p?void 0:p.bigCollabCommitConfig)||void 0===h?void 0:h.syncCommit)&&"USER_CHANGES"===e.cmd;return o({syncCommit:g},v)},e.createPostData=function(e,t,n){var o=r.prepareCommitMessage(e.data,t.userid,t.serverVars.pver);return{head:this.createSendHead(e,t,n),body:o}},e.createSendHead=function(e,t,n){var o=e.data;return i.createMessageHead(t,{getHeaderGeneralPacket:n.getHeaderGeneralPacket(),command:e.cmd,baseRev:"object"==typeof o&&"number"==typeof o.baseRev?o.baseRev:n.getVersion(),taskId:e.taskId||i.generateMessageTaskId(),additionalFieldsToHead:e.additionalFieldsToHead})},e}();t.MessageCreater=a},dee170f313:function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RoomWebsocket=void 0;var s=n("99cf54780e"),a=i(n("b064ea590e")),c=n("9c5a83385b"),u=i(n("ab167130ca")),d=n("cdda668c2b"),l=i(n("751778941b")),p=function(){function e(e){var t=this;this.option=e,this.socketId=String(Math.floor(1e12*Math.random())),this.isWebSocketOpen=!1,this.socketChannel=null,this.socketAttempts=0,this.handleReconnectAttempt=function(){t.socketChannel.io.opts.transports=t.attemptTransports},this.handleConnectError=function(e){var n,o,r;if(d.ConnectionLog.info("socket io connect_error, isOnline:"+s.network.isOnline+", type:"+(null==e?void 0:e.type)+", code:"+(null==e?void 0:e.code)+",\n      message:"+(null==e?void 0:e.message)+", description:"+(null==e?void 0:e.description)),s.network.isOnline){var i="number"==typeof(null==e?void 0:e.description)?null==e?void 0:e.description:void 0;l.default.reportSocketConnect({attrName:"SocketConnect",status:1,module:null===(n=t.option)||void 0===n?void 0:n.module,errorMessage:(null==e?void 0:e.message)+", status:"+i,transports:null===(r=null===(o=t.socketChannel)||void 0===o?void 0:o.io.opts.transports)||void 0===r?void 0:r[0]})}var a=t.getSocketChannelInfo();a.event="connect_error",a.failReason="io connect_error unknown",(null==e?void 0:e.type)&&(a.failReason=e.type),t.option.roomWebSocketDependency.onSocketStatusChanged(a)},this.handleConnectTimeout=function(e){var n,o,r,i=t.getSocketChannelInfo();i.event="connect_timeout",i.failReason="connect_timeout timeout:"+e,t.option.roomWebSocketDependency.onSocketStatusChanged(i),l.default.reportSocketConnect({attrName:"SocketConnect",status:2,module:null===(n=t.option)||void 0===n?void 0:n.module,errorMessage:i.failReason,transports:null===(r=null===(o=t.socketChannel)||void 0===o?void 0:o.io.opts.transports)||void 0===r?void 0:r[0]})},this.handleMessageFromServerPush=function(e){t.option.roomWebSocketDependency.onGetMessageFromServerPush(e)},this.handlePost=function(e){t.option.roomWebSocketDependency.onPostFromServer(e)},this.handleConnect=function(){var e,n,o,r,i;d.ConnectionLog.info("socket io connect readyState: "+(null===(e=t.socketChannel)||void 0===e?void 0:e.io.readyState)+", id:"+(null===(n=t.socketChannel)||void 0===n?void 0:n.id)),l.default.reportSocketConnect({module:null===(o=t.option)||void 0===o?void 0:o.module,attrName:"SocketConnect",status:0,errorMessage:"Success",transports:null===(i=null===(r=t.socketChannel)||void 0===r?void 0:r.io.opts.transports)||void 0===i?void 0:i[0]}),t.isWebSocketOpen=!0,t.option.roomWebSocketDependency.onSocketOpen()},this.handleReconnect=function(e){var n,o,r,i="socket io reconnect number: "+e+" channel.readyState: "+t.socketChannel.io.readyState;d.ConnectionLog.info(i),t.socketAttempts=0,Math.random()<.01&&l.default.reconnectReport({attrName:"SocketReconnect",status:0,module:null===(n=t.option)||void 0===n?void 0:n.module,errorMessage:i,transports:null===(r=null===(o=t.socketChannel)||void 0===o?void 0:o.io.opts.transports)||void 0===r?void 0:r[0]})},this.handleReconnecting=function(e){t.socketAttempts=e,t.socketChannel.io.opts.transports=t.initTransports,t.option.roomWebSocketDependency.onReopenCount()>=t.option.websocketReopenCount&&e>=t.option.pollingAttemptNumber&&(t.socketChannel.io.opts.transports=t.attemptTransports),d.ConnectionLog.info("socket io reconnecting number:"+e+" readyState: "+t.socketChannel.io.readyState+", transports:"+t.socketChannel.io.opts.transports);var n=t.getSocketChannelInfo();n.event="reconnecting",t.option.roomWebSocketDependency.onSocketStatusChanged(n)},this.handleRetry=function(e){d.ConnectionLog.info("socket io retry, msg:"+e),t.doDisconnect("Server restarted or socket timed out on server. serverRetry offlineEdit")},this.handleDisconnect=function(e){var n,o,r,i;d.ConnectionLog.info("socket io disconnect, msg: "+d.JsonUtil.jsonStringify(e)+" channel.readyState: "+(null===(n=t.socketChannel)||void 0===n?void 0:n.io.readyState));var s=d.JsonUtil.jsonStringify(e)+"，ClosedByOthers.",a=t.getSocketChannelInfo();a.event="disconnect",a.disconnectReason=""+s,a.socketId=t.socketId,t.option.roomWebSocketDependency.onSocketStatusChanged(a),t.socketAttempts=0,l.default.reportSocketConnect({attrName:"SocketDisconnect",status:1,module:null===(o=t.option)||void 0===o?void 0:o.module,errorMessage:a.disconnectReason,transports:null===(i=null===(r=t.socketChannel)||void 0===r?void 0:r.io.opts.transports)||void 0===i?void 0:i[0]})},this.handleConnectFailed=function(e){d.ConnectionLog.info("socket io connect_failed"),t.socketAttempts=0,t.doDisconnect(d.JsonUtil.jsonStringify(e)+"  connect_failed Closed by client.")},this.handleError=function(e){var n,o,r,i="type:"+(null==e?void 0:e.type)+", code:"+(null==e?void 0:e.code)+",\n    message:"+(null==e?void 0:e.message)+", description:"+(null==e?void 0:e.description);d.ConnectionLog.info("socket io error, "+i),t.doDisconnect(d.JsonUtil.jsonStringify(e)+" socket io error Closed by client."),l.default.reportSocketConnect({attrName:"SocketError",status:1,module:null===(n=t.option)||void 0===n?void 0:n.module,errorMessage:i,transports:null===(r=null===(o=t.socketChannel)||void 0===o?void 0:o.io.opts.transports)||void 0===r?void 0:r[0]})},this.handleReconnectFailed=function(e){var n,o,r;d.ConnectionLog.info("socket io reconnect_failed"),t.socketAttempts=0;var i=d.JsonUtil.jsonStringify(e)+" reconnect_failed Closed by client.";t.doDisconnect(i),l.default.reportSocketConnect({attrName:"SocketReconnect",status:1,module:null===(n=t.option)||void 0===n?void 0:n.module,errorMessage:i,transports:null===(r=null===(o=t.socketChannel)||void 0===o?void 0:o.io.opts.transports)||void 0===r?void 0:r[0]})},this.handleReconnectError=function(e){var n,o,r,i="number"==typeof(null==e?void 0:e.description)?null==e?void 0:e.description:void 0,s=(null==e?void 0:e.message)+", status:"+i;l.default.reportSocketConnect({attrName:"SocketReconnect",status:1,module:null===(n=t.option)||void 0===n?void 0:n.module,errorMessage:s,transports:null===(r=null===(o=t.socketChannel)||void 0===o?void 0:o.io.opts.transports)||void 0===r?void 0:r[0]}),d.ConnectionLog.info("socket io reconnect_error, "+s)},this.initTransports=this.getTransports(e.wmode),this.attemptTransports=this.getAttemptTransports(e.wmode)}return e.prototype.dispose=function(){this.disconnect("socket io dispose")},e.prototype.isConnected=function(){return this.isWebSocketOpen},e.prototype.connect=function(){var e,t,n,i,s,a,l,p,h,f;return o(this,void 0,void 0,(function(){var o,v,g,m,E;return r(this,(function(r){switch(r.label){case 0:return o=(null===(t=null===(e=this.option.config)||void 0===e?void 0:e.location)||void 0===t?void 0:t.protocol)?(null===(i=null===(n=this.option.config)||void 0===n?void 0:n.location)||void 0===i?void 0:i.protocol)+":":"wss:",v=o+"//"+(null!==(l=null===(a=null===(s=this.option.config)||void 0===s?void 0:s.location)||void 0===a?void 0:a.host)&&void 0!==l?l:window.location.host),g={query:{tag:this.option.tag,gtag:this.option.gid,utag:this.option.upid,sig:this.option.sig,uid:this.option.uid,uid_key:this.option.uidKey,u:this.option.nowUserIndex,padid:this.option.padId},transports:this.initTransports,reconnection:!0,reconnectionAttempts:c.WEBSOCKET_CONFIG.reconnectMaxTimes,reconnectionDelay:c.WEBSOCKET_CONFIG.reconnectionDelay,reconnectionDelayMax:c.WEBSOCKET_CONFIG.reconnectionDelayMax,randomizationFactor:c.WEBSOCKET_CONFIG.randomizationFactor,timeout:c.WEBSOCKET_CONFIG.connectTimeout,path:null!==(f=null===(h=null===(p=this.option.config)||void 0===p?void 0:p.location)||void 0===h?void 0:h.path)&&void 0!==f?f:"/websocket"},d.isWebOffice?[4,this.getToken()]:[3,2];case 1:m=r.sent(),g.transportOptions={websocket:{protocols:m}},r.label=2;case 2:return E=u.default(v,g),this.socketChannel=E,d.ConnectionLog.info("socket io new channel transports: "+E.io.opts.transports+", pollingReopenCount =\n      "+this.option.websocketReopenCount+", pollingAttemptNumber= "+this.option.pollingAttemptNumber),E.on("reconnect_attempt",this.handleReconnectAttempt),E.on("connect_error",this.handleConnectError),E.on("connect_timeout",this.handleConnectTimeout),E.on("get",this.handleMessageFromServerPush),E.on("post",this.handlePost),E.on("connect",this.handleConnect),E.on("reconnect",this.handleReconnect),E.on("reconnecting",this.handleReconnecting),E.on("retry",this.handleRetry),E.on("disconnect",this.handleDisconnect),E.on("connect_failed",this.handleConnectFailed),E.on("error",this.handleError),E.on("reconnect_failed",this.handleReconnectFailed),E.on("reconnect_error",this.handleReconnectError),[2]}}))}))},e.prototype.postMessageForWebSocket=function(e){this.socketChannel&&this.socketChannel.emit("post",e)},e.prototype.getSocketConnectCount=function(){return this.socketAttempts},e.prototype.getSocketChannelInfo=function(){var e={};return this.socketChannel&&(e.connected=this.socketChannel.connected,e.disconnected=this.socketChannel.disconnected,this.socketChannel.io&&(e.readyState=this.socketChannel.io.readyState,e.reconnecting=this.socketChannel.io.reconnecting)),e},e.prototype.disconnect=function(e){d.ConnectionLog.info("socket io disconnect reason: "+e),this.socketChannel&&(this.socketChannel.disconnect(),this.socketChannel=null),this.isWebSocketOpen=!1},e.prototype.getTransports=function(e){return c.TRANSPOET_MODE_MAP.get(e.charAt(0))||c.DEFAULT_TRANSPORT_MODE},e.prototype.getAttemptTransports=function(e){return c.TRANSPOET_MODE_MAP.get(e.charAt(1))||c.DEFAULT_ATTEMPT_TRANSPORT_MODE},e.prototype.doDisconnect=function(e){this.disconnect("socket io doDisconnect reason: "+e),this.option.roomWebSocketDependency.onSocketClosed(e)},e.prototype.getToken=function(){var e;return o(this,void 0,void 0,(function(){var t,n,o;return r(this,(function(r){switch(r.label){case 0:return t=d.getURLParam("_o_appId"),n=null!==(e=window.userToken)&&void 0!==e?e:"",[4,a.default.post("/api/weboffice/session",{appId:t,token:n})];case 1:return[2,0===(o=r.sent().data).retcode?o.result.token:[]]}}))}))},e}();t.RoomWebsocket=p},dfdd551bdc:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CancellationTokenSource=void 0;var o=n("d11cf19c18"),r=function(){function e(){this.isCancelled=!1}return e.prototype.cancel=function(){this.isCancelled||(this.isCancelled=!0)},Object.defineProperty(e.prototype,"isCancellationRequested",{get:function(){return this.isCancelled},enumerable:!1,configurable:!0}),e}(),i=function(){function e(){this.innertoken=void 0}return Object.defineProperty(e.prototype,"token",{get:function(){return this.innertoken||(this.innertoken=new r),this.innertoken},enumerable:!1,configurable:!0}),e.prototype.cancel=function(){this.innertoken?this.innertoken instanceof r&&this.innertoken.cancel():this.innertoken=o.CancellationTokenState.Cancelled},e.prototype.dispose=function(){this.cancel()},e}();t.CancellationTokenSource=i},e2584d8846:function(e,t,n){"use strict";var o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return s};Object.defineProperty(t,"__esModule",{value:!0}),t.Receiver=void 0;var r=n("0a9f420ed3"),i=n("cdda668c2b"),s=n("49835f837f"),a=n("147e28b86b"),c=n("8daac3befe"),u=function(){function e(e){var t=this;this.dependency=e,this.tag="Receiver",this.isConnectSuccess=!1,this.delayConnectTimer=0,this.connectionCheckTimer=0,this.retryTimes=0,this.pageVisibilityChecker=new c.PageVisibilityChecker({resumeCallback:function(){return t.receive()}})}return e.prototype.dispose=function(){this.stopToReceive(),this.receiverClientInstance=void 0},e.prototype.stopToReceive=function(){this.receiverClient.abortConnection(),this.clearTimer()},e.prototype.receive=function(){i.ConnectionLog.info("大协同bind get receive isHidden:"+this.pageVisibilityChecker.isHidden+", retryTimes:"+this.retryTimes),this.pageVisibilityChecker.isHidden?this.pageVisibilityChecker.resumeAfterVisibility():this.retryTimes?this.delayConnect():(this.retryTimes=this.retryTimes+1,this.isConnectSuccess=!1,this.receiverClient.establishConnection(this.getUrl()))},e.prototype.delayConnect=function(){var e=this;if(this.retryTimes>=3)return i.ConnectionLog.info("大协同bind get请求，重试三次失败，重新发起post鉴权"),this.retryTimes=0,void this.dependency.reconnect({attrName:"bind get 连续重试三次连接失败",reason:"超时、请求状态异常等错误"});this.isConnectSuccess=!1,this.delayConnectTimer&&(clearTimeout(this.delayConnectTimer),this.delayConnectTimer=0),this.delayConnectTimer=setTimeout((function(){e.retryTimes=e.retryTimes+1,e.receiverClient.establishConnection(e.getUrl())}),s.CONNECT_DELAY_TIME)},e.prototype.getUrl=function(){var e=this.dependency.getServerParams(),t=e.token,n=e.sid,o=e.routeKey;return s.PATH+"?sid="+n+"&token="+t+"&routeKey="+o+"&taskId="+i.generateMessageTaskId()},e.prototype.handleResponse=function(e){var t=this;if(!Number.parseInt(e,16)&&0!==Number.parseInt(e,16)){var n=i.JsonUtil.parseJson(e);Array.isArray(n)&&(n.forEach((function(e){var n=o(e,2),r=n[0],i=n[1];s.ERROR_MESSAGE_INDEX.includes(r)?t.handleResponseEnd(i):i.includes(s.NOOP)||t.dependency.handleServerMessage(i)})),this.connectionIsStable())}},e.prototype.connectionIsStable=function(){var e=this;clearTimeout(this.connectionCheckTimer),this.connectionCheckTimer=0,this.retryTimes=0,this.dependency.isDisconnected()?i.ConnectionLog.info(this.tag+" connectStatus is disconnected."):(this.isConnectSuccess||(this.isConnectSuccess=!0,this.dependency.onConnectSuccess()),this.connectionCheckTimer=setTimeout((function(){e.isConnectSuccess=!1,e.receive()}),s.MAX_SERVER_REACHABLE_TIME))},e.prototype.handleResponseEnd=function(e){var t=o(e,2),n=t[0],r=t[1];if(!this.notNeedToHandle(n))return n!==a.RoomWebsocketErrorCode.SOCKET_SERVER_SUCCESS?(i.ConnectionLog.info("Bind Get Error, retcode: "+n+", msg: "+r),void this.dependency.reconnect({attrName:String(null!=n?n:0),reason:"Bind Get Error, retcode: "+n+", msg: "+r})):void this.receive()},e.prototype.notNeedToHandle=function(e){return a.NOT_NEED_TO_HANDLE_ERRCODES.includes(e)},Object.defineProperty(e.prototype,"receiverClient",{get:function(){var e=this;return this.receiverClientInstance||(this.receiverClientInstance=new r.ReceiverClient({handleResponse:function(t){return e.handleResponse(t)},receive:function(){return e.receive()},disconnect:function(t){return e.dependency.disconnect(t)}})),this.receiverClientInstance},enumerable:!1,configurable:!0}),e.prototype.clearTimer=function(){this.delayConnectTimer&&(clearTimeout(this.delayConnectTimer),this.delayConnectTimer=0),this.connectionCheckTimer&&(clearTimeout(this.connectionCheckTimer),this.connectionCheckTimer=0)},e}();t.Receiver=u},e67f1ebb74:function(e,t,n){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.Command=void 0,function(e){e.UNKNOWN="UNKNOWN",e.HEART_BEAT="HEART_BEAT",e.CLIENT_READY="CLIENT_READY",e.CURSOR_MESSAGE="CURSOR_MESSAGE",e.USER_NEWINFO="USER_NEWINFO",e.USER_NEWINFOS="USER_NEWINFOS",e.USER_LEAVE="USER_LEAVE",e.USER_LEAVES="USER_LEAVES",e.QUIT_NOTICE="QUIT_NOTICE",e.USER_CHANGES="USER_CHANGES",e.NEW_CHANGES="NEW_CHANGES",e.ACCEPT_COMMIT="ACCEPT_COMMIT",e.GET_PRIVILEGE="GET_PRIVILEGE",e.BIG_COLLAB_SWITCH="BIG_COLLAB_SWITCH",e.COMMON_REQUEST="COMMON_REQUEST",e.BIND_POST="BIND_POST",e.CLIENT_DISCONNECT="CLIENT_DISCONNECT",e.LIVE_MESSAGE="LIVE_MESSAGE",e.UPDATE_WEBOFFICE_TOKEN="UPDATE_WEBOFFICE_TOKEN"}(o||(o={})),t.Command=o},e75752bded:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n("2c9817aaa1"),t),r(n("1e652ff12c"),t)},e963e02dd5:function(e,t,n){"use strict";var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},o.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.prepareCommitMessage=t.getMessageDataLength=t.CHANGESET_TYPE=void 0;var r,i=n("cdda668c2b");!function(e){e.SMARTSHEET="smartsheet",e.SMARTCANVAS="smartcanvas"}(r||(r={})),t.CHANGESET_TYPE=r,t.getMessageDataLength=function(e){var t;return e?e instanceof Object?(null===(t=e.changeset)||void 0===t?void 0:t.length)||0:e.length||0:0},t.prepareCommitMessage=function(e,t,n){if("string"==typeof e)return e;var r=o(o({},e),{type:"USER_CHANGES",baseRev:e.baseRev,changeSetCount:e.changeSetCount,changeset:e.changeset,apool:e.apool,isWorkbook:e.isWorkbook,keydata:e.keydata||!1,head:e.head,subId:e.subId,changesetType:e.changesetType,oSubId:e.oSubId||!1,uuId:t,offlineMsg:e.offlineMsg,pver:n});return i.JsonUtil.jsonStringify(r)}},e9dc8c48dc:function(e,t,n){"use strict";var o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return s},r=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0}),t.MessageSendQueue=t.Queue=void 0;var i=n("686df8963b"),s=n("c0f85d03df"),a=function(){function e(){this.queue=[]}return e.prototype.get=function(e){var t=this.queue.filter((function(t){return t.taskId===e}));return 0===t.length?null:t[0]},e.prototype.has=function(e){return this.queue.some((function(t){return t.taskId===e}))},e.prototype.add=function(e){this.has(e.taskId)||this.queue.push(e)},e.prototype.remove=function(e){for(var t=0;t<this.queue.length;t++){if(this.queue[t].taskId===e)break}return t===this.queue.length?null:this.queue.splice(t,1)[0]},e.prototype.filter=function(e){return this.queue.filter(e)},e.prototype.some=function(e){return this.queue.some(e)},e}();t.Queue=a;var c=function(){function e(e){this.messageClassification=e,this.parallelQueue=new a,this.serialQueue=new a}return e.prototype.isCommittingSerialMessage=function(){return this.serialQueue.some((function(e){return e.state===s.MessageState.SENDING}))},e.prototype.nextSerialMessage=function(){var e=this.serialQueue.filter((function(e){return e.state===s.MessageState.WAITING}));return 0===e.length?null:e[0]},e.prototype.nextParallelMessages=function(){return this.parallelQueue.filter((function(e){return e.state===s.MessageState.WAITING}))},e.prototype.add=function(e){this.messageClassification.getMessageSendType(e.cmd)===i.MessageSendType.PARALLEL?this.parallelQueue.add(e):this.serialQueue.add(e)},e.prototype.remove=function(e){return this.parallelQueue.has(e)?this.parallelQueue.remove(e):this.serialQueue.remove(e)},e.prototype.get=function(e){return this.parallelQueue.has(e)?this.parallelQueue.get(e):this.serialQueue.get(e)},e.prototype.has=function(e){return this.serialQueue.has(e)||this.parallelQueue.has(e)},e.prototype.filter=function(e){return r(this.parallelQueue.filter(e),this.serialQueue.filter(e))},e.prototype.updateMessageState=function(e){var t,n=this.serialQueue.filter((function(e){return e.state!==s.MessageState.WAITING})).concat(this.parallelQueue.filter((function(e){return e.state!==s.MessageState.WAITING})));null===(t=n.forEach)||void 0===t||t.call(n,(function(t){t.state=e}))},e}();t.MessageSendQueue=c},ea59e4d4bf:function(e,t,n){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},eba64b0be6:function(e,t,n){"use strict";var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},o.apply(this,arguments)},r=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BigCollabLogin=void 0;var a=n("eee882e93f"),c=n("cf3c69206c"),u=n("cd1340aeac"),d=n("5d1be1397d"),l=n("271684415e"),p=n("147e28b86b"),h=n("cdda668c2b"),f=s(n("751778941b")),v=n("46509843e6"),g=n("49835f837f"),m=Number.MIN_VALUE,E=function(){function e(e,t){this.options=e,this.dependency=t,this.retryCount=0,this.delayConnectTime=l.DEFAULT_DELAY_TIME,this.delayConnectTimer=0,this.setRouteKey()}return e.prototype.dispose=function(){clearTimeout(this.delayConnectTimer),this.delayConnectTimer=m},e.prototype.reset=function(){clearTimeout(this.delayConnectTimer),this.delayConnectTimer=0},e.prototype.login=function(){0!==this.retryCount?this.relogin():this.sendLoginRequest()},e.prototype.unlogin=function(){if(!this.sid||!this.token)return!1;var e=(new u.Request).sendBeacon(this.getUnbindPath(),o(o({},this.createBindPostMessage("CLIENT_DISCONNECT")),{sid:this.sid,token:this.token}));return this.sid=void 0,this.token=void 0,e},e.prototype.relogin=function(e,t){var n=this;if(!this.delayConnectTimer){var o=this.getDelayConnectTime(e);this.delayConnectTimer=setTimeout((function(){t||n.retryCount===a.DEFAULT_RETRY_COUNTS&&n.dependency.disconnect({shutDown:!1,reason:"big collab login timeout."}),n.retryCount=n.retryCount+1,n.reset(),n.sendLoginRequest()}),o)}},e.prototype.getDelayConnectTime=function(e){return void 0===e?(this.retryCount>a.DEFAULT_RETRY_COUNTS&&this.delayConnectTime===l.DEFAULT_DELAY_TIME&&(this.delayConnectTime=l.MAX_DELAY_TIME),this.delayConnectTime):e},e.prototype.sendLoginRequest=function(){var e,t;return r(this,void 0,void 0,(function(){var n,o;return i(this,(function(r){switch(r.label){case 0:return n=this.createBindPostMessage("BIND_POST"),this.dependency.connectStatusChange(v.ConnectStatus.LOGIN),h.ConnectionLog.info("routeKey: "+this.routeKey+", Message: "+h.JsonUtil.jsonStringify(n)),[4,(new u.Request).sendRequest(this.getBindPath(),d.Method.POST,n,{contentType:c.ContentTypeValue.JSON})];case 1:return o=r.sent(),this.handleLoginResult(o),h.ConnectionLog.info("handleLoginResult result: "+h.JsonUtil.jsonStringify(null!==(t=null===(e=o.data)||void 0===e?void 0:e.data)&&void 0!==t?t:{})),[2]}}))}))},e.prototype.createBindPostMessage=function(e){return{head:h.createMessageHead(this.options,{command:e,baseRev:this.dependency.getVersion(),getHeaderGeneralPacket:this.dependency.getHeaderGeneralPacket(),taskId:h.generateMessageTaskId()}),body:this.createPostBody()}},e.prototype.createPostBody=function(){return h.JsonUtil.jsonStringify({})},e.prototype.handleLoginResult=function(e){if(e.error)this.relogin();else{var t=e.data.data;this.isLoginSuccess(t.retcode)?this.handleLoginSuccess(t):this.handleLoginFailed(t)}},e.prototype.isLoginSuccess=function(e){return p.SERVER_SUCCESS_CODES.includes(e)},e.prototype.handleLoginSuccess=function(e){this.reset(),this.retryCount=0,this.delayConnectTime=l.DEFAULT_DELAY_TIME,this.sid=e.data.sid,this.token=e.data.token;var t={sid:e.data.sid,token:e.data.token,routeKey:this.routeKey};this.dependency.connectStatusChange(v.ConnectStatus.LOGINED,t)},e.prototype.handleLoginFailed=function(e){var t=e.retcode,n=e.msg,o=e.data;if(this.setRouteKey(o.routeKey),h.ConnectionLog.info("connect failed, serverErrCode: "+t+", errorMessage:"+n),this.shouldReconnect(e))f.default.retryRequestReport({name:String(t),message:"login error, retcode: "+t+", msg: "+n},this.options.module),this.relogin(this.getDelayConnectTime(),t===p.RoomWebsocketErrorCode.SOCKET_COLLAB_ROOM_MEMBER_FULL&&!!o.routeKey);else{var r={errCode:t,reason:p.RoomUtil.getWebsocketChannelErrorMessage(t,"connect failed."),shutDown:!p.NEED_RETRY_ERRCODES.includes(t)};this.dependency.connectStatusChange(v.ConnectStatus.LOGIN_FAIL,void 0,r)}},e.prototype.setRouteKey=function(e){this.routeKey=null!=e?e:this.options.serverVars.globalPadId},e.prototype.shouldReconnect=function(e){var t=e.retcode,n=e.data;return t===p.RoomWebsocketErrorCode.SOCKET_COLLAB_ROOM_MEMBER_FULL?!!n.routeKey:p.NEED_RETRY_ERRCODES.includes(t)&&this.retryCount<3},e.prototype.getBindPath=function(){return this.routeKey||this.setRouteKey(),g.PATH+"?routeKey="+this.routeKey},e.prototype.getUnbindPath=function(){return this.routeKey||this.setRouteKey(),"/websocket/save?routeKey="+this.routeKey},e}();t.BigCollabLogin=E},ebeebfcb4d:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RoomHeartBeat=void 0;var o=n("cdda668c2b"),r=n("c0f85d03df"),i=function(){function e(e,t,n){this.heartBeatInterval=15e3,this.messageSender=e,this.channelOption=t,this.roomStatusDependency=n}return e.prototype.dispose=function(){this.clearHeartBeatTimer()},e.prototype.startHeartBeatOnTimer=function(e){var t=this;e&&e!==this.heartBeatInterval&&(this.heartBeatInterval=e),this.heartBeatTimer||(this.heartBeatTimer=setTimeout((function(){t.sendHeartBeat()}),this.heartBeatInterval))},e.prototype.onHeartBeatResponse=function(e,t){var n,o,r,i;this.heartBeatCount=0;var s=(null===(n=null==t?void 0:t.onpost)||void 0===n?void 0:n.heartbeat_interval)||this.heartBeatInterval;this.startHeartBeatOnTimer(s),(null===(o=null==t?void 0:t.data)||void 0===o?void 0:o.common)&&(null===(i=(r=this.roomStatusDependency).heartBeatCommon)||void 0===i||i.call(r,t.data.common))},e.prototype.resetHeartBeat=function(){this.clearHeartBeatTimer(),this.heartBeatCount=0,this.heartBeatInterval=15e3},e.prototype.clearHeartBeatTimer=function(){this.heartBeatTimer&&(clearTimeout(this.heartBeatTimer),this.heartBeatTimer=0)},e.prototype.sendHeartBeat=function(){var e;this.clearHeartBeatTimer();var t=null===(e=this.roomStatusDependency)||void 0===e?void 0:e.getRoomState();if(t===r.RoomState.OPENED&&this.messageSender){if(this.heartBeatCount>0&&o.ConnectionLog.warn("sendHeartBeat: heart beat count over 1, count = "+this.heartBeatCount),this.heartBeatCount>3)return o.ConnectionLog.warn("sendHeartBeat: max heart beat count reached, the connection will be close."),void this.messageSender.closeAndDelayReopen({reason:"closed by heart beat error.",shutDown:!1},0);this.heartBeatCount+=1;var n=o.JsonUtil.jsonStringify(this.heartBeatHead)+"\n";this.messageSender.postMessageWithWebsocket(n),this.startHeartBeatOnTimer(this.heartBeatInterval)}else o.ConnectionLog.warn("sendHeartBeat: room state error, state = "+t)},Object.defineProperty(e.prototype,"heartBeatHead",{get:function(){var e,t,n={type:"HEART_BEAT",task_id:o.generateMessageTaskId(),docid:this.channelOption.globalPadId,uid:this.channelOption.uid||this.channelOption.userId.replace("p.","").replace("g.","")};return Object.assign(null!==(t=null===(e=this.channelOption.config)||void 0===e?void 0:e.heartBeatAdditionalHead)&&void 0!==t?t:{},n)},enumerable:!1,configurable:!0}),e}();t.RoomHeartBeat=i},eee882e93f:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n("b9b3430781"),t),r(n("d536a5377f"),t),r(n("493c9e859f"),t),r(n("f60679170b"),t),r(n("fced7a148e"),t),r(n("b17aeaa40b"),t),r(n("e963e02dd5"),t),r(n("ad7834bc49"),t),r(n("92e2df3b64"),t),r(n("19d42386c4"),t),r(n("392e2b0ea1"),t),r(n("4649e19c41"),t),r(n("763f20313f"),t),r(n("551b953320"),t)},ef67208c03:function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},o(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.HttpError=void 0;var i=function(e){function t(t,n){var o=e.call(this,t+", statusCode:"+n+" ")||this;return o.name="HttpError",o.statusCode=n,o}return r(t,e),t}(Error);t.HttpError=i},f091811571:function(e,t,n){"use strict";e.exports=function(e,t){return function(){for(var n=new Array(arguments.length),o=0;o<n.length;o++)n[o]=arguments[o];return e.apply(t,n)}}},f41252a196:function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ContentType=t.Request=t.Method=void 0;var i=n("cdda668c2b"),s=n("cf3c69206c");Object.defineProperty(t,"Method",{enumerable:!0,get:function(){return s.Method}}),Object.defineProperty(t,"ContentType",{enumerable:!0,get:function(){return s.ContentType}});var a=function(){function e(){}return e.prototype.sendCommonRequest=function(e){return o(this,void 0,void 0,(function(){return r(this,(function(t){return[2,new Promise((function(t){var n;try{var o,r=new XMLHttpRequest;r.onreadystatechange=function(){if(r.readyState===XMLHttpRequest.DONE){var e="";200===r.status?e=r.responseText:o=new s.HttpError("StatusError",r.status),t(new s.Result(o,e))}};try{r.timeout=null!==(n=e.timeout)&&void 0!==n?n:3e4}catch(e){i.ConnectionLog.error("request error message: "+(null==e?void 0:e.message))}r.ontimeout=function(){o=new Error("TimeOutError"),t(new s.Result(o))},r.open(e.method,e.url),e.contentType===s.ContentType.JSON?(r.setRequestHeader("content-type",s.ContentTypeValue.JSON),r.setRequestHeader("content-encoding","gzip")):r.setRequestHeader("content-type",s.ContentTypeValue.FORM),r.send(e.body)}catch(e){t(new s.Result(e))}}))]}))}))},e}();t.Request=a},f4abd3e6e6:function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},o(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.USER_INOUT_TYPE=t.UserInoutMessage=void 0;var i=n("cdda668c2b"),s=n("825eafaa67"),a="USER_INOUT_TYPE";t.USER_INOUT_TYPE=a;var c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.userNewInfos=new Map,t.userLeaves=new Map,t}return r(t,e),t.prototype.shouldLimit=function(e){return["USER_NEWINFO","USER_LEAVE"].includes(e)},t.prototype.pushMessage=function(e){var t=e.body.notice;"USER_NEWINFO"===e.head.type&&this.pushUserNewInfo(t),"USER_LEAVE"===e.head.type&&this.pushUserLeave(t)},t.prototype.transfer=function(){var e;(this.userNewInfos.size||(null===(e=this.userLeaves)||void 0===e?void 0:e.size))&&(i.ConnectionLog.info("transfer memberCount:"+this.memberCount+", type:"+a+", duration:"+this.duration),this.transferUserNewInfo(),this.transferUserLeave(),this.userNewInfos.clear(),this.userLeaves.clear())},t.prototype.transferUserNewInfo=function(){if(this.userNewInfos.size){var e=Array.from(this.userNewInfos.values());this.userNewInfos.clear();var t={head:{type:"USER_NEWINFOS"},body:{mem_count:this.memberCount,notices:e}};this.transferToBusiness("USER_NEWINFOS",[t])}},t.prototype.transferUserLeave=function(){var e;if(null===(e=this.userLeaves)||void 0===e?void 0:e.size){var t=Array.from(this.userLeaves.values());this.userLeaves.clear();var n={head:{type:"USER_LEAVES"},body:{mem_count:this.memberCount,notices:t}};this.transferToBusiness("USER_LEAVES",[n])}},t.prototype.pushUserNewInfo=function(e){e&&e.uuId&&(this.userLeaves.has(e.uuId)?this.userLeaves.delete(e.uuId):this.userNewInfos.set(e.uuId,e))},t.prototype.pushUserLeave=function(e){e&&e.uuId&&(this.userNewInfos.has(e.uuId)?this.userNewInfos.delete(e.uuId):this.userLeaves.set(e.uuId,e))},t}(s.LimitFrequencyMessage);t.UserInoutMessage=c},f60679170b:function(e,t,n){"use strict";var o,r;Object.defineProperty(t,"__esModule",{value:!0}),t.IBatchCommitChangesResultRetcode=t.BatchCommitFailReason=void 0,function(e){e.UNKNOW="Unknow",e.SUCCESS="Success",e.NETWORK_EXCEPTION="NetworkException",e.SERVER_VERITY_EXCEPTION="ServerVerityException"}(o||(o={})),t.BatchCommitFailReason=o,function(e){e[e.SUCCESS=0]="SUCCESS",e[e.ServerTimeout=101]="ServerTimeout",e[e.ServerInvalidParam=10001]="ServerInvalidParam",e[e.UNKNOWN_ERROR=52e3]="UNKNOWN_ERROR",e[e.USER_PRIVILEGE_FAILED=200111]="USER_PRIVILEGE_FAILED",e[e.PARAMETER_WRONG=52001]="PARAMETER_WRONG",e[e.WEBSOCKET_UNSUPPORT_BATCH_COMMIT=52002]="WEBSOCKET_UNSUPPORT_BATCH_COMMIT",e[e.CONTENT_LENGTH_EXCEED_LIMIT=52003]="CONTENT_LENGTH_EXCEED_LIMIT"}(r||(r={})),t.IBatchCommitChangesResultRetcode=r},f6998d6780:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var o=n("b8f805ddc2");class r{constructor(e,t=[],n=!1,o=!1){this.ctor=e,this.staticArguments=t,this.supportsDelayedInstantiation=n,this.supportsOverride=o}isEqualWith(e){return this.ctor===e.ctor&&(this.supportsDelayedInstantiation===e.supportsDelayedInstantiation&&(this.supportsOverride===e.supportsOverride&&!!Object(o.b)(this.staticArguments,e.staticArguments)))}}},f7d659dd3c:function(e,t,n){"use strict";var o=n("a2bdef5516").version,r={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){r[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));var i={};r.transitional=function(e,t,n){function r(e,t){return"[Axios v"+o+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return function(n,o,s){if(!1===e)throw new Error(r(o," has been removed"+(t?" in "+t:"")));return t&&!i[o]&&(i[o]=!0,console.warn(r(o," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,o,s)}},e.exports={assertOptions:function(e,t,n){if("object"!=typeof e)throw new TypeError("options must be an object");for(var o=Object.keys(e),r=o.length;r-- >0;){var i=o[r],s=t[i];if(s){var a=e[i],c=void 0===a||s(a,i,e);if(!0!==c)throw new TypeError("option "+i+" must be "+c)}else if(!0!==n)throw Error("Unknown option "+i)}},validators:r}},f7ee9899ef:function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Request=void 0;var i=n("b512c0eccb"),s=n("cdda668c2b"),a=n("5d1be1397d"),c=n("cf3c69206c"),u=function(){function e(){}return e.prototype.sendRequest=function(e,t,n,u){var d,l,p;return void 0===t&&(t=a.Method.POST),void 0===n&&(n=c.ContentType.FORM),o(this,void 0,void 0,(function(){var o,h;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),o=void 0,t!==a.Method.GET?[3,2]:[4,i.networkRequest.get(e)];case 1:return o=r.sent(),[3,4];case 2:return[4,i.networkRequest.post(e,u,{contentType:c.ContentTypeValueMap.get(n)})];case 3:o=r.sent(),r.label=4;case 4:return[2,new c.Result(void 0,o)];case 5:return h=r.sent(),s.ConnectionLog.error("Request Failed, requestUrl:"+e+", status:"+(null===(d=null==h?void 0:h.request)||void 0===d?void 0:d.status)+", response:"+(null===(l=null==h?void 0:h.request)||void 0===l?void 0:l.response)+", responseText:"+(null===(p=null==h?void 0:h.request)||void 0===p?void 0:p.responseText)+", error stack:"+(null==h?void 0:h.stack)+", error message:"+(null==h?void 0:h.message)),[2,new c.Result(h)];case 6:return[2]}}))}))},e}();t.Request=u},f9d31e5257:function(e,t,n){"use strict";e.exports=function(e,t,n,o,r){return e.config=t,n&&(e.code=n),e.request=o,e.response=r,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},e}},fabb3a5f21:function(e,t,n){"use strict";var o=n("9da27020aa"),r=n("d3c9d8f7fe"),i=n("7e2e5664bb"),s=n("601e8bbc18"),a=n("80f80074c6"),c=n("f7d659dd3c"),u=c.validators;function d(e){this.defaults=e,this.interceptors={request:new i,response:new i}}d.prototype.request=function(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},(t=a(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var n=t.transitional;void 0!==n&&c.assertOptions(n,{silentJSONParsing:u.transitional(u.boolean),forcedJSONParsing:u.transitional(u.boolean),clarifyTimeoutError:u.transitional(u.boolean)},!1);var o=[],r=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(r=r&&e.synchronous,o.unshift(e.fulfilled,e.rejected))}));var i,d=[];if(this.interceptors.response.forEach((function(e){d.push(e.fulfilled,e.rejected)})),!r){var l=[s,void 0];for(Array.prototype.unshift.apply(l,o),l=l.concat(d),i=Promise.resolve(t);l.length;)i=i.then(l.shift(),l.shift());return i}for(var p=t;o.length;){var h=o.shift(),f=o.shift();try{p=h(p)}catch(e){f(e);break}}try{i=s(p)}catch(e){return Promise.reject(e)}for(;d.length;)i=i.then(d.shift(),d.shift());return i},d.prototype.getUri=function(e){return e=a(this.defaults,e),r(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},o.forEach(["delete","get","head","options"],(function(e){d.prototype[e]=function(t,n){return this.request(a(n||{},{method:e,url:t,data:(n||{}).data}))}})),o.forEach(["post","put","patch"],(function(e){d.prototype[e]=function(t,n,o){return this.request(a(o||{},{method:e,url:t,data:n}))}})),e.exports=d},fced7a148e:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_RETRY_COUNTS=t.DEFAULT_SEND_MESSAGE_TIMEOUT=void 0;t.DEFAULT_SEND_MESSAGE_TIMEOUT=25e3;t.DEFAULT_RETRY_COUNTS=3},fd8dd5b6c8:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.getURLParam=t.getHashValue=t.getQuery=void 0;t.getQuery=function(t,n){var o=function(e){return"string"==typeof e?e:e.search}(n||e.location||"").match(new RegExp("(\\?|&)"+t+"=([^&]*)(#|&|$)"));return o?decodeURIComponent(o[2]):""};t.getHashValue=function(t){var n,o=e.location||"",r=(n=o,n.hash||"").match(new RegExp("(#|&)"+t+"=([^&]*)(#|&|$)"));return r?decodeURIComponent(r[2]):""},t.getURLParam=function(e){return t.getHashValue(e)||t.getQuery(e)}}).call(this,n("5ef37df1a0"))},fda8d8987d:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var o=n("81cf3de5f1"),r=n("af75a08457"),i=n("a282565e4f");function s(e,t,n,s,a){if(void 0!==n&&"number"==typeof a)throw new Error(i.k);const c=a.toString(),u=o.a.getDepsMetadata(e,t)||{},d=u[c];if(void 0!==(null==d?void 0:d[0])&&(null==d?void 0:d[0])!==s)throw new Error(Object(i.f)(t.name,c,Object(r.a)(d[0]),Object(r.a)(s)));d&&d[1]&&!d[1].serviceIdentifier?(d[0]=s,d[1].serviceIdentifier=s):void 0===d&&(u[c]=[s,{serviceIdentifier:s}],o.a.setDepsMetadata(e,u,t))}},fe9bc614bd:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));class o{static hasMetadata(e,t){return!!t[e]}static getDepsMetadata(e,t){return t[e]}static setDepsMetadata(e,t,n){n[e]=t}static getMethodMetadata(e,t){return t[e]}static setMethodMetadata(e,t,n){n[e]=t}}function r(e){return"function"==typeof e?"function"==typeof e.toLegacyString?e.toLegacyString():e.name:String(e)}const i="Metadata must be applied to the parameters of a class constructor",s=(...e)=>`Metadata key was used more than once for parameter of class ${e[0]} in position ${e[1]}, already has metadata: [${e[2]}], newly add metadata: [${e[3]}]`,a=(...e)=>`@ServiceName decorator [${e[0]}] can only be used to decorate constructor parameter`;const c="di:ctor_deps";class u{static has(e){return this.serviceIdsMap.has(e)}static get(e){return this.serviceIdsMap.get(e)}static set(e,t){this.serviceIdsMap.set(e,t)}}function d(e){if(u.has(e))return u.get(e);const t=function(e,n,u){if(3!==arguments.length)throw new Error(a(n));!function(e,t,n,a,c){if(void 0!==n&&"number"==typeof c)throw new Error(i);const u=c.toString(),d=o.getDepsMetadata(e,t)||{},l=d[u];if(void 0!==(null==l?void 0:l[0])&&(null==l?void 0:l[0])!==a)throw new Error(s(t.name,u,r(l[0]),r(a)));l&&l[1]&&!l[1].serviceIdentifier?(l[0]=a,l[1].serviceIdentifier=a):void 0===l&&(d[u]=[a,{serviceIdentifier:a}],o.setDepsMetadata(e,d,t))}(c,e,void 0,t,u)};return t.toLegacyString=()=>e,u.set(e,t),t}u.serviceIdsMap=new Map}}]);
//# sourceMappingURL=slide-common~4e144-834a28.js.map