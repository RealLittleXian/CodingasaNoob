(this.webpackJsonp=this.webpackJsonp||[]).push([["base~54efbb91"],{"020899bf26":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o})),n.d(t,"d",(function(){return c})),n.d(t,"c",(function(){return s}));n("c6244f7705"),n("081c8cafea");var r=n("9cd4e1be22"),a=n("37091e4240"),i=Object(r.c)((function(){var e=Object(r.c)((function(){return{Logger:Object(r.d)().dependsOn([]),Mqq:Object(r.d)().dependsOn([])}})),t=Object(r.c)((function(){return{Snackbar:Object(r.b)().dependsOn([]),Modal:Object(r.b)().dependsOn([])}})),n=Object(r.c)((function(){return{SlideCountState:Object(r.d)().dependsOn([])}})),a=Object(r.d)().dependsOn([]),i=Object(r.d)().dependsOn([]),o=Object(r.d)().dependsOn([]),c=Object(r.d)().dependsOn([e.Logger]),s=Object(r.d)().dependsOn([e.Logger,o,c]),u=Object(r.d)().dependsOn([]),l=Object(r.d)().dependsOn([]),d=Object(r.c)((function(){var t=Object(r.d)().dependsOn([]),n=Object(r.d)().dependsOn([t,e.Logger]),a=Object(r.d)().dependsOn([t]),i=Object(r.d)().dependsOn([t]),o=Object(r.d)().dependsOn([u,l,n,a,t,s,i,e.Logger]);return{PresentationStoreService:o,EventManager:t,TransactionManager:a,SearchManager:Object(r.d)().dependsOn([t,l]),CommandManager:Object(r.d)().dependsOn([t,o,e.Logger]),ObserverManager:i,ColorManager:Object(r.d)().dependsOn([]),DataHelper:Object(r.d)().dependsOn([]),ResourceMapManager:Object(r.d)().dependsOn([t]),MutationManager:n,SnapshotManager:Object(r.d)().dependsOn([o,l,s,t,e.Logger]),DataValidator:Object(r.d)().dependsOn([])}})),f=Object(r.d)().dependsOn([o]),h=Object(r.d)().dependsOn([e.Logger,d.PresentationStoreService,c,l]),v=Object(r.d)().dependsOn([c,e.Logger,h]),p=Object(r.d)().dependsOn([]);return{Infra:e,UI:t,States:n,ClientVarsService:c,SlideInitialDataService:u,SlideAppService:h,ContentStatusManager:l,SlideTitleManager:v,SDKDataServices:d,PrivilegeManager:f,DocInfoManager:s,EventManager:o,UIEventManager:i,OperationLogger:a,SlideFileManager:p}}));function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};i.SlideAppService.promise().then((function(t){t.onReady(e)}))}function c(e){return new Promise((function(t){a.b.onIncludingPast(a.a.FIRST_PAGE_DISPLAY,(function(){return t(e())}))}))}function s(e){return new Promise((function(t){a.b.onIncludingPast(a.a.VISIBLE_PAGE_DISPLAY,(function(){return t(e())}))}))}},"03c2478429":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("9cd4e1be22"),a=n("020899bf26"),i=Object(r.c)((function(){var e=Object(r.c)((function(){return{PasswordModal:Object(r.b)().dependsOn([]),ConvertErrorModal:Object(r.b)().dependsOn([a.a.UI.Modal,a.a.Infra.Mqq])}})),t=Object(r.d)().dependsOn([]),n=Object(r.d)().dependsOn([]),i=Object(r.d)().dependsOn([]),o=Object(r.d)().dependsOn([a.a.Infra.Logger,a.a.Infra.Mqq,i]),c=Object(r.d)().dependsOn([a.a.Infra.Logger,t,i,a.a.States.SlideCountState,a.a.EventManager]),s=Object(r.d)().dependsOn([a.a.Infra.Logger,t,i,n,c]);return{UI:e,LocalEditContext:t,LocalEditDataConverter:n,LocalEditEvents:i,LocalEditNoticeManager:o,LocalEditReporter:c,LocalEditService:s,LocalEditManager:Object(r.d)().dependsOn([a.a.Infra.Logger,t,i,s,a.a.ContentStatusManager,a.a.UI.Snackbar]),EmbeddedFontManager:Object(r.d)().dependsOn([a.a.Infra.Logger,a.a.SlideAppService])}}))},"0fbb1a6af6":function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return u}));var r=n("9132715560"),a=n.n(r),i=n("6a364eb35c"),o=n.n(i),c=n("05d181ac40"),s="3.0.0",u=function(){function e(t){a()(this,e),this.clientVars=t}return o()(e,[{key:"getClientVars",value:function(){return this.clientVars}},{key:"setClientVars",value:function(e){this.clientVars=e}},{key:"getCloneClientVars",value:function(){return JSON.parse(JSON.stringify(this.clientVars))}},{key:"setInitialAttributedText",value:function(e){var t,n=this.clientVars.collab_client_vars,r=void 0===n?{}:n;r.initialAttributedText=null!==(t=r.initialAttributedText)&&void 0!==t?t:{},r.initialAttributedText.text=e,this.clientVars.collab_client_vars=r}},{key:"isV3Data",value:function(){var e;return(null===(e=this.clientVars.collab_client_vars)||void 0===e?void 0:e.dver)===s}},{key:"isLocalDoc",value:function(){return"new"===this.clientVars.padStatus}},{key:"isPCLocalEdit",value:function(){return c.a.IS_PC_LOCAL_EDIT}},{key:"isLocalEdit",value:function(){return c.a.IS_LOCAL_EDIT}}]),e}()},"1288bffff3":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={SLIDE:"slide",MASTER_LAYOUT:"masterLayout"}},"29112c2c27":function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e[e.AlreadyCreate=1]="AlreadyCreate",e[e.NotCreate=0]="NotCreate"}(r||(r={}))},"2f1cded8d8":function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e.LoadDocumentAllChunksSuccess="load-document-all-chunks-success",e.LoadDocumentError="load-document-error",e.DocInfoReady="doc-info-ready",e.LoadDocInfoError="load-doc-info-error",e.Lock="lock",e.Unlock="unlock",e.LockInfoUpdate="lock-info-update",e.CursorInfoUpdate="cursor-info-update",e.SetVisibleFailed="setVisibleFailed",e.SetDocCopyable="setDocCopyable",e.SetDocEditable="setDocEditable",e.ShowSnapShotModal="show-snap-shot-modal",e.AppServiceProviderLoaded="app-service-provider-loaded",e.OfflineDBServiceReady="offline-db-service-ready",e.UseOfflineData="use-offline-data",e.FirstPageDisplay="first-page-display",e.CornerMarkVisible="unHiddon"}(r||(r={}))},"33e0562167":function(e,t,n){"use strict";n.d(t,"b",(function(){return O})),n.d(t,"f",(function(){return x})),n.d(t,"d",(function(){return P})),n.d(t,"e",(function(){return E})),n.d(t,"a",(function(){return T})),n.d(t,"c",(function(){return _}));var r=n("85d0a7609b"),a=n.n(r),i=n("176815363d"),o=n.n(i),c=n("3ef2352f0b"),s=n.n(c),u=(n("c6244f7705"),n("081c8cafea"),n("3bf1976a4f"),n("8e7cce0ada"),n("85d48ef22b"),n("2a6f332b5e"),n("1bab7b5fb7"),n("9d7978d445"),n("342844cefa"),n("a84962d637"),n("8a35b54c1d"),n("c554310b5c"),n("8ee19818c4"),n("bcb5d93d36"),n("f4e4ed5c17")),l=n("ee6bb53310"),d=n.n(l),f=n("f8fc8e0087"),h=n("10f9b6de11"),v=n("668bd0ac65"),p=n("020899bf26"),g=n("aba9dcef64"),m=n("ed31fcfdd0"),b=n("4c52987e8a"),y=n("a24c6cbd03"),k=n("0e0be5791f"),S=n.n(k),w=n("285f8ccc4f");function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function D(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function O(e){return C.apply(this,arguments)}function C(){return(C=o()(s.a.mark((function e(t){var r,a,i,o,c,u,l,d,f,p,g,b,k,S,I;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.uid,o=t.uin,c=t.secretId4New,u=t.globalPadId4New,l=t.title4New,e.next=3,Promise.all([n.e("commonAsync~9b1fde68"),n.e("commonAsync~27f19aac"),n.e("commonAsync~205ac551"),n.e("commonAsync~0c3a6025"),n.e("commonAsync~32e631b8"),n.e("commonAsync~08369118"),n.e("commonAsync~50db4bb8"),n.e("commonAsync~86c92fed"),n.e("commonAsync~a95f944a"),n.e("commonAsync~6e568190"),n.e("commonAsync~b174e5ca"),n.e("commonAsync~54a68610"),n.e("commonAsync~61b3c105"),n.e("commonAsync~f7b3ac00"),n.e("commonAsync~cece21d6"),n.e("commonAsync~ecbf7682"),n.e("commonAsync~6c5dfa7c"),n.e("commonAsync~90483627"),n.e("commonAsync~d2c096c2"),n.e("commonAsync~1285a477"),n.e("commonAsync~31ded9a0"),n.e("commonAsync~ecdbff9b"),n.e("commonAsync~c2cc425c"),n.e("commonAsync~4fb44df2"),n.e("commonAsync~d06fe423"),n.e("commonAsync~0519277e"),n.e("commonAsync~6df2b9ea"),n.e("commonAsync~b5c4f9e4"),n.e("commonAsync~ffdf5190"),n.e("commonAsync~127b6cf7"),n.e("commonAsync~b3c4a2ff"),n.e("commonAsync~19bb5a55")]).then(n.t.bind(null,"16188f9d95",7));case 3:return d=e.sent,f=d.getDefaultTemplateData,p=Object(w.a)(f()),g="string"==typeof u?u.split("$")[0]:"",b="string"==typeof u?u.split("$")[1]:"",k="p.".concat(i),(S=Object(m.a)()).padStatus=h.DOCUMENT_STATUS.new,S.globalPadId=u,S.domainId=g,S.creatorDomain=g,S.isOwner=!0,S.title=l,S.padTitle=l,S.padId=b,S.localPadId=b,S.uin=o,S.userId=k,null!=S&&null!==(r=S.collab_client_vars)&&void 0!==r&&r.client&&(S.collab_client_vars.client.upid=c),null!=S&&null!==(a=S.collab_client_vars)&&void 0!==a&&a.initialAttributedText&&(s=p,I=v.a.fromCommandData(new v.a(s).getCommandData()).getData().presentation,S.collab_client_vars.initialAttributedText.text=I),S.collab_client_vars&&(S.collab_client_vars.globalPadId=u,S.collab_client_vars.dver=y.b,S.collab_client_vars.ver=y.c,S.collab_client_vars.padId=b),e.abrupt("return",S);case 25:case"end":return e.stop()}var s}),e)})))).apply(this,arguments)}function x(e){var t,n,r,a=e,i=null===(t=window)||void 0===t||null===(n=t.clientVars)||void 0===n?void 0:n.userInfo;return null!=i&&i.uid&&(a.userInfo=i,a.userName=i.nick,a.userPic=i.avatar,a.userLoginCorpId=i.corpId,a.userLoginCorpName=i.corpName,a.vipInfo=i.vipInfo),a.padTitle=a.padTitle||a.title,a.padId=a.padId||(null===(r=a.collab_client_vars)||void 0===r?void 0:r.padId),a}function P(e){var t=e;return d()(t,"collab_client_vars.initialAttributedText.slide",{count:null,isPaginated:!1,startIndex:null,total:null}),t}function E(e){window.clientVars=e,p.a.ClientVarsService.promise().then((function(t){t.setClientVars(e)}))}function T(e){return A.apply(this,arguments)}function A(){return(A=o()(s.a.mark((function e(t){var n,r,a,i,o,c,u;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(b.f)();case 2:return e.next=4,p.a.ClientVarsService.promise();case 4:return r=e.sent,a=r.getClientVars(),e.next=8,p.a.SDKDataServices.PresentationStoreService.promise();case 8:return i=e.sent,e.next=11,g.a.CollaborationManager.promise();case 11:if(o=e.sent,null==t){e.next=16;break}e.t0=t,e.next=19;break;case 16:return e.next=18,i.getSerializedPresentationDataByWorker();case 18:e.t0=e.sent;case 19:return c=e.t0,u=D(D({},S()(a,"collab_client_vars")),{},{collab_client_vars:D(D({},S()(a.collab_client_vars,"initialAttributedText")),{},{initialAttributedText:D(D({},S()(null===(n=a.collab_client_vars)||void 0===n?void 0:n.initialAttributedText,"text")),{},{text:JSON.stringify(c)}),rev:o.getRevision().getRevisionNumber()})}),e.abrupt("return",u);case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e){var t,n,r=null!==(t=window)&&void 0!==t&&null!==(n=t.location)&&void 0!==n&&n.hostname?"//".concat(window.location.hostname,"/"):"//docs.qq.com/",a=Object(f.getCookie)("TOK");return u.a.get("".concat(r,"dop-api/slide/data/get?id=").concat(e,"&xsrf=").concat(a,"&needPaginate=0&normal=1"))}},3745463185:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return a}));n("3bf1976a4f"),n("b4638a0243"),n("b1e2246d82");function r(e){var t=performance.now();return function(){var n=performance.now(),r="@".concat(~~n," +").concat((n-t).toFixed(2),"ms"),a={now:n,last:t,timeline:r};return t=n,e?a:r}}function a(e){var t="".concat(e.name||"Error",": ").concat(e.message||"Unknown error","} ").concat(e.stack||"");return"".concat(t," ").concat(e.code?"(".concat(e.code,")"):"")}},"3c17f57670":function(e,t,n){"use strict";n.d(t,"a",(function(){return w}));n("342844cefa"),n("a84962d637"),n("8a35b54c1d"),n("c554310b5c"),n("8ee19818c4"),n("bcb5d93d36");var r=n("176815363d"),a=n.n(r),i=n("9132715560"),o=n.n(i),c=n("6a364eb35c"),s=n.n(c),u=n("85d0a7609b"),l=n.n(u),d=n("3ef2352f0b"),f=n.n(d),h=(n("3bf1976a4f"),n("c6244f7705"),n("081c8cafea"),n("bd80bf2d0f"),n("a52ab4297c")),v=n.n(h),p=n("f4e4ed5c17"),g=n("d835d04d7a"),m=(n("8e7cce0ada"),n("211c9e7008"),n("30078d1bba"),n("9e613e2f57"),n("0ad0839104"),n("87e9aa2426"),n("297a259b22"),n("347f4c5e26"),n("64bb56d585"),n("afeeb24b8e"),n("56ffd0610f"),n("7513a1cdfa"),n("f39debe0f1"),n("044475b26b"),n("e91e206977"),n("aaa7d96b4d"),n("743c905172"),n("240894da07"),n("8d6a7965e9"),n("b3b54ec99d"),n("65981e8631"),n("470d084e5c"),n("09b17a1f21"),n("15086d4e19"),n("474b85968b"),function(){function e(){o()(this,e)}return s()(e,null,[{key:"toUint8Array",value:function(e){if(e instanceof Uint8Array)return e;for(var t=atob(e),n=t.length,r=new Uint8Array(n),a=0;a<n;a++)r[a]=t.charCodeAt(a);return r}},{key:"fromUint8Array",value:function(e){for(var t="",n=0;n<e.byteLength;n++)t+=String.fromCharCode(e[n]);return btoa(t)}}]),e}()),b=n("db0c73f5df");function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){l()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var S=function(e){return v.a.stringify(e,{encode:!0})},w=function(){function e(t){var n=this;o()(this,e),l()(this,"onlineDocPrefix","/cgi-bin/online_docs"),l()(this,"cgiGoPrefix","/cgi-go"),l()(this,"dopApiPrefix","/dop-api"),l()(this,"v1ExportPrefix","/v1/export"),l()(this,"getChunkData",(function(e){return p.a.get("/dop-api/slide/pages/get",{params:k(k({},e),{},{xsrf:Object(b.b)()})})})),l()(this,"pollingResourceData",(function(e,t){return p.a.get("/api/slide/".concat(e,"/resources"),{params:t,paramsSerializer:S})})),l()(this,"pollingDocStatus",(function(e){return p.a.get("/api/weboffice/files/".concat(e,"/status"))})),l()(this,"getDocInfo",(function(e){return p.a.get("".concat(n.onlineDocPrefix,"/doc_info"),{params:k(k({},e),{},{xsrf:Object(b.b)()})})})),l()(this,"updateTitle",(function(e){var t=e.padId,r=e.domainId,a=e.title,i=e.timestamp,o=void 0===i?Date.now():i,c="pad_id=".concat(t,"&type=1&ver=2&domain_id=").concat(r,"&xsrf=").concat(Object(b.b)(),"&version=2&title=").concat(encodeURIComponent(a),"&timestamp=").concat(o);return p.a.post("".concat(n.onlineDocPrefix,"/doc_changetitle?").concat(c))})),l()(this,"getUserInfosByPadID",(function(e){return p.a.get("/sdc/getcollabroomuserinfos",{params:k(k({},e),{},{xsrf:Object(b.b)()})})})),l()(this,"generateDuplicateDoc",function(){var e=a()(f.a.mark((function e(t,r,a){var i,o,c,s,u;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(i=new FormData).append("domain_id",t),i.append("title",a),i.append("pad_id",r),i.append("xsrf",Object(b.b)()),e.next=7,p.a.post("".concat(n.onlineDocPrefix,"/copydoc_async"),i);case 7:if(0===(o=e.sent).data.cgicode&&o.data.doc_id){e.next=10;break}return e.abrupt("return",o);case 10:return c=o.data.doc_id,s=c.domain_id,u=c.pad_id,i.set("domain_id",s),i.set("pad_id",u),i.delete("title"),e.next=16,n.duplicateLoop(i);case 16:return e.abrupt("return",e.sent);case 17:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()),l()(this,"duplicateLoop",function(){var e=a()(f.a.mark((function e(t){var r,a,i=arguments;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:1e3,e.next=3,p.a.post("".concat(n.onlineDocPrefix,"/copydoc_loop"),t);case 3:if(10027!==(a=e.sent).data.retcode){e.next=6;break}return e.abrupt("return",new Promise((function(e){setTimeout((function(){e(n.duplicateLoop(t,r+1e3))}),r)})));case 6:return e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),l()(this,"transDocVisible",(function(e,t){var r=new FormData;return r.append("domain_id",e),r.append("pad_id",t),r.append("xsrf",Object(b.b)()),p.a.post("".concat(n.onlineDocPrefix,"/doc_humtrans"),r)})),l()(this,"createDocByData",function(){var e=a()(f.a.mark((function e(t){var r,a,i,o,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.a.post("/cgi-bin/translate/translate_save",k(k({},t),{},{xsrf:Object(b.b)(),commands_format:1,doc_type:4}),{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}});case 3:return i=e.sent,null===(r=n.logger.monitor)||void 0===r||null===(a=r.reportStatus)||void 0===a||a.call(r,g.b.CREATE_DOC_BY_SNAPSHOT,g.a.SUCCESS,"",[t.globalPadId]),e.abrupt("return",i);case 8:throw e.prev=8,e.t0=e.catch(0),null===(o=n.logger.monitor)||void 0===o||null===(c=o.reportStatus)||void 0===c||c.call(o,g.b.CREATE_DOC_BY_SNAPSHOT,g.a.ERROR,e.t0.toString(),[t.globalPadId]),e.t0;case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}()),l()(this,"asyncExportSnapshot",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4,r="".concat(n.v1ExportPrefix,"/export_office"),a=new FormData;return a.append("docId",e.docId),a.append("content",m.fromUint8Array(e.content)),e.version&&a.append("version",e.version),p.a.post(r,a,{timeout:t})})),l()(this,"createDocNewByTemplate",(function(e,t,r,a){var i=new FormData;return i.append("create_type","".concat(a)),i.append("doc_type",e),i.append("template_id","".concat(t)),i.append("title",r),i.append("xsrf",Object(b.b)()),i.append("folder_id",""),i.append("bkn","".concat(Object(b.a)())),i.append("hum","1"),p.a.post("".concat(n.onlineDocPrefix,"/createdoc_new"),i,{timeout:3e4})})),l()(this,"exportSlideToPC",(function(e){var t="".concat(n.cgiGoPrefix,"/common-notify/view"),r=new FormData;return r.append("xsrf",Object(b.b)()),r.append("padId",e),p.a.post(t,r)})),l()(this,"getUserReportToken",(function(e,t){var r=new FormData;return r.append("domain_id",e),r.append("pad_id",t),r.append("xsrf",Object(b.b)()),r.append("dataType","0"),p.a.post("".concat(n.onlineDocPrefix,"/support_gettoken"),r)})),l()(this,"getAuthInfo",(function(e,t){return p.a.get("".concat(n.onlineDocPrefix,"/auth_info/get?localPadId=").concat(e,"&type=1&ver=2&domain=").concat(t,"&xsrf=").concat(Object(b.b)()))})),l()(this,"getHistorySlide",(function(e,t,r){return p.a.get("".concat(n.dopApiPrefix,"/get/slide?padId=").concat(e,"&rev=").concat(t,"&fRev=").concat(r,"&timestamp=").concat((new Date).getTime(),"&xsrf=").concat(Object(b.b)()))})),l()(this,"getAuthExpTime",(function(e,t){return p.a.get("".concat(n.onlineDocPrefix,"/auth_exp/get?domainId=").concat(e,"&localPadId=").concat(t,"&xsrf=").concat(Object(b.b)()))})),l()(this,"queryExportProgress",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4;return p.a.get("".concat(n.v1ExportPrefix,"/query_progress?operationId=").concat(e),{timeout:t})})),l()(this,"asyncExportSlide",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4,r="".concat(n.v1ExportPrefix,"/export_office"),a=new FormData;return a.append("docId",e.globalPadId),e.exportWithAttachment&&a.append("exportType","1"),p.a.post(r,a,{timeout:t})})),l()(this,"getUserInfo",(function(e){return e?p.a.get("".concat(n.onlineDocPrefix,"/user_info?xsrf=").concat(Object(b.b)(),"&get_vip_info=1&only_check=1")):p.a.get("".concat(n.onlineDocPrefix,"/user_info?xsrf=").concat(Object(b.b)(),"&get_vip_info=1"))})),this.logger=t}var t,n;return s()(e,[{key:"recoverDoc",value:function(e,t){var n=new FormData;return n.append("domain_id",e),n.append("pad_id",t),n.append("xsrf",Object(b.b)()),p.a.post("".concat(this.onlineDocPrefix,"/doc_recover"),n)}},{key:"getNotifyNumbers",value:function(){return p.a.get("".concat(this.onlineDocPrefix,"/notify_getnum?&xsrf=").concat(Object(b.b)(),"&bkn=").concat(Object(b.a)()))}},{key:"clearNotifyNumbers",value:function(){return p.a.post("".concat(this.onlineDocPrefix,"/user_flag/setRedDot?&xsrf=").concat(Object(b.b)(),"&bkn=").concat(Object(b.a)(),"&type=8&flag=0"))}},{key:"getHistory",value:function(e,t){return p.a.get("".concat(this.dopApiPrefix,"/get/history?padId=").concat(e,"&page=").concat(t,"&timestamp=").concat((new Date).getTime(),"&xsrf=").concat(Object(b.b)()))}},{key:"revert",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return p.a.get("".concat(this.dopApiPrefix,"/revert?padId=").concat(e,"&rev=").concat(t,"&v=").concat(n,"&xsrf=").concat(Object(b.b)()),{timeout:r})}},{key:"getVersion",value:function(e,t,n){return p.a.get("".concat(this.cgiGoPrefix,"/padinfo/get_version_record?globalPadId=").concat(e,"&page=").concat(t,"&limit=").concat(n,"&xsrf=").concat(Object(b.b)()))}},{key:"getPresentInfo",value:(n=a()(f.a.mark((function e(t,n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",p.a.get("/room-api/presentinfo",{responseType:"json",withCredentials:!0,params:{docid:t,presentid:n}}));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"setPresentInfo",value:(t=a()(f.a.mark((function e(t,n,r){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",p.a.post("/room-api/presentinfo",{docid:t,presentid:n,uid:r},{headers:{"Content-Type":"application/json"},responseType:"json",withCredentials:!0}));case 1:case"end":return e.stop()}}),e)}))),function(e,n,r){return t.apply(this,arguments)})}]),e}()},"44b54bfb86":function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n("9132715560"),a=n.n(r),i=n("6a364eb35c"),o=n.n(i),c=n("85d0a7609b"),s=n.n(c),u=function(){function e(t){a()(this,e),s()(this,"data",void 0),this.data=t}return o()(e,[{key:"setData",value:function(e){this.data=e}},{key:"consume",value:function(){var e=this.data;if(!e)throw new Error("No initial data or initial data has been consumed");return this.data=null,e}}]),e}()},"47283d181a":function(e,t,n){"use strict";n.d(t,"b",(function(){return i}));var r=n("b8e6877859"),a=n("16c79d63a4");function i(){return new a.b(Object(r.a)())}n.d(t,"a",(function(){return a.a}))},"4c52987e8a":function(e,t,n){"use strict";n.d(t,"a",(function(){return m})),n.d(t,"c",(function(){return b})),n.d(t,"b",(function(){return y})),n.d(t,"f",(function(){return k})),n.d(t,"e",(function(){return S})),n.d(t,"d",(function(){return I}));var r=n("176815363d"),a=n.n(r),i=n("3ef2352f0b"),o=n.n(i),c=(n("a2a09da1e3"),n("1bab7b5fb7"),n("2504ad7290"),n("9d7978d445"),n("63513d8b56"),n("759492dad9"),n("3bf1976a4f"),n("34cd92f77a"),n("c6244f7705"),n("081c8cafea"),n("10f9b6de11")),s=n("8b13fcae36"),u=n("f8fc8e0087"),l=n("d9812f1c6f"),d=n("0e41c725b0"),f=n("edf90fabc3"),h=n("020899bf26"),v=n("a24c6cbd03"),p=n("aba9dcef64"),g=n("5ce71228c0");function m(){return(l.a.isTencentDocApp||l.a.isTencentDocDesktopApp||!!Object(u.getQuery)("offlineDebug"))&&!(-1!==window.location.href.indexOf("/blankpage/"))}function b(e){var t={docId:e,sourcePadType:c.DOCUMENT_TYPE.slide};g.b.setItem(g.a.BLANK_PAGE_DATA,t);var n=window.location.href;if(-1!==n.indexOf("?")&&window.location.search){var r=window.location.search,a=r.split("&");-1!==a.indexOf("new=true")&&(a.splice(a.indexOf("new=true"),1),r=a.join("&")),n="".concat(window.location.origin).concat(window.location.pathname).concat(r)}n=n.replace(/\/slide\//,"/blankpage/"),l.a.isTencentDocApp&&window.dispatchEvent(new Event("unload")),Object(s.setNewWindowUrl)(window,n)}function y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v.b,n={url:"https://".concat(location.hostname,"/slide/").concat(e),dver:t};d.e.invokeDocx("mapDocumentVersion",n)}function k(){var e=h.a.SlideAppService,t=h.a.ContentStatusManager;return new Promise((function(n){Object(f.a)([e,t],(function(e,t){t.onDocumentReady((function(){return n(e)}))}))}))}function S(){return w.apply(this,arguments)}function w(){return(w=a()(o.a.mark((function e(){var t,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.a.ClientVarsService.promise();case 2:return t=e.sent,e.next=5,k();case 5:if(!t.isLocalEdit()){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,p.a.CollaborationManager.promise();case 9:return n=e.sent,e.abrupt("return",new Promise((function(e){return n.onCollaborationReady(e)})));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(){var e=h.a.SlideAppService,t=h.a.ContentStatusManager,n=h.a.DocInfoManager;return new Promise((function(r){Object(f.a)([e,t,n],(function(e,t){t.onDocumentReady((function(){return r()}))}))}))}},"537ff5fc9e":function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var r=n("176815363d"),a=n.n(r),i=n("9132715560"),o=n.n(i),c=n("85d0a7609b"),s=n.n(c),u=n("3ef2352f0b"),l=n.n(u),d=(n("c6244f7705"),n("081c8cafea"),n("3bf1976a4f"),n("3745463185")),f=n("2f1cded8d8"),h="[OnlineEditService]",v=function e(t,n,r){var i=this;o()(this,e),s()(this,"loadDocument",a()(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(d.a)(!0),i.logger.info(h,"[load:begin]",t()),n={head:0,chunk:0,count:0,total:0},e.abrupt("return",i.fetcher.loadPresentation({onHead:function(e){var r=t(),a=r.now,o=r.last,c=r.timeline;i.logger.info(h,"[load:head]","[1/".concat(e,"]"),c),n.head=o-a},onChunk:function(e,r){var a=t(),o=a.now,c=a.last,s=a.timeline;i.logger.info(h,"[load:chunk]","[".concat(e+1,"/").concat(r,"]"),s),n.chunk+=c-o,n.count=r},onEnd:function(){i.logger.info(h,"[load:end]",t()),i.emitter.emit(f.a.LoadDocumentAllChunksSuccess,n)},onFatalError:function(e){i.logger.error(h,"[load:error]",e,t()),i.emitter.emit(f.a.LoadDocumentError,e)}}));case 4:case"end":return e.stop()}}),e)})))),this.logger=t,this.fetcher=n,this.emitter=r,this.logger.info(h,"[init]")}},"588c4a7ced":function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));n("73b854064b");var r=n("9132715560"),a=n.n(r),i=n("6a364eb35c"),o=n.n(i),c=n("bd29e2df90"),s=n.n(c),u=n("ab5eb40518"),l=n.n(u),d=n("1b4cdd6a36"),f=n.n(d);function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f()(e);if(t){var a=f()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return l()(this,n)}}var v=function(e){s()(n,e);var t=h(n);function n(){return a()(this,n),t.apply(this,arguments)}return o()(n,[{key:"init",value:function(){}}]),n}(n("7c2d7adc2c").a)},"6a1a1ac5a9":function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e[e.OldPresentationData=1]="OldPresentationData",e[e.OldPresentationChunkData=2]="OldPresentationChunkData",e[e.CommandData=3]="CommandData",e[e.CommandChunkData=4]="CommandChunkData",e[e.PresentationData=5]="PresentationData"}(r||(r={}))},"6ad6ba1542":function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));n("963f2eaace"),n("b4638a0243");var r=n("7c46f42788"),a=n("d835d04d7a"),i=n("bd5de260ae"),o=n("020899bf26");function c(e,t,n){var c,s=o.a.SDKDataServices.DataValidator(),u=null!==(c=null==s?void 0:s.validateModelData(e))&&void 0!==c?c:{},l=u.isPass,d=u.errors,f=u.cost;!function(e){var t=e.isPass,n=e.errors,o=e.dataType,c=e.cost,s=e.source;try{var u,l,d=null!==(u=null==n?void 0:n.length)&&void 0!==u?u:0,f=null!==(l=null==n?void 0:n[0])&&void 0!==l?l:{keyword:""};t?Object(i.a)("validate_error",a.a.SUCCESS,"",[o?r.a[o]:"","","",s,JSON.stringify({cost:c.toFixed(2)})]):Object(i.a)("validate_error",a.a.ERROR,JSON.stringify(null==n?void 0:n.slice(0,3)),[o?r.a[o]:"",f.keyword,"",s,JSON.stringify({cost:c.toFixed(2),errorCount:d})])}catch(e){console.error(e)}}({isPass:!!l,errors:d,dataType:n,cost:void 0===f?-1:f,source:t})}},"73d8814097":function(e,t,n){"use strict";n.d(t,"a",(function(){return S}));var r=n("7a5536c9bf"),a=n.n(r),i=n("176815363d"),o=n.n(i),c=n("9132715560"),s=n.n(c),u=n("6a364eb35c"),l=n.n(u),d=n("85d0a7609b"),f=n.n(d),h=n("3ef2352f0b"),v=n.n(h),p=(n("c6244f7705"),n("081c8cafea"),n("63513d8b56"),n("8ee19818c4"),n("a2a09da1e3"),n("bd80bf2d0f"),n("c73625d763")),g=n.n(p),m=n("668bd0ac65"),b=n("d5c3deb8c7"),y=n("e86bde4ef1"),k=n("6a1a1ac5a9"),S=function(){function e(t,n){var r,a,i,o;s()(this,e),f()(this,"fetchMaxSlideCount",5),f()(this,"startIndex",0),f()(this,"fetchQueue",[]),f()(this,"fetchingQueue",[]),f()(this,"fetchTimer",void 0),this.clientVarsService=t,this.onlineApiService=n,this.startIndex=(null!==(r=null===(a=this.firstChunkInfo)||void 0===a?void 0:a.startIndex)&&void 0!==r?r:0)+(null!==(i=null===(o=this.firstChunkInfo)||void 0===o?void 0:o.count)&&void 0!==i?i:0)}var t,n,r;return l()(e,[{key:"loadPresentation",value:(r=o()(v.a.mark((function e(){var t,n,r,a=this,i=arguments;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:{},n=new y.a,r=n.toChunksGenerator().advance(),e.abrupt("return",new Promise((function(e,i){var o,c;null===(o=t.onHead)||void 0===o||o.call(t,a.totalChunkCount),e({type:k.a.CommandChunkData,data:{head:a.getFirstChunkData(),chunks:r.init(a.totalChunkCount,null===(c=a.firstChunkInfo)||void 0===c?void 0:c.count)}}),setTimeout((function(){Object(b.r)((function(){return r.done}),(function(e){var a,o,c;e&&(null===(a=t.onEnd)||void 0===a||a.call(t,r.total),n.dispose(o),o&&(null===(c=t.onFatalError)||void 0===c||c.call(t,o),i(o)))}),{fireImmediately:!0}),a.startFetchConcurrency(n,r,t)}))})));case 4:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})},{key:"startFetchConcurrencyTimer",value:function(){var e=this;this.fetchTimer=setInterval((function(){if(e.fetchQueue.length||e.fetchingQueue.length){var t,n=e.fetchQueue.splice(0,5-e.fetchingQueue.length);if(n.length)(t=e.fetchingQueue).push.apply(t,a()(n)),n.forEach((function(t){return t((function(){return e.fetchingQueue.splice(e.fetchingQueue.indexOf(t),1)}),(function(){return clearInterval(e.fetchTimer)}))}))}else clearInterval(e.fetchTimer)}),16)}},{key:"getSlideFileJSON",value:function(e){return new m.a({presentation:e}).getCommandData()}},{key:"getFirstChunkData",value:function(){var e,t,n,r=null===(e=this.clientVarsService.getClientVars().collab_client_vars)||void 0===e?void 0:e.initialAttributedText,a=null!==(t=null==r?void 0:r.text)&&void 0!==t?t:"{}",i=(null!==(n=null==r?void 0:r.slide)&&void 0!==n?n:{isPaginated:!0}).isPaginated?{presentation:a}:JSON.parse(a);return new m.a(i).getCommandData()}},{key:"totalChunkCount",get:function(){var e,t;return null!==(e=this.firstChunkInfo)&&void 0!==e&&e.total&&1!==(null===(t=this.firstChunkInfo)||void 0===t?void 0:t.total)?1+Math.ceil((this.firstChunkInfo.total-this.firstChunkInfo.count)/this.fetchMaxSlideCount):1}},{key:"startFetchConcurrency",value:function(e,t,n){var r=this;this.startFetchConcurrencyTimer();for(var a=1;a<this.totalChunkCount;){var i=this.startIndex+(a-1)*this.fetchMaxSlideCount;this.fetchQueue.push(function(a,i){return function(o,c){r.fetchChunkData(i).then((function(i){var c,s=i.data;t.updateTotal(r.totalChunkCount),e.add(a,{commands:[r.getSlideFileJSON(s)]}),null===(c=n.onChunk)||void 0===c||c.call(n,a,r.totalChunkCount),o()})).catch((function(e){var t;c(),null===(t=n.onFatalError)||void 0===t||t.call(n,e)}))}}(a,i)),a+=1}}},{key:"firstChunkInfo",get:function(){var e,t,n;return null===(e=this.clientVarsService.getClientVars())||void 0===e||null===(t=e.collab_client_vars)||void 0===t||null===(n=t.initialAttributedText)||void 0===n?void 0:n.slide}},{key:"globalPadId",get:function(){var e,t;return null!==(e=null===(t=this.clientVarsService.getClientVars().collab_client_vars)||void 0===t?void 0:t.globalPadId)&&void 0!==e?e:""}},{key:"requestRevision",get:function(){var e;return(null===(e=this.clientVarsService.getClientVars().collab_client_vars)||void 0===e?void 0:e.rev)||0}},{key:"fetchChunkData",value:(n=o()(v.a.mark((function e(){var t,n,r,a=arguments;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:0,n=a.length>1&&void 0!==a[1]?a[1]:0,r=this.createPendingPromise(),this.fetchChunkDataByPromise(t,n,r),e.abrupt("return",r.promise);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"fetchChunkDataByPromise",value:(t=o()(v.a.mark((function e(){var t,n,r,a,i,o,c=arguments;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:0,n=c.length>1&&void 0!==c[1]?c[1]:0,r=c.length>2?c[2]:void 0,e.prev=3,e.next=6,this.onlineApiService.getChunkData({padId:this.globalPadId,startIndex:t,count:this.fetchMaxSlideCount,revisionVersion:this.requestRevision});case 6:if(a=e.sent,this.checkFetchChunkDataResult(a)){e.next=9;break}throw Error(JSON.stringify(null!==(i=a.data)&&void 0!==i?i:a));case 9:o=a.data.data,this.fetchMaxSlideCount=o.count,this.startIndex=o.count+o.start_index,r.resolve({data:o.data,isLast:o.total<=this.startIndex}),e.next=23;break;case 15:if(e.prev=15,e.t0=e.catch(3),!(n<2)){e.next=22;break}return e.next=20,new Promise((function(e){return setTimeout(e,1e3*n)}));case 20:return this.fetchChunkDataByPromise(t,n+1,r),e.abrupt("return");case 22:r.reject(e.t0.toString());case 23:case"end":return e.stop()}}),e,this,[[3,15]])}))),function(){return t.apply(this,arguments)})},{key:"checkFetchChunkDataResult",value:function(e){var t,n=null==e||null===(t=e.data)||void 0===t?void 0:t.data;return!!(g()(n,"count")&&g()(n,"data")&&g()(n,"start_index")&&g()(n,"total")&&g()(n,"revision_version"))}},{key:"createPendingPromise",value:function(){var e=function(){return[]},t=function(e){return e};return{promise:new Promise((function(n,r){e=n,t=r})),resolve:e,reject:t}}}]),e}()},"7c2d7adc2c":function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var r=n("9132715560"),a=n.n(r),i=n("6a364eb35c"),o=n.n(i),c=n("85d0a7609b"),s=n.n(c),u=(n("c6244f7705"),n("081c8cafea"),n("6a1a1ac5a9")),l=n("f9193d718f"),d=n("37091e4240"),f=function(){function e(t,n,r,i){a()(this,e),s()(this,"isEmitReady",!1),this.logger=t,this.presentationStoreService=n,this.clientVarsService=r,this.contentStatusManager=i,this.init()}return o()(e,[{key:"onReady",value:function(e){var t=this;l.a.getInstance().waitForReady((function(){t.isEmitReady||(t.isEmitReady=!0,d.b.emit(d.a.SLIDE_APP_READY,{clientVars:t.clientVarsService.getClientVars()})),e()}))}},{key:"onReadyPromise",value:function(){return new Promise(this.onReady.bind(this))}},{key:"getSnapshotData",value:function(){return{type:u.a.PresentationData,data:this.presentationStoreService.getPresentation().getCloneData()}}},{key:"transaction",value:function(e){var t,n;return null!==(t=this.presentationStoreService)&&void 0!==t&&null!==(n=t.getTransaction)&&void 0!==n&&n.call(t)?this.presentationStoreService.getTransaction()(e):e()}},{key:"getSlideCount",value:function(){var e;return null===(e=this.presentationStoreService.getPresentation())||void 0===e?void 0:e.slideList.length}},{key:"checkSlideAppStatus",value:function(){return this.contentStatusManager.getCorruptedError()}}]),e}();s()(f,"namespace","SlideAppService"),s()(f,"voidMethods",[])},"7dfd8db4f1":function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n("9132715560"),a=n.n(r),i=n("6a364eb35c"),o=n.n(i),c=n("85d0a7609b"),s=n.n(c),u=(n("826dc923b3"),function(){function e(t,n,r){var i=this;a()(this,e),s()(this,"docInfo",{}),s()(this,"visible",!0),s()(this,"clientVars",{}),s()(this,"getDocInfoPromise",void 0),s()(this,"ready",!1),this.logger=t,this.editEvent=n,this.clientVarsService=r,this.clientVars=this.clientVarsService.getClientVars(),this.getDocInfoPromise=this.getDocInfo().then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i.docInfo=e,i.ready=!0,e}))}return o()(e,[{key:"waitForReady",value:function(e){this.ready?e(this.docInfo):this.getDocInfoPromise.then(e)}},{key:"globalPadId",get:function(){return this.clientVars.globalPadId}},{key:"padId",get:function(){return this.clientVars.padId}},{key:"localPadId",get:function(){return this.clientVars.localPadId}},{key:"domainId",get:function(){return this.clientVars.domainId}},{key:"tinyid",get:function(){var e;return this.clientVars.tinyid||(null===(e=this.userInfo)||void 0===e?void 0:e.tinyid)}},{key:"subId",get:function(){return this.clientVars.subId}},{key:"userId",get:function(){return this.clientVars.userId}},{key:"ownerId",get:function(){return this.clientVars.ownerId}},{key:"userInfo",get:function(){return this.clientVars.userInfo}},{key:"creatorDomain",get:function(){return this.clientVars.creatorDomain}},{key:"pVer",get:function(){var e;return null===(e=this.clientVars.collab_client_vars)||void 0===e?void 0:e.pver}},{key:"baseRevision",get:function(){var e;return null===(e=this.clientVars.collab_client_vars)||void 0===e?void 0:e.rev}},{key:"gray",get:function(){var e;return null===(e=this.clientVars.collab_client_vars)||void 0===e?void 0:e.gray}},{key:"dirty",get:function(){var e;return null===(e=this.clientVars.collab_client_vars)||void 0===e?void 0:e.dirty}},{key:"policy",get:function(){return this.clientVars.policy}},{key:"padType",get:function(){return this.clientVars.padType}},{key:"isUserChangeTitle",get:function(){return this.clientVars.isUserChangeTitle}},{key:"collected",get:function(){return!!this.docInfo.is_collected}},{key:"setCollected",value:function(e){this.docInfo.is_collected=Number(e)}},{key:"extra",get:function(){var e,t,n,r;return{ownerNick:null===(e=this.docInfo)||void 0===e?void 0:e.owner_nick,creatorNick:null===(t=this.docInfo)||void 0===t?void 0:t.creator_nick,docURL:null===(n=this.docInfo)||void 0===n?void 0:n.doc_url,ownerUidSource:null===(r=this.docInfo)||void 0===r?void 0:r.owner_uid_source}}},{key:"isAddedMyDoc",get:function(){return this.docInfo.is_added_my}},{key:"isOwner",get:function(){return this.clientVars.isOwner}},{key:"isCreator",get:function(){return this.clientVars.isCreator}},{key:"isDeleted",get:function(){return this.clientVars.isDeleted||200405===this.clientVars.cgicode}},{key:"rightFlag",get:function(){return this.clientVars.rightFlag}},{key:"docStatus",get:function(){return this.clientVars.docStatus}},{key:"fileInfo",get:function(){return this.clientVars.fileInfo}}]),e}())},"9657b29818":function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return i}));var r=n("020899bf26"),a=function(e){var t=r.a.SDKDataServices.PresentationStoreService();return null!=t&&t.getTransaction()?t.getTransaction()(e):e()},i=function(e){return function(t){return null!=e&&e.getTransaction()?e.getTransaction()(t):t()}}},a24c6cbd03:function(e,t,n){"use strict";n.d(t,"d",(function(){return i})),n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return c})),n.d(t,"f",(function(){return s})),n.d(t,"e",(function(){return r})),n.d(t,"a",(function(){return a}));var r,a,i=100,o="3.0.0",c=2147483647,s="BB08J2";!function(e){e[e.LAUNCHING=9990]="LAUNCHING",e[e.LAUNCHED=9991]="LAUNCHED",e[e.USE_OFFLINE=9992]="USE_OFFLINE",e[e.USE_ONLINE=9993]="USE_ONLINE",e[e.USE_OFFLINE_CREATE=9994]="USE_OFFLINE_CREATE",e[e.REMOVE_CS=9995]="REMOVE_CS",e[e.APPLY_OFFLINE_DATA_START=9996]="APPLY_OFFLINE_DATA_START",e[e.APPLY_OFFLINE_DATA_END=9997]="APPLY_OFFLINE_DATA_END",e[e.FETCH_FAIL=9998]="FETCH_FAIL"}(r||(r={})),function(e){e[e.listTypeOffline=-1]="listTypeOffline",e[e.listTypeAll=1]="listTypeAll",e[e.listTypeCreated=2]="listTypeCreated",e[e.listTypeTrash=3]="listTypeTrash",e[e.listTypeShared=4]="listTypeShared",e[e.listTypeMyDoc=5]="listTypeMyDoc",e[e.listTypeRecent=6]="listTypeRecent",e[e.listTypeStared=7]="listTypeStared",e[e.listTypeInSharedFolder=9]="listTypeInSharedFolder"}(a||(a={}))},a36ca9e6bd:function(e,t,n){"use strict";n.d(t,"a",(function(){return q}));var r=n("176815363d"),a=n.n(r),i=n("9132715560"),o=n.n(i),c=n("6a364eb35c"),s=n.n(c),u=n("85d0a7609b"),l=n.n(u),d=n("3ef2352f0b"),f=n.n(d),h=(n("8ee19818c4"),n("c6244f7705"),n("bd80bf2d0f"),n("968ee3f7e6"),n("6e20b6a7d8"),n("081c8cafea"),n("8a35b54c1d"),n("a5bb88f217")),v=n("225da3354c"),p=n("16c79d63a4"),g=n("6ef42ff901"),m=n("ea9a0f51b9"),b=n("8d9554480f"),y=n("668bd0ac65"),k=n("fdddc95d9b"),S=n("a5f49151bb"),w=n("711a53c9fc"),I=n("420d598ff9"),D=n("262843d1f7"),O=n("7c46f42788"),C=n("bb096e3c53"),x=n("025e3e9b74"),P=n("fe82ecf3fc"),E=n("0fbb1a6af6"),T=n("6a1a1ac5a9"),A=n("44b54bfb86"),_=n("29112c2c27"),M=n("1ce94b3b3e"),L=n("020899bf26"),N=n("4a351e9268"),R=n("1af4b2dbf4"),j=n("f9193d718f"),U=n("04c5c76777"),F=n.n(U),B=n("37091e4240"),V=n("d9812f1c6f"),q=function(){function e(t,n,r,a,i,c,s,u,d){o()(this,e),l()(this,"presentation",void 0),l()(this,"transaction",void 0),this.initialDataService=t,this.contentStatusManager=n,this.mutationManager=r,this.event=i,this.docInfoProvider=c,this.logger=u,this.operationLogger=d,this.transaction=Object(h.a)(this.event),this.addEventListeners();var f=this.initialDataService.consume(),v=f.type,p=f.data;v===T.a.PresentationData?this.initFromData(p):v===T.a.CommandChunkData?this.initFromChunksGenerator(p.head,p.chunks):v===T.a.CommandData?this.initFromCommandData(p):v===T.a.OldPresentationData?this.migrateFromOldPresentationData(p):v===T.a.OldPresentationChunkData&&(this.initialDataService.setData({type:v,data:p}),this.dispose())}var t,n;return s()(e,[{key:"getPresentation",value:function(){if(!this.presentation)throw Error("You should initPresentation before getPresentation");return this.presentation}},{key:"createFromData",value:function(t){var n=this,r=new v.a,a=new A.a({type:T.a.PresentationData,data:t}),i=new p.b,o=new g.a(r,this.logger,(function(){return n.docInfoProvider})),c=new m.a(r),s=new b.a(r);return new e(a,i,o,c,r,this.docInfoProvider,s,this.logger)}},{key:"createFromCommandData",value:function(t){var n=this,r=new v.a,a=new A.a({type:T.a.CommandData,data:t}),i=new p.b,o=new g.a(r,this.logger,(function(){return n.docInfoProvider})),c=new m.a(r),s=new b.a(r);return new e(a,i,o,c,r,this.docInfoProvider,s,this.logger)}},{key:"createFromChunksGenerator",value:function(t,n){var r=this,a=new v.a,i=new A.a({type:T.a.CommandChunkData,data:{head:t,chunks:n}}),o=new p.b,c=new g.a(a,this.logger,(function(){return r.docInfoProvider})),s=new m.a(a),u=new b.a(a);return new e(i,o,c,s,a,this.docInfoProvider,u,this.logger)}},{key:"createFromOldPresentationData",value:function(e){return this.createFromData(Object(M.b)(JSON.parse(e)))}},{key:"createFromSlideFileData",value:function(e){return this.createFromCommandData(new y.a(e).getCommandData())}},{key:"applyRevisionData",value:function(e){var t=this;e.forEach((function(e){var n;null===(n=N.a.fromBufferOrBase64(e).getRevisionData().commands)||void 0===n||n.forEach((function(e){t.applyCommandData(e,k.a.Collaborator)}))}))}},{key:"applyCommandData",value:function(e,t){var n=this;try{var r;if(null===(r=e.mutations)||void 0===r||!r.length)return;var a=R.a.fromMutationData(e.mutations).getMutations();this.logger.info("[applyCommandData], mutationSource: ",t),this.transaction((function(){return n.mutationManager.enqueue(a,t).apply()}))}catch(e){throw this.logger.error("[applyCommandData] mutationSource: ",t,"err",e.toString()),e}}},{key:"applyMutations",value:function(e,t){var n=this,r=[];try{this.transaction((function(){n.mutationManager.enqueue(e,t).apply(),r=e.map((function(e){return n.mutationManager.getInvertedMutation(e)})).reverse().flat()}))}catch(e){throw this.logger.error("[applyMutation] err: ",e,", mutationSource: ",t),e}return r}},{key:"getSerializedPresentationData",value:function(){return y.a.fromPresentationData(this.presentation.store.data).getData()}},{key:"getSerializedPresentationDataByWorker",value:(n=a()(f.a.mark((function e(){var t,n,r,a,i=arguments;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=i.length>0&&void 0!==i[0]?i[0]:this.presentation.getWritableOwnedData(),e.next=3;break;case 3:return e.next=5,L.a.SlideFileManager.promise();case 5:return n=e.sent,e.next=8,n.recent();case 8:if(!(r=e.sent)){e.next=15;break}return e.next=12,r.slideFile.fromPresentationData(t);case 12:return a=e.sent,n.recentBack(r),e.abrupt("return",a.data);case 15:return e.abrupt("return",this.getSerializedPresentationData());case 16:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getSerializedPresentationDataWithPage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.presentation.getWritableOwnedData();return y.a.fromPresentationData(e,!0).getData()}},{key:"getSerializedPresentationDataWithPageByWorker",value:(t=a()(f.a.mark((function e(){var t,n,r,a,i=arguments;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=i.length>0&&void 0!==i[0]?i[0]:this.presentation.getWritableOwnedData(),e.next=3;break;case 3:return e.next=5,L.a.SlideFileManager.promise();case 5:return n=e.sent,e.next=8,n.recent();case 8:if(!(r=e.sent)){e.next=15;break}return e.next=12,r.slideFile.fromPresentationData(t,!0);case 12:return a=e.sent,n.recentBack(r),e.abrupt("return",a.data);case 15:return e.abrupt("return",this.getSerializedPresentationDataWithPage());case 16:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getPresentationKeyFrame",value:function(){return R.a.fromValidMutationData(Object(S.a)(this.presentation.store.data)).getMutationData()}},{key:"getPresentationSnapShotData",value:function(){return{object:this.getPresentation().getOwnedData()}}},{key:"dispose",value:function(){this.presentation.dispose(),this.event.dispose()}},{key:"getMutationManager",value:function(){return this.mutationManager}},{key:"getTransaction",value:function(){return this.transaction}},{key:"initFromData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getDefaultPresentationData();return this.init(e),this.contentStatusManager.emitter.emit(p.a.LoadAllChunksSuccess),this}},{key:"initFromCommandData",value:function(e){return this.init(this.getDefaultPresentationData()),this.applyCommandData(e,k.a.Keyframe),this.contentStatusManager.emitter.emit(p.a.LoadAllChunksSuccess),this}},{key:"migrateFromOldPresentationData",value:function(e){var t=Object(M.b)(JSON.parse(e));return this.initFromData(t)}},{key:"initFromChunksGenerator",value:function(e,t){var n,r=this;this.init(this.getDefaultPresentationData());var i=null!==(n=t.total)&&void 0!==n?n:65536,o=[{commands:[e]}],c=0,s=function(e){r.logger.error("[initFromChunksGenerator] load chunk err:",e),r.contentStatusManager.emitter.emit(p.a.LoadError,e)},u=function(e){o.length>0&&(r.transaction((function(){var n=F()(o.map((function(e){return e.commands.map((function(e){var t;return R.a.fromMutationData(null!==(t=e.mutations)&&void 0!==t?t:[]).getValidMutationData()}))}))),a=n.filter((function(e){return e.type===w.c.SetPageProperties&&e.pageType===w.Q.slide})).map((function(e){return e.pageId}));r.mutationManager.enqueue(Object(I.a)(n),k.a.Keyframe),r.mutationManager.apply(),r.updateSlideLoadingState(!!e,i,t.fullPageCount,a)})),o=[])};try{u(!0)}catch(e){return s(e),this}this.contentStatusManager.emitter.emit(p.a.LoadHeadSuccess);var l=function(){var e=a()(f.a.mark((function e(){var n,r,a,s,l,d;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0,c=performance.now(),r=_.a.AlreadyCreate;case 3:if(!(n<i)){e.next=24;break}return e.next=6,t.next();case 6:if(a=e.sent,s=a.done,l=a.chunk,d=a.docCreateStatus,l&&o.push(l),!(performance.now()-c>=16||o.length>=Infinity||s)){e.next=16;break}return u(),e.next=15,new Promise((function(e){return setTimeout(e)}));case 15:c=performance.now();case 16:if(!s){e.next=19;break}return r=d,e.abrupt("break",24);case 19:if(!((n+=1)>=i)){e.next=22;break}throw new Error("Exceed max chunks limit.");case 22:e.next=3;break;case 24:return e.abrupt("return",r);case 25:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),d=function(){l().then((function(e){e===_.a.AlreadyCreate?r.contentStatusManager.emitter.emit(p.a.LoadAllChunksSuccess):B.b.on(B.a.DOC_CREATED_SUCCESS,(function(){r.contentStatusManager.emitter.emit(p.a.LoadAllChunksSuccess)}))})).catch((function(e){s(e)}))};return V.a.isMobile?B.b.onIncludingPast(B.a.ALL_THUMBNAIL_SITE_COMPLETE,(function(){d()})):d(),this}},{key:"getDefaultPresentationData",value:function(){return{id:(new D.b).next(),type:O.a.Presentation,version:E.b,slideList:[],layoutMap:{},noteSlideMap:{},notesMasterMap:{},masterList:[],themeList:[],sectionMap:{},resourceMap:{images:{},videos:{},audios:{},fonts:{}},sldSz:{cx:12192e3,cy:6858e3,type:w.jb.screen16x9},notesSz:{cx:6858e3,cy:9144e3},showSpecialPlsOnTitleSld:!1}}},{key:"init",value:function(e){var t,n,r,a=this;this.presentation||(this.presentation=new C.a(e,this.event),this.presentation.attach(),this.mutationManager.registerPresentation(this.presentation),null!==(t=this.operationLogger)&&void 0!==t&&t.init&&(null===(n=this.operationLogger)||void 0===n||null===(r=n.init)||void 0===r||r.call(n,this.presentation),j.a.getInstance().waitForReady((function(e){var t,n,r=null===(t=(n=e).getUiDataService)||void 0===t?void 0:t.call(n);r&&(r.operationLogger=a.operationLogger)}))))}},{key:"addEventListeners",value:function(){var e=this;this.event.on(x.e.Edit,(function(){e.contentStatusManager.emitter.emit(p.a.EditorOperation)})),this.event.on(x.b.UndoRedoChange,(function(t){var n=t.source;n===P.b.Redo?e.contentStatusManager.emitter.emit(p.a.EditorRedo):n===P.b.Undo&&e.contentStatusManager.emitter.emit(p.a.EditorUndo)}))}},{key:"updateSlideLoadingState",value:function(e,t,n,r){var a=this;if(e&&1!==t){if(!this.getPresentation().slideList.length)return;this.getPresentation().slideList.forEach((function(e,t){return t<=n-1?e.changeLoadingState(!1):e.changeLoadingState(!0)}))}else r.forEach((function(e){var t=a.getPresentation().getSlideById(e);null==t||t.changeLoadingState(!1)}))}}]),e}()},ab1cbad497:function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e.Load="load",e.Save="save"}(r||(r={}))},aba9dcef64:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("9cd4e1be22"),a=n("020899bf26"),i=Object(r.c)((function(){var e=Object(r.d)().dependsOn([a.a.Infra.Logger]),t=Object(r.d)().dependsOn([a.a.ClientVarsService,e,a.a.Infra.Logger]),n=Object(r.d)().dependsOn([a.a.Infra.Logger,t,a.a.EventManager]),i=Object(r.d)().dependsOn([a.a.ClientVarsService,e,a.a.SDKDataServices.EventManager]),o=Object(r.d)().dependsOn([a.a.Infra.Logger,a.a.SDKDataServices.EventManager,a.a.DocInfoManager]),c=Object(r.d)().dependsOn([a.a.SDKDataServices.PresentationStoreService,a.a.ClientVarsService,a.a.ContentStatusManager,o,a.a.SDKDataServices.EventManager,a.a.Infra.Logger,a.a.PrivilegeManager]);return{OnlineEditDataFetcher:t,OnlineEditService:n,OnlineApiService:e,UserManager:i,CollaborationManager:c,CooperationLockManager:Object(r.d)().dependsOn([a.a.ClientVarsService,a.a.SDKDataServices.PresentationStoreService,i,c,a.a.EventManager,a.a.SDKDataServices.EventManager,a.a.Infra.Logger]),CollaboratorUserManager:Object(r.d)().dependsOn([a.a.SDKDataServices.EventManager]),CursorManager:Object(r.d)().dependsOn([a.a.ClientVarsService,i,a.a.EventManager,a.a.SDKDataServices.EventManager,a.a.Infra.Logger]),OnlineEditNoticeManager:Object(r.d)().dependsOn([a.a.Infra.Logger,a.a.SDKDataServices.EventManager,a.a.EventManager,a.a.ContentStatusManager]),OTTransformManager:o,OnlineEditReporter:Object(r.d)().dependsOn([a.a.Infra.Logger,a.a.ClientVarsService,a.a.States.SlideCountState,a.a.EventManager])}}))},bb9a224484:function(e,t,n){"use strict";n.d(t,"a",(function(){return S}));n("73b854064b");var r=n("176815363d"),a=n.n(r),i=n("9132715560"),o=n.n(i),c=n("6a364eb35c"),s=n.n(c),u=n("bd29e2df90"),l=n.n(u),d=n("ab5eb40518"),f=n.n(d),h=n("1b4cdd6a36"),v=n.n(h),p=n("3ef2352f0b"),g=n.n(p),m=(n("c6244f7705"),n("081c8cafea"),n("bd80bf2d0f"),n("7dfd8db4f1")),b=n("aba9dcef64"),y=n("2f1cded8d8");function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var a=v()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return f()(this,n)}}var S=function(e){l()(i,e);var t,n,r=k(i);function i(e,t,n){var a;return o()(this,i),(a=r.call(this,e,t,n)).logger=e,a.editEvent=t,a.clientVarsService=n,a.visible=12!==a.clientVarsService.getClientVars().docStatus,a}return s()(i,[{key:"setDocVisible",value:(n=a()(g.a.mark((function e(){var t,n,r,a,i,o;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.visible){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,b.a.OnlineApiService.promise();case 4:return t=e.sent,n=t.transDocVisible,e.prev=6,e.next=9,n(null!==(r=this.domainId)&&void 0!==r?r:"",null!==(a=this.padId)&&void 0!==a?a:"");case 9:if(null!=(i=e.sent)&&i.data){e.next=12;break}throw new Error("set doc visible failed");case 12:0===i.data.retcode&&(this.visible=!0,null===(o=window.SLR)||void 0===o||o.dispatch("DOC_HUMTRANS_DONE")),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(6),this.logger.error("[app] set doc visible failed, error: ".concat(e.t0.message)),this.editEvent.emit(y.a.SetVisibleFailed);case 19:case"end":return e.stop()}}),e,this,[[6,15]])}))),function(){return n.apply(this,arguments)})},{key:"getDocInfo",value:(t=a()(g.a.mark((function e(){var t,n,r,a,i,o,c;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.OnlineApiService.promise();case 2:return t=e.sent,n=this.clientVars,r=n.domainId,a=void 0===r?"":r,i=n.padId,o=void 0===i?"":i,e.prev=4,e.next=7,t.getDocInfo({domainId:a,localPadId:o,getCollected:1,getIsAddedMy:1});case 7:return c=e.sent,e.abrupt("return",c.data);case 11:e.prev=11,e.t0=e.catch(4),this.logger.error("fetch doc info failed",e.t0),this.editEvent.emit(y.a.LoadDocInfoError,null===e.t0||void 0===e.t0?void 0:e.t0.toString());case 15:return e.abrupt("return",{});case 16:case"end":return e.stop()}}),e,this,[[4,11]])}))),function(){return t.apply(this,arguments)})}]),i}(m.a)},d5bbe52ca5:function(e,t,n){"use strict";var r=n("6ab2696dd0"),a=n.n(r),i=n("176815363d"),o=n.n(i),c=n("0cf3719522"),s=n.n(c),u=n("3ef2352f0b"),l=n.n(u),d=(n("c6244f7705"),n("081c8cafea"),n("8e7cce0ada"),n("85d48ef22b"),n("2a6f332b5e"),n("3bf1976a4f"),n("af802ec74b"),n("05d181ac40")),f=n("d9812f1c6f"),h=n("f8fc8e0087"),v=n("47283d181a"),p=n("020899bf26"),g=n("f2f4fc4fa9"),m=n("9cd4e1be22"),b=n("b8e6877859"),y=n("0fbb1a6af6"),k=n("44b54bfb86"),S=n("03c2478429"),w=n("ed31fcfdd0");var I,D=n("9132715560"),O=n.n(D),C=n("85d0a7609b"),x=n.n(C);!function(e){e[e.LocalEditServiceInit=0]="LocalEditServiceInit",e[e.LoadDocumentStart=1]="LoadDocumentStart",e[e.LoadDocumentHeadSuccess=2]="LoadDocumentHeadSuccess",e[e.LoadDocumentChunkReceived=3]="LoadDocumentChunkReceived",e[e.LoadDocumentAllChunksSuccess=4]="LoadDocumentAllChunksSuccess",e[e.LoadDocumentError=5]="LoadDocumentError",e[e.LoadDocumentPasswordRequired=6]="LoadDocumentPasswordRequired",e[e.LoadDocumentPasswordInvalid=7]="LoadDocumentPasswordInvalid",e[e.LoadDocumentUseNativePassword=8]="LoadDocumentUseNativePassword",e[e.SlideAppInitSuccess=9]="SlideAppInitSuccess",e[e.SlideAppDataError=10]="SlideAppDataError",e[e.SaveDocumentBegin=11]="SaveDocumentBegin",e[e.SaveDocumentSuccess=12]="SaveDocumentSuccess",e[e.SaveDocumentError=13]="SaveDocumentError",e[e.DocumentInfoChanged=14]="DocumentInfoChanged"}(I||(I={}));var P,E=n("ab1cbad497"),T="[LocalEditNoticeManager]",A=function e(t,n,r){var a=this;O()(this,e),x()(this,"passwordModalControl",void 0),this.logger=t,this.mqq=n,this.emitter=r,this.emitter.on(I.LoadDocumentPasswordRequired,(function(e){a.logger.info(T,"PasswordModal","show()"),S.a.UI.PasswordModal.promise().then((function(t){a.passwordModalControl=t.show({onPasswordSubmit:function(t){a.logger.info(T,"PasswordModal","continueWithPassword()"),e(t)},onCancel:function(){a.mqq.invoke("ui","closeTab")}})}))})),this.emitter.on(I.LoadDocumentPasswordInvalid,(function(){var e;a.logger.info(T,"PasswordModal","showPasswordError()"),null===(e=a.passwordModalControl)||void 0===e||e.showPasswordInvalidError()})),this.emitter.on(I.LoadDocumentUseNativePassword,(function(e,t){a.logger.info(T,"NativePasswordModal","show()"),a.mqq.invoke("docx","notifyLocalFilePasswordError",{errorCode:e},(function(e){a.logger.info(T,"NativePasswordModal","continueWithPassword()"),t(null==e?void 0:e.password)}))})),this.emitter.on(I.LoadDocumentAllChunksSuccess,(function(){var e,t;a.logger.info(T,"PasswordModal","close()"),null===(e=a.passwordModalControl)||void 0===e||null===(t=e.close)||void 0===t||t.call(e)})),this.emitter.on(I.LoadDocumentError,(function(e){S.a.UI.ConvertErrorModal.promise().then((function(t){t.show({error:e,stage:E.a.Load})}))})),this.emitter.on(I.SlideAppDataError,(function(e){a.logger.info(T,"SlideAppDataError","error.stack",null==e?void 0:e.stack),S.a.UI.ConvertErrorModal.promise().then((function(t){t.show({error:e,stage:E.a.Load})}))})),this.emitter.on(I.SaveDocumentError,(function(e,t){S.a.UI.ConvertErrorModal.promise().then((function(n){var r;n.show({error:e,stage:E.a.Save,retry:(r=o()(l.a.mark((function e(n){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.a.LocalEditManager.promise();case 2:return r=e.sent,e.next=5,r.save(null!=n?n:t);case 5:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})})}))}))},_=(n("73b854064b"),n("7a5536c9bf")),M=n.n(_),L=n("6a364eb35c"),N=n.n(L),R=n("547611bd96"),j=n.n(R),U=n("bd29e2df90"),F=n.n(U),B=n("ab5eb40518"),V=n.n(B),q=n("1b4cdd6a36"),H=n.n(q),K=n("2dc700e1e6"),W=n.n(K),G=(n("6e20b6a7d8"),n("963f2eaace"),n("759492dad9"),n("8a35b54c1d"),n("b8217400dc"),n("e6f68cdf2e"),n("0acdc5834b"),n("c554310b5c"),n("d5c3deb8c7")),Y=n("2a81537ef9"),Q=n("16c79d63a4"),J=n("f986b6f97c"),z=n("fccb99d836"),X=n("3c18de0668"),$=n("6f5cb1d8ac"),Z=n("668bd0ac65"),ee=n("5fac0349d3"),te=n("3745463185"),ne=n("3825cc7c15"),re=n("f9193d718f"),ae=n("db0c73f5df"),ie="[LocalEditManager]",oe=function(){function e(t,n,r,a,i,c){var s=this;O()(this,e),x()(this,"client",$.a.create({docx:Object($.b)(),media:Object($.b)()},d.a.IS_MOBILE_LOCAL_EDIT)),x()(this,"editChannelPromise",void 0),x()(this,"isSavingNotice",!1),x()(this,"isInitialSync",!0),x()(this,"useEditChannel",(function(){return s.editChannelPromise||(s.editChannelPromise=s.client.docx.edit({globalPadId:s.context.getGlobalPadId(),docType:Y.c.Slide})),s.editChannelPromise.catch((function(e){s.logger.error(ie,"failed to create edit channel:",Object(te.b)(e))})),s.editChannelPromise})),x()(this,"processSaveTask",function(){var e=o()(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(te.a)(),s.logger.info(ie,"[save:begin]",n()),e.next=4,s.serializePresentationData();case 4:return r=e.sent,s.logger.info(ie,"[save:serialize]",n()),e.next=8,s.service.saveDocument(r,t);case 8:document.dispatchEvent(new CustomEvent("local_edit_document_saved")),s.saveSsrData(t);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.logger=t,this.context=n,this.emitter=r,this.service=a,this.contentStatusManager=i,this.snackbar=c,this.emitter.on(I.SlideAppInitSuccess,(function(){s.init(),s.notifyResult()})),this.emitter.on(I.LoadDocumentAllChunksSuccess,(function(){Object(p.b)((function(){return setTimeout((function(){return s.saveSsrData(Y.s.AutoSave)}))}))})),this.emitter.on(I.SlideAppDataError,(function(e){s.notifyResult(e)})),this.emitter.on(I.LoadDocumentError,(function(e){s.notifyResult(e)})),this.emitter.on(I.DocumentInfoChanged,this.onDocumentInfoChanged.bind(this)),this.contentStatusManager.onDocumentStatusChange((function(e){s.logger.info(ie,"DocumentStatus ->",e),s.updateContentStatus()})),this.contentStatusManager.onResourceStatusChange((function(e){s.logger.info(ie,"ResourceStatus ->",e),s.updateContentStatus()}));var u=!1;Object(G.r)((function(){return s.getEditingStateManager().hasUnsavedTextContent}),(function(e){s.logger.info(ie,"TextUnsavedState ->",e),e!==u&&(s.contentStatusManager.emitter.emit(e?Q.a.ResourceSyncBegin:Q.a.ResourceSyncEnd),u=e)}),{fireImmediately:!0})}var t,n,r;return N()(e,[{key:"save",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y.s.Save;return this.logger.info(ie,"[save:recv]","->",e),this.addSaveTask(e)}},{key:"saveAs",value:function(){return this.save(Y.s.SaveAs)}},{key:"downloadImage",value:function(e){return this.client.media.downloadImage({globalPadId:this.context.getGlobalPadId(),url:e,xsrf:Object(ae.b)(),localFilePath:this.context.getLocalFilePath()})}},{key:"onDocumentInfoChanged",value:function(e,t,n){var r;this.logger.info(ie,"[document-info:change]",{newTitle:t,newPath:e,newGlobalPadId:n}),null===(r=p.a.SlideTitleManager())||void 0===r||r.updateTitle(t);var a=Object(ne.a)(location.href,{title:encodeURIComponent(t),localFilePath:encodeURIComponent(e),globalPadId:encodeURIComponent(n)});a.includes("recoveredType")&&(a=Object(ne.e)(a,"recoveredType")),a.includes("templatePath")&&(a=Object(ne.e)(a,"templatePath")),history.pushState({},"",a)}},{key:"getEditorInstance",value:function(){return this.getAppServices().viewableServiceLayer.editorInstanceService.getEditorInstance()}},{key:"getEditingStateManager",value:function(){return this.getAppServices().viewableServiceLayer.editingStateManager}},{key:"getAppServices",value:function(){return re.a.getInstance().getAppServices()}},{key:"updateContentStatus",value:(r=o()(l.a.mark((function e(){var t,n,r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.contentStatusManager.getDocumentStatus(),n=this.contentStatusManager.getResourceStatus(),e.next=4,this.useEditChannel();case 4:if(r=e.sent,t===Q.c.Modified||t===Q.c.Sync){e.next=7;break}return e.abrupt("return");case 7:if(t!==Q.c.Sync||!this.isInitialSync){e.next=11;break}return this.isInitialSync=!1,this.context.getTemplatePath()&&r.publish(Y.h.ContentModified,!0),e.abrupt("return");case 11:a=t===Q.c.Modified||n!==Q.d.Sync,this.logger.info(ie,"ContentModified ->",a),r.publish(Y.h.ContentModified,a);case 14:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"addSaveTask",value:function(e){var t,n=this;if(e===Y.s.AutoSave)return this.processSaveTask(e);if(null===(t=this.getEditorInstance())||void 0===t||t.triggerSave(),this.contentStatusManager.getDocumentStatus()===Q.c.Syncing&&!this.isSavingNotice){this.isSavingNotice=!0,this.snackbar.show({message:ee.a.t("正在保存文档，请稍候..."),autoClose:!0,duration:1e3}),setTimeout((function(){n.isSavingNotice=!1}),1e3)}var r=this.contentStatusManager.addDocumentSyncingTask((function(){return n.processSaveTask(e)}));return r.catch((function(e){n.logger.error(ie,"failed to save document:",Object(te.b)(e))})),r}},{key:"serializePresentationDataByWorker",value:(n=o()(l.a.mark((function e(){var t,n,r,a,i,o,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.SlideFileManager.promise();case 2:return t=e.sent,e.next=5,p.a.SDKDataServices.PresentationStoreService.promise();case 5:return n=e.sent,r=n.getPresentation().getWritableOwnedData(),e.next=9,t.recent();case 9:if(!(a=e.sent)){e.next=18;break}return i=a.slideFile,e.next=14,i.fromPresentationData(r);case 14:return o=e.sent,c=o.data,t.recentBack(a),e.abrupt("return",JSON.stringify(c));case 18:return e.abrupt("return",this.serializePresentationData());case 19:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"serializePresentationData",value:(t=o()(l.a.mark((function e(){var t,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.SDKDataServices.PresentationStoreService.promise();case 2:return t=e.sent,n=t.getPresentation().getWritableOwnedData(),r=Z.a.fromPresentationData(n).getData(),e.abrupt("return",JSON.stringify(r));case 6:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})},{key:"saveSsrData",value:function(e){var t=this.getSsrData();t&&this.client.docx.saveSsrData({globalPadId:this.context.getGlobalPadId(),localFilePath:this.context.getLocalFilePath(),docType:Y.c.Slide,title:this.context.getTitle(),data:t},e)}}]),e}();!function(e){e.SaveData="localEditSaveData",e.PictureShare="localFileToPictureShare",e.Presentation="presentation"}(P||(P={}));var ce,se,ue,le=function(){function e(t){O()(this,e),this.mqq=t}return N()(e,[{key:"notifyLoadResult",value:function(e){this.mqq.invoke("docx","notifyOpenLocalFileResult",e)}},{key:"notifySaveResult",value:function(e){this.mqq.invoke("docx","localFileSaveResult",e)}},{key:"closeUploadNoticebar",value:function(){this.mqq.invoke("docx","closeNoticeBar4LocalToDrive")}},{key:"registerCustomEvents",value:function(e){var t=this;this.mqq.invoke("docx","registerCustomEvents",{},(function(n){var r,a,i,o,c,s,u;switch(null==n?void 0:n.eventName){case P.SaveData:null==e||null===(r=e.onSaveData)||void 0===r||r.call(e,{actionType:null!==(a=null==n||null===(i=n.options)||void 0===i?void 0:i.actionType)&&void 0!==a?a:""});break;case P.PictureShare:null==e||null===(o=e.onPictureShare)||void 0===o||o.call(e);break;case P.Presentation:null==e||null===(c=e.onPresentation)||void 0===c||c.call(e,{actionType:null!==(s=null==n||null===(u=n.options)||void 0===u?void 0:u.actionType)&&void 0!==s?s:"",onFinish:function(){return t.onPresentationFinish()}})}}))}},{key:"onPresentationFinish",value:function(){this.mqq.invoke("docx","onPresentationFinish")}}]),e}(),de=n("e0e8dd9366");function fe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=H()(e);if(t){var a=H()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return V()(this,n)}}var he=(ce=Reflect.metadata("design:type",Function),se=Reflect.metadata("design:paramtypes",[]),ue=function(e){F()(n,e);var t=fe(n);function n(){var e;O()(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a)),x()(j()(e),"api",new le(window.mqq)),e}return N()(n,[{key:"init",value:function(){var e=this;this.api.registerCustomEvents({onSaveData:function(t){var n=t.actionType;e.contentStatusManager.getDocumentStatus()!==Q.c.Sync?e.save().then((function(){var t,r;e.api.notifySaveResult({actionType:n,success:!0}),null===(t=e.getEntryStateService())||void 0===t||null===(r=t.exitEditMode)||void 0===r||r.call(t)})).catch((function(){e.api.notifySaveResult({actionType:n,success:!1})})):setTimeout((function(){var t,n;null===(t=e.getEntryStateService())||void 0===t||null===(n=t.exitEditMode)||void 0===n||n.call(t)}),300)},onPictureShare:function(){var t;null===(t=e.getExportImageManager())||void 0===t||t.exportImage({appShare:!0})},onPresentation:function(t){var n,r=t.actionType,a=t.onFinish;if("start"===r)null===(n=e.getOpenClientApiManager())||void 0===n||n.playPresentation({onFinish:a});else if("exit"===r){var i;null===(i=e.getOpenClientApiManager())||void 0===i||i.exitPresentation()}}}),Object(G.y)((function(){return e.hideNoticebar}),(function(){return e.api.closeUploadNoticebar()}))}},{key:"notifyResult",value:function(e){var t;e?this.api.notifyLoadResult({errorCode:null!==(t=e.code)&&void 0!==t?t:Y.p.ErrorUnknown,errorMsg:e.message}):this.api.notifyLoadResult({errorCode:0,errorMsg:""})}},{key:"getSsrData",value:function(){var e,t,n=this;if(!f.a.isAndroid||!Object(f.f)("3.8.0"))return"";var r=this.getAppServices(),a=r.getUiDataService(),i=null===(e=r.viewableServiceLayer)||void 0===e?void 0:e.selectionService,o=null==i||null===(t=i.slides)||void 0===t?void 0:t.length;if(0===o)return"";var c=a.presentation.props,s=c.slideWidth,u=c.slideHeight,l=r.viewableServiceLayer,d=function(e,t,o){var c,s=n.deepTraverseUiModelAndFilter(e,t,o),u=new X.a(s,null,1,(function(){return 1}),"list",!1,!1,r.getInfrastructureService(),a,void 0,void 0,i,l,void 0),d=u.getApplication().collectRawRenderData();return null==u||null===(c=u.destroyLayer)||void 0===c||c.call(u),d},h=a.presentation.children,v=h.slice(0,1).map((function(e){return d(e)})),p=h.slice(1,Math.min(3,h.length)).map((function(e){return d(e,[],!0)})),g=h.map((function(e,t){return'<canvas id="slide-canvas-'.concat(t,'" class="pre-page-canvas"></canvas>')})).join(""),m={slideInfo:{slideWidth:s,slideHeight:u,slideCount:o},slideRenderData:[].concat(M()(v),M()(p))};return'<div id="preTempSlide"><div id="temp-slide-area"></div></div><div id="previewSlide" class="pre-page-slide-bg">'.concat(g,"</div><script>renderData = ").concat(JSON.stringify(m),";ssrVersion='canvas-").concat("20240827-1500","';<\/script>")}},{key:"getAppServices",value:function(){return re.a.getInstance().getAppServices()}},{key:"deepTraverseUiModelAndFilter",value:function(e,t,n){var r=this;return this.shouleRenderElement(e,t,n)?(e.children&&e.children.length>0&&(e.children=e.children.map((function(e){return r.deepTraverseUiModelAndFilter(e,t,n)})).filter((function(e){return null!==e}))),e):null}},{key:"shouleRenderElement",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0;if(e.type===de.d.SLIDE)return!0;var r,a,i=e;if([de.d.IMAGE].concat(M()(t)).includes(i.type))return!1;if("number"==typeof i.props.style.width&&i.props.style.width<60)return!1;if("number"==typeof i.props.style.height&&i.props.style.height<60)return!1;if(n&&(null!==(r=null===(a=i.paragraphList)||void 0===a?void 0:a.reduce((function(e,t){var n=t.textRuns.reduce((function(e,t){return t.text.length+e}),0);return n+e}),0))&&void 0!==r?r:0)>20)return!1;return!0}},{key:"getEntryStateService",value:function(){return this.getAppServices().viewableServiceLayer.entryStateService}},{key:"getExportImageManager",value:function(){return this.getAppServices().viewableServiceLayer.exportImageManager}},{key:"getOpenClientApiManager",value:function(){return this.getAppServices().viewableServiceLayer.openClientApiManager}},{key:"hideNoticebar",get:function(){var e=J.a.isPlaying,t=J.a.isEditing,n=z.a.isExportingToImage;return t||e||n}}]),n}(oe),W()(ue.prototype,"hideNoticebar",[G.f,ce,se],Object.getOwnPropertyDescriptor(ue.prototype,"hideNoticebar"),ue.prototype),ue);function ve(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=H()(e);if(t){var a=H()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return V()(this,n)}}var pe,ge=function(e){F()(n,e);var t=ve(n);function n(){return O()(this,n),t.apply(this,arguments)}return N()(n,[{key:"init",value:function(){var e=this;this.useEditChannel().then((function(t){t.subscribe(Y.h.Save,(function(t){var n=t.saveType;e.save(n)}))}))}},{key:"notifyResult",value:function(){}},{key:"getSsrData",value:function(){}}]),n}(oe),me=(n("bd80bf2d0f"),n("75563bc376"),n("8ee19818c4"),n("7c46f42788")),be=n("711a53c9fc"),ye=n("570b26a0fa"),ke=function(){function e(){O()(this,e),x()(this,"traceId",0),x()(this,"initAt",Date.now())}var t,n;return N()(e,[{key:"getLocalEditServicesRegisterTime",value:function(){return this.initAt}},{key:"getTitle",value:function(){return Object(ne.b)("title")||ee.a.t("无标题幻灯片")}},{key:"getSaveTitle",value:(n=o()(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t="",this.getLocalFilePath()){e.next=5;break}return e.next=4,this.getPlaceholderTitle();case 4:t=e.sent;case 5:return e.abrupt("return",t||this.getTitle());case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getGlobalPadId",value:function(){return Object(ne.b)("globalPadId")}},{key:"getLocalFilePath",value:function(){return Object(ne.b)("localFilePath")}},{key:"getUserUin",value:function(){var e;return null!==(e=Object(h.getCookie)("uin"))&&void 0!==e?e:""}},{key:"getUserUid",value:function(){var e;return null!==(e=Object(ye.getCookieUid)())&&void 0!==e?e:""}},{key:"getUserInfo",value:function(){var e;return null===(e=window.basicClientVars)||void 0===e?void 0:e.userInfo}},{key:"getSecretId",value:function(){return"local_edit"}},{key:"isLogin",value:function(){var e;return!(null===(e=this.getUserInfo())||void 0===e||!e.tinyId)}},{key:"createTraceKey",value:function(){return this.traceId+=1,"".concat(this.getSessionId(),"-").concat(this.traceId)}},{key:"getRecoveredType",value:function(){return Object(ne.b)("recoveredType")}},{key:"getTemplatePath",value:function(){return Object(ne.b)("templatePath")}},{key:"getSessionId",value:function(){return Math.random().toString(16).slice(2)}},{key:"getPlaceholderTitle",value:(t=o()(l.a.mark((function e(){var t,n,r,a,i,o=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.SDKDataServices.PresentationStoreService.promise();case 2:return a=e.sent,i=null===(t=a.getPresentation())||void 0===t||null===(n=t.slideList[0])||void 0===n||null===(r=n.shapeList)||void 0===r?void 0:r.find((function(e){return e.type===me.a.Shape&&o.isTitlePh(e)})),e.abrupt("return",i?this.getTextStr(i):"");case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"isTitlePh",value:function(e){var t,n,r,a=null==e||null===(t=e.props)||void 0===t||null===(n=t.nvPr)||void 0===n||null===(r=n.ph)||void 0===r?void 0:r.type;return a===be.U.title||a===be.U.ctrTitle}},{key:"getTextStr",value:function(e){var t,n,r="";return null===(t=e.props.txBody)||void 0===t||null===(n=t.p)||void 0===n||n.forEach((function(e){e.egTextRun&&e.egTextRun.forEach((function(e){var t;null!=e&&null!==(t=e.r)&&void 0!==t&&t.t&&(r+=e.r.t)}))})),r}}]),e}();n("342844cefa"),n("a84962d637"),n("bcb5d93d36"),n("211c9e7008"),n("30078d1bba"),n("9e613e2f57"),n("0ad0839104"),n("87e9aa2426"),n("297a259b22"),n("347f4c5e26"),n("64bb56d585"),n("afeeb24b8e"),n("56ffd0610f"),n("7513a1cdfa"),n("f39debe0f1"),n("044475b26b"),n("e91e206977"),n("aaa7d96b4d"),n("743c905172"),n("240894da07"),n("8d6a7965e9"),n("b3b54ec99d"),n("65981e8631"),n("470d084e5c"),n("09b17a1f21"),n("15086d4e19"),n("474b85968b");!function(e){e.Required="required",e.Invalid="invalid"}(pe||(pe={}));var Se=n("6a1a1ac5a9"),we=n("e86bde4ef1");function Ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function De(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ie(Object(n),!0).forEach((function(t){x()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ie(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Oe=function(){function e(){O()(this,e),x()(this,"name","docx-chunks"),x()(this,"requiredDocxServiceVersion",2),x()(this,"client",$.a.create({docx:Object($.b)()},d.a.IS_MOBILE_LOCAL_EDIT))}var t,n;return N()(e,[{key:"loadPresentation",value:(n=o()(l.a.mark((function e(t){var n,r,a,i,o,c,s=this,u=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>1&&void 0!==u[1]?u[1]:{},this.checkDocxService(n.onFatalError),e.next=4,this.client.docx.loadByChunks(De(De({},t),{},{docType:Y.c.Slide})).catch((function(e){var t;throw null===(t=n.onFatalError)||void 0===t||t.call(n,e),e}));case 4:return r=e.sent,a=function(e){r.publish(Y.d.ContinueWithPassword,e)},i=new we.a,o=i.toChunksGenerator().advance(),c=function(){return Promise.race([new Promise((function(e){function t(){var t;if(null!==(t=window.localHeadChunkData)&&void 0!==t&&t.data){var n=window.localHeadChunkData.data,r=n.headData,a=n.totalChunkCount;e({headData:r,totalChunkCount:a})}}t(),window.addEventListener("localHeadChunkDataReady",(function(){t()}))})),new Promise((function(e){r.subscribe(Y.d.Head,(function(t,n){e({headData:t,totalChunkCount:n})}))}))])},e.abrupt("return",new Promise((function(e,t){var u=function(e){var a;i.dispose(e),r.close(),e&&(null===(a=n.onFatalError)||void 0===a||a.call(n,e),t(e))};c().then((function(t){var r,a=t.headData,i=t.totalChunkCount;null===(r=n.onHead)||void 0===r||r.call(n,i),e({type:Se.a.CommandChunkData,data:{head:s.parseChunkData(a),chunks:o.init(i)}})})),r.subscribe(Y.d.Chunk,(function(e,t,r){var a;i.add(t,{commands:[s.parseChunkData(e)]}),null===(a=n.onChunk)||void 0===a||a.call(n,t,r)})),Object(G.r)((function(){return o.done}),(function(e){var t;e&&(null===(t=n.onEnd)||void 0===t||t.call(n,o.total),u())}),{fireImmediately:!0}),r.subscribe(Y.d.Error,(function(e){var t,r=s.getPasswordError(e.code);r?null===(t=n.onPasswordError)||void 0===t||t.call(n,r,e.code,a):u(e)}))})));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"savePresentation",value:(t=o()(l.a.mark((function e(t){var n,r,a=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:{},this.checkDocxService(n.onFatalError),e.next=4,this.client.docx.save(De(De({},t),{},{docType:Y.c.Slide,bypassUpdateIsModifiedWhenJSONSaved:!0}),t.saveType).catch((function(e){var t;throw null===(t=n.onFatalError)||void 0===t||t.call(n,e),e}));case 4:(r=e.sent).subscribe(Y.f.DocumentSaved,(function(e,t,a){var i;null===(i=n.onDocumentSaved)||void 0===i||i.call(n,e,t,a),r.close()})),r.subscribe(Y.f.Cancel,(function(){var e;null===(e=n.onCancel)||void 0===e||e.call(n),r.close()})),r.subscribe(Y.f.Abort,(function(){var e;null===(e=n.onAbort)||void 0===e||e.call(n),r.close()})),r.subscribe(Y.f.MobileError,(function(e,t){var a;null===(a=n.onFatalError)||void 0===a||a.call(n,{name:"MobileError",code:e,message:t}),r.close()})),r.subscribe(Y.f.DesktopError,(function(e,t){var a;null===(a=n.onFatalError)||void 0===a||a.call(n,{name:"DesktopError",code:e,message:t}),r.close()})),r.subscribe(Y.f.ConverterError,(function(e,t){var a;null===(a=n.onFatalError)||void 0===a||a.call(n,{name:"ConverterError",code:e,message:t}),r.close()}));case 11:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"parseChunkData",value:function(e){return e instanceof Uint8Array?Z.a.fromEGChunkDataBuffer(e).getCommandData():new Z.a(JSON.parse(e)).getCommandData()}},{key:"checkDocxService",value:function(e){if(this.client.docx.version<this.requiredDocxServiceVersion){var t=new Error("DocxService is not found or version is too low, expected version = ".concat(this.requiredDocxServiceVersion,", actual version = ").concat(this.client.docx.version));throw null==e||e(t),t}}},{key:"getPasswordError",value:function(e){switch(e){case Y.l.kPasswordRequired:return pe.Required;case Y.l.kInvalidPassword:return pe.Invalid;default:return null}}}]),e}(),Ce=(n("b1e2246d82"),n("e0a67dc3fe")),xe=n("4e7af1026b"),Pe="[LocalEditService]",Ee=Object(Ce.c)(Ce.a.getConfig(xe.b.useNativePassword),!1),Te=function(){function e(t,n,r,a){var i=this;O()(this,e),x()(this,"loadDocument",o()(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(te.a)(),n=i.context.getTitle(),i.logger.info(Pe,"[load:begin]",n,t()),i.emitter.emit(I.LoadDocumentStart),e.abrupt("return",i.converter.loadPresentation({globalPadId:i.context.getGlobalPadId(),localFilePath:i.context.getLocalFilePath(),recoveredType:i.context.getRecoveredType(),templatePath:i.context.getTemplatePath()},{onHead:function(e){i.logger.info(Pe,"[load:head]",n,"[1/".concat(e,"]"),t()),i.emitter.emit(I.LoadDocumentChunkReceived,0,e),i.emitter.emit(I.LoadDocumentHeadSuccess)},onChunk:function(e,r){i.logger.info(Pe,"[load:chunk]",n,"[".concat(e+1,"/").concat(r,"]"),t()),i.emitter.emit(I.LoadDocumentChunkReceived,e,r)},onEnd:function(){i.logger.info(Pe,"[load:end]",n,t()),i.emitter.emit(I.LoadDocumentAllChunksSuccess)},onFatalError:function(e){i.logger.error(Pe,"[load:error]",n,Object(te.b)(e),t()),i.emitter.emit(I.LoadDocumentError,e)},onPasswordError:function(e,r,a){i.logger.info(Pe,"[load:password]",n,e,t()),Ee?i.emitter.emit(I.LoadDocumentUseNativePassword,r,a):e===pe.Required?i.emitter.emit(I.LoadDocumentPasswordRequired,a):i.emitter.emit(I.LoadDocumentPasswordInvalid)}}));case 5:case"end":return e.stop()}}),e)})))),this.logger=t,this.context=n,this.emitter=r,this.converter=a,this.logger.info(Pe,"[init]","converter=".concat(a.name)),this.emitter.emit(I.LocalEditServiceInit)}var t;return N()(e,[{key:"saveDocument",value:(t=o()(l.a.mark((function e(t,n,r){var a,i,o,c=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(te.a)(),i=Date.now(),e.next=4,this.context.getSaveTitle();case 4:return o=e.sent,this.logger.info(Pe,"[save:begin]",o,a()),e.abrupt("return",new Promise((function(e,s){var u=c.context.createTraceKey();c.emitter.emit(I.SaveDocumentBegin,u),c.converter.savePresentation({globalPadId:c.context.getGlobalPadId(),localFilePath:c.context.getLocalFilePath(),title:o,data:t,saveType:n,traceKey:u,recoveredType:c.context.getRecoveredType()},{onDocumentSaved:function(t,s,l){c.logger.info(Pe,"[save:success]",o,a());var d=t!==c.context.getLocalFilePath()||c.context.getRecoveredType();s&&t&&l&&d&&!r&&c.emitter.emit(I.DocumentInfoChanged,t,s,l),c.emitter.emit(I.SaveDocumentSuccess,n,u,i),e()},onCancel:function(){c.logger.error(Pe,"[save:cancel]",o,a()),s({name:"CancelError",message:"convert process is canceled",code:Y.i.kExportCancel})},onAbort:function(){c.logger.error(Pe,"[save:abort]",o,a()),s({name:"AbortError",message:"convert process is aborted",code:Y.i.kExportCancel})},onFatalError:function(e){c.logger.error(Pe,"[save:error]",o,Object(te.b)(e),a()),c.emitter.emit(I.SaveDocumentError,e,n,u),s(e)}}).catch(s),n===Y.s.AutoSave&&e()})));case 7:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})}]),e}(),Ae=n("8eec1e4a03"),_e=n.n(Ae),Me=n("7c2d7adc2c");function Le(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=H()(e);if(t){var a=H()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return V()(this,n)}}var Ne,Re,je,Ue,Fe=function(e){F()(r,e);var t,n=Le(r);function r(){return O()(this,r),n.apply(this,arguments)}return N()(r,[{key:"getSlideCount",value:function(){var e;return!this.chunks||null!==(e=this.chunks)&&void 0!==e&&e.done?_e()(H()(r.prototype),"getSlideCount",this).call(this):this.chunks.total}},{key:"init",value:function(){this.subscribeContentStatus()}},{key:"subscribeContentStatus",value:(t=o()(l.a.mark((function e(){var t,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.contentStatusManager,e.next=3,S.a.LocalEditEvents.promise();case 3:n=e.sent,(r=this.checkSlideAppStatus())?n.emit(I.SlideAppDataError,r):n.emit(I.SlideAppInitSuccess),t.onDocumentStatusChange((function(e){var r;e===Q.c.Corrupted&&n.emit(I.SlideAppDataError,null!==(r=t.getCorruptedError())&&void 0!==r?r:new Error(""))}));case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(Me.a),Be=n("37091e4240");!function(e){e.LOCAL_SAVE="local-save",e.LOCAL_SAVE_AS="local-save-as",e.ONLINE_FILE_OPEN="online-file-open",e.CLOUD_FILE_OPEN="cloud-file-open"}(Ne||(Ne={})),function(e){e[e.kUnknown=0]="kUnknown",e[e.kFile=1]="kFile",e[e.kWeiYun=4]="kWeiYun",e[e.kTencentDoc=5]="kTencentDoc"}(Re||(Re={})),function(e){e[e.kUnknown=0]="kUnknown",e[e.kC2C=1]="kC2C",e[e.kGroup=2]="kGroup",e[e.kLocal=7]="kLocal"}(je||(je={})),function(e){e[e.kUnknown=0]="kUnknown",e[e.kDoc=1]="kDoc",e[e.kXls=2]="kXls",e[e.kPpt=3]="kPpt",e[e.kOther=4]="kOther",e[e.kPdf=12]="kPdf",e[e.kForm=13]="kForm",e[e.kSmartDoc=14]="kSmartDoc",e[e.kSmartSheet=15]="kSmartSheet",e[e.kBoard=16]="kBoard",e[e.kMind=17]="kMind",e[e.kFlowChat=18]="kFlowChat"}(Ue||(Ue={}));n("1bab7b5fb7"),n("0aeae65bf4");var Ve=n("4f3b15d017"),qe=function(){function e(t,n){var r=this;O()(this,e),x()(this,"isReady",void 0),x()(this,"saveToFileCenter",function(){var e=o()(l.a.mark((function e(t){var n,a,i,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.isReady){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,r.getSaveToFileParams(t);case 5:return a=e.sent,e.next=8,r.qqexBridge.saveToFileCenter(a);case 8:i=e.sent,null===(n=window.log)||void 0===n||n.info("[QQMiniBridgeManager] code: ".concat(i.code,", data: ").concat(i.data,", message: ").concat(i.errMsg)),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),null===(o=window.log)||void 0===o||o.error("[QQMiniBridgeManager] catch error: ".concat(e.t0.message));case 15:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(t){return e.apply(this,arguments)}}()),this.mqq=t,this.qqexBridge=n,this.isReady=!!(Ve.default.isQQDesktopDocsClient&&t&&n)}var t,n,r;return N()(e,[{key:"getSaveToFileParams",value:(r=o()(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getHashId();case 2:e.t0=e.sent,e.t1=this.localFilePath,e.t2=this.localFileTitle,n={hashId:e.t0,filePath:e.t1,fileName:e.t2},e.t3=t,e.next=e.t3===Ne.LOCAL_SAVE?9:e.t3===Ne.LOCAL_SAVE_AS?11:17;break;case 9:return n.qqInfo=this.aioQQInfo,e.abrupt("break",17);case 11:return n.source=je.kLocal,n.fileType=Re.kFile,e.next=15,this.getLocalFileSize();case 15:return n.fileSize=e.sent,e.abrupt("break",17);case 17:return e.abrupt("return",n);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"getHashId",value:(n=o()(l.a.mark((function e(){var t=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){t.mqq.invoke("qqmini","getHashId",{},(function(t){e(t.data)}))})));case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"getLocalFileSize",value:(t=o()(l.a.mark((function e(){var t=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){t.mqq.invoke("docx","getFileStats",{file:t.localFilePath},(function(t){e(t.size)}))})));case 1:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})},{key:"localFilePath",get:function(){return Object(ne.b)("localFilePath")}},{key:"localFileTitle",get:function(){var e,t,n=(e=this.localFilePath,((t=e.match(/.*\.(.*)/))?t[1]:"")||"pptx"),r=Object(ne.b)("title")||window.clientVars.padTitle||ee.a.t("无标题幻灯片");return"".concat(r,".").concat(n)}},{key:"aioQQInfo",get:function(){return Object(ne.b)("qqInfo")}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e(window.mqq,window.qqexBridge)),e.instance}}]),e}();x()(qe,"instance",void 0);var He="web_start_parse_html",Ke="main_start",We="register_local_edit_services",Ge="load_document_start",Ye=function(){function e(t,n,r,a,i){var o,c,s,u=this;O()(this,e),x()(this,"client",$.a.create({docx:Object($.b)(),report:Object($.b)()},d.a.IS_MOBILE_LOCAL_EDIT)),x()(this,"loadReportOptions",void 0),this.logger=t,this.context=n,this.emitter=r,this.slideCountState=a,this.commonEmitter=i,this.loadReportOptions={docType:Y.c.Slide,type:"load",globalPadId:this.context.getGlobalPadId(),csid:Object(h.getQuery)("csid"),useChunkImport:!1,hasPassword:!1,metrics:{},extra:{}},this.reportLoadMetric(Y.m.PARSE_HTML,null===(o=performance)||void 0===o||null===(c=o.timing)||void 0===c?void 0:c.responseEnd),this.reportLoadMetric(He,window.__webStartParseHtmlTimestamp),this.reportLoadMetric(Ke,null===(s=window.jsRunMarkPoints)||void 0===s?void 0:s.mainStart),this.reportLoadMetric(We,this.context.getLocalEditServicesRegisterTime()),this.emitter.on(I.LocalEditServiceInit,(function(){u.reportLoadMetric(Y.m.INIT_LOCAL_EDIT)})),this.emitter.on(I.LoadDocumentStart,(function(){u.reportLoadMetric(Ge)})),this.emitter.on(I.LoadDocumentPasswordRequired,(function(){u.loadReportOptions.hasPassword=!0})),this.emitter.on(I.LoadDocumentUseNativePassword,(function(){u.loadReportOptions.hasPassword=!0})),this.emitter.on(I.LoadDocumentChunkReceived,(function(){u.loadReportOptions.useChunkImport=!0})),this.emitter.on(I.LoadDocumentHeadSuccess,(function(){u.reportLoadMetric(Y.m.FIRST_CHUNK_FETCHED)})),this.emitter.on(I.LoadDocumentAllChunksSuccess,(function(){u.reportLoadMetric(Y.m.ALL_CHUNKS_FETCHED),d.a.IS_MOBILE_LOCAL_EDIT&&u.reportLoadMetric(Y.m.CAN_EDIT)})),Be.b.onIncludingPast(Be.a.FIRST_PAGE_DISPLAY,(function(){u.reportLoadMetric(Y.m.CAN_VIEW,window.previewTime),u.reportLoadMetric(Y.m.CAN_INTERACT),d.a.IS_PC_LOCAL_EDIT&&u.reportLoadMetric(Y.m.CAN_EDIT)})),this.emitter.on(I.SaveDocumentSuccess,(function(e,t,n){var r;u.report({docType:Y.c.Slide,type:"save",globalPadId:u.context.getGlobalPadId(),traceKey:t,metrics:(r={},x()(r,Y.g.BEGIN_DUMP,n),x()(r,Y.g.FINISH_DUMP,Date.now()),r),extra:u.getExtraParams()}),qe.getInstance().saveToFileCenter(e===Y.s.SaveAs?Ne.LOCAL_SAVE_AS:Ne.LOCAL_SAVE)}))}return N()(e,[{key:"reportLoadMetric",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();d.a.IS_TEST&&this.logger.info("[LocalEditReporter]","[".concat(e.toUpperCase(),"]"),"@".concat(~~(t-performance.timeOrigin)));var n=this.loadReportOptions.metrics;n[e]=t,n[Y.m.CAN_VIEW]&&n[Y.m.CAN_INTERACT]&&n[Y.m.CAN_EDIT]&&n[Y.m.ALL_CHUNKS_FETCHED]&&(this.loadReportOptions.extra=this.getExtraParams(),this.report(this.loadReportOptions))}},{key:"report",value:function(e){d.a.IS_TEST&&this.logger.info("[LocalEditReporter]",e.type,JSON.stringify(e)),this.client.report.version&&this.client.report.reportPerformance(e)}},{key:"getExtraParams",value:function(){return{name:this.context.getTitle(),slideCount:this.slideCountState.slideCount,releaseVersion:window.__globalReleaseVersion}}}]),e}(),Qe=(n("8aebbf296a"),n("f45588a8ad"),n("de37db1287"),n("14502724a6")),Je=n.n(Qe),ze=(n("3dc760a4d9"),n("899c76157d"),n("026cc7da1f"));function Xe(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return $e(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $e(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){c=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw i}}}}function $e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ze="[EmbeddedFontManager]",et=function(){function e(t,n){var r=this;O()(this,e),this.logger=t,this.slideApp=n,this.loadEmbeddedFont().catch((function(e){r.logger.error(Ze,Object(te.b)(e))}))}var t;return N()(e,[{key:"loadEmbeddedFont",value:(t=o()(l.a.mark((function e(){var t,n,r,a,i,o,c,s,u,d,f,h,v,p,g,m,b,y,k,S,w,I;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getFontManager(),null!=(n=this.getEmbeddedFontFamilies())&&n.length&&t){e.next=4;break}return e.abrupt("return");case 4:r=[],a=Xe(n),e.prev=6,a.s();case 8:if((i=a.n()).done){e.next=25;break}o=i.value,c=0,s=Object.entries(o.subfamilies);case 11:if(!(c<s.length)){e.next=23;break}if(u=Je()(s[c],2),d=u[0],f=u[1]){e.next=15;break}return e.abrupt("continue",20);case 15:h=["italic","boldItalic"].includes(d)?"italic":"normal",v=["bold","boldItalic"].includes(d)?"bold":"normal",p=f.src.endsWith(".fntdata")?"".concat(f.src,".ttf"):f.src,g=new FontFace(o.typeface,"url(".concat(p,")"),{style:h,weight:v}),r.push(g);case 20:c++,e.next=11;break;case 23:e.next=8;break;case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(6),a.e(e.t0);case 30:return e.prev=30,a.f(),e.finish(30);case 33:return e.next=35,Promise.allSettled(r.map((function(e){return e.load()})));case 35:m=e.sent,b=Xe(m.entries()),e.prev=37,b.s();case 39:if((y=b.n()).done){e.next=49;break}if(k=Je()(y.value,2),S=k[0],w=k[1],I=r[S],"fulfilled"===w.status){e.next=45;break}return this.logger.error(Ze,'error occurs while loading font "'.concat(I.family,'" style=').concat(I.style," weight=").concat(I.weight),Object(te.b)(w.reason)),e.abrupt("continue",47);case 45:document.fonts.add(I),t.downloadedFontFamilies.push(I.family);case 47:e.next=39;break;case 49:e.next=54;break;case 51:e.prev=51,e.t1=e.catch(37),b.e(e.t1);case 54:return e.prev=54,b.f(),e.finish(54);case 57:case"end":return e.stop()}}),e,this,[[6,27,30,33],[37,51,54,57]])}))),function(){return t.apply(this,arguments)})},{key:"getFontManager",value:function(){return re.a.getInstance().getAppServices().viewableServiceLayer.fontManager}},{key:"getEmbeddedFontFamilies",value:function(){var e=p.a.SDKDataServices.PresentationStoreService();return Object(ze.assert)(e,"presentationStoreService should not be undefined"),e.getPresentation().getEmbeddedFontFamilies()}}]),e}(),tt=et,nt=(n("9d7978d445"),function(){function e(t){var n,r=this;O()(this,e),x()(this,"slideTitle",void 0),x()(this,"offlineTitle",void 0),x()(this,"isUserChangeTitle",!1),x()(this,"updateTitleCallback",[]),this.clientVarsService=t,this.slideTitle=null!==(n=this.clientVarsService.getClientVars().title)&&void 0!==n?n:"",this.isUserChangeTitle=!!this.clientVarsService.getClientVars().isUserChangeTitle,window.document.title=this.titleWithSuffix,this.onTitleChanged((function(e){r.slideTitle=e,window.document.title=r.titleWithSuffix}))}return N()(e,[{key:"title",get:function(){return this.slideTitle}},{key:"titleWithSuffix",get:function(){return this.getFullTitle(this.slideTitle)}},{key:"updateTitle",value:function(e){this.emitTitleChanged(null!=e?e:this.slideTitle)}},{key:"onTitleChanged",value:function(e){this.updateTitleCallback.push(e)}},{key:"emitTitleChanged",value:function(e){this.updateTitleCallback.forEach((function(t){t(e)}))}},{key:"getFullTitle",value:function(e){var t=Object(ne.b)("localFilePath"),n=".pptx";return t.includes(".")&&(n=".".concat(t.split(".").pop())),"".concat(e).concat(n)}}]),e}());function rt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=H()(e);if(t){var a=H()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return V()(this,n)}}var at=function(e){F()(r,e);var t,n=rt(r);function r(){return O()(this,r),n.apply(this,arguments)}return N()(r,[{key:"setDocVisible",value:(t=o()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})},{key:"getDocInfo",value:function(){return Promise.resolve({})}}]),r}(n("7dfd8db4f1").a);function it(){var e=new ke;d.a.IS_MOBILE_LOCAL_EDIT&&(Object(g.a)(),Object(g.b)()),p.a.ClientVarsService.register((function(){return new y.a(function(e){var t,n,r,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"{}",o=Object(w.a)();o.collab_client_vars=null!==(t=o.collab_client_vars)&&void 0!==t?t:{},o.collab_client_vars.client=null!==(n=o.collab_client_vars.client)&&void 0!==n?n:{},o.collab_client_vars.initialAttributedText=null!==(r=o.collab_client_vars.initialAttributedText)&&void 0!==r?r:{},o.privilegeAttribute=null!==(a=o.privilegeAttribute)&&void 0!==a?a:{},e.isLogin()||(o.isLogin=!1);var c=e.getUserInfo();return c&&(o.userInfo=c,o.userLoginCorpId=c.corpId,o.userLoginCorpName=c.corpName),o.title=e.getTitle(),o.padTitle=e.getTitle(),o.globalPadId=e.getGlobalPadId(),o.localPadId=e.getGlobalPadId(),o.collab_client_vars.client.upid=e.getSecretId(),o.collab_client_vars.globalPadId=e.getGlobalPadId(),o.collab_client_vars.padId=e.getGlobalPadId(),o.collab_client_vars.initialAttributedText.text=i,o.collab_client_vars.ver=1/0,o.collab_client_vars.dver="3.0.0",o.uin=e.getUserUin(),o.userId=e.getUserUid(),o.isOwner=!0,window.clientVars=o,dispatchEvent(new Event("clientVarsDataReady")),o}(e))})),p.a.DocInfoManager.register(Object(m.a)(at)),p.a.SlideInitialDataService.register(o()(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.a.LocalEditService.promise();case 2:return t=e.sent,e.next=5,t.loadDocument();case 5:return n=e.sent,e.abrupt("return",new k.a(n));case 7:case"end":return e.stop()}}),e)})))),p.a.SlideAppService.register(Object(m.a)(Fe)),p.a.SlideTitleManager.register(Object(m.a)(nt)),d.a.IS_MOBILE_LOCAL_EDIT?S.a.UI.PasswordModal.register(o()(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.e("async~493df0b3"),n.e("async~c5b24172"),n.e("async~0d51b00e"),n.e("async~beecf843"),n.e("async~2e2c6527"),n.e("async~da8db81f"),n.e("async~e10030d6"),n.e("async~098dcb65"),n.e("async~d0c14fe8"),n.e("async~7f8bedbf"),n.e("async~f40490b4"),n.e("async~2158e36e"),n.e("async~76acd586"),n.e("async~37d786cf"),n.e("async~30ccc425"),n.e("async~0c7d7381"),n.e("async~907e9098"),n.e("async~43172549"),n.e("async~f19eb79b"),n.e("async~95108331"),n.e("async~718865d2"),n.e("async~89b7a519")]).then(n.bind(null,"381c4cf651"));case 2:return t=e.sent,r=t.PasswordModal,e.abrupt("return",new r);case 5:case"end":return e.stop()}}),e)})))):S.a.UI.PasswordModal.register(o()(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.e("async~493df0b3"),n.e("async~c5b24172"),n.e("async~0d51b00e"),n.e("async~beecf843"),n.e("async~2e2c6527"),n.e("async~da8db81f"),n.e("async~e10030d6"),n.e("async~098dcb65"),n.e("async~d0c14fe8"),n.e("async~7f8bedbf"),n.e("async~f40490b4"),n.e("async~2158e36e"),n.e("async~76acd586"),n.e("async~37d786cf"),n.e("async~30ccc425"),n.e("async~0c7d7381"),n.e("async~907e9098"),n.e("async~43172549"),n.e("async~f19eb79b"),n.e("async~95108331"),n.e("async~718865d2"),n.e("async~89b7a519")]).then(n.bind(null,"5815291bb8"));case 2:return t=e.sent,r=t.PasswordModal,e.abrupt("return",new r);case 5:case"end":return e.stop()}}),e)})))),S.a.UI.ConvertErrorModal.register(o()(l.a.mark((function e(){var t,r,i,o,c,s=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.e("commonAsync~9b1fde68"),n.e("commonAsync~27f19aac"),n.e("commonAsync~205ac551"),n.e("commonAsync~0c3a6025"),n.e("commonAsync~32e631b8"),n.e("commonAsync~08369118"),n.e("commonAsync~50db4bb8"),n.e("commonAsync~86c92fed"),n.e("commonAsync~a95f944a"),n.e("commonAsync~6e568190"),n.e("commonAsync~b174e5ca"),n.e("commonAsync~54a68610"),n.e("commonAsync~61b3c105"),n.e("commonAsync~f7b3ac00"),n.e("commonAsync~cece21d6"),n.e("commonAsync~ecbf7682"),n.e("commonAsync~6c5dfa7c"),n.e("commonAsync~90483627"),n.e("commonAsync~d2c096c2"),n.e("commonAsync~1285a477"),n.e("commonAsync~31ded9a0"),n.e("commonAsync~ecdbff9b"),n.e("commonAsync~c2cc425c"),n.e("commonAsync~4fb44df2"),n.e("commonAsync~d06fe423"),n.e("commonAsync~0519277e"),n.e("commonAsync~6df2b9ea"),n.e("commonAsync~b5c4f9e4"),n.e("commonAsync~ffdf5190"),n.e("commonAsync~127b6cf7"),n.e("commonAsync~b3c4a2ff"),n.e("commonAsync~19bb5a55"),n.e("async~493df0b3"),n.e("async~c5b24172"),n.e("async~0d51b00e"),n.e("async~beecf843"),n.e("async~2e2c6527"),n.e("async~da8db81f"),n.e("async~e10030d6"),n.e("async~098dcb65"),n.e("async~d0c14fe8"),n.e("async~7f8bedbf"),n.e("async~f40490b4"),n.e("async~2158e36e"),n.e("async~76acd586"),n.e("async~37d786cf"),n.e("async~30ccc425"),n.e("async~0c7d7381"),n.e("async~907e9098"),n.e("async~43172549"),n.e("async~f19eb79b"),n.e("async~95108331"),n.e("async~718865d2"),n.e("async~89b7a519")]).then(n.bind(null,"e87b1bbd68"));case 2:for(t=e.sent,r=t.ConvertErrorModal,i=s.length,o=new Array(i),c=0;c<i;c++)o[c]=s[c];return e.abrupt("return",a()(r,o));case 6:case"end":return e.stop()}}),e)})))),S.a.LocalEditContext.register((function(){return e})),S.a.LocalEditEvents.register((function(){return Object(b.a)()})),S.a.LocalEditNoticeManager.register(Object(m.a)(A)),S.a.LocalEditReporter.register(Object(m.a)(Ye)),S.a.LocalEditDataConverter.register((function(){return new Oe})),S.a.LocalEditService.register(Object(m.a)(Te)),d.a.IS_MOBILE_LOCAL_EDIT?S.a.LocalEditManager.register(Object(m.a)(he)):S.a.LocalEditManager.register(Object(m.a)(ge)),S.a.EmbeddedFontManager.register(Object(m.a)(tt))}n("826dc923b3");var ot,ct=n("e212cafb1e"),st=n("aba9dcef64"),ut=n("73d8814097"),lt=(n("3dc8f33382"),n("63513d8b56"),n("fdddc95d9b")),dt=n("29112c2c27"),ft=n("0112351fbe"),ht=n.n(ft),vt=n("780d9b3b59");function pt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=H()(e);if(t){var a=H()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return V()(this,n)}}var gt,mt=function(e){F()(n,e);var t=pt(n);function n(e,r){var a;return O()(this,n),a=t.call(this,e),x()(j()(a),"details",void 0),a.name=a.constructor.name,a.details=r,Error.captureStackTrace(j()(a),a.constructor),a}return n}(ht()(Error));!function(e){e[e.ENCRYPTED_FILE=402702]="ENCRYPTED_FILE",e[e.LOAD_FAILED=402704]="LOAD_FAILED"}(gt||(gt={}));var bt=(ot={},x()(ot,gt.ENCRYPTED_FILE,ee.a.t("本文档设置了密码，暂不支持预览")),x()(ot,gt.LOAD_FAILED,ee.a.t("文档解析失败")),ot),yt=function(e,t){return new mt(e,{code:t,message:bt[t]||ee.a.t("预览失败，请刷新重试"),actionType:vt.a.NONE})},kt="[DocxOnlineAsyncDataFetcher]",St=function(){function e(t,n,r){O()(this,e),x()(this,"chunkIndex",0),x()(this,"startIndex",0),x()(this,"fetchMaxSlideCount",5),x()(this,"fetchDataFinished",!1),x()(this,"totalPageCount",void 0),x()(this,"pendingResourceIds",void 0),this.clientVarsService=t,this.onlineApiService=n,this.logger=r,this.pendingResourceIds=[]}var t,n,r,a,i;return N()(e,[{key:"loadPresentation",value:(i=o()(l.a.mark((function e(){var t,n,r,a=this,i=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:{},n=new we.a,(r=n.toChunksGenerator().advance()).updateDocCreateStatus(dt.a.NotCreate),e.abrupt("return",new Promise((function(e,i){var o=function(e){var r;n.dispose(e),e&&(null===(r=t.onFatalError)||void 0===r||r.call(t,e),i(e))},c=function(n,i,o){var c;a.totalPageCount=i,a.fetchMaxSlideCount=o;var s=Math.ceil(a.totalPageCount/a.fetchMaxSlideCount);null===(c=t.onHead)||void 0===c||c.call(t,s),e({type:Se.a.CommandChunkData,data:{head:a.getSlideFileJSON(n,!0),chunks:r.init(s,a.totalPageCount)}})};Promise.all([a.pollingTimeout((function(){return a.fetchChunkData(n,r,t,c)}),"fetchChunkData").finally((function(){return a.fetchDataFinished=!0})),a.pollingTimeout((function(){return a.fetchResourceData()}),"fetchResourceData").catch((function(e){a.logger.error("".concat(kt," fetchResourceData catch error: "),e)}))]).then((function(){var e;null===(e=t.onEnd)||void 0===e||e.call(t,r.total),o(),a.pollingTimeout((function(){return a.checkDocStatus(r)}),"checkDocStatus").catch((function(e){a.logger.error("".concat(kt," checkDocStatus catch error: "),e)}))})).catch((function(e){o(e)}))})));case 5:case"end":return e.stop()}}),e)}))),function(){return i.apply(this,arguments)})},{key:"fetchChunkData",value:(a=o()(l.a.mark((function e(t,n,r,a){var i,o,c,s,u,d,f,h,v,p,g,m;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.onlineApiService.getChunkData({padId:this.globalPadId,startIndex:this.startIndex,count:this.fetchMaxSlideCount,revisionVersion:this.requestRevision,notAlreadyCreate:1});case 2:if(i=e.sent,o=i.data,c=o.retcode,s=o.data,!c||408502===c){e.next=7;break}throw yt("Unexpected fetchChunkData response code: ".concat(c),c);case 7:if(!s){e.next=12;break}if(u=s.chunk_datas,d=s.count,f=s.total,h=s.resource_ids,u&&(null==u?void 0:u.length)>0&&(p=this.startIndex+d,0===this.chunkIndex?a(u,f,d):(m=this.calcTotalChunkCount(p),n.updateTotal(m),t.add(this.chunkIndex,{commands:[this.getSlideFileJSON(u,!0)]}),null===(g=r.onChunk)||void 0===g||g.call(r,this.chunkIndex,m)),(v=this.pendingResourceIds).push.apply(v,M()(h||[])),this.startIndex=p,this.chunkIndex+=1),!(this.startIndex>=this.totalPageCount)){e.next=12;break}return e.abrupt("return",{shouldTerminate:!0});case 12:return e.abrupt("return",{asyncPollInterval:16});case 13:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return a.apply(this,arguments)})},{key:"fetchResourceData",value:(r=o()(l.a.mark((function e(){var t,n,r,a,i,o,c,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.fetchDataFinished||0!==this.pendingResourceIds.length){e.next=2;break}return e.abrupt("return",{shouldTerminate:!0});case 2:if(0!==this.pendingResourceIds.length){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,this.onlineApiService.pollingResourceData(this.globalPadId,{resource_ids:JSON.stringify(this.pendingResourceIds.splice(0,10))});case 6:if(n=e.sent,r=n.data,a=r.code,i=r.data,!a){e.next=11;break}throw yt("Unexpected fetchResourceData response code: ".concat(a),a);case 11:if(i){e.next=13;break}return e.abrupt("return");case 13:if(o=i.resourceData,c=i.missingResources,!(null!=o&&o.length&&(null==o?void 0:o.length)>0)){e.next=20;break}return s=this.getSlideFileJSON(o),e.next=18,p.a.SDKDataServices.PresentationStoreService.promise();case 18:e.sent.applyCommandData(s,lt.a.Keyframe);case 20:(t=this.pendingResourceIds).unshift.apply(t,M()(c||[]));case 21:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"checkDocStatus",value:(n=o()(l.a.mark((function e(t){var n,r,a,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.onlineApiService.pollingDocStatus(this.globalPadId);case 2:if(n=e.sent,r=n.data,a=r.code,i=r.data,!a){e.next=7;break}throw yt("Unexpected checkDocStatus response code: ".concat(a),a);case 7:if(null==i||!i.importStatus){e.next=11;break}return t.updateDocCreateStatus(dt.a.AlreadyCreate),Be.b.emit(Be.a.DOC_CREATED_SUCCESS),e.abrupt("return",{shouldTerminate:!0});case 11:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"pollingTimeout",value:(t=o()(l.a.mark((function e(t,n){var r,a,i,o,c=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=c.length>2&&void 0!==c[2]?c[2]:3e5,i=!0,o=Date.now();case 3:if(!i){e.next=15;break}return e.prev=4,e.delegateYield(l.a.mark((function e(){var n,c,s,u,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t();case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0={};case 5:if(n=e.t0,c=n.shouldTerminate,s=n.asyncPollInterval,u=void 0===s?200:s,d=n.result,!c){e.next=15;break}a=d,i=!1,e.next=21;break;case 15:if(!(Date.now()-o>r)){e.next=19;break}throw new Error("Total polling time exceeded: ".concat(r));case 19:return e.next=21,new Promise((function(e){return setTimeout(e,u)}));case 21:case"end":return e.stop()}}),e)}))(),"t0",6);case 6:e.next=13;break;case 8:return e.prev=8,e.t1=e.catch(4),this.logger.error("".concat(kt," ").concat(n," error message: "),e.t1.message),i=!1,e.abrupt("return",Promise.reject(e.t1));case 13:e.next=3;break;case 15:return e.abrupt("return",Promise.resolve(a));case 16:case"end":return e.stop()}}),e,this,[[4,8]])}))),function(e,n){return t.apply(this,arguments)})},{key:"getSlideFileJSON",value:function(e,t){var n=this,r=[];return e.forEach((function(e){var a=new Z.a({presentation:e}).getCommandData().mutations;t&&n.clearPreResourceMap(a),r=r.concat(a)})),{mutations:r}}},{key:"clearPreResourceMap",value:function(e){e.forEach((function(e){var t,n;if((null==e?void 0:e.type)===be.c.UpdateResourceMap){null!==(t=e.updateResourceMap)&&void 0!==t&&null!==(n=t.imageDescriptor)&&void 0!==n&&n.src&&!/^(http|blob|data)/.test(e.updateResourceMap.imageDescriptor.src)&&(e.updateResourceMap.imageDescriptor.src="")}}))}},{key:"calcTotalChunkCount",value:function(e){return this.chunkIndex+1+Math.ceil((this.totalPageCount-e)/this.fetchMaxSlideCount)}},{key:"globalPadId",get:function(){var e,t;return null!==(e=null===(t=this.clientVarsService.getClientVars().collab_client_vars)||void 0===t?void 0:t.globalPadId)&&void 0!==e?e:""}},{key:"requestRevision",get:function(){var e;return(null===(e=this.clientVarsService.getClientVars().collab_client_vars)||void 0===e?void 0:e.rev)||0}}]),e}(),wt=n("537ff5fc9e"),It=n("588c4a7ced"),Dt=n("bb9a224484"),Ot=(n("c9a7ecac4d"),n("0e41c725b0")),Ct=n("d3d31c86eb"),xt=n("c7530f2183"),Pt=n("7e61746219"),Et="[DefaultSlideTitleManager] ",Tt="CACHE_UPDATE_TITLE",At=function(){function e(t,n){var r=this;O()(this,e),x()(this,"slideTitle",void 0),x()(this,"offlineTitle",void 0),x()(this,"offlineTitleTimestamp",void 0),x()(this,"isUserChangeTitle",!1),x()(this,"events",Object(b.a)()),this.clientVarsService=t,this.logger=n;var a=this.clientVarsService.getClientVars(),i=a.offlineTitle,o=a.offlineTitleTimestamp,c=a.isUserChangeTitle;this.offlineTitle=i||void 0,this.offlineTitleTimestamp=o,this.slideTitle=this.offlineTitle||this.clientVarsService.getClientVars().title||"",this.isUserChangeTitle=!!c,this.registerCommitOfflineTitle(),window.document.title=this.titleWithSuffix,this.setTitleInMobile(),this.onTitleChanged((function(e){r.slideTitle=e,window.document.title=r.titleWithSuffix,r.isUserChangeTitle=!0,r.setTitleInMobile(),r.setDocVisible(),r.syncTitle2ClientVars(e)}))}var t;return N()(e,[{key:"title",get:function(){return this.slideTitle}},{key:"titleWithSuffix",get:function(){return this.getFullTitle(this.slideTitle)}},{key:"updateTitle",value:function(e,t){e&&e!==this.slideTitle?navigator.onLine?this.updateTitleOnline({title:e,callback:t}):this.updateTitleOffline(e):this.emitTitleChanged(this.slideTitle)}},{key:"onTitleChanged",value:function(e){}},{key:"emitTitleChanged",value:function(e){}},{key:"setDocVisible",value:function(){}},{key:"updateTitleOnline",value:(t=o()(l.a.mark((function e(t){var n,r,a,i,o,c,s=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=null!==(n=this.clientVarsService.getClientVars())&&void 0!==n?n:{},a=r.padId,i=void 0===a?"":a,o=r.domainId,c=void 0===o?"":o,st.a.OnlineApiService.promise().then((function(e){var n=e.updateTitle,r=t.title,a=t.timestamp,o=t.callback;n({padId:i,domainId:c,title:r,timestamp:a}).then((function(e){s.expectRetCode(e.data,12e3)?null==o||o(null,e):(null==o||o(null,e),s.emitTitleChanged(r),s.updateTitleOffline(void 0),Object(Ct.c)({opername:"doc_non_edit",module:"title",action:"modify"}))})).catch((function(e){s.logger.error(Et,"updateTitle error: ".concat(JSON.stringify(e))),null==o||o(e,null)}))}));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"setTitleInMobile",value:function(){var e,t;null===(e=Ot.e.tdocsUi)||void 0===e||e.setWebViewBehavior({titleText:"".concat(this.titleWithSuffix)}),null===(t=Ot.e.tdocsUi)||void 0===t||t.refreshTitle(),Ve.default.isTencentDocsApp}},{key:"registerCommitOfflineTitle",value:function(){var e=this,t=function(){e.logger.info(Et,"commitOfflineTitle this.offlineTitle: ".concat(e.offlineTitle)),void 0!==e.offlineTitle&&e.updateTitleOnline({title:e.offlineTitle,timestamp:e.offlineTitleTimestamp})};xt.network.isOnline&&t(),window.addEventListener("online",(function(){t()}))}},{key:"getFullTitle",value:function(e){if(Object(Pt.b)()){var t,n,r,a=null===(t=window.basicClientVars)||void 0===t||null===(n=t.docInfo)||void 0===n||null===(r=n.cosInfo)||void 0===r?void 0:r.driveExt;return a?"".concat(e,".").concat(a):e}return e}},{key:"expectRetCode",value:function(e,t){return 0===t?e.retcode===t&&e.cgicode===t:e.retcode===t||e.cgicode===t}},{key:"updateTitleOffline",value:function(e){var t=this;p.a.ClientVarsService.promise().then((function(n){var r,a=n.getClientVars();null!==(r=t.clientVarsService)&&void 0!==r&&r.isLocalDoc()||(t.offlineTitle=e,t.offlineTitleTimestamp=void 0===e?void 0:Date.now(),a.offlineTitle=e,a.offlineTitleTimestamp=t.offlineTitleTimestamp),n.setClientVars(a),window.dispatchEvent(new CustomEvent(Tt,{detail:{title:e||a.title}})),e&&t.emitTitleChanged(e)}))}},{key:"syncTitle2ClientVars",value:function(e){p.a.ClientVarsService.promise().then((function(t){var n=t.getClientVars();n.title=e,n.padTitle=e,t.setClientVars(n),window.dispatchEvent(new CustomEvent(Tt,{detail:{title:e}}))}))}}]),e}();n("2c4d03fe19"),n("34cd92f77a");function _t(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=H()(e);if(t){var a=H()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return V()(this,n)}}var Mt="title-change-event",Lt=function(e){F()(n,e);var t=_t(n);function n(e,r,a,i,o){var c;return O()(this,n),c=t.call(this,e,r),x()(j()(c),"firstSlideTitleObserver",void 0),x()(j()(c),"observedShapes",new Set),c.presentationStoreService=i,o.socketEvents.onTitleChange((function(e){var t=e.title;c.events.emit(Mt,t)})),c.isUserChangeTitle?V()(c):(c.addPresentationObserver(),c.resetFirstSlideObserver(),c)}return N()(n,[{key:"onTitleChanged",value:function(e){_e()(H()(n.prototype),"onTitleChanged",this).call(this,e),this.events.on(Mt,(function(t){return e(t)}))}},{key:"setDocVisible",value:function(){p.a.DocInfoManager.promise().then((function(e){return e.setDocVisible()}))}},{key:"emitTitleChanged",value:function(e){_e()(H()(n.prototype),"emitTitleChanged",this).call(this,e),this.events.emit(Mt,e)}},{key:"addPresentationObserver",value:function(){var e=this;this.presentationStoreService.getPresentation().subscribe((function(t){return e.observerPresentation(t)}))}},{key:"observerPresentation",value:function(e){if([lt.a.Editor,lt.a.UndoRedo].includes(e.source)){if(this.isUserChangeTitle)return void this.presentationStoreService.getPresentation().unsubscribe(this.observerPresentation);this.resetFirstSlideObserver()}}},{key:"resetFirstSlideObserver",value:function(){var e=this,t=this.presentationStoreService.getPresentation().slideList;if(t&&t.length>0){this.removeSlideObservers();for(var n=Je()(t,1)[0],r=function(t){var r=n.shapeList[t];r.type===me.a.Shape&&e.isTitlePh(r)&&(e.firstSlideTitleObserver=function(t){return e.titlePhObserver(t,r)},r.subscribe(e.firstSlideTitleObserver),e.observedShapes.add(r))},a=0;a<n.shapeList.length;a++)r(a)}else this.removeSlideObservers()}},{key:"titlePhObserver",value:function(e,t){var n,r;if([lt.a.Editor,lt.a.UndoRedo].includes(e.source)&&(null===(n=t.props.txBody)||void 0===n||null===(r=n.p)||void 0===r?void 0:r.length))if(this.isUserChangeTitle)t.unsubscribe(this.firstSlideTitleObserver);else{var a=function(e){var t=!0;e&&0!==e.length||(t=!1);var n=/[\\\/:*?"<>|]/g,r=e.trim();return n.test(r)?r=r.replace(n,""):r.length>128&&(r=r.substr(0,128)),r.match(/^\s*$/)&&(t=!1),r&&0!==r.length||(t=!1),{isValid:t,newTitle:r}}(this.getTextStr(t)),i=a.isValid,o=a.newTitle;i&&this.updateTitle(o)}}},{key:"removeSlideObservers",value:function(){var e=this;this.observedShapes.forEach((function(t){null==t||t.unsubscribe(e.firstSlideTitleObserver)})),this.observedShapes.clear()}},{key:"isTitlePh",value:function(e){var t,n,r,a=null==e||null===(t=e.props)||void 0===t||null===(n=t.nvPr)||void 0===n||null===(r=n.ph)||void 0===r?void 0:r.type;return a===be.U.title||a===be.U.ctrTitle}},{key:"getTextStr",value:function(e){var t,n,r="";return null===(t=e.props.txBody)||void 0===t||null===(n=t.p)||void 0===n||n.forEach((function(e){e.egTextRun&&e.egTextRun.forEach((function(e){var t;null!=e&&null!==(t=e.r)&&void 0!==t&&t.t&&(r+=e.r.t)}))})),r}}]),n}(At),Nt=(n("4bbb5840d5"),n("281cbdced7")),Rt=n.n(Nt),jt=n("63945b6fba"),Ut=n.n(jt),Ft=n("14760ac5b0"),Bt=n.n(Ft),Vt=n("2f1cded8d8");function qt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ht(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qt(Object(n),!0).forEach((function(t){x()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Kt=["#B30000","#E6118F","#F1633A","#3646A0","#3184E9","#09A9B9","#822F1D","#C67600","#FFB400","#0D6C54","#918B3D","#7BB725"],Wt=function(){function e(t,n,r,a,i){var o=this;O()(this,e),x()(this,"myCursor",void 0),x()(this,"cursorMap",{}),x()(this,"colorCandidateList",Kt.slice()),x()(this,"colorMap",{}),x()(this,"debouncedUpdateCursor",Rt()((function(e){o.isSameCursorInfo(e,o.myCursor)||(o.myCursor=e,o.sendCursorInfo(e))}),100)),x()(this,"onUserEnter",(function(e){var t=e.userId;o.myCursor&&o.sendMyCursorToUser(t)})),x()(this,"onUserLeave",(function(e){var t=e.userId;delete o.cursorMap[t],o.event.emit(Vt.a.CursorInfoUpdate,{isNew:!1})})),x()(this,"onCursorMessage",(function(e){var t=e.userId,n=e.targetUserId,r=e.selection;o.logger.info("[cursor] handle cursor info from ".concat(t));var a={selection:r};!t||t===o.userId||o.isGuest(o.userId)||n&&n!==o.userId||o.isSameCursorInfo(o.cursorMap[t],a)||(o.logger.info("[cursor] cursor changed"),r.length?o.cursorMap[t]=a:delete o.cursorMap[t],o.event.emit(Vt.a.CursorInfoUpdate,{isNew:!n}))})),this.clientVarsService=t,this.userManager=n,this.event=r,this.sdkEventManager=a,this.logger=i,this.sdkEventManager.socketEvents.onUserEnter(this.onUserEnter),this.sdkEventManager.socketEvents.onUserLeave(this.onUserLeave),this.sdkEventManager.socketEvents.onCursorMessage(this.onCursorMessage)}var t;return N()(e,[{key:"userId",get:function(){var e;return null!==(e=this.clientVarsService.getClientVars().userId)&&void 0!==e?e:""}},{key:"updateCursor",value:function(e){this.debouncedUpdateCursor(e)}},{key:"elementCursors",get:function(){var e=this,t={};return Object.keys(this.cursorMap).forEach((function(n){n!==e.userId&&e.cursorMap[n].selection.forEach((function(r){t[r]||(t[r]=[]),t[r].push({userId:n,color:e.getColorForId(n)})}))})),t}},{key:"getUserName",value:function(e){var t=e.replace("p.","").replace("g.",""),n=this.userManager.getUserInfoFromCache(t);return n?n.markName:void 0}},{key:"reloadCursor",value:function(){this.event.emit(Vt.a.CursorInfoUpdate,{isNew:!1})}},{key:"sendCursorInfo",value:(t=o()(l.a.mark((function e(t,n){var r,a,i,o=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null==(i=null===(r=st.a.CollaborationManager())||void 0===r||null===(a=r.getSocket)||void 0===a?void 0:a.call(r))||!i.opened||this.isGuest(this.userId)||n&&this.isGuest(n))){e.next=3;break}return e.abrupt("return");case 3:i.sendMessage({cmd:"CURSOR_MESSAGE",taskId:0,data:JSON.stringify(Ht(Ht({userId:this.userId},t),{},{targetUserId:n})),onError:function(e,t,n,r){var a,i,c,s;if(0!==(null==r?void 0:r.errCode)||0!==(null==r||null===(a=r.response)||void 0===a||null===(i=a.onpost)||void 0===i?void 0:i.result)){var u=r.errCode,l=null===(c=r.response)||void 0===c||null===(s=c.onpost)||void 0===s?void 0:s.result;o.logger.info("[cursor] send cursor info failed, reason: post error ".concat(u,", retCode ").concat(l))}else o.logger.info("[cursor] send cursor info succeeded")}});case 4:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"sendMyCursorToUser",value:function(e){this.myCursor&&this.sendCursorInfo(this.myCursor,e)}},{key:"isSameCursorInfo",value:function(e,t){return!e&&!t||!(!e||!t)&&Ut()(Bt()(e.selection,t.selection))}},{key:"getColorForId",value:function(e){if(this.colorMap[e])return this.colorMap[e];this.colorCandidateList.length||(this.colorCandidateList=Kt.slice(0));var t=Math.floor(Math.random()*this.colorCandidateList.length),n=this.colorCandidateList.splice(t,1),r=Je()(n,1);return this.colorMap[e]=r[0],this.colorMap[e]}},{key:"isGuest",value:function(e){return null==e?void 0:e.startsWith("g.")}}]),e}(),Gt=(n("29f8c5f672"),n("db8ed0c20d")),Yt=n.n(Gt),Qt=(n("67d3be6cf9"),function(e){return e.replace("g.","").replace("p.","")}),Jt=function(){function e(t,n,r){O()(this,e),x()(this,"requestCache",new Map),x()(this,"getUserInfosPromise",void 0),this.clientVars=t,this.apiService=n,this.sdkEventManager=r,this.sdkEventManager.socketEvents.onUserEnter(this.onUserEnter.bind(this))}var t,n,r,a;return N()(e,[{key:"getUserInfoFromCache",value:function(e){return this.requestCache.get(e.toString())}},{key:"getUserInfosFromUids",value:(a=o()(l.a.mark((function e(t){var n,r,a,i=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[],r=[],Yt()(t).forEach((function(e){var t=i.requestCache.get(e.toString());t?n.push(t):r.push(e)})),r.length){e.next=5;break}return e.abrupt("return",n);case 5:return e.next=7,this.getAndCacheUserInfo(r);case 7:return a=e.sent,e.abrupt("return",[].concat(n,M()(a)));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"updateUserInfoCache",value:(r=o()(l.a.mark((function e(){var t,n,r=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getUserInfosByPadID();case 2:t=e.sent,null==(n=t.userInfos)||n.forEach((function(e){var t=e.reqUid,n=e.markName,a=void 0===n?"":n,i=e.userPic,o=void 0===i?"":i,c=e.corpName,s=void 0===c?"":c,u=e.anonymous,l={uid:t,markName:a,userPic:o,corpName:s,anonymous:void 0!==u&&u};r.requestCache.set(t.toString(),l)}));case 5:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"onUserEnter",value:function(e){if(e.userId){var t=Qt(e.userId);this.requestCache.has(t.toString())||this.getAndCacheAllUserInfos()}}},{key:"getAndCacheUserInfo",value:(n=o()(l.a.mark((function e(t){var n,r,a,i=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getUserInfosByPadID();case 2:return n=e.sent,r=n.userInfos,a=void 0===r?[]:r,e.abrupt("return",a.filter((function(e){return t.find((function(t){return e.uid===t||e.reqUid===t}))})).map((function(e){var t=e.reqUid,n=e.markName,r=void 0===n?"":n,a=e.userPic,o=void 0===a?"":a,c=e.corpName,s={uid:t,markName:r,userPic:o,corpName:void 0===c?"":c};return i.requestCache.set(t.toString(),s),s})));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getAndCacheAllUserInfos",value:function(){var e=this;this.getUserInfosPromise||(this.getUserInfosPromise=this.getUserInfosByPadID().then((function(t){var n=t.userInfos;null==n||n.forEach((function(t){var n=t.reqUid,r=t.markName,a=void 0===r?"":r,i=t.userPic,o=void 0===i?"":i,c=t.corpName,s=void 0===c?"":c,u=t.anonymous,l={uid:n,markName:a,userPic:o,corpName:s,anonymous:void 0!==u&&u};e.requestCache.set(n.toString(),l)})),e.getUserInfosPromise=void 0})))}},{key:"getUserInfosByPadID",value:(t=o()(l.a.mark((function e(){var t,n,r,a,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.clientVars.getClientVars(),n=t.globalPadId,r=void 0===n?"":n,e.prev=1,e.next=4,this.apiService.getUserInfosByPadID({bkn:null!==(a=this.getBkn())&&void 0!==a?a:0,tag:r,globalPadID:r});case 4:if(0===(i=e.sent).data.retcode){e.next=7;break}throw new Error("cgi error");case 7:return e.abrupt("return",{userInfos:i.data.result.rsp,totalCount:i.data.count});case 10:return e.prev=10,e.t0=e.catch(1),e.abrupt("return",{});case 13:case"end":return e.stop()}}),e,this,[[1,10]])}))),function(){return t.apply(this,arguments)})},{key:"getBkn",value:function(){var e=Object(h.getCookie)("skey"),t=0,n=5381;if(e){for(;0>t;++t)n+=(n<5)+e.charAt(t).charCodeAt(0);return 2147483647&n}}}]),e}(),zt=(n("22569efd03"),n("a7888a8b87")),Xt=n.n(zt),$t=function(){function e(t){O()(this,e),x()(this,"userList",[]),t.socketEvents.onUserEnter(this.onUserEnter.bind(this)),t.socketEvents.onUserLeave(this.onUserLeave.bind(this))}return N()(e,[{key:"onUserEnter",value:function(e){this.shouldBlockUser(e)||this.userIsExist(e.userId)||(this.userList.unshift(e),this.updateUserInfosInGlobal())}},{key:"onUserLeave",value:function(e){if(!this.shouldBlockUser(e)&&this.userIsExist(e.userId)){var t=this.userList.findIndex((function(t){return t.userId===e.userId}));this.userList.splice(t,1),this.updateUserInfosInGlobal()}}},{key:"updateUserInfosInGlobal",value:function(){window.clientVars.invitedUserInfos=Xt()(this.userList)}},{key:"userIsExist",value:function(e){return this.userList.find((function(t){return t.userId===e}))}},{key:"shouldBlockUser",value:function(e){var t=e.userId;if("doc.weixin.qq.com"===window.location.hostname){var n=Qt(t);if(!window.BigInt){var r=+n.slice(0,-9);return r<13102700&&r>13102695}return"3050709"===(BigInt(n)>>BigInt(32)).toString()}return!1}}]),e}(),Zt=(n("fce3077cdf"),n("cd88b12bb6"),n("38152ea618")),en=n.n(Zt),tn=n("9f996cd882"),nn=n.n(tn),rn=n("7264fb5e8f");function an(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function on(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?an(Object(n),!0).forEach((function(t){x()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):an(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var cn=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{timeout:rn.DEFAULT_SEND_MESSAGE_TIMEOUT,maxRetryCount:3,waitAcceptCmd:[]};O()(this,e),x()(this,"requestingPool",{}),this.logger=t,this.logPrefix=n,this.collaborationManager=r,this.commonCustomParam=a}var t,n;return N()(e,[{key:"send",value:(n=o()(l.a.mark((function t(n){var r,a,i,o,c,s=arguments;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=s.length>1&&void 0!==s[1]?s[1]:{},a=s.length>2&&void 0!==s[2]?s[2]:{},i=s.length>3&&void 0!==s[3]?s[3]:0,o=s.length>4?s[4]:void 0,c=nn()(JSON.stringify({cmd:n,data:r,customParam:a,taskId:i})).toString(),!this.requestingPool[c]){t.next=8;break}return this.logger.info("[".concat(this.logPrefix,"] REQUEST CMD <").concat(n,"> failed, reason: command is requseting")),t.abrupt("return",e.makeResponse(!1,{message:"command is requseting"}));case 8:return t.prev=8,this.requestingPool[c]=!0,t.next=12,this.sendDirectly(n,r,a,i,o);case 12:return t.abrupt("return",t.sent);case 13:return t.prev=13,delete this.requestingPool[c],t.finish(13);case 16:case"end":return t.stop()}}),t,this,[[8,,13,16]])}))),function(e){return n.apply(this,arguments)})},{key:"sendDirectly",value:(t=o()(l.a.mark((function t(n){var r,a,i,o,c,s=this,u=arguments;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=u.length>1&&void 0!==u[1]?u[1]:{},a=u.length>2&&void 0!==u[2]?u[2]:{},i=u.length>3&&void 0!==u[3]?u[3]:0,o=u.length>4?u[4]:void 0,c=on(on({},this.commonCustomParam),a),t.abrupt("return",new Promise((function(t){var a,u,l,d;null===(a=(u=s.collaborationManager).getSocket)||void 0===a||null===(l=a.call(u))||void 0===l||null===(d=l.sendMessage)||void 0===d||d.call(l,{cmd:n,taskId:i,data:JSON.stringify(r),customParam:c,additionalFieldsToHead:o,onError:function(n,r,a,i){if(i&&0!==i.errCode){var o=i.errCode;return s.logger.info("[".concat(s.logPrefix,"] REQUEST CMD <").concat(r,"> failed, reason: send error ").concat(o)),t(e.makeResponse(!1,{errorCode:o,message:"send error ".concat(o)}))}return t(e.makeResponse(!0))},onsend:function(n,r,a,i){var o,c,u=null==i?void 0:i.errCode,l=null==i||null===(o=i.response)||void 0===o||null===(c=o.onpost)||void 0===c?void 0:c.result;return 0!==u||0!==l?(s.logger.info("[".concat(s.logPrefix,"] REQUEST CMD <").concat(r,"> failed, reason: post error ").concat(u,", retCode ").concat(l)),t(e.makeResponse(!1,{errorCode:u,message:"post error ".concat(u,", retCode ").concat(l)}))):(s.logger.info("[".concat(s.logPrefix,"] REQUEST CMD <").concat(r,"> succeeded")),t(e.makeResponse(!0)))}})})));case 6:case"end":return t.stop()}}),t,this)}))),function(e){return t.apply(this,arguments)})}]),e}();x()(cn,"makeResponse",(function(e,t){return{success:e,error:t}}));var sn="CooperationLockV3",un=function(){function e(t,n,r,a,i,o){var c;O()(this,e),x()(this,"uid",void 0),x()(this,"requestManager",void 0),x()(this,"serverLockMap",{}),x()(this,"pollingAllLockInfoTimer",void 0),x()(this,"unlockTimer",void 0),x()(this,"bilateralDiff",(function(e,t){return[en()(e,t),en()(t,e)]})),this.clientVars=t,this.presentationStoreService=n,this.userManager=r,this.collaborationManager=a,this.event=i,this.sdkEventManager=o,this.requestManager=new cn(this.logger,sn,this.collaborationManager);var s=null!==(c=this.clientVars.getClientVars().userId)&&void 0!==c?c:"";s&&(this.uid=Qt(s)),this.sdkEventManager.socketEvents.onChangeToOnline(this.getAllLockInfo.bind(this)),this.sdkEventManager.socketEvents.onUserLeave(this.onUserLeave.bind(this)),this.sdkEventManager.socketEvents.onUserEnter(this.onUserLeave.bind(this)),this.sdkEventManager.socketEvents.onAllLockInfo(this.onLock.bind(this)),this.sdkEventManager.socketEvents.onUnlockInfo(this.onUnlock.bind(this))}var t,n,r,a;return N()(e,[{key:"lockById",value:(a=o()(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this.serverLockMap[t])){e.next=4;break}return this.logger.info("".concat(sn," lockById(").concat(t,") failed, reason: been locked")),e.abrupt("return",cn.makeResponse(!1,{message:"the page has been locked by ".concat(n.userId===this.uid?"you":"other")}));case 4:return e.abrupt("return",this.requestManager.send("LOCK",{},{},0,{pageid:t}));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"lockByIndex",value:(r=o()(l.a.mark((function e(t,n){var r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null===(r=this.getListByType(n)[t])||void 0===r?void 0:r.id){e.next=4;break}return this.logger.info("".concat(sn," lockByIndex(").concat(t,") failed, reason: not found")),e.abrupt("return",cn.makeResponse(!1,{message:"index ".concat(t," is not found")}));case 4:return e.abrupt("return",this.lockById(a));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"unlockById",value:function(e){var t=this.serverLockMap[e];return t&&t.userId!==this.uid?(this.logger.info("".concat(sn," unlockById(").concat(e,") failed, reason: been locked by others")),cn.makeResponse(!1,{message:"cannot unlock slide locked by others"})):this.requestManager.send("UNLOCK",{},{},0,{pageid:e})}},{key:"unlockByIndex",value:(n=o()(l.a.mark((function e(t,n){var r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null===(r=this.getListByType(n)[t])||void 0===r?void 0:r.id){e.next=4;break}return this.logger.info("".concat(sn," unlockByIndex(").concat(t,") failed, reason: not found")),e.abrupt("return",cn.makeResponse(!1,{message:"slideIndex ".concat(t," is not found")}));case 4:return e.abrupt("return",this.unlockById(a));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"lockInfo",get:function(){var e=this;return Object.keys(this.serverLockMap).map((function(t){return e.getLockInfoById(t,e.getTypeById(t))})).filter((function(e){return void 0!==e}))}},{key:"myLockInfo",get:function(){if(this.uid)return this.getLockInfoByUid(this.uid)}},{key:"unlockMyLockInFuture",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.UNLOCK_INTERVAL;this.logger.info("".concat(sn," unlockMyLockInFuture ").concat(n,")")),this.clearUnlockTimer(),this.unlockTimer=setTimeout((function(){t.clearUnlockTimer(),t.unlockMyLock()}),n)}},{key:"getLockInfoByIndex",value:function(e,t){var n,r=null===(n=this.getListByType(t)[e])||void 0===n?void 0:n.id;if(r)return this.getLockInfoById(r,t)}},{key:"unlockMyLock",value:function(){var e,t=null===(e=this.myLockInfo)||void 0===e?void 0:e.slide.id;if(t)return this.unlockById(t)}},{key:"logger",get:function(){return console}},{key:"getLockInfoById",value:function(e,t){var n=this.serverLockMap[e];if(n){var r=this.getListByType(t).findIndex((function(t){return t.id===e})),a=this.userManager.getUserInfoFromCache(n.userId);return{slide:{id:e,index:r},user:{uid:n.userId,isSelf:n.userId===this.uid,avatar:null==a?void 0:a.userPic,name:null==a?void 0:a.markName}}}}},{key:"getLockInfoByUid",value:function(e){var t=this,n=Qt(e);return Object.keys(this.serverLockMap).filter((function(e){var r;return(null===(r=t.serverLockMap[e])||void 0===r?void 0:r.userId)===n})).map((function(e){return t.getLockInfoById(e,t.getTypeById(e))}))[0]}},{key:"getAllLockInfo",value:(t=o()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.requestManager.send("GET_FULL_LOCK",{}));case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"refreshAllTimer",value:function(e){this.myLockInfo||this.clearUnlockTimer(),Object.keys(this.serverLockMap).length>0?this.startPollingAllLockInfo(!e):this.stopPollingAllLockInfo()}},{key:"startPollingAllLockInfo",value:function(){var t=this;if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])||!this.pollingAllLockInfoTimer){this.stopPollingAllLockInfo();var n=Date.now(),r=e.TIMEOUT_LOCK_CHECK_INTERVAL_MIN;!function a(){t.pollingAllLockInfoTimer=setTimeout((function(){Date.now()-n>18e5&&(r=e.TIMEOUT_LOCK_CHECK_INTERVAL_MAX),t.logger.info("".concat(sn," timeout lock check")),t.getAllLockInfo(),a()}),r)}()}}},{key:"stopPollingAllLockInfo",value:function(){this.pollingAllLockInfoTimer&&(clearTimeout(this.pollingAllLockInfoTimer),this.pollingAllLockInfoTimer=null)}},{key:"clearUnlockTimer",value:function(){this.unlockTimer&&(clearTimeout(this.unlockTimer),this.unlockTimer=null)}},{key:"getListByType",value:function(e){var t=this.presentationStoreService.getPresentation(),n=t.masterList,r=t.layoutList,a=t.sectionList,i=t.slideList;switch(e){case de.d.MASTER:return n;case de.d.LAYOUT:return r;case de.d.SECTION:return a;default:return i}}},{key:"getTypeById",value:function(e){var t=this.presentationStoreService.getPresentation();return t.getMasterById(e)?de.d.MASTER:t.getLayoutById(e)?de.d.LAYOUT:de.d.SLIDE}},{key:"onLock",value:function(e){var t=this,n=this.bilateralDiff(Object.keys(e),Object.keys(this.serverLockMap)),r=Je()(n,2),a=r[0],i=r[1],o=en()(Object.values(e).map((function(e){return e.userId})),Object.values(this.serverLockMap).map((function(e){return e.userId}))),c=i.map((function(e){return t.getLockInfoById(e,t.getTypeById(e))})).filter((function(e){return void 0!==e}));this.serverLockMap=e,this.refreshAllTimer(a.length>0),c.length&&(this.logger.info("".concat(sn," receive unlock: ").concat(i.join(","))),this.event.emit(Vt.a.Unlock,c));var s=this.lockInfo;a.length&&s.length&&(this.logger.info("".concat(sn," receive lock: ").concat(a.join(","))),this.event.emit(Vt.a.Lock,s)),o.length&&this.userManager.getUserInfosFromUids(o).then((function(){t.event.emit(Vt.a.LockInfoUpdate,t.lockInfo.slice())}))}},{key:"onUnlock",value:function(e){var t=e.pageid,n=this.getLockInfoById(t,this.getTypeById(t));n&&(delete this.serverLockMap[t],this.refreshAllTimer(!1),this.logger.info("".concat(sn," receive unlock: ").concat(t)),this.event.emit(Vt.a.Unlock,[n]))}},{key:"onUserLeave",value:function(e){var t=e.userId,n=this.getLockInfoByUid(t);n&&(Reflect.deleteProperty(this.serverLockMap,n.slide.id),this.refreshAllTimer(!1),this.logger.info("".concat(sn," receive user leave to unlock: ").concat(n.slide.id)),this.event.emit(Vt.a.Unlock,[n]))}}]),e}();x()(un,"TIMEOUT_LOCK_CHECK_INTERVAL_MIN",6e4),x()(un,"TIMEOUT_LOCK_CHECK_INTERVAL_MAX",3e5),x()(un,"UNLOCK_INTERVAL",6e4);var ln,dn,fn=un,hn=n("9a7f061d14"),vn=n("3c17f57670"),pn=n("9da6335152"),gn=n("d835d04d7a"),mn=n("025e3e9b74"),bn=n("5cdbac46e8"),yn=n("cc17a96b7f"),kn="[OnlineEditNoticeManager]",Sn=function(){function e(t,n,r,a){var i=this;O()(this,e),x()(this,"getAppServiceProviderPromise",void 0),this.logger=t,this.sdkEmitter=n,this.emitter=r,this.contentStatusManager=a,this.getAppServiceProviderPromise=new Promise((function(e){var t=i.emitter.on(Vt.a.AppServiceProviderLoaded,(function(n){t(),e(n)}))}));var o=this.emitter.on(Vt.a.LoadDocumentError,(function(e){var t,n,r,a;o(),vt.c.getInstance().hide(),vt.c.getInstance().show({message:(null==e||null===(t=e.details)||void 0===t?void 0:t.message)||ee.a.t("文档打开失败，请刷新重试"),commonTipsType:vt.b.INFO,onlyShowOne:!0,actionType:(null==e||null===(n=e.details)||void 0===n?void 0:n.actionType)||vt.a.HOWTODEAL}),null===(r=i.logger.monitor)||void 0===r||null===(a=r.reportStatus)||void 0===a||a.call(r,"fetchChunkData",gn.a.ERROR,null==e?void 0:e.toString(),[i.getGlobalPadId(),"".concat(xt.network.isOnline)]),i.logger.error("".concat(kn," LoadDocumentError, ").concat(null==e?void 0:e.toString()))})),c=this.emitter.on(Vt.a.LoadDocumentAllChunksSuccess,(function(e){var t,n;c(),null===(t=(n=i.logger).tdw)||void 0===t||t.call(n,{opername:pn.e.DOC_PPT,module:pn.d.PPT,action:pn.b.LOAD_DOC,ver6:JSON.stringify(e)})}));this.contentStatusManager.emitter.on(v.a.LoadError,(function(e){var t,n,r,a;null===(t=(n=i.logger).tdw)||void 0===t||t.call(n,{opername:pn.e.DOC_PPT,module:pn.d.PPT,action:pn.b.BROKEN_DOC}),null===(r=i.logger.monitor)||void 0===r||null===(a=r.reportStatus)||void 0===a||a.call(r,pn.b.BROKEN_DOC,gn.a.ERROR,null==e?void 0:e.toString(),[i.getGlobalPadId()]),vt.c.getInstance().hide(),vt.c.getInstance().show({message:ee.a.t("文档数据异常，请刷新重试"),commonTipsType:vt.b.ERROR,onlyShowOne:!0,actionType:vt.a.HOWTODEAL,callBack:function(){var e,t;null===(e=(t=i.logger).tdw)||void 0===e||e.call(t,{opername:pn.e.DOC_PPT,module:pn.d.PPT,action:pn.b.EXPORT_BROKEN_DOC})}}),i.logger.error("".concat(kn," LoadError, ").concat(null==e?void 0:e.toString()),[i.getGlobalPadId(),"".concat(xt.network.isOnline)])})),st.a.OTTransformManager.promise().then((function(e){e.supported||vt.c.getInstance().show({message:ee.a.t("当前环境只支持查看，请下载最新版客户端或Chrome浏览器"),commonTipsType:vt.b.INFO,onlyShowOne:!0,closable:!0})})),"meeting-room"===window.entry||Object(yn.b)()||this.preventEditWhenNotReady()}var t,n,r;return N()(e,[{key:"preventEditWhenNotReady",value:(r=o()(l.a.mark((function e(){var t,n,r,a=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.waitForUserPriviledgeServiceReady();case 2:if(t=e.sent,!d.a.IS_WENKU){e.next=7;break}return vt.c.getInstance().show({message:ee.a.t("已保存至腾讯文档，可下载到本地保存"),commonTipsType:vt.b.INFO,closable:!1,block:!1,actionType:vt.a.EXPORT,actionText:ee.a.t("下载"),autoClose:!0,duration:3e3}),Object(p.b)(o()(l.a.mark((function e(){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.pptEditorState,t.setPPTEditorState({state:bn.a.COPYABLE}),r=t.addStateWillChangeCallbacks((function(){return!1})),e.next=5,a.collaborationReady();case 5:r(),t.setPPTEditorState({state:n});case 7:case"end":return e.stop()}}),e)})))),e.abrupt("return");case 7:n="initial-tips-id",r=setTimeout((function(){!Ve.default.isMobile&&vt.c.getInstance().show({id:n,message:ee.a.t("文档正在加载中，请稍候"),commonTipsType:vt.b.INFO,closable:!0,block:!1})}),5e3),Object(p.b)(o()(l.a.mark((function e(){var i,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.pptEditorState,t.setPPTEditorState({state:bn.a.COPYABLE}),o=t.addStateWillChangeCallbacks((function(){return!1})),e.next=5,a.collaborationReady();case 5:o(),t.setPPTEditorState({state:i}),vt.c.getInstance().hideById(n),clearTimeout(r);case 9:case"end":return e.stop()}}),e)}))));case 10:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getGlobalPadId",value:function(){var e,t;return null!==(e=null===(t=p.a.DocInfoManager())||void 0===t?void 0:t.globalPadId)&&void 0!==e?e:""}},{key:"collaborationReady",value:function(){var e=this;return new Promise((function(t){var n=e.sdkEmitter.on(mn.a.StatusChange,(function(e){e===hn.b.Ready&&(n(),t())}))}))}},{key:"waitForUserPriviledgeServiceReady",value:(n=o()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.getAppServiceProviderPromise.then((function(e){return e.viewableServiceLayer.userPriviledgeService})));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"waitForAnonymousViewServiceReady",value:(t=o()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.getAppServiceProviderPromise.then((function(e){return e.viewableServiceLayer.anonymousViewService.promise()})));case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),wn=n("fe82ecf3fc"),In=n("4c52987e8a"),Dn=n("e516279ea9"),On=n("b04733d69b"),Cn=n.n(On),xn=n("b6035c5438"),Pn=n.n(xn),En=(n("ab67fd3ad5"),ee.a.t("无标题幻灯片")),Tn=new WeakMap,An=function(){function e(){var t=this;O()(this,e),Tn.set(this,{writable:!0,value:void 0}),x()(this,"updateCreateDocInfo",(function(e){Cn()(t,Tn,{secretId:e.secretId,globalPadId:e.globalPadId,title:e.title,folder:e.folder})}))}return N()(e,[{key:"newDocInfo",get:function(){return Pn()(this,Tn)||Cn()(this,Tn,{secretId:this.secretId,globalPadId:this.globalPadId,title:this.title,folder:this.folder}),Pn()(this,Tn)}},{key:"uid",get:function(){return Object(ye.getCookieUid)()||""}},{key:"uin",get:function(){return window.isInWorker?"":Object(ye.getCookieUin)()||""}},{key:"secretId",get:function(){return window.location.pathname.split("/").pop()||""}},{key:"secretId4New",get:function(){return this.newDocInfo.secretId||this.secretId}},{key:"globalPadId",get:function(){var e,t;return Object(h.getQuery)("globalPadId")||(null===(e=p.a.DocInfoManager())||void 0===e?void 0:e.globalPadId)||(null===(t=window.clientVars)||void 0===t?void 0:t.globalPadId)}},{key:"globalPadId4New",get:function(){return this.newDocInfo.globalPadId||this.globalPadId}},{key:"localPadId",get:function(){return Object(h.getQuery)("localPadId")||""}},{key:"title",get:function(){return Object(ne.b)("title")}},{key:"title4New",get:function(){return this.newDocInfo.title||this.title||En}},{key:"folder",get:function(){return Object(h.getQuery)("folder")}},{key:"folder4New",get:function(){return this.newDocInfo.folder||this.folder||"/"}},{key:"isOnlineBorrowed",get:function(){return Object(h.getQuery)("isOnlineBorrowed")}},{key:"isNewCreate",value:function(){return!!Object(h.getQuery)("new")}},{key:"isOnline",value:function(){return xt.network.isOnline}},{key:"createMessageSeq",value:function(){var e=(new Date).getTime(),t=Math.ceil(2147483648*Math.random());return t+=e}}]),e}(),_n=n("10f9b6de11"),Mn=n("e447b6c213"),Ln=n("c0a011bd89");!function(e){e[e.InitUnlaunch=0]="InitUnlaunch",e[e.Initing=1]="Initing",e[e.InitException=2]="InitException",e[e.InitFinish=3]="InitFinish",e[e.InitTimeout=4]="InitTimeout"}(ln||(ln={})),function(e){e.set="set",e.update="update",e.updateField="updateField",e.delete="delete",e.get="get",e.getAll="getAll"}(dn||(dn={}));var Nn,Rn=window,jn="[DBH]",Un=function(){function e(t){var n=this;O()(this,e),x()(this,"dataManager",void 0),x()(this,"mutexTabLockReason",void 0),x()(this,"DBstatus",ln.InitUnlaunch),x()(this,"DBStatusPromise",void 0),x()(this,"mutexTabLock",void 0),x()(this,"opCheckFirst",(function(e){var t=new Mn.j(void 0,void 0);if(!e.type||!e.tableName){var n="oprate or tableName is undefine.";Rn.log.error("".concat(n)),t.error=new Mn.c(n)}return t})),x()(this,"opCheckSecond",(function(e){var t=new Mn.j(void 0,void 0);if((e.type===dn.set||e.type===dn.update||e.type===dn.delete)&&n.mutexTabLockReason){var r="has not mutexLock, can not write indexDB ";n.logger.error("".concat(r)),t.error=new Mn.c(r)}return t})),this.logger=t,this.logger.info(jn,"constructor"),this.dataManager=new Ln.g({businessType:_n.DOCUMENT_TYPE.slide}),Ve.default.isSupportNativeDatabase?this.mutexTabLock=new Ln.b:this.mutexTabLock=new Ln.e,this.dataManageInit()}var t,n,r;return N()(e,[{key:"getUnCommittedOfflineData",value:function(){var e=this;return this.promiseWithTimeout((function(t,n){var r=function(t){e.logger.error(jn,"getUnCommittedOfflineData error:",t),n(t)},a=e.getSlideHelper();if(a)return a.getUncommitedOfflineData().then(t).catch((function(e){return r(null==e?void 0:e.toString())})),r;r("slideHelper is undefined")}),1e4)}},{key:"lock",value:function(e){var t=this;return this.promiseWithTimeout((function(n,r){var a=function(e){t.logger.error(jn,"lock error:",e),r(e)};return t.mutexTabLock.lock("offline_".concat(e),{source:"edit"}).then(n).catch((function(e){return a(null==e?void 0:e.toString())})),a}))}},{key:"release",value:function(e){var t=this;return this.promiseWithTimeout((function(n,r){var a=function(e){t.logger.error(jn,"release error:",e),r(e)};return t.mutexTabLock.release("offline_".concat(e)).then(n).catch((function(e){return a(null==e?void 0:e.toString())})),a}))}},{key:"disConnect",value:function(){var e=this;return this.promiseWithTimeout((function(t,n){var r=function(t){e.logger.error(jn,"disConnect error:",t),n(t)},a=e.getDataBase();if(a)return a.disConnect().then(t).catch((function(e){return r(null==e?void 0:e.toString())})),r;r("database is undefined")}))}},{key:"handleDataFromIndexDB",value:(r=o()(l.a.mark((function e(t){var n,r,a,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this.opCheckFirst(t)).error){e.next=3;break}return e.abrupt("return",n);case 3:if(!(r=this.opCheckSecond(t)).error){e.next=6;break}return e.abrupt("return",r);case 6:if(a=this.getDataBase()){e.next=9;break}throw new Error("database is undefined");case 9:return e.next=11,this.handleOpWithTimeout(a,t);case 11:return i=e.sent,e.abrupt("return",i);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"dataManageInit",value:function(){var e=this,t=+new Date;this.DBstatus=ln.Initing,this.DBStatusPromise=this.promiseWithTimeout((function(n,r){var a=function(t){e.DBstatus=ln.InitException,e.logger.error(jn,"dataManageInit error:",t),r(t)};return e.dataManager.init().then((function(r){r.error?a(r.error.message):(e.DBstatus=ln.InitFinish,e.logger.info(jn,"dataManageInit cost ".concat(+new Date-t,"ms status: success")),n(e.DBstatus))})).catch((function(e){a(null==e?void 0:e.toString())})),a}),1e4)}},{key:"handleOpWithTimeout",value:function(e,t){var n=this;return this.promiseWithTimeout((function(r,a){var i=function(e){n.logger.error(jn,"DB Operation",t.type,e),a(e)};return n.handleOp(e,t).then(r).catch((function(e){i(null==e?void 0:e.toString())})),i}))}},{key:"handleOp",value:(n=o()(l.a.mark((function e(t,n){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new Mn.j(void 0,void 0),e.t0=n.type,e.next=e.t0===dn.set?4:e.t0===dn.update?5:e.t0===dn.updateField?6:e.t0===dn.delete?9:e.t0===dn.get?12:e.t0===dn.getAll?15:18;break;case 4:return e.abrupt("return",t.set(n.tableName,n.data));case 5:return e.abrupt("return",t.update(n.tableName,n.data));case 6:if(!n.where){e.next=8;break}return e.abrupt("return",t.updateField(n.tableName,n.where,n.data));case 8:case 11:case 14:case 17:case 18:return e.abrupt("break",19);case 9:if(!n.where){e.next=11;break}return e.abrupt("return",t.delete(n.tableName,n.where));case 12:if(!n.where){e.next=14;break}return e.abrupt("return",t.get(n.tableName,n.where));case 15:if(!n.where){e.next=17;break}return e.abrupt("return",t.getAll(n.tableName,n.where));case 19:return e.abrupt("return",r);case 20:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"getDataBase",value:function(){return this.dataManager.getDatabase()}},{key:"getSlideHelper",value:function(){return this.dataManager.getHelper(_n.DOCUMENT_TYPE.slide)}},{key:"promiseWithTimeout",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;return new Promise((function(r,a){var i,o={reject:function(e){}},c=setTimeout((function(){return o.reject("timeout")}),n),s=function(e){var n,r;clearTimeout(c),t.dispatchDBError(e),null===(n=t.logger.monitor)||void 0===n||null===(r=n.reportStatus)||void 0===r||r.call(n,"DBHelper",gn.a.ERROR,e),a(e)};o.reject=null!==(i=e((function(e){clearTimeout(c),r(e)}),s))&&void 0!==i?i:s}))}},{key:"dispatchDBError",value:(t=o()(l.a.mark((function e(t){var n,r,a,i,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,st.a.CollaborationManager.promise();case 2:if(e.t1=n=e.sent,e.t0=null===e.t1,e.t0){e.next=6;break}e.t0=void 0===n;case 6:if(!e.t0){e.next=10;break}e.t2=void 0,e.next=11;break;case 10:e.t2=null===(r=n.getPersistent)||void 0===r?void 0:r.call(n);case 11:null==(o=e.t2)||null===(a=(i=o).handleDatabaseError)||void 0===a||a.call(i,t,"desktop",!0);case 13:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}(),Fn=n("a8a4b19997"),Bn=n("a24c6cbd03"),Vn=function(){function e(){O()(this,e)}var t;return N()(e,null,[{key:"offlineApi",value:(t=o()(l.a.mark((function t(){var r,a,i,o,c;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.offlineApiInstance){t.next=11;break}return r={user:{uid:Object(Fn.getUid)()||""},requestParams:{xsrf:Object(ae.b)()},getDataVersion:function(){return Bn.b},monitorReporter:{report:function(){}},useNativeDB:Ve.default.isSupportNativeDatabase},t.next=4,Promise.all([n.e("commonAsync~9b1fde68"),n.e("commonAsync~27f19aac"),n.e("commonAsync~205ac551"),n.e("commonAsync~0c3a6025"),n.e("commonAsync~32e631b8"),n.e("commonAsync~08369118"),n.e("commonAsync~50db4bb8"),n.e("commonAsync~86c92fed"),n.e("commonAsync~a95f944a"),n.e("commonAsync~6e568190"),n.e("commonAsync~b174e5ca"),n.e("commonAsync~54a68610"),n.e("commonAsync~61b3c105"),n.e("commonAsync~f7b3ac00"),n.e("commonAsync~cece21d6"),n.e("commonAsync~ecbf7682"),n.e("commonAsync~6c5dfa7c"),n.e("commonAsync~90483627"),n.e("commonAsync~d2c096c2"),n.e("commonAsync~1285a477"),n.e("commonAsync~31ded9a0"),n.e("commonAsync~ecdbff9b"),n.e("commonAsync~c2cc425c"),n.e("commonAsync~4fb44df2"),n.e("commonAsync~d06fe423"),n.e("commonAsync~0519277e"),n.e("commonAsync~6df2b9ea"),n.e("commonAsync~b5c4f9e4"),n.e("commonAsync~ffdf5190"),n.e("commonAsync~127b6cf7"),n.e("commonAsync~b3c4a2ff"),n.e("commonAsync~19bb5a55"),n.e(6)]).then(n.bind(null,"b69782f96f"));case 4:return a=t.sent,i=a.DocumentAdapterFactory,o=a.OfflineApi,t.next=9,i.createAdapter(_n.DOCUMENT_TYPE.slide);case 9:c=t.sent,e.offlineApiInstance=new o(c,r);case 11:return t.abrupt("return",e.offlineApiInstance);case 12:case"end":return t.stop()}}),t)}))),function(){return t.apply(this,arguments)})}]),e}();function qn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Hn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qn(Object(n),!0).forEach((function(t){x()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Kn(e,t){var n,r,a,i,o,c=Date.now()/1e3,s=t.uid,u=t.uin,l=t.folder,d=new Ln.i({uid:s,uin:u}),f=new Ln.h(d),h=null!==(n=null==e||null===(r=e.collab_client_vars)||void 0===r||null===(a=r.client)||void 0===a?void 0:a.upid)&&void 0!==n?n:"",v=e.domainId,p=void 0===v?"":v,g=e.globalPadId,m=void 0===g?"":g,b=e.title,y=void 0===b?"":b,k=e.padId,S=void 0===k?"":k,w=e.localPadId,I=void 0===w?"":w,D=e.padStatus;return Hn(Hn({},f),{},{globalPadId:m,uid:t.uid,key:t.uid+m,type:_n.DOCUMENT_TYPE.slide,doc_type:_n.DOCUMENT_TYPE.slide,doc_type_desc:_n.DOCUMENT_TYPE_DESC.slide,status:D||_n.DOCUMENT_STATUS.normal,dver:null!==(i=null==e||null===(o=e.collab_client_vars)||void 0===o?void 0:o.dver)&&void 0!==i?i:Bn.b,pad_id:S||I,domain_id:p,secretId:h,title:y,folder:l,creator:s,creator_domain:p,isOfflineCache:!0,create_ts:c,last_modify_ts:c,last_browse_ts:c,lastSyncTime:c,isRencent:!0,doc_url:"//".concat(window.hostname,"/slide/").concat(h)})}x()(Vn,"offlineApiInstance",void 0),function(e){e.GLOBAL="globalPadId",e.SECRET="secretId"}(Nn||(Nn={}));var Wn="[ODBS]",Gn=function e(t,n){var r=this;O()(this,e),x()(this,"dbHelper",void 0),x()(this,"createFileSuccess",void 0),x()(this,"waitForDBManagerReady",o()(l.a.mark((function e(){var t,n,a,i,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.dbHelper.DBstatus!==ln.InitFinish){e.next=3;break}return r.logger.info(Wn,"already init finish"),e.abrupt("return",!0);case 3:return e.prev=3,e.next=6,r.dbHelper.DBStatusPromise;case 6:return t=e.sent,r.logger.info(Wn,"waitForDBManagerReady success",t),e.abrupt("return",!0);case 11:return e.prev=11,e.t0=e.catch(3),null===(n=(a=r.logger).tdw)||void 0===n||n.call(a,{opername:"quality_slide",module:"offline-edit",action:"client-db-open-error",ver6:null===e.t0||void 0===e.t0||null===(i=e.t0.toString)||void 0===i?void 0:i.call(e.t0)}),r.logger.error(Wn,"waitForDBManagerReady error: ".concat(null===e.t0||void 0===e.t0||null===(o=e.t0.toString)||void 0===o?void 0:o.call(e.t0))),e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,null,[[3,11]])})))),x()(this,"lock",o()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.dbHelper.lock(r.context.secretId);case 3:if(e.sent.isSuccess){e.next=6;break}throw new Error("lock fail");case 6:return r.logger.info(Wn,"lock success"),e.abrupt("return",!0);case 10:return e.prev=10,e.t0=e.catch(0),r.logger.info(Wn,"lock fail",null===e.t0||void 0===e.t0?void 0:e.t0.toString()),e.abrupt("return",!1);case 14:case"end":return e.stop()}}),e,null,[[0,10]])})))),x()(this,"release",o()(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.dbHelper.disConnect();case 3:return e.next=5,r.dbHelper.release(r.context.secretId);case 5:return t=e.sent,r.logger.info(Wn,"release",t),e.abrupt("return",t);case 10:return e.prev=10,e.t0=e.catch(0),r.logger.error(Wn,"release catch error:",e.t0),e.abrupt("return",!1);case 14:case"end":return e.stop()}}),e,null,[[0,10]])})))),x()(this,"updateMultiTableData",function(){var e=o()(l.a.mark((function e(t,n){var a,i,o,c,s,u,d,f,h;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.getPadInfo(r.context.globalPadId);case 3:return a=e.sent,i=r.updateDocumentData(t),o=r.updatePadInfo({padInfo:n,isAlreadyExist:!!a}),e.next=8,Promise.all([i,o]);case 8:return c=e.sent,s=Je()(c,2),u=s[0],d=s[1],e.abrupt("return",{error:u.error||d.error||""});case 15:return e.prev=15,e.t0=e.catch(0),e.abrupt("return",{error:null!==(f=null===e.t0||void 0===e.t0||null===(h=e.t0.toString)||void 0===h?void 0:h.call(e.t0))&&void 0!==f?f:"error",data:null});case 18:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t,n){return e.apply(this,arguments)}}()),x()(this,"getPadInfo",function(){var e=o()(l.a.mark((function e(t){var n,a,i,o,c=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=c.length>1&&void 0!==c[1]?c[1]:Nn.GLOBAL,e.prev=1,a=Mn.i.newInstance().addCondition("uid",Mn.h.ONLY,r.context.uid),e.t0=n,e.next=e.t0===Nn.GLOBAL?6:e.t0===Nn.SECRET?8:10;break;case 6:return a.addCondition("globalPadId",Mn.h.ONLY,t),e.abrupt("break",10);case 8:return a.addCondition("secretId",Mn.h.ONLY,t),e.abrupt("break",10);case 10:return e.next=12,r.dbHelper.handleDataFromIndexDB({tableName:_n.TABLE_NAME.padinfo,type:dn.get,where:a});case 12:i=e.sent,o=i.data;try{"string"==typeof o&&(o=JSON.parse(o))}catch(e){r.logger.error(Wn,"getPadInfo parse catch error:",e)}return e.abrupt("return",i.error?null:o);case 18:return e.prev=18,e.t1=e.catch(1),r.logger.error(Wn,"getPadInfo catch error: ",e.t1),e.abrupt("return",null);case 22:case"end":return e.stop()}}),e,null,[[1,18]])})));return function(t){return e.apply(this,arguments)}}()),x()(this,"getClientVarsFromDB",o()(l.a.mark((function e(){var t,n,a,i,o,c,s,u;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=r.context,a=n.uid,i=n.secretId,o=Mn.i.newInstance().addCondition("secretId",Mn.h.ONLY,i).addCondition("type",Mn.h.IN,[_n.DOCUMENT_DATA_TYPE.init]).addCondition("uid",Mn.h.ONLY,a),e.next=5,r.dbHelper.handleDataFromIndexDB({type:dn.get,tableName:_n.TABLE_NAME.documentData,where:o});case 5:return c=e.sent,e.abrupt("return",{error:c.error,data:null===(t=c.data)||void 0===t?void 0:t.data});case 9:return e.prev=9,e.t0=e.catch(0),r.logger.error(Wn,"getClientVarsFromDB catch error: ",e.t0),e.abrupt("return",{error:null!==(s=null===e.t0||void 0===e.t0||null===(u=e.t0.toString)||void 0===u?void 0:u.call(e.t0))&&void 0!==s?s:"error",data:null});case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))),x()(this,"createFile",o()(l.a.mark((function e(){var t,n,a,i,o,c,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.createFileSuccess){e.next=2;break}return e.abrupt("return",{error:"createFile is already success, no duplicate create"});case 2:return t=r.context,n=t.secretId4New,a=t.folder4New,e.next=5,Vn.offlineApi();case 5:return e.next=7,e.sent.createOnlineDocumentToDetail(n,_n.DOCUMENT_TYPE.slide,a);case 7:return i=e.sent,o=i.isSuccess,c=i.clientVars,s=i.reason,r.createFileSuccess=!!o,e.abrupt("return",{error:o?"":s||"error",data:c});case 13:case"end":return e.stop()}}),e)})))),x()(this,"updateDocumentData",function(){var e=o()(l.a.mark((function e(t){var n,a,i,o,c,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.context,a=n.uid,i=n.secretId,o=Mn.i.newInstance().addCondition("secretId",Mn.h.ONLY,i).addCondition("type",Mn.h.IN,[_n.DOCUMENT_DATA_TYPE.init]).addCondition("uid",Mn.h.ONLY,a),r.logger.info(Wn,"ready to updateDocumentData"),e.prev=3,e.next=6,r.dbHelper.handleDataFromIndexDB({type:dn.update,tableName:_n.TABLE_NAME.documentData,data:t,where:o});case 6:if(!(c=e.sent).error){e.next=9;break}throw c.error;case 9:return e.abrupt("return",c);case 12:return e.prev=12,e.t0=e.catch(3),e.abrupt("return",{error:null!==(s=null===e.t0||void 0===e.t0?void 0:e.t0.toString())&&void 0!==s?s:"error",data:null});case 15:case"end":return e.stop()}}),e,null,[[3,12]])})));return function(t){return e.apply(this,arguments)}}()),x()(this,"updatePadInfo",function(){var e=o()(l.a.mark((function e(t){var n,a,i,o,c,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.context,a=n.uid,i=n.globalPadId,t.isAlreadyExist&&(o=(new Mn.i).addCondition("globalPadId",Mn.h.ONLY,i).addCondition("uid",Mn.h.ONLY,a)),r.createFileSuccess&&t.padInfo.status!==_n.DOCUMENT_STATUS.normal&&(t.padInfo.status=_n.DOCUMENT_STATUS.normal),e.prev=3,e.next=6,r.dbHelper.handleDataFromIndexDB({type:o?dn.updateField:dn.update,tableName:_n.TABLE_NAME.padinfo,data:t.padInfo,where:o});case 6:if(!(c=e.sent).error){e.next=9;break}throw c.error;case 9:return e.abrupt("return",c);case 12:return e.prev=12,e.t0=e.catch(3),e.abrupt("return",{error:null!==(s=null===e.t0||void 0===e.t0?void 0:e.t0.toString())&&void 0!==s?s:"error",data:null});case 15:case"end":return e.stop()}}),e,null,[[3,12]])})));return function(t){return e.apply(this,arguments)}}()),x()(this,"updateOfflineData",function(){var e=o()(l.a.mark((function e(t){var n,a,i,o,c,s,u,d,f;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.context,a=n.uid,i=n.secretId,o=n.globalPadId,c=Mn.i.newInstance().addCondition("globalPadId",Mn.h.ONLY,o).addCondition("secretId",Mn.h.ONLY,i).addCondition("type",Mn.h.IN,[_n.DOCUMENT_DATA_TYPE.committing,_n.DOCUMENT_DATA_TYPE.waiting,_n.DOCUMENT_DATA_TYPE.queue]).addCondition("uid",Mn.h.ONLY,a),e.prev=2,!t){e.next=10;break}return e.next=6,r.dbHelper.handleDataFromIndexDB({type:dn.update,tableName:_n.TABLE_NAME.offlineData,data:t,where:c});case 6:if(!(s=e.sent).error){e.next=9;break}throw s.error;case 9:return e.abrupt("return",s);case 10:return e.next=12,r.dbHelper.handleDataFromIndexDB({type:dn.delete,tableName:_n.TABLE_NAME.offlineData,where:c});case 12:if(!(u=e.sent).error){e.next=15;break}throw u.error;case 15:return e.abrupt("return",u);case 18:return e.prev=18,e.t0=e.catch(2),e.abrupt("return",{error:null!==(d=null===e.t0||void 0===e.t0||null===(f=e.t0.toString)||void 0===f?void 0:f.call(e.t0))&&void 0!==d?d:"error",data:null});case 21:case"end":return e.stop()}}),e,null,[[2,18]])})));return function(t){return e.apply(this,arguments)}}()),x()(this,"getUnCommittedOfflineData",o()(l.a.mark((function e(){var t,n,a,i,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.context.secretId,e.prev=1,e.next=4,r.dbHelper.getUnCommittedOfflineData();case 4:if(a=e.sent,Array.isArray(a.data)){e.next=7;break}throw new Error("getUnCommittedOfflineData data is null");case 7:return i=a.data.filter((function(e){return e.secretId===t})),e.abrupt("return",{error:"",data:null!==(n=i[0])&&void 0!==n?n:null});case 11:return e.prev=11,e.t0=e.catch(1),e.abrupt("return",{error:(null===e.t0||void 0===e.t0||null===(o=e.t0.toString)||void 0===o?void 0:o.call(e.t0))||"error",data:null});case 14:case"end":return e.stop()}}),e,null,[[1,11]])})))),x()(this,"updateIsManualOffline",function(){var e=o()(l.a.mark((function e(t){var n,a,i,o,c,s,u,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.context,a=n.uid,i=n.globalPadId,o=Mn.i.newInstance().addCondition("globalPadId",Mn.h.ONLY,i).addCondition("uid",Mn.h.ONLY,a),c={isManualOffline:t},r.logger.info(Wn,"updateIsManualOffline"),e.prev=4,e.next=7,r.dbHelper.handleDataFromIndexDB({type:dn.updateField,tableName:_n.TABLE_NAME.padinfo,where:o,data:c});case 7:if(!(s=e.sent).error){e.next=10;break}throw s.error;case 10:return e.abrupt("return",s);case 13:return e.prev=13,e.t0=e.catch(4),e.abrupt("return",{error:null!==(u=null===e.t0||void 0===e.t0||null===(d=e.t0.toString)||void 0===d?void 0:d.call(e.t0))&&void 0!==u?u:"error",data:null});case 16:case"end":return e.stop()}}),e,null,[[4,13]])})));return function(t){return e.apply(this,arguments)}}()),x()(this,"getAllManualOfflinePadInfo",o()(l.a.mark((function e(){var t,n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Mn.i.newInstance().addCondition("uid",Mn.h.ONLY,r.context.uid).addCondition("isManualOffline",Mn.h.ONLY,!0),e.prev=1,e.next=4,r.dbHelper.handleDataFromIndexDB({type:dn.getAll,tableName:_n.TABLE_NAME.padinfo,where:t});case 4:if(!(n=e.sent).error){e.next=7;break}throw n.error;case 7:return e.abrupt("return",n);case 10:return e.prev=10,e.t0=e.catch(1),e.abrupt("return",{error:null!==(a=null===e.t0||void 0===e.t0?void 0:e.t0.toString())&&void 0!==a?a:"error",data:null});case 13:case"end":return e.stop()}}),e,null,[[1,10]])})))),this.context=t,this.logger=n,this.dbHelper=new Un(this.logger),this.createFileSuccess=!1},Yn="[offline-edit-cache-service]",Qn=function(){function e(t,n,r,a){var i=this;O()(this,e),x()(this,"isManualOffline",o()(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.DBService.getPadInfo(i.context.secretId,Nn.SECRET);case 2:return t=e.sent,e.abrupt("return",!(null==t||!t.isManualOffline));case 4:case"end":return e.stop()}}),e)})))),x()(this,"toggleIsManualOffline",o()(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.isManualOffline();case 2:if(!e.sent){e.next=8;break}return e.next=6,i.cancelManualOffline();case 6:return t=e.sent,e.abrupt("return",!!t);case 8:return e.next=10,i.setManualOffline();case 10:return n=e.sent,e.abrupt("return",!!n);case 12:case"end":return e.stop()}}),e)})))),x()(this,"cancelManualOffline",o()(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.logger.info(Yn,"cancelManualOffline ready to getAllManualOfflinePadInfo"),e.next=3,i.handlerUpdateIsManualOffline(!1);case 3:return t=e.sent,i.logger.info(Yn,"cancelManualOffline handlerUpdateIsManualOffline result",t),Mn.g.invokeNative("docx","removeManualSaveDoc",{docUrl:i.docUrl},(function(){})),i.notifyNative(2),e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})))),x()(this,"setManualOffline",o()(l.a.mark((function e(){var t,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.logger.info(Yn,"ready to getAllManualOfflinePadInfo"),e.next=3,i.DBService.getAllManualOfflinePadInfo();case 3:if(!(n=e.sent).error){e.next=8;break}return i.logger.error(Yn,"getAllManualOfflinePadInfo",n.error),i.snackbar.show({message:ee.a.t("缓存失败，请稍后重试"),type:"error"}),e.abrupt("return",!1);case 8:if(!((null===(t=n.data)||void 0===t?void 0:t.length)>=Bn.d)){e.next=11;break}return i.snackbar.show({message:ee.a.t("已达到上限，请取消其他缓存的文档后再试。"),type:"error"}),e.abrupt("return",!1);case 11:return e.next=13,i.handlerUpdateIsManualOffline(!0);case 13:return r=e.sent,i.logger.info(Yn,"setManualOffline handlerUpdateIsManualOffline result",r),Mn.g.invokeNative("docx","manualSaveDocData",{docUrl:i.docUrl},(function(){})),i.notifyNative(1),e.abrupt("return",r);case 18:case"end":return e.stop()}}),e)})))),x()(this,"notifyNative",(function(e){Mn.g.invokeNative("docx","notifyNative",{status:e,url:i.docUrl,retCode:0,globalPadId:i.context.globalPadId,source:"edit"},(function(){}))})),x()(this,"handlerUpdateIsManualOffline",function(){var e=o()(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.DBService.updateIsManualOffline(t);case 2:if(!e.sent.error){e.next=6;break}return i.snackbar.show({message:ee.a.t(t?"缓存失败，请稍后重试":"取消缓存失败，请稍后重试。"),type:"error"}),e.abrupt("return",!0);case 6:return i.snackbar.show({message:ee.a.t(t?"成功缓存该文档":"已取消缓存该文档"),type:"success"}),e.abrupt("return",!1);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.context=t,this.DBService=n,this.logger=r,this.snackbar=a}return N()(e,[{key:"docUrl",get:function(){return window.location.href.split("?")[0]}}]),e}(),Jn=(n("a2a09da1e3"),n("ee6bb53310")),zn=n.n(Jn),Xn=n("33e0562167");function $n(e,t,n){var r,a,i=e.uid,o=e.secretId,c=e.globalPadId,s=e.createMessageSeq;return new Ln.f({key:"".concat(c,"_").concat(Bn.f,"_").concat(i),uid:i,secretId:o,globalPadId:c,type:_n.DOCUMENT_DATA_TYPE.init,docType:_n.DOCUMENT_TYPE.slide,padStatus:t.status||n?_n.DOCUMENT_STATUS.new:void 0,subSheetId:Bn.f,taskId:s(),version:null===(r=t.collab_client_vars)||void 0===r?void 0:r.rev,dver:(null==t||null===(a=t.collab_client_vars)||void 0===a?void 0:a.dver)||Bn.b,data:t,createTime:Date.now()})}n("90fab19f96");var Zn=n("a537f7f1aa"),er="[OMS]",tr=function(){function e(t,n,r,a,i){var c=this;O()(this,e),x()(this,"mutationsPacks",void 0),x()(this,"slideFileInstance",void 0),x()(this,"getMutationsPacks",(function(){return c.mutationsPacks})),x()(this,"applyOfflineData",function(){var e=o()(l.a.mark((function e(t,n){var r,a,i,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null===(r=(a=c.logger).tdw)||void 0===r||r.call(a,{opername:"quality_slide",module:"offline-edit",action:"offline-edit-error-reason",ver5:Bn.e.LAUNCHED}),e.next=3,st.a.CollaborationManager.promise();case 3:if(i=e.sent,o=i.getPersistent(),null!=t&&t.length){e.next=9;break}return c.logger.info(er,"offlineMutationsPack is empty"),o.didRecoverPersistentData(),e.abrupt("return");case 9:if(t.forEach((function(e){var t=e;c.mutationsPacks.push(e),t.sendedCount+=1})),c.logger.info(er,"all mutationsPacks length: ".concat(c.mutationsPacks.length)),!c.context.isOnline()){e.next=17;break}return c.logger.info(er,"isOnline, ready to recovery"),o.setMutationsPacks(M()(c.mutationsPacks)),e.next=16,n();case 16:return e.abrupt("return");case 17:c.logger.info(er,"isOffline, ready to send"),o.didRecoverPersistentData(),i.addNativeOfflineDataToQueue(M()(c.mutationsPacks));case 20:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),x()(this,"updateAndSaveCurClientVars",o()(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.next=4;break;case 4:return e.next=6,c.getPresentationData();case 6:e.t0=e.sent;case 7:return t=e.t0,e.next=10,Object(Xn.a)(t);case 10:return n=e.sent,c.offlineEditService.syncClientVarsToMemory(n),e.abrupt("return",c.offlineEditService.syncCurClientVarsToDB());case 13:case"end":return e.stop()}}),e)})))),x()(this,"onReplaceAllData",(function(e){return c.logger.info(er,"replaceAllData length:",e.length),c.mutationsPacks=M()(e),c.firstUpdateSyncPadInfo(),c.saveCacheImmediately("onReplaceAllData")})),x()(this,"additionOrUpdate",(function(e){return e.forEach(c.handleAdditionOrUpdate),c.saveCacheImmediately("additionOrUpdate")})),x()(this,"deletionMultiple",(function(e){return c.handleDeletion(e),c.saveCacheImmediately("deletionMultiple")})),x()(this,"restored",o()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c.logger.info(er,"[restored] invoke"),c.updateAndSaveCurClientVars();case 2:case"end":return e.stop()}}),e)})))),x()(this,"handleAdditionOrUpdate",(function(e){var t=c.mutationsPacks.find((function(t){return t.taskId===e.taskId}));if(t)return Reflect.set(t,"mutations",e.mutations),void c.logger.info(er,"handleAdditionOrUpdate update mutationsPack, taskId:",t.taskId);c.mutationsPacks.push(e),c.logger.info(er,"handleAdditionOrUpdate add mutationsPack, taskId:",e.taskId)})),x()(this,"handleDeletion",(function(e){e.forEach((function(e){var t=c.mutationsPacks.findIndex((function(t){var n=t.taskId,r=t.revision;return e===n&&(c.logger.info(er,"handleDeletion",{revision:r,taskId:n}),!0)}));-1!==t&&c.mutationsPacks.splice(t,1)}))})),this.context=t,this.DBService=n,this.logger=r,this.sdkEvent=a,this.offlineEditService=i,this.mutationsPacks=[],this.init()}var t,n,r,a,i,c,s,u;return N()(e,[{key:"getPresentationData",value:(u=o()(l.a.mark((function e(){var t,n,r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSlideFileInstance();case 2:return t=e.sent,e.next=5,p.a.SDKDataServices.PresentationStoreService.promise();case 5:return n=e.sent,e.next=8,t.slideFile.fromPresentationData(n.getPresentation().getWritableOwnedData());case 8:return r=e.sent,a=r.data,e.abrupt("return",a);case 11:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"getSlideFileInstance",value:(s=o()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.slideFileInstance||(this.slideFileInstance=p.a.SlideFileManager().createInstance()),!(this.slideFileInstance instanceof Promise)){e.next=5;break}return e.next=4,this.slideFileInstance;case 4:this.slideFileInstance=e.sent;case 5:return e.abrupt("return",this.slideFileInstance);case 6:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"init",value:(c=o()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(In.f)();case 2:this.logger.info(er,"[init] onSlideAppReady"),this.registerSlideAppReadyListener(),this.registerMutationsListener();case 5:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"registerSlideAppReadyListener",value:function(){var e=this,t=this.context,n=t.secretId,r=t.globalPadId;this.logger.info(er,"registerOfflineEditHandler -\n        onSlideAppReady -\n        secretId:".concat(n," -\n        globalPadId:").concat(r)),window.addEventListener("beforeunload",(function(){e.offlineEditService.onBeforeUnloadCb()}))}},{key:"registerMutationsListener",value:function(){var e=this;this.logger.info(er,"registerMutationsListener"),window.addEventListener(Tt,(function(t){var n;e.updatePadInfoFiled({title:(null===(n=t.detail)||void 0===n?void 0:n.title)||"无标题幻灯片"}),e.updateAndSaveCurClientVars()})),this.sdkEvent.mutationEvents.onCommitCommand(this.updateAndSaveCurClientVars),this.sdkEvent.revisionEvents.onUpdateBaseRevision(this.updateAndSaveCurClientVars),this.sdkEvent.persistentEvents.onReplaceAllData(this.onReplaceAllData),this.sdkEvent.persistentEvents.onAddOrUpdateData(this.additionOrUpdate),this.sdkEvent.persistentEvents.onRemoveData(this.deletionMultiple),this.sdkEvent.persistentEvents.onRecoveryStatusChange((function(t){t===Zn.b.DidRecoverData&&e.restored()}))}},{key:"saveCacheImmediately",value:(i=o()(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info(er,"ready to saveCacheImmediately\n        source: ".concat(t,"\n        secretId: ").concat(this.context.secretId,",\n        globalPadId: ").concat(this.context.globalPadId,",\n        mutationsPackCachesLength: ").concat(this.mutationsPacks.length)),!this.mutationsPacks.length){e.next=7;break}return e.next=4,this.saveCacheImmediatelyAndUpdateDB(t);case 4:e.t0=e.sent,e.next=10;break;case 7:return e.next=9,this.saveCacheImmediatelyAndRemoveDB(t);case 9:e.t0=e.sent;case 10:e.t0||this.offlineEditService.handleDatabaseError("saveCacheImmediately","failed");case 12:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"saveCacheImmediatelyAndUpdateDB",value:(a=o()(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=this.context,i=this.mutationsPacks,o=void 0,c=void 0,s=void 0,u=void 0,l=void 0,o=a.uid,c=a.secretId,s=a.globalPadId,u=a.createMessageSeq,l=Je()(i,1)[0],n=new Ln.f({key:"".concat(s,"_").concat(Bn.f,"_").concat(o),uid:o,secretId:c,globalPadId:s,type:_n.DOCUMENT_DATA_TYPE.committing,docType:_n.DOCUMENT_TYPE.slide,subSheetId:Bn.f,taskId:l.taskId||u(),version:null==l?void 0:l.revision,dver:Bn.b,data:i,createTime:Date.now()}),e.next=4,this.DBService.updateOfflineData(n);case 4:if(!(r=e.sent).error){e.next=7;break}throw r.error;case 7:return this.logger.info(er,"saveCacheImmediatelyAndUpdateDB ".concat(t," success")),e.abrupt("return",!0);case 11:return e.prev=11,e.t0=e.catch(0),this.logger.error(er,"saveCacheImmediatelyAndUpdateDB ".concat(t),null===e.t0||void 0===e.t0?void 0:e.t0.toString()),e.abrupt("return",!1);case 15:case"end":return e.stop()}var a,i,o,c,s,u,l}),e,this,[[0,11]])}))),function(e){return a.apply(this,arguments)})},{key:"saveCacheImmediatelyAndRemoveDB",value:(r=o()(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.DBService.updateOfflineData();case 3:if(!(n=e.sent).error){e.next=6;break}throw n.error;case 6:return this.logger.info(er,"saveCacheImmediatelyAndRemoveDB ".concat(t," success")),e.abrupt("return",!0);case 10:return e.prev=10,e.t0=e.catch(0),this.logger.error(er,"saveCacheImmediatelyAndRemoveDB ".concat(t),null===e.t0||void 0===e.t0?void 0:e.t0.toString()),e.abrupt("return",!1);case 14:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(e){return r.apply(this,arguments)})},{key:"firstUpdateSyncPadInfo",value:(n=o()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.DocInfoManager.promise().then((function(e){return e.visible}));case 2:if(!e.sent){e.next=5;break}return e.abrupt("return");case 5:return this.logger.info(er,"firstUpdateSyncPadInfo"),e.next=8,this.updatePadInfoFiled({isEdited:!0});case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updatePadInfoFiled",value:(t=o()(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.DBService.getPadInfo(this.context.secretId,Nn.SECRET);case 2:if(n=e.sent,this.logger.info(er,"updatePadInfoFiled data: ",t,n),n){e.next=6;break}return e.abrupt("return");case 6:r=Object.assign(n,t),this.DBService.updatePadInfo({isAlreadyExist:!0,padInfo:r});case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();function nr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function rr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nr(Object(n),!0).forEach((function(t){x()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ar,ir="[OES]",or=function(){function e(t,n,r,a,i,c){var s=this;O()(this,e),x()(this,"isLocked",void 0),x()(this,"isNewCreate",void 0),x()(this,"curClientVars",void 0),x()(this,"dbServiceLoaded",!1),x()(this,"OfflineMutationsService",void 0),x()(this,"useOfflineDataReady",!1),x()(this,"unCommittedOfflineData",void 0),x()(this,"syncDataToServerPromise",void 0),x()(this,"getRecoverData",(function(){return new Promise((function(e){s.waitForDBServiceLoaded((function(){return s.unCommittedOfflineData?e(s.unCommittedOfflineData):s.getUnCommittedOfflineData().then(e)}))}))})),x()(this,"startRecovery",function(){var e=o()(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==s.unCommittedOfflineData){e.next=3;break}return e.next=3,s.getUnCommittedOfflineData();case 3:return e.abrupt("return",s.OfflineMutationsService.applyOfflineData(null!==(n=s.unCommittedOfflineData)&&void 0!==n?n:[],t));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),x()(this,"onBeforeUnloadCb",o()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s.isLocked){e.next=2;break}return e.abrupt("return");case 2:return s.logger.info(ir,"[onBeforeUnloadCb] DBService release"),e.next=5,s.DBService.release();case 5:case"end":return e.stop()}}),e)})))),x()(this,"syncClientVarsToMemory",(function(e){s.curClientVars=Object(Xn.f)(e),Object(Xn.e)(s.curClientVars),s.logger.info(ir,"syncClientVarsToMemory")})),x()(this,"syncCurClientVarsToDB",o()(l.a.mark((function e(){var t,n,r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=$n(s.context,s.curClientVars),s.logger.info(ir,"ready to saveCurClientVarsToDB -\n        secretId: ".concat(s.context.secretId,",\n        globalPadId: ").concat(s.context.globalPadId)),e.next=4,s.DBService.updateDocumentData(t);case 4:if(!(n=e.sent).error){e.next=8;break}return s.handleDatabaseError("saveCurClientVarsToDB",null===(r=n.error)||void 0===r||null===(a=r.toString)||void 0===a?void 0:a.call(r)),e.abrupt("return");case 8:s.logger.info(ir,"saveCurClientVarsToDB success");case 9:case"end":return e.stop()}}),e)})))),x()(this,"handleDatabaseError",(function(e,t){s.logger.error(ir,"handleDatabaseError",e,t),"init"===e?s.sdkEvent.emit(mn.d.OpenDataBaseError):s.sdkEvent.emit(mn.d.DataBaseFatalError,!!s.OfflineMutationsService.getMutationsPacks().length)})),x()(this,"getUnCommittedOfflineData",o()(l.a.mark((function e(){var t,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.DBService.getUnCommittedOfflineData();case 2:if(!(n=e.sent).error){e.next=7;break}return s.logger.error(ir,"getUnCommittedOfflineData error: ",n.error),s.unCommittedOfflineData=[],e.abrupt("return",s.unCommittedOfflineData);case 7:return r=(null===(t=n.data)||void 0===t?void 0:t.data)||[],s.unCommittedOfflineData=r,e.abrupt("return",s.unCommittedOfflineData);case 10:case"end":return e.stop()}}),e)})))),x()(this,"waitForDBServiceLoaded",(function(e){s.dbServiceLoaded?e():s.event.on(Vt.a.OfflineDBServiceReady,e)})),x()(this,"checkNewInfoInDB",o()(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s.logger.info(ir,"ready to getPadInfo",s.context.secretId),e.next=3,s.DBService.getPadInfo(s.context.secretId,Nn.SECRET);case 3:return t=e.sent,n=(null==t?void 0:t.status)===_n.DOCUMENT_STATUS.new,e.abrupt("return",{isNewInDB:n,curPadInfo:t});case 6:case"end":return e.stop()}}),e)})))),x()(this,"updateCurPadInfo",o()(l.a.mark((function e(){var t,n,r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.DBService.getPadInfo(s.context.globalPadId);case 2:return t=e.sent,n=t?(i=t,o=s.curClientVars,c=void 0,u=void 0,l=void 0,d=void 0,f=void 0,h=void 0,v=void 0,p=void 0,g=void 0,u=i,l=o.collab_client_vars,d=o.domainId,f=void 0===d?"":d,h=o.padId,v=void 0===h?"":h,p=o.localPadId,g=void 0===p?"":p,u.isOfflineCache=!0,u.dver=null!==(c=null==l?void 0:l.dver)&&void 0!==c?c:Bn.b,u.domain_id=f,u.pad_id=v||g,u.status=o.padStatus||i.status,u):Kn(s.curClientVars,s.context),r={padInfo:n,isAlreadyExist:!!t},s.logger.info(ir,"ready to updateCurPadInfo -\n            secretId: ".concat(s.context.secretId,",\n            globalPadId: ").concat(s.context.globalPadId)),e.next=8,s.DBService.updatePadInfo(r);case 8:return(a=e.sent).error&&s.logger.info(ir,"updateCurPadInfo 更新 padInfo 失败 error: ",a.error),e.abrupt("return",a);case 11:case"end":return e.stop()}var i,o,c,u,l,d,f,h,v,p,g}),e)})))),x()(this,"syncDataToServer",o()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s.syncDataToServerPromise||(s.syncDataToServerPromise=s.handleSyncDataToServer()),e.abrupt("return",s.syncDataToServerPromise);case 2:case"end":return e.stop()}}),e)})))),x()(this,"handleSyncDataToServer",(function(){return new Promise(function(){var e=o()(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s.logger.info(ir,"ready to syncDataToServer"),e.next=3,s.DBService.createFile();case 3:(n=e.sent).error?(s.logger.info(ir,"syncData error",n),t(!1)):(s.logger.info(ir,"syncData success"),window.history.replaceState(null,"",location.href.substring(0,location.href.indexOf("?"))),s.syncClientVarsToMemory(null==n?void 0:n.data),st.a.CollaborationManager.promise().then((function(e){var t=e.getSocket();t.reInit(rr(rr({},t.getSocketConfig()),{},{serverVars:s.curClientVars.collab_client_vars})),t.open()})),t(!0)),s.syncDataToServerPromise=null;case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})),x()(this,"checkHandleCreateNew",o()(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s.logger.info(ir,"checkHandleCreateNew"),e.next=3,s.DBService.getPadInfo(s.context.secretId,Nn.SECRET);case 3:if((null==(t=e.sent)?void 0:t.status)!==_n.DOCUMENT_STATUS.new){e.next=8;break}return s.logger.info(ir,"checkAndSubmit isOnline and status is new"),e.next=8,s.syncDataToServer();case 8:case"end":return e.stop()}}),e)})))),x()(this,"isOfflineOrNewCreate",(function(){return s.isNewCreate||!s.context.isOnline()})),this.context=t,this.DBService=n,this.logger=r,this.mqq=a,this.event=i,this.sdkEvent=c,this.OfflineMutationsService=new tr(this.context,this.DBService,this.logger,this.sdkEvent,this),this.init(),xt.network.changeEnd((function(e){"online"===e&&s.isNewCreate&&s.checkHandleCreateNew()}))}var t,n,r,a,i,c,s,u,d,f;return N()(e,[{key:"init",value:(f=o()(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info(ir,"init"),null===(t=(n=this.logger).tdw)||void 0===t||t.call(n,{opername:"quality_slide",module:"offline-edit",action:"offline-edit-error-reason",ver5:Bn.e.LAUNCHING}),e.prev=2,e.next=5,this.DBService.waitForDBManagerReady();case 5:if(e.sent){e.next=8;break}throw new Error("error");case 8:return e.next=10,this.getUnCommittedOfflineData();case 10:return this.dbServiceLoaded=!0,this.event.emit(Vt.a.OfflineDBServiceReady),e.next=14,this.DBService.lock();case 14:this.isLocked=e.sent,e.next=23;break;case 17:return e.prev=17,e.t0=e.catch(2),this.dbServiceLoaded=!0,this.event.emit(Vt.a.OfflineDBServiceReady),this.handleDatabaseError("init",null===e.t0||void 0===e.t0?void 0:e.t0.toString()),e.abrupt("return");case 23:return e.abrupt("return",this.initData());case 24:case"end":return e.stop()}}),e,this,[[2,17]])}))),function(){return f.apply(this,arguments)})},{key:"initData",value:function(){return this.logger.info(ir,"initData uid:".concat(this.context.uid," uin:").concat(this.context.uin," secretId:").concat(this.context.secretId)),this.context.isNewCreate()?this.initCreateNew():this.initDocMaybeExist()}},{key:"initDocMaybeExist",value:(d=o()(l.a.mark((function e(){var t,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.checkNewInfoInDB();case 2:if(t=e.sent,n=t.isNewInDB,r=t.curPadInfo,!n||!r){e.next=6;break}return e.abrupt("return",this.initOnlyExistLocal(r));case 6:return e.abrupt("return",this.initAlreadyExist());case 7:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"initCreateNew",value:(u=o()(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isNewCreate=!0,e.prev=1,this.logger.info(ir,"initCreateNew\n            secretId4New: ".concat(this.context.secretId4New," -\n            globalPadId4New:").concat(this.context.globalPadId4New," -\n            localPadId4New:").concat(this.context.localPadId," -\n            title4New:").concat(this.context.title4New," -\n            folder4New:").concat(this.context.folder4New," -\n            isOnlineBorrowed4New$:").concat(this.context.isOnlineBorrowed)),this.context.secretId4New&&this.context.globalPadId4New){e.next=5;break}throw new Error("new param invalid secretId4New: ".concat(this.context.secretId4New,", globalPadId4New: ").concat(this.context.globalPadId4New));case 5:return e.next=7,Object(Xn.b)(this.context);case 7:return t=e.sent,e.next=10,this.defaultDataWriteDB(t);case 10:return this.invokeDBOperation(),e.next=13,this.getFinalClientVars();case 13:return n=e.sent,e.next=16,this.useFinalClientVars(n);case 16:this.afterCreateNew(),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(1),this.logger.error(ir,"initCreateNew error: ",e.t0),Object(In.c)(this.context.secretId);case 23:case"end":return e.stop()}}),e,this,[[1,19]])}))),function(){return u.apply(this,arguments)})},{key:"initOnlyExistLocal",value:(s=o()(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isNewCreate=!0,e.prev=1,this.updateNewDocInfo(t),this.logger.info(ir,"initOnlyExistLocal\n            secretId4New: ".concat(this.context.secretId4New," -\n            globalPadId4New:").concat(this.context.globalPadId4New," -\n            localPadId4New:").concat(this.context.localPadId," -\n            title4New:").concat(this.context.title4New," -\n            folder4New:").concat(this.context.folder4New," -\n            isOnlineBorrowed4New$:").concat(this.context.isOnlineBorrowed)),this.context.secretId4New&&this.context.globalPadId4New){e.next=6;break}throw new Error("new param invalid secretId4New: ".concat(this.context.secretId4New,", globalPadId4New: ").concat(this.context.globalPadId4New));case 6:return e.next=8,this.getFinalClientVars();case 8:n=e.sent,this.useFinalClientVars(n),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(1),this.logger.error(ir,"initOnlyExistLocal error: ",e.t0),Object(In.c)(this.context.secretId);case 16:case"end":return e.stop()}}),e,this,[[1,12]])}))),function(e){return s.apply(this,arguments)})},{key:"initAlreadyExist",value:(c=o()(l.a.mark((function e(){var t,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info(ir,"initAlreadyExist, ready to get FinalClientVars"),e.prev=1,e.next=4,this.getFinalClientVars();case 4:r=e.sent,this.useFinalClientVars(r),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),this.logger.error(ir,"initAlreadyExist error: ",e.t0.toString()),Object(In.c)(this.context.secretId);case 12:null===(t=(n=this.logger).tdw)||void 0===t||t.call(n,{opername:"quality_slide",module:"offline-edit",action:"offline-edit-error-reason",ver5:this.context.isOnline()?Bn.e.USE_ONLINE:Bn.e.USE_OFFLINE});case 13:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(){return c.apply(this,arguments)})},{key:"defaultDataWriteDB",value:(i=o()(l.a.mark((function e(t){var n,r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=$n(this.context,t,!0),r=Kn(t,this.context),this.logger.info(ir,"ready to updateMultiTableData"),e.next=5,this.DBService.updateMultiTableData(n,r);case 5:if(!(a=e.sent).error){e.next=8;break}throw new Error("clientVarsWriteDB error: ".concat(a.error));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"invokeDBOperation",value:function(){var e=this.context,t={isOnlineBorrowed:"true"===e.isOnlineBorrowed,folder:e.folder,globalId:e.globalPadId,listTypes:[Bn.a.listTypeOffline,Bn.a.listTypeCreated,Bn.a.listTypeMyDoc,Bn.a.listTypeRecent],operation:"addDocToList"};this.mqq.invoke("docx","docDBOperation",t)}},{key:"getFinalClientVars",value:function(){return this.context.isOnline()?this.getOnlineFinalClientVars():this.getOfflineFinalClientVars()}},{key:"getOnlineFinalClientVars",value:(a=o()(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isNewCreate){e.next=6;break}return this.logger.info(ir,"getFinalClientVars isNewCreate"),e.next=4,this.syncDataToServer();case 4:return t=e.sent,e.abrupt("return",t?this.getClientVarsFromServer():this.getOfflineFinalClientVars());case 6:return this.logger.info(ir,"getFinalClientVars isOnlineOpen"),e.abrupt("return",Object(Xn.a)());case 8:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"getOfflineFinalClientVars",value:(r=o()(l.a.mark((function e(){var t,n,r,a,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info(ir,"ready to getPadInfo",this.context.secretId),e.next=3,this.DBService.getPadInfo(this.context.secretId,Nn.SECRET);case 3:return r=e.sent,this.logger.info(ir,"ready to getClientVarsFromDB"),e.next=7,this.DBService.getClientVarsFromDB();case 7:if(a=e.sent,r&&!a.error&&a.data){e.next=10;break}throw new Error("getFinalClientVars error curPadInfo: ".concat(r,", clientVarsResult error: ").concat(a.error,", data: ").concat(a.data));case 10:return null!=(i=null===(t=a.data.collab_client_vars)||void 0===t||null===(n=t.initialAttributedText)||void 0===n?void 0:n.text)&&i.includes("presentation")||zn()(a.data,"collab_client_vars.initialAttributedText.text",JSON.stringify({presentation:i})),e.abrupt("return",a.data);case 13:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"useFinalClientVars",value:(n=o()(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.syncClientVarsToMemory(t),this.isOfflineOrNewCreate()&&this.emitDataReady(),e.next=4,Object(In.d)();case 4:return n=this.syncCurClientVarsToDB(),r=this.updateCurPadInfo(),e.next=8,Promise.all([n,r]);case 8:this.invokeMapDocumentVersion();case 9:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getClientVarsFromServer",value:(t=o()(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.logger.info(ir,"ready to fetchSlideData",this.context.secretId),e.next=4,Object(Xn.c)(this.context.secretId);case 4:if(t=e.sent,n=t.data.data){e.next=8;break}throw new Error("fetchSlideData error");case 8:return e.abrupt("return",n);case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",null);case 14:case"end":return e.stop()}}),e,this,[[0,11]])}))),function(){return t.apply(this,arguments)})},{key:"emitDataReady",value:function(){this.curClientVars=Object(Xn.d)(this.curClientVars),this.logger.info(ir,"dispatch clientVarsDataReady"),dispatchEvent(new Event("clientVarsDataReady")),Object(Xn.e)(this.curClientVars)}},{key:"invokeMapDocumentVersion",value:function(){var e,t=(null===(e=this.curClientVars.collab_client_vars)||void 0===e?void 0:e.dver)||Bn.b;this.logger.info(ir,"updateCurPadInfo mapDocumentVersion secretId: ".concat(this.context.secretId,", dver: ").concat(t)),Object(In.b)(this.context.secretId,t)}},{key:"afterCreateNew",value:function(){var e,t;window.dispatchEvent(new CustomEvent("CreateOfflineDoc",{detail:{title:this.curClientVars.title}})),null===(e=(t=this.logger).tdw)||void 0===e||e.call(t,{opername:"quality_slide",module:"offline-edit",action:"offline-edit-error-reason",ver5:Bn.e.USE_OFFLINE_CREATE})}},{key:"updateNewDocInfo",value:function(e){this.context.updateCreateDocInfo({secretId:e.secretId,globalPadId:e.globalPadId,title:e.title,folder:e.folder})}}]),e}();!function(e){e.TIME_ORIGIN="time_origin",e.PARSE_HTML="parse_html",e.MAIN_START="main_start",e.CAN_VIEW="can_view",e.CAN_INTERACT="can_interact",e.CAN_EDIT="can_edit",e.ALL_CHUNKS_FETCHED="all_chunks_fetched"}(ar||(ar={}));var cr=4,sr=function(){function e(t,n,r,a){var i,o,c=this;O()(this,e),x()(this,"loadReportOptions",void 0),this.logger=t,this.clientVarsService=n,this.slideCountState=r,this.commonEmitter=a;var s=this.clientVarsService.getClientVars(),u=s.type,l=void 0===u?cr:u,d=s.docStatus,h=void 0===d?0:d,v=s.globalPadId,p=void 0===v?"":v;this.loadReportOptions={docType:l,type:"load",docStatus:h,globalPadId:p,metrics:{},extra:{}},this.reportLoadMetric(ar.TIME_ORIGIN,null===(i=performance)||void 0===i?void 0:i.timeOrigin),this.reportLoadMetric(ar.PARSE_HTML,window.__webStartParseHtmlTimestamp),this.reportLoadMetric(ar.MAIN_START,null===(o=window.jsRunMarkPoints)||void 0===o?void 0:o.mainStart),this.commonEmitter.on(Vt.a.LoadDocumentAllChunksSuccess,(function(){c.reportLoadMetric(ar.ALL_CHUNKS_FETCHED)})),Be.b.onIncludingPast(Be.a.FIRST_PAGE_DISPLAY,(function(){c.reportLoadMetric(ar.CAN_VIEW,window.previewTime),c.reportLoadMetric(ar.CAN_INTERACT),f.a.isPc&&c.reportLoadMetric(ar.CAN_EDIT)}))}return N()(e,[{key:"reportLoadMetric",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();d.a.IS_TEST&&this.logger.info("[OnlineEditReporter]","[".concat(e.toUpperCase(),"]"),"@".concat(~~(t-performance.timeOrigin)));var n=this.loadReportOptions.metrics;n[e]=t,n[ar.CAN_VIEW]&&n[ar.CAN_INTERACT]&&n[ar.CAN_EDIT]&&n[ar.ALL_CHUNKS_FETCHED]&&(this.loadReportOptions.extra=this.getExtraParams(),this.report(this.loadReportOptions))}},{key:"report",value:function(e){d.a.IS_TEST&&this.logger.info("[OnlineEditReporter]",e.type,JSON.stringify(e)),f.a.isTencentDocDesktopApp&&window.mqq.invoke("docx","performanceReport",e)}},{key:"getExtraParams",value:function(){return{name:this.clientVarsService.getClientVars().padTitle,slideCount:this.slideCountState.slideCount,releaseVersion:window.__globalReleaseVersion}}}]),e}(),ur=!(!Object(h.getQuery)("is_chunk")||1!==Number(Object(h.getQuery)("is_chunk")));function lr(){Object(In.a)()&&(Dn.a.OfflineEditContext.register(Object(m.a)(An)),Dn.a.OfflineDBService.register(Object(m.a)(Gn)),Dn.a.OfflineCacheService.register(Object(m.a)(Qn)),Dn.a.OfflineEditService.register(Object(m.a)(or))),p.a.ClientVarsService.register(o()(l.a.mark((function e(){var t,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(ct.a)();case 2:if(n=e.sent,r=null===(t=n.collab_client_vars)||void 0===t?void 0:t.initialAttributedText,!!(null!=r&&r.slide)){e.next=9;break}throw Error("can not open doc");case 9:p.a.SlideInitialDataService.register(o()(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,st.a.OnlineEditService.promise();case 2:return t=e.sent,e.next=5,t.loadDocument();case 5:return n=e.sent,e.abrupt("return",new k.a(n));case 7:case"end":return e.stop()}}),e)}))));case 10:return e.abrupt("return",new y.a(n));case 11:case"end":return e.stop()}}),e)})))),p.a.SDKDataServices.CommandManager.register((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return a()(wn.a,t.concat([function(){return st.a.OTTransformManager()}]))})),p.a.DocInfoManager.register(Object(m.a)(Dt.a)),st.a.OnlineApiService.register(Object(m.a)(vn.a)),st.a.OnlineEditNoticeManager.register(Object(m.a)(Sn)),p.a.SlideTitleManager.register(o()(l.a.mark((function e(){var t,n,r,i,o,c=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.SDKDataServices.PresentationStoreService.promise();case 2:return t=e.sent,e.next=5,p.a.SDKDataServices.EventManager.promise();case 5:for(n=e.sent,r=c.length,i=new Array(r),o=0;o<r;o++)i[o]=c[o];return e.abrupt("return",a()(Lt,i.concat([t,n])));case 8:case"end":return e.stop()}}),e)})))),p.a.ClientVarsService.promise().then((function(){st.a.OnlineEditService.register(Object(m.a)(wt.a)),ur?st.a.OnlineEditDataFetcher.register(Object(m.a)(St)):st.a.OnlineEditDataFetcher.register(Object(m.a)(ut.a)),st.a.CursorManager.register(Object(m.a)(Wt)),st.a.UserManager.register(Object(m.a)(Jt)),st.a.CollaboratorUserManager.register(Object(m.a)($t)),st.a.CooperationLockManager.register(Object(m.a)(fn)),p.a.SlideAppService.register(Object(m.a)(It.a)),Object(yn.b)()||(Promise.all([n.e("commonAsync~9b1fde68"),n.e("commonAsync~27f19aac"),n.e("commonAsync~205ac551"),n.e("commonAsync~0c3a6025"),n.e("commonAsync~32e631b8"),n.e("commonAsync~08369118"),n.e("commonAsync~50db4bb8"),n.e("commonAsync~86c92fed"),n.e("commonAsync~a95f944a"),n.e("commonAsync~6e568190"),n.e("commonAsync~b174e5ca"),n.e("commonAsync~54a68610"),n.e("commonAsync~61b3c105"),n.e("commonAsync~f7b3ac00"),n.e("commonAsync~cece21d6"),n.e("commonAsync~ecbf7682"),n.e("commonAsync~6c5dfa7c"),n.e("commonAsync~90483627"),n.e("commonAsync~d2c096c2"),n.e("commonAsync~1285a477"),n.e("commonAsync~31ded9a0"),n.e("commonAsync~ecdbff9b"),n.e("commonAsync~c2cc425c"),n.e("commonAsync~4fb44df2"),n.e("commonAsync~d06fe423"),n.e("commonAsync~0519277e"),n.e("commonAsync~6df2b9ea"),n.e("commonAsync~b5c4f9e4"),n.e("commonAsync~ffdf5190"),n.e("commonAsync~127b6cf7"),n.e("commonAsync~b3c4a2ff"),n.e("commonAsync~19bb5a55"),n.e("vendors~slide-sdk-ot-transform")]).then(n.bind(null,"ffe486653f")).then((function(e){var t=e.OTTransform;return p.a.SlideAppService.promise().then((function(){return st.a.OTTransformManager.register(Object(m.a)(t))}))})),Object(In.a)()?st.a.CollaborationManager.register((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return a()(hn.a,t.concat([{getOfflineEditService:function(){return Dn.a.OfflineEditService.promise()}}]))})):st.a.CollaborationManager.register(Object(m.a)(hn.a)))})),st.a.OnlineEditReporter.register(Object(m.a)(sr))}var dr=n("ba746f988d");function fr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=H()(e);if(t){var a=H()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return V()(this,n)}}var hr=function(e){F()(n,e);var t=fr(n);function n(){return O()(this,n),t.apply(this,arguments)}return N()(n,[{key:"init",value:function(){}}]),n}(Me.a),vr=n("edf90fabc3");function pr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=H()(e);if(t){var a=H()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return V()(this,n)}}var gr=p.a.SlideAppService,mr=p.a.ContentStatusManager,br=function(e){F()(i,e);var t,n,r,a=pr(i);function i(){return O()(this,i),a.apply(this,arguments)}return N()(i,[{key:"getClientVars",value:(r=o()(l.a.mark((function e(){var t,n,r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.waitForSlideAppReady();case 2:return e.next=4,p.a.ClientVarsService.promise();case 4:return t=e.sent,e.next=7,p.a.SDKDataServices.PresentationStoreService.promise();case 7:return n=e.sent,r=n.getSerializedPresentationData(),a=t.getCloneClientVars(),zn()(a,"collab_client_vars.initialAttributedText.text",r),e.abrupt("return",a);case 12:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getSlideInitialData",value:(n=o()(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.waitForSlideAppReady();case 2:return e.next=4,p.a.SDKDataServices.PresentationStoreService.promise();case 4:return t=e.sent,e.abrupt("return",{type:Se.a.PresentationData,data:t.getPresentation().getCloneData()});case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"waitForSlideAppReady",value:(t=o()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){Object(vr.a)([gr,mr],(function(t,n){n.onDocumentReady((function(){return e(t)}))}))})));case 1:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})}]),i}(dr.b);x()(br,"namespace","MainWindowDataProviderService");var yr,kr,Sr,wr,Ir,Dr,Or,Cr=n("1f925d7f50"),xr=n.n(Cr),Pr=(n("f1054791f4"),n("8a14e05f2c"),yr=Reflect.metadata("design:type",Function),kr=Reflect.metadata("design:paramtypes",[]),Sr=function(){function e(){O()(this,e),xr()(this,"initial",wr,this),xr()(this,"sdk",Ir,this),xr()(this,"ui",Dr,this)}return N()(e,[{key:"slideCount",get:function(){return Number.isNaN(this.initial)?Number.isNaN(this.sdk)?this.ui:this.sdk:this.initial}},{key:"setInitialCount",value:function(e){this.initial=e}},{key:"setSdkSlideCount",value:function(e){this.initial=NaN,this.sdk=e}},{key:"setUiSlideCount",value:function(e){this.initial=NaN,this.sdk=NaN,this.ui=e}}]),e}(),wr=W()(Sr.prototype,"initial",[G.q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return NaN}}),Ir=W()(Sr.prototype,"sdk",[G.q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return NaN}}),Dr=W()(Sr.prototype,"ui",[G.q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return NaN}}),W()(Sr.prototype,"slideCount",[G.f,yr,kr],Object.getOwnPropertyDescriptor(Sr.prototype,"slideCount"),Sr.prototype),Sr),Er=function(){function e(t){var n,r=this;O()(this,e),this.state=t,this.state.setInitialCount((null===(n=window.preloadData)||void 0===n?void 0:n.slideCount)||NaN);var a=p.a.SlideAppService,i=p.a.ContentStatusManager;Object(vr.a)([a,i],(function(e,n){var a;r.state.setSdkSlideCount(null!==(a=e.getSlideCount())&&void 0!==a?a:NaN),n.onDocumentReady((function(){Object(G.r)((function(){var e;return null===(e=r.getSelectionService())||void 0===e?void 0:e.slides.length}),(function(){r.state.setUiSlideCount(e.getSlideCount())}),{fireImmediately:!0})})),Object(G.r)((function(){return t.slideCount}),(function(e){Number.isNaN(e)||r.onSlideCountChange(e)}),{fireImmediately:!0})}))}return N()(e,[{key:"onSlideCountChange",value:function(e){re.a.getInstance().waitForReady((function(t){t.viewableServiceLayer.slideRenderStateManager.setPageSize(e)}))}},{key:"getSelectionService",value:function(){var e;return null===(e=re.a.getInstance().getAppServices())||void 0===e?void 0:e.viewableServiceLayer.selectionService}}],[{key:"register",value:function(t){return new e(t)}}]),e}(),Tr=n("225da3354c"),Ar=n("6ef42ff901"),_r=n("5224738a3a"),Mr=n("ea9a0f51b9"),Lr=n("8d9554480f"),Nr=n("12d9a4c052"),Rr=n("dfb80f368e"),jr=n("8f2bd6dcbf"),Ur=n("a36ca9e6bd"),Fr=new WeakMap,Br=function(){function e(t){O()(this,e),x()(this,"privilegeAttribute",void 0),Fr.set(this,{writable:!0,value:!1}),this.editEvent=t,this.init()}var t;return N()(e,[{key:"getPrivilegeAttribute",value:function(){return this.privilegeAttribute}},{key:"readable",get:function(){return!!this.privilegeAttribute.can_read}},{key:"editable",get:function(){return Pn()(this,Fr)}},{key:"copyable",get:function(){return!!this.privilegeAttribute.can_copy}},{key:"exportable",get:function(){return!!this.privilegeAttribute.can_export}},{key:"printable",get:function(){return!!this.privilegeAttribute.can_print}},{key:"canApplyEdit",get:function(){return!!this.privilegeAttribute.can_apply_edit}},{key:"canGenerateCopies",get:function(){return!!this.privilegeAttribute.can_copy_doc}},{key:"init",value:(t=o()(l.a.mark((function e(){var t,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.ClientVarsService.promise();case 2:return n=e.sent,this.privilegeAttribute=null!==(t=n.getClientVars().privilegeAttribute)&&void 0!==t?t:{},this.changeEditable(!!this.getPrivilegeAttribute().can_edit&&!Object(Pt.f)()),e.next=7,st.a.OTTransformManager.promise();case 7:r=e.sent,this.changeEditable(Pn()(this,Fr)&&r.supported);case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"changeEditable",value:function(e){Pn()(this,Fr)!==e&&(Cn()(this,Fr,e),e||this.editEvent.emit(Vt.a.SetDocCopyable))}}]),e}(),Vr=n("bd5de260ae"),qr=n("2df8131d1b"),Hr=n("14bda16c18"),Kr=n("3ba6a063eb"),Wr=(n("eb9e932508"),n("7718930a1d")),Gr=n("822fa1925c"),Yr=function(){function e(){O()(this,e),x()(this,"maxCount",1),x()(this,"instancePools",[]),this.eliminateLoop()}var t,r;return N()(e,[{key:"recent",value:(r=o()(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.instancePools.find((function(e){return!e.isAllocated})))){e.next=4;break}return t.allocate(),e.abrupt("return",t);case 4:if(!(this.instancePools.length<this.maxCount)){e.next=11;break}return e.next=7,this.createInstance();case 7:return t=e.sent,this.instancePools.push(t),t.allocate(),e.abrupt("return",t);case 11:return e.abrupt("return");case 12:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"recentBack",value:function(e){if(!(e instanceof Qr))throw Error("client is invalid");e.deallocate()}},{key:"createInstance",value:(t=o()(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.e("commonAsync~9b1fde68"),n.e("commonAsync~27f19aac"),n.e("commonAsync~205ac551"),n.e("commonAsync~0c3a6025"),n.e("commonAsync~32e631b8"),n.e("commonAsync~08369118"),n.e("commonAsync~50db4bb8"),n.e("commonAsync~86c92fed"),n.e("commonAsync~a95f944a"),n.e("commonAsync~6e568190"),n.e("commonAsync~b174e5ca"),n.e("commonAsync~54a68610"),n.e("commonAsync~61b3c105"),n.e("commonAsync~f7b3ac00"),n.e("commonAsync~cece21d6"),n.e("commonAsync~ecbf7682"),n.e("commonAsync~6c5dfa7c"),n.e("commonAsync~90483627"),n.e("commonAsync~d2c096c2"),n.e("commonAsync~1285a477"),n.e("commonAsync~31ded9a0"),n.e("commonAsync~ecdbff9b"),n.e("commonAsync~c2cc425c"),n.e("commonAsync~4fb44df2"),n.e("commonAsync~d06fe423"),n.e("commonAsync~0519277e"),n.e("commonAsync~6df2b9ea"),n.e("commonAsync~b5c4f9e4"),n.e("commonAsync~ffdf5190"),n.e("commonAsync~127b6cf7"),n.e("commonAsync~b3c4a2ff"),n.e("commonAsync~19bb5a55"),n.e(29)]).then(n.bind(null,"f54219029c")).then((function(e){return new e.default}));case 2:return t=e.sent,r=new Wr.b(new Gr.a(t)),e.abrupt("return",new Qr(r));case 5:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})},{key:"eliminateLoop",value:function(){var e=this;setInterval((function(){var t=!1;e.instancePools=e.instancePools.sort((function(e,t){return e.isActive===t.isActive?0:e.isActive?-1:1})).filter((function(e){return e.isActive||!t?(t=!0,!0):(e.dispose(),!1)}))}),6e4)}}]),e}(),Qr=function(){function e(t){O()(this,e),x()(this,"isAllocated",!1),x()(this,"lastUsedTimestamp",void 0),this.client=t}return N()(e,[{key:"allocate",value:function(){this.lastUsedTimestamp=Date.now(),this.isAllocated=!0}},{key:"deallocate",value:function(){this.isAllocated=!1}},{key:"slideFile",get:function(){return this.client.service("SlideFile")}},{key:"isActive",get:function(){return this.isRecentlyUsed||this.isAllocated}},{key:"dispose",value:function(){this.client.dispose()}},{key:"isRecentlyUsed",get:function(){return!!this.lastUsedTimestamp&&Date.now()-this.lastUsedTimestamp<6e4}}]),e}();dr.a.getInstance().registerService(br),p.a.Infra.Logger.register((function(){var e={info:function(){var e;return(e=window.log).info.apply(e,arguments)},error:function(){var e;return(e=window.log).error.apply(e,arguments)},warn:function(){var e;return(e=window.log).warn.apply(e,arguments)},log:function(){var e;return(e=window.log).log.apply(e,arguments)},debug:function(){var e;return(e=window.log).debug.apply(e,arguments)},tdrec:ye.reportErrorCode,tdw:Ct.c,monitor:{reportValue:Vr.b,reportStatus:Vr.a},getPrototype:function(){return window.log}};return d.a.IS_RELEASE&&(e.aegis=qr.a.getInstance().aegis),e})),p.a.Infra.Mqq.register((function(){var e;return"undefined"!=typeof window&&!s()(window)||"function"!=typeof(null===(e=window.mqq)||void 0===e?void 0:e.invoke)?{invoke:function(){}}:window.mqq})),p.a.States.SlideCountState.register((function(){var e=new Pr;return Er.register(e),e})),p.a.UI.Snackbar.register(o()(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.isMobile?Promise.resolve().then(n.t.bind(null,"b74ee0edd6",7)):Promise.resolve().then(n.t.bind(null,"82f2dc9440",7));case 2:return t=e.sent,r=t.Snackbar,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})))),p.a.UI.Modal.register(o()(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.isMobile?Promise.all([n.e("commonAsync~9b1fde68"),n.e("commonAsync~27f19aac"),n.e("commonAsync~205ac551"),n.e("commonAsync~0c3a6025"),n.e("commonAsync~32e631b8"),n.e("commonAsync~08369118"),n.e("commonAsync~50db4bb8"),n.e("commonAsync~86c92fed"),n.e("commonAsync~a95f944a"),n.e("commonAsync~6e568190"),n.e("commonAsync~b174e5ca"),n.e("commonAsync~54a68610"),n.e("commonAsync~61b3c105"),n.e("commonAsync~f7b3ac00"),n.e("commonAsync~cece21d6"),n.e("commonAsync~ecbf7682"),n.e("commonAsync~6c5dfa7c"),n.e("commonAsync~90483627"),n.e("commonAsync~d2c096c2"),n.e("commonAsync~1285a477"),n.e("commonAsync~31ded9a0"),n.e("commonAsync~ecdbff9b"),n.e("commonAsync~c2cc425c"),n.e("commonAsync~4fb44df2"),n.e("commonAsync~d06fe423"),n.e("commonAsync~0519277e"),n.e("commonAsync~6df2b9ea"),n.e("commonAsync~b5c4f9e4"),n.e("commonAsync~ffdf5190"),n.e("commonAsync~127b6cf7"),n.e("commonAsync~b3c4a2ff"),n.e("commonAsync~19bb5a55")]).then(n.t.bind(null,"8980a7557e",7)):Promise.resolve().then(n.t.bind(null,"52d461bc51",7));case 2:return t=e.sent,r=t.Modal,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})))),p.a.EventManager.register((function(){return Object(b.a)()})),p.a.UIEventManager.register((function(){return Object(b.a)()})),p.a.PrivilegeManager.register(Object(m.a)(Br)),p.a.ContentStatusManager.register(v.b),d.a.IS_TEST?p.a.OperationLogger.register(Object(m.a)(Hr.a)):p.a.OperationLogger.register((function(){return{}})),p.a.SDKDataServices.EventManager.register(Object(m.a)(Tr.a)),p.a.SDKDataServices.MutationManager.register((function(e,t){return new Ar.a(e,t,(function(){var e;return null!==(e=p.a.DocInfoManager())&&void 0!==e?e:{}}))})),p.a.SDKDataServices.PresentationStoreService.register((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return a()(Ur.a,t.concat([p.a.OperationLogger()]))})),p.a.SDKDataServices.PresentationStoreService.promise().then((function(e){var t=e.getPresentation();p.a.SDKDataServices.SearchManager.register((function(e){return new _r.a(t,e)}))})),p.a.SDKDataServices.TransactionManager.register(Object(m.a)(Mr.a)),p.a.SDKDataServices.ObserverManager.register(Object(m.a)(Lr.a)),p.a.SDKDataServices.ColorManager.register(Object(m.a)(Nr.a)),p.a.SDKDataServices.DataHelper.register(Object(m.a)(Rr.a)),p.a.SDKDataServices.ResourceMapManager.register(Object(m.a)(jr.a)),p.a.SDKDataServices.SnapshotManager.register((function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return a()(Kr.a,[{getSnapshotData:function(){return e.getPresentationSnapShotData()}}].concat(n))})),p.a.SlideFileManager.register(Object(m.a)(Yr)),"1"===Object(h.getQuery)("isSubsidiary")?(p.a.SDKDataServices.CommandManager.register(Object(m.a)(wn.a)),Or=dr.a.getInstance().createServiceProxy(window.opener,br),p.a.ClientVarsService.register(o()(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Or.getClientVars();case 2:return t=e.sent,window.clientVars=t,e.abrupt("return",new y.a(t));case 5:case"end":return e.stop()}}),e)})))),p.a.SlideInitialDataService.register(o()(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Or.getSlideInitialData();case 2:return t=e.sent,e.abrupt("return",new k.a(t));case 4:case"end":return e.stop()}}),e)})))),p.a.SlideAppService.register(Object(m.a)(hr)),p.a.DocInfoManager.register(Object(m.a)(Dt.a))):d.a.IS_LOCAL_EDIT?(p.a.SDKDataServices.CommandManager.register(Object(m.a)(wn.a)),it()):lr(),Object.assign(window,{SlideDataServices:p.a})},db0c73f5df:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return i}));var r=n("f8fc8e0087");function a(){return Object(r.getCookie)("TOK")}function i(){var e=Object(r.getCookie)("skey"),t=0,n=5381;if(e){for(;0>t;++t)n+=(n<5)+e.charAt(t).charCodeAt(0);return 2147483647&n}}},e212cafb1e:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));n("c6244f7705"),n("081c8cafea");function r(){return new Promise((function(e){var t=window.clientVars;null!=t&&t.collab_client_vars?e(t):window.addEventListener("clientVarsDataReady",(function(){e(window.clientVars)}))}))}},e516279ea9:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("9cd4e1be22"),a=n("020899bf26"),i=Object(r.c)((function(){var e=Object(r.d)().dependsOn([]),t=Object(r.d)().dependsOn([e,a.a.Infra.Logger]);return{OfflineEditContext:e,OfflineDBService:t,OfflineCacheService:Object(r.d)().dependsOn([e,t,a.a.Infra.Logger,a.a.UI.Snackbar]),OfflineEditService:Object(r.d)().dependsOn([e,t,a.a.Infra.Logger,a.a.Infra.Mqq,a.a.EventManager,a.a.SDKDataServices.EventManager])}}))},e5a826a0ff:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={SLIDE:"SelectedEleMgrType_SLIDE",GROUP:"SelectedEleMgrType_GROUP",SMART_ART:"SelectedEleMgrType_SMART_ART"}},e86bde4ef1:function(e,t,n){"use strict";n.d(t,"a",(function(){return M}));var r,a,i,o,c,s,u,l,d,f=n("1f925d7f50"),h=n.n(f),v=n("b6035c5438"),p=n.n(v),g=n("b04733d69b"),m=n.n(g),b=n("2dc700e1e6"),y=n.n(b),k=(n("f1054791f4"),n("176815363d")),S=n.n(k),w=n("9132715560"),I=n.n(w),D=n("6a364eb35c"),O=n.n(D),C=n("85d0a7609b"),x=n.n(C),P=n("3ef2352f0b"),E=n.n(P),T=(n("8e7cce0ada"),n("29f8c5f672"),n("c6244f7705"),n("85d48ef22b"),n("2a6f332b5e"),n("081c8cafea"),n("8ee19818c4"),n("ab67fd3ad5"),n("8a14e05f2c"),n("826dc923b3"),n("c554310b5c"),n("026cc7da1f")),A=n("d5c3deb8c7"),_=n("29112c2c27"),M=function(){function e(){I()(this,e),x()(this,"chunkPromises",new Map),x()(this,"chunkResolvers",new Map),x()(this,"chunkRejectors",new Map)}var t;return O()(e,[{key:"add",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var a=0;a<n.length;a++){var i;this.alloc(e+a),null===(i=this.chunkResolvers.get(e+a))||void 0===i||i(n[a])}}},{key:"consume",value:(t=S()(E.a.mark((function e(t){var n;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return n=e.sent,this.delete(t),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"get",value:function(e){return this.alloc(e),this.chunkPromises.get(e)}},{key:"delete",value:function(e){this.chunkPromises.delete(e),this.chunkResolvers.delete(e),this.chunkRejectors.delete(e)}},{key:"toChunksGenerator",value:function(){return new L(this)}},{key:"dispose",value:function(e){e&&this.chunkRejectors.forEach((function(t){return t(e)})),this.chunkPromises.clear(),this.chunkResolvers.clear(),this.chunkRejectors.clear()}},{key:"alloc",value:function(e){var t=this;this.chunkPromises.has(e)||this.chunkPromises.set(e,new Promise((function(n,r){t.chunkResolvers.set(e,n),t.chunkRejectors.set(e,r)})))}}]),e}(),L=(r=Reflect.metadata("design:type",Function),a=Reflect.metadata("design:paramtypes",[]),i=Reflect.metadata("design:type",Function),o=Reflect.metadata("design:paramtypes",[]),l=new WeakMap,d=new WeakMap,c=function(){function e(t){var n=this;I()(this,e),h()(this,"index",s,this),x()(this,"initPromise",void 0),x()(this,"initPromiseResolver",void 0),h()(this,"totalChunks",u,this),l.set(this,{writable:!0,value:_.a.AlreadyCreate}),d.set(this,{writable:!0,value:0}),this.chunks=t,this.initPromise=new Promise((function(e){n.initPromiseResolver=e}))}var t;return O()(e,[{key:"init",value:function(e,t){return this.totalChunks=e,e>0&&m()(this,d,null!=t?t:1),this.initPromiseResolver(),this}},{key:"total",get:function(){return Object(T.assert)(!Number.isNaN(this.totalChunks)),this.totalChunks}},{key:"done",get:function(){return!Number.isNaN(this.totalChunks)&&this.index>=this.totalChunks}},{key:"fullPageCount",get:function(){return p()(this,d)}},{key:"docCreateStatus",get:function(){return p()(this,l)}},{key:"updateTotal",value:function(e){return this.totalChunks=e,this}},{key:"updateDocCreateStatus",value:function(e){return m()(this,l,e),this}},{key:"advance",value:function(){return this.index+=1,this}},{key:"next",value:(t=S()(E.a.mark((function e(){var t;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initPromise;case 2:if(!this.done){e.next=5;break}return this.chunks.dispose(),e.abrupt("return",{done:this.done,docCreateStatus:p()(this,l)});case 5:return e.next=7,this.chunks.consume(this.index);case 7:return t=e.sent,this.advance(),this.done&&this.chunks.dispose(),e.abrupt("return",{chunk:t,done:this.done,docCreateStatus:p()(this,l)});case 11:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),s=y()(c.prototype,"index",[A.q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),u=y()(c.prototype,"totalChunks",[A.q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return NaN}}),y()(c.prototype,"total",[A.f,r,a],Object.getOwnPropertyDescriptor(c.prototype,"total"),c.prototype),y()(c.prototype,"done",[A.f,i,o],Object.getOwnPropertyDescriptor(c.prototype,"done"),c.prototype),c)},ec5cae33cb:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={NONE:"none",SLIDELIST:"slidelist",EDITOR:"editor",NOTE:"note",PLAYER:"player"}},ed31fcfdd0:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n("10f9b6de11");function a(){return{collab_client_vars:{bad:-1,client:{sid:"",upid:"",sig:"",tid:-1},dirty:-1,globalPadId:"",gray:-1,initialAttributedText:{text:""},padId:"",padSubId:"BB08J2",padType:"",pos:-1,pver:-1,rev:0,ver:-1,websocket:!0,wmode:""},creatorDomain:"",creatorId:"",docStatus:-1,domainId:"",globalPadId:"",isCreator:!0,isLogin:!0,isOverConNum:!1,isOwner:!1,isUserChangeTitle:!1,localPadId:"",ownerId:"",padId:"",padStatus:r.DOCUMENT_STATUS.new,padTitle:"",padType:"",policy:-1,privilegeAttribute:{is_auth:!0,can_copy:!0,can_print:!0,can_history:!0,can_read:!0,can_edit_title:!0,can_search:!0,can_add_user:!0,can_view_image:!0,can_edit:!0,can_share:!0,can_comment:!0,can_about:!0,can_spit_slot:!0,can_watermark:!0,can_translate:!0,can_link_exp:!0,can_copy_doc:!0,can_publish:!0,can_set_range:!0,can_edit_tab:!0,can_export:!0,can_apply_edit:!0,can_save_template:!0,can_edit_collab:!0,can_view_collab:!0,can_invite_member:!0,is_admin:!0,can_view_priv_setting:!0,can_edit_priv_setting:!0,can_set_internal_access:!0,can_set_external_access:!0,can_set_security_setting:!0,can_invite_special_depts:!0,can_search_user:!0,can_filter_user:!0,can_forbid_viewer_comment:!0,can_forbid_viewer_copy_doc:!0,can_transfer:!0,can_annotate:!0,can_set_enter_rule:!0,can_delete:!0,can_create_file:!0,can_create_folder:!0,can_fill:!0},privilegeExpire:-1,rightFlag:-1,title:"",userId:"",metaCreateTime:Date.now(),lastModifyTime:Date.now(),lastModifyUser:"",advPolicy:{}}}},edf90fabc3:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n("9cd4e1be22");function a(e,t){Object(r.d)().dependsOn(e).register(t)}}}]);
//# sourceMappingURL=slide-base~54efbb91-ea6dd9.js.map