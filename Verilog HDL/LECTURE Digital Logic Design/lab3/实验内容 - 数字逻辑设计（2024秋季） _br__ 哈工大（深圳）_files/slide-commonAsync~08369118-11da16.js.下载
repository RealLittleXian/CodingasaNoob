(this.webpackJsonp=this.webpackJsonp||[]).push([["commonAsync~08369118"],{"0368aca230":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("6064ce49c9");Object.defineProperty(t,"Disposable",{enumerable:!0,get:function(){return r.Disposable}}),Object.defineProperty(t,"RootDisposable",{enumerable:!0,get:function(){return r.RootDisposable}}),Object.defineProperty(t,"mixinDisposable",{enumerable:!0,get:function(){return r.mixinDisposable}}),Object.defineProperty(t,"mixinRootDisposable",{enumerable:!0,get:function(){return r.mixinRootDisposable}});var i=n("513019d975");Object.defineProperty(t,"DisposableNone",{enumerable:!0,get:function(){return i.DisposableNone}});var o=n("6bb936b136");Object.defineProperty(t,"markTracked",{enumerable:!0,get:function(){return o.markTracked}}),Object.defineProperty(t,"trackDisposable",{enumerable:!0,get:function(){return o.trackDisposable}}),Object.defineProperty(t,"enableDisposablesTrack",{enumerable:!0,get:function(){return o.enableDisposablesTrack}}),Object.defineProperty(t,"disableDisposablesTrack",{enumerable:!0,get:function(){return o.disableDisposablesTrack}});var a=n("6cac31cea5");Object.defineProperty(t,"DisposeTrace",{enumerable:!0,get:function(){return a.DisposeTrace}}),Object.defineProperty(t,"enableDisposeTrace",{enumerable:!0,get:function(){return a.enableDisposeTrace}}),Object.defineProperty(t,"disableDisposeTrace",{enumerable:!0,get:function(){return a.disableDisposeTrace}});var s=n("bc0c4da4ca");Object.defineProperty(t,"toDisposable",{enumerable:!0,get:function(){return s.toDisposable}}),Object.defineProperty(t,"isDisposable",{enumerable:!0,get:function(){return s.isDisposable}}),Object.defineProperty(t,"dispose",{enumerable:!0,get:function(){return s.dispose}}),Object.defineProperty(t,"combinedDisposable",{enumerable:!0,get:function(){return s.combinedDisposable}}),Object.defineProperty(t,"tryToDispose",{enumerable:!0,get:function(){return s.tryToDispose}}),Object.defineProperty(t,"tryToMarkDispose",{enumerable:!0,get:function(){return s.tryToMarkDispose}});var c=n("88476f9607");Object.defineProperty(t,"DisposableStore",{enumerable:!0,get:function(){return c.DisposableStore}});var u=n("dfdd551bdc");Object.defineProperty(t,"CancellationTokenSource",{enumerable:!0,get:function(){return u.CancellationTokenSource}})},"09eb40a269":function(e,t){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0,i=n;return[i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]]].join("")}},"0b588a7d4e":function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o}));var r=n("a282565e4f");class i{constructor(e,t){this.instance=e,this.descriptor=t}}class o extends Error{constructor(e){super(r.q),this.message=e.toString()}}},"0d2ffd3bdb":function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"DependentServiceCombinder",(function(){return xt})),n.d(t,"EventTarget",(function(){return lt})),n.d(t,"EventType",(function(){return pt})),n.d(t,"ExtensionConfigManager",(function(){return Nt})),n.d(t,"ExtensionEvent",(function(){return Ot})),n.d(t,"ExtensionManager",(function(){return dt})),n.d(t,"ExtensionService",(function(){return Ct})),n.d(t,"FCModule",(function(){return Xt})),n.d(t,"IDependentServiceCombinder",(function(){return St})),n.d(t,"IExtensionConfigManager",(function(){return Et})),n.d(t,"IExtensionEvent",(function(){return wt})),n.d(t,"IExtensionManager",(function(){return ht})),n.d(t,"IExtensionService",(function(){return Tt})),n.d(t,"LoadType",(function(){return Ae})),n.d(t,"ScriptLoaderAdapter",(function(){return $t})),n.d(t,"createExtensionService",(function(){return qt})),n.d(t,"initInstantiationService",(function(){return Kt})),n.d(t,"injectExtensionServiceToCollection",(function(){return Ht})),n.d(t,"patchScriptLoader",(function(){return Qt})),n.d(t,"registerExtensionService",(function(){return Gt}));n("d66c2b8c37"),n("47ca619755"),n("4f9dd793db");var r=n("9132715560"),i=n.n(r),o=n("6a364eb35c"),a=n.n(o),s=(n("b1e2246d82"),n("b8217400dc"),n("e6f68cdf2e"),n("3bf1976a4f"),n("fdb955876a"),n("c6244f7705"),n("8ee19818c4"),n("e8b2c0f5e8"),n("bd80bf2d0f"),n("3ef2352f0b")),c=n.n(s),u=n("d7c625d1f2"),d=(n("56683198d5"),n("73b854064b"),n("bd29e2df90")),l=n.n(d),p=n("ab5eb40518"),h=n.n(p),f=n("1b4cdd6a36"),v=n.n(f),y=n("0112351fbe"),b=n.n(y),_=(n("4a871f4295"),n("0cf3719522")),m=n.n(_),g=(n("081c8cafea"),n("3dc8f33382"),n("550d5dfc66")),O=n("4f04e6c8a0"),w=n("d5bac86374"),j=n("d63229afdc"),x=n("a73d724fe4"),S=(n("9617b3921c"),n("580f342750"),n("0368aca230")),E=(n("de37db1287"),n("8e7cce0ada"),n("85d48ef22b"),n("2a6f332b5e"),n("a84962d637"),n("f45588a8ad"),n("29f8c5f672"),n("1bab7b5fb7"),n("34cd92f77a"),n("c9a7ecac4d"),n("85d0a7609b")),C=n.n(E),D=(n("8fa580e5fd"),n("963f2eaace"),n("cb4ea8a0c0")),k=n("b7cba4397b"),I=(n("fce3077cdf"),n("229fddc286"),n("c78a4443e5")),M=n("536530eec5"),N=n("3c9d61c2e2"),T=n("2e1bb889e5"),R=n("b8775a3aa8"),A=n("1c3848e586"),P=n("804db59c17"),L=n("077be6c856"),B=n("2c8ead4d96"),U=n("488b683127"),V=n("ad36c1a004"),F=n("875795a3a0"),q=n("00b54de57b"),G=n("a7f251464e"),H=n("7785f226c3"),K=n("a4d5c68b5c"),W=n("fc82775981"),z=n("3bf31b711a"),$=n("1bf5e44e9b"),Y=n("03808c4177"),Q=n("b40f27bf29"),X=n("d6ca30ad13"),J=n("99d670dcab"),Z=n("e80cda9f13"),ee=n("7f96884de1"),te=n("192278b140"),ne=n("64973f262b"),re=n("6c5644ca25"),ie=n("8216980c74"),oe=n("4c53fae0e6"),ae=n("6daf052090"),se=n("e0b256019d"),ce=n("424dfc5646"),ue=n("523f223693"),de=n("de6faa8732"),le=n("67b3031e50"),pe=n("33b33312c5"),he=n("430ba8ff3a"),fe=n("31996f4bca"),ve=n("2223a5a8ca"),ye=n("f3360fb665"),be=n("b512c0eccb"),_e=n("14502724a6"),me=n.n(_e),ge=(n("7b8243a880"),n("433247001a"),n("2dea9e08f0"),n("5cd40edab3"),n("759492dad9"),n("570b26a0fa")),Oe=n("5fc26b30d4"),we=n.n(Oe),je=(n("75563bc376"),n("0acdc5834b"),n("af802ec74b"),n("6e20b6a7d8"),n("8eec1e4a03")),xe=n.n(je);n("6c6f26abf4");if("performance"in window||(window.performance={}),Date.now=Date.now||function(){return Date.now()},!("now"in window.performance)){var Se=Date.now();performance.timing&&performance.timing.navigationStart&&(Se=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-Se}}function Ee(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var Ce=function(e){l()(n,e);var t=Ee(n);function n(e){i()(this,n);var r="(Extension Error) ".concat(e);return t.call(this,r)}return a()(n)}(b()(Error)),De="ark_extension_function_cost",ke="ark_extension_function_error",Ie="ark_extension_load_cost",Me="ark_extension_load_fail",Ne=function(){function e(){i()(this,e)}return a()(e,null,[{key:"loadCost",value:function(e){var t=new CustomEvent(Ie,{detail:e});window.dispatchEvent(t)}},{key:"functionCallCost",value:function(e){var t=new CustomEvent(De,{detail:e});window.dispatchEvent(t)}},{key:"functionCallError",value:function(e){var t=new CustomEvent(ke,{detail:e});window.dispatchEvent(t)}},{key:"loadFail",value:function(e){var t=new CustomEvent(Me,{detail:e});window.dispatchEvent(t)}}]),e}();function Te(e,t,n){return"object"!==m()(e)?e:new Proxy(e,{get:function(e,r){var i=e[r];return i instanceof Function?function(){for(var e=performance.now(),o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];var c=i.call.apply(i,[this].concat(a));return c instanceof Promise&&(c.finally((function(){var i=performance.now()-e;Ne.functionCallCost({module:t,function:r,cost:i,url:n,start:e})})),c.catch((function(i){var o=performance.now()-e;Ne.functionCallError({module:t,function:r,cost:o,url:n,error:i,start:e})}))),c}:i}})}var Re,Ae,Pe,Le=Object(O.a)("IMetadataLoader"),Be=function(){function e(t){this.element=t,this.next=e.Undefined,this.prev=e.Undefined}return e.Undefined=new e(void 0),e}(),Ue=function(){function e(){this.first=Be.Undefined,this.last=Be.Undefined,this.mSize=0}return Object.defineProperty(e.prototype,"size",{get:function(){return this.mSize},enumerable:!1,configurable:!0}),e.prototype.isEmpty=function(){return this.first===Be.Undefined},e.prototype.clear=function(){this.first=Be.Undefined,this.last=Be.Undefined,this.mSize=0},e.prototype.unshift=function(e){return this.insert(e,!1)},e.prototype.push=function(e){return this.insert(e,!0)},e.prototype.shift=function(){if(this.first!==Be.Undefined){var e=this.first.element;return this.remove(this.first),e}},e.prototype.pop=function(){if(this.last!==Be.Undefined){var e=this.last.element;return this.remove(this.last),e}},e.prototype[Symbol.iterator]=function(){var e;return Object(u.__generator)(this,(function(t){switch(t.label){case 0:e=this.first,t.label=1;case 1:return e===Be.Undefined?[3,3]:[4,e.element];case 2:return t.sent(),e=e.next,[3,1];case 3:return[2]}}))},e.prototype.insert=function(e,t){var n=this,r=new Be(e);if(this.first===Be.Undefined)this.first=r,this.last=r;else if(t){var i=this.last;this.last=r,r.prev=i,i.next=r}else{var o=this.first;this.first=r,r.next=o,o.prev=r}this.mSize+=1;var a=!1;return function(){a||(a=!0,n.remove(r))}},e.prototype.remove=function(e){if(e.prev!==Be.Undefined&&e.next!==Be.Undefined){var t=e.prev;t.next=e.next,e.next.prev=t,e.next=Be.Undefined,e.prev=Be.Undefined}else e.prev===Be.Undefined&&e.next===Be.Undefined?(this.first=Be.Undefined,this.last=Be.Undefined):e.next===Be.Undefined?(this.last=this.last.prev,this.last.next=Be.Undefined,e.prev=Be.Undefined):e.prev===Be.Undefined&&(this.first=this.first.next,this.first.prev=Be.Undefined,e.next=Be.Undefined);this.mSize-=1},e}(),Ve=function(){function e(e){this.disposed=!1,this.options=e}return Object.defineProperty(e.prototype,"event",{get:function(){var e=this;return this.mEvent||(this.mEvent=function(t,n,r){var i,o,a;e.listeners||(e.listeners=new Ue);var s=e.listeners.isEmpty();s&&(null===(i=e.options)||void 0===i?void 0:i.onFirstListenerAdd)&&e.options.onFirstListenerAdd(e);var c=e.listeners.push(n?[t,n]:t);s&&(null===(o=e.options)||void 0===o?void 0:o.onFirstListenerDidAdd)&&e.options.onFirstListenerDidAdd(e),(null===(a=e.options)||void 0===a?void 0:a.onListenerDidAdd)&&e.options.onListenerDidAdd(e,t,n);var u={dispose:function(){var t;e.disposed||(c(),(null===(t=e.options)||void 0===t?void 0:t.onLastListenerRemove)&&(e.listeners&&!e.listeners.isEmpty()||e.options.onLastListenerRemove(e)));Object(S.markTracked)(u)},disposableId:"event"};return Array.isArray(r)&&r.push(u),Object(S.trackDisposable)(u),u}),this.mEvent},enumerable:!1,configurable:!0}),e.prototype.fire=function(e){var t,n;if(this.listeners){this.deliveryQueue||(this.deliveryQueue=new Ue);try{for(var r=Object(u.__values)(this.listeners),i=r.next();!i.done;i=r.next()){var o=i.value;this.deliveryQueue.push([o,e])}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}for(;this.deliveryQueue.size>0;){var a=Object(u.__read)(this.deliveryQueue.shift(),2),s=(o=a[0],a[1]);try{"function"==typeof o?o.call(void 0,s):o[0].call(o[1],s)}catch(e){console.error(e)}}}},e.prototype.dispose=function(){this.listeners&&this.listeners.clear(),this.deliveryQueue&&this.deliveryQueue.clear(),this.disposed=!0},e}();!function(e){e.LOADING="LOADING",e.LOADED="LOADED",e.ERROR="ERROR"}(Re||(Re={})),function(e){e[e.IDLE=1]="IDLE",e[e.ON_DEMAND=3]="ON_DEMAND",e[e.EAGER=7]="EAGER"}(Ae||(Ae={})),function(e){e.WAITING="waiting",e.LOADING="loading",e.ERROR="error",e.SUCCESS="success"}(Pe||(Pe={}));var Fe=function(){function t(){i()(this,t),this.loadCache=new Map,this.retryCountMap=new Map}return a()(t,[{key:"loadScript",value:function(e,t,n,r){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function i(){var o;return c.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(o=this.loadCache.get(t)){i.next=7;break}return this.setRetryCount(e,n),i.next=5,this.defferedLoadModule(e,t,r);case 5:o=i.sent,this.loadCache.set(t,o);case 7:return i.abrupt("return",o);case 8:case"end":return i.stop()}}),i,this)})))}},{key:"setRetryCount",value:function(e,t){this.retryCountMap.set(e,t)}},{key:"defferedLoadModule",value:function(e,t,n){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function r(){var i=this;return c.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",new Promise((function(r,o){var a={entryName:e,scriptUrl:t,isCss:n,curRetryCount:1,succCallback:r,failedCallback:o};i.loadInBrowser(a)})));case 1:case"end":return r.stop()}}),r)})))}},{key:"loadInBrowser",value:function(t){var n=this,r=t.entryName,i=t.scriptUrl,o=t.isCss,a=t.curRetryCount,s=t.succCallback,c=t.failedCallback,u=performance.now(),d=(o?this.buildLinkTag:this.buildScriptTag)(i,(function(){var t=performance.now()-u;Ne.loadCost({module:r,url:i,cost:t,start:u});var n=e[r];(null==n?void 0:n.default)?s(n.default):s(null!=n?n:{})}),(function(){var e=n.retryCountMap.get(r)||0,t=performance.now()-u;if(Ne.loadFail({module:r,url:i,info:"retryCount:".concat(e),cost:t,start:u}),a>e)c("failed to load module [".concat(r,"] after [").concat(a-1,"] retry times."));else{d.parentElement&&document.head.removeChild(d);var l={entryName:r,scriptUrl:i,isCss:o,curRetryCount:a+1,succCallback:s,failedCallback:c};n.loadInBrowser(l)}}));document.head.appendChild(d)}},{key:"buildLinkTag",value:function(e,t,n){var r=document.createElement("link");return r.rel="stylesheet",r.href=e,r.onload=t,r.onerror=n,r}},{key:"buildScriptTag",value:function(e,t,n){var r=document.createElement("script");r.type="text/javascript",r.src=e,r.async=!1;var i=window.location.protocol;return"http:"!==i&&"https:"!==i||(r.crossOrigin="anonymous"),r.onload=t,r.onerror=n,r}}]),t}(),qe=new Fe,Ge=function(){function e(t,n,r){var o,a;i()(this,e),this.hookEmitter=new Ve,this.loadState=Pe.WAITING,this.entryName=t,this.resourceUrl=n,this.options=r,this.retryTimes=null!==(o=null==r?void 0:r.retryTimes)&&void 0!==o?o:e.defaultRetryTimes,this.isCss=null!==(a=null==r?void 0:r.isCss)&&void 0!==a&&a,this.setupHooks()}return a()(e,[{key:"loadModule",value:function(){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function t(){var n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loadState=Pe.LOADING,this.hookEmitter.fire(Re.LOADING),t.prev=2,t.next=5,e.scriptLoader.loadScript(this.entryName,this.resourceUrl,this.retryTimes,this.isCss);case 5:return n=t.sent,this.loadState=Pe.SUCCESS,this.hookEmitter.fire(Re.LOADED),t.abrupt("return",n);case 11:throw t.prev=11,t.t0=t.catch(2),this.loadState=Pe.ERROR,this.hookEmitter.fire(Re.ERROR),t.t0;case 16:case"end":return t.stop()}}),t,this,[[2,11]])})))}},{key:"setupHooks",value:function(){var e=this;this.hookEmitter.event((function(t){var n,r,i=null===(r=null===(n=e.options)||void 0===n?void 0:n.hooks)||void 0===r?void 0:r[t];i&&i()}))}}]),e}();function He(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}Ge.defaultRetryTimes=2,Ge.scriptLoader=qe;var Ke=function(e){l()(n,e);var t=He(n);function n(e,r,o){var a;return i()(this,n),(a=t.call(this,e,r,o)).deferredModule=a.loadModule(),a}return a()(n,[{key:"getModule",value:function(){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.deferredModule);case 1:case"end":return e.stop()}}),e,this)})))}}]),n}(Ge),We=function(){function e(t){i()(this,e),this.url=t}return a()(e,[{key:"bootstrap",value:function(){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loader=new Ke(this.url,this.url),e.next=3,this.loader.getModule();case 3:case"end":return e.stop()}}),e,this)})))}}]),e}(),ze=function(){function e(t,n){i()(this,e),this.name=t,this.cdnPrefix=n}return a()(e,[{key:"bootstrap",value:function(){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function t(){var n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n="".concat(this.cdnPrefix.replace(/\/*$/,"/")).concat(this.name),e.loadRecords.has(n)){t.next=6;break}return this.loader=new Ke(this.name,n,{isCss:!0}),t.next=5,this.loader.getModule();case 5:e.loadRecords.add(n);case 6:case"end":return t.stop()}}),t,this)})))}}]),e}();ze.loadRecords=new Set;var $e=function(){function e(){var t=this;i()(this,e),this.isInnerOpen=!1,this.innerPromise=new Promise((function(e){t.completePromise=e}))}return a()(e,[{key:"isOpen",value:function(){return this.isInnerOpen}},{key:"open",value:function(){this.isInnerOpen=!0,this.completePromise(!0)}},{key:"wait",value:function(){return this.innerPromise}}]),e}();function Ye(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var Qe=function(e){l()(n,e);var t=Ye(n);function n(e,r,o){var a;return i()(this,n),(a=t.call(this,e,r,o)).schedulerHandler=D.scheduler,a.scheduleCallbackTask=a.loadWhenIdle(),a}return a()(n,[{key:"getModule",value:function(){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.loadState!==Pe.WAITING&&this.loadState!==Pe.ERROR){e.next=4;break}return this.schedulerHandler.cancelTask(this.scheduleCallbackTask),this.deferredModule=this.loadModule(),e.abrupt("return",this.deferredModule);case 4:return e.abrupt("return",this.deferredModule);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"loadWhenIdle",value:function(){var e=this;return this.schedulerHandler.scheduleTask((function(){e.deferredModule=e.loadModule()}))}}]),n}(Ge);function Xe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var Je,Ze=function(e){l()(n,e);var t=Xe(n);function n(){return i()(this,n),t.apply(this,arguments)}return a()(n,[{key:"getModule",value:function(){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.deferredModule=this.loadModule(),e.abrupt("return",this.deferredModule);case 2:case"end":return e.stop()}}),e,this)})))}}]),n}(Ge),et=(Je={},C()(Je,Ae.ON_DEMAND,Ze),C()(Je,Ae.IDLE,Qe),C()(Je,Ae.EAGER,Ke),Je),tt=function(){function e(t,n,r,o){i()(this,e),this.name=t,this.url=n,this.surpportLanguages=r,this.language=o,this.loadTypeMap=new Map}return a()(e,[{key:"bootstrap",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=null!==(e=this.loadTypeMap.get(t))&&void 0!==e?e:Ae.IDLE;this.loader=this.createLoader(n)}},{key:"addLoadType",value:function(e,t){this.loadTypeMap.set(null!=e?e:"",t)}},{key:"getInstance",value:function(){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.loader||this.bootstrap(),this.loader.loadState!==Pe.ERROR){e.next=3;break}throw new Ce("load extension [".concat(this.name,"] error."));case 3:return e.next=5,this.waitSingletonInstance();case 5:return e.abrupt("return",this.instance);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"waitSingletonInstance",value:function(){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.instance){e.next=2;break}return e.abrupt("return");case 2:if(!this.barrier){e.next=7;break}return e.next=5,this.barrier.wait();case 5:e.next=17;break;case 7:return this.barrier=new $e,e.next=10,this.loader.getModule();case 10:if("function"==typeof(t=e.sent)){e.next=14;break}throw Ne.loadFail({cost:-1,module:this.name,url:this.url,info:"constructor type: ".concat(m()(t))}),new Ce("something went wrong in ".concat(this.name,"'s constructor."));case 14:this.instance=Te(new t,this.name,this.url),this.instance.bootstraped=!1,this.barrier.open();case 17:case"end":return e.stop()}}),e,this)})))}},{key:"dealUrlForMultLanguage",value:function(e){var t,n=Array.isArray(e)?null==e?void 0:e[0]:e,r=null==n?void 0:n.lastIndexOf(".js");return-1===r||(null===(t=this.surpportLanguages)||void 0===t?void 0:t.includes(this.language))&&(n="".concat(n.slice(0,r),".").concat(this.language,".js")),n}},{key:"createLoader",value:function(e){return new(0,et[e])(this.name,this.dealUrlForMultLanguage(this.url))}}]),e}(),nt=function(){function e(){i()(this,e)}return a()(e,[{key:"bootstrap",value:function(){throw new Ce("genesis dependency node should not be called")}}]),e}();nt.nodeName="GENESIS_DEPENDENCY_NODE";var rt=k.a.getConfig('npm["@tencent/ark-extensions"]'),it=(null==rt?void 0:rt.React)||"//docs.idqqimg.com/tim/docs/components/libs/react-common-16.13.1-2bf240.js",ot=(null==rt?void 0:rt.ReactDOM)||"//docs.idqqimg.com/tim/docs/components/libs/react-common-16.13.1-2bf240.js",at=(null==rt?void 0:rt.DEFAULT_COMPONENT_CDN_PREFIX)||"//docs.gtimg.com/docs_components",st={React:it,ReactDOM:ot},ct=function(){function e(t){i()(this,e),this.name=t}return a()(e,[{key:"bootstrap",value:function(){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=st[this.name]){e.next=3;break}throw new Ce("common lib [".concat(this.name,"] is illegal because it's not in white list."));case 3:if(void 0!==window[this.name]){e.next=7;break}return this.loader=new Ke(this.name,t),e.next=7,this.loader.getModule();case 7:case"end":return e.stop()}}),e,this)})))}}]),e}(),ut=function(){function e(t,n){i()(this,e),this.name=t,this.cdnPrefix=n}return a()(e,[{key:"bootstrap",value:function(){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function t(){var n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n="".concat(this.cdnPrefix.replace(/\/*$/,"/")).concat(this.name),e.loadRecords.has(n)){t.next=6;break}return this.loader=new Ke(this.name,n),t.next=5,this.loader.getModule();case 5:e.loadRecords.add(n);case 6:case"end":return t.stop()}}),t,this)})))}}]),e}();ut.loadRecords=new Set;var dt=function(){function e(t){i()(this,e),this.metadataLoader=t,this.createDepGraph()}return a()(e,[{key:"addExtensionConfig",value:function(e){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.metadataRecord){t.next=4;break}return t.next=3,this.metadataLoader.getMetadataRecord();case 3:this.metadataRecord=t.sent;case 4:this.language=this.metadataLoader.getLanguage(),this.addDepNodeByConfig(e);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"addExtensionDescription",value:function(e){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function t(){var n,r,i;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.metadataRecord){t.next=4;break}return t.next=3,this.metadataLoader.getMetadataRecord();case 3:this.metadataRecord=t.sent;case 4:return n=e.name,r=e.loadType,(i=this.addExtensionDependencyNode(n,r)).bootstrap(),t.abrupt("return",i);case 8:case"end":return t.stop()}}),t,this)})))}},{key:"getInstance",value:function(e){return Object(u.__awaiter)(this,arguments,void 0,(function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.nodeName;return c.a.mark((function r(){var i,o,a,s,d,l,p,h,f,v,y,b;return c.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.depGraph.directDependantsOf(e).includes(n)){r.next=4;break}throw Ne.loadFail({module:e,url:"",cost:-1,info:"cannot find in metadata"}),new Ce("Cannot get ".concat(e," extension in ").concat(n,", please add configuration !"));case 4:d=t.depGraph.getNodeData(e),l=t.depGraph.directDependenciesOf(e),r.prev=6,p=!0,h=Object(u.__asyncValues)(l);case 8:return r.next=10,h.next();case 10:if(f=r.sent,i=f.done){r.next=22;break}return s=f.value,p=!1,v=s,y=t.depGraph.getNodeData(v),r.next=19,y.bootstrap(e);case 19:p=!0,r.next=8;break;case 22:r.next=27;break;case 24:r.prev=24,r.t0=r.catch(6),o={error:r.t0};case 27:if(r.prev=27,r.prev=28,p||i||!(a=h.return)){r.next=32;break}return r.next=32,a.call(h);case 32:if(r.prev=32,!o){r.next=35;break}throw o.error;case 35:return r.finish(32);case 36:return r.finish(27);case 37:return r.next=39,d.getInstance();case 39:return b=r.sent,r.abrupt("return",b);case 41:case"end":return r.stop()}}),r,null,[[6,24,27,37],[28,,32,36]])}))()}))}},{key:"getDepGraph",value:function(){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.depGraph);case 1:case"end":return e.stop()}}),e,this)})))}},{key:"createDepGraph",value:function(){this.depGraph=new g.DepGraph;var e=new nt;this.depGraph.addNode(nt.nodeName,e)}},{key:"addDepNodeByConfig",value:function(e){var t=this;e.forEach((function(e){var n=e.name,r=e.loadType;try{var i=t.addExtensionDependencyNode(n,r);t.depGraph.addDependency(nt.nodeName,i.name)}catch(e){console.error(e)}}))}},{key:"addLibraryDependencyNode",value:function(e){var t=new ct(e);this.depGraph.addNode(e,t)}},{key:"addModulesDependencyNode",value:function(e,t){var n=new ut(e,t);this.depGraph.addNode(e,n)}},{key:"addCSSDependencyNode",value:function(e,t){var n=new ze(e,t);this.depGraph.addNode(e,n)}},{key:"addChunkDependencyNode",value:function(e){var t=new We(e);this.depGraph.addNode(e,t)}},{key:"addExtensionDependencyNode",value:function(e,t,n){var r=this;if(this.depGraph.hasNode(e)){var i=this.depGraph.getNodeData(e);return i.addLoadType(n,t),i}var o=this.metadataRecord[e];if(!o)throw new Ce("Cannot find ".concat(e," extension in metadata!"));var a=o.url,s=o.chunks,c=void 0===s?[]:s,u=o.dependencies,d=void 0===u?{}:u,l=o.surpportLanguages,p=void 0===l?[]:l,h=d.commonModules,f=void 0===h?[]:h,v=d.commonLibs,y=void 0===v?[]:v,b=d.extensions,_=void 0===b?[]:b,m=d.css,g=void 0===m?[]:m,O=new tt(e,a,p,this.language);return O.addLoadType(n,t),this.depGraph.addNode(e,O),c.forEach((function(t){r.addChunkDependencyNode(t),r.depGraph.addDependency(e,t)})),y.forEach((function(t){r.addLibraryDependencyNode(t),r.depGraph.addDependency(e,t)})),f.forEach((function(t){r.addModulesDependencyNode(t,r.metadataLoader.COMPONENT_CDN_PREFIX),r.depGraph.addDependency(e,t)})),g.forEach((function(t){r.addCSSDependencyNode(t,r.metadataLoader.COMPONENT_CDN_PREFIX),r.depGraph.addDependency(e,t)})),_.forEach((function(t){var n;try{var i=null!==(n=Ae[t.loadType.toString()])&&void 0!==n?n:Ae.ON_DEMAND;r.addExtensionDependencyNode(t.name,i,e),r.depGraph.addDependency(e,t.name)}catch(e){console.error(e)}})),O}}]),e}();dt=Object(u.__decorate)([Object(u.__param)(0,Le),Object(u.__metadata)("design:paramtypes",[Object])],dt);var lt,pt,ht=Object(O.a)("IExtensionManager");!function(e){e[e.WINDOW=0]="WINDOW",e[e.DOCUMENT=1]="DOCUMENT",e[e.DOCUMENT_BODY=2]="DOCUMENT_BODY"}(lt||(lt={})),function(e){e.RESIZE="resize",e.MOUSE_DOWN="mousedown",e.MOUSE_MOVE="mousemove",e.MOUSE_UP="mouseup",e.KEY_UP="keyup",e.KEY_DOWN="keydown",e.CLICK="click",e.TOUCH_START="touchstart",e.TOUCH_MOVE="touchmove",e.TOUCH_END="touchend",e.POP_STATE="popState",e.VISIBILITY_CHANGE="visibilitychange",e.ONLINE="online",e.OFFLINE="offline",e.MESSAGE="message",e.CUSTOM="custom"}(pt||(pt={}));var ft=function(){function e(){i()(this,e),this.eventListenerSet=new Set,this.customEventListenerMap=new Map}return a()(e,[{key:"listen",value:function(e){var t=e.type;switch(t){case pt.RESIZE:case pt.MOUSE_DOWN:case pt.MOUSE_MOVE:case pt.MOUSE_UP:case pt.KEY_UP:case pt.KEY_DOWN:case pt.CLICK:case pt.TOUCH_START:case pt.TOUCH_MOVE:case pt.TOUCH_END:case pt.POP_STATE:case pt.VISIBILITY_CHANGE:case pt.ONLINE:case pt.OFFLINE:case pt.MESSAGE:return this.bindEvent(e);case pt.CUSTOM:return this.bindCustomEvent(e);default:throw new Ce("[".concat(t,"] event is not supported to use in extensions."))}}},{key:"listenCustomEvent",value:function(e){return this.bindCustomEvent(e),{name:e.name,fire:this.dispatchCustomEvent.bind(this,e.name)}}},{key:"dispatchCustomEvent",value:function(e,t){var n=new CustomEvent(e,{detail:t});this.node.dispatchEvent(n)}},{key:"remove",value:function(e){if(!this.eventListenerSet.has(e))throw new Ce("unable to remove [".concat(e.type,"] event which is not in your namespace or not bound."));var t=e.name,n=e.type,r=e.fn,i=e.options;if(n===pt.CUSTOM)return this.node.removeEventListener(t,r,i),void this.customEventListenerMap.delete(t);this.node.removeEventListener(n,r,i),this.eventListenerSet.delete(e)}},{key:"removeAll",value:function(){var e=this;this.eventListenerSet.forEach((function(t){e.remove(t)})),this.customEventListenerMap.forEach((function(t){e.remove(t)}))}},{key:"bindEvent",value:function(e){if(this.eventListenerSet.has(e))throw new Ce("duplicated [".concat(e.type,"] event."));var t=e.type,n=e.fn,r=e.options;this.node.addEventListener(t,n,r),this.eventListenerSet.add(e)}},{key:"bindCustomEvent",value:function(e){var t=e.name;if(this.customEventListenerMap.has(t))throw new Ce("duplicated [".concat(t,"] event."));var n=t,r=e.fn,i=e.options;this.node.addEventListener(n,r,i),this.customEventListenerMap.set(t,e)}}]),e}();function vt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var yt=function(e){l()(n,e);var t=vt(n);function n(){var e;return i()(this,n),(e=t.apply(this,arguments)).node=document.body,e}return a()(n)}(ft);function bt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var _t=function(e){l()(n,e);var t=bt(n);function n(){var e;return i()(this,n),(e=t.apply(this,arguments)).node=document,e}return a()(n)}(ft);function mt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var gt=function(e){l()(n,e);var t=mt(n);function n(){var e;return i()(this,n),(e=t.apply(this,arguments)).node=window,e}return a()(n)}(ft),Ot=function(){function e(){i()(this,e),this.initEventManagerPool()}return a()(e,[{key:"addListener",value:function(e){var t=e.target;return this.eventManagerPool[t].listen(e)}},{key:"removeListener",value:function(e){var t=e.target;return this.eventManagerPool[t].remove(e)}},{key:"removeAllListener",value:function(){Object.values(this.eventManagerPool).forEach((function(e){e.removeAll()}))}},{key:"initEventManagerPool",value:function(){var e,t=new gt,n=new _t,r=new yt;this.eventManagerPool=(e={},C()(e,lt.WINDOW,t),C()(e,lt.DOCUMENT,n),C()(e,lt.DOCUMENT_BODY,r),e)}}]),e}(),wt=Object(O.a)("IExtensionEvent"),jt=Object(O.a)("IExtensionContainerService"),xt=function(){function e(t,n,r,o,a,s,c,u,d,l,p,h,f,v,y,b,_,m,g,O,w,j){i()(this,e),this.docMetaDomain=t,this.userInfoDomain=n,this.authDomain=r,this.fileDomain=o,this.likeDomain=a,this.folderDomain=s,this.templateDomain=c,this.accountDomain=u,this.loginDomain=d,this.notificationDomain=l,this.shareDomain=p,this.messageDomain=h,this.collaborateDomain=f,this.notifyScopeDomain=v,this.atMessageDomain=y,this.fileInfoDomain=b,this.connectionControllerService=_,this.accountApplication=m,this.enterpriseAccountApplication=g,this.docsManagementService=O,this.extensionEvent=w,this.extensionContainerService=j}return a()(e,[{key:"getExtensionService",value:function(e,t){return{getExtension:function(n){return e.safeGetExtension.call(e,n,t)},fireExtensionEvent:e.fireExtensionEvent.bind(e,t)}}},{key:"getDomainService",value:function(){return{docMetaDomain:this.docMetaDomain,userInfoDomain:this.userInfoDomain,authDomain:this.authDomain,fileDomain:this.fileDomain,likeDomain:this.likeDomain,folderDomain:this.folderDomain,templateDomain:this.templateDomain,accountDomain:this.accountDomain,loginDomain:this.loginDomain,notificationDomain:this.notificationDomain,shareDomain:this.shareDomain,messageDomain:this.messageDomain,collaborateDomain:this.collaborateDomain,notifyScopeDomain:this.notifyScopeDomain,atMessageDomain:this.atMessageDomain,fileInfoDomain:this.fileInfoDomain}}},{key:"getApplicationService",value:function(){return{accountApplication:this.accountApplication,enterpriseAccountApplication:this.enterpriseAccountApplication,connectionControllerService:this.connectionControllerService,docsManagementService:this.docsManagementService}}},{key:"getToolService",value:function(){return{networkRequest:be.networkRequest,event:this.extensionEvent}}},{key:"getExtensionContainerService",value:function(e){return{createContainerIfUnspecified:this.extensionContainerService.createContainerIfUnspecified.bind(this.extensionContainerService,e),createSandboxContainerIfUnspecified:this.extensionContainerService.createSandboxContainerIfUnspecified.bind(this.extensionContainerService,e)}}}]),e}();xt=Object(u.__decorate)([Object(u.__param)(0,M.a),Object(u.__param)(1,N.a),Object(u.__param)(2,T.a),Object(u.__param)(3,R.a),Object(u.__param)(4,A.a),Object(u.__param)(5,P.a),Object(u.__param)(6,L.a),Object(u.__param)(7,B.a),Object(u.__param)(8,U.a),Object(u.__param)(9,V.a),Object(u.__param)(10,F.a),Object(u.__param)(11,q.a),Object(u.__param)(12,G.a),Object(u.__param)(13,H.a),Object(u.__param)(14,K.a),Object(u.__param)(15,W.a),Object(u.__param)(16,I.f),Object(u.__param)(17,I.e),Object(u.__param)(18,I.h),Object(u.__param)(19,I.g),Object(u.__param)(20,wt),Object(u.__param)(21,jt),Object(u.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object])],xt);var St=Object(O.a)("IDependentServiceCombinder"),Et=Object(O.a)("IExtensionConfigManager"),Ct=function(){function e(t,n,r,o){i()(this,e),this.dependentServiceCombinder=t,this.extensionConfigManager=n,this.extensionManager=r,this.domainUpdater=o,this.extensionEventEmitter=new Ve}return a()(e,[{key:"updateDomainWithClientVars",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.domainUpdater.updateDomainWithClientVars(e,t)}},{key:"updateDomainWithRequests",value:function(e,t){this.domainUpdater.updateDomainWithRequests({docId:e,u:t})}},{key:"scanAndHandleExtensions",value:function(e){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.addExtensionConfig(e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"addExtensionConfig",value:function(e){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.extensionConfigReadyBarrier){t.next=5;break}return t.next=3,this.extensionConfigReadyBarrier.wait();case 3:t.next=6;break;case 5:this.extensionConfigReadyBarrier=new $e;case 6:return t.next=8,this.extensionConfigManager.addExtensionConfig(e);case 8:this.extensionConfigReadyBarrier.open();case 9:case"end":return t.stop()}}),t,this)})))}},{key:"addExtensionDescription",value:function(e){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.extensionConfigManager.addExtensionDescription(e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"subscribeExtensionEvent",value:function(e){this.extensionEventEmitter.event((function(t){e(t.extensionName,t.type)}))}},{key:"fireExtensionEvent",value:function(e,t){var n={extensionName:e,type:t};this.extensionEventEmitter.fire(n)}},{key:"getExtension",value:function(e){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.safeGetExtension(e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"dispose",value:function(){throw new Error("Method not implemented.")}},{key:"disposeAllExtensions",value:function(){throw new Error("Method not implemented.")}},{key:"getExtensionConfig",value:function(){return this.extensionConfigManager.getExtensionConfig()}},{key:"getExtensionDepGraph",value:function(){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.extensionManager.getDepGraph());case 1:case"end":return e.stop()}}),e,this)})))}},{key:"safeGetExtension",value:function(e,t){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function n(){var r;return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.extensionConfigReadyBarrier.wait();case 2:return n.next=4,this.extensionManager.getInstance(e,t);case 4:return r=n.sent,this.bootstrapExtension(e,r),n.abrupt("return",r);case 7:case"end":return n.stop()}}),n,this)})))}},{key:"bootstrapExtension",value:function(e,t){if(!t.bootstraped){var n=this.dependentServiceCombinder.getExtensionService(this,e),r=this.dependentServiceCombinder.getDomainService(),i=this.dependentServiceCombinder.getApplicationService(),o=this.dependentServiceCombinder.getToolService(),a=this.dependentServiceCombinder.getExtensionContainerService(e),s=this.extensionConfigManager.findExtensionDescription(e),c=null==s?void 0:s.containerId,u=this.getContainer(c);t.bootstrap({extensionService:n,domainService:r,toolService:o,applicationService:i,containerService:a,extensionName:e,container:u}),t.bootstraped=!0}}},{key:"getContainer",value:function(e){var t=null;return e&&(t=document.getElementById(e)),t}}]),e}();Ct=Object(u.__decorate)([Object(u.__param)(0,St),Object(u.__param)(1,Et),Object(u.__param)(2,ht),Object(u.__param)(3,z.a),Object(u.__metadata)("design:paramtypes",[Object,Object,Object,Object])],Ct);var Dt="ark_extension",kt="__ark_extends_init_error_handler__";function It(){window[kt]||(window[kt]=!0,window.addEventListener(Me,(function(e){Object(ge.tdwSingle)({opername:Dt,module:e.detail.module,action:"load_fail",ver7:e.detail.url,ver8:e.detail.cost,ver9:e.detail.start,ver10:e.detail.info})})),window.addEventListener(Ie,(function(e){Object(ge.tdw)({opername:Dt,module:e.detail.module,action:"cost",ver7:e.detail.url,ver8:e.detail.cost,ver9:e.detail.start})})),window.addEventListener(ke,(function(e){var t,n=e.detail.error instanceof Error?e.detail.error.stack:null===(t=e.detail.error)||void 0===t?void 0:t.toString();Object(ge.tdwSingle)({opername:Dt,module:e.detail.module,action:"call_error",ver7:e.detail.url,ver8:e.detail.cost,ver9:e.detail.function,ver10:n,ver11:e.detail.start})})),window.addEventListener(De,(function(e){e.detail.cost<1e3||Object(ge.tdw)({opername:Dt,module:e.detail.module,action:"call",ver7:e.detail.url,ver8:e.detail.cost,ver9:e.detail.function,ver11:e.detail.start})})),window.addEventListener("error",(function(e){var t;if((null==e?void 0:e.error)instanceof Error){var n=we.a.parse(e.error),r=[];if(n.forEach((function(e){if(e.fileName){var t=function(e){var t=new RegExp(/(docs-component-.*)\..*\.js$/).exec(e);if(null==t?void 0:t[1])return t[1]}(e.fileName);t&&r.push(t)}})),0!==r.length){var i=r[r.length-1];Object(ge.tdwSingle)({opername:Dt,action:"js_error",module:i,ver7:e.message,ver8:null===(t=e.error)||void 0===t?void 0:t.stack,ver9:r.join("->")})}}})))}var Mt=function(){function e(){i()(this,e),this.containerCollectionId="__unspesified_extension_container_collection__"}return a()(e,[{key:"createContainerIfUnspecified",value:function(e){this.unspecifiedContainerCollection=this.getUnspecifiedContainerCollection();var t=this.unspecifiedContainerCollection.querySelector("#".concat(e));return t||((t=document.createElement("div")).setAttribute("id",e),this.unspecifiedContainerCollection.appendChild(t),t)}},{key:"createSandboxContainerIfUnspecified",value:function(){throw new Error("Method not implemented.")}},{key:"getUnspecifiedContainerCollection",value:function(){var e=document.getElementById(this.containerCollectionId);return e||((e=document.createElement("div")).setAttribute("id",this.containerCollectionId),document.body.appendChild(e)),e}}]),e}(),Nt=function(){function e(t){i()(this,e),this.extensionManager=t,this.extensionConfig=[]}return a()(e,[{key:"addExtensionConfig",value:function(e){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.extensionConfig=this.extensionConfig.concat(e),t.next=3,this.extensionManager.addExtensionConfig(e);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"addExtensionDescription",value:function(e){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.assertNoDuplicatedDescription(e),this.extensionConfig.push(e),t.next=4,this.extensionManager.addExtensionDescription(e);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"getExtensionConfig",value:function(){return this.extensionConfig}},{key:"findExtensionDescription",value:function(e){return this.extensionConfig.find((function(t){return t.name===e}))}},{key:"iterateExtensionConfig",value:function(e){this.extensionConfig.forEach(e)}},{key:"assertNoDuplicatedDescription",value:function(e){if(this.extensionConfig.find((function(t){return t.name===e.name})))throw new Ce("duplicated extension config of ".concat(e.name,"."))}}]),e}();Nt=Object(u.__decorate)([Object(u.__param)(0,ht),Object(u.__metadata)("design:paramtypes",[Object])],Nt);var Tt=Object(O.a)("IExtensionService"),Rt=Symbol.for("__META_REQUEST_CACHE__"),At=window.location,Pt=At.protocol,Lt=At.host,Bt="".concat(Pt,"//").concat(Lt,"/components/docs/metadata{{specifiedVersionKey}}.json?t={{time}}"),Ut=function(){function e(t){var n,r,o;i()(this,e),this.COMPONENT_CDN_PREFIX=null!==(n=t.componentCdnPrefix)&&void 0!==n?n:at,this.specifiedVersionKey=t.specifiedVersion?".v".concat(t.specifiedVersion):"",this.METADATA_URL=null!==(r=t.metadataUrl)&&void 0!==r?r:Bt,this.language=null!==(o=t.language)&&void 0!==o?o:""}return a()(e,[{key:"metadataRequestCacheMap",get:function(){return void 0===globalThis[Rt]&&(globalThis[Rt]=new Map),globalThis[Rt]}},{key:"getMetadataRecord",value:function(){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function e(){var t,n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.metadataRequestCacheMap.has(this.specifiedVersionKey),n=t?this.metadataRequestCacheMap.get(this.specifiedVersionKey):this.requestMetadataRecord(),t||this.metadataRequestCacheMap.set(this.specifiedVersionKey,n),e.next=5,n;case 5:return r=e.sent,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"getLanguage",value:function(){return this.language}},{key:"loadMetadataScript",value:function(e){return new Promise((function(t,n){var r=document.createElement("script");r.src=e,r.async=!1,r.type="text/javascript",r.addEventListener("load",(function(){return t()})),r.addEventListener("error",(function(e){return n(e)})),document.body.appendChild(r)}))}},{key:"requestMetadataRecord",value:function(){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function e(){var t,n,r,i,o,a,s,u,d=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.METADATA_URL.replace("{{specifiedVersionKey}}",this.specifiedVersionKey).replace("{{time}}",Date.now().toString()),n=performance.now(),"http:"===Pt||"https:"===Pt||!this.METADATA_URL.includes("js")||this.METADATA_URL.includes("json")){e.next=14;break}return e.prev=3,e.next=6,this.loadMetadataScript(t);case 6:r={data:window.METADATA_DATA,status:0},e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),r={data:{},status:e.t0};case 12:e.next=17;break;case 14:return e.next=16,be.networkRequest.get(t);case 16:r=e.sent;case 17:if(i=performance.now(),o=i-n,Ne.loadCost({module:"metadata",url:t,cost:o,start:n}),r.data){e.next=23;break}throw Ne.loadFail({module:"metadata",url:t,info:r.status.toString(),cost:o,start:n}),new Ce("request metadata error, error code: [".concat(r.status,"]."));case 23:return a=r.data,s=void 0===a?{}:a,u=Object.values(s).reduce((function(e,t){return Object.assign(Object.assign({},e),C()({},t.name,Object.assign(Object.assign({},t),{url:d.getMetadataUrl(t)})))}),{}),e.abrupt("return",u);case 26:case"end":return e.stop()}}),e,this,[[3,9]])})))}},{key:"getMetadataUrl",value:function(e){var t=this;return Array.isArray(e.url)?e.url.map((function(e){return"".concat(t.COMPONENT_CDN_PREFIX,"/").concat(e)})):["".concat(this.COMPONENT_CDN_PREFIX,"/").concat(e.url)]}}]),e}(),Vt="__ARK_EXTENSION_INSTANTIATION_SERVICE__",Ft="__ARK_EXTENSION_SERVICE__";function qt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=globalThis[Ft];if(t)return t;var n=new w.a,r=new j.a,i={serviceRegister:n,serviceCollection:r};Gt(i,e),Ht(i);var o=Kt(r);globalThis[Vt]=o;var a=globalThis[Ft]=function(e){return e.invokeFunction((function(e){return e.get(Tt)}))}(o);return It(),a}function Gt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.serviceRegister;r.register(Tt,Ct),r.register(Et,Nt),r.register(Le,Ut,[null!==(t=n.metadataLoaderOptions||n.metadataLoader)&&void 0!==t?t:{}]),r.register(ht,dt)}(e,t),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.serviceRegister,r=t.isEnterprise;n.register(z.a,$.a),n.register(Y.a,Q.a),n.register(T.a,X.a),n.register(V.a,J.a),n.register(F.a,Z.a),n.register(G.a,ee.a),n.register(B.a,te.a),n.register(ne.a,re.a),n.register(M.a,r?ie.a:oe.a),n.register(N.a,ae.a),n.register(R.a,se.a),n.register(W.a,ce.a),n.register(P.a,ue.a),n.register(L.a,de.a),n.register(U.a,le.a),n.register(q.a,pe.a),n.register(H.a,he.a),n.register(K.a,fe.a),n.register(A.a,r?ve.a:ye.a),n.register(I.f,I.b),n.register(I.e,I.a),n.register(I.h,I.d),n.register(I.g,I.c),n.register(St,xt),n.register(wt,Ot),n.register(jt,Mt)}(e,t)}function Ht(e){var t=e.serviceRegister,n=e.serviceCollection;t.getServiceDescriptors().forEach((function(e){var t=me()(e,2),r=t[0],i=t[1];n.set(r,i)}))}function Kt(e){return new x.a(e)}var Wt=function(){function e(t){return i()(this,e),this.scriptLoader=t||window.ScriptLoader||window.SLR,new Proxy(this,{set:function(e,t,n){return void 0!==e.scriptLoader[t]?(e.scriptLoader[t]=n,!0):(e[t]=n,!0)},get:function(e,t){return e[t]?e[t]:e.scriptLoader[t]?"function"==typeof e.scriptLoader[t]?e.scriptLoader[t].bind(e.scriptLoader):e.scriptLoader[t]:void 0}})}return a()(e,[{key:"init",value:function(e,t,n,r){this.scriptLoader.init(e,t,n,r)}},{key:"load",value:function(e,t,n,r){this.scriptLoader.load(e,t,n,r)}},{key:"dispatch",value:function(e,t){this.scriptLoader.dispatch(e,t)}},{key:"listen",value:function(e,t){this.scriptLoader.listen(e,t)}}]),e}();function zt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var $t=function(e){l()(n,e);var t=zt(n);function n(e){var r;return i()(this,n),(r=t.call(this,e)).__adpater__=!0,r.__version__="3.19.18",r.isReady=!1,r.onReadyEmitter=new Ve,r.fcModuleMap=new Map,r.extensionService=qt(),r.domainUpdater=r.extensionService.domainUpdater,r.extensionService.getExtensionConfig()||r.extensionService.scanAndHandleExtensions([]),r.onReady=r.onReadyEmitter.event,r}return a()(n,[{key:"ready",value:function(){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function e(){var t=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.updateDomainWithClientVars();case 2:return setTimeout((function(){t.isReady=!0,t.onReadyEmitter.fire()}),0),e.abrupt("return",this);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"registerExternalModule",value:function(e,t){this.fcModuleMap.has(e)||(t.bootstrap(this.extensionService,this),this.fcModuleMap.set(e,t))}},{key:"loadExternalModule",value:function(e,t,n){var r=this.fcModuleMap.get(e);void 0!==r?t(r):null==n||n()}},{key:"load",value:function(e,t,r,i){var o=this;this.isReady?this.fcModuleMap.has(e)?this.loadExternalModule(e,t,r):xe()(v()(n.prototype),"load",this).call(this,e,t,r,i):this.onReady((function(){o.load(e,t,r,i)}))}},{key:"updateDomainWithClientVars",value:function(){var e=this;return new Promise((function(t,n){setTimeout((function r(){try{if(!0===window.__DISALBE_AUTO_UPDATE_CLIENT_VARS__)return e.listen("updateDomainWithClientVars",(function(){e.domainUpdater.updateDomainWithClientVars(window.clientVars,!1)})),void t();if(void 0!==window.clientVars)return window.clientVars.padId&&e.domainUpdater.updateDomainWithClientVars(window.clientVars,!1),void t();setTimeout(r,0)}catch(e){n(e)}}),0)}))}}],[{key:"getInstance",value:function(e){return void 0===n.instance&&(n.instance=new n(e)),n.instance}}]),n}(Wt),Yt=function(){return window.ScriptLoader||window.SLR};function Qt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Yt();if(void 0===e)throw new Error("window.ScriptLoader OR window.SLR is undefined, use `patchScriptLoader(scriptLoader)` to patch");if(e instanceof $t||e.__adpater__)return e;var t=$t.getInstance(e);return window.ScriptLoader=t,window.SLR=t,t}var Xt=function(){function e(){i()(this,e)}return a()(e,[{key:"bootstrap",value:function(e,t){this.extensionService=e,this.scriptLoader=t}},{key:"load",value:function(e){return Object(u.__awaiter)(this,void 0,void 0,c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.extension){t.next=2;break}return t.abrupt("return",this.extension);case 2:return t.next=4,this.extensionService.addExtensionDescription({name:this.name,branch:this.branch,containerId:e.id,loadType:Ae.EAGER});case 4:return t.next=6,this.extensionService.getExtension(this.name);case 6:return this.extension=t.sent,t.abrupt("return",this.extension);case 8:case"end":return t.stop()}}),t,this)})))}}]),e}()}.call(this,n("5ef37df1a0"))},"10f9b6de11":function(e,t,n){"use strict";n.r(t),n.d(t,"ACCOUNT_TYPE",(function(){return tn})),n.d(t,"ALL_LOCAL_FILES_DB_NAME",(function(){return cn})),n.d(t,"BIND_TYPE",(function(){return rn})),n.d(t,"BaseChangeModel",(function(){return ln})),n.d(t,"DB_NAME",(function(){return sn})),n.d(t,"DB_NAME_TESTENV",(function(){return un})),n.d(t,"DOCUMENT_DATA_TYPE",(function(){return Qt})),n.d(t,"DOCUMENT_POLICY",(function(){return Kt})),n.d(t,"DOCUMENT_RESOURCE_CACHE_STATUS",(function(){return zt})),n.d(t,"DOCUMENT_STATUS",(function(){return Wt})),n.d(t,"DOCUMENT_TYPE",(function(){return Ft})),n.d(t,"DOCUMENT_TYPE_DESC",(function(){return qt})),n.d(t,"DOCUMENT_TYPE_DESC_MAP",(function(){return Zt})),n.d(t,"DOCUMENT_TYPE_MAP",(function(){return Jt})),n.d(t,"DRIVE_TYPE",(function(){return Xt})),n.d(t,"DocumentData",(function(){return hn})),n.d(t,"DocumentEntity",(function(){return vn})),n.d(t,"DocumentId",(function(){return bn})),n.d(t,"DocumentStatus",(function(){return mn})),n.d(t,"DriveData",(function(){return On})),n.d(t,"LIST_INFO_TYPE",(function(){return $t})),n.d(t,"LIST_TYPE",(function(){return Yt})),n.d(t,"OfflineData",(function(){return jn})),n.d(t,"PadInfo",(function(){return Sn})),n.d(t,"TABLE_NAME",(function(){return en})),n.d(t,"UserInfo",(function(){return Cn})),n.d(t,"VipLevel",(function(){return an})),n.d(t,"VipType",(function(){return on}));var r,i,o=n("85d0a7609b"),a=n.n(o),s=(n("c6244f7705"),n("56683198d5"),n("73b854064b"),n("9132715560")),c=n.n(s),u=n("6a364eb35c"),d=n.n(u),l=n("bd29e2df90"),p=n.n(l),h=n("ab5eb40518"),f=n.n(h),v=n("1b4cdd6a36"),y=n.n(v),b=(n("d66c2b8c37"),n("47ca619755"),n("3bf1976a4f"),n("826dc923b3"),n("d7c625d1f2"));!function(e){e.CreateCollection="create-collection",e.DropCollection="drop-collection",e.CreateIndex="create-index",e.DropIndex="drop-index"}(r||(r={})),function(e){e.MoveProperty="move-property",e.DropProperty="drop-property",e.ReplaceProperty="replace-property",e.ClearData="clear-data",e.ReplaceData="replace-data"}(i||(i={}));var _,m={name:"alloy_db_schema_table",indices:[],key:{path:"name"},properties:[]};!function(e){e.Equals="=",e.NotEquals="!=",e.GreaterThan=">",e.GreaterOrEqualThan=">=",e.LessThan="<",e.LessOrEqualThan="<=",e.In="in",e.NotIn="nin"}(_||(_={}));var g,O,w,j,x,S=void 0;function E(e){return"number"==typeof e&&!Number.isNaN(e)||"string"==typeof e||e instanceof Date&&!Number.isNaN(e.getTime())||e instanceof ArrayBuffer||ArrayBuffer.isView(e)||Array.isArray(e)&&e.every(E)}function C(e,t){var n=e;return Array.isArray(t)?t.map((function(e){return n[e]})):n[t]}function D(e,t){return Array.isArray(e)?Array.isArray(t)&&e.length===t.length&&e.every((function(e,n){return D(e,t[n])})):e===t}!function(e){e.OR="or",e.AND="and",e.FILTER="filter",e.NONE="none",e.ALL="all"}(g||(g={})),function(e){e.ENTRIES="entries",e.VALUES="values",e.KEYS="keys",e.COUNT="count"}(O||(O={})),function(e){e.DESCENDING="desc",e.ASCENDING="asc"}(w||(w={})),function(e){e.AutoIncrement="auto-increment"}(j||(j={})),function(e){e.Equals="=",e.GreaterThan=">",e.GreaterOrEqualThan=">=",e.LessThan="<",e.LessOrEqualThan="<="}(x||(x={}));var k,I=function(){function e(){}return e.collectionDiff=function(e,t){if(e.name!==t.name)throw new Error("can not compare collection schema with different name");var n={collection:e.name},r=t.indices.filter((function(t){return!e.indices.some((function(e){return e.name===t.name}))})),i=e.indices.filter((function(e){return!t.indices.some((function(t){return t.name===e.name}))}));return(r.length||i.length)&&(n.index={added:Object(b.__spreadArray)([],Object(b.__read)(r)),deleted:Object(b.__spreadArray)([],Object(b.__read)(i))}),n},e.databaseDiff=function(e,t){var n,r,i=this.getCompareMap(e,t),o={added:[],deleted:[],different:[]};try{for(var a=Object(b.__values)(i.values()),s=a.next();!s.done;s=a.next()){var c=s.value;if(!c.oldValue||c.newValue)if(c.oldValue||!c.newValue){if(c.oldValue&&c.newValue){var u=this.collectionDiff(c.oldValue,c.newValue);if(!u.index)continue;o.different.push(u)}}else o.added.push(c.newValue);else o.deleted.push(c.oldValue)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},e.getCompareMap=function(e,t){var n,r,i,o,a=new Map;try{for(var s=Object(b.__values)(t.collections),c=s.next();!c.done;c=s.next()){var u=c.value;(p=a.get(u.name)||{}).newValue=u,a.set(u.name,p)}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}try{for(var d=Object(b.__values)(e.collections),l=d.next();!l.done;l=d.next()){var p;u=l.value;(p=a.get(u.name)||{}).oldValue=u,a.set(u.name,p)}}catch(e){i={error:e}}finally{try{l&&!l.done&&(o=d.return)&&o.call(d)}finally{if(i)throw i.error}}return a},e}();!function(e){e.READ_ONLY="readonly",e.READ_WRITE="readwrite",e.VERSION_CHANGE="versionchange"}(k||(k={}));var M=function(e){function t(t,n){for(var r=this,i=t,o={cause:n};o.cause&&o.cause instanceof Error;)i=t+"\n\t→ "+n,o=o.cause;return(r=e.call(this,i)||this).cause=n,r.name=r.constructor.name,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(r,r.constructor):r.stack=(new Error).stack,Object.setPrototypeOf(r,r.constructor.prototype),r}return Object(b.__extends)(t,e),t}(Error),N={withDefaultMessage:function(e,t){return function(n){function r(r,i){var o=n.call(this,r||t||"",i)||this;return o.name=e,Object.setPrototypeOf(o,o.constructor.prototype),o}return Object(b.__extends)(r,n),r}(M)},withMessageCreator:function(e,t){return function(n){function r(r,i){var o=n.call(this,t(r),i)||this;return o.name=e,Object.setPrototypeOf(o,o.constructor.prototype),o}return Object(b.__extends)(r,n),r}(M)}},T=(N.withDefaultMessage("AssertionError","the asserted condition is invalid"),N.withMessageCreator("UnimplementedError",(function(e){return e?"called with arguments: "+JSON.stringify(e):"called with nothing"})));var R=function(e){0},A=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(b.__extends)(t,e),t.prototype.isQuotaExceeded=function(){return this.message.includes("QuotaExceededError")},t}(N.withMessageCreator("DatabaseConnectError",(function(e){return"failed to connect to database '"+e+"'."}))),P=N.withMessageCreator("CollectionNotFoundError",(function(e){return"model '"+e+"' is not registered, please register it before use it."})),L=N.withMessageCreator("DataMigrationError",(function(e){return"failed to perform data migration, versionChange: "+e.oldVersion+" -> "+e.newVersion+"."})),B=N.withMessageCreator("IncorrectTransactionModeError",(function(e){return"use error transaction type["+e+"]."})),U=N.withMessageCreator("NoTableInfoError",(function(e){return"'"+e+"' is not a valid model with table info injected, please ensure the model class is decorated by @table(), @field() etc."})),V=N.withDefaultMessage("EmptyTableInfoError","table without any field declare, please define model use [field] decorator."),F=N.withMessageCreator("InvalidWhereInValueError",(function(e){return"there is an error in your where clause of field '"+e.path+"'."+e.op+", the value must be an array."})),q=N.withMessageCreator("UnsupportedWhereOperatorError",(function(e){return"unsupported where operator '"+e+"', current supported operators are >, >=, <, <=, =, !=, in, nin."})),G=N.withDefaultMessage("OrderByKeyError","can not order value that is not Key: 'Key = number | string | Date | BufferSource | Key[]'."),H=N.withMessageCreator("DatabaseInternalError",(function(e){return"there is an internal error of database, reason: "+e+"."})),K=(N.withMessageCreator("QueryJobError",(function(e){return"failed to execute query job, reason: "+e+"."})),N.withMessageCreator("PluginError",(function(e){return'an error has occurred on plugin "'+e.name+'"": '+e.message+"."})),N.withDefaultMessage("TransactionCommitError","failed to commit transaction.")),W=N.withDefaultMessage("UpdateMigrationChangeInfoError","failed to update migration change info"),z=N.withMessageCreator("ExecuteDataUpgradeError",(function(e){return"failed to execute data upgrade on collection '"+e+"'."})),$=N.withMessageCreator("UnexpectedClosedError",(function(e){return"database "+e+" is unexpectedly closed by browser, this could happen when disk is unavailable or the page is shutdown."})),Y=Symbol.for("TABLE_KEY"),Q=function(){function e(){}return e.saveTableInfo=function(e,t){Object.defineProperty(t,Y,{configurable:!0,value:Object(b.__assign)({},e)})},e.getTableInfo=function(e){return e[Y]},e.getFirstTableInfoAlongPrototypeChain=function(e){var t=this.getTableInfo(e),n=Object.assign({},t);return n.properties=new Map(n.properties),n},e.getTableName=function(e){var t=this.getTableInfo(e.prototype);if(!(null==t?void 0:t.tableName))throw new U(e.name);return t.tableName},e.addTablePropertyInfo=function(t,n){var r=e.getOrCreateTableInfo(t);if(r.properties.has(n.name)){var i=r.properties.get(n.name);Object.assign(n,i)}r.properties.set(n.name,n),this.saveTableInfo(r,t)},e.createPropertyInfo=function(e,t){return{name:e,alias:t,isUnionKey:!1}},e.convertTableInfoToSchema=function(e){if(!e.tableName)return null;var t,n=Object(b.__spreadArray)([],Object(b.__read)(e.properties.values())),r=n.filter((function(e){return e.isIndex})).map((function(e){var t,n;return{name:null!==(t=e.alias)&&void 0!==t?t:e.name,path:null!==(n=e.alias)&&void 0!==n?n:e.name,unique:e.isUnique}}));return t=!e.autoIncrement&&e.keyPath?{path:1===e.keyPath.length?e.keyPath[0]:e.keyPath}:{generator:j.AutoIncrement},{properties:n.map((function(e){var t;return null!==(t=e.alias)&&void 0!==t?t:e.name})),indices:r,key:t,name:e.tableName}},e.createDefaultTableInfo=function(){return{tableName:null,autoIncrement:!0,properties:new Map}},e.getOrCreateTableInfo=function(t){if(Object.prototype.hasOwnProperty.call(t,Y))return t[Y];var n=e.createDefaultTableInfo(),r=t[Y];return r&&(n.properties=new Map(Object(b.__spreadArray)(Object(b.__spreadArray)([],Object(b.__read)(r.properties)),Object(b.__read)(n.properties)))),e.saveTableInfo(n,t),n},e}();var X=function(e){return function(t,n){var r=Q.createPropertyInfo(n,e);Q.addTablePropertyInfo(t,r)}};var J=function(e,t){return function(n){var r=Q.getFirstTableInfoAlongPrototypeChain(n.prototype);if(!r)throw new V;r.tableName=e;var i=Object(b.__spreadArray)([],Object(b.__read)(r.properties.values())),o=function(e,t){if(null==e?void 0:e.key)return"string"==typeof e.key?[e.key]:e.key;var n=t.filter((function(e){return e.isPrimaryKey})).map((function(e){var t;return null!==(t=e.alias)&&void 0!==t?t:e.name}));return n.length>0?n:void 0}(t,i);r.keyPath=o,r.autoIncrement=void 0===r.keyPath,Q.saveTableInfo(r,n.prototype)}};var Z=function(e){return function(t,n){var r=Q.createPropertyInfo(n);r.isIndex=!0,r.isUnique=!!(null==e?void 0:e.unique),Q.addTablePropertyInfo(t,r)}};var ee=function(){return function(e,t){var n=Q.createPropertyInfo(t);n.isPrimaryKey=!0,Q.addTablePropertyInfo(e,n)}};let te=()=>({events:{},emit(e,...t){(this.events[e]||[]).forEach((e=>e(...t)))},on(e,t){return(this.events[e]=this.events[e]||[]).push(t),()=>this.events[e]=(this.events[e]||[]).filter((e=>e!==t))}});var ne,re;!function(e){e.Ready="Ready",e.Fetal="Fetal",e.Closed="Closed",e.Destroyed="Destroyed",e.Error="Error",e.RegisterModel="RegisterModel",e.RegisterPlugin="RegisterPlugin",e.BootstrapStart="BootstrapStart",e.BootstrapEnd="BootstrapEnd",e.SchemaMigrationStart="SchemaMigrationStart",e.SchemaMigrationEnd="SchemaMigrationEnd",e.VersionChange="VersionChange"}(ne||(ne={})),function(e){e.CollectionCreated="CollectionCreated",e.ModelLazyMigrationEnd="ModelLazyMigrationEnd",e.PrepareAutoUpgradeEnd="PrepareAutoUpgradeEnd",e.UpdateMigrationChangeInfo="UpdateMigrationChangeInfoEnd",e.StartTransaction="StartTransaction"}(re||(re={}));var ie,oe=function(){function e(e){var t=this;this.onClosed=function(e){t.eventBus.on(ne.Closed,e)},this.eventBus=e}return e.prototype.onReady=function(e){this.eventBus.on(ne.Ready,e)},e.prototype.onFetal=function(e){this.eventBus.on(ne.Fetal,e)},e.prototype.onError=function(e){this.eventBus.on(ne.Error,e)},e.prototype.onRegisterModel=function(e){this.eventBus.on(ne.RegisterModel,e)},e.prototype.onRegisterPlugin=function(e){this.eventBus.on(ne.RegisterPlugin,e)},e.prototype.onBootstrapStart=function(e){this.eventBus.on(ne.BootstrapStart,e)},e.prototype.onBootstrapEnd=function(e){this.eventBus.on(ne.BootstrapEnd,e)},e.prototype.onSchemaMigrationStart=function(e){this.eventBus.on(ne.SchemaMigrationStart,e)},e.prototype.onSchemaMigrationEnd=function(e){this.eventBus.on(ne.SchemaMigrationEnd,e)},e.prototype.onVersionChange=function(e){this.eventBus.on(ne.VersionChange,e)},e.prototype.emitError=function(e){this.eventBus.emit(ne.Error,e)},e}(),ae=function(){function e(){}return e.revealSchema=function(e){var t=Q.getTableInfo(e.prototype);return t?Q.convertTableInfoToSchema(t):null},e}(),se=function(){function e(e){this.models=[],this.eventBus=e}return e.prototype.register=function(e){if(!this.models.includes(e)){var t=this.getSchema(e);this.models.push(e),this.eventBus.emit(ne.RegisterModel,{class:e,schema:t})}},e.prototype.getSchema=function(e){var t=ae.revealSchema(e);if(!t){var n=new U(e.name);throw this.eventBus.emit(ne.Error,n),new U(e.name)}return t},e.prototype.getSchemaAndRegisterModelIfNeed=function(e){return this.register(e),this.getSchema(e)},e}();function ce(e){var t,n,r,i=Q.getTableInfo(Object.getPrototypeOf(e));if(!i)return e;var o={};try{for(var a=Object(b.__values)(i.properties.values()),s=a.next();!s.done;s=a.next()){var c=s.value;o[null!==(r=c.alias)&&void 0!==r?r:c.name]=e[c.name]}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return o}function ue(e,t){var n,r;if(null==e)return null;var i=Q.getTableInfo(t.prototype);if(!i)return e;var o=function(e,t){var n,r,i,o={};try{for(var a=Object(b.__values)(t.properties.values()),s=a.next();!s.done;s=a.next()){var c=s.value,u=null!==(i=c.alias)&&void 0!==i?i:c.name;o[c.name]=e[u]}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o}(e,i),a=new t(o);try{for(var s=Object(b.__values)(Object.keys(o)),c=s.next();!c.done;c=s.next()){var u=c.value;void 0!==o[u]&&(a[u]=o[u])}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return a}!function(e){e.FILL="fill",e.HYDRATE="hydrate",e.PAGINATE="paginate",e.FILTER="filter",e.SORT="sort",e.SCAN="scan",e.SCAN_ALL="scan-all",e.INDEX_SCAN="index-scan",e.UNION="union",e.DISTINCT="distinct",e.INTERSECT="intersect"}(ie||(ie={}));var de=function(){function e(e,t){this.node=e,this.parent=t,this.context=Ce(e)}return e.prototype.perform=function(e){return Object(b.__awaiter)(this,void 0,void 0,(function(){var t,n,r,i,o;return Object(b.__generator)(this,(function(a){try{for(t=Object(b.__values)(this.node.inputs),n=t.next();!n.done;n=t.next())r=n.value,e.push(r)}catch(e){i={error:e}}finally{try{n&&!n.done&&(o=t.return)&&o.call(t)}finally{if(i)throw i.error}}return[2]}))}))},e}(),le=function(){function e(e){this.comparer=e}return e.prototype.has=function(e,t){return-1!==this.getOrder(e,t)},e.prototype.getOrder=function(e,t){for(var n=0,r=e.length;n<r;){var i=n+Math.floor((r-n)/2),o=e[i],a=this.comparer.cmp(t,o);if(0===a)return i;a>0?n=i+1:r=i}return-1},e}(),pe=function(){function e(e,t){this.node=e,this.parent=t,this.context=Ce(e)}return e.prototype.perform=function(e){return Object(b.__awaiter)(this,void 0,void 0,(function(){var t,n,r,i,o,a,s,c,u,d,l,p,h,f,v,y,_;return Object(b.__generator)(this,(function(m){t=new le(this.node.comparer);try{for(n=Object(b.__values)(this.context.inputs),r=n.next();!r.done;r=n.next()){i=r.value,o=new Map,a=i.map((function(e){return Object(b.__read)(e,1)[0]})).sort(this.node.comparer.cmp),s=[];try{for(y=void 0,c=Object(b.__values)(i),u=c.next();!u.done;u=c.next())d=u.value,l=Object(b.__read)(d,1),p=l[0],h=t.getOrder(a,p),o.has(h)||(o.set(h,!0),s.push(d))}catch(e){y={error:e}}finally{try{u&&!u.done&&(_=c.return)&&_.call(c)}finally{if(y)throw y.error}}e.push(s)}}catch(e){f={error:e}}finally{try{r&&!r.done&&(v=n.return)&&v.call(n)}finally{if(f)throw f.error}}return[2]}))}))},e}(),he=Symbol("-∞"),fe=Symbol("+∞"),ve=function(){function e(e){var t=this;this.contains=function(e,n){var r=t,i=r.cmp,o=r.lowerOf,a=r.upperOf;if(!t.isValid(e))return!1;var s=e.lowerOpen,c=e.upperOpen,u=i(o(e),n),d=i(a(e),n);return 0===u&&!s||u<0&&d>0||0===d&&!c},this.union=function(e){if(e.length<=1)return e;t.sort(e);for(var n=[],r=e[0],i=1;i<e.length;i++){var o=e[i];t.isOverlapped(r,o)?r=t.wrap(r,o):(n.push(r),r=o)}return n.push(r),n},this.intersect=function(e){var n,r;if(e.length<=1)return e;t.sort(e);var i=e[0];try{for(var o=Object(b.__values)(e),a=o.next();!a.done;a=o.next()){var s=a.value;if(!t.isOverlapped(i,s))return[];i=t.overlap(i,s)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return[i]},this.isValid=function(e){var n=t,r=n.cmp,i=n.lowerOf,o=n.upperOf,a=r(i(e),o(e));return a<0||0===a&&!e.lowerOpen&&!e.upperOpen},this.cmp=function(e,n){return e!==he&&e!==fe&&n!==he&&n!==fe?t.comparer.cmp(e,n):e===n?0:e===he||n===fe?-1:1},this.lowerOf=function(e){return void 0===e.lower?he:e.lower},this.upperOf=function(e){return void 0===e.upper?fe:e.upper},this.comparer=e}return e.prototype.isOverlapped=function(e,t){var n,r=this,i=r.cmp,o=r.lowerOf,a=r.upperOf,s=Object(b.__read)([e,t],2),c=s[0],u=s[1],d=i(o(c),o(u));(d>0||0===d&&!c.lowerOpen&&u.lowerOpen)&&(c=(n=Object(b.__read)([u,c],2))[0],u=n[1]);var l=i(a(c),o(u));return l>0||0===l&&!c.upperOpen&&!u.lowerOpen},e.prototype.sort=function(e){var t=this.cmp,n=this.lowerOf;return e.sort((function(e,r){var i=t(n(e),n(r));return 0!==i||e.lowerOpen===r.lowerOpen?i:e.lowerOpen?-1:1}))},e.prototype.wrap=function(e,t){var n=this,r=n.cmp,i=n.lowerOf,o=n.upperOf,a=Object(b.__assign)({},e),s=r(i(e),i(t)),c=r(o(e),o(t));return(s>0||0===s&&!t.lowerOpen)&&(a.lower=t.lower,a.lowerOpen=t.lowerOpen),(c<0||0===c&&!t.upperOpen)&&(a.upper=t.upper,a.upperOpen=t.upperOpen),a},e.prototype.overlap=function(e,t){var n=this,r=n.cmp,i=n.lowerOf,o=n.upperOf,a=Object(b.__assign)({},e),s=r(i(e),i(t)),c=r(o(e),o(t));return(s<0||0===s&&!e.lowerOpen)&&(a.lower=t.lower,a.lowerOpen=t.lowerOpen),(c>0||0===c&&!e.upperOpen)&&(a.upper=t.upper,a.upperOpen=t.upperOpen),a},e}(),ye=function(){function e(e,t){this.node=e,this.parent=t,this.context=Ce(e)}return e.prototype.perform=function(e){return Object(b.__awaiter)(this,void 0,void 0,(function(){var t,n,r,i,o,a,s,c,u;return Object(b.__generator)(this,(function(d){for(t=[],n=this.node,r=[t];n;)n.regroup&&(t=[],r.push(t)),t.push(this.createFilter(n)),n=n.nextFilter;i=function(e){var t=Object(b.__read)(e,2)[1];return r.some((function(e){return e.every((function(e){return e(t)}))}))};try{for(o=Object(b.__values)(this.context.inputs),a=o.next();!a.done;a=o.next())s=a.value,e.push(s.filter(i))}catch(e){c={error:e}}finally{try{a&&!a.done&&(u=o.return)&&u.call(o)}finally{if(c)throw c.error}}return[2]}))}))},e.prototype.createFilter=function(e){var t=new ve(e.comparer);return function(n){return e.intervals.some((function(r){if(void 0===n)throw new H("can not do filter on non-hydrated data");var i=C(n,e.path);return E(i)&&t.contains(r,i)}))}},e}();var be=function(){function e(e,t,n){this.node=e,this.parent=t,this.transaction=n,this.context=Ce(e)}return e.prototype.perform=function(e){return Object(b.__awaiter)(this,void 0,void 0,(function(){var t,n,r,i,o,a,s,c,u=this;return Object(b.__generator)(this,(function(d){switch(d.label){case 0:t=this.transaction.table(this.node.collectionSchema.name),n=function(n){var r;return Object(b.__generator)(this,(function(i){switch(i.label){case 0:return r=n.filter((function(e){return!function(e){return!!Object(b.__read)(e,2)[1]}(e)})),[4,Promise.all(r.map((function(e,n){var i=Object(b.__read)(e,1)[0];return Object(b.__awaiter)(u,void 0,void 0,(function(){var e;return Object(b.__generator)(this,(function(o){switch(o.label){case 0:return[4,t.get(i)];case 1:return e=o.sent(),r[n][1]=e,[2]}}))}))})))];case 1:return i.sent(),e.push(n),[2]}}))},d.label=1;case 1:d.trys.push([1,6,7,8]),r=Object(b.__values)(this.context.inputs),i=r.next(),d.label=2;case 2:return i.done?[3,5]:(o=i.value,[5,n(o)]);case 3:d.sent(),d.label=4;case 4:return i=r.next(),[3,2];case 5:return[3,8];case 6:return a=d.sent(),s={error:a},[3,8];case 7:try{i&&!i.done&&(c=r.return)&&c.call(r)}finally{if(s)throw s.error}return[7];case 8:return[2]}}))}))},e}(),_e=function(){function e(e,t,n,r){this.lower=e,this.upper=t,this.lowerOpen=n,this.upperOpen=r}return e.getKeyRange=function(e,t){if(void 0!==t){if(!e.isValid(t))throw new Error("invalid key interval");var n=t.lower,r=t.upper,i=t.lowerOpen,o=t.upperOpen;return n===r?n:void 0!==n&&void 0!==r?IDBKeyRange.bound(n,r,i,o):void 0!==n?IDBKeyRange.lowerBound(n,i):IDBKeyRange.upperBound(r,o)}},e}(),me=function(){function e(e,t){var n=this;this.comparer=t,this.math=new ve(t),this.intervals=e.filter((function(e){return n.math.isValid(e)}))}return e.fromWherePredicate=function(t,n){var r,i,o;try{for(var a=Object(b.__values)(Object.keys(t)),s=a.next();!s.done;s=a.next()){var c=s.value,u=t[c];if(void 0!==u){var d=e.fromWhereExp(c,u,n);o=o?o.intersect(d):d}}}catch(e){r={error:e}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return o||this.createFullGroup(n)},e.fromWhereExp=function(t,n,r){var i;if(t===_.In||t===_.NotIn){if(!Array.isArray(n))throw new F({op:t});var o=n;return t===_.In?o.reduce((function(t,n){return t.union(e.fromWhereExp(_.Equals,n,r))}),this.createEmptyGroup(r)):o.reduce((function(t,n,i){var o=e.fromWhereExp(_.NotEquals,n,r);return i?t.intersect(o):o}),this.createFullGroup(r))}switch(t){case _.Equals:i=[new _e(n,n,!1,!1)];break;case _.NotEquals:i=[new _e(void 0,n,!0,!0),new _e(n,void 0,!0,!0)];break;case _.GreaterThan:i=[new _e(n,void 0,!0,!0)];break;case _.GreaterOrEqualThan:i=[new _e(n,void 0,!1,!0)];break;case _.LessThan:i=[new _e(void 0,n,!0,!0)];break;case _.LessOrEqualThan:i=[new _e(void 0,n,!0,!1)];break;default:throw new q(t)}return new e(i,r)},e.prototype.union=function(t){return new e(this.math.union(Object(b.__spreadArray)(Object(b.__spreadArray)([],Object(b.__read)(this.intervals)),Object(b.__read)(t.intervals))),this.comparer)},e.prototype.intersect=function(t){for(var n=this.math,r=n.cmp,i=n.upperOf,o=n.lowerOf,a=n.intersect,s=Object(b.__read)([this.intervals,t.intervals],2),c=s[0],u=s[1],d=Object(b.__read)([0,0],2),l=d[0],p=d[1],h=[];l<c.length;){for(;p<u.length&&r(i(c[l]),o(u[p]))>=0;){var f=a([c[l],u[p]]);h.push.apply(h,Object(b.__spreadArray)([],Object(b.__read)(f))),p+=1}p-=1,l+=1}return new e(h,this.comparer)},e.prototype.contains=function(e){var t=this;return!!this.intervals.find((function(n){return t.math.contains(n,e)}))},e.prototype.isEmpty=function(){return 0===this.intervals.length},e.prototype.isFull=function(){return!!this.intervals.length&&void 0===this.intervals[0].lower&&void 0===this.intervals[0].upper},e.createFullGroup=function(t){return new e([new _e(void 0,void 0,!0,!0)],t)},e.createEmptyGroup=function(t){return new e([],t)},e}(),ge=_e,Oe=function(){function e(e,t,n){this.node=e,this.parent=t,this.transaction=n,this.context=Ce(e)}return e.prototype.perform=function(e){return Object(b.__awaiter)(this,void 0,void 0,(function(){var t,n,r,i,o;return Object(b.__generator)(this,(function(a){switch(a.label){case 0:return this.node.hydrate?[3,2]:[4,this.scanKeys()];case 1:return t=a.sent(),e.push(t.map((function(e){return[e,void 0]}))),[2];case 2:return(n=this.node.collectionSchema.key.path)?[4,this.scanValues()]:[3,4];case 3:return r=a.sent(),e.push(r.map((function(e){return[C(e,n),e]}))),[2];case 4:return[4,this.scanKeys()];case 5:return i=a.sent(),[4,this.scanValues()];case 6:return o=a.sent(),e.push(i.map((function(e,t){return[e,o[t]]}))),[2]}}))}))},e.prototype.scanKeys=function(){return Object(b.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(b.__generator)(this,(function(n){switch(n.label){case 0:return e=this.getKeyQueries(),t=this.getIndex(),[4,Promise.all(e.map((function(e){return t.getAllKeys(e)})))];case 1:return[2,n.sent().reduce((function(e,t){return e.push.apply(e,Object(b.__spreadArray)([],Object(b.__read)(t))),e}),[])]}}))}))},e.prototype.scanValues=function(){return Object(b.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(b.__generator)(this,(function(n){switch(n.label){case 0:return e=this.getKeyQueries(),t=this.getIndex(),[4,Promise.all(e.map((function(e){return t.getAll(e)})))];case 1:return[2,n.sent().reduce((function(e,t){return e.push.apply(e,Object(b.__spreadArray)([],Object(b.__read)(t))),e}),[])]}}))}))},e.prototype.getKeyQueries=function(){var e=new ve(this.node.comparer);return this.node.intervals.map((function(t){return ge.getKeyRange(e,t)}))},e.prototype.getIndex=function(){var e=this.node,t=e.collectionSchema,n=e.index;return this.transaction.table(t.name).index(n.name)},e}(),we=function(){function e(e,t){this.node=e,this.parent=t,this.context=Ce(e)}return e.prototype.perform=function(e){return Object(b.__awaiter)(this,void 0,void 0,(function(){var t,n,r,i,o,a,s,c,u,d,l,p,h;return Object(b.__generator)(this,(function(f){if(n=(t=this).context,r=t.node,!(i=n.inputs).length)return[2];if(1===i.length)return e.push(i[0]),[2];o=function(e,t){var n=Object(b.__read)(e,1)[0],i=Object(b.__read)(t,1)[0];return r.comparer.cmp(n,i)},a=new le({cmp:o}),s=this.getSmallestPointers(i).slice();try{for(c=Object(b.__values)(i),u=c.next();!u.done;u=c.next())u.value.sort(o)}catch(e){p={error:e}}finally{try{u&&!u.done&&(h=c.return)&&h.call(c)}finally{if(p)throw p.error}}return d=function(e){return i.every((function(t){return a.has(t,e)}))},l=s.filter(d),e.push(l),[2]}))}))},e.prototype.getSmallestPointers=function(e){return e.reduce((function(e,t){return e.length<t.length?e:t}),this.context.inputs[0])},e}(),je=function(){function e(e,t){this.node=e,this.parent=t,this.context=Ce(e)}return e.prototype.perform=function(e){return Object(b.__awaiter)(this,void 0,void 0,(function(){var t,n,r,i,o,a,s,c;return Object(b.__generator)(this,(function(u){t=this.node,n=t.offset,r=t.limit;try{for(i=Object(b.__values)(this.context.inputs),o=i.next();!o.done;o=i.next())a=o.value,e.push(a.slice(n,!r||isNaN(r)?void 0:n+r))}catch(e){s={error:e}}finally{try{o&&!o.done&&(c=i.return)&&c.call(i)}finally{if(s)throw s.error}}return[2]}))}))},e}(),xe=function(){function e(e,t,n){this.node=e,this.parent=t,this.transaction=n,this.context=Ce(e)}return e.prototype.perform=function(e){return Object(b.__awaiter)(this,void 0,void 0,(function(){var t,n,r,i,o;return Object(b.__generator)(this,(function(a){switch(a.label){case 0:return this.node.hydrate?[3,2]:[4,this.scanKeys()];case 1:return t=a.sent(),e.push(t.map((function(e){return[e,void 0]}))),[2];case 2:return(n=this.node.collectionSchema.key.path)?[4,this.scanValues()]:[3,4];case 3:return r=a.sent(),e.push(r.map((function(e){return[C(e,n),e]}))),[2];case 4:return[4,this.scanKeys()];case 5:return i=a.sent(),[4,this.scanValues()];case 6:return o=a.sent(),e.push(i.map((function(e,t){return[e,o[t]]}))),[2]}}))}))},e.prototype.scanKeys=function(){return Object(b.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(b.__generator)(this,(function(n){switch(n.label){case 0:return e=this.getKeyQueries(),t=this.getTable(),[4,Promise.all(e.map((function(e){return t.getAllKeys(e)})))];case 1:return[2,n.sent().reduce((function(e,t){return e.push.apply(e,Object(b.__spreadArray)([],Object(b.__read)(t))),e}),[])]}}))}))},e.prototype.scanValues=function(){return Object(b.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(b.__generator)(this,(function(n){switch(n.label){case 0:return e=this.getKeyQueries(),t=this.getTable(),[4,Promise.all(e.map((function(e){return t.getAll(e)})))];case 1:return[2,n.sent().reduce((function(e,t){return e.push.apply(e,Object(b.__spreadArray)([],Object(b.__read)(t))),e}),[])]}}))}))},e.prototype.getKeyQueries=function(){var e=new ve(this.node.comparer);return this.node.type===ie.SCAN_ALL?[void 0]:this.node.intervals.map((function(t){return ge.getKeyRange(e,t)}))},e.prototype.getTable=function(){var e=this.node.collectionSchema;return this.transaction.table(e.name)},e}(),Se=function(){function e(e,t){this.node=e,this.parent=t,this.context=Ce(e)}return e.prototype.perform=function(e){return Object(b.__awaiter)(this,void 0,void 0,(function(){var t,n,r,i,o,a,s,c,u,d=this;return Object(b.__generator)(this,(function(l){t=this.node,n=t.comparer,r=t.path,i=t.order;try{for(o=Object(b.__values)(this.context.inputs),a=o.next();!a.done;a=o.next())(s=a.value).sort((function(e,t){var o=Object(b.__read)(e,2)[1],a=Object(b.__read)(t,2)[1],s=C(o,r),c=C(a,r),u=d.getComparerByType(n,i);if(E(s)&&E(c))return u(s,c);throw new G})),e.push(s)}catch(e){c={error:e}}finally{try{a&&!a.done&&(u=o.return)&&u.call(o)}finally{if(c)throw c.error}}return[2]}))}))},e.prototype.getComparerByType=function(e,t){return t===w.ASCENDING?function(t,n){return e.cmp(t,n)}:function(t,n){return-e.cmp(t,n)}},e}(),Ee=function(){function e(e,t){this.node=e,this.parent=t,this.context=Ce(e)}return e.prototype.perform=function(e){return Object(b.__awaiter)(this,void 0,void 0,(function(){return Object(b.__generator)(this,(function(t){return e.push(this.context.inputs.reduce((function(e,t){return e.push.apply(e,Object(b.__spreadArray)([],Object(b.__read)(t))),e}),[])),[2]}))}))},e}();function Ce(e){return{total:e.children.length,done:0,inputs:[]}}var De=function(){function e(e,t){this.onRequestSuccess=function(){},this.onRequestFailed=function(){},this.request=e,this.transaction=t,this.jobs=new Map}return e.prototype.exec=function(){return Object(b.__awaiter)(this,void 0,void 0,(function(){var e=this;return Object(b.__generator)(this,(function(t){return this.task||(this.task=new Promise((function(t,n){e.onRequestSuccess=function(n){e.reset(),t(n)},e.onRequestFailed=function(t){return Object(b.__awaiter)(e,void 0,void 0,(function(){return Object(b.__generator)(this,(function(e){return this.reset(),n(t),[2]}))}))},e.traverse(e.request.root,(function(t,n){var r=function(e,t,n){var r;return(r={},r[ie.FILL]=function(){return new de(e,t)},r[ie.DISTINCT]=function(){return new pe(e,t)},r[ie.FILTER]=function(){return new ye(e,t)},r[ie.HYDRATE]=function(){return new be(e,t,n)},r[ie.INDEX_SCAN]=function(){return new Oe(e,t,n)},r[ie.INTERSECT]=function(){return new we(e,t)},r[ie.PAGINATE]=function(){return new je(e,t)},r[ie.SCAN]=function(){return new xe(e,t,n)},r[ie.SCAN_ALL]=function(){return new xe(e,t,n)},r[ie.SORT]=function(){return new Se(e,t)},r[ie.UNION]=function(){return new Ee(e,t)},r)[e.type]()}(t,n&&e.jobs.get(n)||null,e.transaction);e.jobs.set(t,r),t.children.length||e.beginJob(r).catch((function(t){e.onRequestFailed(t)}))}))}))),[2,this.task]}))}))},e.prototype.beginJob=function(e){var t;return Object(b.__awaiter)(this,void 0,void 0,(function(){var n,r,i=this;return Object(b.__generator)(this,(function(o){switch(o.label){case 0:n=(null===(t=e.parent)||void 0===t?void 0:t.context.inputs)||[],o.label=1;case 1:return o.trys.push([1,3,,4]),[4,e.perform(n)];case 2:return o.sent(),this.finishJob(e,n).catch((function(e){i.onRequestFailed(e)})),[3,4];case 3:return r=o.sent(),this.onRequestFailed(r),[3,4];case 4:return[2]}}))}))},e.prototype.finishJob=function(e,t){return Object(b.__awaiter)(this,void 0,void 0,(function(){var n,r=this;return Object(b.__generator)(this,(function(i){return e.parent&&((n=e.parent.context).done+=1,n.done===n.total&&this.beginJob(e.parent).catch((function(e){r.onRequestFailed(e)}))),e.node===this.request.root&&this.onRequestSuccess(t),[2]}))}))},e.prototype.reset=function(){this.jobs=new Map,this.task=void 0,this.onRequestSuccess=function(){},this.onRequestFailed=function(){}},e.prototype.traverse=function(e,t,n){var r,i;t(e,n);try{for(var o=Object(b.__values)(e.children),a=o.next();!a.done;a=o.next()){var s=a.value;this.traverse(s,t,e)}}catch(e){r={error:e}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}},e}(),ke=function(){function e(e){this.comparer=e}return e.prototype.rewrite=function(e){return{offset:e.offset,limit:e.limit,order:e.order&&Object(b.__assign)({},e.order),exp:this.rewriteWhereClauses(e.whereClauses)}},e.prototype.rewriteWhereClauses=function(e){var t,n,r,i,o;if(!e.length)return{type:g.ALL};var a={type:g.OR,exps:[]};try{for(var s=Object(b.__values)(e),c=s.next();!c.done;c=s.next()){var u=c.value,d={type:g.AND,exps:[]};try{for(var l=(r=void 0,Object(b.__values)(Object.entries(u))),p=l.next();!p.done;p=l.next()){var h=Object(b.__read)(p.value,2),f=h[0],v=h[1];if(void 0!==v){var y=E(v)?((o={})[_.Equals]=v,o):v;this.isEmptyPredicate(y)||d.exps.push({type:g.FILTER,predicate:y,path:f,hints:{intervalGroup:me.fromWherePredicate(y,this.comparer),isKey:!1,indices:[]}})}}}catch(e){r={error:e}}finally{try{p&&!p.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}a.exps.push(d)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return a},e.prototype.isEmptyPredicate=function(e){return Object.values(e).every((function(e){return void 0===e}))},e}(),Ie=function(){function e(e){this.schema=e,this.indicesMap=new Map,this.warmupIndicesMap()}return e.prototype.bind=function(e){return this.bindQueryHints(e.exp),e},e.prototype.bindQueryHints=function(e){var t,n=this,r=e;r.type!==g.AND&&r.type!==g.OR?r.type===g.FILTER&&(r.hints.isKey=this.schema.key&&D(this.schema.key.path,r.path),r.hints.indices=null!==(t=this.indicesMap.get(r.path))&&void 0!==t?t:[]):r.exps.forEach((function(e){return n.bindQueryHints(e)}))},e.prototype.warmupIndicesMap=function(){var e,t,n,r,i;try{for(var o=Object(b.__values)(this.schema.indices.entries()),a=o.next();!a.done;a=o.next()){var s=Object(b.__read)(a.value,2),c=s[0],u=s[1];u.priority=null!==(i=u.priority)&&void 0!==i?i:-(c+1);var d=Array.isArray(u.path)?u.path:[u.path];try{for(var l=(n=void 0,Object(b.__values)(d)),p=l.next();!p.done;p=l.next()){var h=p.value,f=this.indicesMap.get(h)||[];f.push(u),this.indicesMap.set(h,f)}}catch(e){n={error:e}}finally{try{p&&!p.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},e}(),Me=function(){function e(e,t){this.collectionSchema=e,this.comparer=t}return e.prototype.plan=function(e,t){return{root:this.getRootNode(e,t),aggregate:t}},e.prototype.getRootNode=function(e,t){if(e.exp.type===g.NONE)return this.getSkipNode();var n=this.getBaseNode(e.exp);return(t===O.ENTRIES||t===O.VALUES||e.order)&&(n=this.getHydrateNode([n])),e.order&&(n=this.getSortNode(e.order.path,e.order.type,[n])),(e.offset||e.limit!==S)&&(n=this.getPaginateNode(e.offset,e.limit,[n])),n=this.getDistinctNode([n])},e.prototype.getBaseNode=function(e){return e.type===g.ALL?this.getScanAllNode():e.type===g.NONE?this.getSkipNode():e.type===g.FILTER?this.getFilterNode(e):this.getLogicExpNode(e)},e.prototype.getLogicExpNode=function(e){var t,n,r=[];try{for(var i=Object(b.__values)(e.exps),o=i.next();!o.done;o=i.next()){var a=o.value;r.push(a.type===g.FILTER?this.getFilterNode(a):this.getLogicExpNode(a))}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return e.type===g.AND?this.getIntersectNode(r):this.getUnionNode(r)},e.prototype.getFilterNode=function(e){if(!e.path||e.hints.isKey)return this.getScanNode(e.hints.intervalGroup.intervals);var t=e.hints.indices.find((function(t){return D(t.path,e.path)}));return t?this.getIndexScanNode(e.hints.intervalGroup.intervals,t):this.getMemFilterNode(e.hints.intervalGroup.intervals,e.path)},e.prototype.getIntersectNode=function(e){return{type:ie.INTERSECT,comparer:this.comparer,children:e}},e.prototype.getDistinctNode=function(e){return void 0===e&&(e=[]),{type:ie.DISTINCT,comparer:this.comparer,children:e}},e.prototype.getUnionNode=function(e){return void 0===e&&(e=[]),{type:ie.UNION,children:e}},e.prototype.getHydrateNode=function(e){return void 0===e&&(e=[]),{type:ie.HYDRATE,collectionSchema:this.collectionSchema,children:e}},e.prototype.getPaginateNode=function(e,t,n){return void 0===n&&(n=[]),{type:ie.PAGINATE,offset:e,limit:t,children:n}},e.prototype.getSortNode=function(e,t,n){return void 0===n&&(n=[]),{type:ie.SORT,path:e,order:t,comparer:this.comparer,children:n}},e.prototype.getMemFilterNode=function(e,t,n){return{type:ie.FILTER,comparer:this.comparer,path:t,intervals:e,regroup:!1,children:[{type:ie.HYDRATE,collectionSchema:this.collectionSchema,children:n||[this.getScanAllNode()]}]}},e.prototype.getIndexScanNode=function(e,t){return{type:ie.INDEX_SCAN,collectionSchema:this.collectionSchema,index:t,intervals:e,comparer:this.comparer,children:[]}},e.prototype.getScanNode=function(e){return{type:ie.SCAN,collectionSchema:this.collectionSchema,intervals:e,comparer:this.comparer,children:[]}},e.prototype.getScanAllNode=function(){return{type:ie.SCAN_ALL,collectionSchema:this.collectionSchema,comparer:this.comparer,children:[]}},e.prototype.getSkipNode=function(){return{type:ie.FILL,inputs:[[]],children:[]}},e}(),Ne=function(){function e(){}return e.prototype.eliminate=function(e){var t=e;return t.exp=this.eliminateExp(e.exp),t},e.prototype.eliminateExp=function(e){return e.type===g.AND?this.eliminateAndExp(e):e.type===g.OR?this.eliminateOrExp(e):e.type===g.FILTER?this.eliminateFilterExp(e):e},e.prototype.eliminateAndExp=function(e){var t,n,r={type:g.AND,exps:[]};try{for(var i=Object(b.__values)(e.exps),o=i.next();!o.done;o=i.next()){var a=o.value,s=this.eliminateExp(a);if(s.type===g.NONE)return{type:g.NONE};s.type!==g.ALL&&r.exps.push(s)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r.exps.length?1===r.exps.length?r.exps[0]:r:{type:g.ALL}},e.prototype.eliminateOrExp=function(e){var t,n,r={type:g.OR,exps:[]};try{for(var i=Object(b.__values)(e.exps),o=i.next();!o.done;o=i.next()){var a=o.value,s=this.eliminateExp(a);if(s.type===g.ALL)return{type:g.ALL};s.type!==g.NONE&&r.exps.push(s)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r.exps.length?1===r.exps.length?e.exps[0]:r:{type:g.NONE}},e.prototype.eliminateFilterExp=function(e){return e.hints.intervalGroup.isEmpty()?{type:g.NONE}:e.hints.intervalGroup.isFull()?{type:g.ALL}:e},e}();var Te=function(){var e,t=!1;return function(n,r){if("function"!=typeof n[r])throw new Error("memo() must be decorated on one of function properties of target");Object.defineProperty(n,r,Object(b.__assign)(Object(b.__assign)({},Object.getOwnPropertyDescriptor(n,r)),{value:function(){return t||(e=n[r](),t=!0),e}}))}},Re=ie.UNION,Ae=ie.INTERSECT,Pe=ie.HYDRATE,Le=ie.INDEX_SCAN,Be=ie.SCAN,Ue=ie.SCAN_ALL,Ve=ie.FILTER;function Fe(e){return qe(e.root),e}function qe(e){var t,n,r=e.children;try{for(var i=Object(b.__values)(r.entries()),o=i.next();!o.done;o=i.next()){var a=Object(b.__read)(o.value,2),s=a[0],c=a[1];if(qe(c),[Ae,Re].includes(c.type)&&1===c.children.length){var u=c.children[0];r[s]=u}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}function Ge(e){return He(e.root),e}function He(e){var t,n,r,i,o=e.children;try{for(var a=Object(b.__values)(o.entries()),s=a.next();!s.done;s=a.next()){var c=Object(b.__read)(s.value,2),u=c[0],d=c[1];if(He(d),d.type===Pe){var l=!1;try{for(var p=(r=void 0,Object(b.__values)(d.children)),h=p.next();!h.done;h=p.next()){(f=h.value).type!==Be&&f.type!==Le&&f.type!==Ue||(l=!0,f.hydrate=!0)}}catch(e){r={error:e}}finally{try{h&&!h.done&&(i=p.return)&&i.call(p)}finally{if(r)throw r.error}}if(l&&1===d.children.length){var f=d.children[0];o[u]=f}}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}}function Ke(e){return e}function We(e){return ze(e.root),e}function ze(e){var t,n;$e(e.children,(function(r){if(ze(r),r.type!==Ve||!r.children.some((function(e){return e.type===Ue})))return!0;if(n){var i=r;!function(e,t){var n=e;for(;e.nextFilter;)n=e.nextFilter;n.nextFilter=t}(n,i),i.regroup=e.type===Re}else t=r;return n=r,!1})),t&&e.children.push(t)}function $e(e,t){for(var n=e,r=0,i=n.length-1;r<=i;){var o=n[r];t(o)?r+=1:(n[r]=n[i],n[i]=o,i-=1)}return n.splice(i+1)}function Ye(e){return Qe(e.root),e}function Qe(e){var t,n,r=e.children;try{for(var i=Object(b.__values)(r.entries()),o=i.next();!o.done;o=i.next()){var a=Object(b.__read)(o.value,2),s=a[0],c=a[1];if(Qe(c),c.type===Ae){var u=c.children.find((function(e){var t=e.type;return[Be,Le].includes(t)}));if(u){var d=$e(c.children,(function(e){return e.type!==Ve}));if(d.length){var l={type:Pe,collectionSchema:u.collectionSchema,children:[]};r[s]=tt.apply(void 0,Object(b.__spreadArray)(Object(b.__spreadArray)([],Object(b.__read)(d)),[l,c]))}}}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}function Xe(e){return[O.COUNT,O.KEYS].includes(e.aggregate)||et((function(e){e.type!==Be&&e.type!==Le||(e.hydrate=!0)}),e.root),e}function Je(e){return et((function(e){var t,n,r,i,o;if(e.type===Ae){var a=Number.MIN_SAFE_INTEGER;try{for(var s=Object(b.__values)(e.children),c=s.next();!c.done;c=s.next()){var u=c.value,d=Number.MIN_SAFE_INTEGER;u.type===Be&&(d=0),u.type===Le&&u.index.priority&&(d=u.index.priority),a=Math.max(a,d)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}var l=e.children;try{for(var p=Object(b.__values)(l.entries()),h=p.next();!h.done;h=p.next()){var f=Object(b.__read)(h.value,2),v=f[0];if((u=f[1]).type===Le)(d=null!==(o=u.index.priority)&&void 0!==o?o:Number.MIN_SAFE_INTEGER)<a&&(l[v]=Ze(u))}}catch(e){r={error:e}}finally{try{h&&!h.done&&(i=p.return)&&i.call(p)}finally{if(r)throw r.error}}}}),e.root),e}function Ze(e){return{path:e.index.path,intervals:e.intervals,comparer:e.comparer,type:ie.FILTER,regroup:!1,children:[{type:ie.SCAN_ALL,collectionSchema:e.collectionSchema,comparer:e.comparer,hydrate:!0,children:[]}]}}function et(e,t,n,r){var i,o;void 0===n&&(n=null),void 0===r&&(r=-1);var a=t.children;try{for(var s=Object(b.__values)(a.entries()),c=s.next();!c.done;c=s.next()){var u=Object(b.__read)(c.value,2),d=u[0];et(e,u[1],t,d)}}catch(e){i={error:e}}finally{try{c&&!c.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}e(t,n,r)}function tt(){for(var e,t,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i=Object(b.__read)(n),o=i[0],a=i.slice(1),s=o;try{for(var c=Object(b.__values)(a),u=c.next();!u.done;u=c.next()){var d=u.value;s.children=[d],s=d}}catch(t){e={error:t}}finally{try{u&&!u.done&&(t=c.return)&&t.call(c)}finally{if(e)throw e.error}}return o}var nt,rt=function(){function e(){}return e.prototype.optimize=function(e){var t=[Je,Ge,We,Fe,Ye,Ke,Fe,Ge,Xe];return this.applyAllRules(t,e)},e.prototype.applyAllRules=function(e,t){return e.reduce((function(e,t){return t(e)}),t)},e}(),it=function(){function e(e){void 0===e&&(e=new Map),this.query={offset:0,limit:void 0,order:void 0,whereClauses:[]},this.aliasMap=e}return e.fromRawQuery=function(t,n){var r,i;void 0===n&&(n=new Map);var o=new e(n),a=t.offset,s=t.limit,c=t.order,u=t.whereClauses;o.setOffset(a),o.setLimit(s),c&&o.setOrderBy(c.path,c.type);try{for(var d=Object(b.__values)(u),l=d.next();!l.done;l=d.next()){var p=l.value;o.addWhereClause(p)}}catch(e){r={error:e}}finally{try{l&&!l.done&&(i=d.return)&&i.call(d)}finally{if(r)throw r.error}}return o},e.prototype.setOffset=function(e){this.query.offset=e},e.prototype.setLimit=function(e){this.query.limit=e},e.prototype.setRange=function(e,t){void 0===e&&(e=0),this.query.offset=e,this.query.limit=t!==S?Math.max(0,t-e):S},e.prototype.setOrderBy=function(e,t){this.query.order={path:e,type:t||w.ASCENDING}},e.prototype.addWhereClause=function(e){var t,n,r;if(this.isValidWhereClause(e)){var i={};try{for(var o=Object(b.__values)(Object.entries(e)),a=o.next();!a.done;a=o.next()){var s=Object(b.__read)(a.value,2),c=s[0],u=s[1];if(void 0!==u)i[null!==(r=this.aliasMap.get(c))&&void 0!==r?r:c]=u}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}this.query.whereClauses.push(i)}},e.prototype.clone=function(t){return void 0===t&&(t=this.aliasMap),e.fromRawQuery(this.query,t)},e.prototype.build=function(){return this.query},e.prototype.isValidWhereClause=function(e){return!!e&&Object.keys(e).length>=0},e}();!function(e){e.DISABLED="disabled",e.ALL="all"}(nt||(nt={}));var ot,at=function(){function e(e,t){this.collectionName=e,this.context=t.context}return e.toggleOptimization=function(t){e.optimization=t?nt.ALL:nt.DISABLED},e.getOptimizationMode=function(){return e.optimization},e.prototype.exec=function(e,t){return Object(b.__awaiter)(this,void 0,void 0,(function(){var n,r,i,o,a,s,c,u;return Object(b.__generator)(this,(function(d){switch(d.label){case 0:return[4,this.context.getTransaction([this.collectionName],k.READ_ONLY)];case 1:return n=d.sent(),[4,this.getModel()];case 2:return r=d.sent(),i=this.getAliasMap(r.class),o=it.fromRawQuery(e,i).build(),(a=n.table(this.collectionName)).supports("query")&&o.whereClauses.length<=1?t!==O.VALUES?[3,4]:[4,a.query(o,t)]:[3,7];case 3:return[2,d.sent().map((function(e){var t;return null!==(t=ue(e,r.class))&&void 0!==t?t:void 0}))];case 4:return t!==O.ENTRIES?[3,6]:[4,a.query(o,t)];case 5:return[2,d.sent().map((function(e){var t,n=Object(b.__read)(e,2);return[n[0],null!==(t=ue(n[1],r.class))&&void 0!==t?t:void 0]}))];case 6:return[2,a.query(o,t)];case 7:return[4,this.getQueryPlan(o,t)];case 8:return s=d.sent(),[4,new De(s,n).exec()];case 9:return c=b.__read.apply(void 0,[d.sent(),1]),u=c[0],t===O.COUNT?[2,u.length]:t===O.KEYS?[2,u.map((function(e){return Object(b.__read)(e,1)[0]}))]:t===O.VALUES?[2,u.map((function(e){var t;return null!==(t=ue(Object(b.__read)(e,2)[1],r.class))&&void 0!==t?t:void 0}))]:[2,u.map((function(e){var t,n=Object(b.__read)(e,2);return[n[0],null!==(t=ue(n[1],r.class))&&void 0!==t?t:void 0]}))]}}))}))},e.prototype.conditions=function(e){return this.getRewriter().rewrite(e)},e.prototype.explain=function(e,t){return Object(b.__awaiter)(this,void 0,void 0,(function(){return Object(b.__generator)(this,(function(n){switch(n.label){case 0:return[4,this.getQueryPlan(e,t)];case 1:return[2,n.sent()]}}))}))},e.prototype.getQueryPlan=function(t,n){return Object(b.__awaiter)(this,void 0,void 0,(function(){var r,i,o,a,s,c,u;return Object(b.__generator)(this,(function(d){switch(d.label){case 0:return[4,this.getRewriter()];case 1:return r=d.sent(),[4,this.getEliminator()];case 2:return i=d.sent(),[4,this.getPlanner()];case 3:return o=d.sent(),[4,this.getBinder()];case 4:return a=d.sent(),[4,this.getOptimizer()];case 5:return s=d.sent(),c=r.rewrite(t),c=a.bind(c),c=i.eliminate(c),u=o.plan(c,n),[2,e.optimization===nt.DISABLED?u:s.optimize(u)]}}))}))},e.prototype.getAliasMap=function(e){var t,n,r=new Map,i=Q.getTableInfo(e.prototype);if(!i)return r;try{for(var o=Object(b.__values)(i.properties.values()),a=o.next();!a.done;a=o.next()){var s=a.value;s.alias&&r.set(s.name,s.alias)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r},e.prototype.getModel=function(){return Object(b.__awaiter)(this,void 0,void 0,(function(){return Object(b.__generator)(this,(function(e){return[2,this.context.waitForModelRegistered(this.collectionName)]}))}))},e.prototype.getPlanner=function(){return Object(b.__awaiter)(this,void 0,void 0,(function(){var e;return Object(b.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.getModel()];case 1:return e=t.sent(),[2,new Me(e.schema,this.context.comparer)]}}))}))},e.prototype.getRewriter=function(){return new ke(this.context.comparer)},e.prototype.getEliminator=function(){return new Ne},e.prototype.getBinder=function(){return Object(b.__awaiter)(this,void 0,void 0,(function(){var e;return Object(b.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.getModel()];case 1:return e=t.sent(),[2,new Ie(e.schema)]}}))}))},e.prototype.getOptimizer=function(){return new rt},e.optimization=nt.ALL,Object(b.__decorate)([Te()],e.prototype,"getModel",null),Object(b.__decorate)([Te()],e.prototype,"getPlanner",null),Object(b.__decorate)([Te()],e.prototype,"getRewriter",null),Object(b.__decorate)([Te()],e.prototype,"getEliminator",null),Object(b.__decorate)([Te()],e.prototype,"getBinder",null),Object(b.__decorate)([Te()],e.prototype,"getOptimizer",null),e}(),st=function(){function e(e,t){this.name=e,this.options=t,this.contextGenerator=t.contextGenerator,this.queryBuilder=new it,this.patch()}return e.toggleOptimization=function(e){return at.toggleOptimization(e)},e.prototype.skip=function(e){return this.queryBuilder.setOffset(e),this},e.prototype.take=function(e){return this.queryBuilder.setLimit(e),this},e.prototype.slice=function(e,t){return this.queryBuilder.setRange(e,t),this},e.prototype.orderBy=function(e,t){return this.queryBuilder.setOrderBy(e,t),this},e.prototype.where=function(e){return this.queryBuilder.addWhereClause(e),this},e.prototype.or=function(e){return this.queryBuilder.addWhereClause(e),this},e.prototype.conditions=function(){var e=this.contextGenerator.spawnContext();return new at(this.name,{context:e}).conditions(this.queryBuilder.build())},e.prototype.clone=function(){var t=new e(this.name,this.options);return t.queryBuilder=this.queryBuilder.clone(),t},e.prototype.explain=function(e){return Object(b.__awaiter)(this,void 0,void 0,(function(){var t;return Object(b.__generator)(this,(function(n){return t=this.contextGenerator.spawnContext(),[2,new at(this.name,{context:t}).explain(this.queryBuilder.build(),e)]}))}))},e.prototype.count=function(){return Object(b.__awaiter)(this,void 0,void 0,(function(){var e,t=this;return Object(b.__generator)(this,(function(n){return[2,(e=this.contextGenerator.spawnContext()).perform((function(){return Object(b.__awaiter)(t,void 0,void 0,(function(){return Object(b.__generator)(this,(function(t){return[2,new at(this.name,{context:e}).exec(this.queryBuilder.build(),O.COUNT)]}))}))}))]}))}))},e.prototype.entries=function(){return Object(b.__awaiter)(this,void 0,void 0,(function(){var e,t=this;return Object(b.__generator)(this,(function(n){return[2,(e=this.contextGenerator.spawnContext()).perform((function(){return Object(b.__awaiter)(t,void 0,void 0,(function(){return Object(b.__generator)(this,(function(t){return[2,new at(this.name,{context:e}).exec(this.queryBuilder.build(),O.ENTRIES)]}))}))}))]}))}))},e.prototype.keys=function(){return Object(b.__awaiter)(this,void 0,void 0,(function(){var e,t=this;return Object(b.__generator)(this,(function(n){return[2,(e=this.contextGenerator.spawnContext()).perform((function(){return Object(b.__awaiter)(t,void 0,void 0,(function(){return Object(b.__generator)(this,(function(t){return[2,new at(this.name,{context:e}).exec(this.queryBuilder.build(),O.KEYS)]}))}))}))]}))}))},e.prototype.values=function(){return Object(b.__awaiter)(this,void 0,void 0,(function(){var e,t=this;return Object(b.__generator)(this,(function(n){return[2,(e=this.contextGenerator.spawnContext()).perform((function(){return Object(b.__awaiter)(t,void 0,void 0,(function(){return Object(b.__generator)(this,(function(t){return[2,new at(this.name,{context:e}).exec(this.queryBuilder.build(),O.VALUES)]}))}))}))]}))}))},e.prototype.first=function(){return Object(b.__awaiter)(this,void 0,void 0,(function(){var e,t=this;return Object(b.__generator)(this,(function(n){return[2,(e=this.contextGenerator.spawnContext()).perform((function(){return Object(b.__awaiter)(t,void 0,void 0,(function(){var t,n;return Object(b.__generator)(this,(function(r){switch(r.label){case 0:return[4,new at(this.name,{context:e}).exec(this.queryBuilder.build(),O.VALUES)];case 1:return t=r.sent(),[2,null!==(n=t[0])&&void 0!==n?n:null]}}))}))}))]}))}))},e.prototype.last=function(){return Object(b.__awaiter)(this,void 0,void 0,(function(){var e,t=this;return Object(b.__generator)(this,(function(n){return[2,(e=this.contextGenerator.spawnContext()).perform((function(){return Object(b.__awaiter)(t,void 0,void 0,(function(){var t,n;return Object(b.__generator)(this,(function(r){switch(r.label){case 0:return[4,new at(this.name,{context:e}).exec(this.queryBuilder.build(),O.VALUES)];case 1:return t=r.sent(),[2,null!==(n=t[t.length-1])&&void 0!==n?n:null]}}))}))}))]}))}))},e.prototype.update=function(e){return Object(b.__awaiter)(this,void 0,void 0,(function(){var t,n,r=this;return Object(b.__generator)(this,(function(i){switch(i.label){case 0:return[4,this.entries()];case 1:return t=i.sent(),[2,(n=this.contextGenerator.spawnContext()).perform((function(){return Object(b.__awaiter)(r,void 0,void 0,(function(){var r,i,o,a,s,c,u,d,l,p,h,f,v;return Object(b.__generator)(this,(function(y){switch(y.label){case 0:return r=[],[4,n.getTransaction([this.name],k.READ_WRITE)];case 1:i=y.sent(),o=i.table(this.name),y.label=2;case 2:y.trys.push([2,8,9,10]),a=Object(b.__values)(t),s=a.next(),y.label=3;case 3:return s.done?[3,7]:(c=Object(b.__read)(s.value,2),u=c[0],d=c[1],[4,o.openCursor(u)]);case 4:return(l=y.sent())?(p=e(d),[4,l.update(ce(p))]):[3,6];case 5:y.sent(),r.push(u),y.label=6;case 6:return s=a.next(),[3,3];case 7:return[3,10];case 8:return h=y.sent(),f={error:h},[3,10];case 9:try{s&&!s.done&&(v=a.return)&&v.call(a)}finally{if(f)throw f.error}return[7];case 10:return[2,r]}}))}))}))]}}))}))},e.prototype.clear=function(){return Object(b.__awaiter)(this,void 0,void 0,(function(){var e,t,n=this;return Object(b.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.keys()];case 1:return e=r.sent(),[2,(t=this.contextGenerator.spawnContext()).perform((function(){return Object(b.__awaiter)(n,void 0,void 0,(function(){var n,r,i,o,a,s,c,u,d,l;return Object(b.__generator)(this,(function(p){switch(p.label){case 0:return n=[],[4,t.getTransaction([this.name],k.READ_WRITE)];case 1:return r=p.sent(),(i=r.table(this.name)).supports("bulkDelete")?[4,i.bulkDelete(e)]:[3,3];case 2:return p.sent(),[2,e];case 3:p.trys.push([3,9,10,11]),o=Object(b.__values)(e),a=o.next(),p.label=4;case 4:return a.done?[3,8]:(s=a.value,[4,i.openCursor(s)]);case 5:return(c=p.sent())?[4,c.delete()]:[3,7];case 6:p.sent(),n.push(s),p.label=7;case 7:return a=o.next(),[3,4];case 8:return[3,11];case 9:return u=p.sent(),d={error:u},[3,11];case 10:try{a&&!a.done&&(l=o.return)&&l.call(o)}finally{if(d)throw d.error}return[7];case 11:return[2,n]}}))}))}))]}}))}))},e.prototype.patch=function(){var e=this.options.aspects;e.update.patch(this,"update"),e.clear.patch(this,"clear"),e.count.patch(this,"count"),e.entries.patch(this,"entries"),e.keys.patch(this,"keys"),e.values.patch(this,"values"),e.first.patch(this,"first"),e.last.patch(this,"last"),e.skip.patch(this,"skip"),e.take.patch(this,"take"),e.slice.patch(this,"slice"),e.orderBy.patch(this,"orderBy"),e.where.patch(this,"where"),e.or.patch(this,"or")},e}(),ct=function(){function e(e,t){this.name=e,this.aspects=t.aspects,this.contextGenerator=t.contextGenerator,this.unsliced=new st(e,t),this.patch()}return e.prototype.skip=function(e){return this.unsliced.clone().skip(e)},e.prototype.take=function(e){return this.unsliced.clone().take(e)},e.prototype.slice=function(e,t){return this.unsliced.clone().slice(e,t)},e.prototype.orderBy=function(e,t){return this.unsliced.clone().orderBy(e,t)},e.prototype.where=function(e){return this.unsliced.clone().where(e)},e.prototype.or=function(e){return this.unsliced.clone().or(e)},e.prototype.update=function(e){return this.unsliced.update(e)},e.prototype.clear=function(){return this.unsliced.clear()},e.prototype.count=function(){return this.unsliced.count()},e.prototype.entries=function(){return this.unsliced.entries()},e.prototype.keys=function(){return this.unsliced.keys()},e.prototype.values=function(){return this.unsliced.values()},e.prototype.first=function(){return this.unsliced.first()},e.prototype.last=function(){return this.unsliced.last()},e.prototype.get=function(e){return Object(b.__awaiter)(this,void 0,void 0,(function(){var t,n=this;return Object(b.__generator)(this,(function(r){return[2,(t=this.contextGenerator.spawnContext()).perform((function(){return Object(b.__awaiter)(n,void 0,void 0,(function(){var n,r,i;return Object(b.__generator)(this,(function(o){switch(o.label){case 0:return[4,t.getTransaction([this.name],k.READ_ONLY)];case 1:return n=o.sent(),[4,t.waitForModelRegistered(this.name)];case 2:return r=o.sent(),[4,n.table(this.name).get(e)];case 3:return[2,(i=o.sent())?ue(i,r.class):null]}}))}))}))]}))}))},e.prototype.has=function(e){return Object(b.__awaiter)(this,void 0,void 0,(function(){var t,n=this;return Object(b.__generator)(this,(function(r){return[2,(t=this.contextGenerator.spawnContext()).perform((function(){return Object(b.__awaiter)(n,void 0,void 0,(function(){var n;return Object(b.__generator)(this,(function(r){switch(r.label){case 0:return[4,t.getTransaction([this.name],k.READ_ONLY)];case 1:return n=r.sent(),[4,n.table(this.name).openCursor(e)];case 2:return[2,!!r.sent()]}}))}))}))]}))}))},e.prototype.delete=function(e){return Object(b.__awaiter)(this,void 0,void 0,(function(){var t,n=this;return Object(b.__generator)(this,(function(r){return[2,(t=this.contextGenerator.spawnContext()).perform((function(){return Object(b.__awaiter)(n,void 0,void 0,(function(){var n,r,i;return Object(b.__generator)(this,(function(o){switch(o.label){case 0:return[4,t.getTransaction([this.name],k.READ_WRITE)];case 1:return n=o.sent(),[4,(r=n.table(this.name)).openCursor(e)];case 2:return i=o.sent(),[4,r.delete(e)];case 3:return o.sent(),[2,i?e:null]}}))}))}))]}))}))},e.prototype.insert=function(e){return Object(b.__awaiter)(this,void 0,void 0,(function(){var t,n=this;return Object(b.__generator)(this,(function(r){return[2,(t=this.contextGenerator.spawnContext()).perform((function(){return Object(b.__awaiter)(n,void 0,void 0,(function(){var n;return Object(b.__generator)(this,(function(r){switch(r.label){case 0:return[4,t.getTransaction([this.name],k.READ_WRITE)];case 1:return n=r.sent(),[4,n.table(this.name).insert(ce(e))];case 2:return[2,r.sent()]}}))}))}))]}))}))},e.prototype.upsert=function(e){return Object(b.__awaiter)(this,void 0,void 0,(function(){var t,n=this;return Object(b.__generator)(this,(function(r){return[2,(t=this.contextGenerator.spawnContext()).perform((function(){return Object(b.__awaiter)(n,void 0,void 0,(function(){var n;return Object(b.__generator)(this,(function(r){switch(r.label){case 0:return[4,t.getTransaction([this.name],k.READ_WRITE)];case 1:return n=r.sent(),[4,n.table(this.name).upsert(ce(e))];case 2:return[2,r.sent()]}}))}))}))]}))}))},e.prototype.bulkInsert=function(e){return Object(b.__awaiter)(this,void 0,void 0,(function(){var t,n=this;return Object(b.__generator)(this,(function(r){return[2,(t=this.contextGenerator.spawnContext()).perform((function(){return Object(b.__awaiter)(n,void 0,void 0,(function(){var n,r,i,o,a,s,c,u,d,l;return Object(b.__generator)(this,(function(p){switch(p.label){case 0:return[4,t.getTransaction([this.name],k.READ_WRITE)];case 1:n=p.sent(),r=[],i=n.table(this.name),p.label=2;case 2:p.trys.push([2,7,8,9]),o=Object(b.__values)(e),a=o.next(),p.label=3;case 3:return a.done?[3,6]:(s=a.value,[4,i.insert(ce(s))]);case 4:c=p.sent(),r.push(c),p.label=5;case 5:return a=o.next(),[3,3];case 6:return[3,9];case 7:return u=p.sent(),d={error:u},[3,9];case 8:try{a&&!a.done&&(l=o.return)&&l.call(o)}finally{if(d)throw d.error}return[7];case 9:return[2,r]}}))}))}))]}))}))},e.prototype.bulkUpsert=function(e){return Object(b.__awaiter)(this,void 0,void 0,(function(){var t,n=this;return Object(b.__generator)(this,(function(r){return[2,(t=this.contextGenerator.spawnContext()).perform((function(){return Object(b.__awaiter)(n,void 0,void 0,(function(){var n;return Object(b.__generator)(this,(function(r){switch(r.label){case 0:return[4,t.getTransaction([this.name],k.READ_WRITE)];case 1:return n=r.sent(),[2,n.table(this.name).bulkUpsert(e.map((function(e){return ce(e)})))]}}))}))}))]}))}))},e.prototype.conditions=function(){return this.unsliced.conditions()},e.prototype.patch=function(){this.aspects.get.patch(this,"get"),this.aspects.has.patch(this,"has"),this.aspects.delete.patch(this,"delete"),this.aspects.insert.patch(this,"insert"),this.aspects.upsert.patch(this,"upsert"),this.aspects.bulkInsert.patch(this,"bulkInsert"),this.aspects.bulkUpsert.patch(this,"bulkUpsert")},e}(),ut=function(){function e(e,t){this.collectionMap=new Map,this.storage=e,this.eventBus=t}return e.prototype.getCollection=function(e,t){if(this.collectionMap.has(e))return this.collectionMap.get(e);var n=this.createCollection(e,t);return this.collectionMap.set(e,n),this.eventBus.emit(re.CollectionCreated,{collectionName:e,context:t.spawnContext()}),n},e.prototype.createCollection=function(e,t){var n=this.storage.aspects.collection;return new ct(e,{contextGenerator:t,aspects:n})},e}(),dt=N.withMessageCreator("UnexpectedModifierError",(function(e){return'unexpected error occurred at the "'+e+'" stage of the plugable function, there may be a bug in your modifiers.'})),lt=N.withMessageCreator("InvalidPatchedFunctionError",(function(e){return'patched target is not a function, patched key is "'+e+'"'}));!function(e){e.before="before",e.around="around",e.return="return",e.throw="throw",e.after="after",e.protect="protect"}(ot||(ot={}));var pt=function(){function e(e){this.modifiers={before:[],around:[],return:[],throw:[],after:[],protect:[]},this.createContext=e}return e.prototype.before=function(e){return this.modifiers.before.push(e),this},e.prototype.around=function(e){return this.modifiers.around.push(e),this},e.prototype.throw=function(e){return this.modifiers.throw.push(e),this},e.prototype.return=function(e){return this.modifiers.return.push(e),this},e.prototype.after=function(e){return this.modifiers.after.push(e),this},e.prototype.protect=function(e){return this.modifiers.protect.push(e),this},e.prototype.patch=function(e,t){Object.defineProperty(e,t,{enumerable:!1,value:this.compile(e,t),writable:!0,configurable:!0})},e.prototype.dirty=function(){return Object.values(this.modifiers).some((function(e){return e.length}))},e.prototype.compile=function(e,t){var n=e[t];if("function"!=typeof n)throw new lt(t);var r=this.invoke.bind(this);return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r(n,this,e)}},e}(),ht=pt,ft=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(b.__extends)(t,e),t.create=function(){return new t((function(){return{}}))},t.withContext=function(e){return new t(e)},t.prototype.invoke=function(e,t,n){var r;if(!this.dirty())return e.call.apply(e,Object(b.__spreadArray)([t],Object(b.__read)(n)));var i=Object.assign(this.createContext(),{args:n,this:t,callee:e,return:void 0,error:void 0});try{this.trigger(ot.before,i,this.modifiers.protect),this.modifiers.around.length?this.trigger(ot.around,i,this.modifiers.protect):i.return=(r=i.callee).call.apply(r,Object(b.__spreadArray)([i.this],Object(b.__read)(i.args))),this.trigger(ot.return,i,this.modifiers.protect)}catch(e){throw this.modifiers.throw.length&&(Object.assign(i,{error:e}),this.trigger(ot.throw,i,this.modifiers.protect)),e}finally{this.trigger(ot.after,i,this.modifiers.protect)}return i.return},t.prototype.trigger=function(e,t,n){var r,i,o,a;try{for(var s=Object(b.__values)(this.modifiers[e]),c=s.next();!c.done;c=s.next()){var u=c.value;try{u.call(t.this,t)}catch(r){if(!n.length){R(new dt(e,r));continue}try{for(var d=(o=void 0,Object(b.__values)(n)),l=d.next();!l.done;l=d.next()){var p=l.value;Object.assign(t,{error:r}),p.call(t.this,t)}}catch(e){o={error:e}}finally{try{l&&!l.done&&(a=d.return)&&a.call(d)}finally{if(o)throw o.error}}}}}catch(e){r={error:e}}finally{try{c&&!c.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}},t}(ht),vt=ft,yt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(b.__extends)(t,e),t.create=function(){return new t((function(){return{}}))},t.withContext=function(e){return new t(e)},t.prototype.invoke=function(e,t,n){var r=this;if(!this.dirty())return e.call.apply(e,Object(b.__spreadArray)([t],Object(b.__read)(n)));var i=Object.assign(this.createContext(),{args:n,this:t,callee:e,return:void 0,error:void 0});return new Promise((function(e,t){Object(b.__awaiter)(r,void 0,void 0,(function(){var e,t,n,r;return Object(b.__generator)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,7,10,12]),[4,this.trigger(ot.before,i,this.modifiers.protect)];case 1:return o.sent(),this.modifiers.around.length?[3,3]:(e=(r=i.callee).call.apply(r,Object(b.__spreadArray)([i.this],Object(b.__read)(i.args))),t=i,[4,e]);case 2:return t.return=o.sent(),[3,5];case 3:return[4,this.trigger(ot.around,i,this.modifiers.protect)];case 4:o.sent(),o.label=5;case 5:return[4,this.trigger(ot.return,i,this.modifiers.protect)];case 6:return o.sent(),[3,12];case 7:return n=o.sent(),Object.assign(i,{error:n}),this.modifiers.throw.length?[4,this.trigger(ot.throw,i,this.modifiers.protect)]:[3,9];case 8:o.sent(),o.label=9;case 9:throw n;case 10:return[4,this.trigger(ot.after,i,this.modifiers.protect)];case 11:return o.sent(),[7];case 12:return[2]}}))})).then((function(){e(i.return)})).catch((function(e){t(e)}))}))},t.prototype.trigger=function(e,t,n){return Object(b.__awaiter)(this,void 0,void 0,(function(){var r,i,o,a,s,c,u,d,l,p,h,f,v;return Object(b.__generator)(this,(function(y){switch(y.label){case 0:y.trys.push([0,15,16,17]),r=Object(b.__values)(this.modifiers[e]),i=r.next(),y.label=1;case 1:if(i.done)return[3,14];o=i.value,y.label=2;case 2:return y.trys.push([2,4,,13]),[4,o.call(t.this,t)];case 3:return y.sent(),[3,13];case 4:if(a=y.sent(),!n.length)return R(new dt(e,a)),[3,13];y.label=5;case 5:y.trys.push([5,10,11,12]),f=void 0,s=Object(b.__values)(n),c=s.next(),y.label=6;case 6:return c.done?[3,9]:(u=c.value,Object.assign(t,{error:a}),[4,u.call(t.this,t)]);case 7:y.sent(),y.label=8;case 8:return c=s.next(),[3,6];case 9:return[3,12];case 10:return d=y.sent(),f={error:d},[3,12];case 11:try{c&&!c.done&&(v=s.return)&&v.call(s)}finally{if(f)throw f.error}return[7];case 12:return[3,13];case 13:return i=r.next(),[3,1];case 14:return[3,17];case 15:return l=y.sent(),p={error:l},[3,17];case 16:try{i&&!i.done&&(h=r.return)&&h.call(r)}finally{if(p)throw p.error}return[7];case 17:return[2]}}))}))},t}(ht),bt=yt;function _t(){return{timings:new Map,counters:new Map,messages:new Map,errors:new Map,flags:new Map,data:new Map}}var mt,gt=function(){function e(e,t){this.storage=e,this.eventBus=t,this.plugins=[]}return e.prototype.add=function(){for(var e,t,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];try{for(var i=Object(b.__values)(n),o=i.next();!o.done;o=i.next()){var a=o.value;this.plugins.push(a),a.register(this.storage),this.eventBus.emit(ne.RegisterPlugin,a)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},e}(),Ot=gt,wt=N.withMessageCreator("UnexpectedOutsideMigrationActionError",(function(e){return e+" outside ensure(callback) is not allowed, please wrap your migration actions inside a ensure callback"})),jt=function(){function e(e,t){this.name=e,this.context=t}return e.create=function(t){return{index:function(n){return new e(n,t)}}},e.prototype.create=function(e){var t=this.context.scope.collection;if(!t)throw new wt("CreateIndex");return this.context.actions.schema.push({type:r.CreateIndex,name:this.name,attributes:Object(b.__assign)({},e),collection:t}),this},e.prototype.drop=function(){var e=this.context.scope.collection;if(!e)throw new wt("DropIndex");this.context.actions.schema.push({type:r.DropIndex,name:this.name,collection:e})},e.prototype.alter=function(e){var t=this.context.scope.collection;if(!t)throw new wt("AlterIndex");return this.context.actions.schema.push({type:r.DropIndex,name:this.name,collection:t},{type:r.CreateIndex,name:this.name,attributes:Object(b.__assign)({},e),collection:t}),this},e.prototype.rename=function(e){var t=this.context.scope.collection;if(!t)throw new wt("RenameIndex");this.context.actions.schema.push({type:r.DropIndex,name:this.name,collection:t},{type:r.CreateIndex,name:e,attributes:{path:""},collection:t})},e.prototype.ensure=function(){throw new T},e}(),xt=function(){function e(e,t){this.name=e,this.context=t}return e.create=function(t){return{collection:function(n){return new e(n,t)}}},e.prototype.create=function(e){return this.context.actions.schema.push({type:r.CreateCollection,name:this.name,attributes:Object(b.__assign)({},e)}),this},e.prototype.drop=function(){this.context.actions.schema.push({type:r.DropCollection,name:this.name})},e.prototype.alter=function(e){return this.context.actions.schema.push({type:r.DropCollection,name:this.name},{type:r.CreateCollection,name:this.name,attributes:Object(b.__assign)({},e)}),this},e.prototype.rename=function(e){this.context.actions.schema.push({type:r.DropCollection,name:this.name},{type:r.CreateCollection,name:e,attributes:{key:{generator:j.AutoIncrement},properties:[]}})},e.prototype.ensure=function(e){var t=this.context,n=Object(b.__assign)({},jt.create(t));this.context.scope.collection=this.name,e(n),this.context.scope.collection=null},e}(),St=function(){function e(){this.context={actions:{schema:[],data:[]},scope:{database:null,collection:null}},this.builder=xt.create(this.context)}return e.prototype.init=function(e){this.state=e,this.build()},e.prototype.plan=function(){return this.context.actions.schema.length||this.context.actions.data.length?[{schema:{actions:this.context.actions.schema.slice()},data:{actions:this.context.actions.data.slice()}}]:[]},e.prototype.handleDropCollection=function(e){var t,n;try{for(var r=Object(b.__values)(e),i=r.next();!i.done;i=r.next()){var o=i.value;this.builder.collection(o.name).drop()}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},e.prototype.handleCreateCollection=function(e){var t,n,r=function(e){i.builder.collection(e.name).create(e).ensure((function(t){var n,r;try{for(var i=(n=void 0,Object(b.__values)(e.indices)),o=i.next();!o.done;o=i.next()){var a=o.value;t.index(a.name).create(a)}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}))},i=this;try{for(var o=Object(b.__values)(e),a=o.next();!a.done;a=o.next()){r(a.value)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}},e.prototype.handleIndexChange=function(e){var t,n,r=function(e){i.builder.collection(e.collection).ensure((function(t){var n,r,i,o,a,s;try{for(var c=(n=void 0,Object(b.__values)((null===(a=e.index)||void 0===a?void 0:a.added)||[])),u=c.next();!u.done;u=c.next()){var d=u.value;t.index(d.name).create(d)}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}try{for(var l=(i=void 0,Object(b.__values)((null===(s=e.index)||void 0===s?void 0:s.deleted)||[])),p=l.next();!p.done;p=l.next()){d=p.value;t.index(d.name).drop()}}catch(e){i={error:e}}finally{try{p&&!p.done&&(o=l.return)&&o.call(l)}finally{if(i)throw i.error}}}))},i=this;try{for(var o=Object(b.__values)(e),a=o.next();!a.done;a=o.next()){r(a.value)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}},e.prototype.build=function(){if(!this.state)throw new Error("Migration state is undefined, must init before!");var e=this.state.schema,t=e.expect,n=e.actual,r=I.databaseDiff(n,t);this.handleCreateCollection(r.added),this.handleDropCollection(r.deleted),this.handleIndexChange(r.different)},e}(),Et=m.name;!function(e){e.SYSTEM_TABLE="system_table",e.SCAN_EXISTING_TABLE="scan_exists_table"}(mt||(mt={}));var Ct=function(){function e(){}return e.hasSystemTable=function(e){return e.tableNames.includes(Et)},e.getDatabaseSchema=function(t,n,r){return Object(b.__awaiter)(this,void 0,void 0,(function(){var i,o,a,s,c;return Object(b.__generator)(this,(function(u){switch(u.label){case 0:return[4,n.openDB(t,{name:t,collections:[m]})];case 1:i=u.sent(),o=!1,u.label=2;case 2:return u.trys.push([2,,10,11]),i.tableNames.length?[3,4]:(i.close(),o=!0,[4,n.deleteDB(t)]);case 3:return u.sent(),[2,{schema:{name:this.name,version:0,collections:[]},from:"scan_exists_table"}];case 4:return this.hasSystemTable(i)?[3,6]:[4,e.getDatabaseSchemaByScanningTableStructure(r.collections.map((function(e){return e.name})),i)];case 5:return[2,{schema:u.sent(),from:"scan_exists_table"}];case 6:return[4,i.transaction([Et],k.READ_ONLY)];case 7:return a=u.sent(),[4,a.table(Et).getAll()];case 8:return s=u.sent()||[],c={name:this.name,version:i.version,collections:Object(b.__spreadArray)(Object(b.__spreadArray)([],Object(b.__read)(s)),[this.getSystemTableSchema()])},[4,a.commit()];case 9:return u.sent(),[2,{schema:c,from:"system_table"}];case 10:return o||i.close(),[7];case 11:return[2]}}))}))},e.getSystemTableSchema=function(){return m},e.updateSchemaChange=function(e,t,n,r){return Object(b.__awaiter)(this,void 0,void 0,(function(){var i,o,a,s,c,u,d,l,p,h,f,v,y,_,m,g,O,w,j,x,S,E,C;return Object(b.__generator)(this,(function(D){switch(D.label){case 0:return i=t.table(Et),r?[4,i.bulkUpsert(n.schema.expect.collections.filter((function(e){return e.name!==Et})))]:[3,2];case 1:return D.sent(),[2];case 2:D.trys.push([2,27,,29]),o=I.databaseDiff(n.schema.actual,n.schema.expect),a=o.added.filter((function(e){return e.name!==Et})),D.label=3;case 3:D.trys.push([3,8,9,10]),s=Object(b.__values)(a),c=s.next(),D.label=4;case 4:return c.done?[3,7]:((p=c.value).dataVersion=e,[4,i.upsert(p)]);case 5:D.sent(),D.label=6;case 6:return c=s.next(),[3,4];case 7:return[3,10];case 8:return u=D.sent(),w={error:u},[3,10];case 9:try{c&&!c.done&&(j=s.return)&&j.call(s)}finally{if(w)throw w.error}return[7];case 10:D.trys.push([10,15,16,17]),d=Object(b.__values)(o.deleted),l=d.next(),D.label=11;case 11:return l.done?[3,14]:(p=l.value,[4,i.delete(p.name)]);case 12:D.sent(),D.label=13;case 13:return l=d.next(),[3,11];case 14:return[3,17];case 15:return h=D.sent(),x={error:h},[3,17];case 16:try{l&&!l.done&&(S=d.return)&&S.call(d)}finally{if(x)throw x.error}return[7];case 17:f=o.different.filter((function(e){return!!e.index})),v=function(e){var t,n,r;return Object(b.__generator)(this,(function(o){switch(o.label){case 0:return[4,i.get(e.collection)];case 1:return t=o.sent(),n=[],r=t.indices.filter((function(t){return!e.index.deleted.some((function(e){return e.name===t.name}))})),n.push.apply(n,Object(b.__spreadArray)([],Object(b.__read)(e.index.added))),n.push.apply(n,Object(b.__spreadArray)([],Object(b.__read)(r))),t.index=n,[4,i.upsert(t)];case 2:return o.sent(),[2]}}))},D.label=18;case 18:D.trys.push([18,23,24,25]),y=Object(b.__values)(f),_=y.next(),D.label=19;case 19:return _.done?[3,22]:(m=_.value,[5,v(m)]);case 20:D.sent(),D.label=21;case 21:return _=y.next(),[3,19];case 22:return[3,25];case 23:return g=D.sent(),E={error:g},[3,25];case 24:try{_&&!_.done&&(C=y.return)&&C.call(y)}finally{if(E)throw E.error}return[7];case 25:return[4,t.commit()];case 26:if(!D.sent())throw new K;return[3,29];case 27:return O=D.sent(),[4,t.rollback()];case 28:throw D.sent(),O;case 29:return[2]}}))}))},e.updateCollectionDataVersion=function(e,t,n){return Object(b.__awaiter)(this,void 0,void 0,(function(){var r,i,o;return Object(b.__generator)(this,(function(a){switch(a.label){case 0:return[4,(r=t.table(Et)).get(Q.getTableName(n))];case 1:if(i=a.sent(),o=Q.getTableInfo(n.prototype),!i)throw new Error("get target table system info error!");if(!o)throw new U(n.name);return i.dataVersion=e,i.properties=Object(b.__spreadArray)([],Object(b.__read)(o.properties.values())).map((function(e){return e.name})),[4,r.upsert(i)];case 2:return a.sent(),[2]}}))}))},e.getTableDataVersion=function(e,t){return Object(b.__awaiter)(this,void 0,void 0,(function(){return Object(b.__generator)(this,(function(n){switch(n.label){case 0:return[4,t.table(Et).get(e)];case 1:return[2,n.sent().dataVersion]}}))}))},e.getDatabaseSchemaByScanningTableStructure=function(e,t){return Object(b.__awaiter)(this,void 0,void 0,(function(){var n,r,i,o,a,s,c,u,d,l,p,h,f,v,y,_;return Object(b.__generator)(this,(function(m){switch(m.label){case 0:n=t.tableNames.filter((function(t){return e.includes(t)})),r=[],m.label=1;case 1:m.trys.push([1,6,7,8]),i=Object(b.__values)(n),o=i.next(),m.label=2;case 2:return o.done?[3,5]:(a=o.value,[4,t.table(a,k.READ_ONLY)]);case 3:s=m.sent(),c={name:a,key:s.autoIncrement?{generator:j.AutoIncrement}:{path:s.keyPath},indices:[],properties:[]};try{for(y=void 0,u=Object(b.__values)(s.indexNames),d=u.next();!d.done;d=u.next())l=d.value,p=s.index(l),c.indices.push({name:l,path:p.keyPath,unique:p.unique})}catch(e){y={error:e}}finally{try{d&&!d.done&&(_=u.return)&&_.call(u)}finally{if(y)throw y.error}}r.push(c),m.label=4;case 4:return o=i.next(),[3,2];case 5:return[3,8];case 6:return h=m.sent(),f={error:h},[3,8];case 7:try{o&&!o.done&&(v=i.return)&&v.call(i)}finally{if(f)throw f.error}return[7];case 8:return[2,{name:t.name,version:t.version,collections:r}]}}))}))},e}(),Dt=function(){function e(e){this.schemaActionHandlerMap=new Map,this.dataActionHandlerMap=new Map,this.schemaActionHandlerMap.set(r.CreateCollection,this.performCreateCollectionAction.bind(this)),this.schemaActionHandlerMap.set(r.DropCollection,this.performDropCollectionAction.bind(this)),this.schemaActionHandlerMap.set(r.CreateIndex,this.performCreateIndexAction.bind(this)),this.schemaActionHandlerMap.set(r.DropIndex,this.performDropIndexAction.bind(this)),this.dataActionHandlerMap.set(i.DropProperty,this.performDropPropertyAction.bind(this)),this.dataActionHandlerMap.set(i.ClearData,this.performClearDataAction.bind(this)),this.dataActionHandlerMap.set(i.ReplaceData,this.performReplaceDataAction.bind(this)),e.executeDataAction.patch(this,"executeDataAction"),e.executeSchemaAction.patch(this,"executeSchemaAction")}return e.prototype.executeSchemaAction=function(e,t,n){var r=this.schemaActionHandlerMap.get(n.type);if(r){if(t.mode!==k.VERSION_CHANGE)throw new B(n.type);return r(e,t,n)}},e.prototype.executeDataAction=function(e,t,n){return Object(b.__awaiter)(this,void 0,void 0,(function(){var r;return Object(b.__generator)(this,(function(i){return(r=this.dataActionHandlerMap.get(n.type))?[2,r(e,t,n)]:[2]}))}))},e.prototype.performCreateIndexAction=function(e,t,n){t.table(n.collection).createIndex(n.name,n.attributes.path,{unique:n.attributes.unique})},e.prototype.performDropIndexAction=function(e,t,n){t.table(n.collection).deleteIndex(n.name)},e.prototype.performDropCollectionAction=function(e,t,n){e.deleteTable(n.name)},e.prototype.performCreateCollectionAction=function(e,t,n){var r,i;e.createTable(n.name,{keyPath:null===(r=n.attributes.key)||void 0===r?void 0:r.path,autoIncrement:(null===(i=n.attributes.key)||void 0===i?void 0:i.generator)===j.AutoIncrement})},e.prototype.performClearDataAction=function(e,t,n){return Object(b.__awaiter)(this,void 0,void 0,(function(){var e,r;return Object(b.__generator)(this,(function(i){switch(i.label){case 0:return e=t.table(n.collection),n.filter?[3,2]:[4,e.clear()];case 1:return i.sent(),[2];case 2:return[4,e.openCursor()];case 3:r=i.sent(),i.label=4;case 4:return r?n.filter(r.value())?[4,r.delete()]:[3,6]:[3,8];case 5:i.sent(),i.label=6;case 6:return[4,r.next()];case 7:return r=i.sent(),[3,4];case 8:return[2]}}))}))},e.prototype.performDropPropertyAction=function(e,t,n){return Object(b.__awaiter)(this,void 0,void 0,(function(){var e,r;return Object(b.__generator)(this,(function(i){switch(i.label){case 0:return[4,t.table(n.collection).openCursor()];case 1:e=i.sent(),i.label=2;case 2:return e?((r=e.value())[n.path]=void 0,[4,e.update(r)]):[3,5];case 3:return i.sent(),[4,e.next()];case 4:return e=i.sent(),[3,2];case 5:return[2]}}))}))},e.prototype.performReplaceDataAction=function(e,t,n){var r;return Object(b.__awaiter)(this,void 0,void 0,(function(){var e,i;return Object(b.__generator)(this,(function(o){switch(o.label){case 0:return[4,t.table(n.collection).openCursor()];case 1:e=o.sent(),o.label=2;case 2:return e?(i=e.value(),n.filter&&!(null===(r=n.filter)||void 0===r?void 0:r.call(this,i))?[3,4]:[4,e.update(n.replacer(i))]):[3,6];case 3:o.sent(),o.label=4;case 4:return[4,e.next()];case 5:return e=o.sent(),[3,2];case 6:return[2]}}))}))},e}(),kt=function(){function e(e){this.collection=e,this.versionActionsMap=new Map}return e.prototype.getVersionActionsMap=function(){return this.versionActionsMap},e.prototype.version=function(e){var t=this,n={update:function(r){return t.pushAction(e,{type:i.ReplaceData,replacer:r,collection:t.collection}),n},delete:function(r){return t.pushAction(e,{filter:r,type:i.ClearData,collection:t.collection}),n}};return n},e.prototype.pushAction=function(e,t){var n=this.versionActionsMap.get(e)||[];n.push(t),this.versionActionsMap.set(e,n)},e}(),It=function(){function e(e,t,n){this.expectedSchema=e,this.actualSchema=t,this.modelClass=n}return e.prototype.plan=function(){var e=this.actualSchema.dataVersion||0,t=this.expectedSchema.dataVersion||1;if(e===t)return[];var n=[],r=this.getManualMigrationActions(e,t);n.push.apply(n,Object(b.__spreadArray)([],Object(b.__read)(r)));var i=this.getAutoMigrationActions();return n.push.apply(n,Object(b.__spreadArray)([],Object(b.__read)(i))),[{schema:{actions:[]},data:{actions:n}}]},e.prototype.getManualMigrationActions=function(e,t){var n,r,i=new kt(Q.getTableName(this.modelClass));return null===(r=(n=this.modelClass).onDataUpgrade)||void 0===r||r.call(n,e,t,i),this.getRangeDataAction(e,t,i.getVersionActionsMap())},e.prototype.getAutoMigrationActions=function(){var e,t,n=this,r=[],o=this.actualSchema.properties.filter((function(e){return!n.expectedSchema.properties.includes(e)}));try{for(var a=Object(b.__values)(o),s=a.next();!s.done;s=a.next()){var c=s.value;r.push({type:i.DropProperty,collection:Q.getTableName(this.modelClass),path:c})}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return r},e.prototype.getRangeDataAction=function(e,t,n){for(var r=[],i=e;i<=t;i++)r.push.apply(r,Object(b.__spreadArray)([],Object(b.__read)(n.get(i)||[])));return r},e}(),Mt=function(){function e(e){this.migrationManager=e,this.upgradedFlag=new Map}return e.prototype.executeDataUpgrade=function(e,t,n,r){return void 0===r&&(r=function(){}),Object(b.__awaiter)(this,void 0,void 0,(function(){var i,o;return Object(b.__generator)(this,(function(a){switch(a.label){case 0:return i=Q.getTableName(e),this.upgradedFlag.get(i)?[2]:(o=this.getCollectionSchema(i,n),this.isNeedExecuteDataUpgrade(o.expect,o.actual)?[4,this.executeUpgrade(i,t,n,o.expect,o.actual,e)]:(this.upgradedFlag.set(i,!0),[2,r()]));case 1:return a.sent(),this.upgradedFlag.set(i,!0),[2,r()]}}))}))},e.prototype.isNeedExecuteDataUpgrade=function(e,t){return!(!(null==t?void 0:t.dataVersion)||e.dataVersion===t.dataVersion)},e.prototype.executeUpgrade=function(e,t,n,r,i,o){return Object(b.__awaiter)(this,void 0,void 0,(function(){var a,s,c,u,d,l;return Object(b.__generator)(this,(function(p){switch(p.label){case 0:return a=new It(r,i,o),this.migrationManager.use(a),s=this.migrationManager.buildMigration(n),[4,t.transaction([e,Ct.getSystemTableSchema().name],k.READ_WRITE)];case 1:c=p.sent(),u=!1,p.label=2;case 2:return p.trys.push([2,6,8,11]),d=n.schema.expect.version||1,[4,Ct.getTableDataVersion(Q.getTableName(o),c)];case 3:return p.sent()===d?[2]:[4,this.migrationManager.executeDataMigration(t,s,c)];case 4:return p.sent(),[4,Ct.updateCollectionDataVersion(d,c,o)];case 5:return p.sent(),[3,11];case 6:return l=p.sent(),u=!0,[4,c.rollback()];case 7:throw p.sent(),new L({oldVersion:i.dataVersion,newVersion:r.dataVersion},l);case 8:return u?[3,10]:[4,c.commit()];case 9:p.sent(),p.label=10;case 10:return[7];case 11:return[2]}}))}))},e.prototype.getCollectionSchema=function(e,t){var n=t.schema,r=n.expect,i=n.actual,o=r.collections.filter((function(t){return t.name===e})),a=i.collections.filter((function(t){return t.name===e}));if(1!==o.length)throw new P(e);return{expect:o[0],actual:a.length?a[0]:void 0}},e}(),Nt=function(){function e(e,t,n){var r=this;this.planner=new St,this.actualDBSchema=null,this.actualDBSchemaFrom=null,this.lazyMigrationProcessor=new Mt(this),this.handleCollectionCreated=function(e){var t=e.collectionName,n=e.context;r.safeExecuteDataUpgrade(n,t)},this.handleStartTransaction=function(e){var t,n,i=e.collectionNames,o=e.context;try{for(var a=Object(b.__values)(i),s=a.next();!s.done;s=a.next()){var c=s.value;r.safeExecuteDataUpgrade(o,c)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},this.eventBus=e,this.eventBus.on(re.CollectionCreated,this.handleCollectionCreated),this.eventBus.on(re.StartTransaction,this.handleStartTransaction),this.schemaProvider=t,this.actionExecutor=new Dt(n.actionExecutor),this.applyAspectPatch(n)}return e.prototype.use=function(e){this.planner=e},e.prototype.prepareAutoUpgradeHandler=function(e,t){return Object(b.__awaiter)(this,void 0,void 0,(function(){var n,r,i,o,a,s=this;return Object(b.__generator)(this,(function(c){switch(c.label){case 0:return n=this.schemaProvider.getDatabaseSchema(),[4,Ct.getDatabaseSchema(e,t,n)];case 1:return r=c.sent(),i=r.schema,o=r.from,this.actualDBSchema=i,this.actualDBSchemaFrom=o,this.log("getDatabaseSchema",this.actualDBSchema),a=this.buildMigration({schema:{expect:n,actual:this.actualDBSchema}}),[2,function(e,t,n,r){s.eventBus.emit(ne.SchemaMigrationStart),s.executeSchemaMigration(e,a,r),s.updateMigrationChangeInfo(r).catch((function(e){s.emitError(new W(e))})),s.eventBus.emit(ne.SchemaMigrationEnd)}]}}))}))},e.prototype.buildMigration=function(e){var t,n,r,i,o,a,s=e.schema,c=s.actual,u=s.expect;null===(n=null===(t=this.planner)||void 0===t?void 0:t.init)||void 0===n||n.call(t,e);var d=null!==(r=c.version)&&void 0!==r?r:0,l=null!==(i=u.version)&&void 0!==i?i:1;return null!==(a=null===(o=this.planner)||void 0===o?void 0:o.plan(d,l))&&void 0!==a?a:[]},e.prototype.executeSchemaMigration=function(e,t,n){var r,i,o,a;if(t)try{for(var s=Object(b.__values)(t),c=s.next();!c.done;c=s.next()){var u=c.value;try{for(var d=(o=void 0,Object(b.__values)(u.schema.actions)),l=d.next();!l.done;l=d.next()){var p=l.value;this.actionExecutor.executeSchemaAction(e,n,p)}}catch(e){o={error:e}}finally{try{l&&!l.done&&(a=d.return)&&a.call(d)}finally{if(o)throw o.error}}}}catch(e){r={error:e}}finally{try{c&&!c.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}},e.prototype.executeDataMigration=function(e,t,n){return Object(b.__awaiter)(this,void 0,void 0,(function(){var r,i,o,a,s,c,u,d,l,p,h,f;return Object(b.__generator)(this,(function(v){switch(v.label){case 0:if(!t)return[2];v.label=1;case 1:v.trys.push([1,12,13,14]),r=Object(b.__values)(t),i=r.next(),v.label=2;case 2:if(i.done)return[3,11];o=i.value,v.label=3;case 3:v.trys.push([3,8,9,10]),h=void 0,a=Object(b.__values)(o.data.actions),s=a.next(),v.label=4;case 4:return s.done?[3,7]:(c=s.value,[4,this.actionExecutor.executeDataAction(e,n,c)]);case 5:v.sent(),v.label=6;case 6:return s=a.next(),[3,4];case 7:return[3,10];case 8:return u=v.sent(),h={error:u},[3,10];case 9:try{s&&!s.done&&(f=a.return)&&f.call(a)}finally{if(h)throw h.error}return[7];case 10:return i=r.next(),[3,2];case 11:return[3,14];case 12:return d=v.sent(),l={error:d},[3,14];case 13:try{i&&!i.done&&(p=r.return)&&p.call(r)}finally{if(l)throw l.error}return[7];case 14:return[2]}}))}))},e.prototype.updateMigrationChangeInfo=function(e){var t,n;return Object(b.__awaiter)(this,void 0,void 0,(function(){var r,i;return Object(b.__generator)(this,(function(o){return r=this.schemaProvider.getDatabaseSchema(),i=null!==(t=r.version)&&void 0!==t?t:1,[2,Ct.updateSchemaChange(i,e,{schema:{expect:r,actual:null!==(n=this.actualDBSchema)&&void 0!==n?n:{name:r.name,collections:[]}}},"scan_exists_table"===this.actualDBSchemaFrom)]}))}))},e.prototype.log=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n]},e.prototype.executeDataUpgradeIfNeed=function(e,t){var n;return Object(b.__awaiter)(this,void 0,void 0,(function(){var r,i,o=this;return Object(b.__generator)(this,(function(a){switch(a.label){case 0:return this.log("executeDataUpgradeIfNeed",e.name),r=this.schemaProvider.getDatabaseSchema(),i={name:r.name,collections:[]},[4,this.lazyMigrationProcessor.executeDataUpgrade(e,t,{schema:{expect:r,actual:null!==(n=this.actualDBSchema)&&void 0!==n?n:i}},(function(){o.eventBus.emit(re.ModelLazyMigrationEnd,Q.getTableName(e))}))];case 1:return a.sent(),[2]}}))}))},e.prototype.safeExecuteDataUpgrade=function(e,t){var n=this;Promise.all([e.waitForModelRegistered(t),e.waitForDBReady()]).then((function(e){var r=Object(b.__read)(e,2),i=r[0],o=r[1];n.executeDataUpgradeIfNeed(i.class,o).catch((function(e){n.emitError(new z(t,e))}))})).catch((function(){}))},e.prototype.emitError=function(e){this.eventBus.emit(ne.Error,e)},e.prototype.applyAspectPatch=function(e){e.buildMigration.patch(this,"buildMigration"),e.executeDataMigration.patch(this,"executeDataMigration"),e.executeSchemaMigration.patch(this,"executeSchemaMigration"),e.prepareAutoUpgradeHandler.patch(this,"prepareAutoUpgradeHandler"),e.log.patch(this,"log"),e.updateMigrationChangeInfo.patch(this,"updateMigrationChangeInfo")},e}(),Tt=Nt;var Rt=function(){var e;return{lock:function(t){return e||(e=t()),e.finally((function(){e=void 0}))}}},At=function(){function e(e,t){var n,r=this;if(this.openingMutex=Rt(),this.closingMutex=Rt(),this.destroyingMutex=Rt(),this.openDatabase=function(){return Object(b.__awaiter)(r,void 0,void 0,(function(){var e=this;return Object(b.__generator)(this,(function(t){return[2,this.openingMutex.lock((function(){return Object(b.__awaiter)(e,void 0,void 0,(function(){var e,t,n,r,i,o,a,s,c,u,d,l=this;return Object(b.__generator)(this,(function(p){switch(p.label){case 0:if(this.db)return[2];e=this.storage,t=e.name,n=e.version,p.label=1;case 1:return p.trys.push([1,8,,9]),this.eventBus.emit(ne.BootstrapStart),r=this.getDatabaseSchema(),[4,this.migrationManager.prepareAutoUpgradeHandler(t,this.engine)];case 2:i=p.sent(),o=function(){l.eventBus.emit(ne.Fetal,new $(t))},p.label=3;case 3:return p.trys.push([3,5,,7]),a=this,[4,this.engine.openDB(t,r,n,{upgrade:i,terminated:o})];case 4:return a.db=p.sent(),[3,7];case 5:if("VersionError"!==(s=p.sent()).name||!this.supportCompatibleOpen)throw s;return c=this,[4,this.engine.openDB(t,r,void 0,{upgrade:i,terminated:o})];case 6:return c.db=p.sent(),[3,7];case 7:return this.db.setVersionChangeListener((function(e,t){l.eventBus.emit(ne.VersionChange,{oldVersion:e,newVersion:t})})),this.eventBus.emit(ne.BootstrapEnd),this.eventBus.emit(ne.Ready,this.db),[3,9];case 8:throw u=p.sent(),this.reset(),d=new A(t,u),this.eventBus.emit(ne.Error,d),this.eventBus.emit(ne.Fetal,d),d;case 9:return[2]}}))}))}))]}))}))},this.handleModelRegistered=function(e){if(!r.schemas.some((function(t){return t.name===e.schema.name}))){var t=e.schema;t.dataVersion=r.storage.version,r.schemas.push(t)}},this.handleFetal=function(){r.reset()},this.storage=e,this.engine=t.engine,this.eventBus=t.eventBus,this.supportCompatibleOpen=t.supportCompatibleOpen,this.engine.setAspects(e.aspects.engine),this.schemas=[Ct.getSystemTableSchema()],t.databaseSchema){var i=JSON.parse(t.databaseSchema).collections.map((function(e){return Object(b.__assign)(Object(b.__assign)({},e),{dataVersion:r.storage.version})}));(n=this.schemas).push.apply(n,Object(b.__spreadArray)([],Object(b.__read)(i)))}this.migrationManager=new Tt(this.eventBus,this,e.aspects.migration),this.eventBus.on(ne.RegisterModel,this.handleModelRegistered),this.eventBus.on(ne.Fetal,this.handleFetal)}return e.prototype.getDatabaseEngine=function(){return this.engine},e.prototype.getDatabaseSchema=function(){if(!this.storage.name||!this.storage.version)throw new Error("The database name and version are required for generating dbSchema");return{name:this.storage.name,version:this.storage.version,collections:this.schemas}},e.prototype.closeDatabase=function(){return Object(b.__awaiter)(this,void 0,void 0,(function(){var e=this;return Object(b.__generator)(this,(function(t){return[2,this.closingMutex.lock((function(){return Object(b.__awaiter)(e,void 0,void 0,(function(){return Object(b.__generator)(this,(function(e){switch(e.label){case 0:return this.db?[4,this.db.close()]:[2];case 1:return e.sent(),this.reset(),this.eventBus.emit(ne.Closed),[2]}}))}))}))]}))}))},e.prototype.destroyDatabase=function(){var e=this;return this.destroyingMutex.lock((function(){return Object(b.__awaiter)(e,void 0,void 0,(function(){return Object(b.__generator)(this,(function(e){switch(e.label){case 0:return[4,this.engine.deleteDB(this.storage.name)];case 1:return e.sent(),this.reset(),this.eventBus.emit(ne.Destroyed),[2]}}))}))}))},e.prototype.reset=function(){this.db=void 0},e}();var Pt=function(e){return setTimeout(e)},Lt=function(){function e(e){var t=e.keepActive,n=e.comparer,r=e.channelDB,i=e.channelModel,o=e.channelLazyMigration;this.keepActive=t,this.comparer=n,this.channelDB=r,this.channelModel=i,this.channelLazyMigration=o}return e.fromTransactionManager=function(t,n){return void 0===n&&(n=!1),new e({keepActive:n,comparer:t.comparer,channelDB:t.channelDB,channelModel:t.channelModel,channelLazyMigration:t.channelLazyMigration})},e.prototype.openTransaction=function(e,t){return Object(b.__awaiter)(this,void 0,void 0,(function(){var n=this;return Object(b.__generator)(this,(function(r){return this.transactionPromise=Object(b.__awaiter)(n,void 0,void 0,(function(){var n,r,i=this;return Object(b.__generator)(this,(function(o){switch(o.label){case 0:return[4,Promise.all(e.map((function(e){return i.waitForModelRegistered(e)})))];case 1:return o.sent(),[4,Promise.all(e.map((function(e){return i.waitForMigrationReady(e)})))];case 2:return o.sent(),[4,this.waitForDBReady()];case 3:return n=o.sent(),r=this,[4,n.transaction(e,t)];case 4:return r.transaction=o.sent(),[2,this.transaction]}}))})),[2,this.transactionPromise]}))}))},e.prototype.getTransaction=function(e,t){return Object(b.__awaiter)(this,void 0,void 0,(function(){return Object(b.__generator)(this,(function(n){switch(n.label){case 0:return this.transactionPromise?[3,2]:[4,this.openTransaction(e,t)];case 1:n.sent(),n.label=2;case 2:return[4,this.transactionPromise];case 3:return[2,n.sent()]}}))}))},e.prototype.waitForDBReady=function(){return Object(b.__awaiter)(this,void 0,void 0,(function(){return Object(b.__generator)(this,(function(e){return[2,this.channelDB.pick()]}))}))},e.prototype.waitForModelRegistered=function(e){return Object(b.__awaiter)(this,void 0,void 0,(function(){return Object(b.__generator)(this,(function(t){return[2,this.channelModel.pick(e)]}))}))},e.prototype.waitForMigrationReady=function(e){return Object(b.__awaiter)(this,void 0,void 0,(function(){return Object(b.__generator)(this,(function(t){return[2,this.channelLazyMigration.pick(e)]}))}))},e.prototype.perform=function(e){return this.keepActive?e():this.autoCommitOrRollback(e)},e.prototype.autoCommitOrRollback=function(e){var t,n;return Object(b.__awaiter)(this,void 0,void 0,(function(){var r,i;return Object(b.__generator)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,5]),[4,e()];case 1:return r=o.sent(),[4,null===(t=this.transaction)||void 0===t?void 0:t.commit()];case 2:return o.sent(),[2,r];case 3:return i=o.sent(),[4,null===(n=this.transaction)||void 0===n?void 0:n.rollback()];case 4:throw o.sent(),i;case 5:return[2]}}))}))},e}(),Bt=Symbol("channel");var Ut,Vt,Ft,qt,Gt=function(e){var t;void 0===e&&(e=function(){return Bt});var n=new Map,r=new Map;function i(e,t){var n;null===(n=r.get(e))||void 0===n||n.reject(t),r.delete(e)}function o(e,t){void 0===t&&(t=Bt),r.has(t)?function(e,t){var n;null===(n=r.get(e))||void 0===n||n.resolve(t),r.delete(e)}(t,e):n.set(t,Promise.resolve(e))}return{send:function(n){t||o(n,e(n))},pick:function(e){return void 0===e&&(e=Bt),t?Promise.reject(t):(n.has(e)||n.set(e,new Promise((function(t,n){r.set(e,{resolve:t,reject:n})}))),n.get(e))},open:function(){t=void 0},close:function(e,o){var a,s;void 0===o&&(o=!1),t=e;try{for(var c=Object(b.__values)(r.keys()),u=c.next();!u.done;u=c.next()){i(u.value,e)}}catch(e){a={error:e}}finally{try{u&&!u.done&&(s=c.return)&&s.call(c)}finally{if(a)throw a.error}}o&&(n.clear(),r.clear())}}},Ht=function(){function e(e,t){var n=this;this.handleFetalError=function(e){n.channelDB.close(e,!0),n.channelModel.close(e),n.channelLazyMigration.close(e)},this.eventBus=e,this.channelDB=Gt(),this.channelModel=Gt((function(e){return e.schema.name})),this.channelLazyMigration=Gt((function(e){return e})),this.comparer=t,this.eventBus.on(ne.Fetal,this.handleFetalError),this.eventBus.on(ne.Ready,this.channelDB.send),this.eventBus.on(ne.RegisterModel,this.channelModel.send),this.eventBus.on(re.ModelLazyMigrationEnd,this.channelLazyMigration.send)}return e.prototype.spawnAutoCommitContext=function(){return Lt.fromTransactionManager(this,!1)},e.prototype.spawnKeepAliveContext=function(){return Lt.fromTransactionManager(this,!0)},e.prototype.openChannels=function(){this.channelDB.open(),this.channelModel.open(),this.channelLazyMigration.open()},e}();!function(){function e(e){var t,n=this,r=e.name,i=e.engine,o=e.version,a=void 0===o?1:o,s=e.plugins,c=void 0===s?[]:s,u=e.disableAutoOpen,d=void 0!==u&&u,l=e.databaseSchema,p=e.supportCompatibleOpen,h=void 0!==p&&p;this.aspects={collection:{get:bt.withContext(_t),has:bt.withContext(_t),delete:bt.withContext(_t),insert:bt.withContext(_t),upsert:bt.withContext(_t),bulkInsert:bt.withContext(_t),bulkUpsert:bt.withContext(_t),update:bt.withContext(_t),clear:bt.withContext(_t),count:bt.withContext(_t),entries:bt.withContext(_t),keys:bt.withContext(_t),values:bt.withContext(_t),first:bt.withContext(_t),last:bt.withContext(_t),skip:vt.withContext(_t),take:vt.withContext(_t),slice:vt.withContext(_t),orderBy:vt.withContext(_t),where:vt.withContext(_t),or:vt.withContext(_t)},query:{},model:{},migration:{prepareAutoUpgradeHandler:bt.withContext(_t),buildMigration:vt.withContext(_t),executeDataMigration:bt.withContext(_t),executeSchemaMigration:vt.withContext(_t),updateMigrationChangeInfo:bt.withContext(_t),log:vt.withContext(_t),actionExecutor:{executeSchemaAction:vt.withContext(_t),executeDataAction:bt.withContext(_t)}},engine:{deleteDB:bt.withContext(_t),openDB:bt.withContext(_t),database:{createTable:vt.withContext(_t),deleteTable:vt.withContext(_t),close:vt.withContext(_t),table:bt.withContext(_t),transaction:bt.withContext(_t)},table:{createIndex:bt.withContext(_t),deleteIndex:bt.withContext(_t),delete:bt.withContext(_t),get:bt.withContext(_t),getAll:bt.withContext(_t),getAllKeys:bt.withContext(_t),index:vt.withContext(_t),insert:bt.withContext(_t),query:bt.withContext(_t),openCursor:bt.withContext(_t),upsert:bt.withContext(_t),bulkUpsert:bt.withContext(_t),clear:bt.withContext(_t),bulkDelete:bt.withContext(_t)},index:{get:bt.withContext(_t),getAll:bt.withContext(_t),getAllKeys:bt.withContext(_t),openCursor:bt.withContext(_t)},cursor:{delete:bt.withContext(_t),update:bt.withContext(_t),next:bt.withContext(_t),value:vt.withContext(_t)},transaction:{commit:bt.withContext(_t),rollback:bt.withContext(_t),table:vt.withContext(_t)}}},this.eventBus=te(),this.open=function(){return n.transactionManager.openChannels(),n.databaseManager.openDatabase()},this.close=function(){return n.databaseManager.closeDatabase()},this.destroy=function(){return n.databaseManager.destroyDatabase()},this.register=function(e){n.modelManager.register(e)},this.collection=function(e){var t=n.modelManager.getSchemaAndRegisterModelIfNeed(e);return n.collectionManager.getCollection(t.name,{spawnContext:function(){return n.transactionManager.spawnAutoCommitContext()}})},this.transaction=function(e,t,r){return Object(b.__awaiter)(n,void 0,void 0,(function(){var n,i,o,a=this;return Object(b.__generator)(this,(function(s){switch(s.label){case 0:return n=this.transactionManager,i=e.map((function(e){return a.modelManager.getSchemaAndRegisterModelIfNeed(e).name})),o=n.spawnKeepAliveContext(),this.eventBus.emit(re.StartTransaction,{collectionNames:i,context:o}),[4,o.openTransaction(i,t)];case 1:return s.sent(),[2,o.autoCommitOrRollback((function(){return r(a.createStorageTransaction(o))}))]}}))}))},this.name=r,this.version=a,this.events=new oe(this.eventBus),this.modelManager=new se(this.eventBus),this.databaseManager=new At(this,{engine:i,eventBus:this.eventBus,databaseSchema:l,supportCompatibleOpen:h}),this.pluginManager=new Ot(this,this.eventBus),this.collectionManager=new ut(this,this.eventBus),this.transactionManager=new Ht(this.eventBus,{cmp:this.databaseManager.getDatabaseEngine().cmp}),(t=this.pluginManager).add.apply(t,Object(b.__spreadArray)([],Object(b.__read)(c))),d||Pt((function(){return n.open().catch((function(e){throw e}))}))}e.prototype.createStorageTransaction=function(e){var t=this.modelManager,n=new ut(this,this.eventBus);return{collection:function(r){var i=t.getSchemaAndRegisterModelIfNeed(r);return n.getCollection(i.name,{spawnContext:function(){return e}})}}}}();!function(e){e[e.unknown=-1]="unknown",e[e.doc=0]="doc",e[e.sheet=1]="sheet",e[e.form=2]="form",e[e.folder=3]="folder",e[e.slide=4]="slide",e[e.note=5]="note",e[e.pdf=6]="pdf",e[e.miniProgram=7]="miniProgram",e[e.smartCanvas=8]="smartCanvas",e[e.smartSheet=9]="smartSheet",e[e.unknow=10]="unknow",e[e.resume=11]="resume",e[e.board=12]="board",e[e.drawing=89]="drawing",e[e.mind=90]="mind",e[e.flowchart=91]="flowchart",e[e.file=100]="file",e[e.drive=101]="drive",e[e.sogoSpeech=102]="sogoSpeech",e[e.addon=110]="addon"}(Ft||(Ft={})),function(e){e.doc="doc",e.sheet="sheet",e.form="form",e.slide="slide",e.smartSheet="smartSheet",e.smartCanvas="smartCanvas",e.flowchart="flowchart",e.mind="mind",e.pdf="pdf",e.drive="document"}(qt||(qt={}));var Kt,Wt,zt,$t,Yt,Qt,Xt,Jt=(Ut={},a()(Ut,qt.doc,Ft.doc),a()(Ut,qt.sheet,Ft.sheet),a()(Ut,qt.slide,Ft.slide),a()(Ut,qt.smartSheet,Ft.smartSheet),a()(Ut,qt.smartCanvas,Ft.smartCanvas),a()(Ut,qt.flowchart,Ft.flowchart),a()(Ut,qt.mind,Ft.mind),a()(Ut,qt.pdf,Ft.pdf),a()(Ut,qt.drive,Ft.drive),Ut),Zt=(Vt={},a()(Vt,Ft.doc,qt.doc),a()(Vt,Ft.sheet,qt.sheet),a()(Vt,Ft.slide,qt.slide),a()(Vt,Ft.smartSheet,qt.smartSheet),a()(Vt,Ft.smartCanvas,qt.smartCanvas),a()(Vt,Ft.flowchart,qt.flowchart),a()(Vt,Ft.mind,qt.mind),a()(Vt,Ft.pdf,qt.pdf),a()(Vt,Ft.drive,qt.drive),Vt);!function(e){e[e.private=0]="private",e[e.partialShare=1]="partialShare",e[e.canRead=2]="canRead",e[e.canEdit=3]="canEdit"}(Kt||(Kt={})),function(e){e.new="new",e.local="local",e.deleted="deleted",e.normal="normal"}(Wt||(Wt={})),function(e){e.NONE="none",e.SUCCESS="success",e.FAIL="fail",e.ERROR="error"}(zt||(zt={})),function(e){e[e.file=1]="file",e[e.folder=2]="folder"}($t||($t={})),function(e){e[e.trash=3]="trash",e[e.share=4]="share",e[e.myDoc=5]="myDoc",e[e.recent=6]="recent",e[e.start=7]="start"}(Yt||(Yt={})),function(e){e.init="init",e.document="document",e.workbook="workbook",e.chunk="chunk",e.accepted="accepted",e.missChange="misschange",e.newChange="newchange",e.committing="commiting",e.waiting="watting",e.queue="queue"}(Qt||(Qt={})),function(e){e.drive="drive",e.attachment="attachment"}(Xt||(Xt={}));var en,tn,nn,rn,on,an,sn="TencentDocs",cn="all-local-files/TencentDocs",un="TencentDocs_TestEnv";function dn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=y()(e);if(t){var i=y()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}!function(e){e.documentStatus="DocumentStatus",e.documentEntities="DocumentEntities",e.newDocumentIds="NewDocumentIds",e.padinfo="PadInfo",e.offlineData="OfflineData",e.documentData="DocumentData",e.Users="Users",e.driveData="DriveData"}(en||(en={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.QQ=1]="QQ",e[e.WX=2]="WX",e[e.WORK=3]="WORK",e[e.EMAIL=4]="EMAIL",e[e.PHONE=8]="PHONE",e[e.WORK_COMBINATION=9]="WORK_COMBINATION",e[e.TOWER=10]="TOWER",e[e.ROBOT=11]="ROBOT",e[e.QFYF=12]="QFYF",e[e.OPEN=13]="OPEN",e[e.MEETING=14]="MEETING"}(tn||(tn={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.WECHAT=4]="WECHAT",e[e.WEWORK=3]="WEWORK"}(nn||(nn={})),function(e){e.BINDING="BINDING",e.UNBIND="UNBIND"}(rn||(rn={})),function(e){e.NORMAL="NORMAL",e.SUPER="SUPER",e.SUPER_PLUS="SUPER_PLUS",e.NONE="NONE",e.EXPIRED="EXPIRED"}(on||(on={})),function(e){e[e.NORMAL=2]="NORMAL",e[e.SUPER=3]="SUPER",e[e.SUPER_PLUS=4]="SUPER_PLUS",e[e.NONE=1]="NONE",e[e.EXPIRED=0]="EXPIRED"}(an||(an={}));var ln=function(e){p()(n,e);var t=dn(n);function n(e){var r,i,o,a,s,u,d;return c()(this,n),(r=t.call(this)).isDefaultChunk=!1,r.uid=e.uid,r.type=e.type,r.data=e.data,r.dataVersion=e.dataVersion,r.docType=e.docType,r.subId=e.subId,r.secretId=e.secretId,r.version=e.version,r.globalPadId=e.globalPadId,r.taskId=null!==(i=e.taskId)&&void 0!==i?i:r.getTaskId(),r.isDefaultChunk=null!==(o=e.isDefaultChunk)&&void 0!==o&&o,r.chunkId=null!==(a=e.chunkId)&&void 0!==a?a:0,r.docStatus=null!==(s=e.docStatus)&&void 0!==s?s:Wt.normal,r.createTimestamp=null!==(u=e.createTimestamp)&&void 0!==u?u:Date.now(),r.lastModifyTimestamp=null!==(d=e.lastModifyTimestamp)&&void 0!==d?d:Date.now(),r.key=r.getKey(),r.subGlobalPadId=e.subGlobalPadId,r.subDocType=e.subDocType,r}return d()(n,[{key:"getTaskId",value:function(){return Math.ceil(2147483648*Math.random())}},{key:"getKey",value:function(){return this.type===Qt.init?"".concat(this.globalPadId,"_").concat(this.subId,"_").concat(this.uid):this.type===Qt.document?"".concat(this.globalPadId,"_").concat(this.uid,"_version_").concat(this.version):this.type===Qt.workbook?"".concat(this.globalPadId,"_").concat(this.subId,"_").concat(this.uid,"_version_").concat(this.version):this.type===Qt.chunk?"".concat(this.globalPadId,"_").concat(this.subId,"_").concat(this.chunkId,"_").concat(this.uid,"_version_").concat(this.version):"".concat(this.globalPadId,"_").concat(this.subId,"_").concat(this.uid,"_taskId_").concat(this.taskId)}}]),n}(ae);function pn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=y()(e);if(t){var i=y()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}Object(b.__decorate)([ee(),Object(b.__metadata)("design:type",String)],ln.prototype,"key",void 0),Object(b.__decorate)([Z(),Object(b.__metadata)("design:type",String)],ln.prototype,"secretId",void 0),Object(b.__decorate)([Z(),Object(b.__metadata)("design:type",String)],ln.prototype,"globalPadId",void 0),Object(b.__decorate)([Z(),Object(b.__metadata)("design:type",String)],ln.prototype,"subGlobalPadId",void 0),Object(b.__decorate)([Z(),Object(b.__metadata)("design:type",Number)],ln.prototype,"subDocType",void 0),Object(b.__decorate)([Z(),Object(b.__metadata)("design:type",Number)],ln.prototype,"version",void 0),Object(b.__decorate)([Z(),Object(b.__metadata)("design:type",String)],ln.prototype,"type",void 0),Object(b.__decorate)([Z(),Object(b.__metadata)("design:type",String)],ln.prototype,"uid",void 0),Object(b.__decorate)([Z(),X("subSheetId"),Object(b.__metadata)("design:type",String)],ln.prototype,"subId",void 0),Object(b.__decorate)([Z(),Object(b.__metadata)("design:type",Number)],ln.prototype,"chunkId",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",Number)],ln.prototype,"taskId",void 0),Object(b.__decorate)([X("_data"),Object(b.__metadata)("design:type",String)],ln.prototype,"data",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",Number)],ln.prototype,"docType",void 0),Object(b.__decorate)([X("padStatus"),Object(b.__metadata)("design:type",String)],ln.prototype,"docStatus",void 0),Object(b.__decorate)([X("createTime"),Object(b.__metadata)("design:type",Number)],ln.prototype,"createTimestamp",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",Number)],ln.prototype,"lastModifyTimestamp",void 0),Object(b.__decorate)([X("dver"),Object(b.__metadata)("design:type",String)],ln.prototype,"dataVersion",void 0),Object(b.__decorate)([X("default"),Object(b.__metadata)("design:type",Object)],ln.prototype,"isDefaultChunk",void 0);var hn=function(e){p()(n,e);var t=pn(n);function n(){return c()(this,n),t.apply(this,arguments)}return d()(n)}(ln);function fn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=y()(e);if(t){var i=y()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}hn=Object(b.__decorate)([J(en.documentData)],hn);var vn=function(e){p()(n,e);var t=fn(n);function n(){return c()(this,n),t.apply(this,arguments)}return d()(n)}(ae);function yn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=y()(e);if(t){var i=y()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}Object(b.__decorate)([ee(),Object(b.__metadata)("design:type",String)],vn.prototype,"key",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",Object)],vn.prototype,"data",void 0),vn=Object(b.__decorate)([J(en.documentEntities)],vn);var bn=function(e){p()(n,e);var t=yn(n);function n(){var e;return c()(this,n),(e=t.apply(this,arguments)).isCreated=!1,e}return d()(n)}(ae);function _n(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=y()(e);if(t){var i=y()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}Object(b.__decorate)([ee(),Object(b.__metadata)("design:type",String)],bn.prototype,"globalPadId",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",String)],bn.prototype,"secretId",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",Number)],bn.prototype,"documentType",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",String)],bn.prototype,"localPadId",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",Object)],bn.prototype,"isCreated",void 0),bn=Object(b.__decorate)([J(en.newDocumentIds)],bn);var mn=function(e){p()(n,e);var t=_n(n);function n(){var e;return c()(this,n),(e=t.apply(this,arguments)).lastSyncTimestamp=0,e}return d()(n)}(ae);function gn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=y()(e);if(t){var i=y()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}Object(b.__decorate)([ee(),Object(b.__metadata)("design:type",String)],mn.prototype,"globalPadId",void 0),Object(b.__decorate)([Z(),Object(b.__metadata)("design:type",String)],mn.prototype,"secretId",void 0),Object(b.__decorate)([Z(),Object(b.__metadata)("design:type",String)],mn.prototype,"uid",void 0),Object(b.__decorate)([X("lastSyncTime"),Object(b.__metadata)("design:type",Object)],mn.prototype,"lastSyncTimestamp",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",Number)],mn.prototype,"lastErrorTimestamp",void 0),mn=Object(b.__decorate)([J(en.documentStatus)],mn);var On=function(e){p()(n,e);var t=gn(n);function n(){return c()(this,n),t.apply(this,arguments)}return d()(n)}(ae);function wn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=y()(e);if(t){var i=y()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}Object(b.__decorate)([ee(),Object(b.__metadata)("design:type",String)],On.prototype,"driveId",void 0),Object(b.__decorate)([Z(),Object(b.__metadata)("design:type",String)],On.prototype,"fileId",void 0),Object(b.__decorate)([Z(),Object(b.__metadata)("design:type",String)],On.prototype,"objKey",void 0),Object(b.__decorate)([Z(),Object(b.__metadata)("design:type",String)],On.prototype,"secretId",void 0),Object(b.__decorate)([Z(),Object(b.__metadata)("design:type",String)],On.prototype,"uid",void 0),Object(b.__decorate)([X("type"),Object(b.__metadata)("design:type",String)],On.prototype,"type",void 0),Object(b.__decorate)([X("lastRequestTime"),Object(b.__metadata)("design:type",Number)],On.prototype,"lastRequestTime",void 0),Object(b.__decorate)([X("fileInfo"),Object(b.__metadata)("design:type",Object)],On.prototype,"fileInfo",void 0),Object(b.__decorate)([X("previewInfo"),Object(b.__metadata)("design:type",Object)],On.prototype,"previewInfo",void 0),On=Object(b.__decorate)([J(en.driveData)],On);var jn=function(e){p()(n,e);var t=wn(n);function n(){return c()(this,n),t.apply(this,arguments)}return d()(n)}(ln);function xn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=y()(e);if(t){var i=y()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}jn=Object(b.__decorate)([J(en.offlineData)],jn);var Sn=function(e){p()(n,e);var t=xn(n);function n(){var e;return c()(this,n),(e=t.apply(this,arguments)).addListTimestamp=0,e.attribute=null,e.docPolicy=Kt.private,e.docPrivilege=null,e.folderPolicy=0,e.folderPrivilege=null,e.isManualOffline=!1,e.isOfflineCache=!1,e.hasSnapShot=!1,e.isAddedToMy=0,e.isCollected=0,e.isOwner=1,e.isPinned=0,e.isShortcut=0,e.isUserChangeTitle=!1,e.lastCollectTimestamp=0,e.lastDeleteTimestamp=0,e.parents=[],e.cacheStatus=0,e}return d()(n)}(ae);function En(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=y()(e);if(t){var i=y()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}Object(b.__decorate)([ee(),Object(b.__metadata)("design:type",String)],Sn.prototype,"key",void 0),Object(b.__decorate)([Z(),Object(b.__metadata)("design:type",String)],Sn.prototype,"secretId",void 0),Object(b.__decorate)([Z(),Object(b.__metadata)("design:type",String)],Sn.prototype,"globalPadId",void 0),Object(b.__decorate)([Z(),Object(b.__metadata)("design:type",String)],Sn.prototype,"uid",void 0),Object(b.__decorate)([X("add_list_ts"),Object(b.__metadata)("design:type",Object)],Sn.prototype,"addListTimestamp",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",Object)],Sn.prototype,"attribute",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",Number)],Sn.prototype,"childrenLength",void 0),Object(b.__decorate)([X("client_version"),Object(b.__metadata)("design:type",String)],Sn.prototype,"clientVersion",void 0),Object(b.__decorate)([X("create_ts"),Object(b.__metadata)("design:type",Number)],Sn.prototype,"createTimestamp",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",String)],Sn.prototype,"creator",void 0),Object(b.__decorate)([X("creator_domain"),Object(b.__metadata)("design:type",String)],Sn.prototype,"creatorDomain",void 0),Object(b.__decorate)([X("doc_icon"),Object(b.__metadata)("design:type",String)],Sn.prototype,"icon",void 0),Object(b.__decorate)([X("doc_policy"),Object(b.__metadata)("design:type",Number)],Sn.prototype,"docPolicy",void 0),Object(b.__decorate)([X("doc_privilege"),Object(b.__metadata)("design:type",Object)],Sn.prototype,"docPrivilege",void 0),Object(b.__decorate)([X("doc_thumbnail"),Object(b.__metadata)("design:type",String)],Sn.prototype,"thumbnail",void 0),Object(b.__decorate)([X("doc_type"),Object(b.__metadata)("design:type",Number)],Sn.prototype,"docType",void 0),Object(b.__decorate)([X("doc_type_desc"),Object(b.__metadata)("design:type",String)],Sn.prototype,"docTypeDesc",void 0),Object(b.__decorate)([X("doc_url"),Object(b.__metadata)("design:type",String)],Sn.prototype,"url",void 0),Object(b.__decorate)([X("domain_id"),Object(b.__metadata)("design:type",String)],Sn.prototype,"domainId",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",String)],Sn.prototype,"dver",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",String)],Sn.prototype,"folder",void 0),Object(b.__decorate)([X("folder_id"),Object(b.__metadata)("design:type",String)],Sn.prototype,"folderId",void 0),Object(b.__decorate)([X("folder_policy"),Object(b.__metadata)("design:type",Object)],Sn.prototype,"folderPolicy",void 0),Object(b.__decorate)([X("folder_privilege"),Object(b.__metadata)("design:type",Object)],Sn.prototype,"folderPrivilege",void 0),Object(b.__decorate)([X("isDelete"),Object(b.__metadata)("design:type",Boolean)],Sn.prototype,"isDeleted",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",Object)],Sn.prototype,"isManualOffline",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",Boolean)],Sn.prototype,"isMyCreated",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",Boolean)],Sn.prototype,"isMydoc",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",Object)],Sn.prototype,"isOfflineCache",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",Boolean)],Sn.prototype,"isRencent",void 0),Object(b.__decorate)([X("isShareme"),Object(b.__metadata)("design:type",Boolean)],Sn.prototype,"isShareToMe",void 0),Object(b.__decorate)([X("isSnapShot"),Object(b.__metadata)("design:type",Object)],Sn.prototype,"hasSnapShot",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",Boolean)],Sn.prototype,"isStar",void 0),Object(b.__decorate)([X("is_added_my"),Object(b.__metadata)("design:type",Object)],Sn.prototype,"isAddedToMy",void 0),Object(b.__decorate)([X("is_collected"),Object(b.__metadata)("design:type",Object)],Sn.prototype,"isCollected",void 0),Object(b.__decorate)([X("is_owner"),Object(b.__metadata)("design:type",Object)],Sn.prototype,"isOwner",void 0),Object(b.__decorate)([X("is_pinned"),Object(b.__metadata)("design:type",Object)],Sn.prototype,"isPinned",void 0),Object(b.__decorate)([X("is_shortcut"),Object(b.__metadata)("design:type",Object)],Sn.prototype,"isShortcut",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",Object)],Sn.prototype,"isUserChangeTitle",void 0),Object(b.__decorate)([X("lastSyncTime"),Object(b.__metadata)("design:type",Number)],Sn.prototype,"lastSyncTimestamp",void 0),Object(b.__decorate)([X("last_browse_ts"),Object(b.__metadata)("design:type",Number)],Sn.prototype,"lastBrowseTimestamp",void 0),Object(b.__decorate)([X("last_collect_ts"),Object(b.__metadata)("design:type",Object)],Sn.prototype,"lastCollectTimestamp",void 0),Object(b.__decorate)([X("last_delete_ts"),Object(b.__metadata)("design:type",Object)],Sn.prototype,"lastDeleteTimestamp",void 0),Object(b.__decorate)([X("last_modify_ts"),Object(b.__metadata)("design:type",Number)],Sn.prototype,"lastModifyTimestamp",void 0),Object(b.__decorate)([X("last_modify_nick"),Object(b.__metadata)("design:type",String)],Sn.prototype,"lastModifyNick",void 0),Object(b.__decorate)([X("last_modify_uid"),Object(b.__metadata)("design:type",String)],Sn.prototype,"lastModifyUid",void 0),Object(b.__decorate)([X("last_pinned_ts"),Object(b.__metadata)("design:type",Number)],Sn.prototype,"lastPinnedTimestamp",void 0),Object(b.__decorate)([X("list_info_type"),Object(b.__metadata)("design:type",Number)],Sn.prototype,"listInfoType",void 0),Object(b.__decorate)([X("list_type"),Object(b.__metadata)("design:type",Number)],Sn.prototype,"listType",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",Boolean)],Sn.prototype,"offlineCommiting",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",Boolean)],Sn.prototype,"offlineCommitSuccessd",void 0),Object(b.__decorate)([X("origin_folder_id"),Object(b.__metadata)("design:type",String)],Sn.prototype,"originFolderId",void 0),Object(b.__decorate)([X("owner_nick"),Object(b.__metadata)("design:type",String)],Sn.prototype,"ownerNick",void 0),Object(b.__decorate)([X("owner_uid"),Object(b.__metadata)("design:type",String)],Sn.prototype,"ownerUid",void 0),Object(b.__decorate)([X("pad_id"),Object(b.__metadata)("design:type",String)],Sn.prototype,"padId",void 0),Object(b.__decorate)([X("parent_folder_id"),Object(b.__metadata)("design:type",String)],Sn.prototype,"parentFolderId",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",Array)],Sn.prototype,"parents",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",Number)],Sn.prototype,"privilege",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",String)],Sn.prototype,"status",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",String)],Sn.prototype,"title",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",Number)],Sn.prototype,"type",void 0),Object(b.__decorate)([X("uncommit"),Object(b.__metadata)("design:type",Boolean)],Sn.prototype,"hasLocalChanges",void 0),Object(b.__decorate)([X("doc_sub_type"),Object(b.__metadata)("design:type",Number)],Sn.prototype,"docSubType",void 0),Object(b.__decorate)([X("official_auth_info"),Object(b.__metadata)("design:type",String)],Sn.prototype,"officialAuthInfo",void 0),Object(b.__decorate)([X("personalize_info"),Object(b.__metadata)("design:type",String)],Sn.prototype,"personalizeInfo",void 0),Object(b.__decorate)([X("nativeEngineStatusRecord"),Object(b.__metadata)("design:type",String)],Sn.prototype,"nativeEngineStatusRecord",void 0),Object(b.__decorate)([X("nativeEngineDocPrivilege"),Object(b.__metadata)("design:type",String)],Sn.prototype,"nativeEngineDocPrivilege",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",String)],Sn.prototype,"data",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",String)],Sn.prototype,"ext",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",Boolean)],Sn.prototype,"isOfflineCacheByNative",void 0),Object(b.__decorate)([X("mime_type"),Object(b.__metadata)("design:type",String)],Sn.prototype,"mimeType",void 0),Object(b.__decorate)([X("owner_vip_info"),Object(b.__metadata)("design:type",String)],Sn.prototype,"ownerVipInfo",void 0),Object(b.__decorate)([X("documentResourceCacheStatus"),Object(b.__metadata)("design:type",String)],Sn.prototype,"documentResourceCacheStatus",void 0),Object(b.__decorate)([X("cache_status"),Object(b.__metadata)("design:type",Object)],Sn.prototype,"cacheStatus",void 0),Object(b.__decorate)([X("cache_status_ts"),Object(b.__metadata)("design:type",Number)],Sn.prototype,"cacheStatusTs",void 0),Sn=Object(b.__decorate)([J(en.padinfo)],Sn);var Cn=function(e){p()(n,e);var t=En(n);function n(e){var r,i,o,a;return c()(this,n),(r=t.call(this)).docId=e.docId,r.pageType=e.pageType,r.updateTime=e.updateTime,r.tinyId=e.tinyId,r.wedriveUin=e.wedriveUin,r.wedocOpenId=e.wedocOpenId,r.nowUserIndex=null!==(i=e.nowUserIndex)&&void 0!==i?i:"",r.corpId=e.corpId,r.corpName=e.corpName,r.englishName=e.englishName,r.loginType=e.loginType,r.uidSource=e.uidSource,r.uin=e.uin,r.userId=e.userId,r.userName=e.userName,r.userPic=e.userPic,r.settings=e.settings,r.bindUserInfo=null!==(o=e.bindUserInfo)&&void 0!==o?o:{type:rn.UNBIND,userName:"",userPic:"",accountType:tn.UNKNOWN},r.vipUserInfo=null!==(a=e.vipUserInfo)&&void 0!==a?a:{type:on.NONE,vipLevel:an.NONE,beginTime:0,endTime:0},r.key="".concat(r.pageType,"-").concat(r.docId,"-").concat(r.tinyId),r}return d()(n)}(ae);Object(b.__decorate)([ee(),Object(b.__metadata)("design:type",String)],Cn.prototype,"key",void 0),Object(b.__decorate)([Z(),Object(b.__metadata)("design:type",String)],Cn.prototype,"tinyId",void 0),Object(b.__decorate)([Z(),Object(b.__metadata)("design:type",String)],Cn.prototype,"nowUserIndex",void 0),Object(b.__decorate)([Z(),Object(b.__metadata)("design:type",String)],Cn.prototype,"docId",void 0),Object(b.__decorate)([Z(),Object(b.__metadata)("design:type",String)],Cn.prototype,"pageType",void 0),Object(b.__decorate)([Z(),Object(b.__metadata)("design:type",String)],Cn.prototype,"wedriveUin",void 0),Object(b.__decorate)([Z(),Object(b.__metadata)("design:type",String)],Cn.prototype,"wedocOpenId",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",String)],Cn.prototype,"corpId",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",String)],Cn.prototype,"corpName",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",String)],Cn.prototype,"englishName",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",Number)],Cn.prototype,"loginType",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",String)],Cn.prototype,"openId",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",Number)],Cn.prototype,"uidSource",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",String)],Cn.prototype,"uin",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",String)],Cn.prototype,"userId",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",String)],Cn.prototype,"userName",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",String)],Cn.prototype,"userPic",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",String)],Cn.prototype,"updateTime",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",Object)],Cn.prototype,"settings",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",Object)],Cn.prototype,"bindUserInfo",void 0),Object(b.__decorate)([X(),Object(b.__metadata)("design:type",Object)],Cn.prototype,"vipUserInfo",void 0),Cn=Object(b.__decorate)([J(en.Users),Object(b.__metadata)("design:paramtypes",[Object])],Cn)},"48a9511069":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));class r{constructor(){this.hookRegistry=new Set}addHook(e,t){this.hookRegistry.add({hookPoint:e,callback:t})}executeHooks(e,t){this.hookRegistry.forEach((n=>{const{hookPoint:r,callback:i}=n;r===t&&i(e)}))}}},"4f04e6c8a0":function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n("fda8d8987d"),i=n("a1644e2245"),o=n("a282565e4f");class a{static has(e){return this.serviceIdsMap.has(e)}static get(e){return this.serviceIdsMap.get(e)}static set(e,t){this.serviceIdsMap.set(e,t)}}function s(e){if(a.has(e))return a.get(e);const t=function(e,n,a){if(3!==arguments.length)throw new Error(Object(o.r)(n));Object(r.a)(i.a,e,void 0,t,a)};return t.toLegacyString=()=>e,a.set(e,t),t}a.serviceIdsMap=new Map},"513019d975":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisposableNone=void 0,t.DisposableNone=Object.freeze({dispose:function(){}})},"5fc26b30d4":function(e,t,n){var r,i,o;!function(a,s){"use strict";i=[n("d9e8a1cab8")],void 0===(o="function"==typeof(r=function(e){var t=/(^|@)\S+:\d+/,n=/^\s*at .*(\S+:\d+|\(native\))/m,r=/^(eval@)?(\[native code])?$/;return{parse:function(e){if(void 0!==e.stacktrace||void 0!==e["opera#sourceloc"])return this.parseOpera(e);if(e.stack&&e.stack.match(n))return this.parseV8OrIE(e);if(e.stack)return this.parseFFOrSafari(e);throw new Error("Cannot parse given Error object")},extractLocation:function(e){if(-1===e.indexOf(":"))return[e];var t=/(.+?)(?::(\d+))?(?::(\d+))?$/.exec(e.replace(/[()]/g,""));return[t[1],t[2]||void 0,t[3]||void 0]},parseV8OrIE:function(t){return t.stack.split("\n").filter((function(e){return!!e.match(n)}),this).map((function(t){t.indexOf("(eval ")>-1&&(t=t.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var n=t.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),r=n.match(/ (\(.+\)$)/);n=r?n.replace(r[0],""):n;var i=this.extractLocation(r?r[1]:n),o=r&&n||void 0,a=["eval","<anonymous>"].indexOf(i[0])>-1?void 0:i[0];return new e({functionName:o,fileName:a,lineNumber:i[1],columnNumber:i[2],source:t})}),this)},parseFFOrSafari:function(t){return t.stack.split("\n").filter((function(e){return!e.match(r)}),this).map((function(t){if(t.indexOf(" > eval")>-1&&(t=t.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),-1===t.indexOf("@")&&-1===t.indexOf(":"))return new e({functionName:t});var n=/((.*".+"[^@]*)?[^@]*)(?:@)/,r=t.match(n),i=r&&r[1]?r[1]:void 0,o=this.extractLocation(t.replace(n,""));return new e({functionName:i,fileName:o[0],lineNumber:o[1],columnNumber:o[2],source:t})}),this)},parseOpera:function(e){return!e.stacktrace||e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length?this.parseOpera9(e):e.stack?this.parseOpera11(e):this.parseOpera10(e)},parseOpera9:function(t){for(var n=/Line (\d+).*script (?:in )?(\S+)/i,r=t.message.split("\n"),i=[],o=2,a=r.length;o<a;o+=2){var s=n.exec(r[o]);s&&i.push(new e({fileName:s[2],lineNumber:s[1],source:r[o]}))}return i},parseOpera10:function(t){for(var n=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,r=t.stacktrace.split("\n"),i=[],o=0,a=r.length;o<a;o+=2){var s=n.exec(r[o]);s&&i.push(new e({functionName:s[3]||void 0,fileName:s[2],lineNumber:s[1],source:r[o]}))}return i},parseOpera11:function(n){return n.stack.split("\n").filter((function(e){return!!e.match(t)&&!e.match(/^Error created at/)}),this).map((function(t){var n,r=t.split("@"),i=this.extractLocation(r.pop()),o=r.shift()||"",a=o.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0;o.match(/\(([^)]*)\)/)&&(n=o.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var s=void 0===n||"[arguments not available]"===n?void 0:n.split(",");return new e({functionName:a,args:s,fileName:i[0],lineNumber:i[1],columnNumber:i[2],source:t})}),this)}}})?r.apply(t,i):r)||(e.exports=o)}()},"6064ce49c9":function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},r(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},a=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0}),t.mixinRootDisposable=t.mixinDisposable=t.Disposable=t.RootDisposable=void 0;var s=n("6cac31cea5"),c=n("6bb936b136"),u=n("88476f9607"),d=function(){function e(){this.disposedStore=new u.DisposableStore}return e.prototype.dispose=function(e){this.disposedStore.dispose(e)},e.prototype._register=function(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this.disposedStore.add(e)},e}(),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.dispose=function(t){var n=t,r=!1;if(!n){var i=this.constructor.name;n=s.DisposeTrace.traceRoot(i),r=!0}e.prototype.dispose.call(this,n),r&&n.stop()},t.prototype._register=function(t){return e.prototype._register.call(this,t)},t}(d);t.RootDisposable=l;var p=function(e){function t(){var t=e.call(this)||this;return c.trackDisposable(t),t}return i(t,e),t.prototype.dispose=function(t){c.markTracked(this),e.prototype.dispose.call(this,t)},t}(d);t.Disposable=p,t.mixinDisposable=function(e){return function(e){function t(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=e.apply(this,a(t))||this;return r.disposedStore=new u.DisposableStore,c.trackDisposable(r),r}return i(t,e),t.prototype.dispose=function(e){c.markTracked(this),this.disposedStore.dispose(e)},t.prototype._register=function(e){return this.disposedStore.add(e)},t}(e)},t.mixinRootDisposable=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.disposedStore=new u.DisposableStore,t}return i(t,e),t.prototype.dispose=function(e){c.markTracked(this);var t=e,n=!1;if(!t){var r=this.constructor.name;t=s.DisposeTrace.traceRoot(r),n=!0}this.disposedStore.dispose(t),n&&t.stop()},t.prototype._register=function(e){return this.disposedStore.add(e)},t}(e)}},"6bb936b136":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.trackDisposable=t.markTracked=t.disableDisposablesTrack=t.enableDisposablesTrack=void 0;var r=n("513019d975"),i=!1,o="__is_disposable_tracked__";t.enableDisposablesTrack=function(){i=!0},t.disableDisposablesTrack=function(){i=!1},t.markTracked=function(e){if(i&&e&&e!==r.DisposableNone)try{e[o]=!0}catch(e){}},t.trackDisposable=function(e){if(!i)return e;e[o]||(e[o]=!1);var t=new Error("Potentially leaked disposable").stack;return setTimeout((function(){e[o]||console.log(t)}),3e3),e}},"6cac31cea5":function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},r(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a};Object.defineProperty(t,"__esModule",{value:!0}),t.DisposeTrace=t.disableDisposeTrace=t.enableDisposeTrace=void 0;var s=!1;t.enableDisposeTrace=function(){s=!0},t.disableDisposeTrace=function(){s=!1};var c=function(){function e(e){this.name=e,this._dep=[]}return e.traceRoot=function(t){return s?new e(t):e._None},e.prototype.branch=function(t){var n=new e(t);return this._dep.push([t,n]),n},e.prototype.stop=function(){var e=["dispose "+this.name,""+function e(t,n){var r,i,s=[],c=new Array(t+1).join("\t");try{for(var u=o(n._dep),d=u.next();!d.done;d=u.next()){var l=a(d.value,2),p=l[0],h=l[1];if(h){s.push(c+"dispose -> "+p);var f=e(t+1,h);f&&s.push(f)}else s.push(c+"dispose -> "+p)}}catch(e){r={error:e}}finally{try{d&&!d.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}return s.join("\n")}(1,this)];console.log(e.join("\n"))},e._None=new(function(e){function t(){return e.call(this,null)||this}return i(t,e),t.prototype.stop=function(){},t.prototype.branch=function(){return this},t}(e)),e}();t.DisposeTrace=c},"81cf3de5f1":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));class r{static hasMetadata(e,t){return!!t[e]}static getDepsMetadata(e,t){return t[e]}static setDepsMetadata(e,t,n){n[e]=t}static getMethodMetadata(e,t){return t[e]}static setMethodMetadata(e,t,n){n[e]=t}}},"88476f9607":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisposableStore=void 0;var r=n("6cac31cea5"),i=n("6bb936b136"),o=function(){function e(){this.toDisposeSet=new Set,this.isDisposeState=!1}return e.prototype.dispose=function(e){if(!this.isDisposeState)if(i.markTracked(this),this.isDisposeState=!0,e)this.clear(e);else{var t=r.DisposeTrace.traceRoot(this.constructor.name);this.clear(t),t.stop()}},e.prototype.clear=function(e){this.toDisposeSet.forEach((function(t){var n=t.disposableId||t.constructor.name;t.dispose(null==e?void 0:e.branch(n))})),this.toDisposeSet.clear()},e.prototype.add=function(t){if(!t)return t;if(t===this)throw new Error("Cannot register a disposable on itself!");return i.markTracked(t),this.isDisposeState?e.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this.toDisposeSet.add(t),t},e.DISABLE_DISPOSED_WARNING=!1,e}();t.DisposableStore=o},"8a015847e6":function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o}));var r,i=n("4f04e6c8a0");!function(e){e[e.POST_CONSTRUCTOR=0]="POST_CONSTRUCTOR"}(r||(r={}));const o=Object(i.a)("IInstantiationService")},"9b00d9b77e":function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n("0368aca230"),i=n("a282565e4f"),o=n("8a015847e6"),a=n("48a9511069");class s{constructor(e){this.instantiationHook=new a.a,this.selfInstantiationService=e}createInstance(e,t){if(this.instance)return this.instance;const n=this.loaderInstantiationService().createInstance(e,...t);return this.executeHooks(n,o.a.POST_CONSTRUCTOR),this.instance=n,Object(r.tryToMarkDispose)(n),n}loaderInstantiationService(){const e=this.getInstantion()||s.staticInstantiationService;if(e&&e!==this.selfInstantiationService){let t=!0;if(e.getHierarchyNode().walkUp((e=>{t&&e===this.selfInstantiationService&&(t=!1)})),t)throw new Error(i.m)}return e||this.selfInstantiationService}getInstantion(){return null}addHook(e,t){this.instantiationHook.addHook(e,t)}executeHooks(e,t){this.instantiationHook.executeHooks(e,t)}static initStaticInstantiationService(e){if(s.staticInstantiationService)throw new Error(i.n);s.staticInstantiationService=e}dispose(e){var t,n;this.instance&&(Object(r.isDisposable)(this.instance)&&(e&&e.branch(`${(null===(n=null===(t=this.instance)||void 0===t?void 0:t.constructor)||void 0===n?void 0:n.name)||""}instance`),this.instance.dispose(e)),this.instance=null)}}},a1644e2245:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i}));const r="di:ctor_deps",i="di:post_constructor"},a282565e4f:function(e,t,n){"use strict";n.d(t,"k",(function(){return r})),n.d(t,"f",(function(){return i})),n.d(t,"b",(function(){return o})),n.d(t,"s",(function(){return a})),n.d(t,"a",(function(){return s})),n.d(t,"i",(function(){return c})),n.d(t,"j",(function(){return u})),n.d(t,"h",(function(){return d})),n.d(t,"o",(function(){return l})),n.d(t,"l",(function(){return p})),n.d(t,"e",(function(){return h})),n.d(t,"d",(function(){return f})),n.d(t,"p",(function(){return v})),n.d(t,"q",(function(){return y})),n.d(t,"g",(function(){return b})),n.d(t,"r",(function(){return _})),n.d(t,"m",(function(){return m})),n.d(t,"n",(function(){return g})),n.d(t,"c",(function(){return O}));const r="Metadata must be applied to the parameters of a class constructor",i=(...e)=>`Metadata key was used more than once for parameter of class ${e[0]} in position ${e[1]}, already has metadata: [${e[2]}], newly add metadata: [${e[3]}]`,o=(...e)=>`Ambiguous override for serviceIdentifier: ${e[0]}`,a=(...e)=>`Should not update identifier ${e[0]} holder's descriptor, when ${e[1]} already has a instance`,s=(...e)=>`Ambiguous match found for serviceIdentifier: ${e[0]}`,c="Illegal hierarchy state: elder border is duplicated",u="Illegal merge state: cannot merge a node with a parent to anther node",d="Illegal parent state: there is already a parent node",l=(...e)=>`Warning: try to override service [${e[0]}], which with no supportsOverride options`,p=(...e)=>`[invokeFunction] get unknown service '${e[0]}'`,h=(...e)=>`Service ${e[0]} depends on unknown service ${e[1]}`,f=(...e)=>`IllegalState: creating unknown service instance ${e[0]}`,v=(...e)=>`IllegalState: resolve unknown service instance ${e[0]}`,y="Cyclic dependency between services",b="May detected cyclic dependency in graph",_=(...e)=>`@ServiceName decorator [${e[0]}] can only be used to decorate constructor parameter`,m="Illegal state: getInstantion return orphan InstantiationService",g="Illegal state: staticInstantiationService of LoaderBase can only be set once",O=(...e)=>`CreateInstance ${e[0]} depends on ${e[1]} which is NOT registered`},a71e91f775:function(e,t,n){var r,i,o=n("bca278778b"),a=n("09eb40a269"),s=0,c=0;e.exports=function(e,t,n){var u=t&&n||0,d=t||[],l=(e=e||{}).node||r,p=void 0!==e.clockseq?e.clockseq:i;if(null==l||null==p){var h=o();null==l&&(l=r=[1|h[0],h[1],h[2],h[3],h[4],h[5]]),null==p&&(p=i=16383&(h[6]<<8|h[7]))}var f=void 0!==e.msecs?e.msecs:(new Date).getTime(),v=void 0!==e.nsecs?e.nsecs:c+1,y=f-s+(v-c)/1e4;if(y<0&&void 0===e.clockseq&&(p=p+1&16383),(y<0||f>s)&&void 0===e.nsecs&&(v=0),v>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");s=f,c=v,i=p;var b=(1e4*(268435455&(f+=122192928e5))+v)%4294967296;d[u++]=b>>>24&255,d[u++]=b>>>16&255,d[u++]=b>>>8&255,d[u++]=255&b;var _=f/4294967296*1e4&268435455;d[u++]=_>>>8&255,d[u++]=255&_,d[u++]=_>>>24&15|16,d[u++]=_>>>16&255,d[u++]=p>>>8|128,d[u++]=255&p;for(var m=0;m<6;++m)d[u+m]=l[m];return t||a(d)}},a73d724fe4:function(e,t,n){"use strict";n.d(t,"a",(function(){return j}));var r=n("0368aca230"),i=n("a282565e4f");class o{constructor(e){this.incoming=new Map,this.outgoing=new Map,this.data=e}}class a{constructor(e){this.identifier=e,this.innerNodes=new Map}roots(){const e=[];return this.innerNodes.forEach((t=>{0===t.outgoing.size&&e.push(t)})),e}insertEdge(e,t){const n=this.lookupOrInsertNode(e),r=this.lookupOrInsertNode(t);n.outgoing.set(this.identifier.hashId(t),r),r.incoming.set(this.identifier.hashId(e),n)}removeNode(e){const t=this.identifier.hashId(e);this.innerNodes.delete(t),this.innerNodes.forEach((e=>{e.outgoing.delete(t),e.incoming.delete(t)}))}lookupOrInsertNode(e){const t=this.identifier.hashId(e);let n=this.innerNodes.get(t);return n||(n=new o(e),this.innerNodes.set(t,n)),n}lookup(e){return this.innerNodes.get(this.identifier.hashId(e))}isEmpty(){return 0===this.innerNodes.size}dfs(e,t){const n=this.clone(),r=[],o=n.innerNodes.get(n.identifier.hashId(e));if(!o)return;r.push(o);let a=0;for(;r.length;){if(a>1e4)throw new Error(i.g);a+=1;const e=r[r.length-1];e.outgoing.forEach((e=>{r.push(e)})),e.outgoing.size||(n.lookup(e.data)&&(t(e.data),n.removeNode(e.data)),r.pop())}}clone(){const e=new a(this.identifier);return this.innerNodes.forEach((t=>{t.outgoing.forEach((n=>{e.insertEdge(t.data,n.data)}))})),e}toString(){const e=[];return this.innerNodes.forEach((t=>{const n=this.identifier.hashString(t.data),r=[];t.incoming.forEach((e=>{r.push(this.identifier.hashString(e.data))}));const i=[];t.outgoing.forEach((e=>{i.push(this.identifier.hashString(e.data))})),e.push(`${n}, (incoming)[${r.join(", ")}], (outgoing)[${i.join(", ")}]`)})),e.join("\n")}}var s=n("f6998d6780"),c=n("0b588a7d4e"),u=n("8a015847e6"),d=n("d63229afdc");class l{constructor(e){this.didRun=!1,this.executor=()=>{try{this.innerValue=e()}catch(e){this.innerError=e}finally{this.didRun=!0}}}get value(){if(this.didRun||this.executor(),this.innerError)throw this.innerError;return this.innerValue}dispose(e){this.innerValue&&Object(r.isDisposable)(this.innerValue)&&this.innerValue.dispose(e)}}var p=n("af75a08457");let h=!1;class f{constructor(e,t){this.type=e,this.name=t,this._start=Date.now(),this._dep=[]}static traceInvocation(e){return h?new f(1,e.name||e.toString().substring(0,42).replace(/\n/g,"")):f._None}static traceCreation(e){return h?new f(0,e.name):f._None}static traverse(e,t,n=!1){if(!h)return n;let r=n;return null==e||e._dep.forEach(((n,i)=>{const[o,a,s]=n;o===t?!0===r&&!0===a?e._dep[i]=[o,!1,new f(2,o.toString())]:(r=!0,(null==s?void 0:s._dep)&&(null==s?void 0:s._dep.length)>0&&(r=f.traverse(s,t,r))):(null==s?void 0:s._dep)&&(null==s?void 0:s._dep.length)>0&&(r=f.traverse(s,t,r))})),r}branch(e,t){const n=new f(2,e.toString());return this._dep.push([e,t,n]),n}stop(){const e=Date.now()-this._start;f._totals+=e;let t=!1;const n=[`${0===this.type?"CREATE":"CALL"} ${this.name}`,`${function e(n,r){const i=[],o=new Array(n+1).join("\t");for(const[a,s,c]of r._dep)if(s&&c){t=!0,i.push(`${o}CREATES -> ${Object(p.a)(a)}`);const r=e(n+1,c);r&&i.push(r)}else i.push(`${o}uses -> ${Object(p.a)(a)}`);return i.join("\n")}(1,this)}`,`DONE, took ${e.toFixed(2)}ms (grand total ${f._totals.toFixed(2)}ms)`];(e>2||t)&&console.log(n.join("\n"))}}f._None=new class extends f{constructor(){super(-1,null)}stop(){}branch(){return this}},f._totals=0;var v=n("a1644e2245"),y=n("81cf3de5f1"),b=n("fda8d8987d");class _{static addServiceDependencies(e,t,n){Object(b.a)(v.a,e,void 0,t,n)}static getServiceDependencies(e){const t=[],n=y.a.getDepsMetadata(v.a,e);return n?(Object.keys(n).forEach((e=>{const r=n[e];r[1]?t.push({id:r[1].serviceIdentifier,index:parseInt(e,10),query:r[1]}):r[0]&&t.push({id:r[0],index:parseInt(e,10),query:{serviceIdentifier:r[0]}})})),t):t}}class m{constructor(e){this.children=new Set,this.isElderBrother=!1,this.self=e}static linkParentAndChild(e,t){e.addChild(t),t.attachToParent(e)}static linkSibling(e,t){e.addAsRightSibling(t),t.addAsLeftSibling(e)}attachToParent(e,t=!1){if(this.parent&&!t)throw new Error(i.h);this.parent=e}getParent(){return this.parent}addChild(e){this.children.has(e)||this.children.add(e)}walkUp(e){this.walkSiblings((t=>{e(t.getSelfNode())}));const t=this.getElderBrother().getParent();t&&t.walkUp(e)}walkDown(e){this.walkSiblings((t=>{e(t.getSelfNode())}));const t=this.getElderBrother().getChildren();t.size>0&&t.forEach((t=>t.walkDown(e)))}mergeTo(e){if(this.getParent())throw new Error(i.j);const t=e.getElderBrother();this.walkSiblings((e=>{e.setElderBrother(!1),e.getChildren().forEach((e=>{e.attachToParent(t,!0),t.addChild(e)})),e.removeChildren()}));const n=e.getRightTailSiblingNode();e.getRightTailSiblingNode().addAsRightSibling(this.getLeftHeadSiblingNode()),this.getLeftHeadSiblingNode().addAsLeftSibling(n)}getChildren(){return this.children}removeChildren(){this.children.clear()}addAsLeftSibling(e){if(this.leftSibling){const t=this.getLeftHeadSiblingNode();null==t||t.addAsLeftSibling(e)}else this.leftSibling=e}addAsRightSibling(e){if(this.rightSibling){this.getRightTailSiblingNode().addAsRightSibling(e)}else this.rightSibling=e}getLeftSibling(){return this.leftSibling}getRightSibling(){return this.rightSibling}isSelfElder(){return this.isElderBrother}setElderBrother(e){this.isElderBrother=e}getSelfNode(){return this.self}getLeftHeadSiblingNode(){let e=this.getLeftSibling();if(!e)return this;for(;null==e?void 0:e.getLeftSibling();)e=null==e?void 0:e.getLeftSibling();return e||this}getRightTailSiblingNode(){let e=this.getRightSibling();if(!e)return this;for(;null==e?void 0:e.getRightSibling();)e=null==e?void 0:e.getRightSibling();return e||this}getElderBrother(){let e;return this.walkSiblings((t=>{if(t.isSelfElder()||t.getParent()){if(e)throw new Error(i.i);e=t}})),e||this}walkSiblings(e){e(this);let t=this.leftSibling;for(;t;)e(t),t=t.getLeftSibling();let n=this.rightSibling;for(;n;)e(n),n=n.getRightSibling()}}var g=n("9b00d9b77e"),O=n("b8f805ddc2");const w="undefined"!=typeof Proxy;class j{constructor(e=new d.a,t=!1,n){if(this.hookRegistry=new Map,this.commonHookList=[],this.innerService=e,this.strictMode=t,this.innerService.set(u.b,this),this.hierarchyNode=new m(this),n){const e=n.getHierarchyNode();m.linkParentAndChild(e,this.hierarchyNode)}}getHierarchyNode(){return this.hierarchyNode}createChild(e){return new j(e,this.strictMode,this)}addChild(e){m.linkParentAndChild(this.hierarchyNode,e.getHierarchyNode())}attachToParent(e){m.linkParentAndChild(e.getHierarchyNode(),this.hierarchyNode)}getParent(){var e;return null===(e=this.hierarchyNode.getParent())||void 0===e?void 0:e.getSelfNode()}addService(e,t,n){n?this.innerService.setMulti(e,t):this.innerService.set(e,t)}createInstance(e,...t){let n,r;return e instanceof s.a?(n=f.traceCreation(e.ctor),r=this.resolveAndCreateInstance(e.ctor,e.staticArguments.concat(t),n)):(n=f.traceCreation(e),r=this.resolveAndCreateInstance(e,t,n)),n.stop(),r}invokeFunction(e,...t){const n=f.traceInvocation(e);try{return e({get:e=>{const t={serviceIdentifier:e,isMultiInject:!0},r=this.getOrCreateServiceInstance(t,n);if(!r)throw new Error(Object(i.l)(Object(p.a)(e)));return r},getAll:e=>{const t={serviceIdentifier:e,isMultiInject:!0},r=this.getOrCreateServiceInstances(t,n);if(!r)throw new Error(Object(i.l)(Object(p.a)(e)));return r}},...t)}finally{n.stop()}}dispose(e,t=!1){const n=e||r.DisposeTrace.traceRoot("IInstantiationService");this.innerService.teardown((e=>e&&!(e instanceof j)),(e=>!(e instanceof g.a)),(e=>!(e instanceof j)),n),t||this.hierarchyNode.walkDown((e=>{e!==this&&e.dispose(n.branch("IInstantiationService"),!0)})),this.hookRegistry.clear(),this.commonHookList=[],!e&&n&&n.stop()}has(e){let t=!1;return this.hierarchyNode.walkUp((n=>{t||(t=n.innerService.has(e))})),t}getClass(e){let t;return this.hierarchyNode.walkUp((n=>{var r;if(!t){const i=n.innerService.getHolder({serviceIdentifier:e});t=null===(r=null==i?void 0:i.descriptor)||void 0===r?void 0:r.ctor}})),t}addHook(e,t,n){return this.addServiceHook(e,t,n)}addCommonHook(e,t,n){this.commonHookList.push({hookPoint:e,callback:t,filter:n})}mergeTo(e){this.hierarchyNode.mergeTo(e.getHierarchyNode())}addServiceHook(e,t,n){let r=!1;return this.hierarchyNode.walkUp((i=>{if(!r&&i.innerService.has(t)){const o=i.innerService.getAllHolder({serviceIdentifier:t,isMultiInject:!0});null==o||o.forEach((t=>{t.instance&&Object(O.d)(t.instance)&&Object(O.a)(t.instance,e,n)}));i.innerService.getMapping().getMapping(t).forEach((t=>{if(t&&"string"!=typeof t){const o=i.hookRegistry.get(t)||[];o.push({hookPoint:e,callback:n}),i.hookRegistry.set(t,o),r=!0}}))}})),r}resolveAndCreateInstance(e,t=[],n){var r;const o=_.getServiceDependencies(e).sort(((e,t)=>e.index-t.index)),a=[];for(const t of o){const o=t.query.isMultiInject?this.getOrCreateServiceInstances(t.query,n):this.getOrCreateServiceInstance(t.query,n);if(!o&&this.strictMode&&!(null===(r=null==t?void 0:t.query)||void 0===r?void 0:r.isOption))throw new Error(Object(i.e)(e.name,Object(p.a)(t.id)));a.push(o)}const s=new e(...[...this.alignArgs(t,o),...a]);return this.executePostDecorator(e,s),this.executePostHooks(e,s),this.executeCommonPostHooks(s),s}executePostHooks(e,t){const n=this.hookRegistry.get(e);n&&n.forEach((e=>{const{hookPoint:n,callback:r}=e;n===u.a.POST_CONSTRUCTOR&&(t&&Object(O.d)(t)?Object(O.a)(t,n,r):r(t))}))}executeCommonPostHooks(e){this.hierarchyNode.walkDown((t=>{t.commonHookList.forEach((t=>{const{hookPoint:n,callback:r,filter:i}=t;n===u.a.POST_CONSTRUCTOR&&(i&&!i(e)||r(e))}))}))}executePostDecorator(e,t){const n=Object(O.c)(e);n&&t[n].call(t)}alignArgs(e,t){let n=e;const r=t.length>0?t[0].index:e.length;if(e.length!==r){const t=r-e.length;n=t>0?e.concat(new Array(t)):e.slice(0,r)}return n}tryToCacheServiceInstance(e,t){return(null==e?void 0:e.descriptor)instanceof s.a&&(e.instance=t,!0)}getServiceInstanceOrDescriptor(e){let t;return this.hierarchyNode.walkUp((n=>{t||(t=n.innerService.getHolder(e))})),t}getAllServiceInstanceOrDescriptors(e){let t;return this.hierarchyNode.walkUp((n=>{t||(t=n.innerService.getAllHolder(e))})),t}createAndCacheServiceInstance(e,t,n){const r=this.resolveDependencyGraph(e,t,n);return this.createServiceInstanceFromGraph(r)}resolveDependencyGraph(e,t,n){var r;const o=new a({hashId:e=>e.query.serviceIdentifier,hashString:e=>Object(p.a)(e.query.serviceIdentifier)});let s=0;const u=[{query:e,descriptor:t,trace:n}];for(;u.length;){const t=u.pop();if(o.lookupOrInsertNode(t),s>1e3)throw new c.a(o);s+=1;const n=_.getServiceDependencies(t.descriptor.ctor);for(const a of n){const n=this.getAllServiceInstanceOrDescriptors(a.query);n||(null===(r=null==a?void 0:a.query)||void 0===r?void 0:r.isOption)||console.warn(Object(i.c)(Object(p.a)(e.serviceIdentifier),Object(p.a)(a.id)));const s=null==n?void 0:n.filter((e=>e.descriptor));if(s&&(null==s?void 0:s.length)>0&&s[0].descriptor){const e={query:a.query,descriptor:s[0].descriptor,trace:t.trace.branch(a.id,!0)};o.insertEdge(t,e),u.push(e)}}}return o}createServiceInstanceFromGraph(e){let t,n;for(;;){const r=e.roots();if(0===r.length){if(!e.isEmpty())throw new c.a(e);break}for(const{data:i}of r)n=i.descriptor.ctor,t=this.createServiceInstanceWithOwner(i.query,i.descriptor.ctor,i.descriptor.staticArguments,i.descriptor.supportsDelayedInstantiation,i.trace),e.removeNode(i)}if(!t)throw new Error(Object(i.p)(null==n?void 0:n.name));return t}getOrCreateServiceInstance(e,t){var n;const r=this.getServiceInstanceOrDescriptor(e);return!(null==r?void 0:r.instance)&&(null==r?void 0:r.descriptor)?this.createAndCacheServiceInstance(e,r.descriptor,t.branch(e.serviceIdentifier,!0)):(f.traverse(t,e.serviceIdentifier,!1)||t.branch(e.serviceIdentifier,!1),null!==(n=null==r?void 0:r.instance)&&void 0!==n?n:void 0)}getOrCreateServiceInstances(e,t){const n=this.getAllServiceInstanceOrDescriptors(e),r=[];return null==n||n.forEach((n=>{if(n.instance)r.push(n.instance);else if(n.descriptor){const i=this.createAndCacheServiceInstance(e,n.descriptor,t.branch(e.serviceIdentifier,!0));r.push(i)}f.traverse(t,e.serviceIdentifier,!1)||t.branch(e.serviceIdentifier,!1)})),r||void 0}createServiceInstanceWithOwner(e,t,n=[],r,o){let a;if(this.hierarchyNode.walkUp((i=>{var s;if(a)return;const c=i.innerService.getAllHolder(e,(e=>{var n;return(null===(n=e.descriptor)||void 0===n?void 0:n.ctor)===t})),u=null==c?void 0:c[0];a=null!==(s=null==u?void 0:u.instance)&&void 0!==s?s:void 0,a||(null==u?void 0:u.descriptor)&&(a=i.createServiceInstance(t,n,r,o),this.tryToCacheServiceInstance(u,a))})),a)return a;throw new Error(Object(i.d)(t.name))}createServiceInstance(e,t=[],n,r){if(!n||!w)return this.resolveAndCreateInstance(e,t,r);const i=new l((()=>this.resolveAndCreateInstance(e,t,r)));return new Proxy(Object.create(null),{get(e,t){if(t in e)return e[t];const n=i.value;let r=n[t];return"function"!=typeof r||(r=r.bind(n),e[t]=r),r},set:(e,t,n)=>(i.value[t]=n,!0)})}}},ab14ea14de:function(e,t,n){var r=n("bca278778b"),i=n("09eb40a269");e.exports=function(e,t,n){var o=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||r)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var s=0;s<16;++s)t[o+s]=a[s];return t||i(a)}},af75a08457:function(e,t,n){"use strict";function r(e){return"function"==typeof e?"function"==typeof e.toLegacyString?e.toLegacyString():e.name:String(e)}n.d(t,"a",(function(){return r}))},b8f805ddc2:function(e,t,n){"use strict";n.d(t,"b",(function(){return d})),n.d(t,"c",(function(){return l})),n.d(t,"d",(function(){return p})),n.d(t,"a",(function(){return h}));var r=n("a1644e2245"),i=n("81cf3de5f1"),o=n("9b00d9b77e"),a=n("d7c625d1f2"),s=n("8a015847e6"),c=n("48a9511069");let u=class{constructor(e=[],t){this.instantiationService=t,this.instantiationHook=new c.a,this.params=e}getNewInstance(e){const t=e||(this.params.length>0?this.params:[]),n=this.getCtor(),r=this.instantiationService.createInstance(n,...t);return this.executeHooks(r,s.a.POST_CONSTRUCTOR),r}addHook(e,t){this.instantiationHook.addHook(e,t)}executeHooks(e,t){this.instantiationHook.executeHooks(e,t)}};function d(e,t,n=((e,t)=>e===t)){if(e===t)return!0;if(!e||!t)return!1;if(e.length!==t.length)return!1;for(let r=0,i=e.length;r<i;r++)if(!n(e[r],t[r]))return!1;return!0}function l(e){const t=i.a.getMethodMetadata(r.b,e);if(t)return t.methodName}function p(e){return e instanceof o.a||e instanceof u}function h(e,t,n){(e instanceof o.a||e instanceof u)&&e.addHook(t,n)}u=Object(a.__decorate)([Object(a.__param)(1,s.b)],u)},bc0c4da4ca:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tryToMarkDispose=t.tryToDispose=t.toDisposable=t.combinedDisposable=t.dispose=t.isDisposable=void 0;var r=n("6cac31cea5"),i=n("6bb936b136");function o(e){return"function"==typeof e.dispose&&(0===e.dispose.length||1===e.dispose.length)}function a(e,t){if(Array.isArray(e)){var n=t||r.DisposeTrace.traceRoot("disposables");return e.forEach((function(e){e&&(i.markTracked(e),e.dispose(n))})),n.stop(),[]}if(e){var o=t||r.DisposeTrace.traceRoot("disposables");return i.markTracked(e),e.dispose(o),o.stop(),e}}t.isDisposable=o,t.dispose=a,t.combinedDisposable=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.forEach(i.markTracked),i.trackDisposable({dispose:function(t){return a(e,t)}})},t.toDisposable=function(e,t){void 0===t&&(t="");var n=i.trackDisposable({dispose:function(t){i.markTracked(n),e(t)},disposableId:t});return n},t.tryToDispose=function(e,t){e&&o(e)&&e.dispose(t)},t.tryToMarkDispose=function(e){o(e)&&i.markTracked(e)}},bca278778b:function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);e.exports=function(){return n(r),r}}else{var i=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}},ca13d5cafb:function(e,t,n){var r=n("a71e91f775"),i=n("ab14ea14de"),o=i;o.v1=r,o.v4=i,e.exports=o},d11cf19c18:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isCancellationToken=t.CancellationTokenState=void 0;var r=function(){function e(){}return e.None=Object.freeze({isCancellationRequested:!1}),e.Cancelled=Object.freeze({isCancellationRequested:!0}),e}();t.CancellationTokenState=r,t.isCancellationToken=function(e){return e===r.None||e===r.Cancelled||!(!e||"object"!=typeof e)&&"boolean"==typeof e.isCancellationRequested}},d5bac86374:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("f6998d6780");class i{constructor(){this.innerRegistry=[],this.innerMultiRegistry=[]}register(e,t,n,i){this.innerRegistry.push([e,new r.a(t,n,i)])}registerValue(e,t){this.innerRegistry.push([e,t])}registerMulti(e,t,n,i){this.innerMultiRegistry.push([e,new r.a(t,n,i)])}registerMultiValue(e,t){this.innerMultiRegistry.push([e,t])}getServiceDescriptors(){return this.innerRegistry}getMulServiceDescriptor(){return this.innerMultiRegistry}}},d63229afdc:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n("0368aca230"),i=n("f6998d6780"),o=n("0b588a7d4e"),a=n("af75a08457"),s=n("ca13d5cafb"),c=n("a282565e4f");class u{constructor(){this.identifierMap=new Map,this.serviceKeyMap=new Map}getMapping(e){const t=this.identifierMap.get(e),n=[];return null==t||t.forEach((e=>{this.serviceKeyMap.get(e)&&n.push(e)})),void 0===t&&"function"==typeof e&&"function"!=typeof e.toLegacyString&&this.serviceKeyMap.get(e)&&n.push(e),n}deleteMapping(e){this.identifierMap.forEach((t=>{const n=t.indexOf(e);n>=0&&(t.splice(n,1),this.serviceKeyMap.delete(e))}))}clear(){this.identifierMap.clear(),this.serviceKeyMap.clear()}dispose(){this.clear()}generateServiceKey(e,t,n=!1){return t instanceof i.a?this.generateDescriptorKey(e,t,n):this.generateValueInstanceKey(e,t,n)}generateValueInstanceKey(e,t,n=!1){if(n){const n=this.createRandomValueKey(t);return this.addMapping(e,t,{valueId:n}),n}const r=this.getMapping(e);if(0===r.length){const n=this.createRandomValueKey(t);return this.addMapping(e,t,{valueId:n}),n}if(1===r.length){const n=r[0],i=this.serviceKeyMap.get(n);if(null==i?void 0:i.override){this.deleteMappingById(e,n);const r=this.createRandomValueKey(t);return this.addMapping(e,t,{valueId:r}),r}return r[0]}throw new Error(Object(c.b)(Object(a.a)(e)))}generateDescriptorKey(e,t,n=!1){const r=this.getMapping(e);if(n)return(null==r?void 0:r.includes(t))||this.addMapping(e,t.ctor),t.ctor;if(0===r.length)return this.addMapping(e,t.ctor,{override:t.supportsOverride}),t.ctor;if(1===r.length){const n=r[0],i=this.serviceKeyMap.get(n);return(null==i?void 0:i.override)&&t.ctor!==n?(this.deleteMappingById(e,n),this.addMapping(e,t.ctor,{override:t.supportsOverride}),t.ctor):r[0]}throw new Error(Object(c.b)(Object(a.a)(e)))}addMapping(e,t,n){const r=this.identifierMap.get(e);if(null==n?void 0:n.valueId){const{valueId:t}=n;r?r.push(t):this.identifierMap.set(e,[t]),this.serviceKeyMap.set(t,{serviceKey:t})}else r?r.push(t):this.identifierMap.set(e,[t]),this.serviceKeyMap.set(t,{serviceKey:t,override:null==n?void 0:n.override})}createRandomValueKey(e){return`${e.constructor.name}@${Object(s.v4)()}`}deleteMappingById(e,t){let n=0;if(this.identifierMap.forEach((e=>{e.indexOf(t)>=0&&(n+=1)})),0===n)return;const r=this.identifierMap.get(e);if(r&&r.length){const e=r.indexOf(t);e>=0&&r.splice(e,1),1===n&&this.serviceKeyMap.delete(t)}}}class d{constructor(...e){this.innerEntries=new Map,this.keyMapping=new u;for(const[t,n]of e)this.set(t,n)}set(e,t){const n=this.keyMapping.generateServiceKey(e,t),r=this.innerEntries.get(n);r?t instanceof i.a?this.overrideExistServiceHolder(e,r,t):this.setHolderInstance(n,r,t):this.createNewServiceHolder(n,t)}setMulti(e,t){const n=this.keyMapping.generateServiceKey(e,t,!0);if(!this.innerEntries.get(n)){const e=this.createNewHolderByCondition(t);this.innerEntries.set(n,e)}}has(e){return!!this.keyMapping.getMapping(e).find((e=>this.innerEntries.has(e)))}get(e){const t=this.keyMapping.getMapping(e);if(0===t.length)return;if(t.length>1)throw new Error(Object(c.a)(Object(a.a)(e)));const n=this.innerEntries.get(t[0]);return(null==n?void 0:n.instance)||(null==n?void 0:n.descriptor)||void 0}getAllHolder(e,t){const n=this.keyMapping.getMapping(e.serviceIdentifier),r=[];return n.forEach((e=>{const t=this.innerEntries.get(e);t&&(null==r||r.push(t))})),t?null==r?void 0:r.filter(((e,n)=>t(e,n))):r.length>0?r:void 0}getHolder(e){const t=this.keyMapping.getMapping(e.serviceIdentifier);if(0===t.length)return;if(t.length>1)throw new Error(Object(c.a)(Object(a.a)(e.serviceIdentifier)));return this.innerEntries.get(t[0])}getMapping(){return this.keyMapping}teardown(e,t,n,i){this.innerEntries.forEach(((o,s)=>{const{instance:c,descriptor:u}=o;(null==e?void 0:e(c))&&Object(r.tryToDispose)(c,null==i?void 0:i.branch(Object(a.a)(s))),u&&c&&(null==t?void 0:t(c))&&(o.instance=null),!u&&c&&(null==n?void 0:n(c))&&(this.innerEntries.delete(s),this.keyMapping.deleteMapping(s))}))}createNewServiceHolder(e,t){const n=this.createNewHolderByCondition(t);this.innerEntries.set(e,n)}overrideExistServiceHolder(e,t,n){var r,i,o;if(null===(r=t.descriptor)||void 0===r?void 0:r.supportsOverride){const t=this.keyMapping.generateServiceKey(e,n),r=this.createHolderInstance(null,n);this.innerEntries.set(t,r)}else{if(t.instance)throw new Error(Object(c.s)(Object(a.a)(e),null===(o=t.descriptor)||void 0===o?void 0:o.ctor.name));(null===(i=t.descriptor)||void 0===i?void 0:i.isEqualWith(n))||console.warn(Object(c.o)(Object(a.a)(e)))}}setHolderInstance(e,t,n){Object(r.tryToMarkDispose)(n),t.instance=n,this.innerEntries.set(e,t)}createNewHolderByCondition(e){if(e instanceof i.a){return this.createHolderInstance(null,e)}Object(r.tryToMarkDispose)(e);return this.createHolderInstance(e,null)}createHolderInstance(e,t){return new o.b(e,t)}}},dfdd551bdc:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CancellationTokenSource=void 0;var r=n("d11cf19c18"),i=function(){function e(){this.isCancelled=!1}return e.prototype.cancel=function(){this.isCancelled||(this.isCancelled=!0)},Object.defineProperty(e.prototype,"isCancellationRequested",{get:function(){return this.isCancelled},enumerable:!1,configurable:!0}),e}(),o=function(){function e(){this.innertoken=void 0}return Object.defineProperty(e.prototype,"token",{get:function(){return this.innertoken||(this.innertoken=new i),this.innertoken},enumerable:!1,configurable:!0}),e.prototype.cancel=function(){this.innertoken?this.innertoken instanceof i&&this.innertoken.cancel():this.innertoken=r.CancellationTokenState.Cancelled},e.prototype.dispose=function(){this.cancel()},e}();t.CancellationTokenSource=o},f6998d6780:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("b8f805ddc2");class i{constructor(e,t=[],n=!1,r=!1){this.ctor=e,this.staticArguments=t,this.supportsDelayedInstantiation=n,this.supportsOverride=r}isEqualWith(e){return this.ctor===e.ctor&&(this.supportsDelayedInstantiation===e.supportsDelayedInstantiation&&(this.supportsOverride===e.supportsOverride&&!!Object(r.b)(this.staticArguments,e.staticArguments)))}}},fda8d8987d:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n("81cf3de5f1"),i=n("af75a08457"),o=n("a282565e4f");function a(e,t,n,a,s){if(void 0!==n&&"number"==typeof s)throw new Error(o.k);const c=s.toString(),u=r.a.getDepsMetadata(e,t)||{},d=u[c];if(void 0!==(null==d?void 0:d[0])&&(null==d?void 0:d[0])!==a)throw new Error(Object(o.f)(t.name,c,Object(i.a)(d[0]),Object(i.a)(a)));d&&d[1]&&!d[1].serviceIdentifier?(d[0]=a,d[1].serviceIdentifier=a):void 0===d&&(u[c]=[a,{serviceIdentifier:a}],r.a.setDepsMetadata(e,u,t))}}}]);
//# sourceMappingURL=slide-commonAsync~08369118-11da16.js.map