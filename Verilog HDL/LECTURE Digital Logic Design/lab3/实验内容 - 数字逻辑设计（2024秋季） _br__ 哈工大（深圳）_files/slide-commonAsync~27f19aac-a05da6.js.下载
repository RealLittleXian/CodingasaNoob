(this.webpackJsonp=this.webpackJsonp||[]).push([["commonAsync~27f19aac"],{"0112351fbe":function(e,t,n){var r=n("1b4cdd6a36"),i=n("391b34a2ca"),o=n("23d625758e"),a=n("6ab2696dd0");function s(t){var n="function"==typeof Map?new Map:void 0;return e.exports=s=function(e){if(null===e||!o(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return a(e,arguments,r(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i(t,e)},e.exports.default=e.exports,e.exports.__esModule=!0,s(t)}e.exports=s,e.exports.default=e.exports,e.exports.__esModule=!0},"0881ac8476":function(e,t,n){"use strict";function r(e){return r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},r(e)}n.d(t,"a",(function(){return r}))},"08e718accf":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tryToMarkDispose=t.tryToDispose=t.toDisposable=t.combinedDisposable=t.dispose=t.isDisposable=void 0;var r=n("95b75d217e"),i=n("8838f60498");function o(e){return"function"==typeof e.dispose&&(0===e.dispose.length||1===e.dispose.length)}function a(e,t){if(Array.isArray(e)){var n=t||r.DisposeTrace.traceRoot("disposables");return e.forEach((function(e){e&&(i.markTracked(e),e.dispose(n))})),n.stop(),[]}if(e){var o=t||r.DisposeTrace.traceRoot("disposables");return i.markTracked(e),e.dispose(o),o.stop(),e}}t.isDisposable=o,t.dispose=a,t.combinedDisposable=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.forEach(i.markTracked),i.trackDisposable({dispose:function(t){return a(e,t)}})},t.toDisposable=function(e,t){void 0===t&&(t="");var n=i.trackDisposable({dispose:function(t){i.markTracked(n),e(t)},disposableId:t});return n},t.tryToDispose=function(e,t){e&&o(e)&&e.dispose(t)},t.tryToMarkDispose=function(e){o(e)&&i.markTracked(e)}},"094a0886cb":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QUIT_TYPE=void 0,function(e){e.INACTIVE="INACTIVE",e.LOGIN_INVALIDATE="LOGIN_INVALIDATE",e.LOGIN_FORBIDDEN="LOGIN_FORBIDDEN"}(t.QUIT_TYPE||(t.QUIT_TYPE={}))},"0a9f420ed3":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReceiverClient=void 0;var r=n("cdda668c2b"),i=n("49835f837f"),o=n("193c542c4e"),a=function(){function e(e){this.dependency=e,this.position=0,this.onceOpen=!1}return e.prototype.establishConnection=function(e){var t=this;try{!this.onceOpen&&this.checkConnectTimeoutTimer(),this.xmlHttpRequest=new XMLHttpRequest,this.position=0,this.xmlHttpRequest.onreadystatechange=function(){t.xmlHttpRequest.readyState===XMLHttpRequest.LOADING?(t.clearConnectTimoutTimer(!0),t.chunkParse(t.xmlHttpRequest.responseText)):t.xmlHttpRequest.readyState===XMLHttpRequest.DONE&&(t.clearConnectTimoutTimer(!0),t.closeConnection())},this.xmlHttpRequest.open("get",e),this.xmlHttpRequest.setRequestHeader("content-type","application/json"),this.xmlHttpRequest.send(),this.xmlHttpRequest.onerror=function(){r.ConnectionLog.info("bind/get onerror"),t.dependency.receive()}}catch(e){r.ConnectionLog.error("ReceiverClient XMLHttpRequest Error, error.message:"+(null==e?void 0:e.message)+",error.stack:"+(null==e?void 0:e.stack)),this.dependency.receive()}},e.prototype.abortConnection=function(){var e;null===(e=this.xmlHttpRequest)||void 0===e||e.abort()},e.prototype.chunkParse=function(e){for(var t=this.position,n=e.indexOf(i.DELIMITER,t);n>-1;){var r=e.substring(t,n);if(r&&(this.dependency.handleResponse(r),r.indexOf("connection closed")>-1))return void(this.position=0);t=n+i.DELIMITER.length,n=e.indexOf(i.DELIMITER,t)}this.position=t},e.prototype.closeConnection=function(){this.xmlHttpRequest.status!==XMLHttpRequest.UNSENT&&(this.xmlHttpRequest.status<200||this.xmlHttpRequest.status>=400?(r.ConnectionLog.info("closeConnection: "+this.xmlHttpRequest),this.dependency.receive()):this.chunkParse(this.xmlHttpRequest.responseText))},e.prototype.checkConnectTimeoutTimer=function(){var e=this;this.clearConnectTimoutTimer(!1),this.connectTimeoutTimer=setTimeout((function(){r.ConnectionLog.error("bind/get 12s 仍未收到回包"),e.dependency.disconnect({errCode:o.RoomErrorCode.BIG_COLLAB_CONNECT_TIMEOUT,shutDown:!0})}),12e3)},e.prototype.clearConnectTimoutTimer=function(e){e&&!this.onceOpen&&(this.onceOpen=!0),this.connectTimeoutTimer&&(window.clearTimeout(this.connectTimeoutTimer),this.connectTimeoutTimer=void 0)},e}();t.ReceiverClient=a},"1aefa30176":function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n("7f688d0e54");var i=n("c8a49606a0"),o=n("abe54d1ebc");function a(e,t){return Object(r.a)(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}}(e,t)||Object(i.a)(e,t)||Object(o.a)()}},"1d73a1ebc4":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisposableStore=void 0;var r=n("95b75d217e"),i=n("8838f60498"),o=function(){function e(){this.toDisposeSet=new Set,this.isDisposeState=!1}return e.prototype.dispose=function(e){if(!this.isDisposeState)if(i.markTracked(this),this.isDisposeState=!0,e)this.clear(e);else{var t=r.DisposeTrace.traceRoot(this.constructor.name);this.clear(t),t.stop()}},e.prototype.clear=function(e){this.toDisposeSet.forEach((function(t){var n=t.disposableId||t.constructor.name;t.dispose(null==e?void 0:e.branch(n))})),this.toDisposeSet.clear()},e.prototype.add=function(t){if(!t)return t;if(t===this)throw new Error("Cannot register a disposable on itself!");return i.markTracked(t),this.isDisposeState?e.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this.toDisposeSet.add(t),t},e.DISABLE_DISPOSED_WARNING=!1,e}();t.DisposableStore=o},"20ac6cdd89":function(e,t,n){"use strict";function r(e,t){return r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},r(e,t)}n.d(t,"a",(function(){return r}))},"23d625758e":function(e,t){e.exports=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")},e.exports.default=e.exports,e.exports.__esModule=!0},"250ab19a0a":function(e,t,n){"use strict";var r=n("69084d01d3"),i=Object(r.createContext)({});t.a=i},"271684415e":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAGE_UNLOAD_TIME=t.DEFAULT_MIN_TRY_COUNT=t.MAX_DELAY_TIME=t.DEFAULT_DELAY_TIME=void 0;t.DEFAULT_MIN_TRY_COUNT=1;t.DEFAULT_DELAY_TIME=0;t.PAGE_UNLOAD_TIME=3e3;t.MAX_DELAY_TIME=3e4},"2980634bca":function(e,t){e.exports=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i},e.exports.default=e.exports,e.exports.__esModule=!0},"37fb9478c3":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("20ac6cdd89");function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Object(r.a)(e,t)}},"3829c8d1f6":function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectStatusManager=void 0;var o=n("9ab1857893"),a=n("eba64b0be6"),s=n("46509843e6"),c=n("cdda668c2b"),u=i(n("751778941b")),d=n("147e28b86b"),l=i(n("6a0d65af8f")),f=function(){function e(e,t){this.options=e,this.dependency=t,this.onConnectEventEmitter=new o.Emitter,this.tag="ConnectStatusManager",this.connectStatus=s.ConnectStatus.INIT,this.onConnectEvent=this.onConnectEventEmitter.event,this.bigCollabLogin=new a.BigCollabLogin(this.options,r(r({},this.dependency),{connectStatusChange:this.connectStatusChange.bind(this)})),new l.default({disconnect:this.disconnect.bind(this)})}return e.prototype.dispose=function(){this.bigCollabLogin.dispose(),this.onConnectEventEmitter.dispose()},e.prototype.connect=function(){this.needLogin()?this.bigCollabLogin.login():c.ConnectionLog.warn(this.tag+" not connect. connectStatus:"+this.connectStatus)},e.prototype.isConnected=function(){return this.connectStatus===s.ConnectStatus.CONNECTED},e.prototype.reconnect=function(e){this.isDisconnected()?c.ConnectionLog.info(this.tag+" can not reconnect. connectStatus: disconnected"):(this.setConnnectStatus(s.ConnectStatus.WAIT_RECONNECTING),this.bigCollabLogin.relogin(e))},e.prototype.isDisconnected=function(){return this.connectStatus===s.ConnectStatus.DISCONNECT},e.prototype.disconnect=function(e){var t,n,r,i;if(c.ConnectionLog.info(this.tag+" disconnect errorCode:"+e.errCode+", reason:"+e.reason+" shutdown:"+e.shutDown),this.bigCollabLogin.unlogin(),e.shutDown)return this.bigCollabLogin.dispose(),this.setConnnectStatus(s.ConnectStatus.DISCONNECT),this.dependency.disconnect(e),void u.default.shutDownReport({module:this.options.module,attrName:String(null!==(t=e.errCode)&&void 0!==t?t:0),status:1,errorMessage:null!==(n=e.reason)&&void 0!==n?n:d.RoomUtil.getWebsocketChannelErrorMessage(null!==(r=e.errCode)&&void 0!==r?r:0)});this.bigCollabLogin.reset(),this.dependency.disconnect(e),u.default.reconnectReport({module:this.options.module,attrName:String(null!==(i=e.errCode)&&void 0!==i?i:0),errorMessage:e.reason,status:1}),this.reconnect(e.reconnectTime)},e.prototype.onConnectSuccess=function(){this.isConnected()||(this.setConnnectStatus(s.ConnectStatus.CONNECTED),this.dependency.connected())},e.prototype.connectStatusChange=function(e,t,n){this.setConnnectStatus(e,t),e===s.ConnectStatus.LOGIN_FAIL&&this.disconnect(null!=n?n:{shutDown:!1})},e.prototype.needLogin=function(){return[s.ConnectStatus.INIT,s.ConnectStatus.WAIT_RECONNECTING].includes(this.connectStatus)},e.prototype.setConnnectStatus=function(e,t){c.ConnectionLog.info(this.tag+" setConnnectStatus: oldState:"+this.connectStatus+", newStatus = "+e),e!==this.connectStatus&&(this.connectStatus=e,this.onConnectEventEmitter.fire({status:e,serverRequestParams:t}))},e}();t.ConnectStatusManager=f},"3ec7c50a43":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CancellationTokenSource=void 0;var r=n("5c54996c0f"),i=function(){function e(){this.isCancelled=!1}return e.prototype.cancel=function(){this.isCancelled||(this.isCancelled=!0)},Object.defineProperty(e.prototype,"isCancellationRequested",{get:function(){return this.isCancelled},enumerable:!1,configurable:!0}),e}(),o=function(){function e(){this.innertoken=void 0}return Object.defineProperty(e.prototype,"token",{get:function(){return this.innertoken||(this.innertoken=new i),this.innertoken},enumerable:!1,configurable:!0}),e.prototype.cancel=function(){this.innertoken?this.innertoken instanceof i&&this.innertoken.cancel():this.innertoken=r.CancellationTokenState.Cancelled},e.prototype.dispose=function(){this.cancel()},e}();t.CancellationTokenSource=o},"44f185c0a0":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BuildBigCollabChannel=t.BigCollabChannel=void 0;var r=n("cdda668c2b"),i=n("147e28b86b"),o=n("3829c8d1f6"),a=n("a5b778a02f"),s=function(){function e(e,t){this.tag="BigCollabChannel",this.connectStatusManager=new o.ConnectStatusManager(e,t),this.messageCenter=new a.MessageCenter(e,t,this.connectStatusManager)}return e.prototype.dispose=function(){this.connectStatusManager.dispose(),this.messageCenter.dispose()},e.prototype.connect=function(){r.ConnectionLog.info(this.tag+" connect"),this.connectStatusManager.connect()},e.prototype.isConnected=function(){return this.connectStatusManager.isConnected()},e.prototype.isDisconnected=function(){return this.connectStatusManager.isDisconnected()},e.prototype.disconnect=function(e){r.ConnectionLog.error(this.tag+" disconnect, shutdown:"+e.shutDown+", errCode:"+e.errCode+" reason:"+e.reason),this.connectStatusManager.disconnect(e)},e.prototype.sendMessage=function(e){var t,n=e.taskId,r=e.cmd,o=e.data;this.connectStatusManager.isConnected()?this.messageCenter.sendMessage(e):null===(t=e.onError)||void 0===t||t.call(e,n,r,o,{errCode:this.connectStatusManager.isDisconnected()?i.RoomErrorCode.ROOM_SHUTDOWN:i.RoomErrorCode.ROOM_STATE_ERR,errMsg:"can not send message in this room state."})},e.prototype.cancelSendMessageByTaskId=function(e){var t,n;null===(n=(t=this.messageCenter).cancelSendMessageByTaskId)||void 0===n||n.call(t,e)},e}();t.BigCollabChannel=s;t.BuildBigCollabChannel=function(e,t){return new s(e,t)}},"46509843e6":function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectStatus=void 0,function(e){e.INIT="INIT",e.LOGIN="LOGIN",e.LOGIN_FAIL="LOGIN_FAIL",e.LOGINED="LOGINED",e.CONNECTED="CONNECTED",e.DISCONNECT="DISCONNECT",e.WAIT_RECONNECTING="WAIT_RECONNECTING"}(r||(r={})),t.ConnectStatus=r},"49835f837f":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONNECT_DELAY_TIME=t.DELIMITER=t.ERROR_MESSAGE_INDEX=t.MAX_SERVER_REACHABLE_TIME=t.NOOP=t.PATH=void 0;t.PATH="/websocket/bind";t.NOOP="noop";t.DELIMITER="\r\n";t.MAX_SERVER_REACHABLE_TIME=45e3;t.CONNECT_DELAY_TIME=3e3;t.ERROR_MESSAGE_INDEX=[0,-1]},"5c54996c0f":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isCancellationToken=t.CancellationTokenState=void 0;var r=function(){function e(){}return e.None=Object.freeze({isCancellationRequested:!1}),e.Cancelled=Object.freeze({isCancellationRequested:!0}),e}();t.CancellationTokenState=r,t.isCancellationToken=function(e){return e===r.None||e===r.Cancelled||!(!e||"object"!=typeof e)&&"boolean"==typeof e.isCancellationRequested}},"5d1be1397d":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RetCode=t.HttpStatus=t.Method=void 0;var r,i=n("cf3c69206c");Object.defineProperty(t,"Method",{enumerable:!0,get:function(){return i.Method}}),Object.defineProperty(t,"HttpStatus",{enumerable:!0,get:function(){return i.HttpStatus}}),function(e){e[e.SUCCESS=0]="SUCCESS"}(r||(r={})),t.RetCode=r},"686df8963b":function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.MessageClassification=t.MessageSendType=void 0,function(e){e.SERIAL="SERIAL",e.PARALLEL="PARALLEL"}(r=t.MessageSendType||(t.MessageSendType={}));var i=function(){function e(e){void 0===e&&(e=[]),this.messageClassfyMap=new Map(e)}return e.prototype.setMessageSendType=function(e,t){this.messageClassfyMap.set(e,t)},e.prototype.getMessageSendType=function(e){var t;return null!==(t=this.messageClassfyMap.get(e))&&void 0!==t?t:r.SERIAL},e}();t.MessageClassification=i},"6a0d65af8f":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("193c542c4e"),i=n("271684415e"),o=function(){function e(e){var t=this;this.dependency=e,this.disconnect=function(){t.dependency.disconnect({reason:"close by client, beforeunload",shutDown:!1,errCode:r.RoomErrorCode.ROOM_CLOSE,reconnectTime:i.PAGE_UNLOAD_TIME})},this.addBeforeunloadListener(this.disconnect)}return e.prototype.addBeforeunloadListener=function(e){window.addEventListener("beforeunload",e)},e}();t.default=o},"6a0f504a4d":function(e,t,n){"use strict";var r=n("d8384ba8a0"),i=n("1aefa30176"),o=n("15c09bfd29"),a=n("d7383b8262"),s=n("69084d01d3"),c=n.n(s),u=n("1748118723"),d=n.n(u),l=n("250ab19a0a"),f=n("1e5dc01c04");function p(e,t){(function(e){return"string"==typeof e&&-1!==e.indexOf(".")&&1===parseFloat(e)})(e)&&(e="100%");var n=function(e){return"string"==typeof e&&-1!==e.indexOf("%")}(e);return e=360===t?e:Math.min(t,Math.max(0,parseFloat(e))),n&&(e=parseInt(String(e*t),10)/100),Math.abs(e-t)<1e-6?1:e=360===t?(e<0?e%t+t:e%t)/parseFloat(String(t)):e%t/parseFloat(String(t))}function h(e){return e<=1?100*Number(e)+"%":e}function v(e){return 1===e.length?"0"+e:String(e)}function g(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*n*(t-e):n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function m(e){return b(e)/255}function b(e){return parseInt(e,16)}var y={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function _(e){var t,n,r,i={r:0,g:0,b:0},o=1,a=null,s=null,c=null,u=!1,d=!1;return"string"==typeof e&&(e=function(e){if(e=e.trim().toLowerCase(),0===e.length)return!1;var t=!1;if(y[e])e=y[e],t=!0;else if("transparent"===e)return{r:0,g:0,b:0,a:0,format:"name"};var n=w.rgb.exec(e);if(n)return{r:n[1],g:n[2],b:n[3]};if(n=w.rgba.exec(e),n)return{r:n[1],g:n[2],b:n[3],a:n[4]};if(n=w.hsl.exec(e),n)return{h:n[1],s:n[2],l:n[3]};if(n=w.hsla.exec(e),n)return{h:n[1],s:n[2],l:n[3],a:n[4]};if(n=w.hsv.exec(e),n)return{h:n[1],s:n[2],v:n[3]};if(n=w.hsva.exec(e),n)return{h:n[1],s:n[2],v:n[3],a:n[4]};if(n=w.hex8.exec(e),n)return{r:b(n[1]),g:b(n[2]),b:b(n[3]),a:m(n[4]),format:t?"name":"hex8"};if(n=w.hex6.exec(e),n)return{r:b(n[1]),g:b(n[2]),b:b(n[3]),format:t?"name":"hex"};if(n=w.hex4.exec(e),n)return{r:b(n[1]+n[1]),g:b(n[2]+n[2]),b:b(n[3]+n[3]),a:m(n[4]+n[4]),format:t?"name":"hex8"};if(n=w.hex3.exec(e),n)return{r:b(n[1]+n[1]),g:b(n[2]+n[2]),b:b(n[3]+n[3]),format:t?"name":"hex"};return!1}(e)),"object"==typeof e&&(C(e.r)&&C(e.g)&&C(e.b)?(t=e.r,n=e.g,r=e.b,i={r:255*p(t,255),g:255*p(n,255),b:255*p(r,255)},u=!0,d="%"===String(e.r).substr(-1)?"prgb":"rgb"):C(e.h)&&C(e.s)&&C(e.v)?(a=h(e.s),s=h(e.v),i=function(e,t,n){e=6*p(e,360),t=p(t,100),n=p(n,100);var r=Math.floor(e),i=e-r,o=n*(1-t),a=n*(1-i*t),s=n*(1-(1-i)*t),c=r%6;return{r:255*[n,a,o,o,s,n][c],g:255*[s,n,n,a,o,o][c],b:255*[o,o,s,n,n,a][c]}}(e.h,a,s),u=!0,d="hsv"):C(e.h)&&C(e.s)&&C(e.l)&&(a=h(e.s),c=h(e.l),i=function(e,t,n){var r,i,o;if(e=p(e,360),t=p(t,100),n=p(n,100),0===t)i=n,o=n,r=n;else{var a=n<.5?n*(1+t):n+t-n*t,s=2*n-a;r=g(s,a,e+1/3),i=g(s,a,e),o=g(s,a,e-1/3)}return{r:255*r,g:255*i,b:255*o}}(e.h,a,c),u=!0,d="hsl"),Object.prototype.hasOwnProperty.call(e,"a")&&(o=e.a)),o=function(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}(o),{ok:u,format:e.format||d,r:Math.min(255,Math.max(i.r,0)),g:Math.min(255,Math.max(i.g,0)),b:Math.min(255,Math.max(i.b,0)),a:o}}var S="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)",O="[\\s|\\(]+("+S+")[,|\\s]+("+S+")[,|\\s]+("+S+")\\s*\\)?",E="[\\s|\\(]+("+S+")[,|\\s]+("+S+")[,|\\s]+("+S+")[,|\\s]+("+S+")\\s*\\)?",w={CSS_UNIT:new RegExp(S),rgb:new RegExp("rgb"+O),rgba:new RegExp("rgba"+E),hsl:new RegExp("hsl"+O),hsla:new RegExp("hsla"+E),hsv:new RegExp("hsv"+O),hsva:new RegExp("hsva"+E),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function C(e){return Boolean(w.CSS_UNIT.exec(String(e)))}var I=2,k=.16,T=.05,D=.05,R=.15,A=5,M=4,x=[{index:7,opacity:.15},{index:6,opacity:.25},{index:5,opacity:.3},{index:5,opacity:.45},{index:5,opacity:.65},{index:5,opacity:.85},{index:4,opacity:.9},{index:3,opacity:.95},{index:2,opacity:.97},{index:1,opacity:.98}];function j(e){var t=function(e,t,n){e=p(e,255),t=p(t,255),n=p(n,255);var r=Math.max(e,t,n),i=Math.min(e,t,n),o=0,a=r,s=r-i,c=0===r?0:s/r;if(r===i)o=0;else{switch(r){case e:o=(t-n)/s+(t<n?6:0);break;case t:o=(n-e)/s+2;break;case n:o=(e-t)/s+4}o/=6}return{h:o,s:c,v:a}}(e.r,e.g,e.b);return{h:360*t.h,s:t.s,v:t.v}}function N(e){var t=e.r,n=e.g,r=e.b;return"#".concat(function(e,t,n,r){var i=[v(Math.round(e).toString(16)),v(Math.round(t).toString(16)),v(Math.round(n).toString(16))];return r&&i[0].startsWith(i[0].charAt(1))&&i[1].startsWith(i[1].charAt(1))&&i[2].startsWith(i[2].charAt(1))?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}(t,n,r,!1))}function L(e,t,n){var r;return(r=Math.round(e.h)>=60&&Math.round(e.h)<=240?n?Math.round(e.h)-I*t:Math.round(e.h)+I*t:n?Math.round(e.h)+I*t:Math.round(e.h)-I*t)<0?r+=360:r>=360&&(r-=360),r}function U(e,t,n){return 0===e.h&&0===e.s?e.s:((r=n?e.s-k*t:t===M?e.s+k:e.s+T*t)>1&&(r=1),n&&t===A&&r>.1&&(r=.1),r<.06&&(r=.06),Number(r.toFixed(2)));var r}function P(e,t,n){var r;return(r=n?e.v+D*t:e.v-R*t)>1&&(r=1),Number(r.toFixed(2))}function F(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[],r=_(e),i=A;i>0;i-=1){var o=j(r),a=N(_({h:L(o,i,!0),s:U(o,i,!0),v:P(o,i,!0)}));n.push(a)}n.push(N(r));for(var s=1;s<=M;s+=1){var c=j(r),u=N(_({h:L(c,s),s:U(c,s),v:P(c,s)}));n.push(u)}return"dark"===t.theme?x.map((function(e){var r,i,o,a=e.index,s=e.opacity;return N((r=_(t.backgroundColor||"#141414"),i=_(n[a]),o=100*s/100,{r:(i.r-r.r)*o+r.r,g:(i.g-r.g)*o+r.g,b:(i.b-r.b)*o+r.b}))})):n}var q={red:"#F5222D",volcano:"#FA541C",orange:"#FA8C16",gold:"#FAAD14",yellow:"#FADB14",lime:"#A0D911",green:"#52C41A",cyan:"#13C2C2",blue:"#1890FF",geekblue:"#2F54EB",purple:"#722ED1",magenta:"#EB2F96",grey:"#666666"},B={},Q={};Object.keys(q).forEach((function(e){B[e]=F(q[e]),B[e].primary=B[e][5],Q[e]=F(q[e],{theme:"dark",backgroundColor:"#141414"}),Q[e].primary=Q[e][5]}));B.red,B.volcano,B.gold,B.orange,B.yellow,B.lime,B.green,B.cyan,B.blue,B.geekblue,B.purple,B.magenta,B.grey;var W=n("c8c14d307d"),G=n("f90d6faccb");function H(e){return"object"===Object(f.a)(e)&&"string"==typeof e.name&&"string"==typeof e.theme&&("object"===Object(f.a)(e.icon)||"function"==typeof e.icon)}function V(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(e).reduce((function(t,n){var r=e[n];if("class"===n)t.className=r,delete t.class;else t[n]=r;return t}),{})}function K(e,t,n){return n?c.a.createElement(e.tag,Object(r.a)(Object(r.a)({key:t},V(e.attrs)),n),(e.children||[]).map((function(n,r){return K(n,"".concat(t,"-").concat(e.tag,"-").concat(r))}))):c.a.createElement(e.tag,Object(r.a)({key:t},V(e.attrs)),(e.children||[]).map((function(n,r){return K(n,"".concat(t,"-").concat(e.tag,"-").concat(r))})))}function Y(e){return F(e)[0]}function z(e){return e?Array.isArray(e)?e:[e]:[]}var X=["icon","className","onClick","style","primaryColor","secondaryColor"],J={primaryColor:"#333",secondaryColor:"#E6E6E6",calculated:!1};var $=function(e){var t,n,i=e.icon,o=e.className,c=e.onClick,u=e.style,d=e.primaryColor,f=e.secondaryColor,p=Object(a.a)(e,X),h=J;if(d&&(h={primaryColor:d,secondaryColor:f||Y(d)}),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"\n.anticon {\n  display: inline-block;\n  color: inherit;\n  font-style: normal;\n  line-height: 0;\n  text-align: center;\n  text-transform: none;\n  vertical-align: -0.125em;\n  text-rendering: optimizeLegibility;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n.anticon > * {\n  line-height: 1;\n}\n\n.anticon svg {\n  display: inline-block;\n}\n\n.anticon::before {\n  display: none;\n}\n\n.anticon .anticon-icon {\n  display: block;\n}\n\n.anticon[tabindex] {\n  cursor: pointer;\n}\n\n.anticon-spin::before,\n.anticon-spin {\n  display: inline-block;\n  -webkit-animation: loadingCircle 1s infinite linear;\n  animation: loadingCircle 1s infinite linear;\n}\n\n@-webkit-keyframes loadingCircle {\n  100% {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg);\n  }\n}\n\n@keyframes loadingCircle {\n  100% {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg);\n  }\n}\n",t=Object(s.useContext)(l.a).csp;Object(s.useEffect)((function(){Object(G.a)(e,"@ant-design-icons",{prepend:!0,csp:t})}),[])}(),t=H(i),n="icon should be icon definiton, but got ".concat(i),Object(W.a)(t,"[@ant-design/icons] ".concat(n)),!H(i))return null;var v=i;return v&&"function"==typeof v.icon&&(v=Object(r.a)(Object(r.a)({},v),{},{icon:v.icon(h.primaryColor,h.secondaryColor)})),K(v.icon,"svg-".concat(v.name),Object(r.a)({className:o,onClick:c,style:u,"data-icon":v.name,width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true"},p))};$.displayName="IconReact",$.getTwoToneColors=function(){return Object(r.a)({},J)},$.setTwoToneColors=function(e){var t=e.primaryColor,n=e.secondaryColor;J.primaryColor=t,J.secondaryColor=n||Y(t),J.calculated=!!n};var Z=$;function ee(e){var t=z(e),n=Object(i.a)(t,2),r=n[0],o=n[1];return Z.setTwoToneColors({primaryColor:r,secondaryColor:o})}var te=["className","icon","spin","rotate","tabIndex","onClick","twoToneColor"];ee("#1890ff");var ne=s.forwardRef((function(e,t){var n,c=e.className,u=e.icon,f=e.spin,p=e.rotate,h=e.tabIndex,v=e.onClick,g=e.twoToneColor,m=Object(a.a)(e,te),b=s.useContext(l.a).prefixCls,y=void 0===b?"anticon":b,_=d()(y,(n={},Object(o.a)(n,"".concat(y,"-").concat(u.name),!!u.name),Object(o.a)(n,"".concat(y,"-spin"),!!f||"loading"===u.name),n),c),S=h;void 0===S&&v&&(S=-1);var O=p?{msTransform:"rotate(".concat(p,"deg)"),transform:"rotate(".concat(p,"deg)")}:void 0,E=z(g),w=Object(i.a)(E,2),C=w[0],I=w[1];return s.createElement("span",Object(r.a)(Object(r.a)({role:"img","aria-label":u.name},m),{},{ref:t,tabIndex:S,onClick:v,className:_}),s.createElement(Z,{icon:u,primaryColor:C,secondaryColor:I,style:O}))}));ne.displayName="AntdIcon",ne.getTwoToneColor=function(){var e=Z.getTwoToneColors();return e.calculated?[e.primaryColor,e.secondaryColor]:e.primaryColor},ne.setTwoToneColor=ee;t.a=ne},"730477bb20":function(e,t){function n(){return e.exports=n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},e.exports.default=e.exports,e.exports.__esModule=!0,n.apply(this,arguments)}e.exports=n,e.exports.default=e.exports,e.exports.__esModule=!0},"77e684763e":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("a395430f42");Object.defineProperty(t,"Disposable",{enumerable:!0,get:function(){return r.Disposable}}),Object.defineProperty(t,"RootDisposable",{enumerable:!0,get:function(){return r.RootDisposable}}),Object.defineProperty(t,"mixinDisposable",{enumerable:!0,get:function(){return r.mixinDisposable}}),Object.defineProperty(t,"mixinRootDisposable",{enumerable:!0,get:function(){return r.mixinRootDisposable}});var i=n("dd1cfaf242");Object.defineProperty(t,"DisposableNone",{enumerable:!0,get:function(){return i.DisposableNone}});var o=n("8838f60498");Object.defineProperty(t,"markTracked",{enumerable:!0,get:function(){return o.markTracked}}),Object.defineProperty(t,"trackDisposable",{enumerable:!0,get:function(){return o.trackDisposable}}),Object.defineProperty(t,"enableDisposablesTrack",{enumerable:!0,get:function(){return o.enableDisposablesTrack}}),Object.defineProperty(t,"disableDisposablesTrack",{enumerable:!0,get:function(){return o.disableDisposablesTrack}});var a=n("95b75d217e");Object.defineProperty(t,"DisposeTrace",{enumerable:!0,get:function(){return a.DisposeTrace}}),Object.defineProperty(t,"enableDisposeTrace",{enumerable:!0,get:function(){return a.enableDisposeTrace}}),Object.defineProperty(t,"disableDisposeTrace",{enumerable:!0,get:function(){return a.disableDisposeTrace}});var s=n("08e718accf");Object.defineProperty(t,"toDisposable",{enumerable:!0,get:function(){return s.toDisposable}}),Object.defineProperty(t,"isDisposable",{enumerable:!0,get:function(){return s.isDisposable}}),Object.defineProperty(t,"dispose",{enumerable:!0,get:function(){return s.dispose}}),Object.defineProperty(t,"combinedDisposable",{enumerable:!0,get:function(){return s.combinedDisposable}}),Object.defineProperty(t,"tryToDispose",{enumerable:!0,get:function(){return s.tryToDispose}}),Object.defineProperty(t,"tryToMarkDispose",{enumerable:!0,get:function(){return s.tryToMarkDispose}});var c=n("1d73a1ebc4");Object.defineProperty(t,"DisposableStore",{enumerable:!0,get:function(){return c.DisposableStore}});var u=n("3ec7c50a43");Object.defineProperty(t,"CancellationTokenSource",{enumerable:!0,get:function(){return u.CancellationTokenSource}})},"7a6008fb54":function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0}),t.Sender=void 0;var a=n("cd1340aeac"),s=n("5d1be1397d"),c=n("cf3c69206c"),u=n("eee882e93f"),d=function(){function e(e){this.dependency=e,this.requestId=0,this.retryTimerMap=new Map}return e.prototype.dispose=function(){this.clearAllRetryTimer()},e.prototype.sendMessage=function(e){return r(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return t=this.createRequestConfig(e),[4,this.commitMessage(e,t)];case 1:return n=r.sent(),[4,this.handleCommitResult(e,n)];case 2:return[2,r.sent()]}}))}))},e.prototype.clearAllRetryTimer=function(){var e,t;try{for(var n=o(this.retryTimerMap.values()),r=n.next();!r.done;r=n.next()){var i=r.value;clearTimeout(i)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.retryTimerMap.clear()},e.prototype.createRequestConfig=function(e){return{timeout:e.timeout,maxRetry:u.DEFAULT_RETRY_COUNTS,contentType:c.ContentTypeValue.JSON}},e.prototype.commitMessage=function(e,t){return r(this,void 0,void 0,(function(){var n,r,o,c,u,d;return i(this,(function(i){switch(i.label){case 0:return n=this.dependency.getServerParams(),r=n.token,o=n.sid,c=n.routeKey,u="/websocket/save?routeKey="+c,d={routeKey:c,token:r,sid:o,syncCommit:e.syncCommit,requestId:this.requestId,head:e.postData.head,body:e.postData.body},this.requestId+=1,[4,(new a.Request).sendRequest(u,s.Method.POST,d,t)];case 1:return[2,i.sent()]}}))}))},e.prototype.handleCommitResult=function(e,t){var n;return r(this,void 0,void 0,(function(){var r;return i(this,(function(i){switch(i.label){case 0:return r=null===(n=t.data)||void 0===n?void 0:n.data,!t.error&&r?[3,2]:[4,this.retrySendMessage(e)];case 1:return[2,i.sent()];case 2:return[2,r]}}))}))},e.prototype.clearMessageRetryTimer=function(e){this.retryTimerMap.has(e.taskId)&&(clearTimeout(this.retryTimerMap.get(e.taskId)),this.retryTimerMap.delete(e.taskId))},e.prototype.retrySendMessage=function(e){return r(this,void 0,void 0,(function(){var t,n=this;return i(this,(function(o){return this.clearMessageRetryTimer(e),this.dependency.isConnected()?(t=this.getDelayDuration(e.retryCount),[2,new Promise((function(o){var a=setTimeout((function(){return r(n,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return this.dependency.onMessageSending(e),[4,this.sendMessage(e)];case 1:return t=n.sent(),o(t),[2]}}))}))}),t);n.retryTimerMap.set(e.taskId,a)}))]):(this.dependency.onMessageWaiting(e),e.retryCount=0,[2])}))}))},e.prototype.getDelayDuration=function(e){return 1e3*Math.min(2*e,30)},e}();t.Sender=d},"7c1a6eea74":function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n("0881ac8476");var i=n("0cf3719522"),o=n.n(i),a=n("aae8417744");function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=Object(r.a)(e);if(t){var s=Object(r.a)(this).constructor;n=Reflect.construct(i,arguments,s)}else n=i.apply(this,arguments);return function(e,t){if(t&&("object"===o()(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Object(a.a)(e)}(this,n)}}},"7f688d0e54":function(e,t,n){"use strict";function r(e){if(Array.isArray(e))return e}n.d(t,"a",(function(){return r}))},"8838f60498":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.trackDisposable=t.markTracked=t.disableDisposablesTrack=t.enableDisposablesTrack=void 0;var r=n("dd1cfaf242"),i=!1,o="__is_disposable_tracked__";t.enableDisposablesTrack=function(){i=!0},t.disableDisposablesTrack=function(){i=!1},t.markTracked=function(e){if(i&&e&&e!==r.DisposableNone)try{e[o]=!0}catch(e){}},t.trackDisposable=function(e){if(!i)return e;e[o]||(e[o]=!1);var t=new Error("Potentially leaked disposable").stack;return setTimeout((function(){e[o]||console.log(t)}),3e3),e}},"898db569a7":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},"8c6f8478bd":function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.BaseChannel=void 0;var o=n("f7ee9899ef"),a=n("cdda668c2b"),s=function(){function e(e,t){this.options=e,this.defaultConfig=t}return e.prototype.dispose=function(){this.paramsPacker=void 0,this.responseHandler=void 0},e.prototype.sendMessage=function(e){return r(this,void 0,void 0,(function(){var t,n,r,s,c,u;return i(this,(function(i){switch(i.label){case 0:return this.paramsPacker&&this.responseHandler?(n=this.paramsPacker.pack(e,this.options),r=e.requestUrl,s=e.method,c=e.contentType,[4,(new o.Request).sendRequest(null!=r?r:this.defaultConfig.requestUrl,null!=s?s:this.defaultConfig.method,null!=c?c:this.defaultConfig.contentType,n)]):(t="Channel Error, sendMessage failed paramsPacker:"+this.paramsPacker+", responseHandler:"+this.responseHandler+" ",a.ConnectionLog.error(t),[2,{error:t}]);case 1:return u=i.sent(),[2,this.responseHandler.handle(u)]}}))}))},e}();t.BaseChannel=s},"8daac3befe":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PageVisibilityChecker=void 0;var r=n("cdda668c2b"),i=function(){function e(e){var t=this;this.dependency=e,this.timer=0,this.isTimeout=!1,this.needGetReceiverClient=!1,this.onVisibilitychange=function(){"hidden"===document.visibilityState?t.onPageHide():t.onPageShow()},this.onPageHide=function(){r.ConnectionLog.info("pageVisibility: pagehide"),t.clearTimeout(),t.timer=setTimeout((function(){t.isTimeout=!0}),3e4)},this.onPageShow=function(){var e,n;r.ConnectionLog.info("pageVisibility: pageshow"),t.clearTimeout(),t.isTimeout&&t.needGetReceiverClient&&(null===(n=(e=t.dependency).resumeCallback)||void 0===n||n.call(e)),t.isTimeout=!1,t.needGetReceiverClient=!1},this.addListener()}return e.prototype.dispose=function(){this.clearTimeout(),document.removeEventListener("visibilitychange",this.onVisibilitychange),window.removeEventListener("pagehide",this.onPageHide),window.removeEventListener("pageshow",this.onPageShow)},Object.defineProperty(e.prototype,"isHidden",{get:function(){return document.hidden&&this.isTimeout},enumerable:!1,configurable:!0}),e.prototype.resumeAfterVisibility=function(){this.needGetReceiverClient=!0},e.prototype.addListener=function(){document.addEventListener("visibilitychange",this.onVisibilitychange),/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&(window.addEventListener("pagehide",this.onPageHide),window.addEventListener("pageshow",this.onPageShow))},e.prototype.clearTimeout=function(){this.timer&&(clearTimeout(this.timer),this.timer=0)},e}();t.PageVisibilityChecker=i},"8fded022d0":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("20ac6cdd89");function i(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Object(r.a)(e,t)}},"9451cd5c78":function(e,t,n){"use strict";n.d(t,"a",(function(){return Q}));var r,i=[],o="ResizeObserver loop completed with undelivered notifications.";!function(e){e.BORDER_BOX="border-box",e.CONTENT_BOX="content-box",e.DEVICE_PIXEL_CONTENT_BOX="device-pixel-content-box"}(r||(r={}));var a,s=function(e){return Object.freeze(e)},c=function(e,t){this.inlineSize=e,this.blockSize=t,s(this)},u=function(){function e(e,t,n,r){return this.x=e,this.y=t,this.width=n,this.height=r,this.top=this.y,this.left=this.x,this.bottom=this.top+this.height,this.right=this.left+this.width,s(this)}return e.prototype.toJSON=function(){var e=this;return{x:e.x,y:e.y,top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.width,height:e.height}},e.fromRect=function(t){return new e(t.x,t.y,t.width,t.height)},e}(),d=function(e){return e instanceof SVGElement&&"getBBox"in e},l=function(e){if(d(e)){var t=e.getBBox(),n=t.width,r=t.height;return!n&&!r}var i=e,o=i.offsetWidth,a=i.offsetHeight;return!(o||a||e.getClientRects().length)},f=function(e){var t,n;if(e instanceof Element)return!0;var r=null===(n=null===(t=e)||void 0===t?void 0:t.ownerDocument)||void 0===n?void 0:n.defaultView;return!!(r&&e instanceof r.Element)},p="undefined"!=typeof window?window:{},h=new WeakMap,v=/auto|scroll/,g=/^tb|vertical/,m=/msie|trident/i.test(p.navigator&&p.navigator.userAgent),b=function(e){return parseFloat(e||"0")},y=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=!1),new c((n?t:e)||0,(n?e:t)||0)},_=s({devicePixelContentBoxSize:y(),borderBoxSize:y(),contentBoxSize:y(),contentRect:new u(0,0,0,0)}),S=function(e,t){if(void 0===t&&(t=!1),h.has(e)&&!t)return h.get(e);if(l(e))return h.set(e,_),_;var n=getComputedStyle(e),r=d(e)&&e.ownerSVGElement&&e.getBBox(),i=!m&&"border-box"===n.boxSizing,o=g.test(n.writingMode||""),a=!r&&v.test(n.overflowY||""),c=!r&&v.test(n.overflowX||""),f=r?0:b(n.paddingTop),p=r?0:b(n.paddingRight),S=r?0:b(n.paddingBottom),O=r?0:b(n.paddingLeft),E=r?0:b(n.borderTopWidth),w=r?0:b(n.borderRightWidth),C=r?0:b(n.borderBottomWidth),I=O+p,k=f+S,T=(r?0:b(n.borderLeftWidth))+w,D=E+C,R=c?e.offsetHeight-D-e.clientHeight:0,A=a?e.offsetWidth-T-e.clientWidth:0,M=i?I+T:0,x=i?k+D:0,j=r?r.width:b(n.width)-M-A,N=r?r.height:b(n.height)-x-R,L=j+I+A+T,U=N+k+R+D,P=s({devicePixelContentBoxSize:y(Math.round(j*devicePixelRatio),Math.round(N*devicePixelRatio),o),borderBoxSize:y(L,U,o),contentBoxSize:y(j,N,o),contentRect:new u(O,f,j,N)});return h.set(e,P),P},O=function(e,t,n){var i=S(e,n),o=i.borderBoxSize,a=i.contentBoxSize,s=i.devicePixelContentBoxSize;switch(t){case r.DEVICE_PIXEL_CONTENT_BOX:return s;case r.BORDER_BOX:return o;default:return a}},E=function(e){var t=S(e);this.target=e,this.contentRect=t.contentRect,this.borderBoxSize=s([t.borderBoxSize]),this.contentBoxSize=s([t.contentBoxSize]),this.devicePixelContentBoxSize=s([t.devicePixelContentBoxSize])},w=function(e){if(l(e))return 1/0;for(var t=0,n=e.parentNode;n;)t+=1,n=n.parentNode;return t},C=function(){var e=1/0,t=[];i.forEach((function(n){if(0!==n.activeTargets.length){var r=[];n.activeTargets.forEach((function(t){var n=new E(t.target),i=w(t.target);r.push(n),t.lastReportedSize=O(t.target,t.observedBox),i<e&&(e=i)})),t.push((function(){n.callback.call(n.observer,r,n.observer)})),n.activeTargets.splice(0,n.activeTargets.length)}}));for(var n=0,r=t;n<r.length;n++){(0,r[n])()}return e},I=function(e){i.forEach((function(t){t.activeTargets.splice(0,t.activeTargets.length),t.skippedTargets.splice(0,t.skippedTargets.length),t.observationTargets.forEach((function(n){n.isActive()&&(w(n.target)>e?t.activeTargets.push(n):t.skippedTargets.push(n))}))}))},k=function(){var e,t=0;for(I(t);i.some((function(e){return e.activeTargets.length>0}));)t=C(),I(t);return i.some((function(e){return e.skippedTargets.length>0}))&&("function"==typeof ErrorEvent?e=new ErrorEvent("error",{message:o}):((e=document.createEvent("Event")).initEvent("error",!1,!1),e.message=o),window.dispatchEvent(e)),t>0},T=[],D=function(e){if(!a){var t=0,n=document.createTextNode("");new MutationObserver((function(){return T.splice(0).forEach((function(e){return e()}))})).observe(n,{characterData:!0}),a=function(){n.textContent=""+(t?t--:t++)}}T.push(e),a()},R=0,A={attributes:!0,characterData:!0,childList:!0,subtree:!0},M=["resize","load","transitionend","animationend","animationstart","animationiteration","keyup","keydown","mouseup","mousedown","mouseover","mouseout","blur","focus"],x=function(e){return void 0===e&&(e=0),Date.now()+e},j=!1,N=new(function(){function e(){var e=this;this.stopped=!0,this.listener=function(){return e.schedule()}}return e.prototype.run=function(e){var t=this;if(void 0===e&&(e=250),!j){j=!0;var n,r=x(e);n=function(){var n=!1;try{n=k()}finally{if(j=!1,e=r-x(),!R)return;n?t.run(1e3):e>0?t.run(e):t.start()}},D((function(){requestAnimationFrame(n)}))}},e.prototype.schedule=function(){this.stop(),this.run()},e.prototype.observe=function(){var e=this,t=function(){return e.observer&&e.observer.observe(document.body,A)};document.body?t():p.addEventListener("DOMContentLoaded",t)},e.prototype.start=function(){var e=this;this.stopped&&(this.stopped=!1,this.observer=new MutationObserver(this.listener),this.observe(),M.forEach((function(t){return p.addEventListener(t,e.listener,!0)})))},e.prototype.stop=function(){var e=this;this.stopped||(this.observer&&this.observer.disconnect(),M.forEach((function(t){return p.removeEventListener(t,e.listener,!0)})),this.stopped=!0)},e}()),L=function(e){!R&&e>0&&N.start(),!(R+=e)&&N.stop()},U=function(){function e(e,t){this.target=e,this.observedBox=t||r.CONTENT_BOX,this.lastReportedSize={inlineSize:0,blockSize:0}}return e.prototype.isActive=function(){var e,t=O(this.target,this.observedBox,!0);return e=this.target,d(e)||function(e){switch(e.tagName){case"INPUT":if("image"!==e.type)break;case"VIDEO":case"AUDIO":case"EMBED":case"OBJECT":case"CANVAS":case"IFRAME":case"IMG":return!0}return!1}(e)||"inline"!==getComputedStyle(e).display||(this.lastReportedSize=t),this.lastReportedSize.inlineSize!==t.inlineSize||this.lastReportedSize.blockSize!==t.blockSize},e}(),P=function(e,t){this.activeTargets=[],this.skippedTargets=[],this.observationTargets=[],this.observer=e,this.callback=t},F=new WeakMap,q=function(e,t){for(var n=0;n<e.length;n+=1)if(e[n].target===t)return n;return-1},B=function(){function e(){}return e.connect=function(e,t){var n=new P(e,t);F.set(e,n)},e.observe=function(e,t,n){var r=F.get(e),o=0===r.observationTargets.length;q(r.observationTargets,t)<0&&(o&&i.push(r),r.observationTargets.push(new U(t,n&&n.box)),L(1),N.schedule())},e.unobserve=function(e,t){var n=F.get(e),r=q(n.observationTargets,t),o=1===n.observationTargets.length;r>=0&&(o&&i.splice(i.indexOf(n),1),n.observationTargets.splice(r,1),L(-1))},e.disconnect=function(e){var t=this,n=F.get(e);n.observationTargets.slice().forEach((function(n){return t.unobserve(e,n.target)})),n.activeTargets.splice(0,n.activeTargets.length)},e}(),Q=function(){function e(e){if(0===arguments.length)throw new TypeError("Failed to construct 'ResizeObserver': 1 argument required, but only 0 present.");if("function"!=typeof e)throw new TypeError("Failed to construct 'ResizeObserver': The callback provided as parameter 1 is not a function.");B.connect(this,e)}return e.prototype.observe=function(e,t){if(0===arguments.length)throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!f(e))throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': parameter 1 is not of type 'Element");B.observe(this,e,t)},e.prototype.unobserve=function(e){if(0===arguments.length)throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!f(e))throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': parameter 1 is not of type 'Element");B.unobserve(this,e)},e.prototype.disconnect=function(){B.disconnect(this)},e.toString=function(){return"function ResizeObserver () { [polyfill code] }"},e}()},"95b75d217e":function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},r(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a};Object.defineProperty(t,"__esModule",{value:!0}),t.DisposeTrace=t.disableDisposeTrace=t.enableDisposeTrace=void 0;var s=!1;t.enableDisposeTrace=function(){s=!0},t.disableDisposeTrace=function(){s=!1};var c=function(){function e(e){this.name=e,this._dep=[]}return e.traceRoot=function(t){return s?new e(t):e._None},e.prototype.branch=function(t){var n=new e(t);return this._dep.push([t,n]),n},e.prototype.stop=function(){var e=["dispose "+this.name,""+function e(t,n){var r,i,s=[],c=new Array(t+1).join("\t");try{for(var u=o(n._dep),d=u.next();!d.done;d=u.next()){var l=a(d.value,2),f=l[0],p=l[1];if(p){s.push(c+"dispose -> "+f);var h=e(t+1,p);h&&s.push(h)}else s.push(c+"dispose -> "+f)}}catch(e){r={error:e}}finally{try{d&&!d.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}return s.join("\n")}(1,this)];console.log(e.join("\n"))},e._None=new(function(e){function t(){return e.call(this,null)||this}return i(t,e),t.prototype.stop=function(){},t.prototype.branch=function(){return this},t}(e)),e}();t.DisposeTrace=c},"97d6e03b61":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Result=void 0;var r=function(e,t){e&&(this.error=e),void 0!==t&&(this.data=t)};t.Result=r},"9b674918eb":function(e,t,n){var r=n("2980634bca");e.exports=function(e,t){if(null==e)return{};var n,i,o=r(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o},e.exports.default=e.exports,e.exports.__esModule=!0},"9ba2f5d315":function(e,t,n){"use strict";var r=n("d8384ba8a0"),i=n("69084d01d3"),o={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M988 548c-19.9 0-36-16.1-36-36 0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 00-94.3-139.9 437.71 437.71 0 00-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.3C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3.1 19.9-16 36-35.9 36z"}}]},name:"loading",theme:"outlined"},a=n("6a0f504a4d"),s=function(e,t){return i.createElement(a.a,Object(r.a)(Object(r.a)({},e),{},{ref:t,icon:o}))};s.displayName="LoadingOutlined";t.a=i.forwardRef(s)},a395430f42:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},r(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},a=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0}),t.mixinRootDisposable=t.mixinDisposable=t.Disposable=t.RootDisposable=void 0;var s=n("95b75d217e"),c=n("8838f60498"),u=n("1d73a1ebc4"),d=function(){function e(){this.disposedStore=new u.DisposableStore}return e.prototype.dispose=function(e){this.disposedStore.dispose(e)},e.prototype._register=function(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this.disposedStore.add(e)},e}(),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.dispose=function(t){var n=t,r=!1;if(!n){var i=this.constructor.name;n=s.DisposeTrace.traceRoot(i),r=!0}e.prototype.dispose.call(this,n),r&&n.stop()},t.prototype._register=function(t){return e.prototype._register.call(this,t)},t}(d);t.RootDisposable=l;var f=function(e){function t(){var t=e.call(this)||this;return c.trackDisposable(t),t}return i(t,e),t.prototype.dispose=function(t){c.markTracked(this),e.prototype.dispose.call(this,t)},t}(d);t.Disposable=f,t.mixinDisposable=function(e){return function(e){function t(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=e.apply(this,a(t))||this;return r.disposedStore=new u.DisposableStore,c.trackDisposable(r),r}return i(t,e),t.prototype.dispose=function(e){c.markTracked(this),this.disposedStore.dispose(e)},t.prototype._register=function(e){return this.disposedStore.add(e)},t}(e)},t.mixinRootDisposable=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.disposedStore=new u.DisposableStore,t}return i(t,e),t.prototype.dispose=function(e){c.markTracked(this);var t=e,n=!1;if(!t){var r=this.constructor.name;t=s.DisposeTrace.traceRoot(r),n=!0}this.disposedStore.dispose(t),n&&t.stop()},t.prototype._register=function(e){return this.disposedStore.add(e)},t}(e)}},a5b778a02f:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MessageCenter=void 0;var c=n("cdda668c2b"),u=n("147e28b86b"),d=n("46509843e6"),l=n("e2584d8846"),f=n("7a6008fb54"),p=n("d3819be4ca"),h=n("e9dc8c48dc"),v=n("686df8963b"),g=n("094a0886cb"),m=n("c4f2c30fd5"),b=n("de23095cc5"),y=s(n("751778941b")),_=function(){function e(e,t,n){var r,i,o=this;this.options=e,this.dependency=t,this.connectManager=n,this.tag="MessageCenter",this.limitFrequencyManager=new p.LimitFrequencyManager(this.dependency),null===(i=null===(r=this.options.config)||void 0===r?void 0:r.messagePriority)||void 0===i||i.forEach((function(e,t){o.limitFrequencyManager.setPriority(t,e)}));var a={getServerParams:function(){return o.serverRequestParams},reconnect:function(e){return o.reconnect(e)},disconnect:function(e){return o.connectManager.disconnect(e)},isDisconnected:function(){return o.connectManager.isDisconnected()},handleServerMessage:function(e){return o.handleServerMessage(e)},onConnectSuccess:function(){return o.connectManager.onConnectSuccess()}};this.sender=new f.Sender({getServerParams:function(){return o.serverRequestParams},isConnected:function(){return o.connectManager.isConnected()},onMessageSending:function(e){return o.onMessageSending(e)},onMessageWaiting:function(e){return o.onMessageWaiting(e)}}),this.receiver=new l.Receiver(a);var s=new v.MessageClassification([["CURSOR_MESSAGE",v.MessageSendType.PARALLEL]]);this.messageSendQueue=new h.MessageSendQueue(s),this.timeoutChecker=new m.TimeoutChecker(this.messageSendQueue,{trySendMessage:function(){return o.trySendMessage()}}),this.initOnConnectEvent()}return e.prototype.dispose=function(){this.receiver.dispose(),this.sender.dispose(),this.timeoutChecker.dispose()},e.prototype.sendMessage=function(e){if(c.ConnectionLog.info(this.tag+" sendMessage cmd:"+e.cmd+" taskId:"+e.taskId),this.messageSendQueue.has(e.taskId))return c.ConnectionLog.warn(this.tag+" sendMessage taskId:"+e.taskId+" is sending."),void e.onError(e.taskId,e.cmd,e.data,{errCode:u.RoomErrorCode.EXIST,errMsg:"msg already exist."});var t=b.MessageCreater.createMessage(e,this.options,this.dependency);this.messageSendQueue.add(t),this.trySendMessage()},e.prototype.cancelSendMessageByTaskId=function(e){c.ConnectionLog.info("cancelSendMessageByTaskId taskId:"+e),this.messageSendQueue.remove(e)},e.prototype.initOnConnectEvent=function(){var e=this;this.connectManager.onConnectEvent((function(t){var n,r=t.status,i=t.serverRequestParams;c.ConnectionLog.debug("onConnectEvent: "+r);var o=new Map([[""+d.ConnectStatus.LOGINED,function(){return e.handleLogined(i)}],[""+d.ConnectStatus.CONNECTED,function(){return e.trySendMessage()}],[""+d.ConnectStatus.DISCONNECT,function(){return e.handleDisconnect()}],[""+d.ConnectStatus.WAIT_RECONNECTING,function(){return e.handleWaitReconnecting()}]]);o.has(t.status)&&(null===(n=o.get(t.status))||void 0===n||n())}))},e.prototype.trySendMessage=function(){this.connectManager.isDisconnected()?this.triggerAllMessagesShutdown():(this.trySendParallelMessage(),this.trySendSerialMessage())},e.prototype.trySendSerialMessage=function(){if(!this.messageSendQueue.isCommittingSerialMessage())if(this.connectManager.isDisconnected())this.triggerAllMessagesShutdown();else{var e=this.messageSendQueue.nextSerialMessage();e&&this.sendBigCollabMessage(e)}},e.prototype.trySendParallelMessage=function(){var e=this;this.messageSendQueue.nextParallelMessages().forEach((function(t){return e.sendBigCollabMessage(t)}))},e.prototype.sendBigCollabMessage=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return this.onMessageSending(e),this.timeoutChecker.startCheckSendTimeout(),[4,this.sender.sendMessage(e)];case 1:return t=n.sent(),this.handleMessageResult(e,t),[2]}}))}))},e.prototype.onMessageSending=function(e){e.state=u.MessageState.SENDING,e.lastSendTime=Date.now(),e.retryCount+=1},e.prototype.onMessageWaiting=function(e){e.state=u.MessageState.WAITING},e.prototype.handleMessageResult=function(e,t){return i(this,void 0,void 0,(function(){var n;return o(this,(function(r){return t?e.syncCommit?(this.handleSyncMessage(e,t),[2]):(n={errCode:t.retcode,errMsg:t.msg,response:t.data.syncResult?c.JsonUtil.parseJson(t.data.syncResult):t},this.handleMessageResultSend(e,n),[2]):[2]}))}))},e.prototype.handleSyncMessage=function(e,t){var n=this;if(0===t.retcode){this.parseSyncMessageResult(e,t).forEach((function(e){n.handleServerMessage(e)}))}else{var i={task_id:e.taskId,type:u.MessageWaitAcceptCmd.COMMIT_ERROR},o={data:r(r({},t),{reason:t.retcode})};this.handleMessageResultSendAccept(i,o)}},e.prototype.parseSyncMessageResult=function(e,t){if(!t.data.syncResult)throw Error("Save Response Error, syncResult is undefined, taskId: "+e.taskId);return t.data.syncResult.split("\r\n").map((function(e){return e.split("\n")}))},e.prototype.hasWaitAcceptCommand=function(e,t){var n;return!!(null===(n=e.waitAcceptCmd)||void 0===n?void 0:n.includes(t))},e.prototype.handleMessageResultSend=function(e,t){var n,r;return i(this,void 0,void 0,(function(){var i,a,s;return o(this,(function(o){return i=e.taskId,a=e.cmd,s=e.data,e.onpostTime=u.RoomUtil.getCurrentTime(),this.shouldReconnect(t.errCode)?(this.reconnect({attrName:String(t.errCode),reason:"save Error, retcode: "+t.errCode+", msg: "+t.errMsg}),this.messageSendQueue.remove(e.taskId),[2]):0!==t.errCode?(this.handleSendMessageError(e,t),[2]):(null===(n=e.onsend)||void 0===n||n.call(e,i,a,s,t),e.onsendAccept?(null===(r=e.waitAcceptCmd)||void 0===r?void 0:r.length)&&(e.state=u.MessageState.WAIT_ACCEPT):(this.messageSendQueue.remove(i),this.trySendMessage()),[2])}))}))},e.prototype.shouldReconnect=function(e){return u.NEED_RECONNECT_ERRCODES.includes(e)},e.prototype.handleSendMessageError=function(e,t){var n,r=e.taskId,i=e.cmd,o=e.data;null===(n=e.onError)||void 0===n||n.call(e,r,i,o,t),this.reportCommitError(e,t.errCode,"save Error, retcode: "+t.errCode+", msg: "+t.errMsg),this.messageSendQueue.remove(r),this.trySendMessage()},e.prototype.handleMessageResultSendAccept=function(e,t){var n,r,i,o,a,s;if(e.task_id){var c=this.messageSendQueue.remove(e.task_id);if(c&&this.hasWaitAcceptCommand(c,e.type)){this.reportCommitError(c,null!==(r=null===(n=t.data)||void 0===n?void 0:n.reason)&&void 0!==r?r:0);var u=c.taskId,d=c.cmd,l=c.data,f=c.onsendAccept,p=e.type,h=e.new_rev;null==f||f(u,d,l,p,{errCode:null!==(o=null===(i=null==t?void 0:t.data)||void 0===i?void 0:i.reason)&&void 0!==o?o:0,errMsg:null!==(s=null===(a=null==t?void 0:t.data)||void 0===a?void 0:a.msg)&&void 0!==s?s:"",response:{body:t,new_rev:h}}),this.trySendSerialMessage()}}},e.prototype.handleServerMessage=function(e){var t,n,r=a(e.map((function(e){return c.JsonUtil.parseJson(e)})),2),i=r[0],o=r[1];if(this.messageSendQueue.get(i.task_id))this.handleMessageResultSendAccept(i,o);else if("QUIT_NOTICE"===(null==i?void 0:i.type)&&Object.values(g.QUIT_TYPE).includes(null==o?void 0:o.notice.quit_type)){var s=new Map([[g.QUIT_TYPE.INACTIVE,{code:u.RoomWebsocketErrorCode.INACTIVE,reason:g.QUIT_TYPE.INACTIVE}],[g.QUIT_TYPE.LOGIN_INVALIDATE,{code:u.RoomWebsocketErrorCode.LOGIN_INVALIDATE,reason:g.QUIT_TYPE.LOGIN_INVALIDATE}],[g.QUIT_TYPE.LOGIN_FORBIDDEN,{code:u.RoomWebsocketErrorCode.LOGIN_FORBIDDEN,reason:g.QUIT_TYPE.LOGIN_FORBIDDEN}]]);this.connectManager.disconnect({reason:null===(t=s.get(null==o?void 0:o.notice.quit_type))||void 0===t?void 0:t.reason,errCode:null===(n=s.get(null==o?void 0:o.notice.quit_type))||void 0===n?void 0:n.code,shutDown:!0})}else{var d={head:i,body:o,newRev:i.new_rev,ts:i.ts,needDeal:!0};this.limitFrequencyManager.handleMessage(d),d.needDeal&&this.dependency.receiveMessageFromServer(i.type,[d])}},e.prototype.handleWaitReconnecting=function(){this.handleDisconnect("WaitReconnecting"),this.messageSendQueue.updateMessageState(u.MessageState.WAITING)},e.prototype.handleDisconnect=function(e){c.ConnectionLog.info(this.tag+" handleDisconnect reason:"+e),this.receiver.stopToReceive(),this.sender.clearAllRetryTimer(),this.timeoutChecker.clearTimer(),this.triggerAllMessagesClose()},e.prototype.reconnect=function(e){var t,n;y.default.reconnectReport({module:this.options.module,attrName:e.attrName,status:1,errorMessage:null!==(t=e.reason)&&void 0!==t?t:u.RoomUtil.getWebsocketChannelErrorMessage(null!==(n=Number(e.attrName))&&void 0!==n?n:0)}),this.connectManager.reconnect()},e.prototype.handleLogined=function(e){this.serverRequestParams=e,this.serverRequestParams.routeKey||(this.serverRequestParams.routeKey=this.options.serverVars.globalPadId),this.receiver.receive()},e.prototype.triggerAllMessagesClose=function(){this.triggerAllMessagesError({errCode:u.RoomErrorCode.ROOM_CLOSE,errMsg:"room close"})},e.prototype.triggerAllMessagesShutdown=function(){this.triggerAllMessagesError({errCode:u.RoomErrorCode.ROOM_SHUTDOWN,errMsg:"room shutdown"})},e.prototype.triggerAllMessagesError=function(e){this.messageSendQueue.filter((function(e){return!!e})).forEach((function(t){var n,r=t.taskId,i=t.cmd,o=t.data;null===(n=t.onError)||void 0===n||n.call(t,r,i,o,e)}))},e.prototype.reportCommitError=function(e,t,n){y.default.commitError({attrName:String(t),status:1,cmd:e.cmd,module:this.options.module,errorMessage:null!=n?n:u.RoomUtil.getWebsocketChannelErrorMessage(null!=t?t:0),transports:"big-collab"})},e}();t.MessageCenter=_},a6698c361d:function(e,t,n){"use strict";function r(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}n.d(t,"a",(function(){return r}))},aae8417744:function(e,t,n){"use strict";function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}n.d(t,"a",(function(){return r}))},abe54d1ebc:function(e,t,n){"use strict";function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}n.d(t,"a",(function(){return r}))},c4f2c30fd5:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TimeoutChecker=void 0;var r=n("cdda668c2b"),i=n("147e28b86b"),o=function(){function e(e,t){this.messageSendQueue=e,this.dependency=t,this.sendTimeoutTimer=0}return e.prototype.dispose=function(){this.clearTimer()},e.prototype.clearTimer=function(){clearTimeout(this.sendTimeoutTimer),this.sendTimeoutTimer=0},e.prototype.startCheckSendTimeout=function(){var e=this;this.sendTimeoutTimer&&(clearTimeout(this.sendTimeoutTimer),this.sendTimeoutTimer=0),this.sendTimeoutTimer=setTimeout((function(){e.checkSendTimeout()}),1e3)},e.prototype.checkSendTimeout=function(){var e=this.messageSendQueue.filter(this.timeoutMessage);e.forEach((function(e){e.state=i.MessageState.WAITING,e.retryCount>=e.maxRetryCount&&(r.ConnectionLog.warn("timeout-checker: send message timeout, taskId = "+e.taskId+", cmd = "+e.cmd+"."),e.retryCount=0)})),e.length>0&&this.dependency.trySendMessage(),0!==this.messageSendQueue.filter((function(e){return!!e})).length&&this.startCheckSendTimeout()},e.prototype.timeoutMessage=function(e){var t=i.RoomUtil.getCurrentTime();return(e.state===i.MessageState.SENDING||e.state===i.MessageState.WAIT_ACCEPT)&&t-e.lastSendTime>e.timeout},e}();t.TimeoutChecker=o},c78a4443e5:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return Ft})),n.d(t,"b",(function(){return ue})),n.d(t,"c",(function(){return rn})),n.d(t,"d",(function(){return Vt})),n.d(t,"e",(function(){return Xt})),n.d(t,"f",(function(){return $})),n.d(t,"g",(function(){return nn})),n.d(t,"h",(function(){return Jt}));var r=n("fe9bc614bd"),i=(n("56683198d5"),n("73b854064b"),n("9132715560")),o=n.n(i),a=n("6a364eb35c"),s=n.n(a),c=n("8eec1e4a03"),u=n.n(c),d=n("bd29e2df90"),l=n.n(d),f=n("ab5eb40518"),p=n.n(f),h=n("1b4cdd6a36"),v=n.n(h),g=n("3ef2352f0b"),m=n.n(g),b=(n("4a871f4295"),n("e8b2c0f5e8"),n("af802ec74b"),n("963f2eaace"),n("fdb955876a"),n("c6244f7705"),n("8ee19818c4"),n("081c8cafea"),n("d7c625d1f2")),y=n("536530eec5"),_=n("2e1bb889e5"),S=n("a7f251464e"),O=n("1c3848e586"),E=n("8a3f853387"),w=n("834b03d62c"),C=n("2c8ead4d96"),I=n("00b54de57b"),k=n("488b683127"),T=n("64973f262b"),D=n("9a4c21e153"),R=(n("9617b3921c"),n("580f342750"),n("77e684763e")),A=(n("de37db1287"),n("8e7cce0ada"),n("85d48ef22b"),n("2a6f332b5e"),n("a84962d637"),n("f45588a8ad"),n("39f57aec85")),M=n("ddb86d0a26"),x=(n("3bf1976a4f"),n("7b8243a880"),n("47ca619755"),n("bd80bf2d0f"),n("433247001a"),n("2dea9e08f0"),n("1bab7b5fb7"),n("5cd40edab3"),n("b7cba4397b")),j=n("4f3b15d017"),N=(n("229fddc286"),n("547611bd96")),L=n.n(N),U=(n("c9a7ecac4d"),n("6c6f26abf4"),n("29f8c5f672"),n("d95394beba"),n("09dd86480e"),n("342844cefa"),n("7a3400cab1"),n("8a35b54c1d"),n("b8217400dc"),n("e6f68cdf2e"),n("d66c2b8c37"),n("10f9b6de11")),P=n("725707fbbc"),F=(n("2504ad7290"),n("0aeae65bf4"),n("d0d0e18ee6"),n("c554310b5c"),n("99cf54780e")),q=n("7a5536c9bf"),B=n.n(q),Q=(n("0acdc5834b"),n("e235bb9b7e"),n("78ff1b2e5b")),W=n.n(Q),G=(n("826dc923b3"),n("5cb862f352")),H=n.n(G),V=(n("4bbb5840d5"),n("a2a09da1e3"),n("34cd92f77a"),n("85d0a7609b")),K=n.n(V),Y=(n("7b51a32a7d"),n("d388adbf11"),n("13f4809b5e"),n("bbd8fa3a89"),n("75563bc376"),n("c14c4f06d8"),n("9d7978d445"),n("63513d8b56"),n("759492dad9"),n("6e20b6a7d8"),n("9d0daf5c3f"),n("1aa20789e9"),n("8b13fcae36")),z=(n("c05a92dcb5"),n("14502724a6")),X=n.n(z),J=n("b512c0eccb"),$=Object(r.a)("IConnectionControllerService"),Z=function(e){return"".concat(String(e),"__locked")},ee=function(e){return"".concat(String(e),"__result")};function te(){return function(e,t,n){var r=n.value,i=Z(t),o=ee(t);n.value=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this[i]||(this[o]=r.call.apply(r,Object(b.__spreadArray)([this],Object(b.__read)(e),!1)),this[i]=!0),this[o]}}}function ne(e){return function(t,n,r){var i=r.value,o=Z(e),a=ee(e);r.value=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this[o]&&(this[o]=!1,this[a]=void 0),i.call.apply(i,Object(b.__spreadArray)([this],Object(b.__read)(e),!1))}}}var re=function(){function e(t){this.element=t,this.next=e.Undefined,this.prev=e.Undefined}return e.Undefined=new e(void 0),e}(),ie=function(){function e(){this.first=re.Undefined,this.last=re.Undefined,this.mSize=0}return Object.defineProperty(e.prototype,"size",{get:function(){return this.mSize},enumerable:!1,configurable:!0}),e.prototype.isEmpty=function(){return this.first===re.Undefined},e.prototype.clear=function(){this.first=re.Undefined,this.last=re.Undefined,this.mSize=0},e.prototype.unshift=function(e){return this.insert(e,!1)},e.prototype.push=function(e){return this.insert(e,!0)},e.prototype.shift=function(){if(this.first!==re.Undefined){var e=this.first.element;return this.remove(this.first),e}},e.prototype.pop=function(){if(this.last!==re.Undefined){var e=this.last.element;return this.remove(this.last),e}},e.prototype[Symbol.iterator]=function(){var e;return Object(b.__generator)(this,(function(t){switch(t.label){case 0:e=this.first,t.label=1;case 1:return e===re.Undefined?[3,3]:[4,e.element];case 2:return t.sent(),e=e.next,[3,1];case 3:return[2]}}))},e.prototype.insert=function(e,t){var n=this,r=new re(e);if(this.first===re.Undefined)this.first=r,this.last=r;else if(t){var i=this.last;this.last=r,r.prev=i,i.next=r}else{var o=this.first;this.first=r,r.next=o,o.prev=r}this.mSize+=1;var a=!1;return function(){a||(a=!0,n.remove(r))}},e.prototype.remove=function(e){if(e.prev!==re.Undefined&&e.next!==re.Undefined){var t=e.prev;t.next=e.next,e.next.prev=t,e.next=re.Undefined,e.prev=re.Undefined}else e.prev===re.Undefined&&e.next===re.Undefined?(this.first=re.Undefined,this.last=re.Undefined):e.next===re.Undefined?(this.last=this.last.prev,this.last.next=re.Undefined,e.prev=re.Undefined):e.prev===re.Undefined&&(this.first=this.first.next,this.first.prev=re.Undefined,e.next=re.Undefined);this.mSize-=1},e}(),oe=function(){function e(e){this.disposed=!1,this.options=e}return Object.defineProperty(e.prototype,"event",{get:function(){var e=this;return this.mEvent||(this.mEvent=function(t,n,r){var i,o,a;e.listeners||(e.listeners=new ie);var s=e.listeners.isEmpty();s&&(null===(i=e.options)||void 0===i?void 0:i.onFirstListenerAdd)&&e.options.onFirstListenerAdd(e);var c=e.listeners.push(n?[t,n]:t);s&&(null===(o=e.options)||void 0===o?void 0:o.onFirstListenerDidAdd)&&e.options.onFirstListenerDidAdd(e),(null===(a=e.options)||void 0===a?void 0:a.onListenerDidAdd)&&e.options.onListenerDidAdd(e,t,n);var u={dispose:function(){var t;e.disposed||(c(),(null===(t=e.options)||void 0===t?void 0:t.onLastListenerRemove)&&(e.listeners&&!e.listeners.isEmpty()||e.options.onLastListenerRemove(e)));Object(R.markTracked)(u)},disposableId:"event"};return Array.isArray(r)&&r.push(u),Object(R.trackDisposable)(u),u}),this.mEvent},enumerable:!1,configurable:!0}),e.prototype.fire=function(e){var t,n;if(this.listeners){this.deliveryQueue||(this.deliveryQueue=new ie);try{for(var r=Object(b.__values)(this.listeners),i=r.next();!i.done;i=r.next()){var o=i.value;this.deliveryQueue.push([o,e])}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}for(;this.deliveryQueue.size>0;){var a=Object(b.__read)(this.deliveryQueue.shift(),2),s=(o=a[0],a[1]);try{"function"==typeof o?o.call(void 0,s):o[0].call(o[1],s)}catch(e){console.error(e)}}}},e.prototype.dispose=function(){this.listeners&&this.listeners.clear(),this.deliveryQueue&&this.deliveryQueue.clear(),this.disposed=!0},e}();function ae(e,t){return Object.prototype.toString.call(t)==="[object ".concat(e,"]")}function se(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}var ce;!function(e){e[e.USER_INITIATIVE=72105]="USER_INITIATIVE"}(ce||(ce={}));var ue=function(e){l()(n,e);var t=se(n);function n(e,r,i,a){var s;return o()(this,n),(s=t.call(this)).docMetaDomain=e,s.authDomain=r,s.collaborateDomain=i,s.likeDomain=a,s.onEnterOnlineEmitter=new oe,s.onEnterOfflineEmitter=new oe,s.onRoomStateChangeEmitter=new oe,s.onNetReconnectedFailEmitter=new oe,s.logger=new M.a("ConnectionControllerService").use("console"),s.onEnterOnline=s.onEnterOnlineEmitter.event,s.onEnterOffline=s.onEnterOfflineEmitter.event,s.onRoomStateChange=s.onRoomStateChangeEmitter.event,s.onNetReconnectedFail=s.onNetReconnectedFailEmitter.event,s.configEventHandlerMap(),s.configMsgHandlerMap(),s}return s()(n,[{key:"openRoom",value:function(){if(!this.connectionController)throw new Error("没有 connectionController 对象，需要先通过 initConnectionControllerWithClientVars 初始化");this.connectionController.connect()}},{key:"shutDown",value:function(e){if(!this.connectionController)throw new Error("没有 connectionController 对象，需要先通过 initConnectionControllerWithClientVars 初始化");var t=Object.assign({},e);t.errCode||(t.errCode=72105),this.connectionController.disconnect(t)}},{key:"setConnectionController",value:function(e){var t=this;this.connectionController=e,this.connectionController.onConnectionEvent((function(e){t.dispathEvent(e)}))}},{key:"dispose",value:function(){var e;u()(v()(n.prototype),"dispose",this).call(this),null===(e=this.connectionController)||void 0===e||e.dispose(),this.connectionController=null}},{key:"init",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}}),e)})))}},{key:"getConnectionController",value:function(){return this.connectionController}},{key:"initConnectionControllerWithClientVars",value:function(e){var t=this,n={serverVars:e.collab_client_vars,uuId:e.userId+e.collab_client_vars.client.sid.slice(0,5),userid:e.userId,module:"ARK",uid:e.tinyid};this.connectionController=new A.ConnectionController(n),this.connectionController.onConnectionEvent((function(e){t.dispathEvent(e)}))}},{key:"configEventHandlerMap",value:function(){var e=this;this.eventHandlerMap={onEnterOnline:function(){return e.onEnterOnlineEmitter.fire(void 0)},onEnterOffline:function(){return e.onEnterOfflineEmitter.fire(void 0)},onNetReconnectedFail:function(){return e.onNetReconnectedFailEmitter.fire(void 0)},onRoomStateChange:function(t){var n;e.onRoomStateChangeEmitter.fire(null===(n=t.data)||void 0===n?void 0:n.roomState)}}}},{key:"configMsgHandlerMap",value:function(){var e=this;this.msgHandlerMap={HANDLE_DELETE:function(){return e.handleDelete()},REVERT_MESSAGE:function(){return e.handleRevertMessage()},RIGHT_MESSAGE:function(t){return e.handleRightMessage(t)},TITLE_MESSAGE:function(t){return e.handleTitleMessage(t)},USER_NEWINFO:function(t){return e.handleNewUserInfo(t)},USER_NEWINFOS:function(t){return e.handleNewUserInfos(t)},USER_LEAVE:function(t){return e.handleUserLeave(t)},USER_LEAVES:function(t){return e.handleUserLeaves(t)},COMMERCIALIZE_MESSAGE:function(t){return e.handleCommerCializeMessage(t)},COMMERICILIZE_MESSAGE:function(t){return e.handleCommerIcilizeMessage(t)},MARK_MESSAGE:function(t){return e.handleMarkMessage(t)},COMM_NOTICE:function(t){return e.handleCommNotice(t)}}}},{key:"onRoomShutDown",value:function(e){if(e){var t=e.errCode;72105!==(void 0===t?0:t)||this.logger.info("info  = onRoomShutDown = type or errCode === USER_SHUTDOWN_CODE")}else this.logger.info("info  = onRoomShutDown = type or closeReason is null")}},{key:"onReceiveMsgFromServer",value:function(e){if((null==e?void 0:e.type)&&ae("Array",null==e?void 0:e.data)){var t=e.type,n=e.data,r=this.msgHandlerMap[t];r&&r(n)}else this.logger.error("error = onReceiveMsgFromServer, type or receiveData.data is null")}},{key:"dispathEvent",value:function(e){var t,n,r=this.eventHandlerMap[e.event];r?r(e):"OnReceiveMsgFromServer"===e.event?this.onReceiveMsgFromServer(null===(t=e.data)||void 0===t?void 0:t.serverMsg):"OnRoomShutDown"===e.event&&this.onRoomShutDown(null===(n=e.data)||void 0===n?void 0:n.closeReason)}},{key:"handleDelete",value:function(){this.docMetaDomain.docMetaEntity.handleNoticeDeleted()}},{key:"handleRevertMessage",value:function(){this.logger.debug("REVERT_MESSAGE")}},{key:"handleRightMessage",value:function(e){var t=this;this.logger.debug("RIGHT_MESSAGE"),e.forEach((function(e){var n;t.authDomain.authAggregate.authInfoEntity.onReceiveMessageFromServer(null===(n=null==e?void 0:e.body)||void 0===n?void 0:n.notice,t.connectionController)}))}},{key:"handleTitleMessage",value:function(e){var t=this;e.forEach((function(e){var n=e.body.notice;t.docMetaDomain.docMetaEntity.handleNoticeTitleChanged(n.title)}))}},{key:"handleNewUserInfo",value:function(e){var t=this;e.forEach((function(e){var n=e.body.notice,r={sessionType:n.session_type,userId:n.userId,uuId:n.uuId,vipInfo:n.vip_info},i={memCount:n.mem_count,notices:[r]};t.collaborateDomain.collaborateAggregate.handleUserComeIn(i)}))}},{key:"handleNewUserInfos",value:function(e){var t=this;e.forEach((function(e){var n=e.body,r=n.notices,i=n.mem_count,o=[];null==r||r.forEach((function(e){var t={sessionType:e.session_type,userId:e.userId,uuId:e.uuId,vipInfo:e.vip_info};o.push(t)}));var a={memCount:i,notices:o};t.collaborateDomain.collaborateAggregate.handleUserComeIn(a)}))}},{key:"handleUserLeave",value:function(e){var t=this;e.forEach((function(e){var n=e.body.notice,r={sessionType:n.session_type,userId:n.userId,uuId:n.uuId,vipInfo:n.vip_info},i={memCount:n.mem_count,notices:[r]};t.collaborateDomain.collaborateAggregate.handleUserLeave(i)}))}},{key:"handleUserLeaves",value:function(e){var t=this;e.forEach((function(e){var n=e.body,r=n.notices,i=n.mem_count,o=[];null==r||r.forEach((function(e){var t={sessionType:e.session_type,userId:e.userId,uuId:e.uuId,vipInfo:e.vip_info};o.push(t)}));var a={memCount:i,notices:o};t.collaborateDomain.collaborateAggregate.handleUserLeave(a)}))}},{key:"handleCommerCializeMessage",value:function(e){var t=this;this.likeDomain.likeEntity.handleRealTimeLikeMessage(e),e.forEach((function(e){t.collaborateDomain.collaborateAggregate.handleCommerIcilizeMessage(e)}))}},{key:"handleCommerIcilizeMessage",value:function(e){var t=this;e.forEach((function(e){t.collaborateDomain.collaborateAggregate.handleCommerIcilizeMessage(e)}))}},{key:"handleMarkMessage",value:function(e){this.logger.debug(e)}},{key:"handleCommNotice",value:function(e){this.logger.debug(e)}}]),n}(R.Disposable);Object(b.__decorate)([ne("init"),Object(b.__metadata)("design:type",Function),Object(b.__metadata)("design:paramtypes",[]),Object(b.__metadata)("design:returntype",void 0)],ue.prototype,"dispose",null),Object(b.__decorate)([te(),Object(b.__metadata)("design:type",Function),Object(b.__metadata)("design:paramtypes",[]),Object(b.__metadata)("design:returntype",Promise)],ue.prototype,"init",null),ue=Object(b.__decorate)([Object(b.__param)(0,y.a),Object(b.__param)(1,_.a),Object(b.__param)(2,S.a),Object(b.__param)(3,O.a),Object(b.__metadata)("design:paramtypes",[Object,Object,Object,Object])],ue);var de=x.a.getConfig('npm["@tencent/ark-application"]'),le=window.location.host;null==de||de.TENCENT_DOCS_HOME,new RegExp((null==de?void 0:de.TENCENT_DOCS_EDITOR_REGEXP)||"docs\\.qq\\.com\\/.+\\/[BD].+"),null==de||de.WECOM_DOCS_HOME,null==de||de.WECOM_DOCS_EDITOR;null==de||de.FEEDBACK_URL;var fe=(null==de?void 0:de.EXACTLY_PARENT_TOC_COOKIE_DOMAIN)||"qq.com",pe=(null==de?void 0:de.PARENT_TOC_COOKIE_DOMAIN)||".qq.com",he=(null==de?void 0:de.TOC_COOKIE_DOMAIN)||".docs.qq.com",ve=(null==de?void 0:de.PARENT_TOB_COOKIE_DOMAIN)||".weixin.qq.com",ge=(null==de?void 0:de.TOB_COOKIE_DOMAIN)||".doc.weixin.qq.com",me=(null==de?void 0:de.WECOM_HOME_PAGE)||"https://doc.weixin.qq.com/home/recent";null==de||de.PAGE_JUMP_TO_C,new RegExp((null==de?void 0:de.TOC_HOME_PAGE_REGEXP)||"docs\\.qq\\.com\\/desktop(\\/)?","i");var be=(null==de?void 0:de.TOB_LOGIN_PAGE_URL)||"https://doc.weixin.qq.com/disklogin/login",ye=(null==de?void 0:de.TOC_HOME_PAGE)||"https://docs.qq.com/desktop",_e=(null==de?void 0:de.C_JUMP_TO_B_URL)||"https://docs.qq.com/scenario/page-jump-to-b.html";null==de||de.C_JUMP_TOB_LOGIN_PAGE_URL;var Se=(null==de?void 0:de.C_LOGIN_URL)||"https://docs.qq.com/scenario/login.html";new RegExp((null==de?void 0:de.TOB_HOME_PAGE_REGEXP)||"doc\\.weixin\\.qq\\.com\\/home\\/recent(\\/)?","i"),new RegExp((null==de?void 0:de.TOB_MALL_PAGE_REGEXP)||"doc\\.weixin\\.qq\\.com\\/mall\\/index(\\/)?","i"),new RegExp((null==de?void 0:de.TOC_MALL_PAGE_REGEXP)||"docs\\.qq\\.com\\/mall(\\/)?","i"),null==de||de.TOC_MALL_PAGE;var Oe=Symbol.for("swr-decorator:fetcherMap");function Ee(e){return function(t,n){var r=Reflect.getMetadata(Oe,t)||new Map;r.set(e,n),Reflect.defineMetadata(Oe,r,t)}}var we=Symbol.for("swr-decorator:properties");function Ce(e,t){var n,r=null!==(n=Reflect.getMetadata(we,e))&&void 0!==n?n:[];r.push(t),Reflect.defineMetadata(we,r,e)}function Ie(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}var ke=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];o()(this,e),this.value=t,this.fetcher=n,this.subscribers=new Set,this.validating=!1,this.firstRequire=!1,this.updatePropertiesOnFirstRequire=r}return s()(e,[{key:"getValue",value:function(){var e=this;return this.updatePropertiesOnFirstRequire&&!this.firstRequire&&(setTimeout((function(){return e.revalidate()}),0),this.firstRequire=!0),this.value}},{key:"getValueMutate",value:function(){return this.revalidate(),this.value}},{key:"setValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.value=e,t||this.subscribers.forEach((function(t){return t(e)})),!0}},{key:"addSubscriber",value:function(e){this.subscribers.add(e)}},{key:"removeSubscriber",value:function(e){this.subscribers.delete(e)}},{key:"isValidating",value:function(){return this.validating}},{key:"revalidate",value:function(){var e=this;this.validating||this.fetcher&&(this.validating=!0,this.fetcher().then((function(t){e.validating=!1,e.setValue(t)})).catch((function(t){throw e.validating=!1,t})))}}]),e}();function Te(e){var t=(null!=e?e:{}).updatePropertiesOnFirstRequire;return function(e){var n=new Map;return function(e){l()(i,e);var r=Ie(i);function i(){var e,a,s;o()(this,i);for(var c=arguments.length,u=new Array(c),d=0;d<c;d++)u[d]=arguments[d];e=r.call.apply(r,[this].concat(u));var l={},f=null!==(a=Reflect.getMetadata(Oe,L()(e)))&&void 0!==a?a:new Map;return(null!==(s=Reflect.getMetadata(we,L()(e)))&&void 0!==s?s:[]).forEach((function(r){var i,o=f.get(r),a=null===(i=e[o])||void 0===i?void 0:i.bind(L()(e)),s=new ke(e[r],a,t);n.set(r,s),l[r]={get:function(){return s.getValue()},set:function(e){return s.setValue(e),!0}},e[o]=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Object(b.__awaiter)(L()(e),void 0,void 0,m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.apply(void 0,n);case 2:return t=e.sent,s.setValue(t),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)})))}})),Object.defineProperties(L()(e),l),e}return s()(i,[{key:"isValidating",value:function(e){var t,r;return null!==(r=null===(t=n.get(e))||void 0===t?void 0:t.isValidating())&&void 0!==r&&r}},{key:"subscribe",value:function(e,t){var r;return null===(r=n.get(e))||void 0===r||r.addSubscriber(t),function(){var r;null===(r=n.get(e))||void 0===r||r.removeSubscriber(t)}}},{key:"mutate",value:function(e,t){return Object(b.__awaiter)(this,arguments,void 0,(function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return m.a.mark((function i(){var o,a;return m.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:void 0!==t&&(null===(o=n.get(e))||void 0===o||o.setValue(t,!0)),r&&(null===(a=n.get(e))||void 0===a||a.revalidate());case 2:case"end":return i.stop()}}),i)}))()}))}}]),i}(e)}}var De={nick:"nickname",avatar:"avatarURI",uType:"accountType",phone:"phoneNumber",isHasPassword:"enabled",utype:"accountType",uin:"qq"},Re={raw:De,words:Object.keys(De)},Ae={};function Me(){return"undefined"!=typeof window}function xe(){return void 0!==e}var je=Me()?window:xe()?e:Me||"undefined"==typeof self?(xe()&&e.describe,Ae):self;function Ne(e,t){return null!==e&&Object.prototype.hasOwnProperty.call(e,t)}var Le="location";function Ue(){return Ne(je,Le)?location.search:""}function Pe(e,t){if(void 0===t&&(t={shouldDecodeURI:!1}),!Ne(je,Le))return"";var n=new RegExp("(\\?|&)".concat(e,"=([^&]*)(#|&|$)")),r=((null==t?void 0:t.shouldDecodeURI)?decodeURIComponent(Ue()):Ue()).match(n);return r?decodeURIComponent(r[2]):""}var Fe,qe=["/doc/","/sheet/","/slide/","/form/","/mind/","/flowchart/","/pdf/"],Be=function(){function e(){if(o()(this,e),j.default.isMiniProgram)return new Qe;try{var t=new P.StorageManager({type:this.isSupportClientDB()?P.DBEngineType.nativeDB:P.DBEngineType.indexDB,disableAutoOpen:!1}).storage.collection(U.UserInfo);this.userInfoStorage=new P.UserInfoStorage(t),this.onOfflineState=!1}catch(e){return console.error(e),new Qe}}return s()(e,[{key:"setOnOfflineState",value:function(e){this.onOfflineState=e}},{key:"addUserInfo",value:function(e){if(F.network&&F.network.isOnline&&!this.onOfflineState&&(null==e?void 0:e.tinyId)&&e.tinyId!==E.h){var t=new U.UserInfo(Object.assign(Object.assign({},e),this.getDocInfo()));this.userInfoStorage.addUserInfo(t)}}},{key:"updateUserInfo",value:function(e){F.network&&F.network.isOnline&&(e.tinyId===E.h||this.onOfflineState||this.userInfoStorage.updateUserInfo({tinyId:e.tinyId},e))}},{key:"getUserInfo",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n,r,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=Pe("u"))){e.next=7;break}return e.t0=this,e.next=5,this.userInfoStorage.getUserInfoByNowUserIndex(t);case 5:return e.t1=e.sent,e.abrupt("return",e.t0.changeOfflineData.call(e.t0,e.t1));case 7:return n=this.getDocInfo(),r=n.pageType,i=n.docId,e.t2=this,e.next=11,this.userInfoStorage.getUserInfoByDocInfo(r,i);case 11:return e.t3=e.sent,e.abrupt("return",e.t2.changeOfflineData.call(e.t2,e.t3));case 13:case"end":return e.stop()}}),e,this)})))}},{key:"changeOfflineData",value:function(e){if(!e)return null;var t={tinyId:e.tinyId,corpId:e.corpId,corpName:e.corpName,englishName:e.englishName,loginType:e.loginType,uidSource:e.uidSource,openId:e.openId,uin:e.uin,userId:e.userId,userName:e.userName,userPic:e.userPic,nowUserIndex:e.nowUserIndex,settings:e.settings,wedriveUin:e.wedriveUin||""},n=e.bindUserInfo;return{userInfo:t,vipInfo:e.vipUserInfo,bindUserInfo:n}}},{key:"isSupportClientDB",value:function(){var e=/_tdocFlag\/(\d+)/.exec(navigator.userAgent);return!!(null==e?void 0:e[1])&&(2&parseInt(e[1],10))>0}},{key:"getDocInfo",value:function(){var e=null===globalThis||void 0===globalThis?void 0:globalThis.location.pathname.split("/"),t=e[1];return qe.filter((function(e){return globalThis.location.pathname.includes(e)})).length>0?{pageType:t,docId:e[2],updateTime:Date.now().toString()}:{pageType:t,docId:t,updateTime:Date.now().toString()}}}]),e}(),Qe=function(){function e(){o()(this,e)}return s()(e,[{key:"setOnOfflineState",value:function(){}},{key:"addUserInfo",value:function(){}},{key:"updateUserInfo",value:function(){}},{key:"getUserInfo",value:function(){return Promise.resolve(null)}}]),e}();!function(e){e.SUCCESS="SUCCESS",e.MAIN_SUCCESS_SECOND_FAIL="MAIN_SUCCESS_SECOND_FAIL",e.MAIN_FAIL_SECOND_SUCCESS="MAIN_FAIL_SECOND_SUCCESS",e.FAIL="FAIL",e.NOT_EXIST="NOT_EXIST"}(Fe||(Fe={}));var We,Ge=function(){function e(t,n){o()(this,e),this.accountDomainService=t,this.messageDomainService=n}return s()(e,[{key:"getPersonalAccountList",value:function(e,t){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function n(){return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.getFetchAccountList(e,t);case 2:return this.fetchAccountList=n.sent,n.abrupt("return",this.mergeAccountList(this.fetchAccountList,[]));case 4:case"end":return n.stop()}}),n,this)})))}},{key:"getFetchAccountList",value:function(e,t){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function n(){return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.accountDomainService.accountAggregate.accountListEntity.getAccountList(e,t);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n,this)})))}},{key:"deleteAccountForList",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n,r,i;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.uid,r=e.userIndex,i=!0,!this.isHasSameTinyID(this.fetchAccountList,n)){t.next=7;break}return t.next=6,this.deleteFetchAccountList(e);case 6:i=t.sent;case 7:return i&&W.a.postMessage({type:w.a.LOGOUT,data:r,needCookie:!0}),t.abrupt("return",this.changeDeleteAccountState(i,!0));case 9:case"end":return t.stop()}}),t,this)})))}},{key:"changeSign",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.userIndex){t.next=3;break}return t.abrupt("return",!1);case 3:return t.next=5,this.accountDomainService.accountAggregate.accountListEntity.changeSign(n);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"dispose",value:function(){this.messageDomainService.getEnterpriseAccountListMessage.dispose()}},{key:"changeDeleteAccountState",value:function(e,t){return e&&t?Fe.SUCCESS:e?Fe.MAIN_SUCCESS_SECOND_FAIL:t?Fe.MAIN_FAIL_SECOND_SUCCESS:Fe.FAIL}},{key:"deleteFetchAccountList",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.userIndex){t.next=3;break}return t.abrupt("return",!1);case 3:return t.next=5,this.accountDomainService.accountAggregate.accountListEntity.delAccountForList(n);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"mergeAccountList",value:function(e,t){var n=this;return t.reduce((function(e,t){return n.isHasSameTinyID(e,t.uid)?e:[].concat(B()(e),[t])}),e)}},{key:"isHasSameTinyID",value:function(e,t){return e.some((function(e){return e.uid===t}))}},{key:"getEnterpriseAccountList",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n=this;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.messageDomainService.getEnterpriseAccountListMessage.connect(),this.getIframeMountMessage(),this.messageDomainService.getEnterpriseAccountListMessage.createGetAccountListIframe((function(){n.messageDomainService.getEnterpriseAccountListMessage.sendAccountListMessage()})),e.next=5,this.getAccountListMessage();case 5:return t=e.sent,e.abrupt("return",t);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"deleteEnterpriseAccountList",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.cookie){t.next=3;break}return t.abrupt("return",!1);case 3:return this.messageDomainService.getEnterpriseAccountListMessage.sendDeleteAccountMessage(n),t.next=6,this.getDeleteAccountMessage();case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t,this)})))}},{key:"getAccountListMessage",value:function(){var e=this;return new Promise((function(t){e.messageDomainService.getEnterpriseAccountListMessage.getAccountListMessage((function(e){var n=e.data.userList;t(n)}))}))}},{key:"getDeleteAccountMessage",value:function(){var e=this;return new Promise((function(t){e.messageDomainService.getEnterpriseAccountListMessage.getDeleteAccountMessage((function(){t(!0)}))}))}},{key:"getIframeMountMessage",value:function(){var e=this;return new Promise((function(t){e.messageDomainService.getEnterpriseAccountListMessage.getIframeMountMessage((function(){t(!0),e.messageDomainService.getEnterpriseAccountListMessage.sendAccountListMessage()}))}))}}]),e}();Ge=Object(b.__decorate)([Object(b.__param)(0,C.a),Object(b.__param)(1,I.a),Object(b.__metadata)("design:paramtypes",[Object,Object])],Ge),function(e){e.BIND_CGI_SUCCESS="BIND_CGI_SUCCESS",e.CHECK_KEY_IS_READY="CHECK_KEY_IS_READY",e.BIND_POLLING_RUNNING="BIND_POLLING_RUNNING",e.BIND_POLLING_FINISH="BIND_POLLING_FINISH",e.BIND_TIMEOUT="BIND_TIMEOUT",e.ERROR="ERROR"}(We||(We={}));var He,Ve,Ke=function(){function e(t){o()(this,e),this.accountDomainService=t,this.isExpired=!1}return s()(e,[{key:"getBindingQQAccountInfo",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountDomainService.accountAggregate.bindingQQInfo();case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"getStatus",value:function(e){var t=this;return this.runBindProcess(e),{dispose:function(){return t.dispose()}}}},{key:"runBindProcess",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n,r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.accountDomainService.accountAggregate.accountRepository.bindUserInfo();case 2:n=t.sent,0===(null==(r=n.resData)?void 0:r.cgicode)?(e(We.BIND_CGI_SUCCESS),this.getKey(e)):e(We.ERROR,{errBindQQStatus:We.BIND_CGI_SUCCESS});case 5:case"end":return t.stop()}}),t,this)})))}},{key:"dispose",value:function(){this.pollingTimer&&clearTimeout(this.pollingTimer),this.isExpired=!0}},{key:"getKey",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n,r,i;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.accountDomainService.accountAggregate.userInfo.nowUserIndex,t.next=3,this.accountDomainService.accountAggregate.accountRepository.getBindWxQrCode(n);case 3:if(r=t.sent,0!==(null==(i=r.resData)?void 0:i.cgicode)){t.next=9;break}return e(We.CHECK_KEY_IS_READY),this.runPolling(i.data.checkKey,e),t.abrupt("return");case 9:e(We.ERROR,{errBindQQStatus:We.CHECK_KEY_IS_READY});case 10:case"end":return t.stop()}}),t,this)})))}},{key:"runPolling",value:function(e,t){var n=this;this.isExpired||(this.pollingTimer=setTimeout((function(){return Object(b.__awaiter)(n,void 0,void 0,m.a.mark((function n(){var r,i;return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.accountDomainService.accountAggregate.accountRepository.getBindProcess(e);case 2:if(r=n.sent,i=r.resData,clearTimeout(this.pollingTimer),0!==(null==i?void 0:i.cgicode)){n.next=15;break}if(!i.data.isFinish){n.next=9;break}return t(We.BIND_POLLING_FINISH),n.abrupt("return");case 9:if(!(Number(i.data.lastUpdateRs)>15)){n.next=12;break}return t(We.BIND_POLLING_FINISH,{progress:this.getProgress(i.data.totalNum,i.data.succNum)}),n.abrupt("return");case 12:return t(We.BIND_POLLING_RUNNING,{progress:this.getProgress(i.data.totalNum,i.data.succNum)}),this.runPolling(e,t),n.abrupt("return");case 15:t(We.ERROR,{errBindQQStatus:We.BIND_POLLING_RUNNING});case 16:case"end":return n.stop()}}),n,this)})))}),1e3))}},{key:"getProgress",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e?Math.floor(t/e):1}}]),e}();function Ye(e,t,n){var r,i=this;return Ve=t,function(o){return function a(){return Object(b.__awaiter)(i,void 0,void 0,m.a.mark((function i(){var s,c,u;return m.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(Ve===t){i.next=2;break}return i.abrupt("return");case 2:return i.next=4,e.loginRepository.updateWeChatLoginQRCodeStatus(t,n);case 4:if(s=i.sent,c=s.error,u=s.resData,!c){i.next=10;break}return o({status:He.ERROR}),i.abrupt("return");case 10:if(!(null==u?void 0:u.data.status.isFinish)){i.next=13;break}return o({status:He.USER_HAS_CONFIRMED}),i.abrupt("return");case 13:r=setTimeout(a,1e3);case 14:case"end":return i.stop()}}),i)})))}(),setTimeout((function(){Ve===t&&o({status:He.CODE_WAS_EXPIRED}),clearTimeout(r)}),58e3),function(){return clearTimeout(r)}}}Ke=Object(b.__decorate)([Object(b.__param)(0,C.a),Object(b.__metadata)("design:paramtypes",[Object])],Ke),function(e){e.CODE_IS_READY="CODE_IS_READY",e.USER_HAS_SCANNED="USER_HAS_SCANNED",e.CODE_WAS_EXPIRED="CODE_WAS_EXPIRED",e.USER_HAS_CONFIRMED="USER_HAS_CONFIRMED",e.ERROR="ERROR"}(He||(He={}));var ze=function(){function e(t,n){o()(this,e),this.accountDomainService=t,this.loginDomainService=n}return s()(e,[{key:"getQRCode",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n,r,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.accountDomainService.accountAggregate.userInfo.nowUserIndex,e.next=3,this.accountDomainService.accountAggregate.accountRepository.getBindWxQrCode(t);case 3:if(n=e.sent,r=n.error,i=n.resData,!r){e.next=7;break}throw r;case 7:return e.abrupt("return",this.convertWeChatQRCodeResponse(null==i?void 0:i.data));case 8:case"end":return e.stop()}}),e,this)})))}},{key:"convertWeChatQRCodeResponse",value:function(e){var t=null!=e?e:{},n=t.img,r=t.checkKey;if(!n||!r)throw Error("获取微信二维码失败");return{id:r,image:"data:image/png;base64,".concat(n),subscribe:Ye(this.loginDomainService.loginAggregate,r)}}}]),e}();ze=Object(b.__decorate)([Object(b.__param)(0,C.a),Object(b.__param)(1,k.a),Object(b.__metadata)("design:paramtypes",[Object,Object])],ze);var Xe,Je,$e=function(){function e(t,n){o()(this,e),this.accountDomainService=t,this.loginDomainService=n}return s()(e,[{key:"qqBind",value:function(e){return this.qqBindApplication||(this.qqBindApplication=new Ke(this.accountDomainService)),this.qqBindApplication.getStatus(e)}},{key:"wechatBind",value:function(){return this.wechatBindApplication=new ze(this.accountDomainService,this.loginDomainService),this.wechatBindApplication.getQRCode()}},{key:"getQQBindingInfo",value:function(){return this.qqBindApplication||(this.qqBindApplication=new Ke(this.accountDomainService)),this.qqBindApplication.getBindingQQAccountInfo()}},{key:"getCurrentAccountBindingInfo",value:function(){return this.accountDomainService.accountAggregate.currentLoginAccountBindInfo()}}]),e}();$e=Object(b.__decorate)([Object(b.__param)(0,C.a),Object(b.__param)(1,k.a),Object(b.__metadata)("design:paramtypes",[Object,Object])],$e),function(e){e.CODE_IS_READY="CODE_IS_READY",e.USER_HAS_SCANNED="USER_HAS_SCANNED",e.CODE_WAS_EXPIRED="CODE_WAS_EXPIRED",e.LOGIN_SUCCESS="LOGIN_SUCCESS",e.ERROR="ERROR"}(Xe||(Xe={})),function(e){e[e.WECHAT_LOGIN_CASE_DEFAULT=0]="WECHAT_LOGIN_CASE_DEFAULT",e[e.WECHAT_LOGIN_CASE_H5=1]="WECHAT_LOGIN_CASE_H5"}(Je||(Je={}));var Ze,et=function(){function e(t){o()(this,e),this.loginDomainService=t,this.isExpired=!1}return s()(e,[{key:"login",value:function(e){var t=this;return this.runLoginProcess(e),{dispose:function(){return t.dispose()}}}},{key:"dispose",value:function(){this.qrTimer&&clearTimeout(this.qrTimer),this.pollingTimer&&clearTimeout(this.pollingTimer),this.isExpired=!0}},{key:"runLoginProcess",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getWechatLoginQRcode(e);case 2:if(n=t.sent){t.next=5;break}return t.abrupt("return");case 5:this.isExpired=!1,this.runPolling(n,e),this.runQRTimer(e);case 8:case"end":return t.stop()}}),t,this)})))}},{key:"getWechatLoginQRcode",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n,r,i,o;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loginDomainService.loginAggregate.loginRepository.getWeChatLogInQRCodeURI();case 2:if(n=t.sent,0!==(null==(r=n.resData)?void 0:r.retcode)){t.next=11;break}return i=r.data.checkKey,t.next=8,this.getQRcode(i,e);case 8:return o=t.sent,e(Xe.CODE_IS_READY,{qrCodeImage:o}),t.abrupt("return",r.data.checkKey);case 11:return e(Xe.ERROR,{errorQrQQLoginStatus:Xe.CODE_IS_READY}),t.abrupt("return","");case 13:case"end":return t.stop()}}),t,this)})))}},{key:"getQRcode",value:function(e,t){return new Promise((function(n){H.a.make("https://".concat(le,"/scenario/qr-h5login.html?key=").concat(e)).then((function(e){return n(e)})).catch((function(){t(Xe.ERROR,{errorQrQQLoginStatus:Xe.CODE_IS_READY})}))}))}},{key:"runPolling",value:function(e,t){var n=this;this.isExpired||(this.pollingTimer=setTimeout((function(){return Object(b.__awaiter)(n,void 0,void 0,m.a.mark((function n(){var r,i,o,a,s,c;return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.loginDomainService.loginAggregate.loginRepository.updateEnterpriseWeChatLoginQRCodeStatus(e);case 2:if(o=n.sent,0===(null==(a=o.resData)?void 0:a.retcode)){n.next=9;break}return t(Xe.ERROR,{errorQrQQLoginStatus:Xe.USER_HAS_SCANNED}),clearTimeout(this.qrTimer),clearTimeout(this.pollingTimer),n.abrupt("return");case 9:if(s=null!==(i=null===(r=null==a?void 0:a.data)||void 0===r?void 0:r.status)&&void 0!==i?i:{},c=s.loginScanFlag,!s.login){n.next=15;break}return t(Xe.LOGIN_SUCCESS,{changeKey:e}),clearTimeout(this.qrTimer),clearTimeout(this.pollingTimer),n.abrupt("return");case 15:c&&t(Xe.USER_HAS_SCANNED),clearTimeout(this.pollingTimer),this.runPolling(e,t);case 18:case"end":return n.stop()}}),n,this)})))}),1e3))}},{key:"runQRTimer",value:function(e){var t=this;this.qrTimer=setTimeout((function(){e(Xe.CODE_WAS_EXPIRED),t.isExpired=!0,clearTimeout(t.qrTimer)}),58e3)}}]),e}();et=Object(b.__decorate)([Object(b.__param)(0,k.a),Object(b.__metadata)("design:paramtypes",[Object])],et),function(e){e.UPDATE_USER_INDEX="account:update-user-index",e.DELETE_USER_INDEX="account:delete-user-index",e.SWITCH_USER_INDEX="account:switch-user-index"}(Ze||(Ze={}));var tt,nt="https://".concat(le,"/tim/docs/components/BindQQ.html?type=login"),rt=function(e){return nt+(e?"&autojump=1":"")};!function(e){e.IFRAME_MESSAGE_CONNECTED="IFRAME_MESSAGE_CONNECTED",e.IFRAME_DOM_MOUNTED="IFRAME_DOM_MOUNTED",e.USER_HAS_CONFIRMED="USER_HAS_CONFIRMED",e.LOGIN_SUCCESS="LOGIN_SUCCESS",e.ERROR="ERROR"}(tt||(tt={}));var it=function(){function e(t,n){o()(this,e),this.loginDomainService=t,this.messageDomainService=n}return s()(e,[{key:"login",value:function(e,t){var n=this;return this.runLoginProcess(e,t),{dispose:function(){return n.disposeQQLoginIframe()}}}},{key:"disposeQQLoginIframe",value:function(){this.messageDomainService.qqMessage.qqLoginMessage.dispose()}},{key:"loadQQLoginIframe",value:function(e,t){var n,r,i;this.messageDomainService.qqMessage.qqLoginMessage.connect(),this.getLoadQQLoginIframeMessage(t),this.messageDomainService.qqMessage.qqLoginMessage.createQQLoginIframe(e.qqPtLoginIframeRenderDom,this.getQQLoginIframeSrc(null!==(n=null==e?void 0:e.useOauth)&&void 0!==n&&n,null===(r=e.isCheckAutoLogin)||void 0===r||r,null!==(i=e.isJumpFromQQClient)&&void 0!==i&&i,e.isJumpFromQQClient?Pe("jumpuin"):""))}},{key:"runLoginProcess",value:function(e,t){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function n(){var r;return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.loadQQLoginIframe(e,t),n.next=3,this.getQQLoginSuccessMessage(t);case 3:if(r=n.sent,!e.disableUserInfoAutoUpdating){n.next=7;break}return t(tt.LOGIN_SUCCESS,{}),n.abrupt("return");case 7:return n.next=9,this.checkQQLogin(t,r,e.loginApiData);case 9:case"end":return n.stop()}}),n,this)})))}},{key:"getQQLoginIframeSrc",value:function(e,t,n,r){var i,o=e?(i=rt(n),"https://graph.qq.com/oauth2.0/authorize?which=Login&display=pc&response_type=code&theme=10&client_id=101458937&redirect_uri=".concat(encodeURIComponent(i),"&state=state")):function(e,t){return"https://xui.ptlogin2.qq.com/cgi-bin/xlogin?theme=4&appid=1600000931&pt_no_auth=1&daid=536&link_target=blank&target=self&hide_close_icon=1&style=20&low_login_enable=".concat(e?1:0,"&low_login_foreced=1&low_login_hour=720&hide_border=1&s_url=").concat(encodeURIComponent(t),"&pt_isdocs=0")}(t,rt(n));return r?"".concat(o,"&jumpuin=").concat(r):o}},{key:"getLoadQQLoginIframeMessage",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.messageDomainService.qqMessage.qqLoginMessage.getQQIframeMessage((function(){e(tt.IFRAME_DOM_MOUNTED)}));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"getQQLoginSuccessMessage",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n=this;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){n.messageDomainService.qqMessage.qqLoginMessage.getQQLoginSuccessMessage((function(n){e(tt.USER_HAS_CONFIRMED);var r=n.data;if("string"==typeof r&&r.startsWith("login qq oauth success")&&r.includes("code=")){var i=r.slice(r.indexOf("code=")+5);t({success:!0,code:i})}t({success:!0})}))})));case 1:case"end":return t.stop()}}),t)})))}},{key:"checkQQLogin",value:function(e,t,n){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function r(){var i,o,a,s,c,u;return m.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(c={},!t.code){r.next=7;break}return r.next=4,this.loginDomainService.loginAggregate.loginRepository.checkQQOAuthLogin(t.code,n);case 4:c=r.sent,r.next=10;break;case 7:return r.next=9,this.loginDomainService.loginAggregate.loginRepository.checkQQLogin();case 9:c=r.sent;case 10:if(!(null==(u=c.resData)?void 0:u.data.userIndex)){r.next=15;break}return e(tt.LOGIN_SUCCESS,{userIndex:null==u?void 0:u.data.userIndex}),null===(o=null===(i=navigator.serviceWorker)||void 0===i?void 0:i.controller)||void 0===o||o.postMessage({type:Ze.SWITCH_USER_INDEX,data:{userIndex:u.data.userIndex,url:location.href}}),r.abrupt("return");case 15:if(0!==(null==u?void 0:u.cgicode)){r.next=19;break}return e(tt.LOGIN_SUCCESS),null===(s=null===(a=navigator.serviceWorker)||void 0===a?void 0:a.controller)||void 0===s||s.postMessage({type:Ze.SWITCH_USER_INDEX,data:{url:location.href}}),r.abrupt("return");case 19:e(tt.ERROR,{errorQrQQLoginStatus:tt.LOGIN_SUCCESS});case 20:case"end":return r.stop()}}),r,this)})))}}]),e}();it=Object(b.__decorate)([Object(b.__param)(0,k.a),Object(b.__param)(1,I.a),Object(b.__metadata)("design:paramtypes",[Object,Object])],it);var ot=function(){function e(t,n,r){o()(this,e),this.messageDomainService=t,this.loginDomainService=n,this.accountDomainService=r,this.isExpired=!1}return s()(e,[{key:"login",value:function(e,t){var n=this;return this.runLoginProcess(e,t),{dispose:function(){return n.dispose()}}}},{key:"dispose",value:function(){this.qrTimer&&clearTimeout(this.qrTimer),this.pollingTimer&&clearTimeout(this.pollingTimer),this.isExpired=!0}},{key:"runLoginProcess",value:function(e,t){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function n(){var r;return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(null==t?void 0:t.useOfficialAccountOrH5)?this.getWechatLoginQRUrl(e,t):this.getWechatLoginQRcode(e);case 2:if(r=n.sent){n.next=5;break}return n.abrupt("return");case 5:this.isExpired=!1,this.runPolling(r,e,null==t?void 0:t.pollingApiData),this.runQRTimer(r,e);case 8:case"end":return n.stop()}}),n,this)})))}},{key:"getWechatLoginQRcode",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n,r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loginDomainService.loginAggregate.loginRepository.getWeChatLogInQRCodeURI();case 2:if(n=t.sent,0!==(null==(r=n.resData)?void 0:r.retcode)){t.next=7;break}return e(Xe.CODE_IS_READY,{qrCodeImage:"data:image/png;base64,".concat(r.data.img),checkKey:r.data.checkKey}),t.abrupt("return",r.data.checkKey);case 7:return e(Xe.ERROR,{errorQrQQLoginStatus:Xe.CODE_IS_READY}),t.abrupt("return","");case 9:case"end":return t.stop()}}),t,this)})))}},{key:"getWechatLoginQRUrl",value:function(e,t){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function n(){var r,i;return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.loginDomainService.loginAggregate.loginRepository.getWeChatLogInQRURI(null==t?void 0:t.wechatLoginCase);case 2:if(r=n.sent,0!==(null==(i=r.resData)?void 0:i.retcode)){n.next=7;break}return e(Xe.CODE_IS_READY,{qrCodeUrl:i.data.url,checkKey:i.data.checkKey}),n.abrupt("return",i.data.checkKey);case 7:return e(Xe.ERROR,{errorQrQQLoginStatus:Xe.CODE_IS_READY}),n.abrupt("return","");case 9:case"end":return n.stop()}}),n,this)})))}},{key:"runPolling",value:function(e,t,n){var r=this,i=this.accountDomainService.accountAggregate.userInfo.nowUserIndex;this.isExpired||(this.pollingTimer=setTimeout((function(){return Object(b.__awaiter)(r,void 0,void 0,m.a.mark((function r(){var o,a,s,c,u,d,l,f;return m.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.loginDomainService.loginAggregate.loginRepository.updateWeChatLoginQRCodeStatus(e,n);case 2:if(u=r.sent,0===(null==(d=u.resData)?void 0:d.retcode)){r.next=10;break}return W.a.postMessage({type:w.a.LOGIN,data:i,needCookie:!0}),t(Xe.ERROR,{errorQrQQLoginStatus:Xe.USER_HAS_SCANNED,checkKey:e}),clearTimeout(this.qrTimer),clearTimeout(this.pollingTimer),r.abrupt("return");case 10:if(l=null!==(a=null===(o=null==d?void 0:d.data)||void 0===o?void 0:o.status)&&void 0!==a?a:{},f=l.loginScanFlag,!l.login){r.next=18;break}return W.a.postMessage({type:w.a.LOGIN,data:i,needCookie:!0}),t(Xe.LOGIN_SUCCESS,{userIndex:d.data.userIndex,checkKey:e}),clearTimeout(this.qrTimer),clearTimeout(this.pollingTimer),null===(c=null===(s=navigator.serviceWorker)||void 0===s?void 0:s.controller)||void 0===c||c.postMessage({type:Ze.SWITCH_USER_INDEX,data:{userIndex:d.data.userIndex,url:location.href}}),r.abrupt("return");case 18:f&&t(Xe.USER_HAS_SCANNED,{checkKey:e}),clearTimeout(this.pollingTimer),this.runPolling(e,t,n);case 21:case"end":return r.stop()}}),r,this)})))}),1e3))}},{key:"runQRTimer",value:function(e,t){var n=this;this.qrTimer=setTimeout((function(){t(Xe.CODE_WAS_EXPIRED,{checkKey:e}),n.isExpired=!0,clearTimeout(n.qrTimer)}),58e3)}}]),e}();ot=Object(b.__decorate)([Object(b.__param)(0,I.a),Object(b.__param)(1,k.a),Object(b.__metadata)("design:paramtypes",[Object,Object,Object])],ot);var at;!function(e){e.IFRAME_MESSAGE_CONNECTED="IFRAME_MESSAGE_CONNECTED",e.IFRAME_DOM_MOUNTED="IFRAME_DOM_MOUNTED",e.USER_HAS_CONFIRMED="USER_HAS_CONFIRMED",e.GOT_CHANGE_KEY="GOT_CHANGE_KEY",e.LOGIN_SUCCESS="LOGIN_SUCCESS",e.ERROR="ERROR"}(at||(at={}));var st=function(){function e(t){o()(this,e),this.messageDomainService=t}return s()(e,[{key:"login",value:function(e,t){var n=this;return this.loadWeworkLoginIframe(e,t),this.getWeworkLoginSuccessMessage(t),{dispose:function(){return n.dispose()}}}},{key:"loadWeworkLoginIframe",value:function(e,t){var n,r;this.messageDomainService.weworkMessage.weworkLoginMessage.connect("enterprise"),this.getLoadWeworkLoginIframeMessage(t),this.messageDomainService.weworkMessage.weworkLoginMessage.createWeworkLoginIframe(e.weworkLoginIframeRenderDom,(r=e.targetUrl,n=r.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),"https://".concat(le,"/scenario/wework-quick-login.html?redirect_uri=").concat(encodeURIComponent(n),"&open_id_gray=1&code_gray=1")))}},{key:"dispose",value:function(){this.messageDomainService.weworkMessage.weworkLoginMessage.dispose()}},{key:"getLoadWeworkLoginIframeMessage",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.messageDomainService.weworkMessage.weworkLoginMessage.getWeworkIframeMessage((function(){e(at.IFRAME_DOM_MOUNTED)}));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"getWeworkLoginSuccessMessage",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n=this;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){n.messageDomainService.weworkMessage.weworkLoginMessage.getWeworkLoginSuccessMessage((function(n){var r,i,o=n.data;o.includes("code=")?e(at.LOGIN_SUCCESS,{code:o.slice(o.indexOf("code=")+5)}):e(at.LOGIN_SUCCESS),null===(i=null===(r=navigator.serviceWorker)||void 0===r?void 0:r.controller)||void 0===i||i.postMessage({type:Ze.SWITCH_USER_INDEX,data:{url:location.href}}),W.a.postMessage({type:w.a.LOGIN,data:"",needCookie:!0}),t(o)}))})));case 1:case"end":return t.stop()}}),t)})))}}]),e}();st=Object(b.__decorate)([Object(b.__param)(0,I.a),Object(b.__metadata)("design:paramtypes",[Object])],st);var ct=function(){function e(t,n,r){o()(this,e),this.loginDomainService=t,this.messageDomainService=n,this.accountDomainService=r}return s()(e,[{key:"qrQQLogin",value:function(e,t){return new it(this.loginDomainService,this.messageDomainService).login(e,t)}},{key:"qrWechatLogin",value:function(e,t){return new ot(this.messageDomainService,this.loginDomainService,this.accountDomainService).login(e,t)}},{key:"enterpriseQrWechatLogin",value:function(e){return new et(this.loginDomainService).login(e)}},{key:"qrWecomLogin",value:function(e,t){return new st(this.messageDomainService).login(e,t)}}]),e}();ct=Object(b.__decorate)([Object(b.__param)(0,k.a),Object(b.__param)(1,I.a),Object(b.__metadata)("design:paramtypes",[Object,Object,Object])],ct);var ut,dt="document";function lt(e){return ae("Object",e)?JSON.stringify(e):e}function ft(e,t,n,r,i){if(Ne(je,dt)){var o=encodeURIComponent(lt(t)),a=2592e6;n&&(a=864e5*n);var s=new Date;a+=s.getTime(),s.setTime(a);var c=s.toUTCString(),u=r||"/",d=i?"domain=".concat(i,";"):"";document.cookie="".concat(e,"=").concat(o,";expires=").concat(c,";path=").concat(u,";").concat(d)}}function pt(e,t,n){if(Ne(je,dt)){var r=t||"/",i=n?"domain=".concat(n,";"):"",o=new Date(0).toUTCString();document.cookie="".concat(e,"=;expires=").concat(o,";path=").concat(r,";").concat(i)}}function ht(e){if(!Ne(je,dt))return null;var t=new RegExp("(?:^|;+|\\s+)".concat(e,"=([^;]*)")),n=document.cookie.match(t);return(n?n[1]:null)||null}!function(e){e.xsrf="TOK",e.devRouteId="dev_route_id",e.devOaName="dev_oa_name",e.fd="fd",e.envId="env_id",e.sid="SID",e.sids="SID_S",e.uid="uid",e.uidKey="uid_key",e.uin="uin",e.loginTime="loginTime",e.hasBeenLogin="has_been_login",e.adtag="adtag",e.plUin="p_luin",e.pUin="p_uin",e.pSkey="p_skey",e.plSkey="p_lskey"}(ut||(ut={}));var vt="#",gt="?",mt="&";function bt(e,t){var n,r=e.split(gt),i=null===(n=r[1])||void 0===n?void 0:n.split(mt);if(!i)return e;var o=i;return t.forEach((function(e){i.forEach((function(t){if(0===t.indexOf("".concat(e,"="))){var n=o.indexOf(t);o.splice(n,1)}}))})),0===o.length?r[0]:(r[1]=o.join(mt),r.join(gt))}function yt(e,t){if(e.includes(gt)){var n=e;return Object.keys(t).map((function(e){n=function(e,t,n){var r=e.split(gt),i=r[1].split(mt),o=!0,a=new Map;i.forEach((function(e){var t=e.split("=");a.set(t[0],t[1])})),i.some((function(e){0===e.indexOf("".concat(t,"="))&&(a.set(t,n),o=!1)})),o&&a.set(t,n);var s=[];return a.forEach((function(e,t){var n="".concat(t,"=").concat(e);s.push(n)})),r[1]=s.join(mt),r.join(gt)}(n,e,t[e])})),n}var r=Object.keys(t).map((function(e){return"".concat(e,"=").concat(t[e])})).join(mt);return"".concat(e,"?").concat(r)}function _t(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(e.split(gt).length<2||t.length<1)return e;if(e.includes(vt)){var r=e.split(vt);return r[0]=bt(r[0],t),r.join(vt)}return bt(e,t)}function St(e,t){if(Object.keys(t).length<1)return e;if(e.includes(vt)){var n=e.split(vt);return n[0]=yt(n[0],t),n.join(vt)}return yt(e,t)}var Ot=me,Et=function(){function e(t){o()(this,e),this.accountDomainService=t}return s()(e,[{key:"loginSuccessJumpUrl",value:function(e,t,n,r){var i=this.accountDomainService.accountAggregate.userInfo.nowUserIndex;if(t){var o=window.btoa(Ot).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,""),a="".concat(be,"?product=2&from=30&code=").concat(n,"&redirect_url=").concat(o);Object(Y.tencentDocOpenUrlForAll)({replace:null==r?void 0:r.replace,url:a})}else{var s=St(_t(e,"autoshowlogin","u","jumpuin"),K()({},"_t",Date.now()));W.a.postMessage({type:w.a.LOGIN,data:i,needCookie:!0}),Object(Y.tencentDocOpenUrlForAll)({replace:!0,url:s})}}},{key:"logoutSuccessJumpUrl",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n,r,i,o,a,s;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=_t(window.location.href,"u"),e.next=3,this.accountDomainService.accountAggregate.accountListEntity.getAccountList();case 3:if(n=e.sent,r=ht("uid")||null,i=n.find((function(e){return e.uid!==r})),!(null==(o=i)?void 0:o.userIndex)){e.next=13;break}return e.next=10,this.accountDomainService.accountAggregate.accountListEntity.changeSign(o.userIndex);case 10:return a=St(_t(t,"u"),{u:o.userIndex}),Object(Y.tencentDocOpenUrlForAll)({replace:!0,url:a}),e.abrupt("return");case 13:s=St(_t(t,"needShowTips"),{needShowTips:1}),Object(Y.tencentDocOpenUrlForAll)({replace:!0,url:s,noUserIndex:!0});case 15:case"end":return e.stop()}}),e,this)})))}}]),e}();Et=Object(b.__decorate)([Object(b.__param)(0,C.a),Object(b.__metadata)("design:paramtypes",[Object])],Et);var wt,Ct,It=j.default.isPC||j.default.isIPad&&!(j.default.isMiniProgram||j.default.isTencentDocsApp||j.default.isWeChat||j.default.isQQ||j.default.isTim||j.default.isWxWork),kt=function(){function e(t){o()(this,e),this.loginDomainService=t}return s()(e,[{key:"login",value:function(e,t,n){document.location.pathname.indexOf("/desktop")>-1?this.desktopLogin(e,t):this.docLogin(e,t,n)}},{key:"docLogin",value:function(e,t,n){var r=this.loginDomainService.loginAggregate;j.default.isMiniProgram?r.loginDocsInMiniProgram(e):j.default.isWeChat?n():j.default.isWxWork?r.loginDocsInWework(e):(j.default.isTimOrQQ&&r.timOrQQH5Login(),It?t():r.jumpToLoginInCommonView(e))}},{key:"desktopLogin",value:function(e,t){var n=this.loginDomainService.loginAggregate;j.default.isMiniProgram?n.reloadMiniProgramForDesktop():j.default.isWeChat?n.jumpToLoginInWechatWebview(e):j.default.isWxWork?n.jumpToLoginInWeworkWebview(e):It?t():n.jumpToLoginInCommonView(e)}}]),e}();kt=Object(b.__decorate)([Object(b.__param)(0,k.a),Object(b.__metadata)("design:paramtypes",[Object])],kt),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.QQ=1]="QQ",e[e.WX=2]="WX",e[e.WORK=3]="WORK",e[e.EMAIL=4]="EMAIL",e[e.PHONE=8]="PHONE",e[e.WORK_COMBINATION=9]="WORK_COMBINATION",e[e.TOWER=10]="TOWER",e[e.ROBOT=11]="ROBOT",e[e.QFYF=12]="QFYF",e[e.OPEN=13]="OPEN",e[e.MEETING=14]="MEETING"}(wt||(wt={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.WECHAT=4]="WECHAT",e[e.WEWORK=3]="WEWORK"}(Ct||(Ct={}));var Tt=function(){pt("p_uin","/",he),pt("p_skey","/",he),pt("p_luin","/",he),pt("p_lskey","/",he),pt("p_uin","/",pe),pt("p_skey","/",pe),pt("p_luin","/",pe),pt("p_lskey","/",pe),pt("txdoc_pwd_token","/",he)},Dt=function(){function e(t){o()(this,e),this.accountDomainService=t}return s()(e,[{key:"logout",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.accountDomainService.accountAggregate.userInfo.loginType!==wt.WORK){t.next=3;break}return t.abrupt("return",this.logoutForEnterpriseAccount());case 3:return t.abrupt("return",this.logoutForPersonAccount(e));case 4:case"end":return t.stop()}}),t,this)})))}},{key:"getLogoutMessage",value:function(e){W.a.setCallback((function(){e()}))}},{key:"logoutForEnterpriseAccount",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n,r,i,o,a,s;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.accountDomainService.accountAggregate.userInfo,i=r.tinyId,o=r.nowUserIndex,e.next=3,this.accountDomainService.accountAggregate.accountRepository.wecomLogoutForCDomain(i);case 3:if(a=e.sent,0!==(null==(s=a.resData)?void 0:s.retcode)){e.next=9;break}return W.a.postMessage({type:w.a.LOGOUT,data:o,needCookie:!0}),null===(n=null===(t=navigator.serviceWorker)||void 0===t?void 0:t.controller)||void 0===n||n.postMessage({type:Ze.DELETE_USER_INDEX,data:{userIndex:o}}),e.abrupt("return",!0);case 9:return e.abrupt("return",!1);case 10:case"end":return e.stop()}}),e,this)})))}},{key:"logoutForPersonAccount",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n,r,i,o,a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=this.accountDomainService.accountAggregate.userInfo.nowUserIndex,t.next=3,this.accountDomainService.accountAggregate.accountRepository.logout(e);case 3:if(o=t.sent,0!==(null==(a=o.resData)?void 0:a.retcode)){t.next=10;break}return W.a.postMessage({type:w.a.LOGOUT,data:i,needCookie:!0}),null===(r=null===(n=navigator.serviceWorker)||void 0===n?void 0:n.controller)||void 0===r||r.postMessage({type:Ze.DELETE_USER_INDEX,data:{userIndex:i}}),Tt(),t.abrupt("return",!0);case 10:return t.abrupt("return",!1);case 11:case"end":return t.stop()}}),t,this)})))}}]),e}();Dt=Object(b.__decorate)([Object(b.__param)(0,C.a),Object(b.__metadata)("design:paramtypes",[Object])],Dt);var Rt=function(){return ht("TOK")};function At(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){setTimeout(t,e)})));case 1:case"end":return t.stop()}}),t)})))}var Mt,xt;!function(e){e[e.CAN_NOT_VIEW=0]="CAN_NOT_VIEW",e[e.CAN_VIEW=1]="CAN_VIEW"}(Mt||(Mt={})),function(e){e.QQ="qq",e.WX="wx",e.WX_WORK="wx-work",e.WW="ww",e.QFYF="qfyf"}(xt||(xt={}));var jt=function(){function e(t,n){o()(this,e),this.accountDomainService=t,this.messageDomainService=n,this.accountListApplicationService=new Ge(t,n)}return s()(e,[{key:"switchAccount",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n,r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.accountType,r=e.userIndex,W.a.postMessage({type:w.a.SWITCH,data:r,needCookie:!0}),n!==xt.WW||!document.location.pathname.includes("/desktop")){t.next=5;break}return Object(Y.tencentDocOpenUrlForAll)({url:me}),t.abrupt("return");case 5:if(n!==xt.WW||!document.location.pathname.includes("/mall")){t.next=8;break}return Object(Y.tencentDocOpenUrlForAll)({url:me,replace:!0}),t.abrupt("return");case 8:if(n!==xt.WW||!document.location.pathname.includes("/resume")){t.next=11;break}return Object(Y.tencentDocOpenUrlForAll)({url:me,replace:!0}),t.abrupt("return");case 11:return Tt(),t.next=14,this.accountListApplicationService.changeSign(e);case 14:this.switchFetchAccount(r);case 15:case"end":return t.stop()}}),t,this)})))}},{key:"switchFetchAccount",value:function(e){var t,n;null===(n=null===(t=navigator.serviceWorker)||void 0===t?void 0:t.controller)||void 0===n||n.postMessage({type:Ze.SWITCH_USER_INDEX,data:{userIndex:e,url:location.href}}),Object(Y.tencentDocOpenUrlForAll)({url:this.getNewJumpUrl(e),replace:!0,noUserIndex:!0})}},{key:"switchEnterpriseAccount",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n,r=this;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.cookie){t.next=3;break}return t.abrupt("return",!1);case 3:return this.messageDomainService.switchEnterpriseAccountMessage.connect(),this.getIframeMountMessage(n),this.messageDomainService.switchEnterpriseAccountMessage.createSwitchEnterpriseAccount((function(){r.messageDomainService.switchEnterpriseAccountMessage.sendSwitchAccountMessage(n)})),t.next=8,this.getSwitchAccountMessage();case 8:if(t.sent){t.next=11;break}return t.abrupt("return",!1);case 11:case"end":return t.stop()}}),t,this)})))}},{key:"getNewJumpUrl",value:function(e){var t=location,n=t.pathname,r=t.hostname,i="https://".concat(r).concat(n);(function(e){return/^(https?:)?\/\/(\w*\.)*(docs\.qq\.com|txdocs\.qq\.com|doc\.weixin\.qq\.com)($|\/|\\|\?)/i.test(decodeURIComponent(e))})(Pe("success_jump_url"))&&(i=_t((i=decodeURIComponent(Pe("success_jump_url"))||"https://".concat(r).concat(n)).replace(/&$/gi,""),"u"));var o=location.search;if(o=_t(o.replace(/&$/gi,""),"hst"),o=_t(o.replace(/&$/gi,""),"success_jump_url"),""===(o=_t(o.replace(/&$/gi,""),"show_type"))&&e)return"".concat(i,"?u=").concat(e);if(""===o)return"".concat(i);var a=o.replace(/(&)*u=(\w+)(\/|\?|#|&|$)/,"");return e?"".concat(i).concat(a,"&u=").concat(e):"".concat(i).concat(a)}},{key:"getIframeMountMessage",value:function(e){var t=this;return new Promise((function(n){t.messageDomainService.switchEnterpriseAccountMessage.getIframeMountMessage((function(){n(!0),t.messageDomainService.switchEnterpriseAccountMessage.sendSwitchAccountMessage(e)}))}))}},{key:"getSwitchAccountMessage",value:function(){var e=this;return new Promise((function(t){e.messageDomainService.switchEnterpriseAccountMessage.getSwitchAccountMessage((function(){t(!0)}))}))}}]),e}();jt=Object(b.__decorate)([Object(b.__param)(0,C.a),Object(b.__param)(1,I.a),Object(b.__metadata)("design:paramtypes",[Object,Object])],jt);var Nt=function e(t,n){if(Array.isArray(t))return t.map((function(t){return e(t,n)}));if(!t)return t;for(var r={},i=0,o=Object.keys(t);i<o.length;i++){var a=o[i];r[n.words.includes(a)?n.raw[a]:a]=t[a]}return r},Lt=function(e){return function(t){return Nt(t,e)}};function Ut(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}var Pt=Lt(Re),Ft=function(e){l()(n,e);var t=Ut(n);function n(e,r,i){var a;o()(this,n),(a=t.call(this)).accountDomainService=e,a.loginDomainService=r,a.messageDomainService=i,a.accountApplicationOfflineService=new Be;var s=null===globalThis||void 0===globalThis?void 0:globalThis.basicClientVars;a.isInitFinish=a.accountDomainService.createPersonalEnvAccountAggregateByBasicClientVars(null==s?void 0:s.userInfo);var c=a.accountDomainService.accountAggregate.userInfo.tinyId;return a.loginDomainService.createLoginAggregate(c),a.initDomainService(),a.accountListApplicationService=new Ge(e,i),a.dcLoginApplicationService=new ct(r,i,e),a}return s()(n,[{key:"updatePasswordsSettings",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.accountDomainService.accountAggregate,e.next=3,t.passwordEntity.updatePwdTips();case 3:return e.abrupt("return",{enabled:t.passwordEntity.isHasPassword,phoneNumber:t.passwordEntity.phone});case 4:case"end":return e.stop()}}),e,this)})))}},{key:"updateVipInfo",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getUserVipInfo();case 2:return t=this.accountDomainService.accountAggregate,n=t.vipInfo,r=t.userInfo,this.accountApplicationOfflineService.updateUserInfo(Object.assign(Object.assign({},r),{vipUserInfo:n})),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"updateBindUserInfo",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n,r,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.completionUserInfo();case 2:return t=this.accountDomainService.accountAggregate,n=t.userInfo,r=t.bindUserInfo,i=t.officialInfo,this.accountApplicationOfflineService.updateUserInfo(Object.assign(Object.assign({},n),{bindUserInfo:r,officialInfo:i})),e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"updateOfficialInfo",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n,r,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.completionUserInfo();case 2:return t=this.accountDomainService.accountAggregate,n=t.userInfo,r=t.bindUserInfo,i=t.officialInfo,this.accountApplicationOfflineService.updateUserInfo(Object.assign(Object.assign({},n),{bindUserInfo:r,officialInfo:i})),e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"updateUserInfo",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.accountDomainService.updatePersonalEnvAccountAggregate(e);case 2:return n=this.accountDomainService.accountAggregate.userInfo.tinyId,this.loginDomainService.createLoginAggregate(n),this.initDomainService(),t.abrupt("return",this.accountDomainService.accountAggregate.userInfo);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"init",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isInitFinish){e.next=2;break}return e.abrupt("return",!0);case 2:return e.next=4,this.initForUserInfoFetch();case 4:if(!e.sent){e.next=7;break}return e.abrupt("return",!0);case 7:return e.abrupt("return",this.initForUserInfoOfflineData());case 8:case"end":return e.stop()}}),e,this)})))}},{key:"dispose",value:function(){}},{key:"updatePersonalNicknameAndAvatar",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.accountDomainService.updatePersonalNicknameAndAvatar(e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"getPasswordsModifyQuestionList",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.accountDomainService.accountAggregate,e.next=3,t.passwordEntity.updatePwdQuestionList();case 3:return e.abrupt("return",t.passwordEntity.pwdQuestionList);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"getAccountProfileList",value:function(e,t){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function n(){var r;return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.accountListApplicationService.getPersonalAccountList(e,t);case 2:return r=n.sent,n.abrupt("return",Pt(r));case 4:case"end":return n.stop()}}),n,this)})))}},{key:"getFetchAccountList",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountListApplicationService.getFetchAccountList();case 2:return t=e.sent,e.abrupt("return",Pt(t));case 4:case"end":return e.stop()}}),e,this)})))}},{key:"completionUserInfo",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountDomainService.completionUserInfo();case 2:return t=e.sent,this.bindUserInfo=this.accountDomainService.accountAggregate.bindUserInfo,this.officialInfo=this.accountDomainService.accountAggregate.officialInfo,e.abrupt("return",t);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"getUserVipInfo",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountDomainService.getUserVipInfo();case 2:return t=e.sent,this.vipInfo=this.accountDomainService.accountAggregate.vipInfo,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"loginSuccessJumpUrl",value:function(e,t,n,r){new Et(this.accountDomainService).loginSuccessJumpUrl(e,t,n,r)}},{key:"logoutSuccessJumpUrl",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Et(this.accountDomainService),e.next=3,t.logoutSuccessJumpUrl();case 3:case"end":return e.stop()}}),e,this)})))}},{key:"login",value:function(e,t,n){new kt(this.loginDomainService).login(e,t,n)}},{key:"logout",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new Dt(this.accountDomainService),t.abrupt("return",n.logout(e));case 2:case"end":return t.stop()}}),t,this)})))}},{key:"deleteAccount",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.accountListApplicationService.deleteAccountForList(e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"switchToAccount",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new jt(this.accountDomainService,this.messageDomainService),t.next=3,n.switchAccount(e);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"bindQQAccount",value:function(e){return new $e(this.accountDomainService,this.loginDomainService).qqBind(e)}},{key:"getCertificationGrey",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n,r,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountDomainService.accountAggregate.accountRepository.getCertificationGrey();case 2:return r=e.sent,i=r.resData,e.abrupt("return",(null===(n=null===(t=null==i?void 0:i.data)||void 0===t?void 0:t.result)||void 0===n?void 0:n.open)||!1);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"bindWeChatAccount",value:function(){return new $e(this.accountDomainService,this.loginDomainService).wechatBind()}},{key:"getQQBindingInfo",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.accountDomainService.accountAggregate.bindingQQInfo());case 1:case"end":return e.stop()}}),e,this)})))}},{key:"getTipsStatus",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.accountDomainService.getTipsStatus(e);case 2:return n=t.sent,t.abrupt("return",n);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"initDomainAction",value:function(){var e=this.accountDomainService.accountAggregate,t=e.passwordEntity.passwordRepository;this.sendVerifyCodeSMS=t.pwdVerifyCodeGet.bind(t),this.addPasswordsWithNewPhoneNumber=t.pwdAdd.bind(t),this.resetPasswords=t.pwdReset.bind(t),this.verifyCodeSMS=t.pwdVerifyCodeCheck.bind(t),this.verifyQuestionAnswers=t.pwdQuestionCheck.bind(t),this.delPasswords=t.pwdDel.bind(t),this.verifyPasswords=t.pwdVerify.bind(t),this.unbindAccount=e.accountRepository.unbindUserInfo.bind(e.accountRepository),this.getCurrentAccountBindingInfo=e.currentLoginAccountBindInfo.bind(e)}},{key:"initDomainService",value:function(){var e=this.accountDomainService.accountAggregate;this.userInfo=e.userInfo;var t=e.passwordEntity,n=t.isHasPassword,r=t.phone;this.passwordsSettings={enabled:n,phoneNumber:r},this.vipInfo=e.vipInfo,this.bindUserInfo=e.bindUserInfo,this.officialInfo=e.officialInfo,this.accountApplicationOfflineService.addUserInfo(Object.assign(Object.assign({},this.userInfo),{vipUserInfo:this.vipInfo,bindUserInfo:this.bindUserInfo})),this.initDomainAction()}},{key:"initForUserInfoFetch",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n,r,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountDomainService.userInfoRepository.getPersonalUserInfo();case 2:if(t=e.sent,n=t.resData,!t.error){e.next=7;break}return e.abrupt("return",!1);case 7:return 0===(null==n?void 0:n.cgicode)&&(r=window.nowUserIndex||"",this.accountDomainService.createPersonalEnvAccountAggregateByUserInfoCgi(n.data,r),i=this.accountDomainService.accountAggregate.userInfo.tinyId,this.loginDomainService.createLoginAggregate(i),this.initDomainService()),e.abrupt("return",!0);case 9:case"end":return e.stop()}}),e,this)})))}},{key:"initForUserInfoOfflineData",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountApplicationOfflineService.getUserInfo();case 2:if(t=e.sent,this.accountApplicationOfflineService.setOnOfflineState(!0),t){e.next=6;break}return e.abrupt("return",!1);case 6:return this.userInfo=t.userInfo,this.vipInfo=t.vipInfo,this.bindUserInfo=t.bindUserInfo,e.abrupt("return",!0);case 10:case"end":return e.stop()}}),e,this)})))}}]),n}(R.Disposable);Object(b.__decorate)([Ce,Object(b.__metadata)("design:type",Object)],Ft.prototype,"userInfo",void 0),Object(b.__decorate)([Ce,Object(b.__metadata)("design:type",Object)],Ft.prototype,"passwordsSettings",void 0),Object(b.__decorate)([Ce,Object(b.__metadata)("design:type",Object)],Ft.prototype,"vipInfo",void 0),Object(b.__decorate)([Ce,Object(b.__metadata)("design:type",Object)],Ft.prototype,"bindUserInfo",void 0),Object(b.__decorate)([Ce,Object(b.__metadata)("design:type",Object)],Ft.prototype,"officialInfo",void 0),Object(b.__decorate)([Ee("passwordsSettings"),Object(b.__metadata)("design:type",Function),Object(b.__metadata)("design:paramtypes",[]),Object(b.__metadata)("design:returntype",Promise)],Ft.prototype,"updatePasswordsSettings",null),Object(b.__decorate)([Ee("vipInfo"),Object(b.__metadata)("design:type",Function),Object(b.__metadata)("design:paramtypes",[]),Object(b.__metadata)("design:returntype",Promise)],Ft.prototype,"updateVipInfo",null),Object(b.__decorate)([Ee("bindUserInfo"),Object(b.__metadata)("design:type",Function),Object(b.__metadata)("design:paramtypes",[]),Object(b.__metadata)("design:returntype",Promise)],Ft.prototype,"updateBindUserInfo",null),Object(b.__decorate)([Ee("officialInfo"),Object(b.__metadata)("design:type",Function),Object(b.__metadata)("design:paramtypes",[]),Object(b.__metadata)("design:returntype",Promise)],Ft.prototype,"updateOfficialInfo",null),Object(b.__decorate)([Ee("userInfo"),Object(b.__metadata)("design:type",Function),Object(b.__metadata)("design:paramtypes",[String]),Object(b.__metadata)("design:returntype",Promise)],Ft.prototype,"updateUserInfo",null),Object(b.__decorate)([te(),Object(b.__metadata)("design:type",Function),Object(b.__metadata)("design:paramtypes",[]),Object(b.__metadata)("design:returntype",Promise)],Ft.prototype,"init",null),Object(b.__decorate)([ne("init"),Object(b.__metadata)("design:type",Function),Object(b.__metadata)("design:paramtypes",[]),Object(b.__metadata)("design:returntype",void 0)],Ft.prototype,"dispose",null),Ft=Object(b.__decorate)([Te(),Object(b.__param)(0,C.a),Object(b.__param)(1,k.a),Object(b.__param)(2,I.a),Object(b.__metadata)("design:paramtypes",[Object,Object,Object])],Ft);var qt=function(){function e(t,n){o()(this,e),this.messageDomainService=t,this.accountDomainService=n}return s()(e,[{key:"getAccountList",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getFetchEnterpriseAccountList();case 2:return this.fetchEnterpriseAccountList=e.sent,e.abrupt("return",this.fetchEnterpriseAccountList);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"deleteAccountForList",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n,r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.uid,r=!0,!this.isHasSameUid(this.fetchEnterpriseAccountList,n)){t.next=7;break}return t.next=6,this.deleteFetchEnterpriseAccountList(e);case 6:r=t.sent;case 7:return t.abrupt("return",this.changeDeleteAccountState(r));case 8:case"end":return t.stop()}}),t,this)})))}},{key:"addAccountForList",value:function(){}},{key:"dispose",value:function(){this.messageDomainService.getPersonAccountListMessage.dispose()}},{key:"deleteFetchEnterpriseAccountList",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n,r,i,o;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.cookie,r=n.wedocSid,i=n.wedriveSid,o=r||i){t.next=4;break}return t.abrupt("return",!1);case 4:return t.next=6,this.accountDomainService.accountAggregate.enterpriseAccountListEntity.delEnterpriseAccountForList(o);case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t,this)})))}},{key:"getFetchEnterpriseAccountList",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountDomainService.accountAggregate.enterpriseAccountListEntity.getEnterpiseAccountList();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"changeDeleteAccountState",value:function(e){return e?Fe.SUCCESS:Fe.FAIL}},{key:"isHasSameUid",value:function(e,t){return e.some((function(e){return e.uid===t}))}}]),e}();qt=Object(b.__decorate)([Object(b.__param)(0,I.a),Object(b.__param)(1,T.a),Object(b.__metadata)("design:paramtypes",[Object,Object])],qt);var Bt=function(){function e(){o()(this,e)}return s()(e,[{key:"loginSuccessJumpUrl",value:function(e,t){Object(Y.tencentDocOpenUrlForAll)({replace:!0,url:e,noUserIndex:!0})}},{key:"logoutSuccessJumpUrl",value:function(){var e=_t(window.location.href,"u","wwapp_deviceid","wwapp_vid","wwapp_cst","needShowTips");window.location.pathname.includes("home/recent")?window.location.replace("".concat(Se,"?success_jump_url=").concat(encodeURIComponent(ye))):window.location.replace(e)}}]),e}(),Qt=function(){function e(t){o()(this,e),this.accountDomainService=t}return s()(e,[{key:"logout",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.accountDomainService.accountAggregate.userInfo,n=t.loginType,r=t.tinyId,n!==wt.WORK){e.next=4;break}return e.next=4,this.logoutForEnterpriseAccount();case 4:return pt("utype","/",ge),pt("uid","/",ge),pt("uid","/",fe),pt("uid_key","/",ge),pt("login_client","/",ge),pt("CheckKey","/",ge),pt("TOK","/",ge),pt("ES2","/",ge),pt("loginTime","/",ge),pt("wedrive_uin","/",he),pt("wedrive_sids","/",he),pt("wedrive_sid","/",he),pt("wedrive_skey","/",he),pt("wedrive_ticket","/",he),pt("wedrive_uin","/",ve),pt("wedrive_sids","/",ve),pt("wedrive_sid","/",ve),pt("wedrive_skey","/",ve),pt("wedrive_ticket","/",ve),pt("wedrive_uin","/",ge),pt("wedrive_sids","/",ge),pt("wedrive_sid","/",ge),pt("wedrive_skey","/",ge),pt("wedrive_ticket","/",ge),pt("tdoc_vid","/",he),pt("tdoc_sid","/",he),pt("tdoc_skey","/",he),pt("tdoc_vid","/",ve),pt("tdoc_sid","/",ve),pt("tdoc_skey","/",ve),pt("tdoc_vid","/",ge),pt("tdoc_sid","/",ge),pt("tdoc_skey","/",ge),pt("wedoc_openid","/",ge),pt("wedoc_skey","/",ge),pt("wedoc_ticket","/",ge),pt("wedoc_sid","/",ge),pt("tdoc_uid","/",ge),pt("tdoc_skey","/",ge),W.a.postMessage({type:w.a.LOGOUT,data:r,needCookie:!0}),e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"logoutForEnterpriseAccount",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n,r,i,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=ht("wedoc_sid"),n=ht("wedrive_sid"),!(r=t||n)){e.next=10;break}return e.next=6,this.accountDomainService.accountAggregate.accountRepository.wecomLogoutForBDomain(r);case 6:if(i=e.sent,0!==(null==(o=i.resData)?void 0:o.retcode)){e.next=10;break}return e.abrupt("return",!0);case 10:return e.abrupt("return",!1);case 11:case"end":return e.stop()}}),e,this)})))}}]),e}();Qt=Object(b.__decorate)([Object(b.__param)(0,T.a),Object(b.__metadata)("design:paramtypes",[Object])],Qt);var Wt=function(){function e(t){o()(this,e),this.messageDomainService=t}return s()(e,[{key:"switchAccount",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n,r,i,o,a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.cookie,r=e.uid,e.fromDomain!==D.a.C_DOMAIN){t.next=9;break}if(n){t.next=4;break}return t.abrupt("return",!1);case 4:return t.next=6,this.switchPersonAccount(n);case 6:return(i=t.sent)&&(o=this.isInDesktopPage()?ye:"".concat(location.origin).concat(location.pathname),a="".concat(_e,"?redirect_uri=").concat(o,"u=").concat(e.userIndex),window.location.href=a),t.abrupt("return",i);case 9:return this.switchEnterpriseAccount(e),W.a.postMessage({type:w.a.SWITCH,data:r,needCookie:!0}),t.abrupt("return",!0);case 12:case"end":return t.stop()}}),t,this)})))}},{key:"switchPersonAccount",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n=this;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.messageDomainService.switchPersonAccountMessage.connect(),this.getIframeMountMessage(e),this.messageDomainService.switchPersonAccountMessage.createSwitchEnterpriseAccount((function(){n.messageDomainService.switchPersonAccountMessage.sendSwitchAccountMessage(e)})),t.next=5,this.getSwitchAccountMessage();case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"switchEnterpriseAccount",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n,r,i,o,a,s,c,u;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=null===(n=e.cookie)||void 0===n?void 0:n.wedocSid,s=null===(r=e.cookie)||void 0===r?void 0:r.tdocUid,c=null===(i=e.cookie)||void 0===i?void 0:i.wedocOpenid,u=null===(o=e.cookie)||void 0===o?void 0:o.wedriveSid,a?(ft("wedoc_sid",a,30,"/",ge),s&&ft("tdoc_uid",s,30,"/",ge),c&&ft("wedoc_openid",c,30,"/",ge)):u&&ft("wedrive_sid",u,30,"/",ve),location.reload(),t.abrupt("return",!0);case 7:case"end":return t.stop()}}),t)})))}},{key:"getIframeMountMessage",value:function(e){var t=this;return new Promise((function(n){t.messageDomainService.switchPersonAccountMessage.getIframeMountMessage((function(){n(!0),t.messageDomainService.switchPersonAccountMessage.sendSwitchAccountMessage(e)}))}))}},{key:"getSwitchAccountMessage",value:function(){var e=this;return new Promise((function(t){e.messageDomainService.switchPersonAccountMessage.getSwitchAccountMessage((function(e){"SUCCESS_SET_COOKIE"===e.data.event&&t(!0),t(!1)}))}))}},{key:"isInDesktopPage",value:function(){return document.location.pathname.indexOf("/home/")>-1}}]),e}();function Gt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}Wt=Object(b.__decorate)([Object(b.__param)(0,I.a),Object(b.__metadata)("design:paramtypes",[Object])],Wt);var Ht=Lt(Re),Vt=function(e){l()(n,e);var t=Gt(n);function n(e,r,i){var a,s;o()(this,n),(a=t.call(this)).accountDomainService=e,a.loginDomainService=r,a.messageDomainService=i,a.accountApplicationOfflineService=new Be,a.enterpriseAccountListApplicationService=new qt(i,e),a.dcLoginApplicationService=new ct(r,i,e);var c=null===globalThis||void 0===globalThis?void 0:globalThis.basicClientVars;return a.loginDomainService.createLoginAggregate((null===(s=null==c?void 0:c.userInfo)||void 0===s?void 0:s.tinyId)||E.h),a.createEnterpriseEnvAccountAggregateByBasicClientVarsAndDocInfo(),a}return s()(n,[{key:"updateVipInfo",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n,r,i,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.completionUserInfo();case 2:return t=this.accountDomainService.accountAggregate,n=t.vipInfo,r=t.userInfo,i=t.bindUserInfo,o=t.officialInfo,this.accountApplicationOfflineService.updateUserInfo(Object.assign(Object.assign({},r),{vipUserInfo:n,bindUserInfo:i,officialInfo:o})),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"updateUserInfo",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n,r,i,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountDomainService.userInfoRepository.getEnterpriseUserInfo();case 2:return t=e.sent,e.next=5,this.accountDomainService.userInfoRepository.getEnterpriseDocInfo();case 5:if(n=e.sent,r=n.resData,!t||0!==(null==r?void 0:r.cgicode)){e.next=12;break}return i=this.accountDomainService.accountAggregate.userInfo.tinyId,this.loginDomainService.createLoginAggregate(i),o=this.accountDomainService.accountAggregate,e.abrupt("return",o.userInfo);case 12:return this.accountApplicationOfflineService.updateUserInfo(Object.assign({},this.userInfo)),e.abrupt("return",this.userInfo);case 14:case"end":return e.stop()}}),e,this)})))}},{key:"init",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initForUserInfoFetch();case 2:if(!e.sent){e.next=5;break}return e.abrupt("return",!0);case 5:return e.abrupt("return",this.initForUserInfoOfflineData());case 6:case"end":return e.stop()}}),e,this)})))}},{key:"dispose",value:function(){}},{key:"getAccountProfileList",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.enterpriseAccountListApplicationService.getAccountList();case 2:return t=e.sent,e.abrupt("return",Ht(t));case 4:case"end":return e.stop()}}),e,this)})))}},{key:"deleteAccount",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.enterpriseAccountListApplicationService.deleteAccountForList(e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"addAccount",value:function(){}},{key:"switchToAccount",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new Wt(this.messageDomainService),t.next=3,n.switchAccount(e);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"completionUserInfo",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountDomainService.completionUserInfo();case 2:return t=e.sent,this.vipInfo=this.accountDomainService.accountAggregate.vipInfo,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"loginSuccessJumpUrl",value:function(e,t){var n=this.accountDomainService.accountAggregate.userInfo.nowUserIndex;W.a.postMessage({type:w.a.LOGIN,data:n,needCookie:!0}),(new Bt).loginSuccessJumpUrl(e,t)}},{key:"logoutSuccessJumpUrl",value:function(){(new Bt).logoutSuccessJumpUrl()}},{key:"login",value:function(e,t,n){new kt(this.loginDomainService).login(e,t,n)}},{key:"logout",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Qt(this.accountDomainService),e.abrupt("return",t.logout());case 2:case"end":return e.stop()}}),e,this)})))}},{key:"initForUserInfoFetch",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t=this;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([this.accountDomainService.userInfoRepository.getEnterpriseUserInfo()]).then((function(e){var n=X()(e,1)[0];if(n){t.accountDomainService.createEnterpriseEnvAccountAggregateByUserInfoCgi(n);var r=t.accountDomainService.accountAggregate.userInfo.tinyId;t.loginDomainService.createLoginAggregate(r);var i=t.accountDomainService.accountAggregate;t.userInfo=i.userInfo,t.accountApplicationOfflineService.addUserInfo(Object.assign({},t.userInfo))}return!0})));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"initForUserInfoOfflineData",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountApplicationOfflineService.getUserInfo();case 2:if(t=e.sent,this.accountApplicationOfflineService.setOnOfflineState(!0),t){e.next=6;break}return e.abrupt("return",!1);case 6:return this.userInfo=t.userInfo,e.abrupt("return",!0);case 8:case"end":return e.stop()}}),e,this)})))}},{key:"createEnterpriseEnvAccountAggregateByBasicClientVarsAndDocInfo",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=null===globalThis||void 0===globalThis?void 0:globalThis.basicClientVars,n=this.accountDomainService.createEnterpriseEnvAccountAggregateByBasicClientVars(null==t?void 0:t.userInfo),r=this.accountDomainService.accountAggregate,this.userInfo=r.userInfo,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})))}}]),n}(R.Disposable);Object(b.__decorate)([Ce,Object(b.__metadata)("design:type",Object)],Vt.prototype,"userInfo",void 0),Object(b.__decorate)([Ce,Object(b.__metadata)("design:type",Object)],Vt.prototype,"vipInfo",void 0),Object(b.__decorate)([Ee("vipInfo"),Object(b.__metadata)("design:type",Function),Object(b.__metadata)("design:paramtypes",[]),Object(b.__metadata)("design:returntype",Promise)],Vt.prototype,"updateVipInfo",null),Object(b.__decorate)([Ee("userInfo"),Object(b.__metadata)("design:type",Function),Object(b.__metadata)("design:paramtypes",[]),Object(b.__metadata)("design:returntype",Promise)],Vt.prototype,"updateUserInfo",null),Object(b.__decorate)([te(),Object(b.__metadata)("design:type",Function),Object(b.__metadata)("design:paramtypes",[]),Object(b.__metadata)("design:returntype",Promise)],Vt.prototype,"init",null),Object(b.__decorate)([ne("init"),Object(b.__metadata)("design:type",Function),Object(b.__metadata)("design:paramtypes",[]),Object(b.__metadata)("design:returntype",void 0)],Vt.prototype,"dispose",null),Vt=Object(b.__decorate)([Te(),Object(b.__param)(0,T.a),Object(b.__param)(1,k.a),Object(b.__param)(2,I.a),Object(b.__metadata)("design:paramtypes",[Object,Object,Object])],Vt);var Kt,Yt,zt,Xt=Object(r.a)("IAccountApplicationService"),Jt=Object(r.a)("IEnterpriseAccountApplicationService");!function(e){e.CODE_IS_READY="CODE_IS_READY",e.USER_HAS_SCANNED="USER_HAS_SCANNED",e.CODE_WAS_EXPIRED="CODE_WAS_EXPIRED",e.USER_HAS_CONFIRMED="USER_HAS_CONFIRMED",e.ERROR="ERROR"}(Kt||(Kt={})),function(e){e.TENCENT_DOCS="TENCENT_DOCS"}(Yt||(Yt={})),function(e){e.CODE_IS_READY="CODE_IS_READY",e.BIND_POLLING_RUNNING="BIND_POLLING_RUNNING",e.BIND_POLLING_FINISH="BIND_POLLING_FINISH",e.BIND_TIMEOUT="BIND_TIMEOUT",e.CODE_WAS_EXPIRED="CODE_WAS_EXPIRED",e.ERROR="ERROR"}(zt||(zt={}));var $t=function(){function e(t){var n,r,i;o()(this,e),this.title=t.title,this.padId=t.padId,this.domainId=t.domainId,this.docType=t.docType,this.create_type=null!==(n=t.create_type)&&void 0!==n?n:"",this.redirect=null!==(r=t.redirect)&&void 0!==r?r:"",this.isMiniProgram=null!==(i=t.isMiniProgram)&&void 0!==i?i:""}return s()(e,[{key:"send",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new FormData).append("domain_id",this.domainId),t.append("title",this.title),t.append("pad_id",this.padId),t.append("xsrf",Rt()),t.append("create_type",this.create_type),t.append("redirect",this.redirect),t.append("isMiniProgram",this.isMiniProgram),e.next=10,J.networkRequest.post("/cgi-bin/online-docs/createdoc_new",t);case 10:return n=e.sent,r=n.data,e.abrupt("return",r);case 13:case"end":return e.stop()}}),e,this)})))}}]),e}(),Zt=function(){function e(t){o()(this,e),this.file_id=t.file_id,this.parent_id=t.parent_id}return s()(e,[{key:"send",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,J.networkRequest.post("".concat("/v2/file/clone","?xsrf=").concat(Rt()),{file_id:this.file_id,parent_id:this.parent_id});case 2:return t=e.sent,n=t.data,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})))}}]),e}(),en={retcode:-1,doc_url:"",message:"创建副本存到本地失败",doc_id:{pad_id:""}},tn=function(){function e(t){o()(this,e),this.logger=new M.a("IDocsManagementService").use("console"),this.title=t.title,this.padId=t.padId,this.domainId=t.domainId}return s()(e,[{key:"send",value:function(){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function e(){var t,n,r,i,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new FormData).append("domain_id",this.domainId),t.append("title",this.title),t.append("pad_id",this.padId),t.append("xsrf",Rt()),e.next=7,J.networkRequest.post("/cgi-bin/online_docs/copydoc_async",t);case 7:if(n=e.sent,r=n.data,i=r.retcode,o=r.doc_id.pad_id,0===i&&o){e.next=13;break}return this.logger.error(r),e.abrupt("return",r);case 13:return e.next=15,this.requestCreateCopyLoop(r);case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}}),e,this)})))}},{key:"requestCreateCopyLoop",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n,r,i,o,a,s;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.doc_id.pad_id,r=e.doc_url,i=30;case 3:if(!(i-=1)){t.next=20;break}return t.next=6,At(2e3);case 6:return(o=new FormData).append("domain_id",this.domainId),o.append("pad_id",n),o.append("xsrf",Rt()),t.next=12,J.networkRequest.post("/cgi-bin/online_docs/copydoc_loop",o);case 12:if(a=t.sent,s=a.data,r=r||s.doc_url,10027!==s.retcode){t.next=17;break}return t.abrupt("continue",3);case 17:return t.abrupt("return",s);case 20:return t.abrupt("return",en);case 21:case"end":return t.stop()}}),t,this)})))}}]),e}(),nn=Object(r.a)("IDocsManagementService"),rn=function(){function e(){o()(this,e)}return s()(e,[{key:"loopClone",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new tn(e.params).send();case 2:n=t.sent,this.handleResult(e,n);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"createDocClone",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new $t(e.params).send();case 2:n=t.sent,this.handleResult(e,n);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"driveClone",value:function(e){return Object(b.__awaiter)(this,void 0,void 0,m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Zt(e.params).send();case 2:n=t.sent,this.handleResult(e,n);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"handleResult",value:function(e,t){t?e.success(t):e.fail()}}]),e}()}).call(this,n("5ef37df1a0"))},c8a49606a0:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("f2efe943af");function i(e,t){if(e){if("string"==typeof e)return Object(r.a)(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Object(r.a)(e,t):void 0}}},ce86f0d08f:function(e,t,n){"use strict";function r(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}n.d(t,"a",(function(){return r}))},cf3c69206c:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n("898db569a7"),t),i(n("e67f1ebb74"),t),i(n("97d6e03b61"),t),i(n("ef67208c03"),t),i(n("cfaa4b8621"),t),i(n("094a0886cb"),t)},cfaa4b8621:function(e,t,n){"use strict";var r,i;Object.defineProperty(t,"__esModule",{value:!0}),t.ContentTypeValue=t.ContentTypeValueMap=t.HttpStatus=t.Method=t.ContentType=void 0,function(e){e.JSON="JSON",e.FORM="FORM"}(r||(r={})),t.ContentType=r,function(e){e.JSON="application/json",e.FORM="application/x-www-form-urlencoded"}(i||(i={})),t.ContentTypeValue=i;var o,a,s=new Map([[r.JSON,i.JSON],[r.FORM,i.FORM]]);t.ContentTypeValueMap=s,function(e){e.POST="POST",e.GET="GET"}(o||(o={})),t.Method=o,function(e){e[e.SUCCESS=200]="SUCCESS",e[e.NOT_FOUND=404]="NOT_FOUND"}(a||(a={})),t.HttpStatus=a},d3a09514f9:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n("dd7d1011cb"),t),i(n("44f185c0a0"),t)},d7383b8262:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("a6698c361d");function i(e,t){if(null==e)return{};var n,i,o=Object(r.a)(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}},d8384ba8a0:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n("15c09bfd29");function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}},dd1cfaf242:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisposableNone=void 0,t.DisposableNone=Object.freeze({dispose:function(){}})},dd4f5ceadb:function(e,t,n){"use strict";function r(){return r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},r.apply(this,arguments)}n.d(t,"a",(function(){return r}))},dd7d1011cb:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},de23095cc5:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.MessageCreater=void 0;var i=n("eee882e93f"),o=n("cdda668c2b"),a=n("147e28b86b"),s=function(){function e(){}return e.createMessage=function(e,t,n){var s,c,u,d,l,f,p,h=this.createPostData(e,t,n),v=a.RoomUtil.createNewMessage(e.taskId||o.generateMessageTaskId(),h,null!==(c=null===(s=e.customParam)||void 0===s?void 0:s.timeout)&&void 0!==c?c:i.DEFAULT_SEND_MESSAGE_TIMEOUT,null!==(d=null===(u=e.customParam)||void 0===u?void 0:u.maxRetryCount)&&void 0!==d?d:i.DEFAULT_RETRY_COUNTS,e.cmd,e.data,null===(l=e.customParam)||void 0===l?void 0:l.waitAcceptCmd,e.onError,e.onsend,e.onsendAccept),g=!!(null===(p=null===(f=t.config)||void 0===f?void 0:f.bigCollabCommitConfig)||void 0===p?void 0:p.syncCommit)&&"USER_CHANGES"===e.cmd;return r({syncCommit:g},v)},e.createPostData=function(e,t,n){var r=i.prepareCommitMessage(e.data,t.userid,t.serverVars.pver);return{head:this.createSendHead(e,t,n),body:r}},e.createSendHead=function(e,t,n){var r=e.data;return o.createMessageHead(t,{getHeaderGeneralPacket:n.getHeaderGeneralPacket(),command:e.cmd,baseRev:"object"==typeof r&&"number"==typeof r.baseRev?r.baseRev:n.getVersion(),taskId:e.taskId||o.generateMessageTaskId(),additionalFieldsToHead:e.additionalFieldsToHead})},e}();t.MessageCreater=s},e2584d8846:function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a};Object.defineProperty(t,"__esModule",{value:!0}),t.Receiver=void 0;var i=n("0a9f420ed3"),o=n("cdda668c2b"),a=n("49835f837f"),s=n("147e28b86b"),c=n("8daac3befe"),u=function(){function e(e){var t=this;this.dependency=e,this.tag="Receiver",this.isConnectSuccess=!1,this.delayConnectTimer=0,this.connectionCheckTimer=0,this.retryTimes=0,this.pageVisibilityChecker=new c.PageVisibilityChecker({resumeCallback:function(){return t.receive()}})}return e.prototype.dispose=function(){this.stopToReceive(),this.receiverClientInstance=void 0},e.prototype.stopToReceive=function(){this.receiverClient.abortConnection(),this.clearTimer()},e.prototype.receive=function(){o.ConnectionLog.info("大协同bind get receive isHidden:"+this.pageVisibilityChecker.isHidden+", retryTimes:"+this.retryTimes),this.pageVisibilityChecker.isHidden?this.pageVisibilityChecker.resumeAfterVisibility():this.retryTimes?this.delayConnect():(this.retryTimes=this.retryTimes+1,this.isConnectSuccess=!1,this.receiverClient.establishConnection(this.getUrl()))},e.prototype.delayConnect=function(){var e=this;if(this.retryTimes>=3)return o.ConnectionLog.info("大协同bind get请求，重试三次失败，重新发起post鉴权"),this.retryTimes=0,void this.dependency.reconnect({attrName:"bind get 连续重试三次连接失败",reason:"超时、请求状态异常等错误"});this.isConnectSuccess=!1,this.delayConnectTimer&&(clearTimeout(this.delayConnectTimer),this.delayConnectTimer=0),this.delayConnectTimer=setTimeout((function(){e.retryTimes=e.retryTimes+1,e.receiverClient.establishConnection(e.getUrl())}),a.CONNECT_DELAY_TIME)},e.prototype.getUrl=function(){var e=this.dependency.getServerParams(),t=e.token,n=e.sid,r=e.routeKey;return a.PATH+"?sid="+n+"&token="+t+"&routeKey="+r+"&taskId="+o.generateMessageTaskId()},e.prototype.handleResponse=function(e){var t=this;if(!Number.parseInt(e,16)&&0!==Number.parseInt(e,16)){var n=o.JsonUtil.parseJson(e);Array.isArray(n)&&(n.forEach((function(e){var n=r(e,2),i=n[0],o=n[1];a.ERROR_MESSAGE_INDEX.includes(i)?t.handleResponseEnd(o):o.includes(a.NOOP)||t.dependency.handleServerMessage(o)})),this.connectionIsStable())}},e.prototype.connectionIsStable=function(){var e=this;clearTimeout(this.connectionCheckTimer),this.connectionCheckTimer=0,this.retryTimes=0,this.dependency.isDisconnected()?o.ConnectionLog.info(this.tag+" connectStatus is disconnected."):(this.isConnectSuccess||(this.isConnectSuccess=!0,this.dependency.onConnectSuccess()),this.connectionCheckTimer=setTimeout((function(){e.isConnectSuccess=!1,e.receive()}),a.MAX_SERVER_REACHABLE_TIME))},e.prototype.handleResponseEnd=function(e){var t=r(e,2),n=t[0],i=t[1];if(!this.notNeedToHandle(n))return n!==s.RoomWebsocketErrorCode.SOCKET_SERVER_SUCCESS?(o.ConnectionLog.info("Bind Get Error, retcode: "+n+", msg: "+i),void this.dependency.reconnect({attrName:String(null!=n?n:0),reason:"Bind Get Error, retcode: "+n+", msg: "+i})):void this.receive()},e.prototype.notNeedToHandle=function(e){return s.NOT_NEED_TO_HANDLE_ERRCODES.includes(e)},Object.defineProperty(e.prototype,"receiverClient",{get:function(){var e=this;return this.receiverClientInstance||(this.receiverClientInstance=new i.ReceiverClient({handleResponse:function(t){return e.handleResponse(t)},receive:function(){return e.receive()},disconnect:function(t){return e.dependency.disconnect(t)}})),this.receiverClientInstance},enumerable:!1,configurable:!0}),e.prototype.clearTimer=function(){this.delayConnectTimer&&(clearTimeout(this.delayConnectTimer),this.delayConnectTimer=0),this.connectionCheckTimer&&(clearTimeout(this.connectionCheckTimer),this.connectionCheckTimer=0)},e}();t.Receiver=u},e67f1ebb74:function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.Command=void 0,function(e){e.UNKNOWN="UNKNOWN",e.HEART_BEAT="HEART_BEAT",e.CLIENT_READY="CLIENT_READY",e.CURSOR_MESSAGE="CURSOR_MESSAGE",e.USER_NEWINFO="USER_NEWINFO",e.USER_NEWINFOS="USER_NEWINFOS",e.USER_LEAVE="USER_LEAVE",e.USER_LEAVES="USER_LEAVES",e.QUIT_NOTICE="QUIT_NOTICE",e.USER_CHANGES="USER_CHANGES",e.NEW_CHANGES="NEW_CHANGES",e.ACCEPT_COMMIT="ACCEPT_COMMIT",e.GET_PRIVILEGE="GET_PRIVILEGE",e.BIG_COLLAB_SWITCH="BIG_COLLAB_SWITCH",e.COMMON_REQUEST="COMMON_REQUEST",e.BIND_POST="BIND_POST",e.CLIENT_DISCONNECT="CLIENT_DISCONNECT",e.LIVE_MESSAGE="LIVE_MESSAGE",e.UPDATE_WEBOFFICE_TOKEN="UPDATE_WEBOFFICE_TOKEN"}(r||(r={})),t.Command=r},e9dc8c48dc:function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},i=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0}),t.MessageSendQueue=t.Queue=void 0;var o=n("686df8963b"),a=n("c0f85d03df"),s=function(){function e(){this.queue=[]}return e.prototype.get=function(e){var t=this.queue.filter((function(t){return t.taskId===e}));return 0===t.length?null:t[0]},e.prototype.has=function(e){return this.queue.some((function(t){return t.taskId===e}))},e.prototype.add=function(e){this.has(e.taskId)||this.queue.push(e)},e.prototype.remove=function(e){for(var t=0;t<this.queue.length;t++){if(this.queue[t].taskId===e)break}return t===this.queue.length?null:this.queue.splice(t,1)[0]},e.prototype.filter=function(e){return this.queue.filter(e)},e.prototype.some=function(e){return this.queue.some(e)},e}();t.Queue=s;var c=function(){function e(e){this.messageClassification=e,this.parallelQueue=new s,this.serialQueue=new s}return e.prototype.isCommittingSerialMessage=function(){return this.serialQueue.some((function(e){return e.state===a.MessageState.SENDING}))},e.prototype.nextSerialMessage=function(){var e=this.serialQueue.filter((function(e){return e.state===a.MessageState.WAITING}));return 0===e.length?null:e[0]},e.prototype.nextParallelMessages=function(){return this.parallelQueue.filter((function(e){return e.state===a.MessageState.WAITING}))},e.prototype.add=function(e){this.messageClassification.getMessageSendType(e.cmd)===o.MessageSendType.PARALLEL?this.parallelQueue.add(e):this.serialQueue.add(e)},e.prototype.remove=function(e){return this.parallelQueue.has(e)?this.parallelQueue.remove(e):this.serialQueue.remove(e)},e.prototype.get=function(e){return this.parallelQueue.has(e)?this.parallelQueue.get(e):this.serialQueue.get(e)},e.prototype.has=function(e){return this.serialQueue.has(e)||this.parallelQueue.has(e)},e.prototype.filter=function(e){return i(this.parallelQueue.filter(e),this.serialQueue.filter(e))},e.prototype.updateMessageState=function(e){var t,n=this.serialQueue.filter((function(e){return e.state!==a.MessageState.WAITING})).concat(this.parallelQueue.filter((function(e){return e.state!==a.MessageState.WAITING})));null===(t=n.forEach)||void 0===t||t.call(n,(function(t){t.state=e}))},e}();t.MessageSendQueue=c},eba64b0be6:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BigCollabLogin=void 0;var s=n("eee882e93f"),c=n("cf3c69206c"),u=n("cd1340aeac"),d=n("5d1be1397d"),l=n("271684415e"),f=n("147e28b86b"),p=n("cdda668c2b"),h=a(n("751778941b")),v=n("46509843e6"),g=n("49835f837f"),m=Number.MIN_VALUE,b=function(){function e(e,t){this.options=e,this.dependency=t,this.retryCount=0,this.delayConnectTime=l.DEFAULT_DELAY_TIME,this.delayConnectTimer=0,this.setRouteKey()}return e.prototype.dispose=function(){clearTimeout(this.delayConnectTimer),this.delayConnectTimer=m},e.prototype.reset=function(){clearTimeout(this.delayConnectTimer),this.delayConnectTimer=0},e.prototype.login=function(){0!==this.retryCount?this.relogin():this.sendLoginRequest()},e.prototype.unlogin=function(){if(!this.sid||!this.token)return!1;var e=(new u.Request).sendBeacon(this.getUnbindPath(),r(r({},this.createBindPostMessage("CLIENT_DISCONNECT")),{sid:this.sid,token:this.token}));return this.sid=void 0,this.token=void 0,e},e.prototype.relogin=function(e,t){var n=this;if(!this.delayConnectTimer){var r=this.getDelayConnectTime(e);this.delayConnectTimer=setTimeout((function(){t||n.retryCount===s.DEFAULT_RETRY_COUNTS&&n.dependency.disconnect({shutDown:!1,reason:"big collab login timeout."}),n.retryCount=n.retryCount+1,n.reset(),n.sendLoginRequest()}),r)}},e.prototype.getDelayConnectTime=function(e){return void 0===e?(this.retryCount>s.DEFAULT_RETRY_COUNTS&&this.delayConnectTime===l.DEFAULT_DELAY_TIME&&(this.delayConnectTime=l.MAX_DELAY_TIME),this.delayConnectTime):e},e.prototype.sendLoginRequest=function(){var e,t;return i(this,void 0,void 0,(function(){var n,r;return o(this,(function(i){switch(i.label){case 0:return n=this.createBindPostMessage("BIND_POST"),this.dependency.connectStatusChange(v.ConnectStatus.LOGIN),p.ConnectionLog.info("routeKey: "+this.routeKey+", Message: "+p.JsonUtil.jsonStringify(n)),[4,(new u.Request).sendRequest(this.getBindPath(),d.Method.POST,n,{contentType:c.ContentTypeValue.JSON})];case 1:return r=i.sent(),this.handleLoginResult(r),p.ConnectionLog.info("handleLoginResult result: "+p.JsonUtil.jsonStringify(null!==(t=null===(e=r.data)||void 0===e?void 0:e.data)&&void 0!==t?t:{})),[2]}}))}))},e.prototype.createBindPostMessage=function(e){return{head:p.createMessageHead(this.options,{command:e,baseRev:this.dependency.getVersion(),getHeaderGeneralPacket:this.dependency.getHeaderGeneralPacket(),taskId:p.generateMessageTaskId()}),body:this.createPostBody()}},e.prototype.createPostBody=function(){return p.JsonUtil.jsonStringify({})},e.prototype.handleLoginResult=function(e){if(e.error)this.relogin();else{var t=e.data.data;this.isLoginSuccess(t.retcode)?this.handleLoginSuccess(t):this.handleLoginFailed(t)}},e.prototype.isLoginSuccess=function(e){return f.SERVER_SUCCESS_CODES.includes(e)},e.prototype.handleLoginSuccess=function(e){this.reset(),this.retryCount=0,this.delayConnectTime=l.DEFAULT_DELAY_TIME,this.sid=e.data.sid,this.token=e.data.token;var t={sid:e.data.sid,token:e.data.token,routeKey:this.routeKey};this.dependency.connectStatusChange(v.ConnectStatus.LOGINED,t)},e.prototype.handleLoginFailed=function(e){var t=e.retcode,n=e.msg,r=e.data;if(this.setRouteKey(r.routeKey),p.ConnectionLog.info("connect failed, serverErrCode: "+t+", errorMessage:"+n),this.shouldReconnect(e))h.default.retryRequestReport({name:String(t),message:"login error, retcode: "+t+", msg: "+n},this.options.module),this.relogin(this.getDelayConnectTime(),t===f.RoomWebsocketErrorCode.SOCKET_COLLAB_ROOM_MEMBER_FULL&&!!r.routeKey);else{var i={errCode:t,reason:f.RoomUtil.getWebsocketChannelErrorMessage(t,"connect failed."),shutDown:!f.NEED_RETRY_ERRCODES.includes(t)};this.dependency.connectStatusChange(v.ConnectStatus.LOGIN_FAIL,void 0,i)}},e.prototype.setRouteKey=function(e){this.routeKey=null!=e?e:this.options.serverVars.globalPadId},e.prototype.shouldReconnect=function(e){var t=e.retcode,n=e.data;return t===f.RoomWebsocketErrorCode.SOCKET_COLLAB_ROOM_MEMBER_FULL?!!n.routeKey:f.NEED_RETRY_ERRCODES.includes(t)&&this.retryCount<3},e.prototype.getBindPath=function(){return this.routeKey||this.setRouteKey(),g.PATH+"?routeKey="+this.routeKey},e.prototype.getUnbindPath=function(){return this.routeKey||this.setRouteKey(),"/websocket/save?routeKey="+this.routeKey},e}();t.BigCollabLogin=b},ef67208c03:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},r(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.HttpError=void 0;var o=function(e){function t(t,n){var r=e.call(this,t+", statusCode:"+n+" ")||this;return r.name="HttpError",r.statusCode=n,r}return i(t,e),t}(Error);t.HttpError=o},f2efe943af:function(e,t,n){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}n.d(t,"a",(function(){return r}))},f45b7c6e6e:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n("f2efe943af");var i=n("ce86f0d08f"),o=n("c8a49606a0");function a(e){return function(e){if(Array.isArray(e))return Object(r.a)(e)}(e)||Object(i.a)(e)||Object(o.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},f7ee9899ef:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Request=void 0;var o=n("b512c0eccb"),a=n("cdda668c2b"),s=n("5d1be1397d"),c=n("cf3c69206c"),u=function(){function e(){}return e.prototype.sendRequest=function(e,t,n,u){var d,l,f;return void 0===t&&(t=s.Method.POST),void 0===n&&(n=c.ContentType.FORM),r(this,void 0,void 0,(function(){var r,p;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,5,,6]),r=void 0,t!==s.Method.GET?[3,2]:[4,o.networkRequest.get(e)];case 1:return r=i.sent(),[3,4];case 2:return[4,o.networkRequest.post(e,u,{contentType:c.ContentTypeValueMap.get(n)})];case 3:r=i.sent(),i.label=4;case 4:return[2,new c.Result(void 0,r)];case 5:return p=i.sent(),a.ConnectionLog.error("Request Failed, requestUrl:"+e+", status:"+(null===(d=null==p?void 0:p.request)||void 0===d?void 0:d.status)+", response:"+(null===(l=null==p?void 0:p.request)||void 0===l?void 0:l.response)+", responseText:"+(null===(f=null==p?void 0:p.request)||void 0===f?void 0:f.responseText)+", error stack:"+(null==p?void 0:p.stack)+", error message:"+(null==p?void 0:p.message)),[2,new c.Result(p)];case 6:return[2]}}))}))},e}();t.Request=u},fe9bc614bd:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));class r{static hasMetadata(e,t){return!!t[e]}static getDepsMetadata(e,t){return t[e]}static setDepsMetadata(e,t,n){n[e]=t}static getMethodMetadata(e,t){return t[e]}static setMethodMetadata(e,t,n){n[e]=t}}function i(e){return"function"==typeof e?"function"==typeof e.toLegacyString?e.toLegacyString():e.name:String(e)}const o="Metadata must be applied to the parameters of a class constructor",a=(...e)=>`Metadata key was used more than once for parameter of class ${e[0]} in position ${e[1]}, already has metadata: [${e[2]}], newly add metadata: [${e[3]}]`,s=(...e)=>`@ServiceName decorator [${e[0]}] can only be used to decorate constructor parameter`;const c="di:ctor_deps";class u{static has(e){return this.serviceIdsMap.has(e)}static get(e){return this.serviceIdsMap.get(e)}static set(e,t){this.serviceIdsMap.set(e,t)}}function d(e){if(u.has(e))return u.get(e);const t=function(e,n,u){if(3!==arguments.length)throw new Error(s(n));!function(e,t,n,s,c){if(void 0!==n&&"number"==typeof c)throw new Error(o);const u=c.toString(),d=r.getDepsMetadata(e,t)||{},l=d[u];if(void 0!==(null==l?void 0:l[0])&&(null==l?void 0:l[0])!==s)throw new Error(a(t.name,u,i(l[0]),i(s)));l&&l[1]&&!l[1].serviceIdentifier?(l[0]=s,l[1].serviceIdentifier=s):void 0===l&&(d[u]=[s,{serviceIdentifier:s}],r.setDepsMetadata(e,d,t))}(c,e,void 0,t,u)};return t.toLegacyString=()=>e,u.set(e,t),t}u.serviceIdsMap=new Map}}]);
//# sourceMappingURL=slide-commonAsync~27f19aac-a05da6.js.map