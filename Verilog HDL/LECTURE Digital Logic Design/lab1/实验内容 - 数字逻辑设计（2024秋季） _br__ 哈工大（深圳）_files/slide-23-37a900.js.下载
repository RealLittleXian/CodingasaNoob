(this.webpackJsonp=this.webpackJsonp||[]).push([[23],{"250d00b27e":function(t,n,e){"use strict";function r(t,n,e,r){function o(t){return t instanceof e?t:new e((function(n){n(t)}))}return new(e||(e=Promise))((function(e,i){function c(t){try{s(r.next(t))}catch(t){i(t)}}function u(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){t.done?e(t.value):o(t.value).then(c,u)}s((r=r.apply(t,n||[])).next())}))}function o(t,n){var e,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(t){return function(n){return s([t,n])}}function s(u){if(e)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(c=0)),c;)try{if(e=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return c.label++,{value:u[1],done:!1};case 5:c.label++,r=u[1],u=[0];continue;case 7:u=c.ops.pop(),c.trys.pop();continue;default:if(!(o=c.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){c=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){c.label=u[1];break}if(6===u[0]&&c.label<o[1]){c.label=o[1],o=u;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(u);break}o[2]&&c.ops.pop(),c.trys.pop();continue}u=n.call(t,c)}catch(t){u=[6,t],r=0}finally{e=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}e.r(n),e.d(n,"default",(function(){return d})),"function"==typeof SuppressedError&&SuppressedError;var i=function(){var t;return function(){return void 0===t&&(t="undefined"!=typeof navigator?navigator.userAgent:""),t}}();function c(t){return function(n){return t(n||i())}}var u=c((function(t){return/(mobile)/i.test(t)||s(t)})),s=c((function(t){return!/(mobile)/i.test(t)&&l(t)})),a=c((function(t){return!u(t)})),l=c((function(t){return/android|adr/i.test(t)})),f=c((function(t){return/miniprogram|miniapp(?!enable)/i.test(t)||"undefined"!=typeof __wxjs_environment&&"miniprogram"===__wxjs_environment})),p=c((function(t){return/TDAppDesktop/i.test(t)})),h=function(){function t(){this.port=-1,this.nativeXHR=null}return t.prototype.probeElectronPort=function(){return r(this,void 0,void 0,(function(){function n(t){return r(this,void 0,void 0,(function(){var n;return o(this,(function(e){switch(e.label){case 0:n="http://127.0.0.1:".concat(t,"/ping"),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.xhrGet(n)];case 2:return e.sent(),[2,t];case 3:throw e.sent(),new Error("未监听到桌面端服务");case 4:return[2]}}))}))}return o(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,Promise.any(t.ELECTRON_HEARTBEAT_PORTS.map(n.bind(this)))];case 1:return[2,e.sent()];case 2:return e.sent(),[2,-1];case 3:return[2]}}))}))},t.prototype.assertElectronPort=function(){return r(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return-1!==this.port?[3,2]:(t=this,[4,this.probeElectronPort()]);case 1:t.port=n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.openDoc=function(t){return r(this,void 0,void 0,(function(){var n,e,r;return o(this,(function(o){switch(o.label){case 0:if(!a()||f()||p())return[2,!1];o.label=1;case 1:return o.trys.push([1,4,,5]),[4,this.getUIDsOfActiveAccounts()];case 2:if(!(n=o.sent()).length)throw new Error("没有活跃的用户");return e=n[0],n.includes(t.uid)&&(e=t.uid),[4,this.postToElectron("/open_doc",{doc_url:t.docUrl,uid:e})];case 3:return o.sent(),[2,!0];case 4:return r=o.sent(),console.log(r),[2,!1];case 5:return[2]}}))}))},t.prototype.getAccountsOfElectron=function(){return r(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this.getFromElectron("/accounts")];case 1:return[2,t.sent().data.accounts]}}))}))},t.prototype.getUIDsOfActiveAccounts=function(){return r(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this.getAccountsOfElectron()];case 1:return[2,t.sent().filter((function(t){return t.isActive})).map((function(t){return t.uid}))]}}))}))},t.prototype.getFromElectron=function(t,n){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.assertElectronPort()];case 1:if(e.sent(),-1===this.port)throw new Error("electron client is not alive");return[2,this.xhrGet("http://localhost:".concat(this.port).concat(t),n)]}}))}))},t.prototype.postToElectron=function(t,n,e){return r(this,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,this.assertElectronPort()];case 1:if(r.sent(),-1===this.port)throw new Error("electron client is not alive");return[2,this.xhrPost("http://localhost:".concat(this.port).concat(t),n,e)]}}))}))},t.prototype.assertNativeXHR=function(){if(!this.nativeXHR){var t=document.createElement("iframe");t.setAttribute("src","about:blank"),t.style.display="none",document.body.appendChild(t);var n=t.contentWindow.document;n&&(n.open(),n.write("<html><head></head><body></body></html>"),n.close(),this.nativeXHR=n.defaultView.XMLHttpRequest)}},t.prototype.xhrGet=function(t,n){var e=this;return new Promise((function(r,o){e.assertNativeXHR();var i=new e.nativeXHR;i.open("GET",t),n&&(i.timeout=n),i.responseType="json",i.onload=function(){r(i.response)},i.onerror=function(){o(new Error("Network Error"))},i.ontimeout=function(){o(new Error("Timeout"))},i.send()}))},t.prototype.xhrPost=function(t,n,e){var r=this;return void 0===e&&(e=5e3),new Promise((function(o,i){r.assertNativeXHR();var c=new r.nativeXHR;c.open("POST",t),c.timeout=e,c.setRequestHeader("Content-Type","application/json"),c.responseType="json",c.onload=function(){o(c.response)},c.onerror=function(){i(new Error("Network Error"))},c.ontimeout=function(){i(new Error("Timeout"))},c.send(JSON.stringify(n))}))},t.ELECTRON_HEARTBEAT_PORTS=[55721,58690,52250,64565,57661,51208,60629,62511,52859,50738],t.ELECTRON_PROBE_INTERVAL=6e3,t}(),d=function(){function t(){this.electronService=new h}return t.prototype.probeElectronPort=function(){return r(this,void 0,void 0,(function(){return o(this,(function(t){return[2,this.electronService.probeElectronPort()]}))}))},t.prototype.openDocInElectron=function(t){return r(this,void 0,void 0,(function(){return o(this,(function(n){return[2,this.electronService.openDoc(t)]}))}))},t.prototype.getAccountsOfElectron=function(){return r(this,void 0,void 0,(function(){return o(this,(function(t){return[2,this.electronService.getAccountsOfElectron()]}))}))},t}()}}]);
//# sourceMappingURL=slide-23-37a900.js.map